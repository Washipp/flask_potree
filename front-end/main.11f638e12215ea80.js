var Ene=Object.defineProperty,Cne=(Co,O,co)=>O in Co?Ene(Co,O,{enumerable:!0,configurable:!0,writable:!0,value:co}):Co[O]=co,on=(Co,O,co)=>(Cne(Co,"symbol"!=typeof O?O+"":O,co),co);(self.webpackChunkts_potree=self.webpackChunkts_potree||[]).push([[179],{209:(Co,O,co)=>{"use strict";var uo={};co.r(uo),co.d(uo,{Decoder:()=>sI,Encoder:()=>Y$,PacketType:()=>Wi,protocol:()=>BB});var fr={};function yt(n){return"function"==typeof n}function Et(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}co.r(fr),co.d(fr,{Manager:()=>IC,Socket:()=>oI,connect:()=>Of,default:()=>Of,io:()=>Of,protocol:()=>BB});const fn=Et(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function tn(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class An{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const o of t)o.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(yt(i))try{i()}catch(o){e=o instanceof fn?o.errors:[o]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const o of r)try{Si(o)}catch(l){e=null!=e?e:[],l instanceof fn?e=[...e,...l.errors]:e.push(l)}}if(e)throw new fn(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Si(e);else{if(e instanceof An){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&tn(t,e)}remove(e){const{_finalizers:t}=this;t&&tn(t,e),e instanceof An&&e._removeParent(this)}}An.EMPTY=(()=>{const n=new An;return n.closed=!0,n})();const mi=An.EMPTY;function tr(n){return n instanceof An||n&&"closed"in n&&yt(n.remove)&&yt(n.add)&&yt(n.unsubscribe)}function Si(n){yt(n)?n():n.unsubscribe()}const Qs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Mr={setTimeout(n,e,...t){const{delegate:i}=Mr;return(null==i?void 0:i.setTimeout)?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Mr;return((null==e?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function _e(n){Mr.setTimeout(()=>{const{onUnhandledError:e}=Qs;if(!e)throw n;e(n)})}function rs(){}const qa=na("C",void 0,void 0);function na(n,e,t){return{kind:n,value:e,error:t}}let eo=null;function Jl(n){if(Qs.useDeprecatedSynchronousErrorHandling){const e=!eo;if(e&&(eo={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=eo;if(eo=null,t)throw i}}else n()}class Du extends An{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,tr(e)&&e.add(this)):this.destination=nd}static create(e,t,i){return new Lc(e,t,i)}next(e){this.isStopped?Ru(function jf(n){return na("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Ru(function qf(n){return na("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Ru(qa,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const lg=Function.prototype.bind;function ja(n,e){return lg.call(n,e)}class cg{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Fc(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Fc(i)}else Fc(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Fc(t)}}}class Lc extends Du{constructor(e,t,i){let r;if(super(),yt(e)||!e)r={next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=i?i:void 0};else{let o;this&&Qs.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&ja(e.next,o),error:e.error&&ja(e.error,o),complete:e.complete&&ja(e.complete,o)}):r=e}this.destination=new cg(r)}}function Fc(n){Qs.useDeprecatedSynchronousErrorHandling?function td(n){Qs.useDeprecatedSynchronousErrorHandling&&eo&&(eo.errorThrown=!0,eo.error=n)}(n):_e(n)}function Ru(n,e){const{onStoppedNotification:t}=Qs;t&&Mr.setTimeout(()=>t(n,e))}const nd={closed:!0,next:rs,error:function Xf(n){throw n},complete:rs},Nc="function"==typeof Symbol&&Symbol.observable||"@@observable";function $t(n){return n}let pr=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const o=function dg(n){return n&&n instanceof Du||function hg(n){return n&&yt(n.next)&&yt(n.error)&&yt(n.complete)}(n)&&tr(n)}(t)?t:new Lc(t,i,r);return Jl(()=>{const{operator:l,source:c}=this;o.add(l?l.call(o,c):c?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=$f(i))((r,o)=>{const l=new Lc({next:c=>{try{t(c)}catch(d){o(d),l.unsubscribe()}},error:o,complete:r});this.subscribe(l)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[Nc](){return this}pipe(...t){return function id(n){return 0===n.length?$t:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}(t)(this)}toPromise(t){return new(t=$f(t))((i,r)=>{let o;this.subscribe(l=>o=l,l=>r(l),()=>i(o))})}}return n.create=e=>new n(e),n})();function $f(n){var e;return null!==(e=null!=n?n:Qs.Promise)&&void 0!==e?e:Promise}const Vt=Et(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let zt=(()=>{class n extends pr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new Oc(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new Vt}next(t){Jl(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Jl(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Jl(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:o}=this;return i||r?mi:(this.currentObservers=null,o.push(t),new An(()=>{this.currentObservers=null,tn(o,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:o}=this;i?t.error(r):o&&t.complete()}asObservable(){const t=new pr;return t.source=this,t}}return n.create=(e,t)=>new Oc(e,t),n})();class Oc extends zt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:mi}}function Rn(n){return yt(null==n?void 0:n.lift)}function gi(n){return e=>{if(Rn(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Mn(n,e,t,i,r){return new zo(n,e,t,i,r)}class zo extends Du{constructor(e,t,i,r,o,l){super(e),this.onFinalize=o,this.shouldUnsubscribe=l,this._next=t?function(c){try{t(c)}catch(d){e.error(d)}}:super._next,this._error=r?function(c){try{r(c)}catch(d){e.error(d)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Pn(n,e){return gi((t,i)=>{let r=0;t.subscribe(Mn(i,o=>{i.next(n.call(e,o,r++))}))})}function ho(n){return this instanceof ho?(this.v=n,this):new ho(n)}function _s(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),o=[];return r={},l("next"),l("throw"),l("return"),r[Symbol.asyncIterator]=function(){return this},r;function l(x){i[x]&&(r[x]=function(b){return new Promise(function(S,E){o.push([x,b,S,E])>1||c(x,b)})})}function c(x,b){try{!function d(x){x.value instanceof ho?Promise.resolve(x.value.v).then(p,y):v(o[0][2],x)}(i[x](b))}catch(S){v(o[0][3],S)}}function p(x){c("next",x)}function y(x){c("throw",x)}function v(x,b){x(b),o.shift(),o.length&&c(o[0][0],o[0][1])}}function zr(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Bi(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(l){return new Promise(function(c,d){!function r(o,l,c,d){Promise.resolve(d).then(function(p){o({value:p,done:c})},l)}(c,d,(l=n[o](l)).done,l.value)})}}}const Ya=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function _g(n){return yt(null==n?void 0:n.then)}function Ka(n){return yt(n[Nc])}function Kf(n){return Symbol.asyncIterator&&yt(null==n?void 0:n[Symbol.asyncIterator])}function Ou(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const ae=function va(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function V(n){return yt(null==n?void 0:n[ae])}function W(n){return _s(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield ho(t.read());if(r)return yield ho(void 0);yield yield ho(i)}}finally{t.releaseLock()}})}function re(n){return yt(null==n?void 0:n.getReader)}function pe(n){if(n instanceof pr)return n;if(null!=n){if(Ka(n))return function He(n){return new pr(e=>{const t=n[Nc]();if(yt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Ya(n))return function Ze(n){return new pr(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(_g(n))return function jt(n){return new pr(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,_e)})}(n);if(Kf(n))return At(n);if(V(n))return function gn(n){return new pr(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(re(n))return function Zt(n){return At(W(n))}(n)}throw Ou(n)}function At(n){return new pr(e=>{(function Ei(n,e){var t,i,r,o;return function rd(n,e,t,i){return new(t||(t=Promise))(function(o,l){function c(y){try{p(i.next(y))}catch(v){l(v)}}function d(y){try{p(i.throw(y))}catch(v){l(v)}}function p(y){y.done?o(y.value):function r(o){return o instanceof t?o:new t(function(l){l(o)})}(y.value).then(c,d)}p((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=zr(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(l){r={error:l}}finally{try{i&&!i.done&&(o=t.return)&&(yield o.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function vn(n,e,t,i=0,r=!1){const o=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function qi(n,e,t=1/0){return yt(e)?qi((i,r)=>Pn((o,l)=>e(i,o,r,l))(pe(n(i,r))),t):("number"==typeof e&&(t=e),gi((i,r)=>function mr(n,e,t,i,r,o,l,c){const d=[];let p=0,y=0,v=!1;const x=()=>{v&&!d.length&&!p&&e.complete()},b=E=>p<i?S(E):d.push(E),S=E=>{o&&e.next(E),p++;let T=!1;pe(t(E,y++)).subscribe(Mn(e,N=>{null==r||r(N),o?b(N):e.next(N)},()=>{T=!0},void 0,()=>{if(T)try{for(p--;d.length&&p<i;){const N=d.shift();l?vn(e,l,()=>S(N)):S(N)}x()}catch(N){e.error(N)}}))};return n.subscribe(Mn(e,b,()=>{v=!0,x()})),()=>{null==c||c()}}(i,r,n,t)))}function Ui(n=1/0){return qi($t,n)}const zn=new pr(n=>n.complete());function Ar(n){return n&&yt(n.schedule)}function Is(n){return n[n.length-1]}function Za(n){return yt(Is(n))?n.pop():void 0}function xa(n){return Ar(Is(n))?n.pop():void 0}function Ql(n,e=0){return gi((t,i)=>{t.subscribe(Mn(i,r=>vn(i,n,()=>i.next(r),e),()=>vn(i,n,()=>i.complete(),e),r=>vn(i,n,()=>i.error(r),e)))})}function Bc(n,e=0){return gi((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function vg(n,e){if(!n)throw new Error("Iterable cannot be null");return new pr(t=>{vn(t,e,()=>{const i=n[Symbol.asyncIterator]();vn(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function ss(n,e){return e?function Y_(n,e){if(null!=n){if(Ka(n))return function ba(n,e){return pe(n).pipe(Bc(e),Ql(e))}(n,e);if(Ya(n))return function j_(n,e){return new pr(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(_g(n))return function Pb(n,e){return pe(n).pipe(Bc(e),Ql(e))}(n,e);if(Kf(n))return vg(n,e);if(V(n))return function X_(n,e){return new pr(t=>{let i;return vn(t,e,()=>{i=n[ae](),vn(t,e,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(l){return void t.error(l)}o?t.complete():t.next(r)},0,!0)}),()=>yt(null==i?void 0:i.return)&&i.return()})}(n,e);if(re(n))return function $_(n,e){return vg(W(n),e)}(n,e)}throw Ou(n)}(n,e):pe(n)}function ld(n){return n<=0?()=>zn:gi((e,t)=>{let i=0;e.subscribe(Mn(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function xg(n={}){const{connector:e=(()=>new zt),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return o=>{let l=null,c=null,d=null,p=0,y=!1,v=!1;const x=()=>{null==c||c.unsubscribe(),c=null},b=()=>{x(),l=d=null,y=v=!1},S=()=>{const E=l;b(),null==E||E.unsubscribe()};return gi((E,T)=>{p++,!v&&!y&&x();const N=d=null!=d?d:e();T.add(()=>{p--,0===p&&!v&&!y&&(c=Zf(S,r))}),N.subscribe(T),l||(l=new Lc({next:F=>N.next(F),error:F=>{v=!0,x(),c=Zf(b,t,F),N.error(F)},complete:()=>{y=!0,x(),c=Zf(b,i),N.complete()}}),ss(E).subscribe(l))})(o)}}function Zf(n,e,...t){return!0===e?(n(),null):!1===e?null:e(...t).pipe(ld(1)).subscribe(()=>n())}function ar(n){for(let e in n)if(n[e]===ar)return e;throw Error("Could not find renamed property on target object.")}function Jf(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Zi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Zi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Qf(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const Z_=ar({__forward_ref__:ar});function cr(n){return n.__forward_ref__=cr,n.toString=function(){return Zi(this())},n}function Kn(n){return J_(n)?n():n}function J_(n){return"function"==typeof n&&n.hasOwnProperty(Z_)&&n.__forward_ref__===cr}class Yt extends Error{constructor(e,t){super(function Bu(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function In(n){return"string"==typeof n?n:null==n?"":String(n)}function os(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():In(n)}function Vu(n,e){const t=e?` in ${e}`:"";throw new Yt(-201,`No provider for ${os(n)} found${t}`)}function ia(n,e){null==n&&function nr(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function yn(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Fs(n){return{providers:n.providers||[],imports:n.imports||[]}}function Q_(n){return Lb(n,wg)||Lb(n,tv)}function Lb(n,e){return n.hasOwnProperty(e)?n[e]:null}function Fb(n){return n&&(n.hasOwnProperty(ev)||n.hasOwnProperty(hd))?n[ev]:null}const wg=ar({\u0275prov:ar}),ev=ar({\u0275inj:ar}),tv=ar({ngInjectableDef:ar}),hd=ar({ngInjectorDef:ar});var Cn=(()=>((Cn=Cn||{})[Cn.Default=0]="Default",Cn[Cn.Host=1]="Host",Cn[Cn.Self=2]="Self",Cn[Cn.SkipSelf=4]="SkipSelf",Cn[Cn.Optional=8]="Optional",Cn))();let nv;function Uc(n){const e=nv;return nv=n,e}function Nb(n,e,t){const i=Q_(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&Cn.Optional?null:void 0!==e?e:void Vu(Zi(n),"Injector")}function Vc(n){return{toString:n}.toString()}var Ja=(()=>((Ja=Ja||{})[Ja.OnPush=0]="OnPush",Ja[Ja.Default=1]="Default",Ja))(),Ho=(()=>{return(n=Ho||(Ho={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Ho;var n})();const zc="undefined"!=typeof globalThis&&globalThis,to="undefined"!=typeof window&&window,kb="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ji=zc||"undefined"!=typeof global&&global||to||kb,Hc={},gr=[],Mg=ar({\u0275cmp:ar}),Hu=ar({\u0275dir:ar}),iv=ar({\u0275pipe:ar}),Bb=ar({\u0275mod:ar}),ec=ar({\u0275fac:ar}),ep=ar({__NG_ELEMENT_ID__:ar});let qT=0;function Ao(n){return Vc(()=>{const t={},i={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Ja.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||gr,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Ho.Emulated,id:"c",styles:n.styles||gr,_:null,setInput:null,schemas:n.schemas||null,tView:null},r=n.directives,o=n.features,l=n.pipes;return i.id+=qT++,i.inputs=np(n.inputs,t),i.outputs=np(n.outputs),o&&o.forEach(c=>c(i)),i.directiveDefs=r?()=>("function"==typeof r?r():r).map(Ub):null,i.pipeDefs=l?()=>("function"==typeof l?l():l).map(Vb):null,i})}function tp(n,e,t){const i=n.\u0275cmp;i.directiveDefs=()=>e.map(Ub),i.pipeDefs=()=>t.map(Vb)}function Ub(n){return fo(n)||function tc(n){return n[Hu]||null}(n)}function Vb(n){return function Qe(n){return n[iv]||null}(n)}const zb={};function xs(n){return Vc(()=>{const e={type:n.type,bootstrap:n.bootstrap||gr,declarations:n.declarations||gr,imports:n.imports||gr,exports:n.exports||gr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(zb[n.id]=n.type),e})}function np(n,e){if(null==n)return Hc;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],o=r;Array.isArray(r)&&(o=r[1],r=r[0]),t[r]=i,e&&(e[r]=o)}return t}const Sn=Ao;function Go(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function fo(n){return n[Mg]||null}function ir(n,e){const t=n[Bb]||null;if(!t&&!0===e)throw new Error(`Type ${Zi(n)} does not have '\u0275mod' property.`);return t}function Ca(n){return Array.isArray(n)&&"object"==typeof n[1]}function Ta(n){return Array.isArray(n)&&!0===n[1]}function Do(n){return 0!=(8&n.flags)}function Aa(n){return 2==(2&n.flags)}function _l(n){return 1==(1&n.flags)}function sa(n){return null!==n.template}function pd(n){return 0!=(512&n[2])}function Wo(n,e){return n.hasOwnProperty(ec)?n[ec]:null}class cn{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function Ms(){return Da}function Da(n){return n.type.prototype.ngOnChanges&&(n.setInput=$T),XT}function XT(){const n=op(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===Hc)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function $T(n,e,t,i){const r=op(n)||function oa(n,e){return n[ic]=e}(n,{previous:Hc,current:null}),o=r.current||(r.current={}),l=r.previous,c=this.declaredInputs[t],d=l[c];o[c]=new cn(d&&d.currentValue,e,l===Hc),n[i]=e}Ms.ngInherit=!0;const ic="__ngSimpleChanges__";function op(n){return n[ic]||null}let xd;function kr(n){return!!n.listen}const hv={createRenderer:(n,e)=>function uv(){return void 0!==xd?xd:"undefined"!=typeof document?document:void 0}()};function us(n){for(;Array.isArray(n);)n=n[0];return n}function qo(n,e){return us(e[n])}function hs(n,e){return us(e[n.index])}function Qa(n,e){return n.data[e]}function Ns(n,e){const t=e[n];return Ca(t)?t:t[0]}function fv(n){return 4==(4&n[2])}function lp(n){return 128==(128&n[2])}function xl(n,e){return null==e?null:n[e]}function Gr(n){n[18]=0}function mv(n,e){n[5]+=e;let t=n,i=n[3];for(;null!==i&&(1===e&&1===t[5]||-1===e&&0===t[5]);)i[5]+=e,t=i,i=i[3]}const Qt={lFrame:pp(null),bindingsEnabled:!0};function gv(){return Qt.bindingsEnabled}function ot(){return Qt.lFrame.lView}function Ri(){return Qt.lFrame.tView}function vt(n){return Qt.lFrame.contextLView=n,n[8]}function ds(){let n=nn();for(;null!==n&&64===n.type;)n=n.parent;return n}function nn(){return Qt.lFrame.currentTNode}function wl(n,e){const t=Qt.lFrame;t.currentTNode=n,t.isParent=e}function jo(){return Qt.lFrame.isParent}function cp(){Qt.lFrame.isParent=!1}function jc(){return Qt.lFrame.bindingIndex++}function mo(n){const e=Qt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function yv(n,e){const t=Qt.lFrame;t.bindingIndex=t.bindingRootIndex=n,hp(e)}function hp(n){Qt.lFrame.currentDirectiveIndex=n}function dp(){return Qt.lFrame.currentQueryIndex}function Md(n){Qt.lFrame.currentQueryIndex=n}function Rg(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function fp(n,e,t){if(t&Cn.SkipSelf){let r=e,o=n;for(;!(r=r.parent,null!==r||t&Cn.Host||(r=Rg(o),null===r||(o=o[15],10&r.type))););if(null===r)return!1;e=r,n=o}const i=Qt.lFrame=Pg();return i.currentTNode=e,i.lView=n,!0}function ju(n){const e=Pg(),t=n[1];Qt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function Pg(){const n=Qt.lFrame,e=null===n?null:n.child;return null===e?pp(n):e}function pp(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Jr(){const n=Qt.lFrame;return Qt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const ew=Jr;function Xu(){const n=Jr();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function rr(){return Qt.lFrame.selectedIndex}function ac(n){Qt.lFrame.selectedIndex=n}function Wr(){const n=Qt.lFrame;return Qa(n.tView,n.selectedIndex)}function $u(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const o=n.data[t].type.prototype,{ngAfterContentInit:l,ngAfterContentChecked:c,ngAfterViewInit:d,ngAfterViewChecked:p,ngOnDestroy:y}=o;l&&(n.contentHooks||(n.contentHooks=[])).push(-t,l),c&&((n.contentHooks||(n.contentHooks=[])).push(t,c),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,c)),d&&(n.viewHooks||(n.viewHooks=[])).push(-t,d),p&&((n.viewHooks||(n.viewHooks=[])).push(t,p),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,p)),null!=y&&(n.destroyHooks||(n.destroyHooks=[])).push(t,y)}}function lc(n,e,t){nw(n,e,3,t)}function Yu(n,e,t,i){(3&n[2])===t&&nw(n,e,t,i)}function gp(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function nw(n,e,t,i){const o=null!=i?i:-1,l=e.length-1;let c=0;for(let d=void 0!==i?65535&n[18]:0;d<l;d++)if("number"==typeof e[d+1]){if(c=e[d],null!=i&&c>=i)break}else e[d]<0&&(n[18]+=65536),(c<o||-1==o)&&(KT(n,t,e,d),n[18]=(4294901760&n[18])+d+2),d++}function KT(n,e,t,i){const r=t[i]<0,o=t[i+1],c=n[r?-t[i]:t[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{o.call(c)}finally{}}}else try{o.call(c)}finally{}}class Sl{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Lg(n,e,t){const i=kr(n);let r=0;for(;r<t.length;){const o=t[r];if("number"==typeof o){if(0!==o)break;r++;const l=t[r++],c=t[r++],d=t[r++];i?n.setAttribute(e,c,d,l):e.setAttributeNS(l,c,d)}else{const l=o,c=t[++r];xv(l)?i&&n.setProperty(e,l,c):i?n.setAttribute(e,l,c):e.setAttribute(l,c),r++}}return r}function iw(n){return 3===n||4===n||6===n}function xv(n){return 64===n.charCodeAt(0)}function Fg(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||rw(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function rw(n,e,t,i,r){let o=0,l=n.length;if(-1===e)l=-1;else for(;o<n.length;){const c=n[o++];if("number"==typeof c){if(c===e){l=-1;break}if(c>e){l=o-1;break}}}for(;o<n.length;){const c=n[o];if("number"==typeof c)break;if(c===t){if(null===i)return void(null!==r&&(n[o+1]=r));if(i===n[o+1])return void(n[o+2]=r)}o++,null!==i&&o++,null!==r&&o++}-1!==l&&(n.splice(l,0,e),o=l+1),n.splice(o++,0,t),null!==i&&n.splice(o++,0,i),null!==r&&n.splice(o++,0,r)}function sw(n){return-1!==n}function Ad(n){return 32767&n}function Dd(n,e){let t=function JT(n){return n>>16}(n),i=e;for(;t>0;)i=i[15],t--;return i}let bv=!0;function Ng(n){const e=bv;return bv=n,e}let QT=0;function _p(n,e){const t=Mv(n,e);if(-1!==t)return t;const i=e[1];i.firstCreatePass&&(n.injectorIndex=e.length,wv(i.data,n),wv(e,null),wv(i.blueprint,null));const r=Og(n,e),o=n.injectorIndex;if(sw(r)){const l=Ad(r),c=Dd(r,e),d=c[1].data;for(let p=0;p<8;p++)e[o+p]=c[l+p]|d[l+p]}return e[o+8]=r,o}function wv(n,e){n.push(0,0,0,0,0,0,0,0,e)}function Mv(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Og(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){const o=r[1],l=o.type;if(i=2===l?o.declTNode:1===l?r[6]:null,null===i)return-1;if(t++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return-1}function kg(n,e,t){!function eA(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(ep)&&(i=t[ep]),null==i&&(i=t[ep]=QT++);const r=255&i;e.data[n+(r>>5)]|=1<<r}(n,e,t)}function lw(n,e,t){if(t&Cn.Optional)return n;Vu(e,"NodeInjector")}function cw(n,e,t,i){if(t&Cn.Optional&&void 0===i&&(i=null),0==(t&(Cn.Self|Cn.Host))){const r=n[9],o=Uc(void 0);try{return r?r.get(e,i,t&Cn.Optional):Nb(e,i,t&Cn.Optional)}finally{Uc(o)}}return lw(i,e,t)}function uw(n,e,t,i=Cn.Default,r){if(null!==n){const o=function rA(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(ep)?n[ep]:void 0;return"number"==typeof e?e>=0?255&e:nA:e}(t);if("function"==typeof o){if(!fp(e,n,i))return i&Cn.Host?lw(r,t,i):cw(e,t,i,r);try{const l=o(i);if(null!=l||i&Cn.Optional)return l;Vu(t)}finally{ew()}}else if("number"==typeof o){let l=null,c=Mv(n,e),d=-1,p=i&Cn.Host?e[16][6]:null;for((-1===c||i&Cn.SkipSelf)&&(d=-1===c?Og(n,e):e[c+8],-1!==d&&fw(i,!1)?(l=e[1],c=Ad(d),e=Dd(d,e)):c=-1);-1!==c;){const y=e[1];if(dw(o,c,y.data)){const v=iA(c,e,t,l,i,p);if(v!==hw)return v}d=e[c+8],-1!==d&&fw(i,e[1].data[c+8]===p)&&dw(o,c,e)?(l=y,c=Ad(d),e=Dd(d,e)):c=-1}}}return cw(e,t,i,r)}const hw={};function nA(){return new Rd(ds(),ot())}function iA(n,e,t,i,r,o){const l=e[1],c=l.data[n+8],y=Bg(c,l,t,null==i?Aa(c)&&bv:i!=l&&0!=(3&c.type),r&Cn.Host&&o===c);return null!==y?vp(e,l,y,c):hw}function Bg(n,e,t,i,r){const o=n.providerIndexes,l=e.data,c=1048575&o,d=n.directiveStart,y=o>>20,x=r?c+y:n.directiveEnd;for(let b=i?c:c+y;b<x;b++){const S=l[b];if(b<d&&t===S||b>=d&&S.type===t)return b}if(r){const b=l[d];if(b&&sa(b)&&b.type===t)return d}return null}function vp(n,e,t,i){let r=n[t];const o=e.data;if(function Ig(n){return n instanceof Sl}(r)){const l=r;l.resolving&&function Uu(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new Yt(-200,`Circular dependency in DI detected for ${n}${t}`)}(os(o[t]));const c=Ng(l.canSeeViewProviders);l.resolving=!0;const d=l.injectImpl?Uc(l.injectImpl):null;fp(n,i,Cn.Default);try{r=n[t]=l.factory(void 0,o,n,i),e.firstCreatePass&&t>=i.directiveStart&&function Cd(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(i){const l=Da(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,l),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,l)}r&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,r),o&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o))}(t,o[t],e)}finally{null!==d&&Uc(d),Ng(c),l.resolving=!1,ew()}}return r}function dw(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function fw(n,e){return!(n&Cn.Self||n&Cn.Host&&e)}class Rd{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return uw(this._tNode,this._lView,e,i,t)}}function go(n){return Vc(()=>{const e=n.prototype.constructor,t=e[ec]||Sv(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const o=r[ec]||Sv(r);if(o&&o!==t)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function Sv(n){return J_(n)?()=>{const e=Sv(Kn(n));return e&&e()}:Wo(n)}const Id="__parameters__";function Fd(n,e,t){return Vc(()=>{const i=function Ev(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...o){if(this instanceof r)return i.apply(this,o),this;const l=new r(...o);return c.annotation=l,c;function c(d,p,y){const v=d.hasOwnProperty(Id)?d[Id]:Object.defineProperty(d,Id,{value:[]})[Id];for(;v.length<=y;)v.push(null);return(v[y]=v[y]||[]).push(l),d}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Xn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=yn({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const oA=new Xn("AnalyzeForEntryComponents");function Pa(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)?(e===n&&(e=n.slice(0,t)),Pa(i,e)):e!==n&&e.push(i)}return e}function El(n,e){n.forEach(t=>Array.isArray(t)?El(t,e):e(t))}function mw(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Ug(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function la(n,e,t){let i=Nd(n,e);return i>=0?n[1|i]=t:(i=~i,function cA(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(1===r)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;)n[r]=n[r-2],r--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function Tv(n,e){const t=Nd(n,e);if(t>=0)return n[1|t]}function Nd(n,e){return function _w(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){const o=i+(r-i>>1),l=n[o<<t];if(e===l)return o<<t;l>e?r=o:i=o+1}return~(r<<t)}(n,e,1)}const Sp={},Dv="__NG_DI_FLAG__",zg="ngTempTokenPath",gA=/\n/gm,xw="__source",_A=ar({provide:String,useValue:ar});let Ep;function bw(n){const e=Ep;return Ep=n,e}function vA(n,e=Cn.Default){if(void 0===Ep)throw new Yt(203,"");return null===Ep?Nb(n,void 0,e):Ep.get(n,e&Cn.Optional?null:void 0,e)}function Ot(n,e=Cn.Default){return(function WT(){return nv}()||vA)(Kn(n),e)}const xA=Ot;function Rv(n){const e=[];for(let t=0;t<n.length;t++){const i=Kn(n[t]);if(Array.isArray(i)){if(0===i.length)throw new Yt(900,"");let r,o=Cn.Default;for(let l=0;l<i.length;l++){const c=i[l],d=d2(c);"number"==typeof d?-1===d?r=c.token:o|=d:r=c}e.push(Ot(r,o))}else e.push(Ot(i))}return e}function Hg(n,e){return n[Dv]=e,n.prototype[Dv]=e,n}function d2(n){return n[Dv]}const Pv=Hg(Fd("Inject",n=>({token:n})),-1),Zu=Hg(Fd("Optional"),8),Gg=Hg(Fd("SkipSelf"),4);function ca(n){return n instanceof class Cw{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?n.changingThisBreaksApplicationSecurity:n}const zw="__ngContext__";function yo(n,e){n[zw]=e}function Gv(n){const e=function Lp(n){return n[zw]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function qv(n){return n.ngOriginalError}function YA(n,...e){n.error(...e)}class Fp{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),i=function $A(n){return n&&n.ngErrorLogger||YA}(e);i(this._console,"ERROR",e),t&&i(this._console,"ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&qv(e);for(;t&&qv(t);)t=qv(t);return t||null}}const $c=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ji))();function $v(n){return n.ownerDocument}function tl(n){return n instanceof Function?n():n}var ua=(()=>((ua=ua||{})[ua.Important=1]="Important",ua[ua.DashCase=2]="DashCase",ua))();function Yg(n,e){return undefined(n,e)}function eh(n){const e=n[3];return Ta(e)?e[3]:e}function Yv(n){return Qw(n[13])}function Kg(n){return Qw(n[4])}function Qw(n){for(;null!==n&&!Ta(n);)n=n[4];return n}function th(n,e,t,i,r){if(null!=i){let o,l=!1;Ta(i)?o=i:Ca(i)&&(l=!0,i=i[0]);const c=us(i);0===n&&null!==t?null==r?rM(e,t,c):nh(e,t,c,r||null,!0):1===n&&null!==t?nh(e,t,c,r||null,!0):2===n?function Qg(n,e,t){const i=ih(n,e);i&&function p1(n,e,t,i){kr(n)?n.removeChild(e,t,i):e.removeChild(t)}(n,i,e,t)}(e,c,l):3===n&&e.destroyNode(c),null!=o&&function lr(n,e,t,i,r){const o=t[7];o!==us(t)&&th(e,n,i,o,r);for(let c=10;c<t.length;c++){const d=t[c];kp(d[1],d,n,e,i,o)}}(e,n,o,t,r)}}function Zv(n,e,t){if(kr(n))return n.createElement(e,t);{const i=null!==t?function rc(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(t):null;return null===i?n.createElement(e):n.createElementNS(i,e)}}function tM(n,e){const t=n[9],i=t.indexOf(e),r=e[3];1024&e[2]&&(e[2]&=-1025,mv(r,-1)),t.splice(i,1)}function Jv(n,e){if(n.length<=10)return;const t=10+e,i=n[t];if(i){const r=i[17];null!==r&&r!==n&&tM(r,i),e>0&&(n[t-1][4]=i[4]);const o=Ug(n,10+e);!function o1(n,e){kp(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const l=o[19];null!==l&&l.detachView(o[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function Qv(n,e){if(!(256&e[2])){const t=e[11];kr(t)&&t.destroyNode&&kp(n,e,t,3,null,null),function c1(n){let e=n[13];if(!e)return Zg(n[1],n);for(;e;){let t=null;if(Ca(e))t=e[13];else{const i=e[10];i&&(t=i)}if(!t){for(;e&&!e[4]&&e!==n;)Ca(e)&&Zg(e[1],e),e=e[3];null===e&&(e=n),Ca(e)&&Zg(e[1],e),t=e&&e[4]}e=t}}(e)}}function Zg(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function f1(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof Sl)){const o=t[i+1];if(Array.isArray(o))for(let l=0;l<o.length;l+=2){const c=r[o[l]],d=o[l+1];try{d.call(c)}finally{}}else try{o.call(r)}finally{}}}}(n,e),function d1(n,e){const t=n.cleanup,i=e[7];let r=-1;if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const l=t[o+1],c="function"==typeof l?l(e):us(e[l]),d=i[r=t[o+2]],p=t[o+3];"boolean"==typeof p?c.removeEventListener(t[o],d,p):p>=0?i[r=p]():i[r=-p].unsubscribe(),o+=2}else{const l=i[r=t[o+1]];t[o].call(l)}if(null!==i){for(let o=r+1;o<i.length;o++)i[o]();e[7]=null}}(n,e),1===e[1].type&&kr(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&Ta(e[3])){t!==e[3]&&tM(t,e);const i=e[19];null!==i&&i.detachView(n)}}}function nM(n,e,t){return function iM(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===Ho.None||r===Ho.Emulated)return null}return hs(i,t)}(n,e.parent,t)}function nh(n,e,t,i,r){kr(n)?n.insertBefore(e,t,i,r):e.insertBefore(t,i,r)}function rM(n,e,t){kr(n)?n.appendChild(e,t):e.appendChild(t)}function e0(n,e,t,i,r){null!==i?nh(n,e,t,i,r):rM(n,e,t)}function ih(n,e){return kr(n)?n.parentNode(e):e.parentNode}let t0=function oM(n,e,t){return 40&n.type?hs(n,t):null};function Np(n,e,t,i){const r=nM(n,i,e),o=e[11],c=function sM(n,e,t){return t0(n,e,t)}(i.parent||e[6],i,e);if(null!=r)if(Array.isArray(t))for(let d=0;d<t.length;d++)e0(o,r,t[d],c,!1);else e0(o,r,t,c,!1)}function Ud(n,e){if(null!==e){const t=e.type;if(3&t)return hs(e,n);if(4&t)return r0(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Ud(n,i);{const r=n[e.index];return Ta(r)?r0(-1,r):us(r)}}if(32&t)return Yg(e,n)()||us(n[e.index]);{const i=Yc(n,e);return null!==i?Array.isArray(i)?i[0]:Ud(eh(n[16]),i):Ud(n,e.next)}}return null}function Yc(n,e){return null!==e?n[16][6].projection[e.projection]:null}function r0(n,e){const t=10+n+1;if(t<e.length){const i=e[t],r=i[1].firstChild;if(null!==r)return Ud(i,r)}return e[7]}function Op(n,e,t,i,r,o,l){for(;null!=t;){const c=i[t.index],d=t.type;if(l&&0===e&&(c&&yo(us(c),i),t.flags|=4),64!=(64&t.flags))if(8&d)Op(n,e,t.child,i,r,o,!1),th(e,n,r,c,o);else if(32&d){const p=Yg(t,i);let y;for(;y=p();)th(e,n,r,y,o);th(e,n,r,c,o)}else 16&d?lM(n,e,i,t,r,o):th(e,n,r,c,o);t=l?t.projectionNext:t.next}}function kp(n,e,t,i,r,o){Op(t,i,n.firstChild,e,r,o,!1)}function lM(n,e,t,i,r,o){const l=t[16],d=l[6].projection[i.projection];if(Array.isArray(d))for(let p=0;p<d.length;p++)th(e,n,r,d[p],o);else Op(n,e,d,l[3],r,o,!0)}function Vd(n,e,t){kr(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function rh(n,e,t){kr(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function Bp(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const o=e.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}t=r+1}}const _o="ng-template";function Kc(n,e,t){let i=0;for(;i<n.length;){let r=n[i++];if(t&&"class"===r){if(r=n[i],-1!==Bp(r.toLowerCase(),e,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===e)return!0;return!1}}return!1}function Up(n){return 4===n.type&&n.value!==_o}function Hd(n,e,t){return e===(4!==n.type||t?n.value:_o)}function Vp(n,e,t){let i=4;const r=n.attrs||[],o=function uM(n){for(let e=0;e<n.length;e++)if(iw(n[e]))return e;return n.length}(r);let l=!1;for(let c=0;c<e.length;c++){const d=e[c];if("number"!=typeof d){if(!l)if(4&i){if(i=2|1&i,""!==d&&!Hd(n,d,t)||""===d&&1===e.length){if(vo(i))return!1;l=!0}}else{const p=8&i?d:e[++c];if(8&i&&null!==n.attrs){if(!Kc(n.attrs,p,t)){if(vo(i))return!1;l=!0}continue}const v=Gd(8&i?"class":d,r,Up(n),t);if(-1===v){if(vo(i))return!1;l=!0;continue}if(""!==p){let x;x=v>o?"":r[v+1].toLowerCase();const b=8&i?x:null;if(b&&-1!==Bp(b,p,0)||2&i&&p!==x){if(vo(i))return!1;l=!0}}}}else{if(!l&&!vo(i)&&!vo(d))return!1;if(l&&vo(d))continue;l=!1,i=d|1&i}}return vo(i)||l}function vo(n){return 0==(1&n)}function Gd(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let o=!1;for(;r<e.length;){const l=e[r];if(l===n)return r;if(3===l||6===l)o=!0;else{if(1===l||2===l){let c=e[++r];for(;"string"==typeof c;)c=e[++r];continue}if(4===l)break;if(0===l){r+=4;continue}}r+=o?1:2}return-1}return function ey(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function sh(n,e,t=!1){for(let i=0;i<e.length;i++)if(Vp(n,e[i],t))return!0;return!1}function Gp(n,e){return n?":not("+e.trim()+")":e}function hM(n){let e=n[0],t=1,i=2,r="",o=!1;for(;t<n.length;){let l=n[t];if("string"==typeof l)if(2&i){const c=n[++t];r+="["+l+(c.length>0?'="'+c+'"':"")+"]"}else 8&i?r+="."+l:4&i&&(r+=" "+l);else""!==r&&!vo(l)&&(e+=Gp(o,r),r=""),i=l,o=o||!vo(i);t++}return""!==r&&(e+=Gp(o,r)),e}const kn={};function at(n){Wp(Ri(),ot(),rr()+n,!1)}function Wp(n,e,t,i){if(!i)if(3==(3&e[2])){const o=n.preOrderCheckHooks;null!==o&&lc(e,o,t)}else{const o=n.preOrderHooks;null!==o&&Yu(e,o,0,t)}ac(t)}function qp(n,e){return n<<17|e<<2}function La(n){return n>>17&32767}function l0(n){return 2|n}function Tl(n){return(131068&n)>>2}function Wd(n,e){return-131069&n|e<<2}function uc(n){return 1|n}function Xd(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const r=t[i],o=t[i+1];if(-1!==o){const l=n.data[o];Md(r),l.contentQueries(2,e[o],o)}}}function Yp(n,e,t,i,r,o,l,c,d,p){const y=e.blueprint.slice();return y[0]=r,y[2]=140|i,Gr(y),y[3]=y[15]=n,y[8]=t,y[10]=l||n&&n[10],y[11]=c||n&&n[11],y[12]=d||n&&n[12]||null,y[9]=p||n&&n[9]||null,y[6]=o,y[16]=2==e.type?n[16]:y,y}function $d(n,e,t,i,r){let o=n.data[e];if(null===o)o=function lh(n,e,t,i,r){const o=nn(),l=jo(),d=n.data[e]=function Pl(n,e,t,i,r,o){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,l?o:o&&o.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=d),null!==o&&(l?null==o.child&&null!==d.parent&&(o.child=d):null===o.next&&(o.next=d)),d}(n,e,t,i,r),function Xc(){return Qt.lFrame.inI18n}()&&(o.flags|=64);else if(64&o.type){o.type=t,o.value=i,o.attrs=r;const l=function bd(){const n=Qt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();o.injectorIndex=null===l?-1:l.injectorIndex}return wl(o,!0),o}function fc(n,e,t,i){if(0===t)return-1;const r=e.length;for(let o=0;o<t;o++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function ch(n,e,t){ju(e);try{const i=n.viewQuery;null!==i&&C0(1,i,t);const r=n.template;null!==r&&Kp(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Xd(n,e),n.staticViewQueries&&C0(2,n.viewQuery,t);const o=n.components;null!==o&&function C1(n,e){for(let t=0;t<e.length;t++)CM(n,e[t])}(e,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[2]&=-5,Xu()}}function Rl(n,e,t,i){const r=e[2];if(256!=(256&r)){ju(e);try{Gr(e),function qu(n){return Qt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&Kp(n,e,t,2,i);const l=3==(3&r);if(l){const p=n.preOrderCheckHooks;null!==p&&lc(e,p,null)}else{const p=n.preOrderHooks;null!==p&&Yu(e,p,0,null),gp(e,0)}if(function N1(n){for(let e=Yv(n);null!==e;e=Kg(e)){if(!e[2])continue;const t=e[9];for(let i=0;i<t.length;i++){const r=t[i],o=r[3];0==(1024&r[2])&&mv(o,1),r[2]|=1024}}}(e),function hy(n){for(let e=Yv(n);null!==e;e=Kg(e))for(let t=10;t<e.length;t++){const i=e[t],r=i[1];lp(i)&&Rl(r,i,r.template,i[8])}}(e),null!==n.contentQueries&&Xd(n,e),l){const p=n.contentCheckHooks;null!==p&&lc(e,p)}else{const p=n.contentHooks;null!==p&&Yu(e,p,1),gp(e,1)}!function S1(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)ac(~r);else{const o=r,l=t[++i],c=t[++i];yv(l,o),c(2,e[o])}}}finally{ac(-1)}}(n,e);const c=n.components;null!==c&&function E1(n,e){for(let t=0;t<e.length;t++)nm(n,e[t])}(e,c);const d=n.viewQuery;if(null!==d&&C0(2,d,i),l){const p=n.viewCheckHooks;null!==p&&lc(e,p)}else{const p=n.viewHooks;null!==p&&Yu(e,p,2),gp(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[2]&=-73,1024&e[2]&&(e[2]&=-1025,mv(e[3],-1))}finally{Xu()}}}function bM(n,e,t,i){const r=e[10],l=fv(e);try{!l&&r.begin&&r.begin(),l&&ch(n,e,i),Rl(n,e,t,i)}finally{!l&&r.end&&r.end()}}function Kp(n,e,t,i,r){const o=rr(),l=2&i;try{ac(-1),l&&e.length>20&&Wp(n,e,20,!1),t(i,r)}finally{ac(o)}}function Zp(n,e,t){if(Do(e)){const r=e.directiveEnd;for(let o=e.directiveStart;o<r;o++){const l=n.data[o];l.contentQueries&&l.contentQueries(1,t[o],o)}}}function Yd(n,e,t){!gv()||(function A1(n,e,t,i){const r=t.directiveStart,o=t.directiveEnd;n.firstCreatePass||_p(t,e),yo(i,e);const l=t.initialInputs;for(let c=r;c<o;c++){const d=n.data[c],p=sa(d);p&&L1(e,t,d);const y=vp(e,n,c,t);yo(y,e),null!==l&&Br(0,c-r,y,d,0,l),p&&(Ns(t.index,e)[8]=y)}}(n,e,t,hs(t,e)),128==(128&t.flags)&&function D1(n,e,t){const i=t.directiveStart,r=t.directiveEnd,l=t.index,c=function _v(){return Qt.lFrame.currentDirectiveIndex}();try{ac(l);for(let d=i;d<r;d++){const p=n.data[d],y=e[d];hp(d),(null!==p.hostBindings||0!==p.hostVars||null!==p.hostAttrs)&&MM(p,y)}}finally{ac(-1),hp(c)}}(n,e,t))}function Jp(n,e,t=hs){const i=e.localNames;if(null!==i){let r=e.index+1;for(let o=0;o<i.length;o+=2){const l=i[o+1],c=-1===l?t(e,n):n[l];n[r++]=c}}}function v0(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=pc(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function pc(n,e,t,i,r,o,l,c,d,p){const y=20+i,v=y+r,x=function uh(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:kn);return t}(y,v),b="function"==typeof p?p():p;return x[1]={type:n,blueprint:x,template:t,queries:null,viewQuery:c,declTNode:e,data:x.slice().fill(null,y),bindingStartIndex:y,expandoStartIndex:v,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof l?l():l,firstChild:null,schemas:d,consts:b,incompleteFirstPass:!1}}function dh(n,e,t,i){const r=gh(e);null===t?r.push(i):(r.push(t),n.firstCreatePass&&Jc(n).push(i,r.length-1))}function fh(n,e,t){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(t=null===t?{}:t).hasOwnProperty(i)?t[i].push(e,r):t[i]=[e,r]}return t}function Lo(n,e,t,i,r,o,l,c){const d=hs(e,t);let y,p=e.inputs;!c&&null!=p&&(y=p[i])?(yh(n,t,y,i,r),Aa(e)&&function ly(n,e){const t=Ns(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(i=function ay(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=l?l(r,e.value||"",i):r,kr(o)?o.setProperty(d,i,r):xv(i)||(d.setProperty?d.setProperty(i,r):d[i]=r))}function w0(n,e,t,i){let r=!1;if(gv()){const o=function R1(n,e,t){const i=n.directiveRegistry;let r=null;if(i)for(let o=0;o<i.length;o++){const l=i[o];sh(t,l.selectors,!1)&&(r||(r=[]),kg(_p(t,e),n,l.type),sa(l)?(SM(n,t),r.unshift(l)):r.push(l))}return r}(n,e,t),l=null===i?null:{"":-1};if(null!==o){r=!0,EM(t,n.data.length,o.length);for(let y=0;y<o.length;y++){const v=o[y];v.providersResolver&&v.providersResolver(v)}let c=!1,d=!1,p=fc(n,e,o.length,null);for(let y=0;y<o.length;y++){const v=o[y];t.mergedAttrs=Fg(t.mergedAttrs,v.hostAttrs),cy(n,t,e,p,v),I1(p,v,l),null!==v.contentQueries&&(t.flags|=8),(null!==v.hostBindings||null!==v.hostAttrs||0!==v.hostVars)&&(t.flags|=128);const x=v.type.prototype;!c&&(x.ngOnChanges||x.ngOnInit||x.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),c=!0),!d&&(x.ngOnChanges||x.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),d=!0),p++}!function oy(n,e){const i=e.directiveEnd,r=n.data,o=e.attrs,l=[];let c=null,d=null;for(let p=e.directiveStart;p<i;p++){const y=r[p],v=y.inputs,x=null===o||Up(e)?null:uy(v,o);l.push(x),c=fh(v,p,c),d=fh(y.outputs,p,d)}null!==c&&(c.hasOwnProperty("class")&&(e.flags|=16),c.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=l,e.inputs=c,e.outputs=d}(n,t)}l&&function P1(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const o=t[e[r+1]];if(null==o)throw new Yt(-301,!1);i.push(e[r],o)}}}(t,i,l)}return t.mergedAttrs=Fg(t.mergedAttrs,t.attrs),r}function wM(n,e,t,i,r,o){const l=o.hostBindings;if(l){let c=n.hostBindingOpCodes;null===c&&(c=n.hostBindingOpCodes=[]);const d=~e.index;(function T1(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(c)!=d&&c.push(d),c.push(i,r,l)}}function MM(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function SM(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function I1(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;sa(e)&&(t[""]=n)}}function EM(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function cy(n,e,t,i,r){n.data[i]=r;const o=r.factory||(r.factory=Wo(r.type)),l=new Sl(o,sa(r),null);n.blueprint[i]=l,t[i]=l,wM(n,e,0,i,fc(n,t,r.hostVars,kn),r)}function L1(n,e,t){const i=hs(e,n),r=v0(t),o=n[10],l=Zc(n,Yp(n,r,null,t.onPush?64:16,i,e,o,o.createRenderer(i,t),null,null));n[e.index]=l}function Br(n,e,t,i,r,o){const l=o[e];if(null!==l){const c=i.setInput;for(let d=0;d<l.length;){const p=l[d++],y=l[d++],v=l[d++];null!==c?i.setInput(t,v,p,y):t[y]=v}}}function uy(n,e){let t=null,i=0;for(;i<e.length;){const r=e[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===t&&(t=[]),t.push(r,n[r],e[i+1])),i+=2}else i+=2;else i+=4}return t}function tm(n,e,t,i){return new Array(n,!0,!1,e,null,0,i,t,null,null)}function nm(n,e){const t=Ns(e,n);if(lp(t)){const i=t[1];80&t[2]?Rl(i,t,i.template,t[8]):t[5]>0&&S0(t)}}function S0(n){for(let i=Yv(n);null!==i;i=Kg(i))for(let r=10;r<i.length;r++){const o=i[r];if(1024&o[2]){const l=o[1];Rl(l,o,l.template,o[8])}else o[5]>0&&S0(o)}const t=n[1].components;if(null!==t)for(let i=0;i<t.length;i++){const r=Ns(t[i],n);lp(r)&&r[5]>0&&S0(r)}}function CM(n,e){const t=Ns(e,n),i=t[1];(function TM(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),ch(i,t,t[8])}function Zc(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function im(n){for(;n;){n[2]|=64;const e=eh(n);if(pd(n)&&!e)return n;n=e}return null}function E0(n){!function Fa(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],i=Gv(t),r=i[1];bM(r,i,r.template,t)}}(n[8])}function C0(n,e,t){Md(0),e(n,t)}const mh=(()=>Promise.resolve(null))();function gh(n){return n[7]||(n[7]=[])}function Jc(n){return n.cleanup||(n.cleanup=[])}function Qc(n,e){const t=n[9],i=t?t.get(Fp,null):null;i&&i.handleError(e)}function yh(n,e,t,i,r){for(let o=0;o<t.length;){const l=t[o++],c=t[o++],d=e[l],p=n.data[l];null!==p.setInput?p.setInput(d,r,i,c):d[c]=r}}function Xo(n,e,t){const i=qo(e,n);!function eM(n,e,t){kr(n)?n.setValue(e,t):e.textContent=t}(n[11],i,t)}function _c(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,o=0;if(null!==e)for(let l=0;l<e.length;l++){const c=e[l];"number"==typeof c?o=c:1==o?r=Qf(r,c):2==o&&(i=Qf(i,c+": "+e[++l]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}const fy=new Xn("INJECTOR",-1);class py{get(e,t=Sp){if(t===Sp){const i=new Error(`NullInjectorError: No provider for ${Zi(e)}!`);throw i.name="NullInjectorError",i}return t}}const sm=new Xn("Set Injector scope."),eu={},A0={};let om;function my(){return void 0===om&&(om=new py),om}function gy(n,e=null,t=null,i){const r=yy(n,e,t,i);return r._resolveInjectorDefTypes(),r}function yy(n,e=null,t=null,i){return new D0(n,t,e||my(),i)}class D0{constructor(e,t,i,r=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const o=[];t&&El(t,c=>this.processProvider(c,e,t)),El([e],c=>this.processInjectorType(c,[],o)),this.records.set(fy,_h(void 0,this));const l=this.records.get(sm);this.scope=null!=l?l.value:null,this.source=r||("object"==typeof e?null:Zi(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=Sp,i=Cn.Default){this.assertNotDestroyed();const r=bw(this),o=Uc(void 0);try{if(!(i&Cn.SkipSelf)){let c=this.records.get(e);if(void 0===c){const d=function Zd(n){return"function"==typeof n||"object"==typeof n&&n instanceof Xn}(e)&&Q_(e);c=d&&this.injectableDefInScope(d)?_h(am(e),eu):null,this.records.set(e,c)}if(null!=c)return this.hydrate(e,c)}return(i&Cn.Self?my():this.parent).get(e,t=i&Cn.Optional&&t===Sp?null:t)}catch(l){if("NullInjectorError"===l.name){if((l[zg]=l[zg]||[]).unshift(Zi(e)),r)throw l;return function f2(n,e,t,i){const r=n[zg];throw e[xw]&&r.unshift(e[xw]),n.message=function p2(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let r=Zi(e);if(Array.isArray(e))r=e.map(Zi).join(" -> ");else if("object"==typeof e){let o=[];for(let l in e)if(e.hasOwnProperty(l)){let c=e[l];o.push(l+":"+("string"==typeof c?JSON.stringify(c):Zi(c)))}r=`{${o.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(gA,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[zg]=null,n}(l,e,"R3InjectorError",this.source)}throw l}finally{Uc(o),bw(r)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((i,r)=>e.push(Zi(r))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Yt(205,!1)}processInjectorType(e,t,i){if(!(e=Kn(e)))return!1;let r=Fb(e);const o=null==r&&e.ngModule||void 0,l=void 0===o?e:o,c=-1!==i.indexOf(l);if(void 0!==o&&(r=Fb(o)),null==r)return!1;if(null!=r.imports&&!c){let y;i.push(l);try{El(r.imports,v=>{this.processInjectorType(v,t,i)&&(void 0===y&&(y=[]),y.push(v))})}finally{}if(void 0!==y)for(let v=0;v<y.length;v++){const{ngModule:x,providers:b}=y[v];El(b,S=>this.processProvider(S,x,b||gr))}}this.injectorDefTypes.add(l);const d=Wo(l)||(()=>new l);this.records.set(l,_h(d,eu));const p=r.providers;if(null!=p&&!c){const y=e;El(p,v=>this.processProvider(v,y,p))}return void 0!==o&&void 0!==e.providers}processProvider(e,t,i){let r=Na(e=Kn(e))?e:Kn(e&&e.provide);const o=function Er(n,e,t){return _y(n)?_h(void 0,n.useValue):_h(Il(n),eu)}(e);if(Na(e)||!0!==e.multi)this.records.get(r);else{let l=this.records.get(r);l||(l=_h(void 0,eu,!0),l.factory=()=>Rv(l.multi),this.records.set(r,l)),r=e,l.multi.push(e)}this.records.set(r,o)}hydrate(e,t){return t.value===eu&&(t.value=A0,t.value=t.factory()),"object"==typeof t.value&&t.value&&function RM(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Kn(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function am(n){const e=Q_(n),t=null!==e?e.factory:Wo(n);if(null!==t)return t;if(n instanceof Xn)throw new Yt(204,!1);if(n instanceof Function)return function B1(n){const e=n.length;if(e>0)throw function Mp(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new Yt(204,!1);const t=function HT(n){const e=n&&(n[wg]||n[tv]);if(e){const t=function GT(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Yt(204,!1)}function Il(n,e,t){let i;if(Na(n)){const r=Kn(n);return Wo(r)||am(r)}if(_y(n))i=()=>Kn(n.useValue);else if(function nl(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Rv(n.deps||[]));else if(function DM(n){return!(!n||!n.useExisting)}(n))i=()=>Ot(Kn(n.useExisting));else{const r=Kn(n&&(n.useClass||n.provide));if(!function lm(n){return!!n.deps}(n))return Wo(r)||am(r);i=()=>new r(...Rv(n.deps))}return i}function _h(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function _y(n){return null!==n&&"object"==typeof n&&_A in n}function Na(n){return"function"==typeof n}let Cr=(()=>{class n{static create(t,i){var r;if(Array.isArray(t))return gy({name:""},i,t,"");{const o=null!==(r=t.name)&&void 0!==r?r:"";return gy({name:o},t.parent,t.providers,o)}}}return n.THROW_IF_NOT_FOUND=Sp,n.NULL=new py,n.\u0275prov=yn({token:n,providedIn:"any",factory:()=>Ot(fy)}),n.__NG_ELEMENT_ID__=-1,n})();function kM(n,e){$u(Gv(n)[1],ds())}function Vi(n){let e=function O0(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const i=[n];for(;e;){let r;if(sa(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Yt(903,"");r=e.\u0275dir}if(r){if(t){i.push(r);const l=n;l.inputs=um(n.inputs),l.declaredInputs=um(n.declaredInputs),l.outputs=um(n.outputs);const c=r.hostBindings;c&&UM(n,c);const d=r.viewQuery,p=r.contentQueries;if(d&&B0(n,d),p&&hm(n,p),Jf(n.inputs,r.inputs),Jf(n.declaredInputs,r.declaredInputs),Jf(n.outputs,r.outputs),sa(r)&&r.data.animation){const y=n.data;y.animation=(y.animation||[]).concat(r.data.animation)}}const o=r.features;if(o)for(let l=0;l<o.length;l++){const c=o[l];c&&c.ngInherit&&c(n),c===Vi&&(t=!1)}}e=Object.getPrototypeOf(e)}!function k0(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=Fg(r.hostAttrs,t=Fg(t,r.hostAttrs))}}(i)}function um(n){return n===Hc?{}:n===gr?[]:n}function B0(n,e){const t=n.viewQuery;n.viewQuery=t?(i,r)=>{e(i,r),t(i,r)}:e}function hm(n,e){const t=n.contentQueries;n.contentQueries=t?(i,r,o)=>{e(i,r,o),t(i,r,o)}:e}function UM(n,e){const t=n.hostBindings;n.hostBindings=t?(i,r)=>{e(i,r),t(i,r)}:e}let by=null;function ef(){if(!by){const n=ji.Symbol;if(n&&n.iterator)by=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const i=e[t];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(by=i)}}}return by}function tf(n){return!!function dm(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&ef()in n)}function ro(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function fm(n,e,t,i,r){const o=function nu(n,e,t,i){const r=ro(n,e,t);return ro(n,e+1,i)||r}(n,e,t,i);return ro(n,e+2,r)||o}function bh(n,e,t,i){return ro(n,jc(),t)?e+In(t)+i:kn}function xn(n,e,t,i,r,o,l,c){const d=ot(),p=Ri(),y=n+20,v=p.firstCreatePass?function G1(n,e,t,i,r,o,l,c,d){const p=e.consts,y=$d(e,n,4,l||null,xl(p,c));w0(e,t,y,xl(p,d)),$u(e,y);const v=y.tViews=pc(2,y,i,r,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,p);return null!==e.queries&&(e.queries.template(e,y),v.queries=e.queries.embeddedTView(y)),y}(y,p,d,e,t,i,r,o,l):p.data[y];wl(v,!1);const x=d[11].createComment("");Np(p,d,x,v),yo(x,d),Zc(d,d[y]=tm(x,d,x,v)),_l(v)&&Yd(p,d,v),null!=l&&Jp(d,v,c)}function Te(n,e=Cn.Default){const t=ot();return null===t?Ot(n,e):uw(ds(),t,Kn(n),e)}function lf(){throw new Error("invalid")}function nt(n,e,t){const i=ot();return ro(i,jc(),e)&&Lo(Ri(),Wr(),i,n,e,i[11],t,!1),nt}function Y0(n,e,t,i,r){const l=r?"class":"style";yh(n,t,e.inputs[l],l,i)}function We(n,e,t,i){const r=ot(),o=Ri(),l=20+n,c=r[11],d=r[l]=Zv(c,e,function Ed(){return Qt.lFrame.currentNamespace}()),p=o.firstCreatePass?function eD(n,e,t,i,r,o,l){const c=e.consts,p=$d(e,n,2,r,xl(c,o));return w0(e,t,p,xl(c,l)),null!==p.attrs&&_c(p,p.attrs,!1),null!==p.mergedAttrs&&_c(p,p.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,p),p}(l,o,r,0,e,t,i):o.data[l];wl(p,!0);const y=p.mergedAttrs;null!==y&&Lg(c,d,y);const v=p.classes;null!==v&&rh(c,d,v);const x=p.styles;return null!==x&&Vd(c,d,x),64!=(64&p.flags)&&Np(o,r,d,p),0===function Ag(){return Qt.lFrame.elementDepthCount}()&&yo(d,r),function Ni(){Qt.lFrame.elementDepthCount++}(),_l(p)&&(Yd(o,r,p),Zp(o,p,r)),null!==i&&Jp(r,p),We}function Ne(){let n=ds();jo()?cp():(n=n.parent,wl(n,!1));const e=n;!function Zb(){Qt.lFrame.elementDepthCount--}();const t=Ri();return t.firstCreatePass&&($u(t,n),Do(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function Ku(n){return 0!=(16&n.flags)}(e)&&Y0(t,e,ot(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function ZT(n){return 0!=(32&n.flags)}(e)&&Y0(t,e,ot(),e.stylesWithoutHost,!1),Ne}function ur(n,e,t,i){return We(n,e,t,i),Ne(),ur}function K0(n,e,t){const i=ot(),r=Ri(),o=n+20,l=r.firstCreatePass?function rS(n,e,t,i,r){const o=e.consts,l=xl(o,i),c=$d(e,n,8,"ng-container",l);return null!==l&&_c(c,l,!0),w0(e,t,c,xl(o,r)),null!==e.queries&&e.queries.elementStart(e,c),c}(o,r,i,e,t):r.data[o];wl(l,!0);const c=i[o]=i[11].createComment("");return Np(r,i,c,l),yo(c,i),_l(l)&&(Yd(r,i,l),Zp(r,l,i)),null!=t&&Jp(i,l),K0}function Z0(){let n=ds();const e=Ri();return jo()?cp():(n=n.parent,wl(n,!1)),e.firstCreatePass&&($u(e,n),Do(n)&&e.queries.elementEnd(n)),Z0}function Ay(n,e,t){return K0(n,e,t),Z0(),Ay}function zi(){return ot()}function cf(n){return!!n&&"function"==typeof n.then}const fa=function Ua(n){return!!n&&"function"==typeof n.subscribe};function Ft(n,e,t,i){const r=ot(),o=Ri(),l=ds();return function oS(n,e,t,i,r,o,l,c){const d=_l(i),y=n.firstCreatePass&&Jc(n),v=e[8],x=gh(e);let b=!0;if(3&i.type||c){const T=hs(i,e),N=c?c(T):T,F=x.length,U=c?k=>c(us(k[i.index])):i.index;if(kr(t)){let k=null;if(!c&&d&&(k=function sS(n,e,t,i){const r=n.cleanup;if(null!=r)for(let o=0;o<r.length-1;o+=2){const l=r[o];if(l===t&&r[o+1]===i){const c=e[7],d=r[o+2];return c.length>d?c[d]:null}"string"==typeof l&&(o+=2)}return null}(n,e,r,i.index)),null!==k)(k.__ngLastListenerFn__||k).__ngNextListenerFn__=o,k.__ngLastListenerFn__=o,b=!1;else{o=J0(i,e,v,o,!1);const H=t.listen(N,r,o);x.push(o,H),y&&y.push(r,U,F,F+1)}}else o=J0(i,e,v,o,!0),N.addEventListener(r,o,l),x.push(o),y&&y.push(r,U,F,l)}else o=J0(i,e,v,o,!1);const S=i.outputs;let E;if(b&&null!==S&&(E=S[r])){const T=E.length;if(T)for(let N=0;N<T;N+=2){const Q=e[E[N]][E[N+1]].subscribe(o),ie=x.length;x.push(o,Q),y&&y.push(r,i.index,ie,-(ie+1))}}}(o,r,r[11],l,n,e,!!t,i),Ft}function aS(n,e,t,i){try{return!1!==t(i)}catch(r){return Qc(n,r),!1}}function J0(n,e,t,i,r){return function o(l){if(l===Function)return i;const c=2&n.flags?Ns(n.index,e):e;0==(32&e[2])&&im(c);let d=aS(e,0,i,l),p=o.__ngNextListenerFn__;for(;p;)d=aS(e,0,p,l)&&d,p=p.__ngNextListenerFn__;return r&&!1===d&&(l.preventDefault(),l.returnValue=!1),d}}function Oe(n=1){return function oc(n){return(Qt.lFrame.contextLView=function Sd(n,e){for(;n>0;)e=e[15],n--;return e}(n,Qt.lFrame.contextLView))[8]}(n)}function $o(n,e,t){return Q0(n,"",e,"",t),$o}function Q0(n,e,t,i,r){const o=ot(),l=bh(o,e,t,i);return l!==kn&&Lo(Ri(),Wr(),o,n,l,o[11],r,!1),Q0}function gS(n,e,t,i,r){const o=n[t+1],l=null===e;let c=i?La(o):Tl(o),d=!1;for(;0!==c&&(!1===d||l);){const y=n[c+1];oD(n[c],e)&&(d=!0,n[c+1]=i?uc(y):l0(y)),c=i?La(y):Tl(y)}d&&(n[t+1]=i?l0(o):uc(o))}function oD(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&Nd(n,e)>=0}const Ts={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function yS(n){return n.substring(Ts.key,Ts.keyEnd)}function _S(n,e){const t=Ts.textEnd;return t===e?-1:(e=Ts.keyEnd=function uD(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}(n,Ts.key=e,t),uf(n,e,t))}function uf(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function Qr(n,e,t){return f(n,e,t,!1),Qr}function hf(n,e){return f(n,e,null,!0),hf}function Ch(n){s(la,Nl,n,!0)}function Nl(n,e){for(let t=function lD(n){return function xS(n){Ts.key=0,Ts.keyEnd=0,Ts.value=0,Ts.valueEnd=0,Ts.textEnd=n.length}(n),_S(n,uf(n,0,Ts.textEnd))}(e);t>=0;t=_S(e,t))la(n,yS(e),!0)}function f(n,e,t,i){const r=ot(),o=Ri(),l=mo(2);o.firstUpdatePass&&u(o,n,l,i),e!==kn&&ro(r,l,e)&&R(o,o.data[rr()],r,r[11],n,r[l+1]=function I(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Zi(ca(n)))),n}(e,t),i,l)}function s(n,e,t,i){const r=Ri(),o=mo(2);r.firstUpdatePass&&u(r,null,o,i);const l=ot();if(t!==kn&&ro(l,o,t)){const c=r.data[rr()];if(z(c,i)&&!a(r,o)){let d=i?c.classesWithoutHost:c.stylesWithoutHost;null!==d&&(t=Qf(d,t||"")),Y0(r,c,l,t,i)}else!function D(n,e,t,i,r,o,l,c){r===kn&&(r=gr);let d=0,p=0,y=0<r.length?r[0]:null,v=0<o.length?o[0]:null;for(;null!==y||null!==v;){const x=d<r.length?r[d+1]:void 0,b=p<o.length?o[p+1]:void 0;let E,S=null;y===v?(d+=2,p+=2,x!==b&&(S=v,E=b)):null===v||null!==y&&y<v?(d+=2,S=y):(p+=2,S=v,E=b),null!==S&&R(n,e,t,i,S,E,l,c),y=d<r.length?r[d]:null,v=p<o.length?o[p]:null}}(r,c,l,l[11],l[o+1],l[o+1]=function C(n,e,t){if(null==t||""===t)return gr;const i=[],r=ca(t);if(Array.isArray(r))for(let o=0;o<r.length;o++)n(i,r[o],!0);else if("object"==typeof r)for(const o in r)r.hasOwnProperty(o)&&n(i,o,r[o]);else"string"==typeof r&&e(i,r);return i}(n,e,t),i,o)}}function a(n,e){return e>=n.expandoStartIndex}function u(n,e,t,i){const r=n.data;if(null===r[t+1]){const o=r[rr()],l=a(n,t);z(o,i)&&null===e&&!l&&(e=!1),e=function h(n,e,t,i){const r=function wd(n){const e=Qt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let o=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(t=M(t=w(null,n,e,t,i),e.attrs,i),o=null);else{const l=e.directiveStylingLast;if(-1===l||n[l]!==r)if(t=w(r,n,e,t,i),null===o){let d=function m(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==Tl(i))return n[La(i)]}(n,e,i);void 0!==d&&Array.isArray(d)&&(d=w(null,n,e,d[1],i),d=M(d,e.attrs,i),function g(n,e,t,i){n[La(t?e.classBindings:e.styleBindings)]=i}(n,e,i,d))}else o=function _(n,e,t){let i;const r=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<r;o++)i=M(i,n[o].hostAttrs,t);return M(i,e.attrs,t)}(n,e,i)}return void 0!==o&&(i?e.residualClasses=o:e.residualStyles=o),t}(r,o,e,i),function rD(n,e,t,i,r,o){let l=o?e.classBindings:e.styleBindings,c=La(l),d=Tl(l);n[i]=t;let y,p=!1;if(Array.isArray(t)){const v=t;y=v[1],(null===y||Nd(v,y)>0)&&(p=!0)}else y=t;if(r)if(0!==d){const x=La(n[c+1]);n[i+1]=qp(x,c),0!==x&&(n[x+1]=Wd(n[x+1],i)),n[c+1]=function fM(n,e){return 131071&n|e<<17}(n[c+1],i)}else n[i+1]=qp(c,0),0!==c&&(n[c+1]=Wd(n[c+1],i)),c=i;else n[i+1]=qp(d,0),0===c?c=i:n[d+1]=Wd(n[d+1],i),d=i;p&&(n[i+1]=l0(n[i+1])),gS(n,y,i,!0),gS(n,y,i,!1),function sD(n,e,t,i,r){const o=r?n.residualClasses:n.residualStyles;null!=o&&"string"==typeof e&&Nd(o,e)>=0&&(t[i+1]=uc(t[i+1]))}(e,y,n,i,o),l=qp(c,d),o?e.classBindings=l:e.styleBindings=l}(r,o,e,t,l,i)}}function w(n,e,t,i,r){let o=null;const l=t.directiveEnd;let c=t.directiveStylingLast;for(-1===c?c=t.directiveStart:c++;c<l&&(o=e[c],i=M(i,o.hostAttrs,r),o!==n);)c++;return null!==n&&(t.directiveStylingLast=c),i}function M(n,e,t){const i=t?1:2;let r=-1;if(null!==e)for(let o=0;o<e.length;o++){const l=e[o];"number"==typeof l?r=l:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),la(n,l,!!t||e[++o]))}return void 0===n?null:n}function R(n,e,t,i,r,o,l,c){if(!(3&e.type))return;const d=n.data,p=d[c+1];P(function jp(n){return 1==(1&n)}(p)?L(d,e,t,r,Tl(p),l):void 0)||(P(o)||function a0(n){return 2==(2&n)}(p)&&(o=L(d,null,t,r,c,l)),function cM(n,e,t,i,r){const o=kr(n);if(e)r?o?n.addClass(t,i):t.classList.add(i):o?n.removeClass(t,i):t.classList.remove(i);else{let l=-1===i.indexOf("-")?void 0:ua.DashCase;if(null==r)o?n.removeStyle(t,i,l):t.style.removeProperty(i);else{const c="string"==typeof r&&r.endsWith("!important");c&&(r=r.slice(0,-10),l|=ua.Important),o?n.setStyle(t,i,r,l):t.style.setProperty(i,r,c?"important":"")}}}(i,l,qo(rr(),t),r,o))}function L(n,e,t,i,r,o){const l=null===e;let c;for(;r>0;){const d=n[r],p=Array.isArray(d),y=p?d[1]:d,v=null===y;let x=t[r+1];x===kn&&(x=v?gr:void 0);let b=v?Tv(x,i):y===i?x:void 0;if(p&&!P(b)&&(b=Tv(d,i)),P(b)&&(c=b,l))return c;const S=n[r+1];r=l?La(S):Tl(S)}if(null!==e){let d=o?e.residualClasses:e.residualStyles;null!=d&&(c=Tv(d,i))}return c}function P(n){return void 0!==n}function z(n,e){return 0!=(n.flags&(e?16:32))}function B(n,e=""){const t=ot(),i=Ri(),r=n+20,o=i.firstCreatePass?$d(i,r,1,e,null):i.data[r],l=t[r]=function Kv(n,e){return kr(n)?n.createText(e):n.createTextNode(e)}(t[11],e);Np(i,t,l,o),wl(o,!1)}function j(n){return G("",n,""),j}function G(n,e,t){const i=ot(),r=bh(i,n,e,t);return r!==kn&&Xo(i,rr(),r),G}const ne=void 0;var Ge=["en",[["a","p"],["AM","PM"],ne],[["AM","PM"],ne,ne],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ne,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ne,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ne,"{1} 'at' {0}",ne],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function K(n){const t=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===i?1:5}];let pt={};function Ct(n){const e=function me(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=ri(e);if(t)return t;const i=e.split("-")[0];if(t=ri(i),t)return t;if("en"===i)return Ge;throw new Error(`Missing locale data for the locale "${n}".`)}function ri(n){return n in pt||(pt[n]=ji.ng&&ji.ng.common&&ji.ng.common.locales&&ji.ng.common.locales[n]),pt[n]}var ke=(()=>((ke=ke||{})[ke.LocaleId=0]="LocaleId",ke[ke.DayPeriodsFormat=1]="DayPeriodsFormat",ke[ke.DayPeriodsStandalone=2]="DayPeriodsStandalone",ke[ke.DaysFormat=3]="DaysFormat",ke[ke.DaysStandalone=4]="DaysStandalone",ke[ke.MonthsFormat=5]="MonthsFormat",ke[ke.MonthsStandalone=6]="MonthsStandalone",ke[ke.Eras=7]="Eras",ke[ke.FirstDayOfWeek=8]="FirstDayOfWeek",ke[ke.WeekendRange=9]="WeekendRange",ke[ke.DateFormat=10]="DateFormat",ke[ke.TimeFormat=11]="TimeFormat",ke[ke.DateTimeFormat=12]="DateTimeFormat",ke[ke.NumberSymbols=13]="NumberSymbols",ke[ke.NumberFormats=14]="NumberFormats",ke[ke.CurrencyCode=15]="CurrencyCode",ke[ke.CurrencySymbol=16]="CurrencySymbol",ke[ke.CurrencyName=17]="CurrencyName",ke[ke.Currencies=18]="Currencies",ke[ke.Directionality=19]="Directionality",ke[ke.PluralCase=20]="PluralCase",ke[ke.ExtraData=21]="ExtraData",ke))();const Fn="en-US";let Pi=Fn;function _D(n,e,t,i,r){if(n=Kn(n),Array.isArray(n))for(let o=0;o<n.length;o++)_D(n[o],e,t,i,r);else{const o=Ri(),l=ot();let c=Na(n)?n:Kn(n.provide),d=Il(n);const p=ds(),y=1048575&p.providerIndexes,v=p.directiveStart,x=p.providerIndexes>>20;if(Na(n)||!n.multi){const b=new Sl(d,r,Te),S=xD(c,e,r?y:y+x,v);-1===S?(kg(_p(p,l),o,c),vD(o,n,e.length),e.push(c),p.directiveStart++,p.directiveEnd++,r&&(p.providerIndexes+=1048576),t.push(b),l.push(b)):(t[S]=b,l[S]=b)}else{const b=xD(c,e,y+x,v),S=xD(c,e,y,y+x),E=b>=0&&t[b],T=S>=0&&t[S];if(r&&!T||!r&&!E){kg(_p(p,l),o,c);const N=function $H(n,e,t,i,r){const o=new Sl(n,t,Te);return o.multi=[],o.index=e,o.componentProviders=0,eF(o,r,i&&!t),o}(r?XH:jH,t.length,r,i,d);!r&&T&&(t[S].providerFactory=N),vD(o,n,e.length,0),e.push(c),p.directiveStart++,p.directiveEnd++,r&&(p.providerIndexes+=1048576),t.push(N),l.push(N)}else vD(o,n,b>-1?b:S,eF(t[r?S:b],d,!r&&i));!r&&i&&T&&t[S].componentProviders++}}}function vD(n,e,t,i){const r=Na(e),o=function R0(n){return!!n.useClass}(e);if(r||o){const d=(o?Kn(e.useClass):e).prototype.ngOnDestroy;if(d){const p=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){const y=p.indexOf(t);-1===y?p.push(t,[i,d]):p[y+1].push(i,d)}else p.push(t,d)}}}function eF(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function xD(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function jH(n,e,t,i){return bD(this.multi,[])}function XH(n,e,t,i){const r=this.multi;let o;if(this.providerFactory){const l=this.providerFactory.componentProviders,c=vp(t,t[1],this.providerFactory.index,i);o=c.slice(0,l),bD(r,o);for(let d=l;d<c.length;d++)o.push(c[d])}else o=[],bD(r,o);return o}function bD(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function Xr(n,e=[]){return t=>{t.providersResolver=(i,r)=>function qH(n,e,t){const i=Ri();if(i.firstCreatePass){const r=sa(n);_D(t,i.data,i.blueprint,r,!0),_D(e,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,e)}}class tF{}class ZH{resolveComponentFactory(e){throw function KH(n){const e=Error(`No component factory found for ${Zi(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let Iy=(()=>{class n{}return n.NULL=new ZH,n})();function JH(){return Ly(ds(),ot())}function Ly(n,e){return new Yo(hs(n,e))}let Yo=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=JH,n})();function QH(n){return n instanceof Yo?n.nativeElement:n}class nx{}let Rh=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function tG(){const n=ot(),t=Ns(ds().index,n);return function eG(n){return n[11]}(Ca(t)?t:n)}(),n})(),nG=(()=>{class n{}return n.\u0275prov=yn({token:n,providedIn:"root",factory:()=>null}),n})();class ix{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const iG=new ix("13.3.11"),wD={};function TS(n,e,t,i,r=!1){for(;null!==t;){const o=e[t.index];if(null!==o&&i.push(us(o)),Ta(o))for(let c=10;c<o.length;c++){const d=o[c],p=d[1].firstChild;null!==p&&TS(d[1],d,p,i)}const l=t.type;if(8&l)TS(n,e,t.child,i);else if(32&l){const c=Yg(t,e);let d;for(;d=c();)i.push(d)}else if(16&l){const c=Yc(e,t);if(Array.isArray(c))i.push(...c);else{const d=eh(e[16]);TS(d[1],d,c,i,!0)}}t=r?t.projectionNext:t.next}return i}class rx{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return TS(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Ta(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(Jv(e,i),Ug(t,i))}this._attachedToViewContainer=!1}Qv(this._lView[1],this._lView)}onDestroy(e){dh(this._lView[1],this._lView,null,e)}markForCheck(){im(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function dy(n,e,t){const i=e[10];i.begin&&i.begin();try{Rl(n,e,n.template,t)}catch(r){throw Qc(e,r),r}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Yt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function l1(n,e){kp(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Yt(902,"");this._appRef=e}}class rG extends rx{constructor(e){super(e),this._view=e}detectChanges(){E0(this._view)}checkNoChanges(){}get context(){return null}}class iF extends Iy{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=fo(e);return new MD(t,this.ngModule)}}function rF(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class MD extends tF{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function s0(n){return n.map(hM).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return rF(this.componentDef.inputs)}get outputs(){return rF(this.componentDef.outputs)}create(e,t,i,r){const o=(r=r||this.ngModule)?function oG(n,e){return{get:(t,i,r)=>{const o=n.get(t,wD,r);return o!==wD||i===wD?o:e.get(t,i,r)}}}(e,r.injector):e,l=o.get(nx,hv),c=o.get(nG,null),d=l.createRenderer(null,this.componentDef),p=this.componentDef.selectors[0][0]||"div",y=i?function mc(n,e,t){if(kr(n))return n.selectRootElement(e,t===Ho.ShadowDom);let i="string"==typeof e?n.querySelector(e):e;return i.textContent="",i}(d,i,this.componentDef.encapsulation):Zv(l.createRenderer(null,this.componentDef),p,function sG(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(p)),v=this.componentDef.onPush?576:528,x=function vy(n,e){return{components:[],scheduler:n||$c,clean:mh,playerHandler:e||null,flags:0}}(),b=pc(0,null,null,1,0,null,null,null,null,null),S=Yp(null,b,x,v,null,null,l,d,c,o);let E,T;ju(S);try{const N=function N0(n,e,t,i,r,o){const l=t[1];t[20]=n;const d=$d(l,20,2,"#host",null),p=d.mergedAttrs=e.hostAttrs;null!==p&&(_c(d,p,!0),null!==n&&(Lg(r,n,p),null!==d.classes&&rh(r,n,d.classes),null!==d.styles&&Vd(r,n,d.styles)));const y=i.createRenderer(n,e),v=Yp(t,v0(e),null,e.onPush?64:16,t[20],d,i,y,o||null,null);return l.firstCreatePass&&(kg(_p(d,t),l,e.type),SM(l,d),EM(d,t.length,1)),Zc(t,v),t[20]=v}(y,this.componentDef,S,l,d);if(y)if(i)Lg(d,y,["ng-version",iG.full]);else{const{attrs:F,classes:U}=function dM(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let o=n[i];if("string"==typeof o)2===r?""!==o&&e.push(o,n[++i]):8===r&&t.push(o);else{if(!vo(r))break;r=o}i++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);F&&Lg(d,y,F),U&&U.length>0&&rh(d,y,U.join(" "))}if(T=Qa(b,20),void 0!==t){const F=T.projection=[];for(let U=0;U<this.ngContentSelectors.length;U++){const k=t[U];F.push(null!=k?Array.from(k):null)}}E=function Qd(n,e,t,i,r){const o=t[1],l=function em(n,e,t){const i=ds();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),cy(n,i,e,fc(n,e,1,null),t));const r=vp(e,n,i.directiveStart,i);yo(r,e);const o=hs(i,e);return o&&yo(o,e),r}(o,t,e);if(i.components.push(l),n[8]=l,r&&r.forEach(d=>d(l,e)),e.contentQueries){const d=ds();e.contentQueries(1,l,d.directiveStart)}const c=ds();return!o.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(ac(c.index),wM(t[1],c,0,c.directiveStart,c.directiveEnd,e),MM(e,l)),l}(N,this.componentDef,S,x,[kM]),ch(b,S,null)}finally{Xu()}return new lG(this.componentType,E,Ly(T,S),S,T)}}class lG extends class YH{}{constructor(e,t,i,r,o){super(),this.location=i,this._rootLView=r,this._tNode=o,this.instance=t,this.hostView=this.changeDetectorRef=new rG(r),this.componentType=e}get injector(){return new Rd(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class Ph{}class sF{}const Fy=new Map;class lF extends Ph{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new iF(this);const i=ir(e);this._bootstrapComponents=tl(i.bootstrap),this._r3Injector=yy(e,t,[{provide:Ph,useValue:this},{provide:Iy,useValue:this.componentFactoryResolver}],Zi(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=Cr.THROW_IF_NOT_FOUND,i=Cn.Default){return e===Cr||e===Ph||e===fy?this:this._r3Injector.get(e,t,i)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class SD extends sF{constructor(e){super(),this.moduleType=e,null!==ir(e)&&function uG(n){const e=new Set;!function t(i){const r=ir(i,!0),o=r.id;null!==o&&(function oF(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${Zi(e)} vs ${Zi(e.name)}`)}(o,Fy.get(o),i),Fy.set(o,i));const l=tl(r.imports);for(const c of l)e.has(c)||(e.add(c),t(c))}(n)}(e)}create(e){return new lF(this.moduleType,e)}}function hF(n,e,t,i,r,o,l,c){const d=e+t;return fm(n,d,r,o,l)?function rl(n,e,t){return n[e]=t}(n,d+3,c?i.call(c,r,o,l):i(r,o,l)):function sx(n,e){const t=n[e];return t===kn?void 0:t}(n,d+3)}function mF(n,e,t,i,r){const o=n+20,l=ot(),c=function el(n,e){return n[e]}(l,o);return function ox(n,e){return n[1].data[e].pure}(l,o)?hF(l,function en(){const n=Qt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}(),e,c.transform,t,i,r,c):c.transform(t,i,r)}function ED(n){return e=>{setTimeout(n,void 0,e)}}const wi=class CG extends zt{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){var r,o,l;let c=e,d=t||(()=>null),p=i;if(e&&"object"==typeof e){const v=e;c=null===(r=v.next)||void 0===r?void 0:r.bind(v),d=null===(o=v.error)||void 0===o?void 0:o.bind(v),p=null===(l=v.complete)||void 0===l?void 0:l.bind(v)}this.__isAsync&&(d=ED(d),c&&(c=ED(c)),p&&(p=ED(p)));const y=super.subscribe({next:c,error:d,complete:p});return e instanceof An&&e.add(y),y}};function TG(){return this._results[ef()]()}class CD{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=ef(),i=CD.prototype;i[t]||(i[t]=TG)}get changes(){return this._changes||(this._changes=new wi)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=Pa(e);(this._changesDetected=!function aA(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=e[i];if(t&&(r=t(r),o=t(o)),o!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Ih=(()=>{class n{}return n.__NG_ELEMENT_ID__=RG,n})();const AG=Ih,DG=class extends AG{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e){const t=this._declarationTContainer.tViews,i=Yp(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(i[19]=o.createEmbeddedView(t)),ch(t,i,e),new rx(i)}};function RG(){return AS(ds(),ot())}function AS(n,e){return 4&n.type?new DG(e,n,Ly(n,e)):null}let Ul=(()=>{class n{}return n.__NG_ELEMENT_ID__=PG,n})();function PG(){return _F(ds(),ot())}const IG=Ul,gF=class extends IG{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Ly(this._hostTNode,this._hostLView)}get injector(){return new Rd(this._hostTNode,this._hostLView)}get parentInjector(){const e=Og(this._hostTNode,this._hostLView);if(sw(e)){const t=Dd(e,this._hostLView),i=Ad(e);return new Rd(t[1].data[i+8],t)}return new Rd(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=yF(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,i){const r=e.createEmbeddedView(t||{});return this.insert(r,i),r}createComponent(e,t,i,r,o){const l=e&&!function wp(n){return"function"==typeof n}(e);let c;if(l)c=t;else{const v=t||{};c=v.index,i=v.injector,r=v.projectableNodes,o=v.ngModuleRef}const d=l?e:new MD(fo(e)),p=i||this.parentInjector;if(!o&&null==d.ngModule){const x=(l?p:this.parentInjector).get(Ph,null);x&&(o=x)}const y=d.create(p,r,void 0,o);return this.insert(y.hostView,c),y}insert(e,t){const i=e._lView,r=i[1];if(function pv(n){return Ta(n[3])}(i)){const y=this.indexOf(e);if(-1!==y)this.detach(y);else{const v=i[3],x=new gF(v,v[6],v[3]);x.detach(x.indexOf(e))}}const o=this._adjustIndex(t),l=this._lContainer;!function u1(n,e,t,i){const r=10+i,o=t.length;i>0&&(t[r-1][4]=e),i<o-10?(e[4]=t[r],mw(t,10+i,e)):(t.push(e),e[4]=null),e[3]=t;const l=e[17];null!==l&&t!==l&&function h1(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(l,e);const c=e[19];null!==c&&c.insertView(n),e[2]|=128}(r,i,l,o);const c=r0(o,l),d=i[11],p=ih(d,l[7]);return null!==p&&function a1(n,e,t,i,r,o){i[0]=r,i[6]=e,kp(n,i,t,1,r,o)}(r,l[6],d,i,p,c),e.attachToViewContainerRef(),mw(TD(l),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=yF(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=Jv(this._lContainer,t);i&&(Ug(TD(this._lContainer),t),Qv(i[1],i))}detach(e){const t=this._adjustIndex(e,-1),i=Jv(this._lContainer,t);return i&&null!=Ug(TD(this._lContainer),t)?new rx(i):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function yF(n){return n[8]}function TD(n){return n[8]||(n[8]=[])}function _F(n,e){let t;const i=e[n.index];if(Ta(i))t=i;else{let r;if(8&n.type)r=us(i);else{const o=e[11];r=o.createComment("");const l=hs(n,e);nh(o,ih(o,l),r,function Jg(n,e){return kr(n)?n.nextSibling(e):e.nextSibling}(o,l),!1)}e[n.index]=t=tm(i,e,r,n),Zc(e,t)}return new gF(t,n,e)}class AD{constructor(e){this.queryList=e,this.matches=null}clone(){return new AD(this.queryList)}setDirty(){this.queryList.setDirty()}}class DD{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let o=0;o<i;o++){const l=t.getByIndex(o);r.push(this.queries[l.indexInDeclarationView].clone())}return new DD(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==MF(e,t).matches&&this.queries[t].setDirty()}}class vF{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class RD{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,o=this.getByIndex(i).embeddedTView(e,r);o&&(o.indexInDeclarationView=i,null!==t?t.push(o):t=[o])}return null!==t?new RD(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class PD{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new PD(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const o=i[r];this.matchTNodeWithReadOption(e,t,NG(t,o)),this.matchTNodeWithReadOption(e,t,Bg(t,e,o,!1,!1))}else i===Ih?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Bg(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Yo||r===Ul||r===Ih&&4&t.type)this.addMatch(t.index,-2);else{const o=Bg(t,e,r,!1,!1);null!==o&&this.addMatch(t.index,o)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function NG(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function kG(n,e,t,i){return-1===t?function OG(n,e){return 11&n.type?Ly(n,e):4&n.type?AS(n,e):null}(e,n):-2===t?function BG(n,e,t){return t===Yo?Ly(e,n):t===Ih?AS(e,n):t===Ul?_F(e,n):void 0}(n,e,i):vp(n,n[1],t,e)}function xF(n,e,t,i){const r=e[19].queries[i];if(null===r.matches){const o=n.data,l=t.matches,c=[];for(let d=0;d<l.length;d+=2){const p=l[d];c.push(p<0?null:kG(e,o[p],l[d+1],t.metadata.read))}r.matches=c}return r.matches}function ID(n,e,t,i){const r=n.queries.getByIndex(t),o=r.matches;if(null!==o){const l=xF(n,e,r,t);for(let c=0;c<o.length;c+=2){const d=o[c];if(d>0)i.push(l[c/2]);else{const p=o[c+1],y=e[-d];for(let v=10;v<y.length;v++){const x=y[v];x[17]===x[3]&&ID(x[1],x,p,i)}if(null!==y[9]){const v=y[9];for(let x=0;x<v.length;x++){const b=v[x];ID(b[1],b,p,i)}}}}}return i}function _m(n){const e=ot(),t=Ri(),i=dp();Md(i+1);const r=MF(t,i);if(n.dirty&&fv(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const o=r.crossesNgTemplate?ID(t,e,i,[]):xF(t,e,r,i);n.reset(o,QH),n.notifyOnChanges()}return!0}return!1}function ax(n,e,t){const i=Ri();i.firstCreatePass&&(function wF(n,e,t){null===n.queries&&(n.queries=new RD),n.queries.track(new PD(e,t))}(i,new vF(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),function bF(n,e,t){const i=new CD(4==(4&t));dh(n,e,i,i.destroy),null===e[19]&&(e[19]=new DD),e[19].queries.push(new AD(i))}(i,ot(),e)}function vm(){return function UG(n,e){return n[19].queries[e].queryList}(ot(),dp())}function MF(n,e){return n.queries.getByIndex(e)}function PS(...n){}const UD=new Xn("Application Initializer");let VD=(()=>{class n{constructor(t){this.appInits=t,this.resolve=PS,this.reject=PS,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const o=this.appInits[r]();if(cf(o))t.push(o);else if(fa(o)){const l=new Promise((c,d)=>{o.subscribe({complete:c,error:d})});t.push(l)}}Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(Ot(UD,8))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const cx=new Xn("AppId",{providedIn:"root",factory:function VF(){return`${zD()}${zD()}${zD()}`}});function zD(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const zF=new Xn("Platform Initializer"),ux=new Xn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),HF=new Xn("appBootstrapListener");let r4=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const ff=new Xn("LocaleId",{providedIn:"root",factory:()=>xA(ff,Cn.Optional|Cn.SkipSelf)||function s4(){return"undefined"!=typeof $localize&&$localize.locale||Fn}()});class a4{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let GF=(()=>{class n{compileModuleSync(t){return new SD(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),o=tl(ir(t).declarations).reduce((l,c)=>{const d=fo(c);return d&&l.push(new MD(d)),l},[]);return new a4(i,o)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const c4=(()=>Promise.resolve(0))();function HD(n){"undefined"==typeof Zone?c4.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class As{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new wi(!1),this.onMicrotaskEmpty=new wi(!1),this.onStable=new wi(!1),this.onError=new wi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function u4(){let n=ji.requestAnimationFrame,e=ji.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function f4(n){const e=()=>{!function d4(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(ji,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,WD(n),n.isCheckStableRunning=!0,GD(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),WD(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,o,l,c)=>{try{return WF(n),t.invokeTask(r,o,l,c)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),qF(n)}},onInvoke:(t,i,r,o,l,c,d)=>{try{return WF(n),t.invoke(r,o,l,c,d)}finally{n.shouldCoalesceRunChangeDetection&&e(),qF(n)}},onHasTask:(t,i,r,o)=>{t.hasTask(r,o),i===r&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,WD(n),GD(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(t,i,r,o)=>(t.handleError(r,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(r)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!As.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(As.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const o=this._inner,l=o.scheduleEventTask("NgZoneEvent: "+r,e,h4,PS,PS);try{return o.runTask(l,t,i)}finally{o.cancelTask(l)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const h4={};function GD(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function WD(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function WF(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function qF(n){n._nesting--,GD(n)}class p4{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new wi,this.onMicrotaskEmpty=new wi,this.onStable=new wi,this.onError=new wi}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}let qD=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{As.assertNotInAngularZone(),HD(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())HD(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(l=>l.timeoutId!==o),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(Ot(As))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),m4=(()=>{class n{constructor(){this._applications=new Map,jD.addToWindow(this)}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return jD.findTestabilityInTree(this,t,i)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();class g4{addToWindow(e){}findTestabilityInTree(e,t,i){return null}}let jD=new g4,xm=null;const jF=new Xn("AllowMultipleToken"),XF=new Xn("PlatformOnDestroy");class $F{constructor(e,t){this.name=e,this.token=t}}function YF(n,e,t=[]){const i=`Platform: ${e}`,r=new Xn(i);return(o=[])=>{let l=XD();if(!l||l.injector.get(jF,!1)){const c=[...t,...o,{provide:r,useValue:!0}];n?n(c):function x4(n){if(xm&&!xm.get(jF,!1))throw new Yt(400,"");xm=n;const e=n.get(KF),t=n.get(zF,null);t&&t.forEach(i=>i())}(function w4(n=[],e){return Cr.create({name:e,providers:[{provide:sm,useValue:"platform"},{provide:XF,useValue:()=>xm=null},...n]})}(c,i))}return function b4(n){const e=XD();if(!e)throw new Yt(401,"");return e}()}}function XD(){var n;return null!==(n=null==xm?void 0:xm.get(KF))&&void 0!==n?n:null}let KF=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const c=function M4(n,e){let t;return t="noop"===n?new p4:("zone.js"===n?void 0:n)||new As({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),d=[{provide:As,useValue:c}];return c.run(()=>{const p=Cr.create({providers:d,parent:this.injector,name:t.moduleType.name}),y=t.create(p),v=y.injector.get(Fp,null);if(!v)throw new Yt(402,"");return c.runOutsideAngular(()=>{const x=c.onError.subscribe({next:b=>{v.handleError(b)}});y.onDestroy(()=>{$D(this._modules,y),x.unsubscribe()})}),function S4(n,e,t){try{const i=t();return cf(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(v,c,()=>{const x=y.injector.get(VD);return x.runInitializers(),x.donePromise.then(()=>(function Ol(n){ia(n,"Expected localeId to be defined"),"string"==typeof n&&(Pi=n.toLowerCase().replace(/_/g,"-"))}(y.injector.get(ff,Fn)||Fn),this._moduleDoBootstrap(y),y))})})}bootstrapModule(t,i=[]){const r=ZF({},i);return function _4(n,e,t){const i=new SD(t);return Promise.resolve(i)}(0,0,t).then(o=>this.bootstrapModuleFactory(o,r))}_moduleDoBootstrap(t){const i=t.injector.get(IS);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new Yt(403,"");t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Yt(404,"");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(XF,null);null==t||t(),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Ot(Cr))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function ZF(n,e){return Array.isArray(e)?e.reduce(ZF,n):Object.assign(Object.assign({},n),e)}let IS=(()=>{class n{constructor(t,i,r,o){this._zone=t,this._injector=i,this._exceptionHandler=r,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const l=new pr(d=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{d.next(this._stable),d.complete()})}),c=new pr(d=>{let p;this._zone.runOutsideAngular(()=>{p=this._zone.onStable.subscribe(()=>{As.assertNotInAngularZone(),HD(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,d.next(!0))})})});const y=this._zone.onUnstable.subscribe(()=>{As.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{d.next(!1)}))});return()=>{p.unsubscribe(),y.unsubscribe()}});this.isStable=function K_(...n){const e=xa(n),t=function ku(n,e){return"number"==typeof Is(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?pe(i[0]):Ui(t)(ss(i,e)):zn}(l,c.pipe(xg()))}bootstrap(t,i){if(!this._initStatus.done)throw new Yt(405,"");let r;r=t instanceof tF?t:this._injector.get(Iy).resolveComponentFactory(t),this.componentTypes.push(r.componentType);const o=function v4(n){return n.isBoundToModule}(r)?void 0:this._injector.get(Ph),c=r.create(Cr.NULL,[],i||r.selector,o),d=c.location.nativeElement,p=c.injector.get(qD,null),y=p&&c.injector.get(m4);return p&&y&&y.registerApplication(d,p),c.onDestroy(()=>{this.detachView(c.hostView),$D(this.components,c),y&&y.unregisterApplication(d)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new Yt(101,"");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;$D(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(HF,[]).concat(this._bootstrapListeners).forEach(r=>r(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(Ot(As),Ot(Cr),Ot(Fp),Ot(VD))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function $D(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let QF=!0,hx=(()=>{class n{}return n.__NG_ELEMENT_ID__=T4,n})();function T4(n){return function A4(n,e,t){if(Aa(n)&&!t){const i=Ns(n.index,e);return new rx(i,i)}return 47&n.type?new rx(e[16],e):null}(ds(),ot(),16==(16&n))}class rN{constructor(){}supports(e){return tf(e)}create(e){return new F4(e)}}const L4=(n,e)=>e;class F4{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||L4}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,o=null;for(;t||i;){const l=!i||t&&t.currentIndex<oN(i,r,o)?t:i,c=oN(l,r,o),d=l.currentIndex;if(l===i)r--,i=i._nextRemoved;else if(t=t._next,null==l.previousIndex)r++;else{o||(o=[]);const p=c-r,y=d-r;if(p!=y){for(let x=0;x<p;x++){const b=x<o.length?o[x]:o[x]=0,S=b+x;y<=S&&S<p&&(o[x]=b+1)}o[l.previousIndex]=y-p}}c!==d&&e(l,c,d)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!tf(e))throw new Yt(900,"");return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,o,l,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let c=0;c<this.length;c++)o=e[c],l=this._trackByFn(c,o),null!==t&&Object.is(t.trackById,l)?(i&&(t=this._verifyReinsertion(t,o,l,c)),Object.is(t.item,o)||this._addIdentityChange(t,o)):(t=this._mismatch(t,o,l,c),i=!0),t=t._next}else r=0,function wy(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[ef()]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,c=>{l=this._trackByFn(r,c),null!==t&&Object.is(t.trackById,l)?(i&&(t=this._verifyReinsertion(t,c,l,r)),Object.is(t.item,c)||this._addIdentityChange(t,c)):(t=this._mismatch(t,c,l,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,r)):e=this._addAfter(new N4(t,i),o,r),e}_verifyReinsertion(e,t,i,r){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==o?e=this._reinsertAfter(o,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,o=e._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new sN),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new sN),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class N4{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class O4{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class sN{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new O4,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function oN(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function lN(){return new NS([new rN])}let NS=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||lN()),deps:[[n,new Gg,new Zu]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new Yt(901,"")}}return n.\u0275prov=yn({token:n,providedIn:"root",factory:lN}),n})();const z4=YF(null,"core",[]);let H4=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Ot(IS))},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})(),OS=null;function lu(){return OS}const xo=new Xn("DocumentToken");let wm=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:function(){return function j4(){return Ot(uN)}()},providedIn:"platform"}),n})();const X4=new Xn("Location Initialized");let uN=(()=>{class n extends wm{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return lu().getBaseHref(this._doc)}onPopState(t){const i=lu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=lu().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,i,r){hN()?this._history.pushState(t,i,r):this.location.hash=r}replaceState(t,i,r){hN()?this._history.replaceState(t,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo))},n.\u0275prov=yn({token:n,factory:function(){return function $4(){return new uN(Ot(xo))}()},providedIn:"platform"}),n})();function hN(){return!!window.history.pushState}function QD(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function dN(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Lh(n){return n&&"?"!==n[0]?"?"+n:n}let Oy=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:function(){return function Y4(n){const e=Ot(xo).location;return new fN(Ot(wm),e&&e.origin||"")}()},providedIn:"root"}),n})();const eR=new Xn("appBaseHref");let fN=(()=>{class n extends Oy{constructor(t,i){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return QD(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Lh(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,o){const l=this.prepareExternalUrl(r+Lh(o));this._platformLocation.pushState(t,i,l)}replaceState(t,i,r,o){const l=this.prepareExternalUrl(r+Lh(o));this._platformLocation.replaceState(t,i,l)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,t)}}return n.\u0275fac=function(t){return new(t||n)(Ot(wm),Ot(eR,8))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),K4=(()=>{class n extends Oy{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=QD(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,o){let l=this.prepareExternalUrl(r+Lh(o));0==l.length&&(l=this._platformLocation.pathname),this._platformLocation.pushState(t,i,l)}replaceState(t,i,r,o){let l=this.prepareExternalUrl(r+Lh(o));0==l.length&&(l=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,l)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var i,r;null===(r=(i=this._platformLocation).historyGo)||void 0===r||r.call(i,t)}}return n.\u0275fac=function(t){return new(t||n)(Ot(wm),Ot(eR,8))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),tR=(()=>{class n{constructor(t,i){this._subject=new wi,this._urlChangeListeners=[],this._platformStrategy=t;const r=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=dN(pN(r)),this._platformStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Lh(i))}normalize(t){return n.stripTrailingSlash(function J4(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,pN(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._platformStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Lh(i)),r)}replaceState(t,i="",r=null){this._platformStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Lh(i)),r)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var i,r;null===(r=(i=this._platformStrategy).historyGo)||void 0===r||r.call(i,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}}return n.normalizeQueryParams=Lh,n.joinWithSlash=QD,n.stripTrailingSlash=dN,n.\u0275fac=function(t){return new(t||n)(Ot(Oy),Ot(wm))},n.\u0275prov=yn({token:n,factory:function(){return function Z4(){return new tR(Ot(Oy),Ot(wm))}()},providedIn:"root"}),n})();function pN(n){return n.replace(/\/index.html$/,"")}var Va=(()=>((Va=Va||{})[Va.Decimal=0]="Decimal",Va[Va.Percent=1]="Percent",Va[Va.Currency=2]="Currency",Va[Va.Scientific=3]="Scientific",Va))(),Dn=(()=>((Dn=Dn||{})[Dn.Decimal=0]="Decimal",Dn[Dn.Group=1]="Group",Dn[Dn.List=2]="List",Dn[Dn.PercentSign=3]="PercentSign",Dn[Dn.PlusSign=4]="PlusSign",Dn[Dn.MinusSign=5]="MinusSign",Dn[Dn.Exponential=6]="Exponential",Dn[Dn.SuperscriptingExponent=7]="SuperscriptingExponent",Dn[Dn.PerMille=8]="PerMille",Dn[Dn.Infinity=9]="Infinity",Dn[Dn.NaN=10]="NaN",Dn[Dn.TimeSeparator=11]="TimeSeparator",Dn[Dn.CurrencyDecimal=12]="CurrencyDecimal",Dn[Dn.CurrencyGroup=13]="CurrencyGroup",Dn))();function Vl(n,e){const t=Ct(n),i=t[ke.NumberSymbols][e];if(void 0===i){if(e===Dn.CurrencyDecimal)return t[ke.NumberSymbols][Dn.Decimal];if(e===Dn.CurrencyGroup)return t[ke.NumberSymbols][Dn.Group]}return i}const S5=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function cR(n){const e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}function MN(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,o]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(o)}return null}class k5{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let mx=(()=>{class n{constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,o,l)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new k5(r.item,this._ngForOf,-1,-1),null===l?void 0:l);else if(null==l)i.remove(null===o?void 0:o);else if(null!==o){const c=i.get(o);i.move(c,l),SN(c,r)}});for(let r=0,o=i.length;r<o;r++){const c=i.get(r).context;c.index=r,c.count=o,c.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{SN(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Te(Ul),Te(Ih),Te(NS))},n.\u0275dir=Sn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();function SN(n,e){n.context.$implicit=e.item}let ky=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new B5,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){EN("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){EN("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Te(Ul),Te(Ih))},n.\u0275dir=Sn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class B5{constructor(){this.$implicit=null,this.ngIf=null}}function EN(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Zi(e)}'.`)}class hR{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let jS=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const i=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(t)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Sn({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),n})(),CN=(()=>{class n{constructor(t,i,r){this.ngSwitch=r,r._addCase(),this._view=new hR(t,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(t){return new(t||n)(Te(Ul),Te(Ih),Te(jS,9))},n.\u0275dir=Sn({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),n})(),AN=(()=>{class n{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(t){if(t.ngTemplateOutlet){const i=this._viewContainerRef;this._viewRef&&i.remove(i.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?i.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(t){return new(t||n)(Te(Ul))},n.\u0275dir=Sn({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[Ms]}),n})();let RN=(()=>{class n{constructor(t){this._locale=t}transform(t,i,r){if(!function dR(n){return!(null==n||""===n||n!=n)}(t))return null;r=r||this._locale;try{return function R5(n,e,t){return function aR(n,e,t,i,r,o,l=!1){let c="",d=!1;if(isFinite(n)){let p=function I5(n){let i,r,o,l,c,e=Math.abs(n)+"",t=0;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(o=e.search(/e/i))>0?(r<0&&(r=o),r+=+e.slice(o+1),e=e.substring(0,o)):r<0&&(r=e.length),o=0;"0"===e.charAt(o);o++);if(o===(c=e.length))i=[0],r=1;else{for(c--;"0"===e.charAt(c);)c--;for(r-=o,i=[],l=0;o<=c;o++,l++)i[l]=Number(e.charAt(o))}return r>22&&(i=i.splice(0,21),t=r-1,r=1),{digits:i,exponent:t,integerLen:r}}(n);l&&(p=function P5(n){if(0===n.digits[0])return n;const e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(0===e?n.digits.push(0,0):1===e&&n.digits.push(0),n.integerLen+=2),n}(p));let y=e.minInt,v=e.minFrac,x=e.maxFrac;if(o){const F=o.match(S5);if(null===F)throw new Error(`${o} is not a valid digit info`);const U=F[1],k=F[3],H=F[5];null!=U&&(y=cR(U)),null!=k&&(v=cR(k)),null!=H?x=cR(H):null!=k&&v>x&&(x=v)}!function L5(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let i=n.digits,r=i.length-n.integerLen;const o=Math.min(Math.max(e,r),t);let l=o+n.integerLen,c=i[l];if(l>0){i.splice(Math.max(n.integerLen,l));for(let v=l;v<i.length;v++)i[v]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,l=o+1),i[0]=0;for(let v=1;v<l;v++)i[v]=0}if(c>=5)if(l-1<0){for(let v=0;v>l;v--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[l-1]++;for(;r<Math.max(0,o);r++)i.push(0);let d=0!==o;const p=e+n.integerLen,y=i.reduceRight(function(v,x,b,S){return S[b]=(x+=v)<10?x:x-10,d&&(0===S[b]&&b>=p?S.pop():d=!1),x>=10?1:0},0);y&&(i.unshift(y),n.integerLen++)}(p,v,x);let b=p.digits,S=p.integerLen;const E=p.exponent;let T=[];for(d=b.every(F=>!F);S<y;S++)b.unshift(0);for(;S<0;S++)b.unshift(0);S>0?T=b.splice(S,b.length):(T=b,b=[0]);const N=[];for(b.length>=e.lgSize&&N.unshift(b.splice(-e.lgSize,b.length).join(""));b.length>e.gSize;)N.unshift(b.splice(-e.gSize,b.length).join(""));b.length&&N.unshift(b.join("")),c=N.join(Vl(t,i)),T.length&&(c+=Vl(t,r)+T.join("")),E&&(c+=Vl(t,Dn.Exponential)+"+"+E)}else c=Vl(t,Dn.Infinity);return c=n<0&&!d?e.negPre+c+e.negSuf:e.posPre+c+e.posSuf,c}(n,function lR(n,e="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(";"),r=i[0],o=i[1],l=-1!==r.indexOf(".")?r.split("."):[r.substring(0,r.lastIndexOf("0")+1),r.substring(r.lastIndexOf("0")+1)],c=l[0],d=l[1]||"";t.posPre=c.substr(0,c.indexOf("#"));for(let y=0;y<d.length;y++){const v=d.charAt(y);"0"===v?t.minFrac=t.maxFrac=y+1:"#"===v?t.maxFrac=y+1:t.posSuf+=v}const p=c.split(",");if(t.gSize=p[1]?p[1].length:0,t.lgSize=p[2]||p[1]?(p[2]||p[1]).length:0,o){const y=r.length-t.posPre.length-t.posSuf.length,v=o.indexOf("#");t.negPre=o.substr(0,v).replace(/'/g,""),t.negSuf=o.substr(v+y).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}(function nR(n,e){return Ct(n)[ke.NumberFormats][e]}(e,Va.Decimal),Vl(e,Dn.MinusSign)),e,Dn.Group,Dn.Decimal,t)}(function fR(n){if("string"==typeof n&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if("number"!=typeof n)throw new Error(`${n} is not a number`);return n}(t),r,i)}catch(o){throw function wc(n,e){return new Yt(2100,"")}()}}}return n.\u0275fac=function(t){return new(t||n)(Te(ff,16))},n.\u0275pipe=Go({name:"number",type:n,pure:!0}),n})();let pR=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})();const PN="browser";function IN(n){return n===PN}let hW=(()=>{class n{}return n.\u0275prov=yn({token:n,providedIn:"root",factory:()=>new dW(Ot(xo),window)}),n})();class dW{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function fW(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const o=r.shadowRoot;if(o){const l=o.getElementById(e)||o.querySelector(`[name="${e}"]`);if(l)return l}r=i.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(i-o[0],r-o[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=LN(this.window.history)||LN(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function LN(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class FN{}class mR extends class pW extends class q4{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function W4(n){OS||(OS=n)}(new mR)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function mW(){return gx=gx||document.querySelector("base"),gx?gx.getAttribute("href"):null}();return null==t?null:function gW(n){XS=XS||document.createElement("a"),XS.setAttribute("href",n);const e=XS.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){gx=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return MN(document.cookie,e)}}let XS,gx=null;const NN=new Xn("TRANSITION_ID"),_W=[{provide:UD,useFactory:function yW(n,e,t){return()=>{t.get(VD).donePromise.then(()=>{const i=lu(),r=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let o=0;o<r.length;o++)i.remove(r[o])})}},deps:[NN,xo,Cr],multi:!0}];class gR{static init(){!function y4(n){jD=n}(new gR)}addToWindow(e){ji.getAngularTestability=(i,r=!0)=>{const o=e.findTestabilityInTree(i,r);if(null==o)throw new Error("Could not find testability for element.");return o},ji.getAllAngularTestabilities=()=>e.getAllTestabilities(),ji.getAllAngularRootElements=()=>e.getAllRootElements(),ji.frameworkStabilizers||(ji.frameworkStabilizers=[]),ji.frameworkStabilizers.push(i=>{const r=ji.getAllAngularTestabilities();let o=r.length,l=!1;const c=function(d){l=l||d,o--,0==o&&i(l)};r.forEach(function(d){d.whenStable(c)})})}findTestabilityInTree(e,t,i){if(null==t)return null;const r=e.getTestability(t);return null!=r?r:i?lu().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let vW=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const yx=new Xn("EventManagerPlugins");let $S=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>r.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}addGlobalEventListener(t,i,r){return this._findPluginFor(i).addGlobalEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const r=this._plugins;for(let o=0;o<r.length;o++){const l=r[o];if(l.supports(t))return this._eventNameToPlugin.set(t,l),l}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(Ot(yx),Ot(As))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();class ON{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const r=lu().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,i)}}let kN=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const i=new Set;t.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),_x=(()=>{class n extends kN{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,i,r){t.forEach(o=>{const l=this._doc.createElement("style");l.textContent=o,r.push(i.appendChild(l))})}addHost(t){const i=[];this._addStylesToHost(this._stylesSet,t,i),this._hostNodes.set(t,i)}removeHost(t){const i=this._hostNodes.get(t);i&&i.forEach(BN),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(t,r,i)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(BN))}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();function BN(n){lu().remove(n)}const yR={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},_R=/%COMP%/g;function YS(n,e,t){for(let i=0;i<e.length;i++){let r=e[i];Array.isArray(r)?YS(n,r,t):(r=r.replace(_R,n),t.push(r))}return t}function zN(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let KS=(()=>{class n{constructor(t,i,r){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new vR(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;switch(i.encapsulation){case Ho.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new EW(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(t),r}case 1:case Ho.ShadowDom:return new CW(this.eventManager,this.sharedStylesHost,t,i);default:if(!this.rendererByCompId.has(i.id)){const r=YS(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(Ot($S),Ot(_x),Ot(cx))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();class vR{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(yR[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,i){e&&e.insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const o=yR[r];o?e.setAttributeNS(o,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=yR[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(ua.DashCase|ua.Important)?e.style.setProperty(t,i,r&ua.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&ua.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,zN(i)):this.eventManager.addEventListener(e,t,zN(i))}}class EW extends vR{constructor(e,t,i,r){super(e),this.component=i;const o=YS(r+"-"+i.id,i.styles,[]);t.addStyles(o),this.contentAttr=function wW(n){return"_ngcontent-%COMP%".replace(_R,n)}(r+"-"+i.id),this.hostAttr=function MW(n){return"_nghost-%COMP%".replace(_R,n)}(r+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}class CW extends vR{constructor(e,t,i,r){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=YS(r.id,r.styles,[]);for(let l=0;l<o.length;l++){const c=document.createElement("style");c.textContent=o[l],this.shadowRoot.appendChild(c)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let TW=(()=>{class n extends ON{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const GN=["alt","control","meta","shift"],DW={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},WN={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},RW={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let PW=(()=>{class n extends ON{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const o=n.parseEventName(i),l=n.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>lu().onAndCancel(t,o.domEventName,l))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const o=n._normalizeKey(i.pop());let l="";if(GN.forEach(d=>{const p=i.indexOf(d);p>-1&&(i.splice(p,1),l+=d+".")}),l+=o,0!=i.length||0===o.length)return null;const c={};return c.domEventName=r,c.fullKey=l,c}static getEventFullKey(t){let i="",r=function IW(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&WN.hasOwnProperty(e)&&(e=WN[e]))}return DW[e]||e}(t);return r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),GN.forEach(o=>{o!=r&&RW[o](t)&&(i+=o+".")}),i+=r,i}static eventCallback(t,i,r){return o=>{n.getEventFullKey(o)===t&&r.runGuarded(()=>i(o))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const OW=YF(z4,"browser",[{provide:ux,useValue:PN},{provide:zF,useValue:function LW(){mR.makeCurrent(),gR.init()},multi:!0},{provide:xo,useFactory:function NW(){return function ap(n){xd=n}(document),document},deps:[]}]),kW=[{provide:sm,useValue:"root"},{provide:Fp,useFactory:function FW(){return new Fp},deps:[]},{provide:yx,useClass:TW,multi:!0,deps:[xo,As,ux]},{provide:yx,useClass:PW,multi:!0,deps:[xo]},{provide:KS,useClass:KS,deps:[$S,_x,cx]},{provide:nx,useExisting:KS},{provide:kN,useExisting:_x},{provide:_x,useClass:_x,deps:[xo]},{provide:qD,useClass:qD,deps:[As]},{provide:$S,useClass:$S,deps:[yx,As]},{provide:FN,useClass:vW,deps:[]}];let qN=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:cx,useValue:t.appId},{provide:NN,useExisting:cx},_W]}}}return n.\u0275fac=function(t){return new(t||n)(Ot(n,12))},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({providers:kW,imports:[pR,H4]}),n})();"undefined"!=typeof window&&window;class $W extends An{constructor(e,t){super()}schedule(e,t=0){return this}}const ZS={setInterval(n,e,...t){const{delegate:i}=ZS;return(null==i?void 0:i.setInterval)?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=ZS;return((null==e?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},$N={now:()=>($N.delegate||Date).now(),delegate:void 0};class vx{constructor(e,t=vx.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}vx.now=$N.now;const ZW=new class KW extends vx{constructor(e,t=vx.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}(class YW extends $W{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,i=0){return ZS.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;ZS.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,i=!1;try{this.work(e)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,tn(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});function By(n=0,e,t=ZW){let i=-1;return null!=e&&(Ar(e)?t=e:i=e),new pr(r=>{let o=function JW(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;o<0&&(o=0);let l=0;return t.schedule(function(){r.closed||(r.next(l++),0<=i?this.schedule(void 0,i):r.complete())},o)})}function cu(n){return gi((e,t)=>{let o,i=null,r=!1;i=e.subscribe(Mn(t,void 0,void 0,l=>{o=pe(n(l,cu(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function Uy(n,e){const t=yt(n)?n:()=>n,i=r=>r.error(t());return new pr(e?r=>e.schedule(i,0,r):i)}const xx_port=window.port||5e3;let e8=(()=>{class n{constructor(){this.baseUrl=`http://127.0.0.1:${xx_port}/`}handleError(t){return 0===t.status?console.error("An error occurred:",t.error):(console.error(`Backend returned code ${t.status}, body was: `,t.error),console.error(t)),Uy(()=>new Error("Something bad happened; please try again later."))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function si(...n){return ss(n,xa(n))}function Vy(n,e){return yt(e)?qi(n,e,1):qi(n,1)}function bo(n,e){return gi((t,i)=>{let r=0;t.subscribe(Mn(i,o=>n.call(e,o,r++)&&i.next(o)))})}class YN{}class KN{}class Nh{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const r=t.slice(0,i),o=r.toLowerCase(),l=t.slice(i+1).trim();this.maybeSetNormalizedName(r,o),this.headers.has(o)?this.headers.get(o).push(l):this.headers.set(o,[l])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let i=e[t];const r=t.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Nh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Nh;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Nh?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":const o=e.value;if(o){let l=this.headers.get(t);if(!l)return;l=l.filter(c=>-1===o.indexOf(c)),0===l.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,l)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class t8{encodeKey(e){return ZN(e)}encodeValue(e){return ZN(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const i8=/%(\d[a-f0-9])/gi,r8={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function ZN(n){return encodeURIComponent(n).replace(i8,(e,t)=>{var i;return null!==(i=r8[t])&&void 0!==i?i:e})}function JN(n){return`${n}`}class mf{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new t8,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function n8(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const o=r.indexOf("="),[l,c]=-1==o?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,o)),e.decodeValue(r.slice(o+1))],d=t.get(l)||[];d.push(c),t.set(l,d)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const i=e.fromObject[t];this.map.set(t,Array.isArray(i)?i:[i])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(i=>{const r=e[i];Array.isArray(r)?r.forEach(o=>{t.push({param:i,value:o,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new mf({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(JN(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const r=i.indexOf(JN(e.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class s8{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function QN(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function eO(n){return"undefined"!=typeof Blob&&n instanceof Blob}function tO(n){return"undefined"!=typeof FormData&&n instanceof FormData}class bx{constructor(e,t,i,r){let o;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function o8(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,o=r):o=i,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params)),this.headers||(this.headers=new Nh),this.context||(this.context=new s8),this.params){const l=this.params.toString();if(0===l.length)this.urlWithParams=t;else{const c=t.indexOf("?");this.urlWithParams=t+(-1===c?"?":c<t.length-1?"&":"")+l}}else this.params=new mf,this.urlWithParams=t}serializeBody(){return null===this.body?null:QN(this.body)||eO(this.body)||tO(this.body)||function a8(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof mf?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||tO(this.body)?null:eO(this.body)?this.body.type||null:QN(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof mf?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const i=e.method||this.method,r=e.url||this.url,o=e.responseType||this.responseType,l=void 0!==e.body?e.body:this.body,c=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,d=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let p=e.headers||this.headers,y=e.params||this.params;const v=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(p=Object.keys(e.setHeaders).reduce((x,b)=>x.set(b,e.setHeaders[b]),p)),e.setParams&&(y=Object.keys(e.setParams).reduce((x,b)=>x.set(b,e.setParams[b]),y)),new bx(i,r,l,{params:y,headers:p,context:v,reportProgress:d,responseType:o,withCredentials:c})}}var Hs=(()=>((Hs=Hs||{})[Hs.Sent=0]="Sent",Hs[Hs.UploadProgress=1]="UploadProgress",Hs[Hs.ResponseHeader=2]="ResponseHeader",Hs[Hs.DownloadProgress=3]="DownloadProgress",Hs[Hs.Response=4]="Response",Hs[Hs.User=5]="User",Hs))();class bR{constructor(e,t=200,i="OK"){this.headers=e.headers||new Nh,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class wR extends bR{constructor(e={}){super(e),this.type=Hs.ResponseHeader}clone(e={}){return new wR({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class JS extends bR{constructor(e={}){super(e),this.type=Hs.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new JS({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class nO extends bR{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function MR(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let QS=(()=>{class n{constructor(t){this.handler=t}request(t,i,r={}){let o;if(t instanceof bx)o=t;else{let d,p;d=r.headers instanceof Nh?r.headers:new Nh(r.headers),r.params&&(p=r.params instanceof mf?r.params:new mf({fromObject:r.params})),o=new bx(t,i,void 0!==r.body?r.body:null,{headers:d,context:r.context,params:p,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const l=si(o).pipe(Vy(d=>this.handler.handle(d)));if(t instanceof bx||"events"===r.observe)return l;const c=l.pipe(bo(d=>d instanceof JS));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return c.pipe(Pn(d=>{if(null!==d.body&&!(d.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return d.body}));case"blob":return c.pipe(Pn(d=>{if(null!==d.body&&!(d.body instanceof Blob))throw new Error("Response is not a Blob.");return d.body}));case"text":return c.pipe(Pn(d=>{if(null!==d.body&&"string"!=typeof d.body)throw new Error("Response is not a string.");return d.body}));default:return c.pipe(Pn(d=>d.body))}case"response":return c;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new mf).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,MR(r,i))}post(t,i,r={}){return this.request("POST",t,MR(r,i))}put(t,i,r={}){return this.request("PUT",t,MR(r,i))}}return n.\u0275fac=function(t){return new(t||n)(Ot(YN))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();class iO{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const rO=new Xn("HTTP_INTERCEPTORS");let l8=(()=>{class n{intercept(t,i){return i.handle(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const c8=/^\)\]\}',?\n/;let sO=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new pr(i=>{const r=this.xhrFactory.build();if(r.open(t.method,t.urlWithParams),t.withCredentials&&(r.withCredentials=!0),t.headers.forEach((b,S)=>r.setRequestHeader(b,S.join(","))),t.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const b=t.detectContentTypeHeader();null!==b&&r.setRequestHeader("Content-Type",b)}if(t.responseType){const b=t.responseType.toLowerCase();r.responseType="json"!==b?b:"text"}const o=t.serializeBody();let l=null;const c=()=>{if(null!==l)return l;const b=r.statusText||"OK",S=new Nh(r.getAllResponseHeaders()),E=function u8(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||t.url;return l=new wR({headers:S,status:r.status,statusText:b,url:E}),l},d=()=>{let{headers:b,status:S,statusText:E,url:T}=c(),N=null;204!==S&&(N=void 0===r.response?r.responseText:r.response),0===S&&(S=N?200:0);let F=S>=200&&S<300;if("json"===t.responseType&&"string"==typeof N){const U=N;N=N.replace(c8,"");try{N=""!==N?JSON.parse(N):null}catch(k){N=U,F&&(F=!1,N={error:k,text:N})}}F?(i.next(new JS({body:N,headers:b,status:S,statusText:E,url:T||void 0})),i.complete()):i.error(new nO({error:N,headers:b,status:S,statusText:E,url:T||void 0}))},p=b=>{const{url:S}=c(),E=new nO({error:b,status:r.status||0,statusText:r.statusText||"Unknown Error",url:S||void 0});i.error(E)};let y=!1;const v=b=>{y||(i.next(c()),y=!0);let S={type:Hs.DownloadProgress,loaded:b.loaded};b.lengthComputable&&(S.total=b.total),"text"===t.responseType&&!!r.responseText&&(S.partialText=r.responseText),i.next(S)},x=b=>{let S={type:Hs.UploadProgress,loaded:b.loaded};b.lengthComputable&&(S.total=b.total),i.next(S)};return r.addEventListener("load",d),r.addEventListener("error",p),r.addEventListener("timeout",p),r.addEventListener("abort",p),t.reportProgress&&(r.addEventListener("progress",v),null!==o&&r.upload&&r.upload.addEventListener("progress",x)),r.send(o),i.next({type:Hs.Sent}),()=>{r.removeEventListener("error",p),r.removeEventListener("abort",p),r.removeEventListener("load",d),r.removeEventListener("timeout",p),t.reportProgress&&(r.removeEventListener("progress",v),null!==o&&r.upload&&r.upload.removeEventListener("progress",x)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(Ot(FN))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const SR=new Xn("XSRF_COOKIE_NAME"),ER=new Xn("XSRF_HEADER_NAME");class oO{}let h8=(()=>{class n{constructor(t,i,r){this.doc=t,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=MN(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo),Ot(ux),Ot(SR))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),CR=(()=>{class n{constructor(t,i){this.tokenService=t,this.headerName=i}intercept(t,i){const r=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(t);const o=this.tokenService.getToken();return null!==o&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,o)})),i.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(Ot(oO),Ot(ER))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),d8=(()=>{class n{constructor(t,i){this.backend=t,this.injector=i,this.chain=null}handle(t){if(null===this.chain){const i=this.injector.get(rO,[]);this.chain=i.reduceRight((r,o)=>new iO(r,o),this.backend)}return this.chain.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(Ot(KN),Ot(Cr))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),f8=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:CR,useClass:l8}]}}static withOptions(t={}){return{ngModule:n,providers:[t.cookieName?{provide:SR,useValue:t.cookieName}:[],t.headerName?{provide:ER,useValue:t.headerName}:[]]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({providers:[CR,{provide:rO,useExisting:CR,multi:!0},{provide:oO,useClass:h8},{provide:SR,useValue:"XSRF-TOKEN"},{provide:ER,useValue:"X-XSRF-TOKEN"}]}),n})(),p8=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({providers:[QS,{provide:YN,useClass:d8},sO,{provide:KN,useExisting:sO}],imports:[[f8.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})(),wx=(()=>{class n extends e8{constructor(t){super(),this.http=t,this.viewerData=new Map,this.componentTree=[],this.viewerDataSubject=new zt}addViewerData(t){this.viewerData.set(t.sceneId,t),this.viewerDataSubject.next(this.viewerData)}getViewerData(){return this.viewerDataSubject}addSceneElement(t,i,r){var o;let l=null===(o=this.viewerData.get(t))||void 0===o?void 0:o.elements;!l||i<l.length&&void 0!==l[i]&&(l[i].element=r)}getComponentTree(t){let i=this.http.get(this.baseUrl+"component_tree/"+t).pipe(function QW(n=1/0){let e;e=n&&"object"==typeof n?n:{count:n};const{count:t=1/0,delay:i,resetOnSuccess:r=!1}=e;return t<=0?$t:gi((o,l)=>{let d,c=0;const p=()=>{let y=!1;d=o.subscribe(Mn(l,v=>{r&&(c=0),l.next(v)},void 0,v=>{if(c++<t){const x=()=>{d?(d.unsubscribe(),d=null,p()):y=!0};if(null!=i){const b="number"==typeof i?By(i):pe(i(v,c)),S=Mn(l,()=>{S.unsubscribe(),x()},()=>{l.complete()});b.subscribe(S)}else x()}else l.error(v)})),y&&(d.unsubscribe(),d=null,p())};p()})}(3),cu(this.handleError));return i.subscribe(r=>{this.componentTree=r}),i}}return n.\u0275fac=function(t){return new(t||n)(Ot(QS))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Mx{static enumFromStringValue(e,t){return Object.values(e).includes(t)?t:void 0}static urlToCameraState(e){return{position:e.position.split(","),quaternion:e.quaternion.split(","),up:e.up.split(","),zoom:Number(e.zoom),fov:Number(e.fov),near:Number(e.near),far:Number(e.far),lastUpdate:0}}static cameraStateToUrlParams(e){return`?&position=${e.position}\n&quaternion=${e.quaternion}\n&fov=${e.fov}\n&zoom=${e.zoom}\n&up=${e.up}\n&near=${e.near}\n&far=${e.far}`}static logRange(e,t,i,r,o){let l=Math.log(e),d=(Math.log(t)-l)/(r-i);return Math.exp(l+d*(o-i))}}function m8(n,e){if(1&n&&ur(0,"app-col",4),2&n){const t=Oe().$implicit,i=Oe();nt("children",t.children)("data",i.toColData(t.data))}}function g8(n,e){if(1&n&&ur(0,"app-row",4),2&n){const t=Oe().$implicit,i=Oe();nt("children",t.children)("data",i.toRowData(t.data))}}function y8(n,e){if(1&n&&ur(0,"app-scene",5),2&n){const t=Oe().$implicit;nt("data",Oe().toViewerData(t.data))}}function _8(n,e){if(1&n&&ur(0,"app-scene-settings",5),2&n){const t=Oe().$implicit;nt("data",Oe().toGeneralSettingsData(t.data))}}function v8(n,e){if(1&n&&ur(0,"app-element-tree",5),2&n){const t=Oe().$implicit;nt("data",Oe().toElementTreeData(t.data))}}function x8(n,e){if(1&n&&(We(0,"div")(1,"div",1),xn(2,m8,1,2,"app-col",2),xn(3,g8,1,2,"app-row",2),xn(4,y8,1,1,"app-scene",3),xn(5,_8,1,1,"app-scene-settings",3),xn(6,v8,1,1,"app-element-tree",3),Ne()()),2&n){const t=e.$implicit,i=Oe();at(1),nt("ngSwitch",i.parseToEnum(t.component)),at(1),nt("ngSwitchCase",i.comp.COL),at(1),nt("ngSwitchCase",i.comp.ROW),at(1),nt("ngSwitchCase",i.comp.VIEWER),at(1),nt("ngSwitchCase",i.comp.GENERAL_SETTINGS),at(1),nt("ngSwitchCase",i.comp.ELEMENT_TREE)}}var Sx=(()=>{return(n=Sx||(Sx={})).ROW="row",n.COL="col",n.VIEWER="viewer",n.BUTTON="button",n.GENERAL_SETTINGS="general_settings",n.ELEMENT_TREE="element_tree",Sx;var n})();let zy=(()=>{class n{constructor(){this.comp=Sx,this.children=[]}ngOnInit(){}toColData(t){return t}toRowData(t){return t}toGeneralSettingsData(t){return t}toViewerData(t){return t}toElementTreeData(t){return t}parseToEnum(t){return Mx.enumFromStringValue(Sx,t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ao({type:n,selectors:[["app-base"]],inputs:{children:"children"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"children","data",4,"ngSwitchCase"],[3,"data",4,"ngSwitchCase"],[3,"children","data"],[3,"data"]],template:function(t,i){1&t&&xn(0,x8,7,6,"div",0),2&t&&nt("ngForOf",i.children)},styles:[""]}),n})(),b8=(()=>{class n{constructor(t){this.sceneElementsService=t,this.title="Potree Viewer",this.data=[],t.getComponentTree(0).subscribe(i=>{this.data=i})}}return n.\u0275fac=function(t){return new(t||n)(Te(wx))},n.\u0275cmp=Ao({type:n,selectors:[["app-root"]],decls:1,vars:1,consts:[[3,"children"]],template:function(t,i){1&t&&ur(0,"app-base",0),2&t&&nt("children",i.data)},directives:[zy],styles:[""]}),n})();function aO(n,e,t,i,r,o,l){try{var c=n[o](l),d=c.value}catch(p){return void t(p)}c.done?e(d):Promise.resolve(d).then(i,r)}const za=1001,ao=1003,Gs=1006,Cm=1009,Tx=1012,yf=1015,jy=1016,Xy=1020,Gl=1023,Tm=1026,$y=1027,Yy=2400,Ky=2401,kh=3e3,$r=3001,Bh="srgb",Am="srgb-linear",Ax=35044,Dx=35048;class _f{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const o=r.indexOf(t);-1!==o&&r.splice(o,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let o=0,l=r.length;o<l;o++)r[o].call(this,e);e.target=null}}}const Oo=[];for(let n=0;n<256;n++)Oo[n]=(n<16?"0":"")+n.toString(16);let HO=1234567;const Dm=Math.PI/180,Rx=180/Math.PI;function ol(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Oo[255&n]+Oo[n>>8&255]+Oo[n>>16&255]+Oo[n>>24&255]+"-"+Oo[255&e]+Oo[e>>8&255]+"-"+Oo[e>>16&15|64]+Oo[e>>24&255]+"-"+Oo[63&t|128]+Oo[t>>8&255]+"-"+Oo[t>>16&255]+Oo[t>>24&255]+Oo[255&i]+Oo[i>>8&255]+Oo[i>>16&255]+Oo[i>>24&255]).toLowerCase()}function Rs(n,e,t){return Math.max(e,Math.min(t,n))}function VR(n,e){return(n%e+e)%e}function Px(n,e,t){return(1-t)*n+t*e}function zR(n){return 0==(n&n-1)&&0!==n}function cE(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}var ts=Object.freeze({__proto__:null,DEG2RAD:Dm,RAD2DEG:Rx,generateUUID:ol,clamp:Rs,euclideanModulo:VR,mapLinear:function b6(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)},inverseLerp:function w6(n,e,t){return n!==e?(t-n)/(e-n):0},lerp:Px,damp:function M6(n,e,t,i){return Px(n,e,1-Math.exp(-t*i))},pingpong:function S6(n,e=1){return e-Math.abs(VR(n,2*e)-e)},smoothstep:function E6(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)},smootherstep:function C6(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*n*(n*(6*n-15)+10)},randInt:function T6(n,e){return n+Math.floor(Math.random()*(e-n+1))},randFloat:function A6(n,e){return n+Math.random()*(e-n)},randFloatSpread:function D6(n){return n*(.5-Math.random())},seededRandom:function R6(n){void 0!==n&&(HO=n);let e=HO+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function P6(n){return n*Dm},radToDeg:function I6(n){return n*Rx},isPowerOfTwo:zR,ceilPowerOfTwo:function GO(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},floorPowerOfTwo:cE,setQuaternionFromProperEuler:function L6(n,e,t,i,r){const o=Math.cos,l=Math.sin,c=o(t/2),d=l(t/2),p=o((e+i)/2),y=l((e+i)/2),v=o((e-i)/2),x=l((e-i)/2),b=o((i-e)/2),S=l((i-e)/2);switch(r){case"XYX":n.set(c*y,d*v,d*x,c*p);break;case"YZY":n.set(d*x,c*y,d*v,c*p);break;case"ZXZ":n.set(d*v,d*x,c*y,c*p);break;case"XZX":n.set(c*y,d*S,d*b,c*p);break;case"YXY":n.set(d*b,c*y,d*S,c*p);break;case"ZYZ":n.set(d*S,d*b,c*y,c*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function N6(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}},denormalize:function F6(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}});class ct{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),o=this.x-e.x,l=this.y-e.y;return this.x=o*i-l*r+e.x,this.y=o*r+l*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}ct.prototype.isVector2=!0;class wo{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,o,l,c,d,p){const y=this.elements;return y[0]=e,y[1]=r,y[2]=c,y[3]=t,y[4]=o,y[5]=d,y[6]=i,y[7]=l,y[8]=p,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,l=i[0],c=i[3],d=i[6],p=i[1],y=i[4],v=i[7],x=i[2],b=i[5],S=i[8],E=r[0],T=r[3],N=r[6],F=r[1],U=r[4],k=r[7],H=r[2],Q=r[5],ie=r[8];return o[0]=l*E+c*F+d*H,o[3]=l*T+c*U+d*Q,o[6]=l*N+c*k+d*ie,o[1]=p*E+y*F+v*H,o[4]=p*T+y*U+v*Q,o[7]=p*N+y*k+v*ie,o[2]=x*E+b*F+S*H,o[5]=x*T+b*U+S*Q,o[8]=x*N+b*k+S*ie,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],l=e[4],c=e[5],d=e[6],p=e[7],y=e[8];return t*l*y-t*c*p-i*o*y+i*c*d+r*o*p-r*l*d}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],l=e[4],c=e[5],d=e[6],p=e[7],y=e[8],v=y*l-c*p,x=c*d-y*o,b=p*o-l*d,S=t*v+i*x+r*b;if(0===S)return this.set(0,0,0,0,0,0,0,0,0);const E=1/S;return e[0]=v*E,e[1]=(r*p-y*i)*E,e[2]=(c*i-r*l)*E,e[3]=x*E,e[4]=(y*t-r*d)*E,e[5]=(r*o-c*t)*E,e[6]=b*E,e[7]=(i*d-p*t)*E,e[8]=(l*t-i*o)*E,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,o,l,c){const d=Math.cos(o),p=Math.sin(o);return this.set(i*d,i*p,-i*(d*l+p*c)+l+e,-r*p,r*d,-r*(-p*l+d*c)+c+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.elements,o=r[0],l=r[3],c=r[6],d=r[1],p=r[4],y=r[7];return r[0]=t*o+i*d,r[3]=t*l+i*p,r[6]=t*c+i*y,r[1]=-i*o+t*d,r[4]=-i*l+t*p,r[7]=-i*c+t*y,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function WO(n){for(let e=n.length-1;e>=0;--e)if(n[e]>65535)return!0;return!1}function Ix(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Rm(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function uE(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}wo.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const HR={[Bh]:{[Am]:Rm},[Am]:{[Bh]:uE}},Mc={legacyMode:!0,get workingColorSpace(){return Am},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(HR[e]&&void 0!==HR[e][t]){const i=HR[e][t];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},qO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lo={r:0,g:0,b:0},Sc={h:0,s:0,l:0},hE={h:0,s:0,l:0};function GR(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}function dE(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}let Qy,Ht=(()=>{class n{constructor(t,i,r){return void 0===i&&void 0===r?this.set(t):this.setRGB(t,i,r)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Bh){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Mc.toWorkingColorSpace(this,i),this}setRGB(t,i,r,o=Am){return this.r=t,this.g=i,this.b=r,Mc.toWorkingColorSpace(this,o),this}setHSL(t,i,r,o=Am){if(t=VR(t,1),i=Rs(i,0,1),r=Rs(r,0,1),0===i)this.r=this.g=this.b=r;else{const l=r<=.5?r*(1+i):r+i-r*i,c=2*r-l;this.r=GR(c,l,t+1/3),this.g=GR(c,l,t),this.b=GR(c,l,t-1/3)}return Mc.toWorkingColorSpace(this,o),this}setStyle(t,i=Bh){function r(l){void 0!==l&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let o;if(o=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let l;const d=o[2];switch(o[1]){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,Mc.toWorkingColorSpace(this,i),r(l[4]),this;if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,Mc.toWorkingColorSpace(this,i),r(l[4]),this;break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d)){const p=parseFloat(l[1])/360,y=parseInt(l[2],10)/100,v=parseInt(l[3],10)/100;return r(l[4]),this.setHSL(p,y,v,i)}}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){const l=o[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,Mc.toWorkingColorSpace(this,i),this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,Mc.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t,i=Bh){const r=qO[t.toLowerCase()];return void 0!==r?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Rm(t.r),this.g=Rm(t.g),this.b=Rm(t.b),this}copyLinearToSRGB(t){return this.r=uE(t.r),this.g=uE(t.g),this.b=uE(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Bh){return Mc.fromWorkingColorSpace(dE(this,lo),t),Rs(255*lo.r,0,255)<<16^Rs(255*lo.g,0,255)<<8^Rs(255*lo.b,0,255)<<0}getHexString(t=Bh){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Am){Mc.fromWorkingColorSpace(dE(this,lo),i);const r=lo.r,o=lo.g,l=lo.b,c=Math.max(r,o,l),d=Math.min(r,o,l);let p,y;const v=(d+c)/2;if(d===c)p=0,y=0;else{const x=c-d;switch(y=v<=.5?x/(c+d):x/(2-c-d),c){case r:p=(o-l)/x+(o<l?6:0);break;case o:p=(l-r)/x+2;break;case l:p=(r-o)/x+4}p/=6}return t.h=p,t.s=y,t.l=v,t}getRGB(t,i=Am){return Mc.fromWorkingColorSpace(dE(this,lo),i),t.r=lo.r,t.g=lo.g,t.b=lo.b,t}getStyle(t=Bh){return Mc.fromWorkingColorSpace(dE(this,lo),t),t!==Bh?`color(${t} ${lo.r} ${lo.g} ${lo.b})`:`rgb(${255*lo.r|0},${255*lo.g|0},${255*lo.b|0})`}offsetHSL(t,i,r){return this.getHSL(Sc),Sc.h+=t,Sc.s+=i,Sc.l+=r,this.setHSL(Sc.h,Sc.s,Sc.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(Sc),t.getHSL(hE);const r=Px(Sc.h,hE.h,i),o=Px(Sc.s,hE.s,i),l=Px(Sc.l,hE.l,i);return this.setHSL(r,o,l),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return n.NAMES=qO,n})();Ht.prototype.isColor=!0,Ht.prototype.r=1,Ht.prototype.g=1,Ht.prototype.b=1;class Pm{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Qy&&(Qy=Ix("canvas")),Qy.width=e.width,Qy.height=e.height;const i=Qy.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Qy}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Ix("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),o=r.data;for(let l=0;l<o.length;l++)o[l]=255*Rm(o[l]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Rm(t[i]/255)):Rm(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class e_{constructor(e=null){this.uuid=ol(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let o;if(Array.isArray(r)){o=[];for(let l=0,c=r.length;l<c;l++)o.push(WR(r[l].isDataTexture?r[l].image:r[l]))}else o=WR(r);i.url=o}return t||(e.images[this.uuid]=i),i}}function WR(n){return"undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&n instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap?Pm.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}e_.prototype.isSource=!0;let k6=0,Ha=(()=>{class n extends _f{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=za,o=za,l=Gs,c=1008,d=Gl,p=Cm,y=1,v=kh){super(),Object.defineProperty(this,"id",{value:k6++}),this.uuid=ol(),this.name="",this.source=new e_(t),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=o,this.magFilter=l,this.minFilter=c,this.anisotropy=y,this.format=d,this.internalFormat=null,this.type=p,this.offset=new ct(0,0),this.repeat=new ct(1,1),this.center=new ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=v,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case za:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case za:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n})();Ha.prototype.isTexture=!0;class Qi{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=this.w,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*r+l[12]*o,this.y=l[1]*t+l[5]*i+l[9]*r+l[13]*o,this.z=l[2]*t+l[6]*i+l[10]*r+l[14]*o,this.w=l[3]*t+l[7]*i+l[11]*r+l[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,o;const d=e.elements,p=d[0],y=d[4],v=d[8],x=d[1],b=d[5],S=d[9],E=d[2],T=d[6],N=d[10];if(Math.abs(y-x)<.01&&Math.abs(v-E)<.01&&Math.abs(S-T)<.01){if(Math.abs(y+x)<.1&&Math.abs(v+E)<.1&&Math.abs(S+T)<.1&&Math.abs(p+b+N-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const U=(p+1)/2,k=(b+1)/2,H=(N+1)/2,Q=(y+x)/4,ie=(v+E)/4,ce=(S+T)/4;return U>k&&U>H?U<.01?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(U),r=Q/i,o=ie/i):k>H?k<.01?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(k),i=Q/r,o=ce/r):H<.01?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(H),i=ie/o,r=ce/o),this.set(i,r,o,t),this}let F=Math.sqrt((T-S)*(T-S)+(v-E)*(v-E)+(x-y)*(x-y));return Math.abs(F)<.001&&(F=1),this.x=(T-S)/F,this.y=(v-E)/F,this.z=(x-y)/F,this.w=Math.acos((p+b+N-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Qi.prototype.isVector4=!0;class al extends _f{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Qi(0,0,e,t),this.scissorTest=!1,this.viewport=new Qi(0,0,e,t),this.texture=new Ha({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Gs,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}al.prototype.isWebGLRenderTarget=!0;class fE extends Ha{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=ao,this.minFilter=ao,this.wrapR=za,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}fE.prototype.isDataArrayTexture=!0,class B6 extends al{constructor(e,t,i){super(e,t),this.depth=i,this.texture=new fE(null,e,t,i),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class qR extends Ha{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=ao,this.minFilter=ao,this.wrapR=za,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}qR.prototype.isData3DTexture=!0,class U6 extends al{constructor(e,t,i){super(e,t),this.depth=i,this.texture=new qR(null,e,t,i),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class V6 extends al{constructor(e,t,i,r={}){super(e,t,r);const o=this.texture;this.texture=[];for(let l=0;l<i;l++)this.texture[l]=o.clone(),this.texture[l].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,o=this.texture.length;r<o;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class Mo{constructor(e=0,t=0,i=0,r=1){this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,r)}static slerpFlat(e,t,i,r,o,l,c){let d=i[r+0],p=i[r+1],y=i[r+2],v=i[r+3];const x=o[l+0],b=o[l+1],S=o[l+2],E=o[l+3];if(0===c)return e[t+0]=d,e[t+1]=p,e[t+2]=y,void(e[t+3]=v);if(1===c)return e[t+0]=x,e[t+1]=b,e[t+2]=S,void(e[t+3]=E);if(v!==E||d!==x||p!==b||y!==S){let T=1-c;const N=d*x+p*b+y*S+v*E,F=N>=0?1:-1,U=1-N*N;if(U>Number.EPSILON){const H=Math.sqrt(U),Q=Math.atan2(H,N*F);T=Math.sin(T*Q)/H,c=Math.sin(c*Q)/H}const k=c*F;if(d=d*T+x*k,p=p*T+b*k,y=y*T+S*k,v=v*T+E*k,T===1-c){const H=1/Math.sqrt(d*d+p*p+y*y+v*v);d*=H,p*=H,y*=H,v*=H}}e[t]=d,e[t+1]=p,e[t+2]=y,e[t+3]=v}static multiplyQuaternionsFlat(e,t,i,r,o,l){const c=i[r],d=i[r+1],p=i[r+2],y=i[r+3],v=o[l],x=o[l+1],b=o[l+2],S=o[l+3];return e[t]=c*S+y*v+d*b-p*x,e[t+1]=d*S+y*x+p*v-c*b,e[t+2]=p*S+y*b+c*x-d*v,e[t+3]=y*S-c*v-d*x-p*b,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,r=e._y,o=e._z,l=e._order,c=Math.cos,d=Math.sin,p=c(i/2),y=c(r/2),v=c(o/2),x=d(i/2),b=d(r/2),S=d(o/2);switch(l){case"XYZ":this._x=x*y*v+p*b*S,this._y=p*b*v-x*y*S,this._z=p*y*S+x*b*v,this._w=p*y*v-x*b*S;break;case"YXZ":this._x=x*y*v+p*b*S,this._y=p*b*v-x*y*S,this._z=p*y*S-x*b*v,this._w=p*y*v+x*b*S;break;case"ZXY":this._x=x*y*v-p*b*S,this._y=p*b*v+x*y*S,this._z=p*y*S+x*b*v,this._w=p*y*v-x*b*S;break;case"ZYX":this._x=x*y*v-p*b*S,this._y=p*b*v+x*y*S,this._z=p*y*S-x*b*v,this._w=p*y*v+x*b*S;break;case"YZX":this._x=x*y*v+p*b*S,this._y=p*b*v+x*y*S,this._z=p*y*S-x*b*v,this._w=p*y*v-x*b*S;break;case"XZY":this._x=x*y*v-p*b*S,this._y=p*b*v-x*y*S,this._z=p*y*S+x*b*v,this._w=p*y*v+x*b*S;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],o=t[8],l=t[1],c=t[5],d=t[9],p=t[2],y=t[6],v=t[10],x=i+c+v;if(x>0){const b=.5/Math.sqrt(x+1);this._w=.25/b,this._x=(y-d)*b,this._y=(o-p)*b,this._z=(l-r)*b}else if(i>c&&i>v){const b=2*Math.sqrt(1+i-c-v);this._w=(y-d)/b,this._x=.25*b,this._y=(r+l)/b,this._z=(o+p)/b}else if(c>v){const b=2*Math.sqrt(1+c-i-v);this._w=(o-p)/b,this._x=(r+l)/b,this._y=.25*b,this._z=(d+y)/b}else{const b=2*Math.sqrt(1+v-i-c);this._w=(l-r)/b,this._x=(o+p)/b,this._y=(d+y)/b,this._z=.25*b}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rs(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,o=e._z,l=e._w,c=t._x,d=t._y,p=t._z,y=t._w;return this._x=i*y+l*c+r*p-o*d,this._y=r*y+l*d+o*c-i*p,this._z=o*y+l*p+i*d-r*c,this._w=l*y-i*c-r*d-o*p,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,o=this._z,l=this._w;let c=l*e._w+i*e._x+r*e._y+o*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=l,this._x=i,this._y=r,this._z=o,this;const d=1-c*c;if(d<=Number.EPSILON){const b=1-t;return this._w=b*l+t*this._w,this._x=b*i+t*this._x,this._y=b*r+t*this._y,this._z=b*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const p=Math.sqrt(d),y=Math.atan2(p,c),v=Math.sin((1-t)*y)/p,x=Math.sin(t*y)/p;return this._w=l*v+this._w*x,this._x=i*v+this._x*x,this._y=r*v+this._y*x,this._z=o*v+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(o),i*Math.cos(o),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Mo.prototype.isQuaternion=!0;class ${constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(jO.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(jO.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=e.elements,l=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*l,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*l,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*l,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,o=e.x,l=e.y,c=e.z,d=e.w,p=d*t+l*r-c*i,y=d*i+c*t-o*r,v=d*r+o*i-l*t,x=-o*t-l*i-c*r;return this.x=p*d+x*-o+y*-c-v*-l,this.y=y*d+x*-l+v*-o-p*-c,this.z=v*d+x*-c+p*-l-y*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,o=e.z,l=t.x,c=t.y,d=t.z;return this.x=r*d-o*c,this.y=o*l-i*d,this.z=i*c-r*l,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return jR.copy(this).projectOnVector(e),this.sub(jR)}reflect(e){return this.sub(jR.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Rs(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}$.prototype.isVector3=!0;const jR=new $,jO=new Mo;class Ko{constructor(e=new $(1/0,1/0,1/0),t=new $(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,o=-1/0,l=-1/0,c=-1/0;for(let d=0,p=e.length;d<p;d+=3){const y=e[d],v=e[d+1],x=e[d+2];y<t&&(t=y),v<i&&(i=v),x<r&&(r=x),y>o&&(o=y),v>l&&(l=v),x>c&&(c=x)}return this.min.set(t,i,r),this.max.set(o,l,c),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,o=-1/0,l=-1/0,c=-1/0;for(let d=0,p=e.count;d<p;d++){const y=e.getX(d),v=e.getY(d),x=e.getZ(d);y<t&&(t=y),v<i&&(i=v),x<r&&(r=x),y>o&&(o=y),v>l&&(l=v),x>c&&(c=x)}return this.min.set(t,i,r),this.max.set(o,l,c),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Im.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const o=i.attributes.position;for(let l=0,c=o.count;l<c;l++)Im.fromBufferAttribute(o,l).applyMatrix4(e.matrixWorld),this.expandByPoint(Im)}else null===i.boundingBox&&i.computeBoundingBox(),XR.copy(i.boundingBox),XR.applyMatrix4(e.matrixWorld),this.union(XR);const r=e.children;for(let o=0,l=r.length;o<l;o++)this.expandByObject(r[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Im),Im.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Lx),pE.subVectors(this.max,Lx),t_.subVectors(e.a,Lx),n_.subVectors(e.b,Lx),i_.subVectors(e.c,Lx),vf.subVectors(n_,t_),xf.subVectors(i_,n_),Lm.subVectors(t_,i_);let t=[0,-vf.z,vf.y,0,-xf.z,xf.y,0,-Lm.z,Lm.y,vf.z,0,-vf.x,xf.z,0,-xf.x,Lm.z,0,-Lm.x,-vf.y,vf.x,0,-xf.y,xf.x,0,-Lm.y,Lm.x,0];return!(!$R(t,t_,n_,i_,pE)||(t=[1,0,0,0,1,0,0,0,1],!$R(t,t_,n_,i_,pE)))&&(mE.crossVectors(vf,xf),t=[mE.x,mE.y,mE.z],$R(t,t_,n_,i_,pE))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Im.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Im).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Uh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Uh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Uh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Uh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Uh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Uh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Uh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Uh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Uh)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ko.prototype.isBox3=!0;const Uh=[new $,new $,new $,new $,new $,new $,new $,new $],Im=new $,XR=new Ko,t_=new $,n_=new $,i_=new $,vf=new $,xf=new $,Lm=new $,Lx=new $,pE=new $,mE=new $,Fm=new $;function $R(n,e,t,i,r){for(let o=0,l=n.length-3;o<=l;o+=3){Fm.fromArray(n,o);const c=r.x*Math.abs(Fm.x)+r.y*Math.abs(Fm.y)+r.z*Math.abs(Fm.z),d=e.dot(Fm),p=t.dot(Fm),y=i.dot(Fm);if(Math.max(-Math.max(d,p,y),Math.min(d,p,y))>c)return!1}return!0}const z6=new Ko,XO=new $,gE=new $,YR=new $;class uu{constructor(e=new $,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):z6.setFromPoints(e).getCenter(i);let r=0;for(let o=0,l=e.length;o<l;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){YR.subVectors(e,this.center);const t=YR.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.add(YR.multiplyScalar(r/i)),this.radius+=r}return this}union(e){return!0===this.center.equals(e.center)?gE.set(0,0,1).multiplyScalar(e.radius):gE.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(XO.copy(e.center).add(gE)),this.expandByPoint(XO.copy(e.center).sub(gE)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Vh=new $,KR=new $,yE=new $,bf=new $,ZR=new $,_E=new $,JR=new $;class wf{constructor(e=new $,t=new $(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Vh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Vh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Vh.copy(this.direction).multiplyScalar(t).add(this.origin),Vh.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){KR.copy(e).add(t).multiplyScalar(.5),yE.copy(t).sub(e).normalize(),bf.copy(this.origin).sub(KR);const o=.5*e.distanceTo(t),l=-this.direction.dot(yE),c=bf.dot(this.direction),d=-bf.dot(yE),p=bf.lengthSq(),y=Math.abs(1-l*l);let v,x,b,S;if(y>0)if(v=l*d-c,x=l*c-d,S=o*y,v>=0)if(x>=-S)if(x<=S){const E=1/y;v*=E,x*=E,b=v*(v+l*x+2*c)+x*(l*v+x+2*d)+p}else x=o,v=Math.max(0,-(l*x+c)),b=-v*v+x*(x+2*d)+p;else x=-o,v=Math.max(0,-(l*x+c)),b=-v*v+x*(x+2*d)+p;else x<=-S?(v=Math.max(0,-(-l*o+c)),x=v>0?-o:Math.min(Math.max(-o,-d),o),b=-v*v+x*(x+2*d)+p):x<=S?(v=0,x=Math.min(Math.max(-o,-d),o),b=x*(x+2*d)+p):(v=Math.max(0,-(l*o+c)),x=v>0?o:Math.min(Math.max(-o,-d),o),b=-v*v+x*(x+2*d)+p);else x=l>0?-o:o,v=Math.max(0,-(l*x+c)),b=-v*v+x*(x+2*d)+p;return i&&i.copy(this.direction).multiplyScalar(v).add(this.origin),r&&r.copy(yE).multiplyScalar(x).add(KR),b}intersectSphere(e,t){Vh.subVectors(e.center,this.origin);const i=Vh.dot(this.direction),r=Vh.dot(Vh)-i*i,o=e.radius*e.radius;if(r>o)return null;const l=Math.sqrt(o-r),c=i-l,d=i+l;return c<0&&d<0?null:this.at(c<0?d:c,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,o,l,c,d;const p=1/this.direction.x,y=1/this.direction.y,v=1/this.direction.z,x=this.origin;return p>=0?(i=(e.min.x-x.x)*p,r=(e.max.x-x.x)*p):(i=(e.max.x-x.x)*p,r=(e.min.x-x.x)*p),y>=0?(o=(e.min.y-x.y)*y,l=(e.max.y-x.y)*y):(o=(e.max.y-x.y)*y,l=(e.min.y-x.y)*y),i>l||o>r||((o>i||i!=i)&&(i=o),(l<r||r!=r)&&(r=l),v>=0?(c=(e.min.z-x.z)*v,d=(e.max.z-x.z)*v):(c=(e.max.z-x.z)*v,d=(e.min.z-x.z)*v),i>d||c>r)||((c>i||i!=i)&&(i=c),(d<r||r!=r)&&(r=d),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,Vh)}intersectTriangle(e,t,i,r,o){ZR.subVectors(t,e),_E.subVectors(i,e),JR.crossVectors(ZR,_E);let c,l=this.direction.dot(JR);if(l>0){if(r)return null;c=1}else{if(!(l<0))return null;c=-1,l=-l}bf.subVectors(this.origin,e);const d=c*this.direction.dot(_E.crossVectors(bf,_E));if(d<0)return null;const p=c*this.direction.dot(ZR.cross(bf));if(p<0||d+p>l)return null;const y=-c*bf.dot(JR);return y<0?null:this.at(y/l,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Tt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,o,l,c,d,p,y,v,x,b,S,E,T){const N=this.elements;return N[0]=e,N[4]=t,N[8]=i,N[12]=r,N[1]=o,N[5]=l,N[9]=c,N[13]=d,N[2]=p,N[6]=y,N[10]=v,N[14]=x,N[3]=b,N[7]=S,N[11]=E,N[15]=T,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Tt).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/r_.setFromMatrixColumn(e,0).length(),o=1/r_.setFromMatrixColumn(e,1).length(),l=1/r_.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*l,t[9]=i[9]*l,t[10]=i[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,r=e.y,o=e.z,l=Math.cos(i),c=Math.sin(i),d=Math.cos(r),p=Math.sin(r),y=Math.cos(o),v=Math.sin(o);if("XYZ"===e.order){const x=l*y,b=l*v,S=c*y,E=c*v;t[0]=d*y,t[4]=-d*v,t[8]=p,t[1]=b+S*p,t[5]=x-E*p,t[9]=-c*d,t[2]=E-x*p,t[6]=S+b*p,t[10]=l*d}else if("YXZ"===e.order){const x=d*y,b=d*v,S=p*y,E=p*v;t[0]=x+E*c,t[4]=S*c-b,t[8]=l*p,t[1]=l*v,t[5]=l*y,t[9]=-c,t[2]=b*c-S,t[6]=E+x*c,t[10]=l*d}else if("ZXY"===e.order){const x=d*y,b=d*v,S=p*y,E=p*v;t[0]=x-E*c,t[4]=-l*v,t[8]=S+b*c,t[1]=b+S*c,t[5]=l*y,t[9]=E-x*c,t[2]=-l*p,t[6]=c,t[10]=l*d}else if("ZYX"===e.order){const x=l*y,b=l*v,S=c*y,E=c*v;t[0]=d*y,t[4]=S*p-b,t[8]=x*p+E,t[1]=d*v,t[5]=E*p+x,t[9]=b*p-S,t[2]=-p,t[6]=c*d,t[10]=l*d}else if("YZX"===e.order){const x=l*d,b=l*p,S=c*d,E=c*p;t[0]=d*y,t[4]=E-x*v,t[8]=S*v+b,t[1]=v,t[5]=l*y,t[9]=-c*y,t[2]=-p*y,t[6]=b*v+S,t[10]=x-E*v}else if("XZY"===e.order){const x=l*d,b=l*p,S=c*d,E=c*p;t[0]=d*y,t[4]=-v,t[8]=p*y,t[1]=x*v+E,t[5]=l*y,t[9]=b*v-S,t[2]=S*v-b,t[6]=c*y,t[10]=E*v+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(H6,e,G6)}lookAt(e,t,i){const r=this.elements;return ll.subVectors(e,t),0===ll.lengthSq()&&(ll.z=1),ll.normalize(),Mf.crossVectors(i,ll),0===Mf.lengthSq()&&(1===Math.abs(i.z)?ll.x+=1e-4:ll.z+=1e-4,ll.normalize(),Mf.crossVectors(i,ll)),Mf.normalize(),vE.crossVectors(ll,Mf),r[0]=Mf.x,r[4]=vE.x,r[8]=ll.x,r[1]=Mf.y,r[5]=vE.y,r[9]=ll.y,r[2]=Mf.z,r[6]=vE.z,r[10]=ll.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,l=i[0],c=i[4],d=i[8],p=i[12],y=i[1],v=i[5],x=i[9],b=i[13],S=i[2],E=i[6],T=i[10],N=i[14],F=i[3],U=i[7],k=i[11],H=i[15],Q=r[0],ie=r[4],ce=r[8],De=r[12],ve=r[1],q=r[5],oe=r[9],qe=r[13],be=r[2],Le=r[6],de=r[10],xe=r[14],ue=r[3],Re=r[7],Ye=r[11],gt=r[15];return o[0]=l*Q+c*ve+d*be+p*ue,o[4]=l*ie+c*q+d*Le+p*Re,o[8]=l*ce+c*oe+d*de+p*Ye,o[12]=l*De+c*qe+d*xe+p*gt,o[1]=y*Q+v*ve+x*be+b*ue,o[5]=y*ie+v*q+x*Le+b*Re,o[9]=y*ce+v*oe+x*de+b*Ye,o[13]=y*De+v*qe+x*xe+b*gt,o[2]=S*Q+E*ve+T*be+N*ue,o[6]=S*ie+E*q+T*Le+N*Re,o[10]=S*ce+E*oe+T*de+N*Ye,o[14]=S*De+E*qe+T*xe+N*gt,o[3]=F*Q+U*ve+k*be+H*ue,o[7]=F*ie+U*q+k*Le+H*Re,o[11]=F*ce+U*oe+k*de+H*Ye,o[15]=F*De+U*qe+k*xe+H*gt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],l=e[1],c=e[5],d=e[9],p=e[13],y=e[2],v=e[6],x=e[10],b=e[14];return e[3]*(+o*d*v-r*p*v-o*c*x+i*p*x+r*c*b-i*d*b)+e[7]*(+t*d*b-t*p*x+o*l*x-r*l*b+r*p*y-o*d*y)+e[11]*(+t*p*v-t*c*b-o*l*v+i*l*b+o*c*y-i*p*y)+e[15]*(-r*c*y-t*d*v+t*c*x+r*l*v-i*l*x+i*d*y)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],l=e[4],c=e[5],d=e[6],p=e[7],y=e[8],v=e[9],x=e[10],b=e[11],S=e[12],E=e[13],T=e[14],N=e[15],F=v*T*p-E*x*p+E*d*b-c*T*b-v*d*N+c*x*N,U=S*x*p-y*T*p-S*d*b+l*T*b+y*d*N-l*x*N,k=y*E*p-S*v*p+S*c*b-l*E*b-y*c*N+l*v*N,H=S*v*d-y*E*d-S*c*x+l*E*x+y*c*T-l*v*T,Q=t*F+i*U+r*k+o*H;if(0===Q)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ie=1/Q;return e[0]=F*ie,e[1]=(E*x*o-v*T*o-E*r*b+i*T*b+v*r*N-i*x*N)*ie,e[2]=(c*T*o-E*d*o+E*r*p-i*T*p-c*r*N+i*d*N)*ie,e[3]=(v*d*o-c*x*o-v*r*p+i*x*p+c*r*b-i*d*b)*ie,e[4]=U*ie,e[5]=(y*T*o-S*x*o+S*r*b-t*T*b-y*r*N+t*x*N)*ie,e[6]=(S*d*o-l*T*o-S*r*p+t*T*p+l*r*N-t*d*N)*ie,e[7]=(l*x*o-y*d*o+y*r*p-t*x*p-l*r*b+t*d*b)*ie,e[8]=k*ie,e[9]=(S*v*o-y*E*o-S*i*b+t*E*b+y*i*N-t*v*N)*ie,e[10]=(l*E*o-S*c*o+S*i*p-t*E*p-l*i*N+t*c*N)*ie,e[11]=(y*c*o-l*v*o-y*i*p+t*v*p+l*i*b-t*c*b)*ie,e[12]=H*ie,e[13]=(y*E*r-S*v*r+S*i*x-t*E*x-y*i*T+t*v*T)*ie,e[14]=(S*c*r-l*E*r-S*i*d+t*E*d+l*i*T-t*c*T)*ie,e[15]=(l*v*r-y*c*r+y*i*d-t*v*d-l*i*x+t*c*x)*ie,this}scale(e){const t=this.elements,i=e.x,r=e.y,o=e.z;return t[0]*=i,t[4]*=r,t[8]*=o,t[1]*=i,t[5]*=r,t[9]*=o,t[2]*=i,t[6]*=r,t[10]*=o,t[3]*=i,t[7]*=r,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),o=1-i,l=e.x,c=e.y,d=e.z,p=o*l,y=o*c;return this.set(p*l+i,p*c-r*d,p*d+r*c,0,p*c+r*d,y*c+i,y*d-r*l,0,p*d-r*c,y*d+r*l,o*d*d+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,o,l){return this.set(1,i,o,0,e,1,l,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,o=t._x,l=t._y,c=t._z,d=t._w,p=o+o,y=l+l,v=c+c,x=o*p,b=o*y,S=o*v,E=l*y,T=l*v,N=c*v,F=d*p,U=d*y,k=d*v,H=i.x,Q=i.y,ie=i.z;return r[0]=(1-(E+N))*H,r[1]=(b+k)*H,r[2]=(S-U)*H,r[3]=0,r[4]=(b-k)*Q,r[5]=(1-(x+N))*Q,r[6]=(T+F)*Q,r[7]=0,r[8]=(S+U)*ie,r[9]=(T-F)*ie,r[10]=(1-(x+E))*ie,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let o=r_.set(r[0],r[1],r[2]).length();const l=r_.set(r[4],r[5],r[6]).length(),c=r_.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],Ec.copy(this);const p=1/o,y=1/l,v=1/c;return Ec.elements[0]*=p,Ec.elements[1]*=p,Ec.elements[2]*=p,Ec.elements[4]*=y,Ec.elements[5]*=y,Ec.elements[6]*=y,Ec.elements[8]*=v,Ec.elements[9]*=v,Ec.elements[10]*=v,t.setFromRotationMatrix(Ec),i.x=o,i.y=l,i.z=c,this}makePerspective(e,t,i,r,o,l){void 0===l&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const c=this.elements,p=2*o/(i-r),y=(t+e)/(t-e),v=(i+r)/(i-r),x=-(l+o)/(l-o),b=-2*l*o/(l-o);return c[0]=2*o/(t-e),c[4]=0,c[8]=y,c[12]=0,c[1]=0,c[5]=p,c[9]=v,c[13]=0,c[2]=0,c[6]=0,c[10]=x,c[14]=b,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,r,o,l){const c=this.elements,d=1/(t-e),p=1/(i-r),y=1/(l-o),v=(t+e)*d,x=(i+r)*p,b=(l+o)*y;return c[0]=2*d,c[4]=0,c[8]=0,c[12]=-v,c[1]=0,c[5]=2*p,c[9]=0,c[13]=-x,c[2]=0,c[6]=0,c[10]=-2*y,c[14]=-b,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Tt.prototype.isMatrix4=!0;const r_=new $,Ec=new Tt,H6=new $(0,0,0),G6=new $(1,1,1),Mf=new $,vE=new $,ll=new $,$O=new Tt,YO=new Mo;class Nm{constructor(e=0,t=0,i=0,r=Nm.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,o=r[0],l=r[4],c=r[8],d=r[1],p=r[5],y=r[9],v=r[2],x=r[6],b=r[10];switch(t){case"XYZ":this._y=Math.asin(Rs(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-y,b),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(x,p),this._z=0);break;case"YXZ":this._x=Math.asin(-Rs(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(c,b),this._z=Math.atan2(d,p)):(this._y=Math.atan2(-v,o),this._z=0);break;case"ZXY":this._x=Math.asin(Rs(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-v,b),this._z=Math.atan2(-l,p)):(this._y=0,this._z=Math.atan2(d,o));break;case"ZYX":this._y=Math.asin(-Rs(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(x,b),this._z=Math.atan2(d,o)):(this._x=0,this._z=Math.atan2(-l,p));break;case"YZX":this._z=Math.asin(Rs(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-y,p),this._y=Math.atan2(-v,o)):(this._x=0,this._y=Math.atan2(c,b));break;case"XZY":this._z=Math.asin(-Rs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(x,p),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-y,b),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return $O.makeRotationFromQuaternion(e),this.setFromRotationMatrix($O,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return YO.setFromEuler(this),this.setFromQuaternion(YO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Nm.prototype.isEuler=!0,Nm.DefaultOrder="XYZ",Nm.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class QR{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let W6=0;const KO=new $,s_=new Mo,zh=new Tt,xE=new $,Fx=new $,q6=new $,j6=new Mo,ZO=new $(1,0,0),JO=new $(0,1,0),QO=new $(0,0,1),X6={type:"added"},e3={type:"removed"};class Yi extends _f{constructor(){super(),Object.defineProperty(this,"id",{value:W6++}),this.uuid=ol(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Yi.DefaultUp.clone();const e=new $,t=new Nm,i=new Mo,r=new $(1,1,1);t._onChange(function o(){i.setFromEuler(t,!1)}),i._onChange(function l(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Tt},normalMatrix:{value:new wo}}),this.matrix=new Tt,this.matrixWorld=new Tt,this.matrixAutoUpdate=Yi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new QR,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return s_.setFromAxisAngle(e,t),this.quaternion.multiply(s_),this}rotateOnWorldAxis(e,t){return s_.setFromAxisAngle(e,t),this.quaternion.premultiply(s_),this}rotateX(e){return this.rotateOnAxis(ZO,e)}rotateY(e){return this.rotateOnAxis(JO,e)}rotateZ(e){return this.rotateOnAxis(QO,e)}translateOnAxis(e,t){return KO.copy(e).applyQuaternion(this.quaternion),this.position.add(KO.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ZO,e)}translateY(e){return this.translateOnAxis(JO,e)}translateZ(e){return this.translateOnAxis(QO,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(zh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?xE.copy(e):xE.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Fx.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?zh.lookAt(Fx,xE,this.up):zh.lookAt(xE,Fx,this.up),this.quaternion.setFromRotationMatrix(zh),r&&(zh.extractRotation(r.matrixWorld),s_.setFromRotationMatrix(zh),this.quaternion.premultiply(s_.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(X6)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(e3)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(e3)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),zh.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),zh.multiply(e.parent.matrixWorld)),e.applyMatrix4(zh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const l=this.children[i].getObjectByProperty(e,t);if(void 0!==l)return l}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fx,e,q6),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fx,j6,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const r=this.children;for(let o=0,l=r.length;o<l;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function o(c,d){return void 0===c[d.uuid]&&(c[d.uuid]=d.toJSON(e)),d.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const d=c.shapes;if(Array.isArray(d))for(let p=0,y=d.length;p<y;p++)o(e.shapes,d[p]);else o(e.shapes,d)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let d=0,p=this.material.length;d<p;d++)c.push(o(e.materials,this.material[d]));r.material=c}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let c=0;c<this.children.length;c++)r.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let c=0;c<this.animations.length;c++)r.animations.push(o(e.animations,this.animations[c]))}if(t){const c=l(e.geometries),d=l(e.materials),p=l(e.textures),y=l(e.images),v=l(e.shapes),x=l(e.skeletons),b=l(e.animations),S=l(e.nodes);c.length>0&&(i.geometries=c),d.length>0&&(i.materials=d),p.length>0&&(i.textures=p),y.length>0&&(i.images=y),v.length>0&&(i.shapes=v),x.length>0&&(i.skeletons=x),b.length>0&&(i.animations=b),S.length>0&&(i.nodes=S)}return i.object=r,i;function l(c){const d=[];for(const p in c){const y=c[p];delete y.metadata,d.push(y)}return d}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++)this.add(e.children[i].clone());return this}}Yi.DefaultUp=new $(0,1,0),Yi.DefaultMatrixAutoUpdate=!0,Yi.prototype.isObject3D=!0;const Cc=new $,Hh=new $,eP=new $,Gh=new $,o_=new $,a_=new $,t3=new $,tP=new $,nP=new $,iP=new $;class Ws{constructor(e=new $,t=new $,i=new $){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Cc.subVectors(e,t),r.cross(Cc);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,t,i,r,o){Cc.subVectors(r,t),Hh.subVectors(i,t),eP.subVectors(e,t);const l=Cc.dot(Cc),c=Cc.dot(Hh),d=Cc.dot(eP),p=Hh.dot(Hh),y=Hh.dot(eP),v=l*p-c*c;if(0===v)return o.set(-2,-1,-1);const x=1/v,b=(p*d-c*y)*x,S=(l*y-c*d)*x;return o.set(1-b-S,S,b)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Gh),Gh.x>=0&&Gh.y>=0&&Gh.x+Gh.y<=1}static getUV(e,t,i,r,o,l,c,d){return this.getBarycoord(e,t,i,r,Gh),d.set(0,0),d.addScaledVector(o,Gh.x),d.addScaledVector(l,Gh.y),d.addScaledVector(c,Gh.z),d}static isFrontFacing(e,t,i,r){return Cc.subVectors(i,t),Hh.subVectors(e,t),Cc.cross(Hh).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Cc.subVectors(this.c,this.b),Hh.subVectors(this.a,this.b),.5*Cc.cross(Hh).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ws.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ws.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,o){return Ws.getUV(e,this.a,this.b,this.c,t,i,r,o)}containsPoint(e){return Ws.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ws.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,o=this.c;let l,c;o_.subVectors(r,i),a_.subVectors(o,i),tP.subVectors(e,i);const d=o_.dot(tP),p=a_.dot(tP);if(d<=0&&p<=0)return t.copy(i);nP.subVectors(e,r);const y=o_.dot(nP),v=a_.dot(nP);if(y>=0&&v<=y)return t.copy(r);const x=d*v-y*p;if(x<=0&&d>=0&&y<=0)return l=d/(d-y),t.copy(i).addScaledVector(o_,l);iP.subVectors(e,o);const b=o_.dot(iP),S=a_.dot(iP);if(S>=0&&b<=S)return t.copy(o);const E=b*p-d*S;if(E<=0&&p>=0&&S<=0)return c=p/(p-S),t.copy(i).addScaledVector(a_,c);const T=y*S-b*v;if(T<=0&&v-y>=0&&b-S>=0)return t3.subVectors(o,r),c=(v-y)/(v-y+(b-S)),t.copy(r).addScaledVector(t3,c);const N=1/(T+E+x);return l=E*N,c=x*N,t.copy(i).addScaledVector(o_,l).addScaledVector(a_,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let $6=0;class qs extends _f{constructor(){super(),Object.defineProperty(this,"id",{value:$6++}),this.uuid=ol(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(o){const l=[];for(const c in o){const d=o[c];delete d.metadata,l.push(d)}return l}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const o=r(e.textures),l=r(e.images);o.length>0&&(i.textures=o),l.length>0&&(i.images=l)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}qs.prototype.isMaterial=!0,qs.fromType=function(){return null};class hu extends qs{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}hu.prototype.isMeshBasicMaterial=!0;const js=new $,bE=new ct;class Lr{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=Ax,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),l=new Ht),t[i++]=l.r,t[i++]=l.g,t[i++]=l.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),l=new ct),t[i++]=l.x,t[i++]=l.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),l=new $),t[i++]=l.x,t[i++]=l.y,t[i++]=l.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let l=e[r];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),l=new Qi),t[i++]=l.x,t[i++]=l.y,t[i++]=l.z,t[i++]=l.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)bE.fromBufferAttribute(this,t),bE.applyMatrix3(e),this.setXY(t,bE.x,bE.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)js.fromBufferAttribute(this,t),js.applyMatrix3(e),this.setXYZ(t,js.x,js.y,js.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)js.fromBufferAttribute(this,t),js.applyMatrix4(e),this.setXYZ(t,js.x,js.y,js.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)js.fromBufferAttribute(this,t),js.applyNormalMatrix(e),this.setXYZ(t,js.x,js.y,js.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)js.fromBufferAttribute(this,t),js.transformDirection(e),this.setXYZ(t,js.x,js.y,js.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Ax&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}Lr.prototype.isBufferAttribute=!0;class n3 extends Lr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class i3 extends Lr{constructor(e,t,i){super(new Uint32Array(e),t,i)}}(class Y6 extends Lr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}).prototype.isFloat16BufferAttribute=!0;class Jt extends Lr{constructor(e,t,i){super(new Float32Array(e),t,i)}}let K6=0;const Wl=new Tt,rP=new Yi,l_=new $,cl=new Ko,Nx=new Ko,So=new $;class Tn extends _f{constructor(){super(),Object.defineProperty(this,"id",{value:K6++}),this.uuid=ol(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(WO(e)?i3:n3)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const o=(new wo).getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Wl.makeRotationFromQuaternion(e),this.applyMatrix4(Wl),this}rotateX(e){return Wl.makeRotationX(e),this.applyMatrix4(Wl),this}rotateY(e){return Wl.makeRotationY(e),this.applyMatrix4(Wl),this}rotateZ(e){return Wl.makeRotationZ(e),this.applyMatrix4(Wl),this}translate(e,t,i){return Wl.makeTranslation(e,t,i),this.applyMatrix4(Wl),this}scale(e,t,i){return Wl.makeScale(e,t,i),this.applyMatrix4(Wl),this}lookAt(e){return rP.lookAt(e),rP.updateMatrix(),this.applyMatrix4(rP.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(l_).negate(),this.translate(l_.x,l_.y,l_.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Jt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ko);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new $(-1/0,-1/0,-1/0),new $(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)cl.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(So.addVectors(this.boundingBox.min,cl.min),this.boundingBox.expandByPoint(So),So.addVectors(this.boundingBox.max,cl.max),this.boundingBox.expandByPoint(So)):(this.boundingBox.expandByPoint(cl.min),this.boundingBox.expandByPoint(cl.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new uu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new $,1/0);if(e){const i=this.boundingSphere.center;if(cl.setFromBufferAttribute(e),t)for(let o=0,l=t.length;o<l;o++)Nx.setFromBufferAttribute(t[o]),this.morphTargetsRelative?(So.addVectors(cl.min,Nx.min),cl.expandByPoint(So),So.addVectors(cl.max,Nx.max),cl.expandByPoint(So)):(cl.expandByPoint(Nx.min),cl.expandByPoint(Nx.max));cl.getCenter(i);let r=0;for(let o=0,l=e.count;o<l;o++)So.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(So));if(t)for(let o=0,l=t.length;o<l;o++){const c=t[o],d=this.morphTargetsRelative;for(let p=0,y=c.count;p<y;p++)So.fromBufferAttribute(c,p),d&&(l_.fromBufferAttribute(e,p),So.add(l_)),r=Math.max(r,i.distanceToSquared(So))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,o=t.normal.array,l=t.uv.array,c=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Lr(new Float32Array(4*c),4));const d=this.getAttribute("tangent").array,p=[],y=[];for(let ve=0;ve<c;ve++)p[ve]=new $,y[ve]=new $;const v=new $,x=new $,b=new $,S=new ct,E=new ct,T=new ct,N=new $,F=new $;function U(ve,q,oe){v.fromArray(r,3*ve),x.fromArray(r,3*q),b.fromArray(r,3*oe),S.fromArray(l,2*ve),E.fromArray(l,2*q),T.fromArray(l,2*oe),x.sub(v),b.sub(v),E.sub(S),T.sub(S);const qe=1/(E.x*T.y-T.x*E.y);!isFinite(qe)||(N.copy(x).multiplyScalar(T.y).addScaledVector(b,-E.y).multiplyScalar(qe),F.copy(b).multiplyScalar(E.x).addScaledVector(x,-T.x).multiplyScalar(qe),p[ve].add(N),p[q].add(N),p[oe].add(N),y[ve].add(F),y[q].add(F),y[oe].add(F))}let k=this.groups;0===k.length&&(k=[{start:0,count:i.length}]);for(let ve=0,q=k.length;ve<q;++ve){const oe=k[ve],qe=oe.start;for(let Le=qe,de=qe+oe.count;Le<de;Le+=3)U(i[Le+0],i[Le+1],i[Le+2])}const H=new $,Q=new $,ie=new $,ce=new $;function De(ve){ie.fromArray(o,3*ve),ce.copy(ie);const q=p[ve];H.copy(q),H.sub(ie.multiplyScalar(ie.dot(q))).normalize(),Q.crossVectors(ce,q);const qe=Q.dot(y[ve])<0?-1:1;d[4*ve]=H.x,d[4*ve+1]=H.y,d[4*ve+2]=H.z,d[4*ve+3]=qe}for(let ve=0,q=k.length;ve<q;++ve){const oe=k[ve],qe=oe.start;for(let Le=qe,de=qe+oe.count;Le<de;Le+=3)De(i[Le+0]),De(i[Le+1]),De(i[Le+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Lr(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let x=0,b=i.count;x<b;x++)i.setXYZ(x,0,0,0);const r=new $,o=new $,l=new $,c=new $,d=new $,p=new $,y=new $,v=new $;if(e)for(let x=0,b=e.count;x<b;x+=3){const S=e.getX(x+0),E=e.getX(x+1),T=e.getX(x+2);r.fromBufferAttribute(t,S),o.fromBufferAttribute(t,E),l.fromBufferAttribute(t,T),y.subVectors(l,o),v.subVectors(r,o),y.cross(v),c.fromBufferAttribute(i,S),d.fromBufferAttribute(i,E),p.fromBufferAttribute(i,T),c.add(y),d.add(y),p.add(y),i.setXYZ(S,c.x,c.y,c.z),i.setXYZ(E,d.x,d.y,d.z),i.setXYZ(T,p.x,p.y,p.z)}else for(let x=0,b=t.count;x<b;x+=3)r.fromBufferAttribute(t,x+0),o.fromBufferAttribute(t,x+1),l.fromBufferAttribute(t,x+2),y.subVectors(l,o),v.subVectors(r,o),y.cross(v),i.setXYZ(x+0,y.x,y.y,y.z),i.setXYZ(x+1,y.x,y.y,y.z),i.setXYZ(x+2,y.x,y.y,y.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const r in i){if(void 0===e.attributes[r])continue;const l=i[r].array,c=e.attributes[r],d=c.array,p=c.itemSize*t,y=Math.min(d.length,l.length-p);for(let v=0,x=p;v<y;v++,x++)l[x]=d[v]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)So.fromBufferAttribute(e,t),So.normalize(),e.setXYZ(t,So.x,So.y,So.z)}toNonIndexed(){function e(c,d){const p=c.array,y=c.itemSize,v=c.normalized,x=new p.constructor(d.length*y);let b=0,S=0;for(let E=0,T=d.length;E<T;E++){b=c.isInterleavedBufferAttribute?d[E]*c.data.stride+c.offset:d[E]*y;for(let N=0;N<y;N++)x[S++]=p[b++]}return new Lr(x,y,v)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Tn,i=this.index.array,r=this.attributes;for(const c in r){const p=e(r[c],i);t.setAttribute(c,p)}const o=this.morphAttributes;for(const c in o){const d=[],p=o[c];for(let y=0,v=p.length;y<v;y++){const b=e(p[y],i);d.push(b)}t.morphAttributes[c]=d}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let c=0,d=l.length;c<d;c++){const p=l[c];t.addGroup(p.start,p.count,p.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const d=this.parameters;for(const p in d)void 0!==d[p]&&(e[p]=d[p]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const d in i)e.data.attributes[d]=i[d].toJSON(e.data);const r={};let o=!1;for(const d in this.morphAttributes){const p=this.morphAttributes[d],y=[];for(let v=0,x=p.length;v<x;v++)y.push(p[v].toJSON(e.data));y.length>0&&(r[d]=y,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const c=this.boundingSphere;return null!==c&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const p in r)this.setAttribute(p,r[p].clone(t));const o=e.morphAttributes;for(const p in o){const y=[],v=o[p];for(let x=0,b=v.length;x<b;x++)y.push(v[x].clone(t));this.morphAttributes[p]=y}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let p=0,y=l.length;p<y;p++){const v=l[p];this.addGroup(v.start,v.count,v.materialIndex)}const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Tn.prototype.isBufferGeometry=!0;const r3=new Tt,c_=new wf,sP=new uu,Sf=new $,Ef=new $,Cf=new $,oP=new $,aP=new $,lP=new $,wE=new $,ME=new $,SE=new $,EE=new ct,CE=new ct,TE=new ct,cP=new $,AE=new $;class Xs extends Yi{constructor(e=new Tn,t=new hu){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=r.length;o<l;o++){const c=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=o}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,r=this.material,o=this.matrixWorld;if(void 0===r||(null===i.boundingSphere&&i.computeBoundingSphere(),sP.copy(i.boundingSphere),sP.applyMatrix4(o),!1===e.ray.intersectsSphere(sP))||(r3.copy(o).invert(),c_.copy(e.ray).applyMatrix4(r3),null!==i.boundingBox&&!1===c_.intersectsBox(i.boundingBox)))return;let l;if(i.isBufferGeometry){const c=i.index,d=i.attributes.position,p=i.morphAttributes.position,y=i.morphTargetsRelative,v=i.attributes.uv,x=i.attributes.uv2,b=i.groups,S=i.drawRange;if(null!==c)if(Array.isArray(r))for(let E=0,T=b.length;E<T;E++){const N=b[E],F=r[N.materialIndex];for(let H=Math.max(N.start,S.start),Q=Math.min(c.count,Math.min(N.start+N.count,S.start+S.count));H<Q;H+=3){const ie=c.getX(H),ce=c.getX(H+1),De=c.getX(H+2);l=DE(this,F,e,c_,d,p,y,v,x,ie,ce,De),l&&(l.faceIndex=Math.floor(H/3),l.face.materialIndex=N.materialIndex,t.push(l))}}else for(let N=Math.max(0,S.start),F=Math.min(c.count,S.start+S.count);N<F;N+=3){const U=c.getX(N),k=c.getX(N+1),H=c.getX(N+2);l=DE(this,r,e,c_,d,p,y,v,x,U,k,H),l&&(l.faceIndex=Math.floor(N/3),t.push(l))}else if(void 0!==d)if(Array.isArray(r))for(let E=0,T=b.length;E<T;E++){const N=b[E],F=r[N.materialIndex];for(let H=Math.max(N.start,S.start),Q=Math.min(d.count,Math.min(N.start+N.count,S.start+S.count));H<Q;H+=3)l=DE(this,F,e,c_,d,p,y,v,x,H,H+1,H+2),l&&(l.faceIndex=Math.floor(H/3),l.face.materialIndex=N.materialIndex,t.push(l))}else for(let N=Math.max(0,S.start),F=Math.min(d.count,S.start+S.count);N<F;N+=3)l=DE(this,r,e,c_,d,p,y,v,x,N,N+1,N+2),l&&(l.faceIndex=Math.floor(N/3),t.push(l))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function DE(n,e,t,i,r,o,l,c,d,p,y,v){Sf.fromBufferAttribute(r,p),Ef.fromBufferAttribute(r,y),Cf.fromBufferAttribute(r,v);const x=n.morphTargetInfluences;if(o&&x){wE.set(0,0,0),ME.set(0,0,0),SE.set(0,0,0);for(let S=0,E=o.length;S<E;S++){const T=x[S],N=o[S];0!==T&&(oP.fromBufferAttribute(N,p),aP.fromBufferAttribute(N,y),lP.fromBufferAttribute(N,v),l?(wE.addScaledVector(oP,T),ME.addScaledVector(aP,T),SE.addScaledVector(lP,T)):(wE.addScaledVector(oP.sub(Sf),T),ME.addScaledVector(aP.sub(Ef),T),SE.addScaledVector(lP.sub(Cf),T)))}Sf.add(wE),Ef.add(ME),Cf.add(SE)}n.isSkinnedMesh&&(n.boneTransform(p,Sf),n.boneTransform(y,Ef),n.boneTransform(v,Cf));const b=function Z6(n,e,t,i,r,o,l,c){let d;if(d=1===e.side?i.intersectTriangle(l,o,r,!0,c):i.intersectTriangle(r,o,l,2!==e.side,c),null===d)return null;AE.copy(c),AE.applyMatrix4(n.matrixWorld);const p=t.ray.origin.distanceTo(AE);return p<t.near||p>t.far?null:{distance:p,point:AE.clone(),object:n}}(n,e,t,i,Sf,Ef,Cf,cP);if(b){c&&(EE.fromBufferAttribute(c,p),CE.fromBufferAttribute(c,y),TE.fromBufferAttribute(c,v),b.uv=Ws.getUV(cP,Sf,Ef,Cf,EE,CE,TE,new ct)),d&&(EE.fromBufferAttribute(d,p),CE.fromBufferAttribute(d,y),TE.fromBufferAttribute(d,v),b.uv2=Ws.getUV(cP,Sf,Ef,Cf,EE,CE,TE,new ct));const S={a:p,b:y,c:v,normal:new $,materialIndex:0};Ws.getNormal(Sf,Ef,Cf,S.normal),b.face=S}return b}Xs.prototype.isMesh=!0;class Om extends Tn{constructor(e=1,t=1,i=1,r=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:o,depthSegments:l};const c=this;r=Math.floor(r),o=Math.floor(o),l=Math.floor(l);const d=[],p=[],y=[],v=[];let x=0,b=0;function S(E,T,N,F,U,k,H,Q,ie,ce,De){const ve=k/ie,q=H/ce,oe=k/2,qe=H/2,be=Q/2,Le=ie+1,de=ce+1;let xe=0,ue=0;const Re=new $;for(let Ye=0;Ye<de;Ye++){const gt=Ye*q-qe;for(let st=0;st<Le;st++)Re[E]=(st*ve-oe)*F,Re[T]=gt*U,Re[N]=be,p.push(Re.x,Re.y,Re.z),Re[E]=0,Re[T]=0,Re[N]=Q>0?1:-1,y.push(Re.x,Re.y,Re.z),v.push(st/ie),v.push(1-Ye/ce),xe+=1}for(let Ye=0;Ye<ce;Ye++)for(let gt=0;gt<ie;gt++){const ln=x+gt+Le*(Ye+1),hn=x+(gt+1)+Le*(Ye+1),qn=x+(gt+1)+Le*Ye;d.push(x+gt+Le*Ye,ln,qn),d.push(ln,hn,qn),ue+=6}c.addGroup(b,ue,De),b+=ue,x+=xe}S("z","y","x",-1,-1,i,t,e,l,o,0),S("z","y","x",1,-1,i,t,-e,l,o,1),S("x","z","y",1,1,e,i,t,r,l,2),S("x","z","y",1,-1,e,i,-t,r,l,3),S("x","y","z",1,-1,e,t,i,r,o,4),S("x","y","z",-1,-1,e,t,-i,r,o,5),this.setIndex(d),this.setAttribute("position",new Jt(p,3)),this.setAttribute("normal",new Jt(y,3)),this.setAttribute("uv",new Jt(v,2))}static fromJSON(e){return new Om(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function u_(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];e[t][i]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}}return e}function Zo(n){const e={};for(let t=0;t<n.length;t++){const i=u_(n[t]);for(const r in i)e[r]=i[r]}return e}const uP={clone:u_,merge:Zo};class ql extends qs{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=u_(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const l=this.uniforms[r].value;t.uniforms[r]=l&&l.isTexture?{type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?{type:"c",value:l.getHex()}:l&&l.isVector2?{type:"v2",value:l.toArray()}:l&&l.isVector3?{type:"v3",value:l.toArray()}:l&&l.isVector4?{type:"v4",value:l.toArray()}:l&&l.isMatrix3?{type:"m3",value:l.toArray()}:l&&l.isMatrix4?{type:"m4",value:l.toArray()}:{value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}ql.prototype.isShaderMaterial=!0;class RE extends Yi{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Tt,this.projectionMatrix=new Tt,this.projectionMatrixInverse=new Tt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}RE.prototype.isCamera=!0;class Eo extends RE{constructor(e=50,t=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Rx*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Dm*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Rx*Math.atan(Math.tan(.5*Dm*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,o,l){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Dm*this.fov)/this.zoom,i=2*t,r=this.aspect*i,o=-.5*r;const l=this.view;if(null!==this.view&&this.view.enabled){const d=l.fullWidth,p=l.fullHeight;o+=l.offsetX*r/d,t-=l.offsetY*i/p,r*=l.width/d,i*=l.height/p}const c=this.filmOffset;0!==c&&(o+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Eo.prototype.isPerspectiveCamera=!0;class hP extends Yi{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const r=new Eo(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new $(1,0,0)),this.add(r);const o=new Eo(90,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new $(-1,0,0)),this.add(o);const l=new Eo(90,1,e,t);l.layers=this.layers,l.up.set(0,0,1),l.lookAt(new $(0,1,0)),this.add(l);const c=new Eo(90,1,e,t);c.layers=this.layers,c.up.set(0,0,-1),c.lookAt(new $(0,-1,0)),this.add(c);const d=new Eo(90,1,e,t);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new $(0,0,1)),this.add(d);const p=new Eo(90,1,e,t);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new $(0,0,-1)),this.add(p)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,o,l,c,d,p]=this.children,y=e.getRenderTarget(),v=e.outputEncoding,x=e.toneMapping,b=e.xr.enabled;e.outputEncoding=kh,e.toneMapping=0,e.xr.enabled=!1;const S=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,o),e.setRenderTarget(i,2),e.render(t,l),e.setRenderTarget(i,3),e.render(t,c),e.setRenderTarget(i,4),e.render(t,d),i.texture.generateMipmaps=S,e.setRenderTarget(i,5),e.render(t,p),e.setRenderTarget(y),e.outputEncoding=v,e.toneMapping=x,e.xr.enabled=b,i.texture.needsPMREMUpdate=!0}}class Ox extends Ha{constructor(e,t,i,r,o,l,c,d,p,y){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,r,o,l,c,d,p,y),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ox.prototype.isCubeTexture=!0;class s3 extends al{constructor(e,t={}){super(e,e,t);const i={width:e,height:e,depth:1};this.texture=new Ox([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Gs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new Om(5,5,5),o=new ql({name:"CubemapFromEquirect",uniforms:u_(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=t;const l=new Xs(r,o),c=t.minFilter;return 1008===t.minFilter&&(t.minFilter=Gs),new hP(1,10,this).update(e,l),t.minFilter=c,l.geometry.dispose(),l.material.dispose(),this}clear(e,t,i,r){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,i,r);e.setRenderTarget(o)}}s3.prototype.isWebGLCubeRenderTarget=!0;const dP=new $,eq=new $,tq=new wo;class Wh{constructor(e=new $(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=dP.subVectors(i,t).cross(eq.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(dP),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:t.copy(i).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||tq.getNormalMatrix(e),r=this.coplanarPoint(dP).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Wh.prototype.isPlane=!0;const f_=new uu,PE=new $;class IE{constructor(e=new Wh,t=new Wh,i=new Wh,r=new Wh,o=new Wh,l=new Wh){this.planes=[e,t,i,r,o,l]}set(e,t,i,r,o,l){const c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(i),c[3].copy(r),c[4].copy(o),c[5].copy(l),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],o=i[1],l=i[2],c=i[3],d=i[4],p=i[5],y=i[6],v=i[7],x=i[8],b=i[9],S=i[10],E=i[11],T=i[12],N=i[13],F=i[14],U=i[15];return t[0].setComponents(c-r,v-d,E-x,U-T).normalize(),t[1].setComponents(c+r,v+d,E+x,U+T).normalize(),t[2].setComponents(c+o,v+p,E+b,U+N).normalize(),t[3].setComponents(c-o,v-p,E-b,U-N).normalize(),t[4].setComponents(c-l,v-y,E-S,U-F).normalize(),t[5].setComponents(c+l,v+y,E+S,U+F).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),f_.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(f_)}intersectsSprite(e){return f_.center.set(0,0,0),f_.radius=.7071067811865476,f_.applyMatrix4(e.matrixWorld),this.intersectsSphere(f_)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(PE.x=r.normal.x>0?e.max.x:e.min.x,PE.y=r.normal.y>0?e.max.y:e.min.y,PE.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(PE)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function o3(){let n=null,e=!1,t=null,i=null;function r(o,l){t(o,l),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function nq(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function l(p){return p.isInterleavedBufferAttribute&&(p=p.data),i.get(p)},remove:function c(p){p.isInterleavedBufferAttribute&&(p=p.data);const y=i.get(p);y&&(n.deleteBuffer(y.buffer),i.delete(p))},update:function d(p,y){if(p.isGLBufferAttribute){const x=i.get(p);return void((!x||x.version<p.version)&&i.set(p,{buffer:p.buffer,type:p.type,bytesPerElement:p.elementSize,version:p.version}))}p.isInterleavedBufferAttribute&&(p=p.data);const v=i.get(p);void 0===v?i.set(p,function r(p,y){const v=p.array,x=p.usage,b=n.createBuffer();let S;if(n.bindBuffer(y,b),n.bufferData(y,v,x),p.onUploadCallback(),v instanceof Float32Array)S=5126;else if(v instanceof Uint16Array)if(p.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");S=5131}else S=5123;else if(v instanceof Int16Array)S=5122;else if(v instanceof Uint32Array)S=5125;else if(v instanceof Int32Array)S=5124;else if(v instanceof Int8Array)S=5120;else if(v instanceof Uint8Array)S=5121;else{if(!(v instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+v);S=5121}return{buffer:b,type:S,bytesPerElement:v.BYTES_PER_ELEMENT,version:p.version}}(p,y)):v.version<p.version&&(function o(p,y,v){const x=y.array,b=y.updateRange;n.bindBuffer(v,p),-1===b.count?n.bufferSubData(v,0,x):(t?n.bufferSubData(v,b.offset*x.BYTES_PER_ELEMENT,x,b.offset,b.count):n.bufferSubData(v,b.offset*x.BYTES_PER_ELEMENT,x.subarray(b.offset,b.offset+b.count)),b.count=-1)}(v.buffer,p,y),v.version=p.version)}}}class p_ extends Tn{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const o=e/2,l=t/2,c=Math.floor(i),d=Math.floor(r),p=c+1,y=d+1,v=e/c,x=t/d,b=[],S=[],E=[],T=[];for(let N=0;N<y;N++){const F=N*x-l;for(let U=0;U<p;U++)S.push(U*v-o,-F,0),E.push(0,0,1),T.push(U/c),T.push(1-N/d)}for(let N=0;N<d;N++)for(let F=0;F<c;F++){const k=F+p*(N+1),H=F+1+p*(N+1),Q=F+1+p*N;b.push(F+p*N,k,Q),b.push(k,H,Q)}this.setIndex(b),this.setAttribute("position",new Jt(S,3)),this.setAttribute("normal",new Jt(E,3)),this.setAttribute("uv",new Jt(T,2))}static fromJSON(e){return new p_(e.width,e.height,e.widthSegments,e.heightSegments)}}const Li={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},It={common:{diffuse:{value:new Ht(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new wo},uv2Transform:{value:new wo},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ht(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ht(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new wo}},sprite:{diffuse:{value:new Ht(16777215)},opacity:{value:1},center:{value:new ct(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new wo}}},Ga={basic:{uniforms:Zo([It.common,It.specularmap,It.envmap,It.aomap,It.lightmap,It.fog]),vertexShader:Li.meshbasic_vert,fragmentShader:Li.meshbasic_frag},lambert:{uniforms:Zo([It.common,It.specularmap,It.envmap,It.aomap,It.lightmap,It.emissivemap,It.fog,It.lights,{emissive:{value:new Ht(0)}}]),vertexShader:Li.meshlambert_vert,fragmentShader:Li.meshlambert_frag},phong:{uniforms:Zo([It.common,It.specularmap,It.envmap,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.fog,It.lights,{emissive:{value:new Ht(0)},specular:{value:new Ht(1118481)},shininess:{value:30}}]),vertexShader:Li.meshphong_vert,fragmentShader:Li.meshphong_frag},standard:{uniforms:Zo([It.common,It.envmap,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.roughnessmap,It.metalnessmap,It.fog,It.lights,{emissive:{value:new Ht(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Li.meshphysical_vert,fragmentShader:Li.meshphysical_frag},toon:{uniforms:Zo([It.common,It.aomap,It.lightmap,It.emissivemap,It.bumpmap,It.normalmap,It.displacementmap,It.gradientmap,It.fog,It.lights,{emissive:{value:new Ht(0)}}]),vertexShader:Li.meshtoon_vert,fragmentShader:Li.meshtoon_frag},matcap:{uniforms:Zo([It.common,It.bumpmap,It.normalmap,It.displacementmap,It.fog,{matcap:{value:null}}]),vertexShader:Li.meshmatcap_vert,fragmentShader:Li.meshmatcap_frag},points:{uniforms:Zo([It.points,It.fog]),vertexShader:Li.points_vert,fragmentShader:Li.points_frag},dashed:{uniforms:Zo([It.common,It.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Li.linedashed_vert,fragmentShader:Li.linedashed_frag},depth:{uniforms:Zo([It.common,It.displacementmap]),vertexShader:Li.depth_vert,fragmentShader:Li.depth_frag},normal:{uniforms:Zo([It.common,It.bumpmap,It.normalmap,It.displacementmap,{opacity:{value:1}}]),vertexShader:Li.meshnormal_vert,fragmentShader:Li.meshnormal_frag},sprite:{uniforms:Zo([It.sprite,It.fog]),vertexShader:Li.sprite_vert,fragmentShader:Li.sprite_frag},background:{uniforms:{uvTransform:{value:new wo},t2D:{value:null}},vertexShader:Li.background_vert,fragmentShader:Li.background_frag},cube:{uniforms:Zo([It.envmap,{opacity:{value:1}}]),vertexShader:Li.cube_vert,fragmentShader:Li.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Li.equirect_vert,fragmentShader:Li.equirect_frag},distanceRGBA:{uniforms:Zo([It.common,It.displacementmap,{referencePosition:{value:new $},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Li.distanceRGBA_vert,fragmentShader:Li.distanceRGBA_frag},shadow:{uniforms:Zo([It.lights,It.fog,{color:{value:new Ht(0)},opacity:{value:1}}]),vertexShader:Li.shadow_vert,fragmentShader:Li.shadow_frag}};function Jj(n,e,t,i,r,o){const l=new Ht(0);let d,p,c=!0===r?0:1,y=null,v=0,x=null;function S(E,T){t.buffers.color.setClear(E.r,E.g,E.b,T,o)}return{getClearColor:function(){return l},setClearColor:function(E,T=1){l.set(E),c=T,S(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(E){c=E,S(l,c)},render:function b(E,T){let N=!1,F=!0===T.isScene?T.background:null;F&&F.isTexture&&(F=e.get(F));const U=n.xr,k=U.getSession&&U.getSession();k&&"additive"===k.environmentBlendMode&&(F=null),null===F?S(l,c):F&&F.isColor&&(S(F,1),N=!0),(n.autoClear||N)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),F&&(F.isCubeTexture||306===F.mapping)?(void 0===p&&(p=new Xs(new Om(1,1,1),new ql({name:"BackgroundCubeMaterial",uniforms:u_(Ga.cube.uniforms),vertexShader:Ga.cube.vertexShader,fragmentShader:Ga.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(H,Q,ie){this.matrixWorld.copyPosition(ie.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(p)),p.material.uniforms.envMap.value=F,p.material.uniforms.flipEnvMap.value=F.isCubeTexture&&!1===F.isRenderTargetTexture?-1:1,(y!==F||v!==F.version||x!==n.toneMapping)&&(p.material.needsUpdate=!0,y=F,v=F.version,x=n.toneMapping),E.unshift(p,p.geometry,p.material,0,0,null)):F&&F.isTexture&&(void 0===d&&(d=new Xs(new p_(2,2),new ql({name:"BackgroundMaterial",uniforms:u_(Ga.background.uniforms),vertexShader:Ga.background.vertexShader,fragmentShader:Ga.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(d)),d.material.uniforms.t2D.value=F,!0===F.matrixAutoUpdate&&F.updateMatrix(),d.material.uniforms.uvTransform.value.copy(F.matrix),(y!==F||v!==F.version||x!==n.toneMapping)&&(d.material.needsUpdate=!0,y=F,v=F.version,x=n.toneMapping),E.unshift(d,d.geometry,d.material,0,0,null))}}}function Qj(n,e,t,i){const r=n.getParameter(34921),o=i.isWebGL2?null:e.get("OES_vertex_array_object"),l=i.isWebGL2||null!==o,c={},d=T(null);let p=d,y=!1;function b(be){return i.isWebGL2?n.bindVertexArray(be):o.bindVertexArrayOES(be)}function S(be){return i.isWebGL2?n.deleteVertexArray(be):o.deleteVertexArrayOES(be)}function T(be){const Le=[],de=[],xe=[];for(let ue=0;ue<r;ue++)Le[ue]=0,de[ue]=0,xe[ue]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Le,enabledAttributes:de,attributeDivisors:xe,object:be,attributes:{},index:null}}function U(){const be=p.newAttributes;for(let Le=0,de=be.length;Le<de;Le++)be[Le]=0}function k(be){H(be,0)}function H(be,Le){const xe=p.enabledAttributes,ue=p.attributeDivisors;p.newAttributes[be]=1,0===xe[be]&&(n.enableVertexAttribArray(be),xe[be]=1),ue[be]!==Le&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](be,Le),ue[be]=Le)}function Q(){const be=p.newAttributes,Le=p.enabledAttributes;for(let de=0,xe=Le.length;de<xe;de++)Le[de]!==be[de]&&(n.disableVertexAttribArray(de),Le[de]=0)}function ie(be,Le,de,xe,ue,Re){!0!==i.isWebGL2||5124!==de&&5125!==de?n.vertexAttribPointer(be,Le,de,xe,ue,Re):n.vertexAttribIPointer(be,Le,de,ue,Re)}function oe(){qe(),y=!0,p!==d&&(p=d,b(p.object))}function qe(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:function v(be,Le,de,xe,ue){let Re=!1;if(l){const Ye=function E(be,Le,de){const xe=!0===de.wireframe;let ue=c[be.id];void 0===ue&&(ue={},c[be.id]=ue);let Re=ue[Le.id];void 0===Re&&(Re={},ue[Le.id]=Re);let Ye=Re[xe];return void 0===Ye&&(Ye=T(function x(){return i.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}()),Re[xe]=Ye),Ye}(xe,de,Le);p!==Ye&&(p=Ye,b(p.object)),Re=function N(be,Le){const de=p.attributes,xe=be.attributes;let ue=0;for(const Re in xe){const Ye=de[Re],gt=xe[Re];if(void 0===Ye||Ye.attribute!==gt||Ye.data!==gt.data)return!0;ue++}return p.attributesNum!==ue||p.index!==Le}(xe,ue),Re&&function F(be,Le){const de={},xe=be.attributes;let ue=0;for(const Re in xe){const Ye=xe[Re],gt={};gt.attribute=Ye,Ye.data&&(gt.data=Ye.data),de[Re]=gt,ue++}p.attributes=de,p.attributesNum=ue,p.index=Le}(xe,ue)}else{const Ye=!0===Le.wireframe;(p.geometry!==xe.id||p.program!==de.id||p.wireframe!==Ye)&&(p.geometry=xe.id,p.program=de.id,p.wireframe=Ye,Re=!0)}!0===be.isInstancedMesh&&(Re=!0),null!==ue&&t.update(ue,34963),(Re||y)&&(y=!1,function ce(be,Le,de,xe){if(!1===i.isWebGL2&&(be.isInstancedMesh||xe.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;U();const ue=xe.attributes,Re=de.getAttributes(),Ye=Le.defaultAttributeValues;for(const gt in Re){const st=Re[gt];if(st.location>=0){let ln=ue[gt];if(void 0===ln&&("instanceMatrix"===gt&&be.instanceMatrix&&(ln=be.instanceMatrix),"instanceColor"===gt&&be.instanceColor&&(ln=be.instanceColor)),void 0!==ln){const hn=ln.normalized,qn=ln.itemSize,tt=t.get(ln);if(void 0===tt)continue;const Yn=tt.buffer,Gn=tt.type,Vn=tt.bytesPerElement;if(ln.isInterleavedBufferAttribute){const bt=ln.data,di=bt.stride,et=ln.offset;if(bt.isInstancedInterleavedBuffer){for(let ht=0;ht<st.locationSize;ht++)H(st.location+ht,bt.meshPerAttribute);!0!==be.isInstancedMesh&&void 0===xe._maxInstanceCount&&(xe._maxInstanceCount=bt.meshPerAttribute*bt.count)}else for(let ht=0;ht<st.locationSize;ht++)k(st.location+ht);n.bindBuffer(34962,Yn);for(let ht=0;ht<st.locationSize;ht++)ie(st.location+ht,qn/st.locationSize,Gn,hn,di*Vn,(et+qn/st.locationSize*ht)*Vn)}else{if(ln.isInstancedBufferAttribute){for(let bt=0;bt<st.locationSize;bt++)H(st.location+bt,ln.meshPerAttribute);!0!==be.isInstancedMesh&&void 0===xe._maxInstanceCount&&(xe._maxInstanceCount=ln.meshPerAttribute*ln.count)}else for(let bt=0;bt<st.locationSize;bt++)k(st.location+bt);n.bindBuffer(34962,Yn);for(let bt=0;bt<st.locationSize;bt++)ie(st.location+bt,qn/st.locationSize,Gn,hn,qn*Vn,qn/st.locationSize*bt*Vn)}}else if(void 0!==Ye){const hn=Ye[gt];if(void 0!==hn)switch(hn.length){case 2:n.vertexAttrib2fv(st.location,hn);break;case 3:n.vertexAttrib3fv(st.location,hn);break;case 4:n.vertexAttrib4fv(st.location,hn);break;default:n.vertexAttrib1fv(st.location,hn)}}}}Q()}(be,Le,de,xe),null!==ue&&n.bindBuffer(34963,t.get(ue).buffer))},reset:oe,resetDefaultState:qe,dispose:function De(){oe();for(const be in c){const Le=c[be];for(const de in Le){const xe=Le[de];for(const ue in xe)S(xe[ue].object),delete xe[ue];delete Le[de]}delete c[be]}},releaseStatesOfGeometry:function ve(be){if(void 0===c[be.id])return;const Le=c[be.id];for(const de in Le){const xe=Le[de];for(const ue in xe)S(xe[ue].object),delete xe[ue];delete Le[de]}delete c[be.id]},releaseStatesOfProgram:function q(be){for(const Le in c){const de=c[Le];if(void 0===de[be.id])continue;const xe=de[be.id];for(const ue in xe)S(xe[ue].object),delete xe[ue];delete de[be.id]}},initAttributes:U,enableAttribute:k,disableUnusedAttributes:Q}}function e7(n,e,t,i){const r=i.isWebGL2;let o;this.setMode=function l(p){o=p},this.render=function c(p,y){n.drawArrays(o,p,y),t.update(y,o,1)},this.renderInstances=function d(p,y,v){if(0===v)return;let x,b;if(r)x=n,b="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),b="drawArraysInstancedANGLE",null===x)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");x[b](o,p,y,v),t.update(y,o,v)}}function t7(n,e,t){let i;function o(ie){if("highp"===ie){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ie="mediump"}return"mediump"===ie&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const l="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&n instanceof WebGL2ComputeRenderingContext;let c=void 0!==t.precision?t.precision:"highp";const d=o(c);d!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",d,"instead."),c=d);const p=l||e.has("WEBGL_draw_buffers"),y=!0===t.logarithmicDepthBuffer,v=n.getParameter(34930),x=n.getParameter(35660),b=n.getParameter(3379),S=n.getParameter(34076),E=n.getParameter(34921),T=n.getParameter(36347),N=n.getParameter(36348),F=n.getParameter(36349),U=x>0,k=l||e.has("OES_texture_float");return{isWebGL2:l,drawBuffers:p,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const ie=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(ie.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,precision:c,logarithmicDepthBuffer:y,maxTextures:v,maxVertexTextures:x,maxTextureSize:b,maxCubemapSize:S,maxAttributes:E,maxVertexUniforms:T,maxVaryings:N,maxFragmentUniforms:F,vertexTextures:U,floatFragmentTextures:k,floatVertexTextures:U&&k,maxSamples:l?n.getParameter(36183):0}}function n7(n){const e=this;let t=null,i=0,r=!1,o=!1;const l=new Wh,c=new wo,d={value:null,needsUpdate:!1};function p(){d.value!==t&&(d.value=t,d.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function y(v,x,b,S){const E=null!==v?v.length:0;let T=null;if(0!==E){if(T=d.value,!0!==S||null===T){const N=b+4*E,F=x.matrixWorldInverse;c.getNormalMatrix(F),(null===T||T.length<N)&&(T=new Float32Array(N));for(let U=0,k=b;U!==E;++U,k+=4)l.copy(v[U]).applyMatrix4(F,c),l.normal.toArray(T,k),T[k+3]=l.constant}d.value=T,d.needsUpdate=!0}return e.numPlanes=E,e.numIntersection=0,T}this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(v,x,b){const S=0!==v.length||x||0!==i||r;return r=x,t=y(v,b,0),i=v.length,S},this.beginShadows=function(){o=!0,y(null)},this.endShadows=function(){o=!1,p()},this.setState=function(v,x,b){const S=v.clippingPlanes,E=v.clipIntersection,T=v.clipShadows,N=n.get(v);if(!r||null===S||0===S.length||o&&!T)o?y(null):p();else{const F=o?0:i,U=4*F;let k=N.clippingState||null;d.value=k,k=y(S,x,U,b);for(let H=0;H!==U;++H)k[H]=t[H];N.clippingState=k,this.numIntersection=E?this.numPlanes:0,this.numPlanes+=F}}}function i7(n){let e=new WeakMap;function t(l,c){return 303===c?l.mapping=301:304===c&&(l.mapping=302),l}function r(l){const c=l.target;c.removeEventListener("dispose",r);const d=e.get(c);void 0!==d&&(e.delete(c),d.dispose())}return{get:function i(l){if(l&&l.isTexture&&!1===l.isRenderTargetTexture){const c=l.mapping;if(303===c||304===c){if(e.has(l))return t(e.get(l).texture,l.mapping);{const d=l.image;if(d&&d.height>0){const p=new s3(d.height/2);return p.fromEquirectangularTexture(n,l),e.set(l,p),l.addEventListener("dispose",r),t(p.texture,l.mapping)}return null}}}return l},dispose:function o(){e=new WeakMap}}}Ga.physical={uniforms:Zo([Ga.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ct(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Ht(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ct},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ht(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ht(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Li.meshphysical_vert,fragmentShader:Li.meshphysical_frag};class LE extends RE{constructor(e=-1,t=1,i=1,r=-1,o=.1,l=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=o,this.far=l,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,o,l){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=i-e,l=i+e,c=r+t,d=r-t;if(null!==this.view&&this.view.enabled){const p=(this.right-this.left)/this.view.fullWidth/this.zoom,y=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=p*this.view.offsetX,l=o+p*this.view.width,c-=y*this.view.offsetY,d=c-y*this.view.height}this.projectionMatrix.makeOrthographic(o,l,c,d,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}LE.prototype.isOrthographicCamera=!0;const a3=[.125,.215,.35,.446,.526,.582],fP=new LE,l3=new Ht;let pP=null;const Bm=(1+Math.sqrt(5))/2,g_=1/Bm,c3=[new $(1,1,1),new $(-1,1,1),new $(1,1,-1),new $(-1,1,-1),new $(0,Bm,g_),new $(0,Bm,-g_),new $(g_,0,Bm),new $(-g_,0,Bm),new $(Bm,g_,0),new $(-Bm,g_,0)];class u3{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){pP=this._renderer.getRenderTarget(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=f3(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=d3(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(pP),e.scissorTest=!1,FE(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),pP=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,i={magFilter:Gs,minFilter:Gs,generateMipmaps:!1,type:jy,format:Gl,encoding:kh,depthBuffer:!1},r=h3(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=h3(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function r7(n){const e=[],t=[],i=[];let r=n;const o=n-4+1+a3.length;for(let l=0;l<o;l++){const c=Math.pow(2,r);t.push(c);let d=1/c;l>n-4?d=a3[l-n+4-1]:0===l&&(d=0),i.push(d);const p=1/(c-1),y=-p/2,v=1+p/2,x=[y,y,v,y,v,v,y,y,v,v,y,v],b=6,S=6,E=3,T=2,N=1,F=new Float32Array(E*S*b),U=new Float32Array(T*S*b),k=new Float32Array(N*S*b);for(let Q=0;Q<b;Q++){const ie=Q%3*2/3-1,ce=Q>2?0:-1;F.set([ie,ce,0,ie+2/3,ce,0,ie+2/3,ce+1,0,ie,ce,0,ie+2/3,ce+1,0,ie,ce+1,0],E*S*Q),U.set(x,T*S*Q),k.set([Q,Q,Q,Q,Q,Q],N*S*Q)}const H=new Tn;H.setAttribute("position",new Lr(F,E)),H.setAttribute("uv",new Lr(U,T)),H.setAttribute("faceIndex",new Lr(k,N)),e.push(H),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(o)),this._blurMaterial=function s7(n,e,t){const i=new Float32Array(20),r=new $(0,1,0);return new ql({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(o,e,t)}return r}_compileMaterial(e){const t=new Xs(this._lodPlanes[0],e);this._renderer.compile(t,fP)}_sceneToCubeUV(e,t,i,r){const c=new Eo(90,1,t,i),d=[1,-1,1,1,1,1],p=[1,1,1,-1,-1,-1],y=this._renderer,v=y.autoClear,x=y.toneMapping;y.getClearColor(l3),y.toneMapping=0,y.autoClear=!1;const b=new hu({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),S=new Xs(new Om,b);let E=!1;const T=e.background;T?T.isColor&&(b.color.copy(T),e.background=null,E=!0):(b.color.copy(l3),E=!0);for(let N=0;N<6;N++){const F=N%3;0===F?(c.up.set(0,d[N],0),c.lookAt(p[N],0,0)):1===F?(c.up.set(0,0,d[N]),c.lookAt(0,p[N],0)):(c.up.set(0,d[N],0),c.lookAt(0,0,p[N]));const U=this._cubeSize;FE(r,F*U,N>2?U:0,U,U),y.setRenderTarget(r),E&&y.render(S,c),y.render(e,c)}S.geometry.dispose(),S.material.dispose(),y.toneMapping=x,y.autoClear=v,e.background=T}_textureToCubeUV(e,t){const i=this._renderer,r=301===e.mapping||302===e.mapping;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=f3()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=d3());const o=r?this._cubemapMaterial:this._equirectMaterial,l=new Xs(this._lodPlanes[0],o);o.uniforms.envMap.value=e;const d=this._cubeSize;FE(t,0,0,3*d,2*d),i.setRenderTarget(t),i.render(l,fP)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,o,c3[(r-1)%c3.length])}t.autoClear=i}_blur(e,t,i,r,o){const l=this._pingPongRenderTarget;this._halfBlur(e,l,t,i,r,"latitudinal",o),this._halfBlur(l,e,i,i,r,"longitudinal",o)}_halfBlur(e,t,i,r,o,l,c){const d=this._renderer,p=this._blurMaterial;"latitudinal"!==l&&"longitudinal"!==l&&console.error("blur direction must be either latitudinal or longitudinal!");const v=new Xs(this._lodPlanes[r],p),x=p.uniforms,b=this._sizeLods[i]-1,S=isFinite(o)?Math.PI/(2*b):2*Math.PI/39,E=o/S,T=isFinite(o)?1+Math.floor(3*E):20;T>20&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${T} samples when the maximum is set to 20`);const N=[];let F=0;for(let ie=0;ie<20;++ie){const ce=ie/E,De=Math.exp(-ce*ce/2);N.push(De),0===ie?F+=De:ie<T&&(F+=2*De)}for(let ie=0;ie<N.length;ie++)N[ie]=N[ie]/F;x.envMap.value=e.texture,x.samples.value=T,x.weights.value=N,x.latitudinal.value="latitudinal"===l,c&&(x.poleAxis.value=c);const{_lodMax:U}=this;x.dTheta.value=S,x.mipInt.value=U-i;const k=this._sizeLods[r];FE(t,3*k*(r>U-4?r-U+4:0),4*(this._cubeSize-k),3*k,2*k),d.setRenderTarget(t),d.render(v,fP)}}function h3(n,e,t){const i=new al(n,e,t);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function FE(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function d3(){return new ql({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function f3(){return new ql({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function o7(n){let e=new WeakMap,t=null;function o(c){const d=c.target;d.removeEventListener("dispose",o);const p=e.get(d);void 0!==p&&(e.delete(d),p.dispose())}return{get:function i(c){if(c&&c.isTexture){const d=c.mapping,p=303===d||304===d,y=301===d||302===d;if(p||y){if(c.isRenderTargetTexture&&!0===c.needsPMREMUpdate){c.needsPMREMUpdate=!1;let v=e.get(c);return null===t&&(t=new u3(n)),v=p?t.fromEquirectangular(c,v):t.fromCubemap(c,v),e.set(c,v),v.texture}if(e.has(c))return e.get(c).texture;{const v=c.image;if(p&&v&&v.height>0||y&&v&&function r(c){let d=0;for(let y=0;y<6;y++)void 0!==c[y]&&d++;return 6===d}(v)){null===t&&(t=new u3(n));const x=p?t.fromEquirectangular(c):t.fromCubemap(c);return e.set(c,x),c.addEventListener("dispose",o),x.texture}return null}}}return c},dispose:function l(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function a7(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function l7(n,e,t,i){const r={},o=new WeakMap;function l(v){const x=v.target;null!==x.index&&e.remove(x.index);for(const S in x.attributes)e.remove(x.attributes[S]);x.removeEventListener("dispose",l),delete r[x.id];const b=o.get(x);b&&(e.remove(b),o.delete(x)),i.releaseStatesOfGeometry(x),!0===x.isInstancedBufferGeometry&&delete x._maxInstanceCount,t.memory.geometries--}function p(v){const x=[],b=v.index,S=v.attributes.position;let E=0;if(null!==b){const F=b.array;E=b.version;for(let U=0,k=F.length;U<k;U+=3){const H=F[U+0],Q=F[U+1],ie=F[U+2];x.push(H,Q,Q,ie,ie,H)}}else{E=S.version;for(let U=0,k=S.array.length/3-1;U<k;U+=3){const H=U+0,Q=U+1,ie=U+2;x.push(H,Q,Q,ie,ie,H)}}const T=new(WO(x)?i3:n3)(x,1);T.version=E;const N=o.get(v);N&&e.remove(N),o.set(v,T)}return{get:function c(v,x){return!0===r[x.id]||(x.addEventListener("dispose",l),r[x.id]=!0,t.memory.geometries++),x},update:function d(v){const x=v.attributes;for(const S in x)e.update(x[S],34962);const b=v.morphAttributes;for(const S in b){const E=b[S];for(let T=0,N=E.length;T<N;T++)e.update(E[T],34962)}},getWireframeAttribute:function y(v){const x=o.get(v);if(x){const b=v.index;null!==b&&x.version<b.version&&p(v)}else p(v);return o.get(v)}}}function c7(n,e,t,i){const r=i.isWebGL2;let o,c,d;this.setMode=function l(x){o=x},this.setIndex=function p(x){c=x.type,d=x.bytesPerElement},this.render=function y(x,b){n.drawElements(o,b,c,x*d),t.update(b,o,1)},this.renderInstances=function v(x,b,S){if(0===S)return;let E,T;if(r)E=n,T="drawElementsInstanced";else if(E=e.get("ANGLE_instanced_arrays"),T="drawElementsInstancedANGLE",null===E)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");E[T](o,b,c,x*d,S),t.update(b,o,S)}}function u7(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(o,l,c){switch(t.calls++,l){case 4:t.triangles+=c*(o/3);break;case 1:t.lines+=c*(o/2);break;case 3:t.lines+=c*(o-1);break;case 2:t.lines+=c*o;break;case 0:t.points+=c*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l)}}}}function h7(n,e){return n[0]-e[0]}function d7(n,e){return Math.abs(e[1])-Math.abs(n[1])}function gP(n,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),n.divideScalar(t)}function f7(n,e,t){const i={},r=new Float32Array(8),o=new WeakMap,l=new Qi,c=[];for(let p=0;p<8;p++)c[p]=[p,0];return{update:function d(p,y,v,x){const b=p.morphTargetInfluences;if(!0===e.isWebGL2){const S=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,E=void 0!==S?S.length:0;let T=o.get(y);if(void 0===T||T.count!==E){let Le=function(){qe.dispose(),o.delete(y),y.removeEventListener("dispose",Le)};void 0!==T&&T.texture.dispose();const U=void 0!==y.morphAttributes.position,k=void 0!==y.morphAttributes.normal,H=void 0!==y.morphAttributes.color,Q=y.morphAttributes.position||[],ie=y.morphAttributes.normal||[],ce=y.morphAttributes.color||[];let De=0;!0===U&&(De=1),!0===k&&(De=2),!0===H&&(De=3);let ve=y.attributes.position.count*De,q=1;ve>e.maxTextureSize&&(q=Math.ceil(ve/e.maxTextureSize),ve=e.maxTextureSize);const oe=new Float32Array(ve*q*4*E),qe=new fE(oe,ve,q,E);qe.type=yf,qe.needsUpdate=!0;const be=4*De;for(let de=0;de<E;de++){const xe=Q[de],ue=ie[de],Re=ce[de],Ye=ve*q*4*de;for(let gt=0;gt<xe.count;gt++){const st=gt*be;!0===U&&(l.fromBufferAttribute(xe,gt),!0===xe.normalized&&gP(l,xe),oe[Ye+st+0]=l.x,oe[Ye+st+1]=l.y,oe[Ye+st+2]=l.z,oe[Ye+st+3]=0),!0===k&&(l.fromBufferAttribute(ue,gt),!0===ue.normalized&&gP(l,ue),oe[Ye+st+4]=l.x,oe[Ye+st+5]=l.y,oe[Ye+st+6]=l.z,oe[Ye+st+7]=0),!0===H&&(l.fromBufferAttribute(Re,gt),!0===Re.normalized&&gP(l,Re),oe[Ye+st+8]=l.x,oe[Ye+st+9]=l.y,oe[Ye+st+10]=l.z,oe[Ye+st+11]=4===Re.itemSize?l.w:1)}}T={count:E,texture:qe,size:new ct(ve,q)},o.set(y,T),y.addEventListener("dispose",Le)}let N=0;for(let U=0;U<b.length;U++)N+=b[U];const F=y.morphTargetsRelative?1:1-N;x.getUniforms().setValue(n,"morphTargetBaseInfluence",F),x.getUniforms().setValue(n,"morphTargetInfluences",b),x.getUniforms().setValue(n,"morphTargetsTexture",T.texture,t),x.getUniforms().setValue(n,"morphTargetsTextureSize",T.size)}else{const S=void 0===b?0:b.length;let E=i[y.id];if(void 0===E||E.length!==S){E=[];for(let k=0;k<S;k++)E[k]=[k,0];i[y.id]=E}for(let k=0;k<S;k++){const H=E[k];H[0]=k,H[1]=b[k]}E.sort(d7);for(let k=0;k<8;k++)k<S&&E[k][1]?(c[k][0]=E[k][0],c[k][1]=E[k][1]):(c[k][0]=Number.MAX_SAFE_INTEGER,c[k][1]=0);c.sort(h7);const T=y.morphAttributes.position,N=y.morphAttributes.normal;let F=0;for(let k=0;k<8;k++){const H=c[k],Q=H[0],ie=H[1];Q!==Number.MAX_SAFE_INTEGER&&ie?(T&&y.getAttribute("morphTarget"+k)!==T[Q]&&y.setAttribute("morphTarget"+k,T[Q]),N&&y.getAttribute("morphNormal"+k)!==N[Q]&&y.setAttribute("morphNormal"+k,N[Q]),r[k]=ie,F+=ie):(T&&!0===y.hasAttribute("morphTarget"+k)&&y.deleteAttribute("morphTarget"+k),N&&!0===y.hasAttribute("morphNormal"+k)&&y.deleteAttribute("morphNormal"+k),r[k]=0)}const U=y.morphTargetsRelative?1:1-F;x.getUniforms().setValue(n,"morphTargetBaseInfluence",U),x.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function p7(n,e,t,i){let r=new WeakMap;function c(d){const p=d.target;p.removeEventListener("dispose",c),t.remove(p.instanceMatrix),null!==p.instanceColor&&t.remove(p.instanceColor)}return{update:function o(d){const p=i.render.frame,v=e.get(d,d.geometry);return r.get(v)!==p&&(e.update(v),r.set(v,p)),d.isInstancedMesh&&(!1===d.hasEventListener("dispose",c)&&d.addEventListener("dispose",c),t.update(d.instanceMatrix,34962),null!==d.instanceColor&&t.update(d.instanceColor,34962)),v},dispose:function l(){r=new WeakMap}}}const p3=new Ha,m3=new fE,g3=new qR,y3=new Ox,_3=[],v3=[],x3=new Float32Array(16),b3=new Float32Array(9),w3=new Float32Array(4);function y_(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let o=_3[r];if(void 0===o&&(o=new Float32Array(r),_3[r]=o),0!==e){i.toArray(o,0);for(let l=1,c=0;l!==e;++l)c+=t,n[l].toArray(o,c)}return o}function ma(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Jo(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function NE(n,e){let t=v3[e];void 0===t&&(t=new Int32Array(e),v3[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function m7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function g7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ma(t,e))return;n.uniform2fv(this.addr,e),Jo(t,e)}}function y7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ma(t,e))return;n.uniform3fv(this.addr,e),Jo(t,e)}}function _7(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ma(t,e))return;n.uniform4fv(this.addr,e),Jo(t,e)}}function v7(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(ma(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Jo(t,e)}else{if(ma(t,i))return;w3.set(i),n.uniformMatrix2fv(this.addr,!1,w3),Jo(t,i)}}function x7(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(ma(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Jo(t,e)}else{if(ma(t,i))return;b3.set(i),n.uniformMatrix3fv(this.addr,!1,b3),Jo(t,i)}}function b7(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(ma(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Jo(t,e)}else{if(ma(t,i))return;x3.set(i),n.uniformMatrix4fv(this.addr,!1,x3),Jo(t,i)}}function w7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function M7(n,e){const t=this.cache;ma(t,e)||(n.uniform2iv(this.addr,e),Jo(t,e))}function S7(n,e){const t=this.cache;ma(t,e)||(n.uniform3iv(this.addr,e),Jo(t,e))}function E7(n,e){const t=this.cache;ma(t,e)||(n.uniform4iv(this.addr,e),Jo(t,e))}function C7(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function T7(n,e){const t=this.cache;ma(t,e)||(n.uniform2uiv(this.addr,e),Jo(t,e))}function A7(n,e){const t=this.cache;ma(t,e)||(n.uniform3uiv(this.addr,e),Jo(t,e))}function D7(n,e){const t=this.cache;ma(t,e)||(n.uniform4uiv(this.addr,e),Jo(t,e))}function R7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||p3,r)}function P7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||g3,r)}function I7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||y3,r)}function L7(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||m3,r)}function N7(n,e){n.uniform1fv(this.addr,e)}function O7(n,e){const t=y_(e,this.size,2);n.uniform2fv(this.addr,t)}function k7(n,e){const t=y_(e,this.size,3);n.uniform3fv(this.addr,t)}function B7(n,e){const t=y_(e,this.size,4);n.uniform4fv(this.addr,t)}function U7(n,e){const t=y_(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function V7(n,e){const t=y_(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function z7(n,e){const t=y_(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function H7(n,e){n.uniform1iv(this.addr,e)}function G7(n,e){n.uniform2iv(this.addr,e)}function W7(n,e){n.uniform3iv(this.addr,e)}function q7(n,e){n.uniform4iv(this.addr,e)}function j7(n,e){n.uniform1uiv(this.addr,e)}function X7(n,e){n.uniform2uiv(this.addr,e)}function $7(n,e){n.uniform3uiv(this.addr,e)}function Y7(n,e){n.uniform4uiv(this.addr,e)}function K7(n,e,t){const i=e.length,r=NE(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.setTexture2D(e[o]||p3,r[o])}function Z7(n,e,t){const i=e.length,r=NE(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.setTexture3D(e[o]||g3,r[o])}function J7(n,e,t){const i=e.length,r=NE(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.setTextureCube(e[o]||y3,r[o])}function Q7(n,e,t){const i=e.length,r=NE(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||m3,r[o])}function t9(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=function F7(n){switch(n){case 5126:return m7;case 35664:return g7;case 35665:return y7;case 35666:return _7;case 35674:return v7;case 35675:return x7;case 35676:return b7;case 5124:case 35670:return w7;case 35667:case 35671:return M7;case 35668:case 35672:return S7;case 35669:case 35673:return E7;case 5125:return C7;case 36294:return T7;case 36295:return A7;case 36296:return D7;case 35678:case 36198:case 36298:case 36306:case 35682:return R7;case 35679:case 36299:case 36307:return P7;case 35680:case 36300:case 36308:case 36293:return I7;case 36289:case 36303:case 36311:case 36292:return L7}}(e.type)}function M3(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function e9(n){switch(n){case 5126:return N7;case 35664:return O7;case 35665:return k7;case 35666:return B7;case 35674:return U7;case 35675:return V7;case 35676:return z7;case 5124:case 35670:return H7;case 35667:case 35671:return G7;case 35668:case 35672:return W7;case 35669:case 35673:return q7;case 5125:return j7;case 36294:return X7;case 36295:return $7;case 36296:return Y7;case 35678:case 36198:case 36298:case 36306:case 35682:return K7;case 35679:case 36299:case 36307:return Z7;case 35680:case 36300:case 36308:case 36293:return J7;case 36289:case 36303:case 36311:case 36292:return Q7}}(e.type)}function S3(n){this.id=n,this.seq=[],this.map={}}M3.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),Jo(e,n)},S3.prototype.setValue=function(n,e,t){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const l=i[r];l.setValue(n,e[l.id],t)}};const yP=/(\w+)(\])?(\[|\.)?/g;function E3(n,e){n.seq.push(e),n.map[e.id]=e}function n9(n,e,t){const i=n.name,r=i.length;for(yP.lastIndex=0;;){const o=yP.exec(i),l=yP.lastIndex;let c=o[1];const p=o[3];if("]"===o[2]&&(c|=0),void 0===p||"["===p&&l+2===r){E3(t,void 0===p?new t9(c,n,e):new M3(c,n,e));break}{let v=t.map[c];void 0===v&&(v=new S3(c),E3(t,v)),t=v}}}function Tf(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){const r=n.getActiveUniform(e,i);n9(r,n.getUniformLocation(e,r.name),this)}}function C3(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}Tf.prototype.setValue=function(n,e,t,i){const r=this.map[e];void 0!==r&&r.setValue(n,t,i)},Tf.prototype.setOptional=function(n,e,t){const i=e[t];void 0!==i&&this.setValue(n,t,i)},Tf.upload=function(n,e,t,i){for(let r=0,o=e.length;r!==o;++r){const l=e[r],c=t[l.id];!1!==c.needsUpdate&&l.setValue(n,c.value,i)}},Tf.seqWithValue=function(n,e){const t=[];for(let i=0,r=n.length;i!==r;++i){const o=n[i];o.id in e&&t.push(o)}return t};let i9=0;function T3(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const o=parseInt(/ERROR: 0:(\d+)/.exec(r)[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function r9(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let l=r;l<o;l++)i.push(l+1+": "+t[l]);return i.join("\n")}(n.getShaderSource(e),o)}function o9(n,e){const t=function s9(n){switch(n){case kh:return["Linear","( value )"];case $r:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function a9(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function kx(n){return""!==n}function A3(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function D3(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const h9=/^[ \t]*#include +<([\w\d./]+)>/gm;function _P(n){return n.replace(h9,d9)}function d9(n,e){const t=Li[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return _P(t)}const f9=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,p9=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function R3(n){return n.replace(p9,P3).replace(f9,m9)}function m9(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),P3(0,e,t,i)}function P3(n,e,t,i){let r="";for(let o=parseInt(e);o<parseInt(t);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function I3(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function b9(n,e,t,i){const r=n.getContext(),o=t.defines;let l=t.vertexShader,c=t.fragmentShader;const d=function g9(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),p=function y9(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),y=function _9(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),v=function v9(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),x=function x9(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e/32+1)+3,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),b=t.isWebGL2?"":function l9(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(kx).join("\n")}(t),S=function c9(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(o),E=r.createProgram();let T,N,F=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(T=[S].filter(kx).join("\n"),T.length>0&&(T+="\n"),N=[b,S].filter(kx).join("\n"),N.length>0&&(N+="\n")):(T=[I3(t),"#define SHADER_NAME "+t.shaderName,S,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+y:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(kx).join("\n"),N=[b,I3(t),"#define SHADER_NAME "+t.shaderName,S,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+p:"",t.envMap?"#define "+y:"",t.envMap?"#define "+v:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?Li.tonemapping_pars_fragment:"",0!==t.toneMapping?a9("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Li.encodings_pars_fragment,o9("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(kx).join("\n")),l=_P(l),l=A3(l,t),l=D3(l,t),c=_P(c),c=A3(c,t),c=D3(c,t),l=R3(l),c=R3(c),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(F="#version 300 es\n",T=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+T,N=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+N);const k=F+N+c,H=C3(r,35633,F+T+l),Q=C3(r,35632,k);if(r.attachShader(E,H),r.attachShader(E,Q),void 0!==t.index0AttributeName?r.bindAttribLocation(E,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(E,0,"position"),r.linkProgram(E),n.debug.checkShaderErrors){const De=r.getProgramInfoLog(E).trim(),ve=r.getShaderInfoLog(H).trim(),q=r.getShaderInfoLog(Q).trim();let oe=!0,qe=!0;if(!1===r.getProgramParameter(E,35714)){oe=!1;const be=T3(r,H,"vertex"),Le=T3(r,Q,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(E,35715)+"\n\nProgram Info Log: "+De+"\n"+be+"\n"+Le)}else""!==De?console.warn("THREE.WebGLProgram: Program Info Log:",De):(""===ve||""===q)&&(qe=!1);qe&&(this.diagnostics={runnable:oe,programLog:De,vertexShader:{log:ve,prefix:T},fragmentShader:{log:q,prefix:N}})}let ie,ce;return r.deleteShader(H),r.deleteShader(Q),this.getUniforms=function(){return void 0===ie&&(ie=new Tf(r,E)),ie},this.getAttributes=function(){return void 0===ce&&(ce=function u9(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const o=n.getActiveAttrib(e,r),l=o.name;let c=1;35674===o.type&&(c=2),35675===o.type&&(c=3),35676===o.type&&(c=4),t[l]={type:o.type,location:n.getAttribLocation(e,l),locationSize:c}}return t}(r,E)),ce},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(E),this.program=void 0},this.name=t.shaderName,this.id=i9++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=H,this.fragmentShader=Q,this}let w9=0;class M9{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),o=this._getShaderStage(i),l=this._getShaderCacheForMaterial(e);return!1===l.has(r)&&(l.add(r),r.usedTimes++),!1===l.has(o)&&(l.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const i=new S9(e);t.set(e,i)}return t.get(e)}}class S9{constructor(e){this.id=w9++,this.code=e,this.usedTimes=0}}function E9(n,e,t,i,r,o,l){const c=new QR,d=new M9,p=[],y=r.isWebGL2,v=r.logarithmicDepthBuffer,x=r.floatVertexTextures,b=r.maxVertexUniforms,S=r.vertexTextures;let E=r.precision;const T={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function F(q,oe,qe,be,Le){const de=be.fog,xe=Le.geometry,Re=(q.isMeshStandardMaterial?t:e).get(q.envMap||(q.isMeshStandardMaterial?be.environment:null)),Ye=Re&&306===Re.mapping?Re.image.height:null,gt=T[q.type],st=Le.isSkinnedMesh?function N(q){const qe=q.skeleton.bones;if(x)return 1024;{const Le=Math.floor((b-20)/4),de=Math.min(Le,qe.length);return de<qe.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+qe.length+" bones. This GPU supports "+de+"."),0):de}}(Le):0;null!==q.precision&&(E=r.getMaxPrecision(q.precision),E!==q.precision&&console.warn("THREE.WebGLProgram.getParameters:",q.precision,"not supported, using",E,"instead."));const ln=xe.morphAttributes.position||xe.morphAttributes.normal||xe.morphAttributes.color,hn=void 0!==ln?ln.length:0;let tt,Yn,Gn,Vn,qn=0;if(void 0!==xe.morphAttributes.position&&(qn=1),void 0!==xe.morphAttributes.normal&&(qn=2),void 0!==xe.morphAttributes.color&&(qn=3),gt){const Mt=Ga[gt];tt=Mt.vertexShader,Yn=Mt.fragmentShader}else tt=q.vertexShader,Yn=q.fragmentShader,d.update(q),Gn=d.getVertexShaderID(q),Vn=d.getFragmentShaderID(q);const bt=n.getRenderTarget(),et=q.clearcoat>0;return{isWebGL2:y,shaderID:gt,shaderName:q.type,vertexShader:tt,fragmentShader:Yn,defines:q.defines,customVertexShaderID:Gn,customFragmentShaderID:Vn,isRawShaderMaterial:!0===q.isRawShaderMaterial,glslVersion:q.glslVersion,precision:E,instancing:!0===Le.isInstancedMesh,instancingColor:!0===Le.isInstancedMesh&&null!==Le.instanceColor,supportsVertexTextures:S,outputEncoding:null===bt?n.outputEncoding:!0===bt.isXRRenderTarget?bt.texture.encoding:kh,map:!!q.map,matcap:!!q.matcap,envMap:!!Re,envMapMode:Re&&Re.mapping,envMapCubeUVHeight:Ye,lightMap:!!q.lightMap,aoMap:!!q.aoMap,emissiveMap:!!q.emissiveMap,bumpMap:!!q.bumpMap,normalMap:!!q.normalMap,objectSpaceNormalMap:1===q.normalMapType,tangentSpaceNormalMap:0===q.normalMapType,decodeVideoTexture:!!q.map&&!0===q.map.isVideoTexture&&q.map.encoding===$r,clearcoat:et,clearcoatMap:et&&!!q.clearcoatMap,clearcoatRoughnessMap:et&&!!q.clearcoatRoughnessMap,clearcoatNormalMap:et&&!!q.clearcoatNormalMap,displacementMap:!!q.displacementMap,roughnessMap:!!q.roughnessMap,metalnessMap:!!q.metalnessMap,specularMap:!!q.specularMap,specularIntensityMap:!!q.specularIntensityMap,specularColorMap:!!q.specularColorMap,opaque:!1===q.transparent&&1===q.blending,alphaMap:!!q.alphaMap,alphaTest:q.alphaTest>0,gradientMap:!!q.gradientMap,sheen:q.sheen>0,sheenColorMap:!!q.sheenColorMap,sheenRoughnessMap:!!q.sheenRoughnessMap,transmission:q.transmission>0,transmissionMap:!!q.transmissionMap,thicknessMap:!!q.thicknessMap,combine:q.combine,vertexTangents:!!q.normalMap&&!!xe.attributes.tangent,vertexColors:q.vertexColors,vertexAlphas:!0===q.vertexColors&&!!xe.attributes.color&&4===xe.attributes.color.itemSize,vertexUvs:!!(q.map||q.bumpMap||q.normalMap||q.specularMap||q.alphaMap||q.emissiveMap||q.roughnessMap||q.metalnessMap||q.clearcoatMap||q.clearcoatRoughnessMap||q.clearcoatNormalMap||q.displacementMap||q.transmissionMap||q.thicknessMap||q.specularIntensityMap||q.specularColorMap||q.sheenColorMap||q.sheenRoughnessMap),uvsVertexOnly:!(q.map||q.bumpMap||q.normalMap||q.specularMap||q.alphaMap||q.emissiveMap||q.roughnessMap||q.metalnessMap||q.clearcoatNormalMap||q.transmission>0||q.transmissionMap||q.thicknessMap||q.specularIntensityMap||q.specularColorMap||q.sheen>0||q.sheenColorMap||q.sheenRoughnessMap||!q.displacementMap),fog:!!de,useFog:q.fog,fogExp2:de&&de.isFogExp2,flatShading:!!q.flatShading,sizeAttenuation:q.sizeAttenuation,logarithmicDepthBuffer:v,skinning:!0===Le.isSkinnedMesh&&st>0,maxBones:st,useVertexTexture:x,morphTargets:void 0!==xe.morphAttributes.position,morphNormals:void 0!==xe.morphAttributes.normal,morphColors:void 0!==xe.morphAttributes.color,morphTargetsCount:hn,morphTextureStride:qn,numDirLights:oe.directional.length,numPointLights:oe.point.length,numSpotLights:oe.spot.length,numRectAreaLights:oe.rectArea.length,numHemiLights:oe.hemi.length,numDirLightShadows:oe.directionalShadowMap.length,numPointLightShadows:oe.pointShadowMap.length,numSpotLightShadows:oe.spotShadowMap.length,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:q.dithering,shadowMapEnabled:n.shadowMap.enabled&&qe.length>0,shadowMapType:n.shadowMap.type,toneMapping:q.toneMapped?n.toneMapping:0,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:q.premultipliedAlpha,doubleSided:2===q.side,flipSided:1===q.side,depthPacking:void 0!==q.depthPacking&&q.depthPacking,index0AttributeName:q.index0AttributeName,extensionDerivatives:q.extensions&&q.extensions.derivatives,extensionFragDepth:q.extensions&&q.extensions.fragDepth,extensionDrawBuffers:q.extensions&&q.extensions.drawBuffers,extensionShaderTextureLOD:q.extensions&&q.extensions.shaderTextureLOD,rendererExtensionFragDepth:y||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:y||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:y||i.has("EXT_shader_texture_lod"),customProgramCacheKey:q.customProgramCacheKey()}},getProgramCacheKey:function U(q){const oe=[];if(q.shaderID?oe.push(q.shaderID):(oe.push(q.customVertexShaderID),oe.push(q.customFragmentShaderID)),void 0!==q.defines)for(const qe in q.defines)oe.push(qe),oe.push(q.defines[qe]);return!1===q.isRawShaderMaterial&&(function k(q,oe){q.push(oe.precision),q.push(oe.outputEncoding),q.push(oe.envMapMode),q.push(oe.envMapCubeUVHeight),q.push(oe.combine),q.push(oe.vertexUvs),q.push(oe.fogExp2),q.push(oe.sizeAttenuation),q.push(oe.maxBones),q.push(oe.morphTargetsCount),q.push(oe.morphAttributeCount),q.push(oe.numDirLights),q.push(oe.numPointLights),q.push(oe.numSpotLights),q.push(oe.numHemiLights),q.push(oe.numRectAreaLights),q.push(oe.numDirLightShadows),q.push(oe.numPointLightShadows),q.push(oe.numSpotLightShadows),q.push(oe.shadowMapType),q.push(oe.toneMapping),q.push(oe.numClippingPlanes),q.push(oe.numClipIntersection)}(oe,q),function H(q,oe){c.disableAll(),oe.isWebGL2&&c.enable(0),oe.supportsVertexTextures&&c.enable(1),oe.instancing&&c.enable(2),oe.instancingColor&&c.enable(3),oe.map&&c.enable(4),oe.matcap&&c.enable(5),oe.envMap&&c.enable(6),oe.lightMap&&c.enable(7),oe.aoMap&&c.enable(8),oe.emissiveMap&&c.enable(9),oe.bumpMap&&c.enable(10),oe.normalMap&&c.enable(11),oe.objectSpaceNormalMap&&c.enable(12),oe.tangentSpaceNormalMap&&c.enable(13),oe.clearcoat&&c.enable(14),oe.clearcoatMap&&c.enable(15),oe.clearcoatRoughnessMap&&c.enable(16),oe.clearcoatNormalMap&&c.enable(17),oe.displacementMap&&c.enable(18),oe.specularMap&&c.enable(19),oe.roughnessMap&&c.enable(20),oe.metalnessMap&&c.enable(21),oe.gradientMap&&c.enable(22),oe.alphaMap&&c.enable(23),oe.alphaTest&&c.enable(24),oe.vertexColors&&c.enable(25),oe.vertexAlphas&&c.enable(26),oe.vertexUvs&&c.enable(27),oe.vertexTangents&&c.enable(28),oe.uvsVertexOnly&&c.enable(29),oe.fog&&c.enable(30),q.push(c.mask),c.disableAll(),oe.useFog&&c.enable(0),oe.flatShading&&c.enable(1),oe.logarithmicDepthBuffer&&c.enable(2),oe.skinning&&c.enable(3),oe.useVertexTexture&&c.enable(4),oe.morphTargets&&c.enable(5),oe.morphNormals&&c.enable(6),oe.morphColors&&c.enable(7),oe.premultipliedAlpha&&c.enable(8),oe.shadowMapEnabled&&c.enable(9),oe.physicallyCorrectLights&&c.enable(10),oe.doubleSided&&c.enable(11),oe.flipSided&&c.enable(12),oe.depthPacking&&c.enable(13),oe.dithering&&c.enable(14),oe.specularIntensityMap&&c.enable(15),oe.specularColorMap&&c.enable(16),oe.transmission&&c.enable(17),oe.transmissionMap&&c.enable(18),oe.thicknessMap&&c.enable(19),oe.sheen&&c.enable(20),oe.sheenColorMap&&c.enable(21),oe.sheenRoughnessMap&&c.enable(22),oe.decodeVideoTexture&&c.enable(23),oe.opaque&&c.enable(24),q.push(c.mask)}(oe,q),oe.push(n.outputEncoding)),oe.push(q.customProgramCacheKey),oe.join()},getUniforms:function Q(q){const oe=T[q.type];let qe;return qe=oe?uP.clone(Ga[oe].uniforms):q.uniforms,qe},acquireProgram:function ie(q,oe){let qe;for(let be=0,Le=p.length;be<Le;be++){const de=p[be];if(de.cacheKey===oe){qe=de,++qe.usedTimes;break}}return void 0===qe&&(qe=new b9(n,oe,q,o),p.push(qe)),qe},releaseProgram:function ce(q){if(0==--q.usedTimes){const oe=p.indexOf(q);p[oe]=p[p.length-1],p.pop(),q.destroy()}},releaseShaderCache:function De(q){d.remove(q)},programs:p,dispose:function ve(){d.dispose()}}}function C9(){let n=new WeakMap;return{get:function e(o){let l=n.get(o);return void 0===l&&(l={},n.set(o,l)),l},remove:function t(o){n.delete(o)},update:function i(o,l,c){n.get(o)[l]=c},dispose:function r(){n=new WeakMap}}}function T9(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function L3(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function F3(){const n=[];let e=0;const t=[],i=[],r=[];function l(v,x,b,S,E,T){let N=n[e];return void 0===N?(N={id:v.id,object:v,geometry:x,material:b,groupOrder:S,renderOrder:v.renderOrder,z:E,group:T},n[e]=N):(N.id=v.id,N.object=v,N.geometry=x,N.material=b,N.groupOrder=S,N.renderOrder=v.renderOrder,N.z=E,N.group=T),e++,N}return{opaque:t,transmissive:i,transparent:r,init:function o(){e=0,t.length=0,i.length=0,r.length=0},push:function c(v,x,b,S,E,T){const N=l(v,x,b,S,E,T);b.transmission>0?i.push(N):!0===b.transparent?r.push(N):t.push(N)},unshift:function d(v,x,b,S,E,T){const N=l(v,x,b,S,E,T);b.transmission>0?i.unshift(N):!0===b.transparent?r.unshift(N):t.unshift(N)},finish:function y(){for(let v=e,x=n.length;v<x;v++){const b=n[v];if(null===b.id)break;b.id=null,b.object=null,b.geometry=null,b.material=null,b.group=null}},sort:function p(v,x){t.length>1&&t.sort(v||T9),i.length>1&&i.sort(x||L3),r.length>1&&r.sort(x||L3)}}}function A9(){let n=new WeakMap;return{get:function e(i,r){let o;return!1===n.has(i)?(o=new F3,n.set(i,[o])):r>=n.get(i).length?(o=new F3,n.get(i).push(o)):o=n.get(i)[r],o},dispose:function t(){n=new WeakMap}}}function D9(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new $,color:new Ht};break;case"SpotLight":t={position:new $,direction:new $,color:new Ht,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new $,color:new Ht,distance:0,decay:0};break;case"HemisphereLight":t={direction:new $,skyColor:new Ht,groundColor:new Ht};break;case"RectAreaLight":t={color:new Ht,position:new $,halfWidth:new $,halfHeight:new $}}return n[e.id]=t,t}}}let P9=0;function I9(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function L9(n,e){const t=new D9,i=function R9(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let y=0;y<9;y++)r.probe.push(new $);const o=new $,l=new Tt,c=new Tt;return{setup:function d(y,v){let x=0,b=0,S=0;for(let De=0;De<9;De++)r.probe[De].set(0,0,0);let E=0,T=0,N=0,F=0,U=0,k=0,H=0,Q=0;y.sort(I9);const ie=!0!==v?Math.PI:1;for(let De=0,ve=y.length;De<ve;De++){const q=y[De],oe=q.color,qe=q.intensity,be=q.distance,Le=q.shadow&&q.shadow.map?q.shadow.map.texture:null;if(q.isAmbientLight)x+=oe.r*qe*ie,b+=oe.g*qe*ie,S+=oe.b*qe*ie;else if(q.isLightProbe)for(let de=0;de<9;de++)r.probe[de].addScaledVector(q.sh.coefficients[de],qe);else if(q.isDirectionalLight){const de=t.get(q);if(de.color.copy(q.color).multiplyScalar(q.intensity*ie),q.castShadow){const xe=q.shadow,ue=i.get(q);ue.shadowBias=xe.bias,ue.shadowNormalBias=xe.normalBias,ue.shadowRadius=xe.radius,ue.shadowMapSize=xe.mapSize,r.directionalShadow[E]=ue,r.directionalShadowMap[E]=Le,r.directionalShadowMatrix[E]=q.shadow.matrix,k++}r.directional[E]=de,E++}else if(q.isSpotLight){const de=t.get(q);if(de.position.setFromMatrixPosition(q.matrixWorld),de.color.copy(oe).multiplyScalar(qe*ie),de.distance=be,de.coneCos=Math.cos(q.angle),de.penumbraCos=Math.cos(q.angle*(1-q.penumbra)),de.decay=q.decay,q.castShadow){const xe=q.shadow,ue=i.get(q);ue.shadowBias=xe.bias,ue.shadowNormalBias=xe.normalBias,ue.shadowRadius=xe.radius,ue.shadowMapSize=xe.mapSize,r.spotShadow[N]=ue,r.spotShadowMap[N]=Le,r.spotShadowMatrix[N]=q.shadow.matrix,Q++}r.spot[N]=de,N++}else if(q.isRectAreaLight){const de=t.get(q);de.color.copy(oe).multiplyScalar(qe),de.halfWidth.set(.5*q.width,0,0),de.halfHeight.set(0,.5*q.height,0),r.rectArea[F]=de,F++}else if(q.isPointLight){const de=t.get(q);if(de.color.copy(q.color).multiplyScalar(q.intensity*ie),de.distance=q.distance,de.decay=q.decay,q.castShadow){const xe=q.shadow,ue=i.get(q);ue.shadowBias=xe.bias,ue.shadowNormalBias=xe.normalBias,ue.shadowRadius=xe.radius,ue.shadowMapSize=xe.mapSize,ue.shadowCameraNear=xe.camera.near,ue.shadowCameraFar=xe.camera.far,r.pointShadow[T]=ue,r.pointShadowMap[T]=Le,r.pointShadowMatrix[T]=q.shadow.matrix,H++}r.point[T]=de,T++}else if(q.isHemisphereLight){const de=t.get(q);de.skyColor.copy(q.color).multiplyScalar(qe*ie),de.groundColor.copy(q.groundColor).multiplyScalar(qe*ie),r.hemi[U]=de,U++}}F>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=It.LTC_FLOAT_1,r.rectAreaLTC2=It.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=It.LTC_HALF_1,r.rectAreaLTC2=It.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=x,r.ambient[1]=b,r.ambient[2]=S;const ce=r.hash;(ce.directionalLength!==E||ce.pointLength!==T||ce.spotLength!==N||ce.rectAreaLength!==F||ce.hemiLength!==U||ce.numDirectionalShadows!==k||ce.numPointShadows!==H||ce.numSpotShadows!==Q)&&(r.directional.length=E,r.spot.length=N,r.rectArea.length=F,r.point.length=T,r.hemi.length=U,r.directionalShadow.length=k,r.directionalShadowMap.length=k,r.pointShadow.length=H,r.pointShadowMap.length=H,r.spotShadow.length=Q,r.spotShadowMap.length=Q,r.directionalShadowMatrix.length=k,r.pointShadowMatrix.length=H,r.spotShadowMatrix.length=Q,ce.directionalLength=E,ce.pointLength=T,ce.spotLength=N,ce.rectAreaLength=F,ce.hemiLength=U,ce.numDirectionalShadows=k,ce.numPointShadows=H,ce.numSpotShadows=Q,r.version=P9++)},setupView:function p(y,v){let x=0,b=0,S=0,E=0,T=0;const N=v.matrixWorldInverse;for(let F=0,U=y.length;F<U;F++){const k=y[F];if(k.isDirectionalLight){const H=r.directional[x];H.direction.setFromMatrixPosition(k.matrixWorld),o.setFromMatrixPosition(k.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(N),x++}else if(k.isSpotLight){const H=r.spot[S];H.position.setFromMatrixPosition(k.matrixWorld),H.position.applyMatrix4(N),H.direction.setFromMatrixPosition(k.matrixWorld),o.setFromMatrixPosition(k.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(N),S++}else if(k.isRectAreaLight){const H=r.rectArea[E];H.position.setFromMatrixPosition(k.matrixWorld),H.position.applyMatrix4(N),c.identity(),l.copy(k.matrixWorld),l.premultiply(N),c.extractRotation(l),H.halfWidth.set(.5*k.width,0,0),H.halfHeight.set(0,.5*k.height,0),H.halfWidth.applyMatrix4(c),H.halfHeight.applyMatrix4(c),E++}else if(k.isPointLight){const H=r.point[b];H.position.setFromMatrixPosition(k.matrixWorld),H.position.applyMatrix4(N),b++}else if(k.isHemisphereLight){const H=r.hemi[T];H.direction.setFromMatrixPosition(k.matrixWorld),H.direction.transformDirection(N),H.direction.normalize(),T++}}},state:r}}function N3(n,e){const t=new L9(n,e),i=[],r=[];return{init:function o(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function d(v){t.setup(i,v)},setupLightsView:function p(v){t.setupView(i,v)},pushLight:function l(v){i.push(v)},pushShadow:function c(v){r.push(v)}}}function F9(n,e){let t=new WeakMap;return{get:function i(o,l=0){let c;return!1===t.has(o)?(c=new N3(n,e),t.set(o,[c])):l>=t.get(o).length?(c=new N3(n,e),t.get(o).push(c)):c=t.get(o)[l],c},dispose:function r(){t=new WeakMap}}}class vP extends qs{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}vP.prototype.isMeshDepthMaterial=!0;class xP extends qs{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new $,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function O3(n,e,t){let i=new IE;const r=new ct,o=new ct,l=new Qi,c=new vP({depthPacking:3201}),d=new xP,p={},y=t.maxTextureSize,v={0:1,1:0,2:2},x=new ql({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ct},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),b=x.clone();b.defines.HORIZONTAL_PASS=1;const S=new Tn;S.setAttribute("position",new Lr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new Xs(S,x),T=this;function N(k,H){const Q=e.update(E);x.defines.VSM_SAMPLES!==k.blurSamples&&(x.defines.VSM_SAMPLES=k.blurSamples,b.defines.VSM_SAMPLES=k.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0),x.uniforms.shadow_pass.value=k.map.texture,x.uniforms.resolution.value=k.mapSize,x.uniforms.radius.value=k.radius,n.setRenderTarget(k.mapPass),n.clear(),n.renderBufferDirect(H,null,Q,x,E,null),b.uniforms.shadow_pass.value=k.mapPass.texture,b.uniforms.resolution.value=k.mapSize,b.uniforms.radius.value=k.radius,n.setRenderTarget(k.map),n.clear(),n.renderBufferDirect(H,null,Q,b,E,null)}function F(k,H,Q,ie,ce,De){let ve=null;const q=!0===Q.isPointLight?k.customDistanceMaterial:k.customDepthMaterial;if(ve=void 0!==q?q:!0===Q.isPointLight?d:c,n.localClippingEnabled&&!0===H.clipShadows&&0!==H.clippingPlanes.length||H.displacementMap&&0!==H.displacementScale||H.alphaMap&&H.alphaTest>0){const oe=ve.uuid,qe=H.uuid;let be=p[oe];void 0===be&&(be={},p[oe]=be);let Le=be[qe];void 0===Le&&(Le=ve.clone(),be[qe]=Le),ve=Le}return ve.visible=H.visible,ve.wireframe=H.wireframe,ve.side=3===De?null!==H.shadowSide?H.shadowSide:H.side:null!==H.shadowSide?H.shadowSide:v[H.side],ve.alphaMap=H.alphaMap,ve.alphaTest=H.alphaTest,ve.clipShadows=H.clipShadows,ve.clippingPlanes=H.clippingPlanes,ve.clipIntersection=H.clipIntersection,ve.displacementMap=H.displacementMap,ve.displacementScale=H.displacementScale,ve.displacementBias=H.displacementBias,ve.wireframeLinewidth=H.wireframeLinewidth,ve.linewidth=H.linewidth,!0===Q.isPointLight&&!0===ve.isMeshDistanceMaterial&&(ve.referencePosition.setFromMatrixPosition(Q.matrixWorld),ve.nearDistance=ie,ve.farDistance=ce),ve}function U(k,H,Q,ie,ce){if(!1===k.visible)return;if(k.layers.test(H.layers)&&(k.isMesh||k.isLine||k.isPoints)&&(k.castShadow||k.receiveShadow&&3===ce)&&(!k.frustumCulled||i.intersectsObject(k))){k.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,k.matrixWorld);const q=e.update(k),oe=k.material;if(Array.isArray(oe)){const qe=q.groups;for(let be=0,Le=qe.length;be<Le;be++){const de=qe[be],xe=oe[de.materialIndex];if(xe&&xe.visible){const ue=F(k,xe,ie,Q.near,Q.far,ce);n.renderBufferDirect(Q,null,q,ue,k,de)}}}else if(oe.visible){const qe=F(k,oe,ie,Q.near,Q.far,ce);n.renderBufferDirect(Q,null,q,qe,k,null)}}const ve=k.children;for(let q=0,oe=ve.length;q<oe;q++)U(ve[q],H,Q,ie,ce)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(k,H,Q){if(!1===T.enabled||!1===T.autoUpdate&&!1===T.needsUpdate||0===k.length)return;const ie=n.getRenderTarget(),ce=n.getActiveCubeFace(),De=n.getActiveMipmapLevel(),ve=n.state;ve.setBlending(0),ve.buffers.color.setClear(1,1,1,1),ve.buffers.depth.setTest(!0),ve.setScissorTest(!1);for(let q=0,oe=k.length;q<oe;q++){const qe=k[q],be=qe.shadow;if(void 0===be){console.warn("THREE.WebGLShadowMap:",qe,"has no shadow.");continue}if(!1===be.autoUpdate&&!1===be.needsUpdate)continue;r.copy(be.mapSize);const Le=be.getFrameExtents();r.multiply(Le),o.copy(be.mapSize),(r.x>y||r.y>y)&&(r.x>y&&(o.x=Math.floor(y/Le.x),r.x=o.x*Le.x,be.mapSize.x=o.x),r.y>y&&(o.y=Math.floor(y/Le.y),r.y=o.y*Le.y,be.mapSize.y=o.y)),null===be.map&&!be.isPointLightShadow&&3===this.type&&(be.map=new al(r.x,r.y),be.map.texture.name=qe.name+".shadowMap",be.mapPass=new al(r.x,r.y),be.camera.updateProjectionMatrix()),null===be.map&&(be.map=new al(r.x,r.y,{minFilter:ao,magFilter:ao,format:Gl}),be.map.texture.name=qe.name+".shadowMap",be.camera.updateProjectionMatrix()),n.setRenderTarget(be.map),n.clear();const de=be.getViewportCount();for(let xe=0;xe<de;xe++){const ue=be.getViewport(xe);l.set(o.x*ue.x,o.y*ue.y,o.x*ue.z,o.y*ue.w),ve.viewport(l),be.updateMatrices(qe,xe),i=be.getFrustum(),U(H,Q,be.camera,qe,this.type)}!be.isPointLightShadow&&3===this.type&&N(be,Q),be.needsUpdate=!1}T.needsUpdate=!1,n.setRenderTarget(ie,ce,De)}}function k9(n,e,t){const i=t.isWebGL2,c=new function r(){let ge=!1;const Gt=new Qi;let kt=null;const Qn=new Qi(0,0,0,0);return{setMask:function(dn){kt!==dn&&!ge&&(n.colorMask(dn,dn,dn,dn),kt=dn)},setLocked:function(dn){ge=dn},setClear:function(dn,ei,Nt,ui,Vr){!0===Vr&&(dn*=ui,ei*=ui,Nt*=ui),Gt.set(dn,ei,Nt,ui),!1===Qn.equals(Gt)&&(n.clearColor(dn,ei,Nt,ui),Qn.copy(Gt))},reset:function(){ge=!1,kt=null,Qn.set(-1,0,0,0)}}},d=new function o(){let ge=!1,Gt=null,kt=null,Qn=null;return{setTest:function(dn){dn?qn(2929):tt(2929)},setMask:function(dn){Gt!==dn&&!ge&&(n.depthMask(dn),Gt=dn)},setFunc:function(dn){if(kt!==dn){if(dn)switch(dn){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}else n.depthFunc(515);kt=dn}},setLocked:function(dn){ge=dn},setClear:function(dn){Qn!==dn&&(n.clearDepth(dn),Qn=dn)},reset:function(){ge=!1,Gt=null,kt=null,Qn=null}}},p=new function l(){let ge=!1,Gt=null,kt=null,Qn=null,dn=null,ei=null,Nt=null,ui=null,Vr=null;return{setTest:function(Ki){ge||(Ki?qn(2960):tt(2960))},setMask:function(Ki){Gt!==Ki&&!ge&&(n.stencilMask(Ki),Gt=Ki)},setFunc:function(Ki,Eu,Cu){(kt!==Ki||Qn!==Eu||dn!==Cu)&&(n.stencilFunc(Ki,Eu,Cu),kt=Ki,Qn=Eu,dn=Cu)},setOp:function(Ki,Eu,Cu){(ei!==Ki||Nt!==Eu||ui!==Cu)&&(n.stencilOp(Ki,Eu,Cu),ei=Ki,Nt=Eu,ui=Cu)},setLocked:function(Ki){ge=Ki},setClear:function(Ki){Vr!==Ki&&(n.clearStencil(Ki),Vr=Ki)},reset:function(){ge=!1,Gt=null,kt=null,Qn=null,dn=null,ei=null,Nt=null,ui=null,Vr=null}}};let y={},v={},x=new WeakMap,b=[],S=null,E=!1,T=null,N=null,F=null,U=null,k=null,H=null,Q=null,ie=!1,ce=null,De=null,ve=null,q=null,oe=null;const qe=n.getParameter(35661);let be=!1,Le=0;const de=n.getParameter(7938);-1!==de.indexOf("WebGL")?(Le=parseFloat(/^WebGL (\d)/.exec(de)[1]),be=Le>=1):-1!==de.indexOf("OpenGL ES")&&(Le=parseFloat(/^OpenGL ES (\d)/.exec(de)[1]),be=Le>=2);let xe=null,ue={};const Re=n.getParameter(3088),Ye=n.getParameter(2978),gt=(new Qi).fromArray(Re),st=(new Qi).fromArray(Ye);function ln(ge,Gt,kt){const Qn=new Uint8Array(4),dn=n.createTexture();n.bindTexture(ge,dn),n.texParameteri(ge,10241,9728),n.texParameteri(ge,10240,9728);for(let ei=0;ei<kt;ei++)n.texImage2D(Gt+ei,0,6408,1,1,0,6408,5121,Qn);return dn}const hn={};function qn(ge){!0!==y[ge]&&(n.enable(ge),y[ge]=!0)}function tt(ge){!1!==y[ge]&&(n.disable(ge),y[ge]=!1)}hn[3553]=ln(3553,3553,1),hn[34067]=ln(34067,34069,6),c.setClear(0,0,0,1),d.setClear(1),p.setClear(0),qn(2929),d.setFunc(3),Mt(!1),pn(1),qn(2884),et(0);const bt={100:32774,101:32778,102:32779};if(i)bt[103]=32775,bt[104]=32776;else{const ge=e.get("EXT_blend_minmax");null!==ge&&(bt[103]=ge.MIN_EXT,bt[104]=ge.MAX_EXT)}const di={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function et(ge,Gt,kt,Qn,dn,ei,Nt,ui){if(0!==ge){if(!1===E&&(qn(3042),E=!0),5===ge)dn=dn||Gt,ei=ei||kt,Nt=Nt||Qn,(Gt!==N||dn!==k)&&(n.blendEquationSeparate(bt[Gt],bt[dn]),N=Gt,k=dn),(kt!==F||Qn!==U||ei!==H||Nt!==Q)&&(n.blendFuncSeparate(di[kt],di[Qn],di[ei],di[Nt]),F=kt,U=Qn,H=ei,Q=Nt),T=ge,ie=null;else if(ge!==T||ui!==ie){if((100!==N||100!==k)&&(n.blendEquation(32774),N=100,k=100),ui)switch(ge){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ge)}else switch(ge){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ge)}F=null,U=null,H=null,Q=null,T=ge,ie=ui}}else!0===E&&(tt(3042),E=!1)}function Mt(ge){ce!==ge&&(n.frontFace(ge?2304:2305),ce=ge)}function pn(ge){0!==ge?(qn(2884),ge!==De&&n.cullFace(1===ge?1029:2===ge?1028:1032)):tt(2884),De=ge}function fi(ge,Gt,kt){ge?(qn(32823),(q!==Gt||oe!==kt)&&(n.polygonOffset(Gt,kt),q=Gt,oe=kt)):tt(32823)}function On(ge){void 0===ge&&(ge=33984+qe-1),xe!==ge&&(n.activeTexture(ge),xe=ge)}return{buffers:{color:c,depth:d,stencil:p},enable:qn,disable:tt,bindFramebuffer:function Yn(ge,Gt){return v[ge]!==Gt&&(n.bindFramebuffer(ge,Gt),v[ge]=Gt,i&&(36009===ge&&(v[36160]=Gt),36160===ge&&(v[36009]=Gt)),!0)},drawBuffers:function Gn(ge,Gt){let kt=b,Qn=!1;if(ge)if(kt=x.get(Gt),void 0===kt&&(kt=[],x.set(Gt,kt)),ge.isWebGLMultipleRenderTargets){const dn=ge.texture;if(kt.length!==dn.length||36064!==kt[0]){for(let ei=0,Nt=dn.length;ei<Nt;ei++)kt[ei]=36064+ei;kt.length=dn.length,Qn=!0}}else 36064!==kt[0]&&(kt[0]=36064,Qn=!0);else 1029!==kt[0]&&(kt[0]=1029,Qn=!0);Qn&&(t.isWebGL2?n.drawBuffers(kt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(kt))},useProgram:function Vn(ge){return S!==ge&&(n.useProgram(ge),S=ge,!0)},setBlending:et,setMaterial:function ht(ge,Gt){2===ge.side?tt(2884):qn(2884);let kt=1===ge.side;Gt&&(kt=!kt),Mt(kt),1===ge.blending&&!1===ge.transparent?et(0):et(ge.blending,ge.blendEquation,ge.blendSrc,ge.blendDst,ge.blendEquationAlpha,ge.blendSrcAlpha,ge.blendDstAlpha,ge.premultipliedAlpha),d.setFunc(ge.depthFunc),d.setTest(ge.depthTest),d.setMask(ge.depthWrite),c.setMask(ge.colorWrite);const Qn=ge.stencilWrite;p.setTest(Qn),Qn&&(p.setMask(ge.stencilWriteMask),p.setFunc(ge.stencilFunc,ge.stencilRef,ge.stencilFuncMask),p.setOp(ge.stencilFail,ge.stencilZFail,ge.stencilZPass)),fi(ge.polygonOffset,ge.polygonOffsetFactor,ge.polygonOffsetUnits),!0===ge.alphaToCoverage?qn(32926):tt(32926)},setFlipSided:Mt,setCullFace:pn,setLineWidth:function Kt(ge){ge!==ve&&(be&&n.lineWidth(ge),ve=ge)},setPolygonOffset:fi,setScissorTest:function jn(ge){ge?qn(3089):tt(3089)},activeTexture:On,bindTexture:function is(ge,Gt){null===xe&&On();let kt=ue[xe];void 0===kt&&(kt={type:void 0,texture:void 0},ue[xe]=kt),(kt.type!==ge||kt.texture!==Gt)&&(n.bindTexture(ge,Gt||hn[ge]),kt.type=ge,kt.texture=Gt)},unbindTexture:function Tr(){const ge=ue[xe];void 0!==ge&&void 0!==ge.type&&(n.bindTexture(ge.type,null),ge.type=void 0,ge.texture=void 0)},compressedTexImage2D:function se(){try{n.compressedTexImage2D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},texImage2D:function Wn(){try{n.texImage2D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},texImage3D:function Ke(){try{n.texImage3D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},texStorage2D:function Xt(){try{n.texStorage2D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},texStorage3D:function sn(){try{n.texStorage3D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},texSubImage2D:function Z(){try{n.texSubImage2D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},texSubImage3D:function Xe(){try{n.texSubImage3D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},compressedTexSubImage2D:function _t(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}},scissor:function xi(ge){!1===gt.equals(ge)&&(n.scissor(ge.x,ge.y,ge.z,ge.w),gt.copy(ge))},viewport:function Ai(ge){!1===st.equals(ge)&&(n.viewport(ge.x,ge.y,ge.z,ge.w),st.copy(ge))},reset:function mn(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),y={},xe=null,ue={},v={},x=new WeakMap,b=[],S=null,E=!1,T=null,N=null,F=null,U=null,k=null,H=null,Q=null,ie=!1,ce=null,De=null,ve=null,q=null,oe=null,gt.set(0,0,n.canvas.width,n.canvas.height),st.set(0,0,n.canvas.width,n.canvas.height),c.reset(),d.reset(),p.reset()}}}function B9(n,e,t,i,r,o,l){const c=r.isWebGL2,d=r.maxTextures,p=r.maxCubemapSize,y=r.maxTextureSize,v=r.maxSamples,x=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,b=/OculusBrowser/g.test(navigator.userAgent),S=new WeakMap;let E;const T=new WeakMap;let N=!1;try{N="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(se){}function F(se,Z){return N?new OffscreenCanvas(se,Z):Ix("canvas")}function U(se,Z,Xe,_t){let Xt=1;if((se.width>_t||se.height>_t)&&(Xt=_t/Math.max(se.width,se.height)),Xt<1||!0===Z){if("undefined"!=typeof HTMLImageElement&&se instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&se instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&se instanceof ImageBitmap){const sn=Z?cE:Math.floor,Wn=sn(Xt*se.width),Ke=sn(Xt*se.height);void 0===E&&(E=F(Wn,Ke));const xi=Xe?F(Wn,Ke):E;return xi.width=Wn,xi.height=Ke,xi.getContext("2d").drawImage(se,0,0,Wn,Ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+se.width+"x"+se.height+") to ("+Wn+"x"+Ke+")."),xi}return"data"in se&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+se.width+"x"+se.height+")."),se}return se}function k(se){return zR(se.width)&&zR(se.height)}function Q(se,Z){return se.generateMipmaps&&Z&&se.minFilter!==ao&&se.minFilter!==Gs}function ie(se){n.generateMipmap(se)}function ce(se,Z,Xe,_t,Xt=!1){if(!1===c)return Z;if(null!==se){if(void 0!==n[se])return n[se];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+se+"'")}let sn=Z;return 6403===Z&&(5126===Xe&&(sn=33326),5131===Xe&&(sn=33325),5121===Xe&&(sn=33321)),33319===Z&&(5126===Xe&&(sn=33328),5131===Xe&&(sn=33327),5121===Xe&&(sn=33323)),6408===Z&&(5126===Xe&&(sn=34836),5131===Xe&&(sn=34842),5121===Xe&&(sn=_t===$r&&!1===Xt?35907:32856),32819===Xe&&(sn=32854),32820===Xe&&(sn=32855)),(33325===sn||33326===sn||33327===sn||33328===sn||34842===sn||34836===sn)&&e.get("EXT_color_buffer_float"),sn}function De(se,Z,Xe){return!0===Q(se,Xe)||se.isFramebufferTexture&&se.minFilter!==ao&&se.minFilter!==Gs?Math.log2(Math.max(Z.width,Z.height))+1:void 0!==se.mipmaps&&se.mipmaps.length>0?se.mipmaps.length:se.isCompressedTexture&&Array.isArray(se.image)?Z.mipmaps.length:1}function ve(se){return se===ao||1004===se||1005===se?9728:9729}function q(se){const Z=se.target;Z.removeEventListener("dispose",q),function qe(se){const Z=i.get(se);if(void 0===Z.__webglInit)return;const Xe=se.source,_t=T.get(Xe);if(_t){const Xt=_t[Z.__cacheKey];Xt.usedTimes--,0===Xt.usedTimes&&be(se),0===Object.keys(_t).length&&T.delete(Xe)}i.remove(se)}(Z),Z.isVideoTexture&&S.delete(Z)}function oe(se){const Z=se.target;Z.removeEventListener("dispose",oe),function Le(se){const Z=se.texture,Xe=i.get(se),_t=i.get(Z);if(void 0!==_t.__webglTexture&&(n.deleteTexture(_t.__webglTexture),l.memory.textures--),se.depthTexture&&se.depthTexture.dispose(),se.isWebGLCubeRenderTarget)for(let Xt=0;Xt<6;Xt++)n.deleteFramebuffer(Xe.__webglFramebuffer[Xt]),Xe.__webglDepthbuffer&&n.deleteRenderbuffer(Xe.__webglDepthbuffer[Xt]);else n.deleteFramebuffer(Xe.__webglFramebuffer),Xe.__webglDepthbuffer&&n.deleteRenderbuffer(Xe.__webglDepthbuffer),Xe.__webglMultisampledFramebuffer&&n.deleteFramebuffer(Xe.__webglMultisampledFramebuffer),Xe.__webglColorRenderbuffer&&n.deleteRenderbuffer(Xe.__webglColorRenderbuffer),Xe.__webglDepthRenderbuffer&&n.deleteRenderbuffer(Xe.__webglDepthRenderbuffer);if(se.isWebGLMultipleRenderTargets)for(let Xt=0,sn=Z.length;Xt<sn;Xt++){const Wn=i.get(Z[Xt]);Wn.__webglTexture&&(n.deleteTexture(Wn.__webglTexture),l.memory.textures--),i.remove(Z[Xt])}i.remove(Z),i.remove(se)}(Z)}function be(se){const Z=i.get(se);n.deleteTexture(Z.__webglTexture),delete T.get(se.source)[Z.__cacheKey],l.memory.textures--}let de=0;function Ye(se,Z){const Xe=i.get(se);if(se.isVideoTexture&&function is(se){const Z=l.render.frame;S.get(se)!==Z&&(S.set(se,Z),se.update())}(se),!1===se.isRenderTargetTexture&&se.version>0&&Xe.__version!==se.version){const _t=se.image;if(null===_t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==_t.complete)return void Gn(Xe,se,Z);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+Z),t.bindTexture(3553,Xe.__webglTexture)}const hn={1e3:10497,[za]:33071,1002:33648},qn={[ao]:9728,1004:9984,1005:9986,[Gs]:9729,1007:9985,1008:9987};function tt(se,Z,Xe){if(Xe?(n.texParameteri(se,10242,hn[Z.wrapS]),n.texParameteri(se,10243,hn[Z.wrapT]),(32879===se||35866===se)&&n.texParameteri(se,32882,hn[Z.wrapR]),n.texParameteri(se,10240,qn[Z.magFilter]),n.texParameteri(se,10241,qn[Z.minFilter])):(n.texParameteri(se,10242,33071),n.texParameteri(se,10243,33071),(32879===se||35866===se)&&n.texParameteri(se,32882,33071),(Z.wrapS!==za||Z.wrapT!==za)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(se,10240,ve(Z.magFilter)),n.texParameteri(se,10241,ve(Z.minFilter)),Z.minFilter!==ao&&Z.minFilter!==Gs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const _t=e.get("EXT_texture_filter_anisotropic");if(Z.type===yf&&!1===e.has("OES_texture_float_linear")||!1===c&&Z.type===jy&&!1===e.has("OES_texture_half_float_linear"))return;(Z.anisotropy>1||i.get(Z).__currentAnisotropy)&&(n.texParameterf(se,_t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z.anisotropy,r.getMaxAnisotropy())),i.get(Z).__currentAnisotropy=Z.anisotropy)}}function Yn(se,Z){let Xe=!1;void 0===se.__webglInit&&(se.__webglInit=!0,Z.addEventListener("dispose",q));const _t=Z.source;let Xt=T.get(_t);void 0===Xt&&(Xt={},T.set(_t,Xt));const sn=function Re(se){const Z=[];return Z.push(se.wrapS),Z.push(se.wrapT),Z.push(se.magFilter),Z.push(se.minFilter),Z.push(se.anisotropy),Z.push(se.internalFormat),Z.push(se.format),Z.push(se.type),Z.push(se.generateMipmaps),Z.push(se.premultiplyAlpha),Z.push(se.flipY),Z.push(se.unpackAlignment),Z.push(se.encoding),Z.join()}(Z);if(sn!==se.__cacheKey){void 0===Xt[sn]&&(Xt[sn]={texture:n.createTexture(),usedTimes:0},l.memory.textures++,Xe=!0),Xt[sn].usedTimes++;const Wn=Xt[se.__cacheKey];void 0!==Wn&&(Xt[se.__cacheKey].usedTimes--,0===Wn.usedTimes&&be(Z)),se.__cacheKey=sn,se.__webglTexture=Xt[sn].texture}return Xe}function Gn(se,Z,Xe){let _t=3553;Z.isDataArrayTexture&&(_t=35866),Z.isData3DTexture&&(_t=32879);const Xt=Yn(se,Z),sn=Z.source;if(t.activeTexture(33984+Xe),t.bindTexture(_t,se.__webglTexture),sn.version!==sn.__currentVersion||!0===Xt){n.pixelStorei(37440,Z.flipY),n.pixelStorei(37441,Z.premultiplyAlpha),n.pixelStorei(3317,Z.unpackAlignment),n.pixelStorei(37443,0);const Wn=function H(se){return!c&&(se.wrapS!==za||se.wrapT!==za||se.minFilter!==ao&&se.minFilter!==Gs)}(Z)&&!1===k(Z.image);let Ke=U(Z.image,Wn,!1,y);Ke=Tr(Z,Ke);const xi=k(Ke)||c,Ai=o.convert(Z.format,Z.encoding);let Gt,mn=o.convert(Z.type),ge=ce(Z.internalFormat,Ai,mn,Z.encoding,Z.isVideoTexture);tt(_t,Z,xi);const kt=Z.mipmaps,Qn=c&&!0!==Z.isVideoTexture,dn=void 0===se.__version,ei=De(Z,Ke,xi);if(Z.isDepthTexture)ge=6402,c?ge=Z.type===yf?36012:1014===Z.type?33190:Z.type===Xy?35056:33189:Z.type===yf&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Z.format===Tm&&6402===ge&&Z.type!==Tx&&1014!==Z.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Z.type=Tx,mn=o.convert(Z.type)),Z.format===$y&&6402===ge&&(ge=34041,Z.type!==Xy&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Z.type=Xy,mn=o.convert(Z.type))),Qn&&dn?t.texStorage2D(3553,1,ge,Ke.width,Ke.height):t.texImage2D(3553,0,ge,Ke.width,Ke.height,0,Ai,mn,null);else if(Z.isDataTexture)if(kt.length>0&&xi){Qn&&dn&&t.texStorage2D(3553,ei,ge,kt[0].width,kt[0].height);for(let Nt=0,ui=kt.length;Nt<ui;Nt++)Gt=kt[Nt],Qn?t.texSubImage2D(3553,Nt,0,0,Gt.width,Gt.height,Ai,mn,Gt.data):t.texImage2D(3553,Nt,ge,Gt.width,Gt.height,0,Ai,mn,Gt.data);Z.generateMipmaps=!1}else Qn?(dn&&t.texStorage2D(3553,ei,ge,Ke.width,Ke.height),t.texSubImage2D(3553,0,0,0,Ke.width,Ke.height,Ai,mn,Ke.data)):t.texImage2D(3553,0,ge,Ke.width,Ke.height,0,Ai,mn,Ke.data);else if(Z.isCompressedTexture){Qn&&dn&&t.texStorage2D(3553,ei,ge,kt[0].width,kt[0].height);for(let Nt=0,ui=kt.length;Nt<ui;Nt++)Gt=kt[Nt],Z.format!==Gl?null!==Ai?Qn?t.compressedTexSubImage2D(3553,Nt,0,0,Gt.width,Gt.height,Ai,Gt.data):t.compressedTexImage2D(3553,Nt,ge,Gt.width,Gt.height,0,Gt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Qn?t.texSubImage2D(3553,Nt,0,0,Gt.width,Gt.height,Ai,mn,Gt.data):t.texImage2D(3553,Nt,ge,Gt.width,Gt.height,0,Ai,mn,Gt.data)}else if(Z.isDataArrayTexture)Qn?(dn&&t.texStorage3D(35866,ei,ge,Ke.width,Ke.height,Ke.depth),t.texSubImage3D(35866,0,0,0,0,Ke.width,Ke.height,Ke.depth,Ai,mn,Ke.data)):t.texImage3D(35866,0,ge,Ke.width,Ke.height,Ke.depth,0,Ai,mn,Ke.data);else if(Z.isData3DTexture)Qn?(dn&&t.texStorage3D(32879,ei,ge,Ke.width,Ke.height,Ke.depth),t.texSubImage3D(32879,0,0,0,0,Ke.width,Ke.height,Ke.depth,Ai,mn,Ke.data)):t.texImage3D(32879,0,ge,Ke.width,Ke.height,Ke.depth,0,Ai,mn,Ke.data);else if(Z.isFramebufferTexture)Qn&&dn?t.texStorage2D(3553,ei,ge,Ke.width,Ke.height):t.texImage2D(3553,0,ge,Ke.width,Ke.height,0,Ai,mn,null);else if(kt.length>0&&xi){Qn&&dn&&t.texStorage2D(3553,ei,ge,kt[0].width,kt[0].height);for(let Nt=0,ui=kt.length;Nt<ui;Nt++)Gt=kt[Nt],Qn?t.texSubImage2D(3553,Nt,0,0,Ai,mn,Gt):t.texImage2D(3553,Nt,ge,Ai,mn,Gt);Z.generateMipmaps=!1}else Qn?(dn&&t.texStorage2D(3553,ei,ge,Ke.width,Ke.height),t.texSubImage2D(3553,0,0,0,Ai,mn,Ke)):t.texImage2D(3553,0,ge,Ai,mn,Ke);Q(Z,xi)&&ie(_t),sn.__currentVersion=sn.version,Z.onUpdate&&Z.onUpdate(Z)}se.__version=Z.version}function bt(se,Z,Xe,_t,Xt){const sn=o.convert(Xe.format,Xe.encoding),Wn=o.convert(Xe.type),Ke=ce(Xe.internalFormat,sn,Wn,Xe.encoding);i.get(Z).__hasExternalTextures||(32879===Xt||35866===Xt?t.texImage3D(Xt,0,Ke,Z.width,Z.height,Z.depth,0,sn,Wn,null):t.texImage2D(Xt,0,Ke,Z.width,Z.height,0,sn,Wn,null)),t.bindFramebuffer(36160,se),On(Z)?x.framebufferTexture2DMultisampleEXT(36160,_t,Xt,i.get(Xe).__webglTexture,0,jn(Z)):n.framebufferTexture2D(36160,_t,Xt,i.get(Xe).__webglTexture,0),t.bindFramebuffer(36160,null)}function di(se,Z,Xe){if(n.bindRenderbuffer(36161,se),Z.depthBuffer&&!Z.stencilBuffer){let _t=33189;if(Xe||On(Z)){const Xt=Z.depthTexture;Xt&&Xt.isDepthTexture&&(Xt.type===yf?_t=36012:1014===Xt.type&&(_t=33190));const sn=jn(Z);On(Z)?x.renderbufferStorageMultisampleEXT(36161,sn,_t,Z.width,Z.height):n.renderbufferStorageMultisample(36161,sn,_t,Z.width,Z.height)}else n.renderbufferStorage(36161,_t,Z.width,Z.height);n.framebufferRenderbuffer(36160,36096,36161,se)}else if(Z.depthBuffer&&Z.stencilBuffer){const _t=jn(Z);Xe&&!1===On(Z)?n.renderbufferStorageMultisample(36161,_t,35056,Z.width,Z.height):On(Z)?x.renderbufferStorageMultisampleEXT(36161,_t,35056,Z.width,Z.height):n.renderbufferStorage(36161,34041,Z.width,Z.height),n.framebufferRenderbuffer(36160,33306,36161,se)}else{const _t=!0===Z.isWebGLMultipleRenderTargets?Z.texture[0]:Z.texture,Xt=o.convert(_t.format,_t.encoding),sn=o.convert(_t.type),Wn=ce(_t.internalFormat,Xt,sn,_t.encoding),Ke=jn(Z);Xe&&!1===On(Z)?n.renderbufferStorageMultisample(36161,Ke,Wn,Z.width,Z.height):On(Z)?x.renderbufferStorageMultisampleEXT(36161,Ke,Wn,Z.width,Z.height):n.renderbufferStorage(36161,Wn,Z.width,Z.height)}n.bindRenderbuffer(36161,null)}function ht(se){const Z=i.get(se),Xe=!0===se.isWebGLCubeRenderTarget;if(se.depthTexture&&!Z.__autoAllocateDepthBuffer){if(Xe)throw new Error("target.depthTexture not supported in Cube render targets");!function et(se,Z){if(Z&&Z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,se),!Z.depthTexture||!Z.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(Z.depthTexture).__webglTexture||Z.depthTexture.image.width!==Z.width||Z.depthTexture.image.height!==Z.height)&&(Z.depthTexture.image.width=Z.width,Z.depthTexture.image.height=Z.height,Z.depthTexture.needsUpdate=!0),Ye(Z.depthTexture,0);const _t=i.get(Z.depthTexture).__webglTexture,Xt=jn(Z);if(Z.depthTexture.format===Tm)On(Z)?x.framebufferTexture2DMultisampleEXT(36160,36096,3553,_t,0,Xt):n.framebufferTexture2D(36160,36096,3553,_t,0);else{if(Z.depthTexture.format!==$y)throw new Error("Unknown depthTexture format");On(Z)?x.framebufferTexture2DMultisampleEXT(36160,33306,3553,_t,0,Xt):n.framebufferTexture2D(36160,33306,3553,_t,0)}}(Z.__webglFramebuffer,se)}else if(Xe){Z.__webglDepthbuffer=[];for(let _t=0;_t<6;_t++)t.bindFramebuffer(36160,Z.__webglFramebuffer[_t]),Z.__webglDepthbuffer[_t]=n.createRenderbuffer(),di(Z.__webglDepthbuffer[_t],se,!1)}else t.bindFramebuffer(36160,Z.__webglFramebuffer),Z.__webglDepthbuffer=n.createRenderbuffer(),di(Z.__webglDepthbuffer,se,!1);t.bindFramebuffer(36160,null)}function jn(se){return Math.min(v,se.samples)}function On(se){const Z=i.get(se);return c&&se.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==Z.__useRenderToTexture}function Tr(se,Z){const Xe=se.encoding,_t=se.format,Xt=se.type;return!0===se.isCompressedTexture||!0===se.isVideoTexture||1035===se.format||Xe!==kh&&(Xe===$r?!1===c?!0===e.has("EXT_sRGB")&&_t===Gl?(se.format=1035,se.minFilter=Gs,se.generateMipmaps=!1):Z=Pm.sRGBToLinear(Z):(_t!==Gl||Xt!==Cm)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Xe)),Z}this.allocateTextureUnit=function ue(){const se=de;return se>=d&&console.warn("THREE.WebGLTextures: Trying to use "+se+" texture units while this GPU supports only "+d),de+=1,se},this.resetTextureUnits=function xe(){de=0},this.setTexture2D=Ye,this.setTexture2DArray=function gt(se,Z){const Xe=i.get(se);se.version>0&&Xe.__version!==se.version?Gn(Xe,se,Z):(t.activeTexture(33984+Z),t.bindTexture(35866,Xe.__webglTexture))},this.setTexture3D=function st(se,Z){const Xe=i.get(se);se.version>0&&Xe.__version!==se.version?Gn(Xe,se,Z):(t.activeTexture(33984+Z),t.bindTexture(32879,Xe.__webglTexture))},this.setTextureCube=function ln(se,Z){const Xe=i.get(se);se.version>0&&Xe.__version!==se.version?function Vn(se,Z,Xe){if(6!==Z.image.length)return;const _t=Yn(se,Z),Xt=Z.source;if(t.activeTexture(33984+Xe),t.bindTexture(34067,se.__webglTexture),Xt.version!==Xt.__currentVersion||!0===_t){n.pixelStorei(37440,Z.flipY),n.pixelStorei(37441,Z.premultiplyAlpha),n.pixelStorei(3317,Z.unpackAlignment),n.pixelStorei(37443,0);const sn=Z.isCompressedTexture||Z.image[0].isCompressedTexture,Wn=Z.image[0]&&Z.image[0].isDataTexture,Ke=[];for(let Nt=0;Nt<6;Nt++)Ke[Nt]=sn||Wn?Wn?Z.image[Nt].image:Z.image[Nt]:U(Z.image[Nt],!1,!0,p),Ke[Nt]=Tr(Z,Ke[Nt]);const xi=Ke[0],Ai=k(xi)||c,mn=o.convert(Z.format,Z.encoding),ge=o.convert(Z.type),Gt=ce(Z.internalFormat,mn,ge,Z.encoding),kt=c&&!0!==Z.isVideoTexture,Qn=void 0===se.__version;let ei,dn=De(Z,xi,Ai);if(tt(34067,Z,Ai),sn){kt&&Qn&&t.texStorage2D(34067,dn,Gt,xi.width,xi.height);for(let Nt=0;Nt<6;Nt++){ei=Ke[Nt].mipmaps;for(let ui=0;ui<ei.length;ui++){const Vr=ei[ui];Z.format!==Gl?null!==mn?kt?t.compressedTexSubImage2D(34069+Nt,ui,0,0,Vr.width,Vr.height,mn,Vr.data):t.compressedTexImage2D(34069+Nt,ui,Gt,Vr.width,Vr.height,0,Vr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):kt?t.texSubImage2D(34069+Nt,ui,0,0,Vr.width,Vr.height,mn,ge,Vr.data):t.texImage2D(34069+Nt,ui,Gt,Vr.width,Vr.height,0,mn,ge,Vr.data)}}}else{ei=Z.mipmaps,kt&&Qn&&(ei.length>0&&dn++,t.texStorage2D(34067,dn,Gt,Ke[0].width,Ke[0].height));for(let Nt=0;Nt<6;Nt++)if(Wn){kt?t.texSubImage2D(34069+Nt,0,0,0,Ke[Nt].width,Ke[Nt].height,mn,ge,Ke[Nt].data):t.texImage2D(34069+Nt,0,Gt,Ke[Nt].width,Ke[Nt].height,0,mn,ge,Ke[Nt].data);for(let ui=0;ui<ei.length;ui++){const Ki=ei[ui].image[Nt].image;kt?t.texSubImage2D(34069+Nt,ui+1,0,0,Ki.width,Ki.height,mn,ge,Ki.data):t.texImage2D(34069+Nt,ui+1,Gt,Ki.width,Ki.height,0,mn,ge,Ki.data)}}else{kt?t.texSubImage2D(34069+Nt,0,0,0,mn,ge,Ke[Nt]):t.texImage2D(34069+Nt,0,Gt,mn,ge,Ke[Nt]);for(let ui=0;ui<ei.length;ui++){const Vr=ei[ui];kt?t.texSubImage2D(34069+Nt,ui+1,0,0,mn,ge,Vr.image[Nt]):t.texImage2D(34069+Nt,ui+1,Gt,mn,ge,Vr.image[Nt])}}}Q(Z,Ai)&&ie(34067),Xt.__currentVersion=Xt.version,Z.onUpdate&&Z.onUpdate(Z)}se.__version=Z.version}(Xe,se,Z):(t.activeTexture(33984+Z),t.bindTexture(34067,Xe.__webglTexture))},this.rebindTextures=function Mt(se,Z,Xe){const _t=i.get(se);void 0!==Z&&bt(_t.__webglFramebuffer,se,se.texture,36064,3553),void 0!==Xe&&ht(se)},this.setupRenderTarget=function pn(se){const Z=se.texture,Xe=i.get(se),_t=i.get(Z);se.addEventListener("dispose",oe),!0!==se.isWebGLMultipleRenderTargets&&(void 0===_t.__webglTexture&&(_t.__webglTexture=n.createTexture()),_t.__version=Z.version,l.memory.textures++);const Xt=!0===se.isWebGLCubeRenderTarget,sn=!0===se.isWebGLMultipleRenderTargets,Wn=k(se)||c;if(Xt){Xe.__webglFramebuffer=[];for(let Ke=0;Ke<6;Ke++)Xe.__webglFramebuffer[Ke]=n.createFramebuffer()}else if(Xe.__webglFramebuffer=n.createFramebuffer(),sn)if(r.drawBuffers){const Ke=se.texture;for(let xi=0,Ai=Ke.length;xi<Ai;xi++){const mn=i.get(Ke[xi]);void 0===mn.__webglTexture&&(mn.__webglTexture=n.createTexture(),l.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(c&&se.samples>0&&!1===On(se)){Xe.__webglMultisampledFramebuffer=n.createFramebuffer(),Xe.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,Xe.__webglColorRenderbuffer);const Ke=o.convert(Z.format,Z.encoding),xi=o.convert(Z.type),Ai=ce(Z.internalFormat,Ke,xi,Z.encoding),mn=jn(se);n.renderbufferStorageMultisample(36161,mn,Ai,se.width,se.height),t.bindFramebuffer(36160,Xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,Xe.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),se.depthBuffer&&(Xe.__webglDepthRenderbuffer=n.createRenderbuffer(),di(Xe.__webglDepthRenderbuffer,se,!0)),t.bindFramebuffer(36160,null)}if(Xt){t.bindTexture(34067,_t.__webglTexture),tt(34067,Z,Wn);for(let Ke=0;Ke<6;Ke++)bt(Xe.__webglFramebuffer[Ke],se,Z,36064,34069+Ke);Q(Z,Wn)&&ie(34067),t.unbindTexture()}else if(sn){const Ke=se.texture;for(let xi=0,Ai=Ke.length;xi<Ai;xi++){const mn=Ke[xi],ge=i.get(mn);t.bindTexture(3553,ge.__webglTexture),tt(3553,mn,Wn),bt(Xe.__webglFramebuffer,se,mn,36064+xi,3553),Q(mn,Wn)&&ie(3553)}t.unbindTexture()}else{let Ke=3553;(se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(c?Ke=se.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ke,_t.__webglTexture),tt(Ke,Z,Wn),bt(Xe.__webglFramebuffer,se,Z,36064,Ke),Q(Z,Wn)&&ie(Ke),t.unbindTexture()}se.depthBuffer&&ht(se)},this.updateRenderTargetMipmap=function Kt(se){const Z=k(se)||c,Xe=!0===se.isWebGLMultipleRenderTargets?se.texture:[se.texture];for(let _t=0,Xt=Xe.length;_t<Xt;_t++){const sn=Xe[_t];if(Q(sn,Z)){const Wn=se.isWebGLCubeRenderTarget?34067:3553,Ke=i.get(sn).__webglTexture;t.bindTexture(Wn,Ke),ie(Wn),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function fi(se){if(c&&se.samples>0&&!1===On(se)){const Z=se.width,Xe=se.height;let _t=16384;const Xt=[36064],sn=se.stencilBuffer?33306:36096;se.depthBuffer&&Xt.push(sn);const Wn=i.get(se),Ke=void 0!==Wn.__ignoreDepthValues&&Wn.__ignoreDepthValues;!1===Ke&&(se.depthBuffer&&(_t|=256),se.stencilBuffer&&(_t|=1024)),t.bindFramebuffer(36008,Wn.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Wn.__webglFramebuffer),!0===Ke&&(n.invalidateFramebuffer(36008,[sn]),n.invalidateFramebuffer(36009,[sn])),n.blitFramebuffer(0,0,Z,Xe,0,0,Z,Xe,_t,9728),b&&n.invalidateFramebuffer(36008,Xt),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Wn.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ht,this.setupFrameBufferTexture=bt,this.useMultisampledRTT=On}function U9(n,e,t){const i=t.isWebGL2;return{convert:function r(o,l=null){let c;if(o===Cm)return 5121;if(1017===o)return 32819;if(1018===o)return 32820;if(1010===o)return 5120;if(1011===o)return 5122;if(o===Tx)return 5123;if(1013===o)return 5124;if(1014===o)return 5125;if(o===yf)return 5126;if(o===jy)return i?5131:(c=e.get("OES_texture_half_float"),null!==c?c.HALF_FLOAT_OES:null);if(1021===o)return 6406;if(o===Gl)return 6408;if(1024===o)return 6409;if(1025===o)return 6410;if(o===Tm)return 6402;if(o===$y)return 34041;if(1028===o)return 6403;if(1022===o)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===o)return c=e.get("EXT_sRGB"),null!==c?c.SRGB_ALPHA_EXT:null;if(1029===o)return 36244;if(1030===o)return 33319;if(1031===o)return 33320;if(1033===o)return 36249;if(33776===o||33777===o||33778===o||33779===o)if(l===$r){if(c=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===c)return null;if(33776===o)return c.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===o)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===o)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===o)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(c=e.get("WEBGL_compressed_texture_s3tc"),null===c)return null;if(33776===o)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===o)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===o)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===o)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===o||35841===o||35842===o||35843===o){if(c=e.get("WEBGL_compressed_texture_pvrtc"),null===c)return null;if(35840===o)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===o)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===o)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===o)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===o)return c=e.get("WEBGL_compressed_texture_etc1"),null!==c?c.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===o||37496===o){if(c=e.get("WEBGL_compressed_texture_etc"),null===c)return null;if(37492===o)return l===$r?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(37496===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}if(37808===o||37809===o||37810===o||37811===o||37812===o||37813===o||37814===o||37815===o||37816===o||37817===o||37818===o||37819===o||37820===o||37821===o){if(c=e.get("WEBGL_compressed_texture_astc"),null===c)return null;if(37808===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:c.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:c.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:c.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:c.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:c.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:c.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:c.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:c.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:c.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:c.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:c.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:c.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:c.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===o)return l===$r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:c.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===o){if(c=e.get("EXT_texture_compression_bptc"),null===c)return null;if(36492===o)return l===$r?c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:c.COMPRESSED_RGBA_BPTC_UNORM_EXT}return o===Xy?i?34042:(c=e.get("WEBGL_depth_texture"),null!==c?c.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}xP.prototype.isMeshDistanceMaterial=!0;class k3 extends Eo{constructor(e=[]){super(),this.cameras=e}}k3.prototype.isArrayCamera=!0;class Um extends Yi{constructor(){super(),this.type="Group"}}Um.prototype.isGroup=!0;const V9={type:"move"};class bP{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Um,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Um,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new $,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new $),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Um,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new $,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new $),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,o=null,l=null;const c=this._targetRay,d=this._grip,p=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==c&&(r=t.getPose(e.targetRaySpace,i),null!==r&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(V9))),p&&e.hand){l=!0;for(const E of e.hand.values()){const T=t.getJointPose(E,i);if(void 0===p.joints[E.jointName]){const F=new Um;F.matrixAutoUpdate=!1,F.visible=!1,p.joints[E.jointName]=F,p.add(F)}const N=p.joints[E.jointName];null!==T&&(N.matrix.fromArray(T.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),N.jointRadius=T.radius),N.visible=null!==T}const x=p.joints["index-finger-tip"].position.distanceTo(p.joints["thumb-tip"].position),b=.02,S=.005;p.inputState.pinching&&x>b+S?(p.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!p.inputState.pinching&&x<=b-S&&(p.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==d&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),null!==o&&(d.matrix.fromArray(o.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),o.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(o.linearVelocity)):d.hasLinearVelocity=!1,o.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(o.angularVelocity)):d.hasAngularVelocity=!1));return null!==c&&(c.visible=null!==r),null!==d&&(d.visible=null!==o),null!==p&&(p.visible=null!==l),this}}class B3 extends Ha{constructor(e,t,i,r,o,l,c,d,p,y){if((y=void 0!==y?y:Tm)!==Tm&&y!==$y)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&y===Tm&&(i=Tx),void 0===i&&y===$y&&(i=Xy),super(null,r,o,l,c,d,y,i,p),this.image={width:e,height:t},this.magFilter=void 0!==c?c:ao,this.minFilter=void 0!==d?d:ao,this.flipY=!1,this.generateMipmaps=!1}}B3.prototype.isDepthTexture=!0;class z9 extends _f{constructor(e,t){super();const i=this;let r=null,o=1,l=null,c="local-floor",d=null,p=null,y=null,v=null,x=null;const b=t.getContextAttributes();let S=null,E=null;const T=[],N=new Map,F=new Eo;F.layers.enable(1),F.viewport=new Qi;const U=new Eo;U.layers.enable(2),U.viewport=new Qi;const k=[F,U],H=new k3;H.layers.enable(1),H.layers.enable(2);let Q=null,ie=null;function ce(ue){const Re=N.get(ue.inputSource);Re&&Re.dispatchEvent({type:ue.type,data:ue.inputSource})}function De(){N.forEach(function(ue,Re){ue.disconnect(Re)}),N.clear(),Q=null,ie=null,e.setRenderTarget(S),v=null,y=null,p=null,r=null,E=null,xe.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function ve(ue){const Re=r.inputSources;for(let Ye=0;Ye<T.length;Ye++)N.set(Re[Ye],T[Ye]);for(let Ye=0;Ye<ue.removed.length;Ye++){const gt=ue.removed[Ye],st=N.get(gt);st&&(st.dispatchEvent({type:"disconnected",data:gt}),N.delete(gt))}for(let Ye=0;Ye<ue.added.length;Ye++){const gt=ue.added[Ye],st=N.get(gt);st&&st.dispatchEvent({type:"connected",data:gt})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ue){let Re=T[ue];return void 0===Re&&(Re=new bP,T[ue]=Re),Re.getTargetRaySpace()},this.getControllerGrip=function(ue){let Re=T[ue];return void 0===Re&&(Re=new bP,T[ue]=Re),Re.getGripSpace()},this.getHand=function(ue){let Re=T[ue];return void 0===Re&&(Re=new bP,T[ue]=Re),Re.getHandSpace()},this.setFramebufferScaleFactor=function(ue){o=ue,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ue){c=ue,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getBaseLayer=function(){return null!==y?y:v},this.getBinding=function(){return p},this.getFrame=function(){return x},this.getSession=function(){return r},this.setSession=function(){var ue=function w8(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var o=n.apply(e,t);function l(d){aO(o,i,r,l,c,"next",d)}function c(d){aO(o,i,r,l,c,"throw",d)}l(void 0)})}}(function*(Re){if(r=Re,null!==r){if(S=e.getRenderTarget(),r.addEventListener("select",ce),r.addEventListener("selectstart",ce),r.addEventListener("selectend",ce),r.addEventListener("squeeze",ce),r.addEventListener("squeezestart",ce),r.addEventListener("squeezeend",ce),r.addEventListener("end",De),r.addEventListener("inputsourceschange",ve),!0!==b.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)v=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||b.antialias,alpha:b.alpha,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:o}),r.updateRenderState({baseLayer:v}),E=new al(v.framebufferWidth,v.framebufferHeight,{format:Gl,type:Cm,encoding:e.outputEncoding});else{let Ye=null,gt=null,st=null;b.depth&&(st=b.stencil?35056:33190,Ye=b.stencil?$y:Tm,gt=b.stencil?Xy:Tx);const ln={colorFormat:e.outputEncoding===$r?35907:32856,depthFormat:st,scaleFactor:o};p=new XRWebGLBinding(r,t),y=p.createProjectionLayer(ln),r.updateRenderState({layers:[y]}),E=new al(y.textureWidth,y.textureHeight,{format:Gl,type:Cm,depthTexture:new B3(y.textureWidth,y.textureHeight,gt,void 0,void 0,void 0,void 0,void 0,void 0,Ye),stencilBuffer:b.stencil,encoding:e.outputEncoding,samples:b.antialias?4:0}),e.properties.get(E).__ignoreDepthValues=y.ignoreDepthValues}E.isXRRenderTarget=!0,this.setFoveation(1),l=yield r.requestReferenceSpace(c),xe.setContext(r),xe.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(Re){return ue.apply(this,arguments)}}();const q=new $,oe=new $;function be(ue,Re){null===Re?ue.matrixWorld.copy(ue.matrix):ue.matrixWorld.multiplyMatrices(Re.matrixWorld,ue.matrix),ue.matrixWorldInverse.copy(ue.matrixWorld).invert()}this.updateCamera=function(ue){if(null===r)return;H.near=U.near=F.near=ue.near,H.far=U.far=F.far=ue.far,(Q!==H.near||ie!==H.far)&&(r.updateRenderState({depthNear:H.near,depthFar:H.far}),Q=H.near,ie=H.far);const Re=ue.parent,Ye=H.cameras;be(H,Re);for(let st=0;st<Ye.length;st++)be(Ye[st],Re);H.matrixWorld.decompose(H.position,H.quaternion,H.scale),ue.position.copy(H.position),ue.quaternion.copy(H.quaternion),ue.scale.copy(H.scale),ue.matrix.copy(H.matrix),ue.matrixWorld.copy(H.matrixWorld);const gt=ue.children;for(let st=0,ln=gt.length;st<ln;st++)gt[st].updateMatrixWorld(!0);2===Ye.length?function qe(ue,Re,Ye){q.setFromMatrixPosition(Re.matrixWorld),oe.setFromMatrixPosition(Ye.matrixWorld);const gt=q.distanceTo(oe),st=Re.projectionMatrix.elements,ln=Ye.projectionMatrix.elements,hn=st[14]/(st[10]-1),qn=st[14]/(st[10]+1),tt=(st[9]+1)/st[5],Yn=(st[9]-1)/st[5],Gn=(st[8]-1)/st[0],Vn=(ln[8]+1)/ln[0],bt=hn*Gn,di=hn*Vn,et=gt/(-Gn+Vn),ht=et*-Gn;Re.matrixWorld.decompose(ue.position,ue.quaternion,ue.scale),ue.translateX(ht),ue.translateZ(et),ue.matrixWorld.compose(ue.position,ue.quaternion,ue.scale),ue.matrixWorldInverse.copy(ue.matrixWorld).invert();const Mt=hn+et,pn=qn+et;ue.projectionMatrix.makePerspective(bt-ht,di+(gt-ht),tt*qn/pn*Mt,Yn*qn/pn*Mt,Mt,pn)}(H,F,U):H.projectionMatrix.copy(F.projectionMatrix)},this.getCamera=function(){return H},this.getFoveation=function(){return null!==y?y.fixedFoveation:null!==v?v.fixedFoveation:void 0},this.setFoveation=function(ue){null!==y&&(y.fixedFoveation=ue),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=ue)};let Le=null;const xe=new o3;xe.setAnimationLoop(function de(ue,Re){if(d=Re.getViewerPose(l),x=Re,null!==d){const gt=d.views;null!==v&&(e.setRenderTargetFramebuffer(E,v.framebuffer),e.setRenderTarget(E));let st=!1;gt.length!==H.cameras.length&&(H.cameras.length=0,st=!0);for(let ln=0;ln<gt.length;ln++){const hn=gt[ln];let qn=null;if(null!==v)qn=v.getViewport(hn);else{const Yn=p.getViewSubImage(y,hn);qn=Yn.viewport,0===ln&&(e.setRenderTargetTextures(E,Yn.colorTexture,y.ignoreDepthValues?void 0:Yn.depthStencilTexture),e.setRenderTarget(E))}const tt=k[ln];tt.matrix.fromArray(hn.transform.matrix),tt.projectionMatrix.fromArray(hn.projectionMatrix),tt.viewport.set(qn.x,qn.y,qn.width,qn.height),0===ln&&H.matrix.copy(tt.matrix),!0===st&&H.cameras.push(tt)}}const Ye=r.inputSources;for(let gt=0;gt<T.length;gt++)T[gt].update(Ye[gt],Re,l);Le&&Le(ue,Re),x=null}),this.setAnimationLoop=function(ue){Le=ue},this.dispose=function(){}}}function H9(n,e){function r(E,T){E.opacity.value=T.opacity,T.color&&E.diffuse.value.copy(T.color),T.emissive&&E.emissive.value.copy(T.emissive).multiplyScalar(T.emissiveIntensity),T.map&&(E.map.value=T.map),T.alphaMap&&(E.alphaMap.value=T.alphaMap),T.bumpMap&&(E.bumpMap.value=T.bumpMap,E.bumpScale.value=T.bumpScale,1===T.side&&(E.bumpScale.value*=-1)),T.displacementMap&&(E.displacementMap.value=T.displacementMap,E.displacementScale.value=T.displacementScale,E.displacementBias.value=T.displacementBias),T.emissiveMap&&(E.emissiveMap.value=T.emissiveMap),T.normalMap&&(E.normalMap.value=T.normalMap,E.normalScale.value.copy(T.normalScale),1===T.side&&E.normalScale.value.negate()),T.specularMap&&(E.specularMap.value=T.specularMap),T.alphaTest>0&&(E.alphaTest.value=T.alphaTest);const N=e.get(T).envMap;if(N&&(E.envMap.value=N,E.flipEnvMap.value=N.isCubeTexture&&!1===N.isRenderTargetTexture?-1:1,E.reflectivity.value=T.reflectivity,E.ior.value=T.ior,E.refractionRatio.value=T.refractionRatio),T.lightMap){E.lightMap.value=T.lightMap;const k=!0!==n.physicallyCorrectLights?Math.PI:1;E.lightMapIntensity.value=T.lightMapIntensity*k}let F,U;T.aoMap&&(E.aoMap.value=T.aoMap,E.aoMapIntensity.value=T.aoMapIntensity),T.map?F=T.map:T.specularMap?F=T.specularMap:T.displacementMap?F=T.displacementMap:T.normalMap?F=T.normalMap:T.bumpMap?F=T.bumpMap:T.roughnessMap?F=T.roughnessMap:T.metalnessMap?F=T.metalnessMap:T.alphaMap?F=T.alphaMap:T.emissiveMap?F=T.emissiveMap:T.clearcoatMap?F=T.clearcoatMap:T.clearcoatNormalMap?F=T.clearcoatNormalMap:T.clearcoatRoughnessMap?F=T.clearcoatRoughnessMap:T.specularIntensityMap?F=T.specularIntensityMap:T.specularColorMap?F=T.specularColorMap:T.transmissionMap?F=T.transmissionMap:T.thicknessMap?F=T.thicknessMap:T.sheenColorMap?F=T.sheenColorMap:T.sheenRoughnessMap&&(F=T.sheenRoughnessMap),void 0!==F&&(F.isWebGLRenderTarget&&(F=F.texture),!0===F.matrixAutoUpdate&&F.updateMatrix(),E.uvTransform.value.copy(F.matrix)),T.aoMap?U=T.aoMap:T.lightMap&&(U=T.lightMap),void 0!==U&&(U.isWebGLRenderTarget&&(U=U.texture),!0===U.matrixAutoUpdate&&U.updateMatrix(),E.uv2Transform.value.copy(U.matrix))}return{refreshFogUniforms:function t(E,T){E.fogColor.value.copy(T.color),T.isFog?(E.fogNear.value=T.near,E.fogFar.value=T.far):T.isFogExp2&&(E.fogDensity.value=T.density)},refreshMaterialUniforms:function i(E,T,N,F,U){T.isMeshBasicMaterial||T.isMeshLambertMaterial?r(E,T):T.isMeshToonMaterial?(r(E,T),function y(E,T){T.gradientMap&&(E.gradientMap.value=T.gradientMap)}(E,T)):T.isMeshPhongMaterial?(r(E,T),function p(E,T){E.specular.value.copy(T.specular),E.shininess.value=Math.max(T.shininess,1e-4)}(E,T)):T.isMeshStandardMaterial?(r(E,T),function v(E,T){E.roughness.value=T.roughness,E.metalness.value=T.metalness,T.roughnessMap&&(E.roughnessMap.value=T.roughnessMap),T.metalnessMap&&(E.metalnessMap.value=T.metalnessMap),e.get(T).envMap&&(E.envMapIntensity.value=T.envMapIntensity)}(E,T),T.isMeshPhysicalMaterial&&function x(E,T,N){E.ior.value=T.ior,T.sheen>0&&(E.sheenColor.value.copy(T.sheenColor).multiplyScalar(T.sheen),E.sheenRoughness.value=T.sheenRoughness,T.sheenColorMap&&(E.sheenColorMap.value=T.sheenColorMap),T.sheenRoughnessMap&&(E.sheenRoughnessMap.value=T.sheenRoughnessMap)),T.clearcoat>0&&(E.clearcoat.value=T.clearcoat,E.clearcoatRoughness.value=T.clearcoatRoughness,T.clearcoatMap&&(E.clearcoatMap.value=T.clearcoatMap),T.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=T.clearcoatRoughnessMap),T.clearcoatNormalMap&&(E.clearcoatNormalScale.value.copy(T.clearcoatNormalScale),E.clearcoatNormalMap.value=T.clearcoatNormalMap,1===T.side&&E.clearcoatNormalScale.value.negate())),T.transmission>0&&(E.transmission.value=T.transmission,E.transmissionSamplerMap.value=N.texture,E.transmissionSamplerSize.value.set(N.width,N.height),T.transmissionMap&&(E.transmissionMap.value=T.transmissionMap),E.thickness.value=T.thickness,T.thicknessMap&&(E.thicknessMap.value=T.thicknessMap),E.attenuationDistance.value=T.attenuationDistance,E.attenuationColor.value.copy(T.attenuationColor)),E.specularIntensity.value=T.specularIntensity,E.specularColor.value.copy(T.specularColor),T.specularIntensityMap&&(E.specularIntensityMap.value=T.specularIntensityMap),T.specularColorMap&&(E.specularColorMap.value=T.specularColorMap)}(E,T,U)):T.isMeshMatcapMaterial?(r(E,T),function b(E,T){T.matcap&&(E.matcap.value=T.matcap)}(E,T)):T.isMeshDepthMaterial?r(E,T):T.isMeshDistanceMaterial?(r(E,T),function S(E,T){E.referencePosition.value.copy(T.referencePosition),E.nearDistance.value=T.nearDistance,E.farDistance.value=T.farDistance}(E,T)):T.isMeshNormalMaterial?r(E,T):T.isLineBasicMaterial?(function o(E,T){E.diffuse.value.copy(T.color),E.opacity.value=T.opacity}(E,T),T.isLineDashedMaterial&&function l(E,T){E.dashSize.value=T.dashSize,E.totalSize.value=T.dashSize+T.gapSize,E.scale.value=T.scale}(E,T)):T.isPointsMaterial?function c(E,T,N,F){let U;E.diffuse.value.copy(T.color),E.opacity.value=T.opacity,E.size.value=T.size*N,E.scale.value=.5*F,T.map&&(E.map.value=T.map),T.alphaMap&&(E.alphaMap.value=T.alphaMap),T.alphaTest>0&&(E.alphaTest.value=T.alphaTest),T.map?U=T.map:T.alphaMap&&(U=T.alphaMap),void 0!==U&&(!0===U.matrixAutoUpdate&&U.updateMatrix(),E.uvTransform.value.copy(U.matrix))}(E,T,N,F):T.isSpriteMaterial?function d(E,T){let N;E.diffuse.value.copy(T.color),E.opacity.value=T.opacity,E.rotation.value=T.rotation,T.map&&(E.map.value=T.map),T.alphaMap&&(E.alphaMap.value=T.alphaMap),T.alphaTest>0&&(E.alphaTest.value=T.alphaTest),T.map?N=T.map:T.alphaMap&&(N=T.alphaMap),void 0!==N&&(!0===N.matrixAutoUpdate&&N.updateMatrix(),E.uvTransform.value.copy(N.matrix))}(E,T):T.isShadowMaterial?(E.color.value.copy(T.color),E.opacity.value=T.opacity):T.isShaderMaterial&&(T.uniformsNeedUpdate=!1)}}}function _r(n={}){const e=void 0!==n.canvas?n.canvas:function G9(){const n=Ix("canvas");return n.style.display="block",n}(),t=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,r=void 0===n.stencil||n.stencil,o=void 0!==n.antialias&&n.antialias,l=void 0===n.premultipliedAlpha||n.premultipliedAlpha,c=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,d=void 0!==n.powerPreference?n.powerPreference:"default",p=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let y;y=void 0!==n.context?t.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let v=null,x=null;const b=[],S=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=kh,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const E=this;let T=!1,N=0,F=0,U=null,k=-1,H=null;const Q=new Qi,ie=new Qi;let ce=null,De=e.width,ve=e.height,q=1,oe=null,qe=null;const be=new Qi(0,0,De,ve),Le=new Qi(0,0,De,ve);let de=!1;const xe=new IE;let ue=!1,Re=!1,Ye=null;const gt=new Tt,st=new ct,ln=new $,hn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function qn(){return null===U?q:1}let Gn,Vn,bt,di,et,ht,Mt,pn,Kt,fi,jn,On,is,Tr,se,Z,Xe,_t,Xt,sn,Wn,Ke,xi,tt=t;function Yn(te,Ae){for(let ze=0;ze<te.length;ze++){const ut=e.getContext(te[ze],Ae);if(null!==ut)return ut}return null}try{const te={alpha:!0,depth:i,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:d,failIfMajorPerformanceCaveat:p};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r139"),e.addEventListener("webglcontextlost",ge,!1),e.addEventListener("webglcontextrestored",Gt,!1),null===tt){const Ae=["webgl2","webgl","experimental-webgl"];if(!0===E.isWebGL1Renderer&&Ae.shift(),tt=Yn(Ae,te),null===tt)throw Yn(Ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===tt.getShaderPrecisionFormat&&(tt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(te){throw console.error("THREE.WebGLRenderer: "+te.message),te}function Ai(){Gn=new a7(tt),Vn=new t7(tt,Gn,n),Gn.init(Vn),Ke=new U9(tt,Gn,Vn),bt=new k9(tt,Gn,Vn),di=new u7(tt),et=new C9,ht=new B9(tt,Gn,bt,et,Vn,Ke,di),Mt=new i7(E),pn=new o7(E),Kt=new nq(tt,Vn),xi=new Qj(tt,Gn,Kt,Vn),fi=new l7(tt,Kt,di,xi),jn=new p7(tt,fi,Kt,di),Xt=new f7(tt,Vn,ht),Z=new n7(et),On=new E9(E,Mt,pn,Gn,Vn,xi,Z),is=new H9(E,et),Tr=new A9,se=new F9(Gn,Vn),_t=new Jj(E,Mt,bt,jn,y,l),Xe=new O3(E,jn,Vn),sn=new e7(tt,Gn,di,Vn),Wn=new c7(tt,Gn,di,Vn),di.programs=On.programs,E.capabilities=Vn,E.extensions=Gn,E.properties=et,E.renderLists=Tr,E.shadowMap=Xe,E.state=bt,E.info=di}Ai();const mn=new z9(E,tt);function ge(te){te.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),T=!0}function Gt(){console.log("THREE.WebGLRenderer: Context Restored."),T=!1;const te=di.autoReset,Ae=Xe.enabled,ze=Xe.autoUpdate,Fe=Xe.needsUpdate,ut=Xe.type;Ai(),di.autoReset=te,Xe.enabled=Ae,Xe.autoUpdate=ze,Xe.needsUpdate=Fe,Xe.type=ut}function kt(te){const Ae=te.target;Ae.removeEventListener("dispose",kt),function Qn(te){(function dn(te){const Ae=et.get(te).programs;void 0!==Ae&&(Ae.forEach(function(ze){On.releaseProgram(ze)}),te.isShaderMaterial&&On.releaseShaderCache(te))})(te),et.remove(te)}(Ae)}this.xr=mn,this.getContext=function(){return tt},this.getContextAttributes=function(){return tt.getContextAttributes()},this.forceContextLoss=function(){const te=Gn.get("WEBGL_lose_context");te&&te.loseContext()},this.forceContextRestore=function(){const te=Gn.get("WEBGL_lose_context");te&&te.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(te){void 0!==te&&(q=te,this.setSize(De,ve,!1))},this.getSize=function(te){return te.set(De,ve)},this.setSize=function(te,Ae,ze){mn.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(De=te,ve=Ae,e.width=Math.floor(te*q),e.height=Math.floor(Ae*q),!1!==ze&&(e.style.width=te+"px",e.style.height=Ae+"px"),this.setViewport(0,0,te,Ae))},this.getDrawingBufferSize=function(te){return te.set(De*q,ve*q).floor()},this.setDrawingBufferSize=function(te,Ae,ze){De=te,ve=Ae,q=ze,e.width=Math.floor(te*ze),e.height=Math.floor(Ae*ze),this.setViewport(0,0,te,Ae)},this.getCurrentViewport=function(te){return te.copy(Q)},this.getViewport=function(te){return te.copy(be)},this.setViewport=function(te,Ae,ze,Fe){te.isVector4?be.set(te.x,te.y,te.z,te.w):be.set(te,Ae,ze,Fe),bt.viewport(Q.copy(be).multiplyScalar(q).floor())},this.getScissor=function(te){return te.copy(Le)},this.setScissor=function(te,Ae,ze,Fe){te.isVector4?Le.set(te.x,te.y,te.z,te.w):Le.set(te,Ae,ze,Fe),bt.scissor(ie.copy(Le).multiplyScalar(q).floor())},this.getScissorTest=function(){return de},this.setScissorTest=function(te){bt.setScissorTest(de=te)},this.setOpaqueSort=function(te){oe=te},this.setTransparentSort=function(te){qe=te},this.getClearColor=function(te){return te.copy(_t.getClearColor())},this.setClearColor=function(){_t.setClearColor.apply(_t,arguments)},this.getClearAlpha=function(){return _t.getClearAlpha()},this.setClearAlpha=function(){_t.setClearAlpha.apply(_t,arguments)},this.clear=function(te=!0,Ae=!0,ze=!0){let Fe=0;te&&(Fe|=16384),Ae&&(Fe|=256),ze&&(Fe|=1024),tt.clear(Fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ge,!1),e.removeEventListener("webglcontextrestored",Gt,!1),Tr.dispose(),se.dispose(),et.dispose(),Mt.dispose(),pn.dispose(),jn.dispose(),xi.dispose(),On.dispose(),mn.dispose(),mn.removeEventListener("sessionstart",ui),mn.removeEventListener("sessionend",Vr),Ye&&(Ye.dispose(),Ye=null),Ki.stop()},this.renderBufferDirect=function(te,Ae,ze,Fe,ut,ti){null===Ae&&(Ae=hn);const pi=ut.isMesh&&ut.matrixWorld.determinant()<0,Di=function wne(te,Ae,ze,Fe,ut){!0!==Ae.isScene&&(Ae=hn),ht.resetTextureUnits();const ti=Ae.fog,Di=null===U?E.outputEncoding:!0===U.isXRRenderTarget?U.texture.encoding:kh,Mi=(Fe.isMeshStandardMaterial?pn:Mt).get(Fe.envMap||(Fe.isMeshStandardMaterial?Ae.environment:null)),xr=!0===Fe.vertexColors&&!!ze.attributes.color&&4===ze.attributes.color.itemSize,er=!!Fe.normalMap&&!!ze.attributes.tangent,or=!!ze.morphAttributes.position,ys=!!ze.morphAttributes.normal,ag=!!ze.morphAttributes.color,H_=Fe.toneMapped?E.toneMapping:0,G_=ze.morphAttributes.position||ze.morphAttributes.normal||ze.morphAttributes.color,Tu=void 0!==G_?G_.length:0,dr=et.get(Fe),W_=x.state.lights;!0!==ue||!0!==Re&&te===H||Z.setState(Fe,te,te===H&&Fe.id===k);let Js=!1;Fe.version===dr.__version?(dr.needsLights&&dr.lightsStateVersion!==W_.state.version||dr.outputEncoding!==Di||ut.isInstancedMesh&&!1===dr.instancing||!ut.isInstancedMesh&&!0===dr.instancing||ut.isSkinnedMesh&&!1===dr.skinning||!ut.isSkinnedMesh&&!0===dr.skinning||dr.envMap!==Mi||Fe.fog&&dr.fog!==ti||void 0!==dr.numClippingPlanes&&(dr.numClippingPlanes!==Z.numPlanes||dr.numIntersection!==Z.numIntersection)||dr.vertexAlphas!==xr||dr.vertexTangents!==er||dr.morphTargets!==or||dr.morphNormals!==ys||dr.morphColors!==ag||dr.toneMapping!==H_||!0===Vn.isWebGL2&&dr.morphTargetsCount!==Tu)&&(Js=!0):(Js=!0,dr.__version=Fe.version);let Au=dr.currentProgram;!0===Js&&(Au=kL(Fe,Ae,ut));let Wf=!1,Ab=!1,BL=!1;const ta=Au.getUniforms(),Db=dr.uniforms;if(bt.useProgram(Au.program)&&(Wf=!0,Ab=!0,BL=!0),Fe.id!==k&&(k=Fe.id,Ab=!0),Wf||H!==te){if(ta.setValue(tt,"projectionMatrix",te.projectionMatrix),Vn.logarithmicDepthBuffer&&ta.setValue(tt,"logDepthBufFC",2/(Math.log(te.far+1)/Math.LN2)),H!==te&&(H=te,Ab=!0,BL=!0),Fe.isShaderMaterial||Fe.isMeshPhongMaterial||Fe.isMeshToonMaterial||Fe.isMeshStandardMaterial||Fe.envMap){const Ic=ta.map.cameraPosition;void 0!==Ic&&Ic.setValue(tt,ln.setFromMatrixPosition(te.matrixWorld))}(Fe.isMeshPhongMaterial||Fe.isMeshToonMaterial||Fe.isMeshLambertMaterial||Fe.isMeshBasicMaterial||Fe.isMeshStandardMaterial||Fe.isShaderMaterial)&&ta.setValue(tt,"isOrthographic",!0===te.isOrthographicCamera),(Fe.isMeshPhongMaterial||Fe.isMeshToonMaterial||Fe.isMeshLambertMaterial||Fe.isMeshBasicMaterial||Fe.isMeshStandardMaterial||Fe.isShaderMaterial||Fe.isShadowMaterial||ut.isSkinnedMesh)&&ta.setValue(tt,"viewMatrix",te.matrixWorldInverse)}if(ut.isSkinnedMesh){ta.setOptional(tt,ut,"bindMatrix"),ta.setOptional(tt,ut,"bindMatrixInverse");const Ic=ut.skeleton;Ic&&(Vn.floatVertexTextures?(null===Ic.boneTexture&&Ic.computeBoneTexture(),ta.setValue(tt,"boneTexture",Ic.boneTexture,ht),ta.setValue(tt,"boneTextureSize",Ic.boneTextureSize)):ta.setOptional(tt,Ic,"boneMatrices"))}const UL=ze.morphAttributes;return(void 0!==UL.position||void 0!==UL.normal||void 0!==UL.color&&!0===Vn.isWebGL2)&&Xt.update(ut,ze,Fe,Au),(Ab||dr.receiveShadow!==ut.receiveShadow)&&(dr.receiveShadow=ut.receiveShadow,ta.setValue(tt,"receiveShadow",ut.receiveShadow)),Ab&&(ta.setValue(tt,"toneMappingExposure",E.toneMappingExposure),dr.needsLights&&function Mne(te,Ae){te.ambientLightColor.needsUpdate=Ae,te.lightProbe.needsUpdate=Ae,te.directionalLights.needsUpdate=Ae,te.directionalLightShadows.needsUpdate=Ae,te.pointLights.needsUpdate=Ae,te.pointLightShadows.needsUpdate=Ae,te.spotLights.needsUpdate=Ae,te.spotLightShadows.needsUpdate=Ae,te.rectAreaLights.needsUpdate=Ae,te.hemisphereLights.needsUpdate=Ae}(Db,BL),ti&&Fe.fog&&is.refreshFogUniforms(Db,ti),is.refreshMaterialUniforms(Db,Fe,q,ve,Ye),Tf.upload(tt,dr.uniformsList,Db,ht)),Fe.isShaderMaterial&&!0===Fe.uniformsNeedUpdate&&(Tf.upload(tt,dr.uniformsList,Db,ht),Fe.uniformsNeedUpdate=!1),Fe.isSpriteMaterial&&ta.setValue(tt,"center",ut.center),ta.setValue(tt,"modelViewMatrix",ut.modelViewMatrix),ta.setValue(tt,"normalMatrix",ut.normalMatrix),ta.setValue(tt,"modelMatrix",ut.matrixWorld),Au}(te,Ae,ze,Fe,ut);bt.setMaterial(Fe,pi);let Mi=ze.index;const xr=ze.attributes.position;if(null===Mi){if(void 0===xr||0===xr.count)return}else if(0===Mi.count)return;let er=1;!0===Fe.wireframe&&(Mi=fi.getWireframeAttribute(ze),er=2),xi.setup(ut,Fe,Di,ze,Mi);let or,ys=sn;null!==Mi&&(or=Kt.get(Mi),ys=Wn,ys.setIndex(or));const ag=null!==Mi?Mi.count:xr.count,H_=ze.drawRange.start*er,G_=ze.drawRange.count*er,Tu=null!==ti?ti.start*er:0,dr=null!==ti?ti.count*er:1/0,W_=Math.max(H_,Tu),Js=Math.min(ag,H_+G_,Tu+dr)-1,Au=Math.max(0,Js-W_+1);if(0!==Au){if(ut.isMesh)!0===Fe.wireframe?(bt.setLineWidth(Fe.wireframeLinewidth*qn()),ys.setMode(1)):ys.setMode(4);else if(ut.isLine){let Wf=Fe.linewidth;void 0===Wf&&(Wf=1),bt.setLineWidth(Wf*qn()),ys.setMode(ut.isLineSegments?1:ut.isLineLoop?2:3)}else ut.isPoints?ys.setMode(0):ut.isSprite&&ys.setMode(4);if(ut.isInstancedMesh)ys.renderInstances(W_,Au,ut.count);else if(ze.isInstancedBufferGeometry){const Wf=Math.min(ze.instanceCount,ze._maxInstanceCount);ys.renderInstances(W_,Au,Wf)}else ys.render(W_,Au)}},this.compile=function(te,Ae){x=se.get(te),x.init(),S.push(x),te.traverseVisible(function(ze){ze.isLight&&ze.layers.test(Ae.layers)&&(x.pushLight(ze),ze.castShadow&&x.pushShadow(ze))}),x.setupLights(E.physicallyCorrectLights),te.traverse(function(ze){const Fe=ze.material;if(Fe)if(Array.isArray(Fe))for(let ut=0;ut<Fe.length;ut++)kL(Fe[ut],te,ze);else kL(Fe,te,ze)}),S.pop(),x=null};let ei=null;function ui(){Ki.stop()}function Vr(){Ki.start()}const Ki=new o3;function Eu(te,Ae,ze,Fe){if(!1===te.visible)return;if(te.layers.test(Ae.layers))if(te.isGroup)ze=te.renderOrder;else if(te.isLOD)!0===te.autoUpdate&&te.update(Ae);else if(te.isLight)x.pushLight(te),te.castShadow&&x.pushShadow(te);else if(te.isSprite){if(!te.frustumCulled||xe.intersectsSprite(te)){Fe&&ln.setFromMatrixPosition(te.matrixWorld).applyMatrix4(gt);const pi=jn.update(te),Di=te.material;Di.visible&&v.push(te,pi,Di,ze,ln.z,null)}}else if((te.isMesh||te.isLine||te.isPoints)&&(te.isSkinnedMesh&&te.skeleton.frame!==di.render.frame&&(te.skeleton.update(),te.skeleton.frame=di.render.frame),!te.frustumCulled||xe.intersectsObject(te))){Fe&&ln.setFromMatrixPosition(te.matrixWorld).applyMatrix4(gt);const pi=jn.update(te),Di=te.material;if(Array.isArray(Di)){const Mi=pi.groups;for(let xr=0,er=Mi.length;xr<er;xr++){const or=Mi[xr],ys=Di[or.materialIndex];ys&&ys.visible&&v.push(te,pi,ys,ze,ln.z,or)}}else Di.visible&&v.push(te,pi,Di,ze,ln.z,null)}const ti=te.children;for(let pi=0,Di=ti.length;pi<Di;pi++)Eu(ti[pi],Ae,ze,Fe)}function Cu(te,Ae,ze,Fe){const ut=te.opaque,ti=te.transmissive,pi=te.transparent;x.setupLightsView(ze),ti.length>0&&function xne(te,Ae,ze){const Fe=Vn.isWebGL2;null===Ye&&(Ye=new al(1,1,{generateMipmaps:!0,type:null!==Ke.convert(jy)?jy:Cm,minFilter:1008,samples:Fe&&!0===o?4:0})),E.getDrawingBufferSize(st),Fe?Ye.setSize(st.x,st.y):Ye.setSize(cE(st.x),cE(st.y));const ut=E.getRenderTarget();E.setRenderTarget(Ye),E.clear();const ti=E.toneMapping;E.toneMapping=0,OT(te,Ae,ze),E.toneMapping=ti,ht.updateMultisampleRenderTarget(Ye),ht.updateRenderTargetMipmap(Ye),E.setRenderTarget(ut)}(ut,Ae,ze),Fe&&bt.viewport(Q.copy(Fe)),ut.length>0&&OT(ut,Ae,ze),ti.length>0&&OT(ti,Ae,ze),pi.length>0&&OT(pi,Ae,ze),bt.buffers.depth.setTest(!0),bt.buffers.depth.setMask(!0),bt.buffers.color.setMask(!0),bt.setPolygonOffset(!1)}function OT(te,Ae,ze){const Fe=!0===Ae.isScene?Ae.overrideMaterial:null;for(let ut=0,ti=te.length;ut<ti;ut++){const pi=te[ut],Di=pi.object,Mi=pi.geometry,xr=null===Fe?pi.material:Fe,er=pi.group;Di.layers.test(ze.layers)&&bne(Di,Ae,ze,Mi,xr,er)}}function bne(te,Ae,ze,Fe,ut,ti){te.onBeforeRender(E,Ae,ze,Fe,ut,ti),te.modelViewMatrix.multiplyMatrices(ze.matrixWorldInverse,te.matrixWorld),te.normalMatrix.getNormalMatrix(te.modelViewMatrix),ut.onBeforeRender(E,Ae,ze,Fe,te,ti),!0===ut.transparent&&2===ut.side?(ut.side=1,ut.needsUpdate=!0,E.renderBufferDirect(ze,Ae,Fe,ut,te,ti),ut.side=0,ut.needsUpdate=!0,E.renderBufferDirect(ze,Ae,Fe,ut,te,ti),ut.side=2):E.renderBufferDirect(ze,Ae,Fe,ut,te,ti),te.onAfterRender(E,Ae,ze,Fe,ut,ti)}function kL(te,Ae,ze){!0!==Ae.isScene&&(Ae=hn);const Fe=et.get(te),ut=x.state.lights,pi=ut.state.version,Di=On.getParameters(te,ut.state,x.state.shadowsArray,Ae,ze),Mi=On.getProgramCacheKey(Di);let xr=Fe.programs;Fe.environment=te.isMeshStandardMaterial?Ae.environment:null,Fe.fog=Ae.fog,Fe.envMap=(te.isMeshStandardMaterial?pn:Mt).get(te.envMap||Fe.environment),void 0===xr&&(te.addEventListener("dispose",kt),xr=new Map,Fe.programs=xr);let er=xr.get(Mi);if(void 0!==er){if(Fe.currentProgram===er&&Fe.lightsStateVersion===pi)return fH(te,Di),er}else Di.uniforms=On.getUniforms(te),te.onBuild(ze,Di,E),te.onBeforeCompile(Di,E),er=On.acquireProgram(Di,Mi),xr.set(Mi,er),Fe.uniforms=Di.uniforms;const or=Fe.uniforms;(!te.isShaderMaterial&&!te.isRawShaderMaterial||!0===te.clipping)&&(or.clippingPlanes=Z.uniform),fH(te,Di),Fe.needsLights=function Sne(te){return te.isMeshLambertMaterial||te.isMeshToonMaterial||te.isMeshPhongMaterial||te.isMeshStandardMaterial||te.isShadowMaterial||te.isShaderMaterial&&!0===te.lights}(te),Fe.lightsStateVersion=pi,Fe.needsLights&&(or.ambientLightColor.value=ut.state.ambient,or.lightProbe.value=ut.state.probe,or.directionalLights.value=ut.state.directional,or.directionalLightShadows.value=ut.state.directionalShadow,or.spotLights.value=ut.state.spot,or.spotLightShadows.value=ut.state.spotShadow,or.rectAreaLights.value=ut.state.rectArea,or.ltc_1.value=ut.state.rectAreaLTC1,or.ltc_2.value=ut.state.rectAreaLTC2,or.pointLights.value=ut.state.point,or.pointLightShadows.value=ut.state.pointShadow,or.hemisphereLights.value=ut.state.hemi,or.directionalShadowMap.value=ut.state.directionalShadowMap,or.directionalShadowMatrix.value=ut.state.directionalShadowMatrix,or.spotShadowMap.value=ut.state.spotShadowMap,or.spotShadowMatrix.value=ut.state.spotShadowMatrix,or.pointShadowMap.value=ut.state.pointShadowMap,or.pointShadowMatrix.value=ut.state.pointShadowMatrix);const ys=er.getUniforms(),ag=Tf.seqWithValue(ys.seq,or);return Fe.currentProgram=er,Fe.uniformsList=ag,er}function fH(te,Ae){const ze=et.get(te);ze.outputEncoding=Ae.outputEncoding,ze.instancing=Ae.instancing,ze.skinning=Ae.skinning,ze.morphTargets=Ae.morphTargets,ze.morphNormals=Ae.morphNormals,ze.morphColors=Ae.morphColors,ze.morphTargetsCount=Ae.morphTargetsCount,ze.numClippingPlanes=Ae.numClippingPlanes,ze.numIntersection=Ae.numClipIntersection,ze.vertexAlphas=Ae.vertexAlphas,ze.vertexTangents=Ae.vertexTangents,ze.toneMapping=Ae.toneMapping}Ki.setAnimationLoop(function Nt(te){ei&&ei(te)}),"undefined"!=typeof self&&Ki.setContext(self),this.setAnimationLoop=function(te){ei=te,mn.setAnimationLoop(te),null===te?Ki.stop():Ki.start()},mn.addEventListener("sessionstart",ui),mn.addEventListener("sessionend",Vr),this.render=function(te,Ae){if(void 0===Ae||!0===Ae.isCamera){if(!0!==T){if(!0===te.autoUpdate&&te.updateMatrixWorld(),null===Ae.parent&&Ae.updateMatrixWorld(),!0===mn.enabled&&!0===mn.isPresenting&&(!0===mn.cameraAutoUpdate&&mn.updateCamera(Ae),Ae=mn.getCamera()),!0===te.isScene&&te.onBeforeRender(E,te,Ae,U),x=se.get(te,S.length),x.init(),S.push(x),gt.multiplyMatrices(Ae.projectionMatrix,Ae.matrixWorldInverse),xe.setFromProjectionMatrix(gt),Re=this.localClippingEnabled,ue=Z.init(this.clippingPlanes,Re,Ae),v=Tr.get(te,b.length),v.init(),b.push(v),Eu(te,Ae,0,E.sortObjects),v.finish(),!0===E.sortObjects&&v.sort(oe,qe),!0===ue&&Z.beginShadows(),Xe.render(x.state.shadowsArray,te,Ae),!0===ue&&Z.endShadows(),!0===this.info.autoReset&&this.info.reset(),_t.render(v,te),x.setupLights(E.physicallyCorrectLights),Ae.isArrayCamera){const Fe=Ae.cameras;for(let ut=0,ti=Fe.length;ut<ti;ut++){const pi=Fe[ut];Cu(v,te,pi,pi.viewport)}}else Cu(v,te,Ae);null!==U&&(ht.updateMultisampleRenderTarget(U),ht.updateRenderTargetMipmap(U)),!0===te.isScene&&te.onAfterRender(E,te,Ae),xi.resetDefaultState(),k=-1,H=null,S.pop(),x=S.length>0?S[S.length-1]:null,b.pop(),v=b.length>0?b[b.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return U},this.setRenderTargetTextures=function(te,Ae,ze){et.get(te.texture).__webglTexture=Ae,et.get(te.depthTexture).__webglTexture=ze;const Fe=et.get(te);Fe.__hasExternalTextures=!0,Fe.__hasExternalTextures&&(Fe.__autoAllocateDepthBuffer=void 0===ze,Fe.__autoAllocateDepthBuffer||!0===Gn.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Fe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(te,Ae){const ze=et.get(te);ze.__webglFramebuffer=Ae,ze.__useDefaultFramebuffer=void 0===Ae},this.setRenderTarget=function(te,Ae=0,ze=0){U=te,N=Ae,F=ze;let Fe=!0;if(te){const Mi=et.get(te);void 0!==Mi.__useDefaultFramebuffer?(bt.bindFramebuffer(36160,null),Fe=!1):void 0===Mi.__webglFramebuffer?ht.setupRenderTarget(te):Mi.__hasExternalTextures&&ht.rebindTextures(te,et.get(te.texture).__webglTexture,et.get(te.depthTexture).__webglTexture)}let ut=null,ti=!1,pi=!1;if(te){const Mi=te.texture;(Mi.isData3DTexture||Mi.isDataArrayTexture)&&(pi=!0);const xr=et.get(te).__webglFramebuffer;te.isWebGLCubeRenderTarget?(ut=xr[Ae],ti=!0):ut=Vn.isWebGL2&&te.samples>0&&!1===ht.useMultisampledRTT(te)?et.get(te).__webglMultisampledFramebuffer:xr,Q.copy(te.viewport),ie.copy(te.scissor),ce=te.scissorTest}else Q.copy(be).multiplyScalar(q).floor(),ie.copy(Le).multiplyScalar(q).floor(),ce=de;if(bt.bindFramebuffer(36160,ut)&&Vn.drawBuffers&&Fe&&bt.drawBuffers(te,ut),bt.viewport(Q),bt.scissor(ie),bt.setScissorTest(ce),ti){const Mi=et.get(te.texture);tt.framebufferTexture2D(36160,36064,34069+Ae,Mi.__webglTexture,ze)}else if(pi){const Mi=et.get(te.texture);tt.framebufferTextureLayer(36160,36064,Mi.__webglTexture,ze||0,Ae||0)}k=-1},this.readRenderTargetPixels=function(te,Ae,ze,Fe,ut,ti,pi){if(!te||!te.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Di=et.get(te).__webglFramebuffer;if(te.isWebGLCubeRenderTarget&&void 0!==pi&&(Di=Di[pi]),Di){bt.bindFramebuffer(36160,Di);try{const Mi=te.texture,xr=Mi.format,er=Mi.type;if(xr!==Gl&&Ke.convert(xr)!==tt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const or=er===jy&&(Gn.has("EXT_color_buffer_half_float")||Vn.isWebGL2&&Gn.has("EXT_color_buffer_float"));if(!(er===Cm||Ke.convert(er)===tt.getParameter(35738)||er===yf&&(Vn.isWebGL2||Gn.has("OES_texture_float")||Gn.has("WEBGL_color_buffer_float"))||or))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ae>=0&&Ae<=te.width-Fe&&ze>=0&&ze<=te.height-ut&&tt.readPixels(Ae,ze,Fe,ut,Ke.convert(xr),Ke.convert(er),ti)}finally{const Mi=null!==U?et.get(U).__webglFramebuffer:null;bt.bindFramebuffer(36160,Mi)}}},this.copyFramebufferToTexture=function(te,Ae,ze=0){if(!0!==Ae.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Fe=Math.pow(2,-ze),ut=Math.floor(Ae.image.width*Fe),ti=Math.floor(Ae.image.height*Fe);ht.setTexture2D(Ae,0),tt.copyTexSubImage2D(3553,ze,0,0,te.x,te.y,ut,ti),bt.unbindTexture()},this.copyTextureToTexture=function(te,Ae,ze,Fe=0){const ut=Ae.image.width,ti=Ae.image.height,pi=Ke.convert(ze.format),Di=Ke.convert(ze.type);ht.setTexture2D(ze,0),tt.pixelStorei(37440,ze.flipY),tt.pixelStorei(37441,ze.premultiplyAlpha),tt.pixelStorei(3317,ze.unpackAlignment),Ae.isDataTexture?tt.texSubImage2D(3553,Fe,te.x,te.y,ut,ti,pi,Di,Ae.image.data):Ae.isCompressedTexture?tt.compressedTexSubImage2D(3553,Fe,te.x,te.y,Ae.mipmaps[0].width,Ae.mipmaps[0].height,pi,Ae.mipmaps[0].data):tt.texSubImage2D(3553,Fe,te.x,te.y,pi,Di,Ae.image),0===Fe&&ze.generateMipmaps&&tt.generateMipmap(3553),bt.unbindTexture()},this.copyTextureToTexture3D=function(te,Ae,ze,Fe,ut=0){if(E.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const ti=te.max.x-te.min.x+1,pi=te.max.y-te.min.y+1,Di=te.max.z-te.min.z+1,Mi=Ke.convert(Fe.format),xr=Ke.convert(Fe.type);let er;if(Fe.isData3DTexture)ht.setTexture3D(Fe,0),er=32879;else{if(!Fe.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ht.setTexture2DArray(Fe,0),er=35866}tt.pixelStorei(37440,Fe.flipY),tt.pixelStorei(37441,Fe.premultiplyAlpha),tt.pixelStorei(3317,Fe.unpackAlignment);const or=tt.getParameter(3314),ys=tt.getParameter(32878),ag=tt.getParameter(3316),H_=tt.getParameter(3315),G_=tt.getParameter(32877),Tu=ze.isCompressedTexture?ze.mipmaps[0]:ze.image;tt.pixelStorei(3314,Tu.width),tt.pixelStorei(32878,Tu.height),tt.pixelStorei(3316,te.min.x),tt.pixelStorei(3315,te.min.y),tt.pixelStorei(32877,te.min.z),ze.isDataTexture||ze.isData3DTexture?tt.texSubImage3D(er,ut,Ae.x,Ae.y,Ae.z,ti,pi,Di,Mi,xr,Tu.data):ze.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),tt.compressedTexSubImage3D(er,ut,Ae.x,Ae.y,Ae.z,ti,pi,Di,Mi,Tu.data)):tt.texSubImage3D(er,ut,Ae.x,Ae.y,Ae.z,ti,pi,Di,Mi,xr,Tu),tt.pixelStorei(3314,or),tt.pixelStorei(32878,ys),tt.pixelStorei(3316,ag),tt.pixelStorei(3315,H_),tt.pixelStorei(32877,G_),0===ut&&Fe.generateMipmaps&&tt.generateMipmap(er),bt.unbindTexture()},this.initTexture=function(te){ht.setTexture2D(te,0),bt.unbindTexture()},this.resetState=function(){N=0,F=0,U=null,bt.reset(),xi.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}_r.prototype.isWebGLRenderer=!0,class W9 extends _r{}.prototype.isWebGL1Renderer=!0;class OE{constructor(e,t=25e-5){this.name="",this.color=new Ht(e),this.density=t}clone(){return new OE(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}OE.prototype.isFogExp2=!0;class kE{constructor(e,t=1,i=1e3){this.name="",this.color=new Ht(e),this.near=t,this.far=i}clone(){return new kE(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}kE.prototype.isFog=!0;class BE extends Yi{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}BE.prototype.isScene=!0;class __{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Ax,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ol()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ol()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ol()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}__.prototype.isInterleavedBuffer=!0;const ga=new $;class ul{constructor(e,t,i,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ga.fromBufferAttribute(this,t),ga.applyMatrix4(e),this.setXYZ(t,ga.x,ga.y,ga.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ga.fromBufferAttribute(this,t),ga.applyNormalMatrix(e),this.setXYZ(t,ga.x,ga.y,ga.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ga.fromBufferAttribute(this,t),ga.transformDirection(e),this.setXYZ(t,ga.x,ga.y,ga.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,o){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return new Lr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ul(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ul.prototype.isInterleavedBufferAttribute=!0;class wP extends qs{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ht(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let v_;wP.prototype.isSpriteMaterial=!0;const Bx=new $,x_=new $,b_=new $,w_=new ct,Ux=new ct,U3=new Tt,UE=new $,Vx=new $,VE=new $,V3=new ct,MP=new ct,z3=new ct;function zE(n,e,t,i,r,o){w_.subVectors(n,t).addScalar(.5).multiply(i),void 0!==r?(Ux.x=o*w_.x-r*w_.y,Ux.y=r*w_.x+o*w_.y):Ux.copy(w_),n.copy(e),n.x+=Ux.x,n.y+=Ux.y,n.applyMatrix4(U3)}(class H3 extends Yi{constructor(e){if(super(),this.type="Sprite",void 0===v_){v_=new Tn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new __(t,5);v_.setIndex([0,1,2,0,2,3]),v_.setAttribute("position",new ul(i,3,0,!1)),v_.setAttribute("uv",new ul(i,2,3,!1))}this.geometry=v_,this.material=void 0!==e?e:new wP,this.center=new ct(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),x_.setFromMatrixScale(this.matrixWorld),U3.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),b_.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&x_.multiplyScalar(-b_.z);const i=this.material.rotation;let r,o;0!==i&&(o=Math.cos(i),r=Math.sin(i));const l=this.center;zE(UE.set(-.5,-.5,0),b_,l,x_,r,o),zE(Vx.set(.5,-.5,0),b_,l,x_,r,o),zE(VE.set(.5,.5,0),b_,l,x_,r,o),V3.set(0,0),MP.set(1,0),z3.set(1,1);let c=e.ray.intersectTriangle(UE,Vx,VE,!1,Bx);if(null===c&&(zE(Vx.set(-.5,.5,0),b_,l,x_,r,o),MP.set(0,1),c=e.ray.intersectTriangle(UE,VE,Vx,!1,Bx),null===c))return;const d=e.ray.origin.distanceTo(Bx);d<e.near||d>e.far||t.push({distance:d,point:Bx.clone(),uv:Ws.getUV(Bx,UE,Vx,VE,V3,MP,z3,new ct),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const W3=new $,q3=new Qi,j3=new Qi,j9=new $,X3=new Tt;class SP extends Xs{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Tt,this.bindMatrixInverse=new Tt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Qi,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;q3.fromBufferAttribute(r.attributes.skinIndex,e),j3.fromBufferAttribute(r.attributes.skinWeight,e),W3.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const l=j3.getComponent(o);if(0!==l){const c=q3.getComponent(o);X3.multiplyMatrices(i.bones[c].matrixWorld,i.boneInverses[c]),t.addScaledVector(j9.copy(W3).applyMatrix4(X3),l)}}return t.applyMatrix4(this.bindMatrixInverse)}}SP.prototype.isSkinnedMesh=!0;(class EP extends Yi{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class M_ extends Ha{constructor(e=null,t=1,i=1,r,o,l,c,d,p=ao,y=ao,v,x){super(null,l,c,d,p,y,r,o,v,x),this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}).prototype.isDataTexture=!0;class S_ extends Lr{constructor(e,t,i,r=1){"number"==typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}S_.prototype.isInstancedBufferAttribute=!0;const Y3=new Tt,K3=new Tt,GE=[],zx=new Xs;(class Z3 extends Xs{constructor(e,t,i){super(e,t),this.instanceMatrix=new S_(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(zx.geometry=this.geometry,zx.material=this.material,void 0!==zx.material)for(let o=0;o<r;o++){this.getMatrixAt(o,Y3),K3.multiplyMatrices(i,Y3),zx.matrixWorld=K3,zx.raycast(e,GE);for(let l=0,c=GE.length;l<c;l++){const d=GE[l];d.instanceId=o,d.object=this,t.push(d)}GE.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new S_(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class $s extends qs{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ht(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}$s.prototype.isLineBasicMaterial=!0;const J3=new $,Q3=new $,ek=new Tt,TP=new wf,WE=new uu;class du extends Yi{constructor(e=new Tn,t=new $s){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,o=t.count;r<o;r++)J3.fromBufferAttribute(t,r-1),Q3.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=J3.distanceTo(Q3);e.setAttribute("lineDistance",new Jt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,l=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),WE.copy(i.boundingSphere),WE.applyMatrix4(r),WE.radius+=o,!1===e.ray.intersectsSphere(WE))return;ek.copy(r).invert(),TP.copy(e.ray).applyMatrix4(ek);const c=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=c*c,p=new $,y=new $,v=new $,x=new $,b=this.isLineSegments?2:1;if(i.isBufferGeometry){const S=i.index,T=i.attributes.position;if(null!==S)for(let U=Math.max(0,l.start),k=Math.min(S.count,l.start+l.count)-1;U<k;U+=b){const H=S.getX(U),Q=S.getX(U+1);if(p.fromBufferAttribute(T,H),y.fromBufferAttribute(T,Q),TP.distanceSqToSegment(p,y,x,v)>d)continue;x.applyMatrix4(this.matrixWorld);const ce=e.ray.origin.distanceTo(x);ce<e.near||ce>e.far||t.push({distance:ce,point:v.clone().applyMatrix4(this.matrixWorld),index:U,face:null,faceIndex:null,object:this})}else for(let U=Math.max(0,l.start),k=Math.min(T.count,l.start+l.count)-1;U<k;U+=b){if(p.fromBufferAttribute(T,U),y.fromBufferAttribute(T,U+1),TP.distanceSqToSegment(p,y,x,v)>d)continue;x.applyMatrix4(this.matrixWorld);const Q=e.ray.origin.distanceTo(x);Q<e.near||Q>e.far||t.push({distance:Q,point:v.clone().applyMatrix4(this.matrixWorld),index:U,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=r.length;o<l;o++){const c=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=o}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}du.prototype.isLine=!0;const tk=new $,nk=new $;class E_ extends du{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,o=t.count;r<o;r+=2)tk.fromBufferAttribute(t,r),nk.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+tk.distanceTo(nk);e.setAttribute("lineDistance",new Jt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}E_.prototype.isLineSegments=!0;(class ik extends du{constructor(e,t){super(e,t),this.type="LineLoop"}}).prototype.isLineLoop=!0;class C_ extends qs{constructor(e){super(),this.type="PointsMaterial",this.color=new Ht(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}C_.prototype.isPointsMaterial=!0;const rk=new Tt,AP=new wf,qE=new uu,jE=new $;class DP extends Yi{constructor(e=new Tn,t=new C_){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,l=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),qE.copy(i.boundingSphere),qE.applyMatrix4(r),qE.radius+=o,!1===e.ray.intersectsSphere(qE))return;rk.copy(r).invert(),AP.copy(e.ray).applyMatrix4(rk);const c=o/((this.scale.x+this.scale.y+this.scale.z)/3),d=c*c;if(i.isBufferGeometry){const p=i.index,v=i.attributes.position;if(null!==p)for(let S=Math.max(0,l.start),E=Math.min(p.count,l.start+l.count);S<E;S++){const T=p.getX(S);jE.fromBufferAttribute(v,T),sk(jE,T,d,r,e,t,this)}else for(let S=Math.max(0,l.start),E=Math.min(v.count,l.start+l.count);S<E;S++)jE.fromBufferAttribute(v,S),sk(jE,S,d,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=r.length;o<l;o++){const c=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=o}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function sk(n,e,t,i,r,o,l){const c=AP.distanceSqToPoint(n);if(c<t){const d=new $;AP.closestPointToPoint(n,d),d.applyMatrix4(i);const p=r.ray.origin.distanceTo(d);if(p<r.near||p>r.far)return;o.push({distance:p,distanceToRay:Math.sqrt(c),point:d,index:e,face:null,object:l})}}DP.prototype.isPoints=!0,class $9 extends Ha{constructor(e,t,i,r,o,l,c,d,p){super(e,t,i,r,o,l,c,d,p),this.minFilter=void 0!==l?l:Gs,this.magFilter=void 0!==o?o:Gs,this.generateMipmaps=!1;const y=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function v(){y.needsUpdate=!0,e.requestVideoFrameCallback(v)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e==0&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class Y9 extends Ha{constructor(e,t,i){super({width:e,height:t}),this.format=i,this.magFilter=ao,this.minFilter=ao,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class ok extends Ha{constructor(e,t,i,r,o,l,c,d,p,y,v,x){super(null,l,c,d,p,y,r,o,v,x),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class K9 extends Ha{constructor(e,t,i,r,o,l,c,d,p){super(e,t,i,r,o,l,c,d,p),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class jl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),o=0;t.push(0);for(let l=1;l<=e;l++)i=this.getPoint(l/e),o+=i.distanceTo(r),t.push(o),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const o=i.length;let l;l=t||e*i[o-1];let p,c=0,d=o-1;for(;c<=d;)if(r=Math.floor(c+(d-c)/2),p=i[r]-l,p<0)c=r+1;else{if(!(p>0)){d=r;break}d=r-1}if(r=d,i[r]===l)return r/(o-1);const y=i[r];return(r+(l-y)/(i[r+1]-y))/(o-1)}getTangent(e,t){let r=e-1e-4,o=e+1e-4;r<0&&(r=0),o>1&&(o=1);const l=this.getPoint(r),c=this.getPoint(o),d=t||(l.isVector2?new ct:new $);return d.copy(c).sub(l).normalize(),d}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new $,r=[],o=[],l=[],c=new $,d=new Tt;for(let b=0;b<=e;b++)r[b]=this.getTangentAt(b/e,new $);o[0]=new $,l[0]=new $;let p=Number.MAX_VALUE;const y=Math.abs(r[0].x),v=Math.abs(r[0].y),x=Math.abs(r[0].z);y<=p&&(p=y,i.set(1,0,0)),v<=p&&(p=v,i.set(0,1,0)),x<=p&&i.set(0,0,1),c.crossVectors(r[0],i).normalize(),o[0].crossVectors(r[0],c),l[0].crossVectors(r[0],o[0]);for(let b=1;b<=e;b++){if(o[b]=o[b-1].clone(),l[b]=l[b-1].clone(),c.crossVectors(r[b-1],r[b]),c.length()>Number.EPSILON){c.normalize();const S=Math.acos(Rs(r[b-1].dot(r[b]),-1,1));o[b].applyMatrix4(d.makeRotationAxis(c,S))}l[b].crossVectors(r[b],o[b])}if(!0===t){let b=Math.acos(Rs(o[0].dot(o[e]),-1,1));b/=e,r[0].dot(c.crossVectors(o[0],o[e]))>0&&(b=-b);for(let S=1;S<=e;S++)o[S].applyMatrix4(d.makeRotationAxis(r[S],b*S)),l[S].crossVectors(r[S],o[S])}return{tangents:r,normals:o,binormals:l}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Af extends jl{constructor(e=0,t=0,i=1,r=1,o=0,l=2*Math.PI,c=!1,d=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=l,this.aClockwise=c,this.aRotation=d}getPoint(e,t){const i=t||new ct,r=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(o=l?0:r),!0===this.aClockwise&&!l&&(o===r?o=-r:o-=r);const c=this.aStartAngle+e*o;let d=this.aX+this.xRadius*Math.cos(c),p=this.aY+this.yRadius*Math.sin(c);if(0!==this.aRotation){const y=Math.cos(this.aRotation),v=Math.sin(this.aRotation),x=d-this.aX,b=p-this.aY;d=x*y-b*v+this.aX,p=x*v+b*y+this.aY}return i.set(d,p)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Af.prototype.isEllipseCurve=!0;class ak extends Af{constructor(e,t,i,r,o,l){super(e,t,i,i,r,o,l),this.type="ArcCurve"}}function RP(){let n=0,e=0,t=0,i=0;function r(o,l,c,d){n=o,e=c,t=-3*o+3*l-2*c-d,i=2*o-2*l+c+d}return{initCatmullRom:function(o,l,c,d,p){r(l,c,p*(c-o),p*(d-l))},initNonuniformCatmullRom:function(o,l,c,d,p,y,v){let x=(l-o)/p-(c-o)/(p+y)+(c-l)/y,b=(c-l)/y-(d-l)/(y+v)+(d-c)/v;x*=y,b*=y,r(l,c,x,b)},calc:function(o){const l=o*o;return n+e*o+t*l+i*(l*o)}}}ak.prototype.isArcCurve=!0;const XE=new $,PP=new RP,IP=new RP,LP=new RP;class lk extends jl{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new $){const i=t,r=this.points,o=r.length,l=(o-(this.closed?0:1))*e;let p,y,c=Math.floor(l),d=l-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/o)+1)*o:0===d&&c===o-1&&(c=o-2,d=1),this.closed||c>0?p=r[(c-1)%o]:(XE.subVectors(r[0],r[1]).add(r[0]),p=XE);const v=r[c%o],x=r[(c+1)%o];if(this.closed||c+2<o?y=r[(c+2)%o]:(XE.subVectors(r[o-1],r[o-2]).add(r[o-1]),y=XE),"centripetal"===this.curveType||"chordal"===this.curveType){const b="chordal"===this.curveType?.5:.25;let S=Math.pow(p.distanceToSquared(v),b),E=Math.pow(v.distanceToSquared(x),b),T=Math.pow(x.distanceToSquared(y),b);E<1e-4&&(E=1),S<1e-4&&(S=E),T<1e-4&&(T=E),PP.initNonuniformCatmullRom(p.x,v.x,x.x,y.x,S,E,T),IP.initNonuniformCatmullRom(p.y,v.y,x.y,y.y,S,E,T),LP.initNonuniformCatmullRom(p.z,v.z,x.z,y.z,S,E,T)}else"catmullrom"===this.curveType&&(PP.initCatmullRom(p.x,v.x,x.x,y.x,this.tension),IP.initCatmullRom(p.y,v.y,x.y,y.y,this.tension),LP.initCatmullRom(p.z,v.z,x.z,y.z,this.tension));return i.set(PP.calc(d),IP.calc(d),LP.calc(d)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push((new $).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function ck(n,e,t,i,r){const o=.5*(i-e),l=.5*(r-t),c=n*n;return(2*t-2*i+o+l)*(n*c)+(-3*t+3*i-2*o-l)*c+o*n+t}function Hx(n,e,t,i){return function Z9(n,e){const t=1-n;return t*t*e}(n,e)+function J9(n,e){return 2*(1-n)*n*e}(n,t)+function Q9(n,e){return n*n*e}(n,i)}function Gx(n,e,t,i,r){return function eX(n,e){const t=1-n;return t*t*t*e}(n,e)+function tX(n,e){const t=1-n;return 3*t*t*n*e}(n,t)+function nX(n,e){return 3*(1-n)*n*n*e}(n,i)+function iX(n,e){return n*n*n*e}(n,r)}lk.prototype.isCatmullRomCurve3=!0;class FP extends jl{constructor(e=new ct,t=new ct,i=new ct,r=new ct){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ct){const i=t,r=this.v0,o=this.v1,l=this.v2,c=this.v3;return i.set(Gx(e,r.x,o.x,l.x,c.x),Gx(e,r.y,o.y,l.y,c.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}FP.prototype.isCubicBezierCurve=!0;class uk extends jl{constructor(e=new $,t=new $,i=new $,r=new $){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new $){const i=t,r=this.v0,o=this.v1,l=this.v2,c=this.v3;return i.set(Gx(e,r.x,o.x,l.x,c.x),Gx(e,r.y,o.y,l.y,c.y),Gx(e,r.z,o.z,l.z,c.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}uk.prototype.isCubicBezierCurve3=!0;class $E extends jl{constructor(e=new ct,t=new ct){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ct){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new ct;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}$E.prototype.isLineCurve=!0;class NP extends jl{constructor(e=new ct,t=new ct,i=new ct){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ct){const i=t,r=this.v0,o=this.v1,l=this.v2;return i.set(Hx(e,r.x,o.x,l.x),Hx(e,r.y,o.y,l.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}NP.prototype.isQuadraticBezierCurve=!0;class OP extends jl{constructor(e=new $,t=new $,i=new $){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new $){const i=t,r=this.v0,o=this.v1,l=this.v2;return i.set(Hx(e,r.x,o.x,l.x),Hx(e,r.y,o.y,l.y),Hx(e,r.z,o.z,l.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}OP.prototype.isQuadraticBezierCurve3=!0;class kP extends jl{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new ct){const i=t,r=this.points,o=(r.length-1)*e,l=Math.floor(o),c=o-l,d=r[0===l?l:l-1],p=r[l],y=r[l>r.length-2?r.length-1:l+1],v=r[l>r.length-3?r.length-1:l+2];return i.set(ck(c,d.x,p.x,y.x,v.x),ck(c,d.y,p.y,y.y,v.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push((new ct).fromArray(r))}return this}}kP.prototype.isSplineCurve=!0;var BP=Object.freeze({__proto__:null,ArcCurve:ak,CatmullRomCurve3:lk,CubicBezierCurve:FP,CubicBezierCurve3:uk,EllipseCurve:Af,LineCurve:$E,LineCurve3:class rX extends jl{constructor(e=new $,t=new $){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new $){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:NP,QuadraticBezierCurve3:OP,SplineCurve:kP});class sX extends jl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $E(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let o=0;for(;o<r.length;){if(r[o]>=i){const l=r[o]-i,c=this.curves[o],d=c.getLength();return c.getPointAt(0===d?0:1-l/d,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,o=this.curves;r<o.length;r++){const l=o[r],d=l.getPoints(l.isEllipseCurve?2*e:l.isLineCurve||l.isLineCurve3?1:l.isSplineCurve?e*l.points.length:e);for(let p=0;p<d.length;p++){const y=d[p];i&&i.equals(y)||(t.push(y),i=y)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push((new BP[r.type]).fromJSON(r))}return this}}class Wx extends sX{constructor(e){super(),this.type="Path",this.currentPoint=new ct,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new $E(this.currentPoint.clone(),new ct(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const o=new NP(this.currentPoint.clone(),new ct(e,t),new ct(i,r));return this.curves.push(o),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,o,l){const c=new FP(this.currentPoint.clone(),new ct(e,t),new ct(i,r),new ct(o,l));return this.curves.push(c),this.currentPoint.set(o,l),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new kP(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,o,l){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,r,o,l),this}absarc(e,t,i,r,o,l){return this.absellipse(e,t,i,i,r,o,l),this}ellipse(e,t,i,r,o,l,c,d){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,r,o,l,c,d),this}absellipse(e,t,i,r,o,l,c,d){const p=new Af(e,t,i,r,o,l,c,d);if(this.curves.length>0){const v=p.getPoint(0);v.equals(this.currentPoint)||this.lineTo(v.x,v.y)}this.curves.push(p);const y=p.getPoint(1);return this.currentPoint.copy(y),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}new $,new $,new $,new Ws;class qh extends Wx{constructor(e){super(e),this.uuid=ol(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push((new Wx).fromJSON(r))}return this}}function dk(n,e,t,i,r){let o,l;if(r===function wX(n,e,t,i){let r=0;for(let o=e,l=t-i;o<t;o+=i)r+=(n[l]-n[o])*(n[o+1]+n[l+1]),l=o;return r}(n,e,t,i)>0)for(o=e;o<t;o+=i)l=mk(o,n[o],n[o+1],l);else for(o=t-i;o>=e;o-=i)l=mk(o,n[o],n[o+1],l);return l&&nC(l,l.next)&&($x(l),l=l.next),l}function Rf(n,e){if(!n)return n;e||(e=n);let i,t=n;do{if(i=!1,t.steiner||!nC(t,t.next)&&0!==ns(t.prev,t,t.next))t=t.next;else{if($x(t),t=e=t.prev,t===t.next)break;i=!0}}while(i||t!==e);return e}function jx(n,e,t,i,r,o,l){if(!n)return;!l&&o&&function gX(n,e,t,i){let r=n;do{null===r.z&&(r.z=VP(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,function yX(n){let e,t,i,r,o,l,c,d,p=1;do{for(t=n,n=null,o=null,l=0;t;){for(l++,i=t,c=0,e=0;e<p&&(c++,i=i.nextZ,i);e++);for(d=p;c>0||d>0&&i;)0!==c&&(0===d||!i||t.z<=i.z)?(r=t,t=t.nextZ,c--):(r=i,i=i.nextZ,d--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;t=i}o.nextZ=null,p*=2}while(l>1)}(r)}(n,i,r,o);let d,p,c=n;for(;n.prev!==n.next;)if(d=n.prev,p=n.next,o?lX(n,i,r,o):aX(n))e.push(d.i/t),e.push(n.i/t),e.push(p.i/t),$x(n),n=p.next,c=p.next;else if((n=p)===c){l?1===l?jx(n=cX(Rf(n),e,t),e,t,i,r,o,2):2===l&&uX(n,e,t,i,r,o):jx(Rf(n),e,t,i,r,o,1);break}}function aX(n){const e=n.prev,t=n,i=n.next;if(ns(e,t,i)>=0)return!1;let r=n.next.next;for(;r!==n.prev;){if(A_(e.x,e.y,t.x,t.y,i.x,i.y,r.x,r.y)&&ns(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function lX(n,e,t,i){const r=n.prev,o=n,l=n.next;if(ns(r,o,l)>=0)return!1;const p=r.x>o.x?r.x>l.x?r.x:l.x:o.x>l.x?o.x:l.x,y=r.y>o.y?r.y>l.y?r.y:l.y:o.y>l.y?o.y:l.y,v=VP(r.x<o.x?r.x<l.x?r.x:l.x:o.x<l.x?o.x:l.x,r.y<o.y?r.y<l.y?r.y:l.y:o.y<l.y?o.y:l.y,e,t,i),x=VP(p,y,e,t,i);let b=n.prevZ,S=n.nextZ;for(;b&&b.z>=v&&S&&S.z<=x;){if(b!==n.prev&&b!==n.next&&A_(r.x,r.y,o.x,o.y,l.x,l.y,b.x,b.y)&&ns(b.prev,b,b.next)>=0||(b=b.prevZ,S!==n.prev&&S!==n.next&&A_(r.x,r.y,o.x,o.y,l.x,l.y,S.x,S.y)&&ns(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;b&&b.z>=v;){if(b!==n.prev&&b!==n.next&&A_(r.x,r.y,o.x,o.y,l.x,l.y,b.x,b.y)&&ns(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;S&&S.z<=x;){if(S!==n.prev&&S!==n.next&&A_(r.x,r.y,o.x,o.y,l.x,l.y,S.x,S.y)&&ns(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function cX(n,e,t){let i=n;do{const r=i.prev,o=i.next.next;!nC(r,o)&&fk(r,i,i.next,o)&&Xx(r,o)&&Xx(o,r)&&(e.push(r.i/t),e.push(i.i/t),e.push(o.i/t),$x(i),$x(i.next),i=n=o),i=i.next}while(i!==n);return Rf(i)}function uX(n,e,t,i,r,o){let l=n;do{let c=l.next.next;for(;c!==l.prev;){if(l.i!==c.i&&vX(l,c)){let d=pk(l,c);return l=Rf(l,l.next),d=Rf(d,d.next),jx(l,e,t,i,r,o),void jx(d,e,t,i,r,o)}c=c.next}l=l.next}while(l!==n)}function dX(n,e){return n.x-e.x}function fX(n,e){if(e=function pX(n,e){let t=e;const i=n.x,r=n.y;let l,o=-1/0;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const x=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(x<=i&&x>o){if(o=x,x===i){if(r===t.y)return t;if(r===t.next.y)return t.next}l=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!l)return null;if(i===o)return l;const c=l,d=l.x,p=l.y;let v,y=1/0;t=l;do{i>=t.x&&t.x>=d&&i!==t.x&&A_(r<p?i:o,r,d,p,r<p?o:i,r,t.x,t.y)&&(v=Math.abs(r-t.y)/(i-t.x),Xx(t,n)&&(v<y||v===y&&(t.x>l.x||t.x===l.x&&mX(l,t)))&&(l=t,y=v)),t=t.next}while(t!==c);return l}(n,e),e){const t=pk(e,n);Rf(e,e.next),Rf(t,t.next)}}function mX(n,e){return ns(n.prev,n,e.prev)<0&&ns(e.next,n,n.next)<0}function VP(n,e,t,i,r){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*r)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _X(n){let e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function A_(n,e,t,i,r,o,l,c){return(r-l)*(e-c)-(n-l)*(o-c)>=0&&(n-l)*(i-c)-(t-l)*(e-c)>=0&&(t-l)*(o-c)-(r-l)*(i-c)>=0}function vX(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function xX(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&fk(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(Xx(n,e)&&Xx(e,n)&&function bX(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,o=(n.y+e.y)/2;do{t.y>o!=t.next.y>o&&t.next.y!==t.y&&r<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next}while(t!==n);return i}(n,e)&&(ns(n.prev,n,e.prev)||ns(n,e.prev,e))||nC(n,e)&&ns(n.prev,n,n.next)>0&&ns(e.prev,e,e.next)>0)}function ns(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function nC(n,e){return n.x===e.x&&n.y===e.y}function fk(n,e,t,i){const r=rC(ns(n,e,t)),o=rC(ns(n,e,i)),l=rC(ns(t,i,n)),c=rC(ns(t,i,e));return!!(r!==o&&l!==c||0===r&&iC(n,t,e)||0===o&&iC(n,i,e)||0===l&&iC(t,n,i)||0===c&&iC(t,e,i))}function iC(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function rC(n){return n>0?1:n<0?-1:0}function Xx(n,e){return ns(n.prev,n,n.next)<0?ns(n,e,n.next)>=0&&ns(n,n.prev,e)>=0:ns(n,e,n.prev)<0||ns(n,n.next,e)<0}function pk(n,e){const t=new zP(n.i,n.x,n.y),i=new zP(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function mk(n,e,t,i){const r=new zP(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function $x(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function zP(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class jh{static area(e){const t=e.length;let i=0;for(let r=t-1,o=0;o<t;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return.5*i}static isClockWise(e){return jh.area(e)<0}static triangulateShape(e,t){const i=[],r=[],o=[];gk(e),yk(i,e);let l=e.length;t.forEach(gk);for(let d=0;d<t.length;d++)r.push(l),l+=t[d].length,yk(i,t[d]);const c=function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let o=dk(n,0,r,t,!0);const l=[];if(!o||o.next===o.prev)return l;let c,d,p,y,v,x,b;if(i&&(o=function hX(n,e,t,i){const r=[];let o,l,c,d,p;for(o=0,l=e.length;o<l;o++)c=e[o]*i,d=o<l-1?e[o+1]*i:n.length,p=dk(n,c,d,i,!1),p===p.next&&(p.steiner=!0),r.push(_X(p));for(r.sort(dX),o=0;o<r.length;o++)fX(r[o],t),t=Rf(t,t.next);return t}(n,e,o,t)),n.length>80*t){c=p=n[0],d=y=n[1];for(let S=t;S<r;S+=t)v=n[S],x=n[S+1],v<c&&(c=v),x<d&&(d=x),v>p&&(p=v),x>y&&(y=x);b=Math.max(p-c,y-d),b=0!==b?1/b:0}return jx(o,l,t,c,d,b),l}(i,r);for(let d=0;d<c.length;d+=3)o.push(c.slice(d,d+3));return o}}function gk(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function yk(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class Pf extends Tn{constructor(e=new qh([new ct(.5,.5),new ct(-.5,.5),new ct(-.5,-.5),new ct(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],o=[];for(let c=0,d=e.length;c<d;c++)l(e[c]);function l(c){const d=[],p=void 0!==t.curveSegments?t.curveSegments:12,y=void 0!==t.steps?t.steps:1;let v=void 0!==t.depth?t.depth:1,x=void 0===t.bevelEnabled||t.bevelEnabled,b=void 0!==t.bevelThickness?t.bevelThickness:.2,S=void 0!==t.bevelSize?t.bevelSize:b-.1,E=void 0!==t.bevelOffset?t.bevelOffset:0,T=void 0!==t.bevelSegments?t.bevelSegments:3;const N=t.extrudePath,F=void 0!==t.UVGenerator?t.UVGenerator:MX;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),v=t.amount);let U,H,Q,ie,ce,k=!1;N&&(U=N.getSpacedPoints(y),k=!0,x=!1,H=N.computeFrenetFrames(y,!1),Q=new $,ie=new $,ce=new $),x||(T=0,b=0,S=0,E=0);const De=c.extractPoints(p);let ve=De.shape;const q=De.holes;if(!jh.isClockWise(ve)){ve=ve.reverse();for(let et=0,ht=q.length;et<ht;et++){const Mt=q[et];jh.isClockWise(Mt)&&(q[et]=Mt.reverse())}}const qe=jh.triangulateShape(ve,q),be=ve;for(let et=0,ht=q.length;et<ht;et++)ve=ve.concat(q[et]);function Le(et,ht,Mt){return ht||console.error("THREE.ExtrudeGeometry: vec does not exist"),ht.clone().multiplyScalar(Mt).add(et)}const de=ve.length,xe=qe.length;function ue(et,ht,Mt){let pn,Kt,fi;const jn=et.x-ht.x,On=et.y-ht.y,is=Mt.x-et.x,Tr=Mt.y-et.y,se=jn*jn+On*On;if(Math.abs(jn*Tr-On*is)>Number.EPSILON){const Xe=Math.sqrt(se),_t=Math.sqrt(is*is+Tr*Tr),Xt=ht.x-On/Xe,sn=ht.y+jn/Xe,xi=((Mt.x-Tr/_t-Xt)*Tr-(Mt.y+is/_t-sn)*is)/(jn*Tr-On*is);pn=Xt+jn*xi-et.x,Kt=sn+On*xi-et.y;const Ai=pn*pn+Kt*Kt;if(Ai<=2)return new ct(pn,Kt);fi=Math.sqrt(Ai/2)}else{let Xe=!1;jn>Number.EPSILON?is>Number.EPSILON&&(Xe=!0):jn<-Number.EPSILON?is<-Number.EPSILON&&(Xe=!0):Math.sign(On)===Math.sign(Tr)&&(Xe=!0),Xe?(pn=-On,Kt=jn,fi=Math.sqrt(se)):(pn=jn,Kt=On,fi=Math.sqrt(se/2))}return new ct(pn/fi,Kt/fi)}const Re=[];for(let et=0,ht=be.length,Mt=ht-1,pn=et+1;et<ht;et++,Mt++,pn++)Mt===ht&&(Mt=0),pn===ht&&(pn=0),Re[et]=ue(be[et],be[Mt],be[pn]);const Ye=[];let gt,st=Re.concat();for(let et=0,ht=q.length;et<ht;et++){const Mt=q[et];gt=[];for(let pn=0,Kt=Mt.length,fi=Kt-1,jn=pn+1;pn<Kt;pn++,fi++,jn++)fi===Kt&&(fi=0),jn===Kt&&(jn=0),gt[pn]=ue(Mt[pn],Mt[fi],Mt[jn]);Ye.push(gt),st=st.concat(gt)}for(let et=0;et<T;et++){const ht=et/T,Mt=b*Math.cos(ht*Math.PI/2),pn=S*Math.sin(ht*Math.PI/2)+E;for(let Kt=0,fi=be.length;Kt<fi;Kt++){const jn=Le(be[Kt],Re[Kt],pn);Yn(jn.x,jn.y,-Mt)}for(let Kt=0,fi=q.length;Kt<fi;Kt++){const jn=q[Kt];gt=Ye[Kt];for(let On=0,is=jn.length;On<is;On++){const Tr=Le(jn[On],gt[On],pn);Yn(Tr.x,Tr.y,-Mt)}}}const ln=S+E;for(let et=0;et<de;et++){const ht=x?Le(ve[et],st[et],ln):ve[et];k?(ie.copy(H.normals[0]).multiplyScalar(ht.x),Q.copy(H.binormals[0]).multiplyScalar(ht.y),ce.copy(U[0]).add(ie).add(Q),Yn(ce.x,ce.y,ce.z)):Yn(ht.x,ht.y,0)}for(let et=1;et<=y;et++)for(let ht=0;ht<de;ht++){const Mt=x?Le(ve[ht],st[ht],ln):ve[ht];k?(ie.copy(H.normals[et]).multiplyScalar(Mt.x),Q.copy(H.binormals[et]).multiplyScalar(Mt.y),ce.copy(U[et]).add(ie).add(Q),Yn(ce.x,ce.y,ce.z)):Yn(Mt.x,Mt.y,v/y*et)}for(let et=T-1;et>=0;et--){const ht=et/T,Mt=b*Math.cos(ht*Math.PI/2),pn=S*Math.sin(ht*Math.PI/2)+E;for(let Kt=0,fi=be.length;Kt<fi;Kt++){const jn=Le(be[Kt],Re[Kt],pn);Yn(jn.x,jn.y,v+Mt)}for(let Kt=0,fi=q.length;Kt<fi;Kt++){const jn=q[Kt];gt=Ye[Kt];for(let On=0,is=jn.length;On<is;On++){const Tr=Le(jn[On],gt[On],pn);k?Yn(Tr.x,Tr.y+U[y-1].y,U[y-1].x+Mt):Yn(Tr.x,Tr.y,v+Mt)}}}function tt(et,ht){let Mt=et.length;for(;--Mt>=0;){const pn=Mt;let Kt=Mt-1;Kt<0&&(Kt=et.length-1);for(let fi=0,jn=y+2*T;fi<jn;fi++){const On=de*fi,is=de*(fi+1);Vn(ht+pn+On,ht+Kt+On,ht+Kt+is,ht+pn+is)}}}function Yn(et,ht,Mt){d.push(et),d.push(ht),d.push(Mt)}function Gn(et,ht,Mt){bt(et),bt(ht),bt(Mt);const pn=r.length/3,Kt=F.generateTopUV(i,r,pn-3,pn-2,pn-1);di(Kt[0]),di(Kt[1]),di(Kt[2])}function Vn(et,ht,Mt,pn){bt(et),bt(ht),bt(pn),bt(ht),bt(Mt),bt(pn);const Kt=r.length/3,fi=F.generateSideWallUV(i,r,Kt-6,Kt-3,Kt-2,Kt-1);di(fi[0]),di(fi[1]),di(fi[3]),di(fi[1]),di(fi[2]),di(fi[3])}function bt(et){r.push(d[3*et+0]),r.push(d[3*et+1]),r.push(d[3*et+2])}function di(et){o.push(et.x),o.push(et.y)}(function hn(){const et=r.length/3;if(x){let ht=0,Mt=de*ht;for(let pn=0;pn<xe;pn++){const Kt=qe[pn];Gn(Kt[2]+Mt,Kt[1]+Mt,Kt[0]+Mt)}ht=y+2*T,Mt=de*ht;for(let pn=0;pn<xe;pn++){const Kt=qe[pn];Gn(Kt[0]+Mt,Kt[1]+Mt,Kt[2]+Mt)}}else{for(let ht=0;ht<xe;ht++){const Mt=qe[ht];Gn(Mt[2],Mt[1],Mt[0])}for(let ht=0;ht<xe;ht++){const Mt=qe[ht];Gn(Mt[0]+de*y,Mt[1]+de*y,Mt[2]+de*y)}}i.addGroup(et,r.length/3-et,0)})(),function qn(){const et=r.length/3;let ht=0;tt(be,ht),ht+=be.length;for(let Mt=0,pn=q.length;Mt<pn;Mt++){const Kt=q[Mt];tt(Kt,ht),ht+=Kt.length}i.addGroup(et,r.length/3-et,1)}()}this.setAttribute("position",new Jt(r,3)),this.setAttribute("uv",new Jt(o,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function SX(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++)t.shapes.push(n[i].uuid);else t.shapes.push(n.uuid);return void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let o=0,l=e.shapes.length;o<l;o++)i.push(t[e.shapes[o]]);const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new BP[r.type]).fromJSON(r)),new Pf(i,e.options)}}const MX={generateTopUV:function(n,e,t,i,r){const c=e[3*i],d=e[3*i+1],p=e[3*r],y=e[3*r+1];return[new ct(e[3*t],e[3*t+1]),new ct(c,d),new ct(p,y)]},generateSideWallUV:function(n,e,t,i,r,o){const l=e[3*t],c=e[3*t+1],d=e[3*t+2],p=e[3*i],y=e[3*i+1],v=e[3*i+2],x=e[3*r],b=e[3*r+1],S=e[3*r+2],E=e[3*o],T=e[3*o+1],N=e[3*o+2];return Math.abs(c-y)<Math.abs(l-p)?[new ct(l,1-d),new ct(p,1-v),new ct(x,1-S),new ct(E,1-N)]:[new ct(c,1-d),new ct(y,1-v),new ct(b,1-S),new ct(T,1-N)]}};class Kx extends Tn{constructor(e=new qh([new ct(0,.5),new ct(-.5,-.5),new ct(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],o=[],l=[];let c=0,d=0;if(!1===Array.isArray(e))p(e);else for(let y=0;y<e.length;y++)p(e[y]),this.addGroup(c,d,y),c+=d,d=0;function p(y){const v=r.length/3,x=y.extractPoints(t);let b=x.shape;const S=x.holes;!1===jh.isClockWise(b)&&(b=b.reverse());for(let T=0,N=S.length;T<N;T++){const F=S[T];!0===jh.isClockWise(F)&&(S[T]=F.reverse())}const E=jh.triangulateShape(b,S);for(let T=0,N=S.length;T<N;T++)b=b.concat(S[T]);for(let T=0,N=b.length;T<N;T++){const F=b[T];r.push(F.x,F.y,0),o.push(0,0,1),l.push(F.x,F.y)}for(let T=0,N=E.length;T<N;T++){const F=E[T];i.push(F[0]+v,F[1]+v,F[2]+v),d+=3}}this.setIndex(i),this.setAttribute("position",new Jt(r,3)),this.setAttribute("normal",new Jt(o,3)),this.setAttribute("uv",new Jt(l,2))}toJSON(){const e=super.toJSON();return function EX(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++)e.shapes.push(n[t].uuid);else e.shapes.push(n.uuid);return e}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++)i.push(t[e.shapes[r]]);return new Kx(i,e.curveSegments)}}class HP extends Tn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,r=new $,o=new $;if(null!==e.index){const l=e.attributes.position,c=e.index;let d=e.groups;0===d.length&&(d=[{start:0,count:c.count,materialIndex:0}]);for(let p=0,y=d.length;p<y;++p){const v=d[p],x=v.start;for(let S=x,E=x+v.count;S<E;S+=3)for(let T=0;T<3;T++){const N=c.getX(S+T),F=c.getX(S+(T+1)%3);r.fromBufferAttribute(l,N),o.fromBufferAttribute(l,F),!0===_k(r,o,i)&&(t.push(r.x,r.y,r.z),t.push(o.x,o.y,o.z))}}}else{const l=e.attributes.position;for(let c=0,d=l.count/3;c<d;c++)for(let p=0;p<3;p++){const v=3*c+(p+1)%3;r.fromBufferAttribute(l,3*c+p),o.fromBufferAttribute(l,v),!0===_k(r,o,i)&&(t.push(r.x,r.y,r.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new Jt(t,3))}}}function _k(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return!0!==t.has(i)&&!0!==t.has(r)&&(t.add(i),t.add(r),!0)}class xk extends qs{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ht(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}xk.prototype.isShadowMaterial=!0;class bk extends ql{constructor(e){super(e),this.type="RawShaderMaterial"}}bk.prototype.isRawShaderMaterial=!0;class GP extends qs{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ht(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}GP.prototype.isMeshStandardMaterial=!0;class wk extends GP{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ct(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Rs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Ht(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ht(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ht(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}wk.prototype.isMeshPhysicalMaterial=!0;class Mk extends qs{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ht(16777215),this.specular=new Ht(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Mk.prototype.isMeshPhongMaterial=!0;class Sk extends qs{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ht(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Sk.prototype.isMeshToonMaterial=!0;class Ek extends qs{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Ek.prototype.isMeshNormalMaterial=!0;class Ck extends qs{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Ck.prototype.isMeshLambertMaterial=!0;class Tk extends qs{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ht(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Tk.prototype.isMeshMatcapMaterial=!0;class Ak extends $s{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Ak.prototype.isLineDashedMaterial=!0;const CX={ShadowMaterial:xk,SpriteMaterial:wP,RawShaderMaterial:bk,ShaderMaterial:ql,PointsMaterial:C_,MeshPhysicalMaterial:wk,MeshStandardMaterial:GP,MeshPhongMaterial:Mk,MeshToonMaterial:Sk,MeshNormalMaterial:Ek,MeshLambertMaterial:Ck,MeshDepthMaterial:vP,MeshDistanceMaterial:xP,MeshBasicMaterial:hu,MeshMatcapMaterial:Tk,LineDashedMaterial:Ak,LineBasicMaterial:$s,Material:qs};qs.fromType=function(n){return new CX[n]};const Yr={arraySlice:function(n,e,t){return Yr.isTypedArray(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(function e(r,o){return n[r]-n[o]}),i},sortedArray:function(n,e,t){const i=n.length,r=new n.constructor(i);for(let o=0,l=0;l!==i;++o){const c=t[o]*e;for(let d=0;d!==e;++d)r[l++]=n[c+d]}return r},flattenJSON:function(n,e,t,i){let r=1,o=n[0];for(;void 0!==o&&void 0===o[i];)o=n[r++];if(void 0===o)return;let l=o[i];if(void 0!==l)if(Array.isArray(l))do{l=o[i],void 0!==l&&(e.push(o.time),t.push.apply(t,l)),o=n[r++]}while(void 0!==o);else if(void 0!==l.toArray)do{l=o[i],void 0!==l&&(e.push(o.time),l.toArray(t,t.length)),o=n[r++]}while(void 0!==o);else do{l=o[i],void 0!==l&&(e.push(o.time),t.push(l)),o=n[r++]}while(void 0!==o)},subclip:function(n,e,t,i,r=30){const o=n.clone();o.name=e;const l=[];for(let d=0;d<o.tracks.length;++d){const p=o.tracks[d],y=p.getValueSize(),v=[],x=[];for(let b=0;b<p.times.length;++b){const S=p.times[b]*r;if(!(S<t||S>=i)){v.push(p.times[b]);for(let E=0;E<y;++E)x.push(p.values[b*y+E])}}0!==v.length&&(p.times=Yr.convertArray(v,p.times.constructor),p.values=Yr.convertArray(x,p.values.constructor),l.push(p))}o.tracks=l;let c=1/0;for(let d=0;d<o.tracks.length;++d)c>o.tracks[d].times[0]&&(c=o.tracks[d].times[0]);for(let d=0;d<o.tracks.length;++d)o.tracks[d].shift(-1*c);return o.resetDuration(),o},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,o=e/i;for(let l=0;l<r;++l){const c=t.tracks[l],d=c.ValueTypeName;if("bool"===d||"string"===d)continue;const p=n.tracks.find(function(N){return N.name===c.name&&N.ValueTypeName===d});if(void 0===p)continue;let y=0;const v=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(y=v/3);let x=0;const b=p.getValueSize();p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=b/3);const S=c.times.length-1;let E;if(o<=c.times[0])E=Yr.arraySlice(c.values,y,v-y);else if(o>=c.times[S]){const N=S*v+y;E=Yr.arraySlice(c.values,N,N+v-y)}else{const N=c.createInterpolant(),F=y,U=v-y;N.evaluate(o),E=Yr.arraySlice(N.resultBuffer,F,U)}"quaternion"===d&&(new Mo).fromArray(E).normalize().conjugate().toArray(E);const T=p.times.length;for(let N=0;N<T;++N){const F=N*b+x;if("quaternion"===d)Mo.multiplyQuaternionsFlat(p.values,F,E,0,p.values,F);else{const U=b-2*x;for(let k=0;k<U;++k)p.values[F+k]-=E[k]}}}return n.blendMode=2501,n}};class If{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],o=t[i-1];e:{t:{let l;n:{i:if(!(e<r)){for(let c=i+2;;){if(void 0===r){if(e<o)break i;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,o)}if(i===c)break;if(o=r,r=t[++i],e<r)break t}l=t.length;break n}if(e>=o)break e;{const c=t[1];e<c&&(i=2,o=c);for(let d=i-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===d)break;if(r=o,o=t[--i-1],e>=o)break t}l=i,i=0}}for(;i<l;){const c=i+l>>>1;e<t[c]?l=c:i=c+1}if(r=t[i],o=t[i-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,o,e)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let l=0;l!==r;++l)t[l]=i[o+l];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}If.prototype.beforeStart_=If.prototype.copySampleValue_,If.prototype.afterEnd_=If.prototype.copySampleValue_;class TX extends If{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Yy,endingEnd:Yy}}intervalChanged_(e,t,i){const r=this.parameterPositions;let o=e-2,l=e+1,c=r[o],d=r[l];if(void 0===c)switch(this.getSettings_().endingStart){case Ky:o=e,c=2*t-i;break;case 2402:o=r.length-2,c=t+r[o]-r[o+1];break;default:o=e,c=i}if(void 0===d)switch(this.getSettings_().endingEnd){case Ky:l=e,d=2*i-t;break;case 2402:l=1,d=i+r[1]-r[0];break;default:l=e-1,d=t}const p=.5*(i-t),y=this.valueSize;this._weightPrev=p/(t-c),this._weightNext=p/(d-i),this._offsetPrev=o*y,this._offsetNext=l*y}interpolate_(e,t,i,r){const o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,d=e*c,p=d-c,y=this._offsetPrev,v=this._offsetNext,x=this._weightPrev,b=this._weightNext,S=(i-t)/(r-t),E=S*S,T=E*S,N=-x*T+2*x*E-x*S,F=(1+x)*T+(-1.5-2*x)*E+(-.5+x)*S+1,U=(-1-b)*T+(1.5+b)*E+.5*S,k=b*T-b*E;for(let H=0;H!==c;++H)o[H]=N*l[y+H]+F*l[p+H]+U*l[d+H]+k*l[v+H];return o}}class Dk extends If{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,d=e*c,p=d-c,y=(i-t)/(r-t),v=1-y;for(let x=0;x!==c;++x)o[x]=l[p+x]*v+l[d+x]*y;return o}}class AX extends If{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class fu{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Yr.convertArray(t,this.TimeBufferType),this.values=Yr.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Yr.convertArray(e.times,Array),values:Yr.convertArray(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new AX(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Dk(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new TX(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let o=0,l=r-1;for(;o!==r&&i[o]<e;)++o;for(;-1!==l&&i[l]>t;)--l;if(++l,0!==o||l!==r){o>=l&&(l=Math.max(l,1),o=l-1);const c=this.getValueSize();this.times=Yr.arraySlice(i,o,l),this.values=Yr.arraySlice(this.values,o*c,l*c)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,o=i.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let c=0;c!==o;c++){const d=i[c];if("number"==typeof d&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,d),e=!1;break}if(null!==l&&l>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,d,l),e=!1;break}l=d}if(void 0!==r&&Yr.isTypedArray(r))for(let c=0,d=r.length;c!==d;++c){const p=r[c];if(isNaN(p)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,p),e=!1;break}}return e}optimize(){const e=Yr.arraySlice(this.times),t=Yr.arraySlice(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),o=e.length-1;let l=1;for(let c=1;c<o;++c){let d=!1;const p=e[c];if(p!==e[c+1]&&(1!==c||p!==e[0]))if(r)d=!0;else{const v=c*i,x=v-i,b=v+i;for(let S=0;S!==i;++S){const E=t[v+S];if(E!==t[x+S]||E!==t[b+S]){d=!0;break}}}if(d){if(c!==l){e[l]=e[c];const v=c*i,x=l*i;for(let b=0;b!==i;++b)t[x+b]=t[v+b]}++l}}if(o>0){e[l]=e[o];for(let c=o*i,d=l*i,p=0;p!==i;++p)t[d+p]=t[c+p];++l}return l!==e.length?(this.times=Yr.arraySlice(e,0,l),this.values=Yr.arraySlice(t,0,l*i)):(this.times=e,this.values=t),this}clone(){const e=Yr.arraySlice(this.times,0),t=Yr.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}fu.prototype.TimeBufferType=Float32Array,fu.prototype.ValueBufferType=Float32Array,fu.prototype.DefaultInterpolation=2301;class D_ extends fu{}D_.prototype.ValueTypeName="bool",D_.prototype.ValueBufferType=Array,D_.prototype.DefaultInterpolation=2300,D_.prototype.InterpolantFactoryMethodLinear=void 0,D_.prototype.InterpolantFactoryMethodSmooth=void 0;class Rk extends fu{}Rk.prototype.ValueTypeName="color";class hC extends fu{}hC.prototype.ValueTypeName="number";class DX extends If{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,l=this.sampleValues,c=this.valueSize,d=(i-t)/(r-t);let p=e*c;for(let y=p+c;p!==y;p+=4)Mo.slerpFlat(o,0,l,p-c,l,p,d);return o}}class Jx extends fu{InterpolantFactoryMethodLinear(e){return new DX(this.times,this.values,this.getValueSize(),e)}}Jx.prototype.ValueTypeName="quaternion",Jx.prototype.DefaultInterpolation=2301,Jx.prototype.InterpolantFactoryMethodSmooth=void 0;class R_ extends fu{}R_.prototype.ValueTypeName="string",R_.prototype.ValueBufferType=Array,R_.prototype.DefaultInterpolation=2300,R_.prototype.InterpolantFactoryMethodLinear=void 0,R_.prototype.InterpolantFactoryMethodSmooth=void 0;class dC extends fu{}dC.prototype.ValueTypeName="vector";class fC{constructor(e,t=-1,i,r=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=ol(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let l=0,c=i.length;l!==c;++l)t.push(PX(i[l]).scale(r));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=i.length;o!==l;++o)t.push(fu.toJSON(i[o]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const o=t.length,l=[];for(let c=0;c<o;c++){let d=[],p=[];d.push((c+o-1)%o,c,(c+1)%o),p.push(0,1,0);const y=Yr.getKeyframeOrder(d);d=Yr.sortedArray(d,1,y),p=Yr.sortedArray(p,1,y),!r&&0===d[0]&&(d.push(o),p.push(p[0])),l.push(new hC(".morphTargetInfluences["+t[c].name+"]",d,p).scale(1/i))}return new this(e,-1,l)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},o=/^([\w-]*?)([\d]+)$/;for(let c=0,d=e.length;c<d;c++){const p=e[c],y=p.name.match(o);if(y&&y.length>1){const v=y[1];let x=r[v];x||(r[v]=x=[]),x.push(p)}}const l=[];for(const c in r)l.push(this.CreateFromMorphTargetSequence(c,r[c],t,i));return l}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(v,x,b,S,E){if(0!==b.length){const T=[],N=[];Yr.flattenJSON(b,T,N,S),0!==T.length&&E.push(new v(x,T,N))}},r=[],o=e.name||"default",l=e.fps||30,c=e.blendMode;let d=e.length||-1;const p=e.hierarchy||[];for(let v=0;v<p.length;v++){const x=p[v].keys;if(x&&0!==x.length)if(x[0].morphTargets){const b={};let S;for(S=0;S<x.length;S++)if(x[S].morphTargets)for(let E=0;E<x[S].morphTargets.length;E++)b[x[S].morphTargets[E]]=-1;for(const E in b){const T=[],N=[];for(let F=0;F!==x[S].morphTargets.length;++F){const U=x[S];T.push(U.time),N.push(U.morphTarget===E?1:0)}r.push(new hC(".morphTargetInfluence["+E+"]",T,N))}d=b.length*l}else{const b=".bones["+t[v].name+"]";i(dC,b+".position",x,"pos",r),i(Jx,b+".quaternion",x,"rot",r),i(dC,b+".scale",x,"scl",r)}}return 0===r.length?null:new this(o,d,r,c)}resetDuration(){let t=0;for(let i=0,r=this.tracks.length;i!==r;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function PX(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function RX(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return hC;case"vector":case"vector2":case"vector3":case"vector4":return dC;case"color":return Rk;case"quaternion":return Jx;case"bool":case"boolean":return D_;case"string":return R_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],i=[];Yr.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const P_={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};const IX=new class Pk{constructor(e,t,i){const r=this;let d,o=!1,l=0,c=0;const p=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(y){c++,!1===o&&void 0!==r.onStart&&r.onStart(y,l,c),o=!0},this.itemEnd=function(y){l++,void 0!==r.onProgress&&r.onProgress(y,l,c),l===c&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(y){void 0!==r.onError&&r.onError(y)},this.resolveURL=function(y){return d?d(y):y},this.setURLModifier=function(y){return d=y,this},this.addHandler=function(y,v){return p.push(y,v),this},this.removeHandler=function(y){const v=p.indexOf(y);return-1!==v&&p.splice(v,2),this},this.getHandler=function(y){for(let v=0,x=p.length;v<x;v+=2){const b=p[v],S=p[v+1];if(b.global&&(b.lastIndex=0),b.test(y))return S}return null}}};class Xh{constructor(e){this.manager=void 0!==e?e:IX,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,o){i.load(e,r,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const $h={};class Yh extends Xh{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=P_.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(void 0!==$h[e])return void $h[e].push({onLoad:t,onProgress:i,onError:r});$h[e]=[],$h[e].push({onLoad:t,onProgress:i,onError:r});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),c=this.mimeType,d=this.responseType;fetch(l).then(p=>{if(200===p.status||0===p.status){if(0===p.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===p.body||void 0===p.body.getReader)return p;const y=$h[e],v=p.body.getReader(),x=p.headers.get("Content-Length"),b=x?parseInt(x):0,S=0!==b;let E=0;const T=new ReadableStream({start(N){!function F(){v.read().then(({done:U,value:k})=>{if(U)N.close();else{E+=k.byteLength;const H=new ProgressEvent("progress",{lengthComputable:S,loaded:E,total:b});for(let Q=0,ie=y.length;Q<ie;Q++){const ce=y[Q];ce.onProgress&&ce.onProgress(H)}N.enqueue(k),F()}})}()}});return new Response(T)}throw Error(`fetch for "${p.url}" responded with ${p.status}: ${p.statusText}`)}).then(p=>{switch(d){case"arraybuffer":return p.arrayBuffer();case"blob":return p.blob();case"document":return p.text().then(y=>(new DOMParser).parseFromString(y,c));case"json":return p.json();default:if(void 0===c)return p.text();{const v=/charset="?([^;"\s]*)"?/i.exec(c),x=v&&v[1]?v[1].toLowerCase():void 0,b=new TextDecoder(x);return p.arrayBuffer().then(S=>b.decode(S))}}}).then(p=>{P_.add(e,p);const y=$h[e];delete $h[e];for(let v=0,x=y.length;v<x;v++){const b=y[v];b.onLoad&&b.onLoad(p)}}).catch(p=>{const y=$h[e];if(void 0===y)throw this.manager.itemError(e),p;delete $h[e];for(let v=0,x=y.length;v<x;v++){const b=y[v];b.onError&&b.onError(p)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class pC extends Xh{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=P_.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const c=Ix("img");function d(){y(),P_.add(e,this),t&&t(this),o.manager.itemEnd(e)}function p(v){y(),r&&r(v),o.manager.itemError(e),o.manager.itemEnd(e)}function y(){c.removeEventListener("load",d,!1),c.removeEventListener("error",p,!1)}return c.addEventListener("load",d,!1),c.addEventListener("error",p,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(c.crossOrigin=this.crossOrigin),o.manager.itemStart(e),c.src=e,c}}class LX extends Xh{constructor(e){super(e)}load(e,t,i,r){const o=new Ox,l=new pC(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let c=0;function d(p){l.load(e[p],function(y){o.images[p]=y,c++,6===c&&(o.needsUpdate=!0,t&&t(o))},void 0,r)}for(let p=0;p<e.length;++p)d(p);return o}}class Ik extends Xh{constructor(e){super(e)}load(e,t,i,r){const o=new Ha,l=new pC(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(c){o.image=c,o.needsUpdate=!0,void 0!==t&&t(o)},i,r),o}}class pu extends Yi{constructor(e,t=1){super(),this.type="Light",this.color=new Ht(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}pu.prototype.isLight=!0;(class Lk extends pu{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Yi.DefaultUp),this.updateMatrix(),this.groundColor=new Ht(t)}copy(e){return pu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}).prototype.isHemisphereLight=!0;const Fk=new Tt,Nk=new $,Ok=new $;class WP{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ct(512,512),this.map=null,this.mapPass=null,this.matrix=new Tt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new IE,this._frameExtents=new ct(1,1),this._viewportCount=1,this._viewports=[new Qi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Nk.setFromMatrixPosition(e.matrixWorld),t.position.copy(Nk),Ok.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ok),t.updateMatrixWorld(),Fk.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Fk),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class kk extends WP{constructor(){super(new Eo(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*Rx*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||r!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=r,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}kk.prototype.isSpotLightShadow=!0;(class Bk extends pu{constructor(e,t,i=0,r=Math.PI/3,o=0,l=1){super(e,t),this.type="SpotLight",this.position.copy(Yi.DefaultUp),this.updateMatrix(),this.target=new Yi,this.distance=i,this.angle=r,this.penumbra=o,this.decay=l,this.shadow=new kk}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isSpotLight=!0;const Uk=new Tt,Qx=new $,qP=new $;class Vk extends WP{constructor(){super(new Eo(90,1,.5,500)),this._frameExtents=new ct(4,2),this._viewportCount=6,this._viewports=[new Qi(2,1,1,1),new Qi(0,1,1,1),new Qi(3,1,1,1),new Qi(1,1,1,1),new Qi(3,0,1,1),new Qi(1,0,1,1)],this._cubeDirections=[new $(1,0,0),new $(-1,0,0),new $(0,0,1),new $(0,0,-1),new $(0,1,0),new $(0,-1,0)],this._cubeUps=[new $(0,1,0),new $(0,1,0),new $(0,1,0),new $(0,1,0),new $(0,0,1),new $(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),Qx.setFromMatrixPosition(e.matrixWorld),i.position.copy(Qx),qP.copy(i.position),qP.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(qP),i.updateMatrixWorld(),r.makeTranslation(-Qx.x,-Qx.y,-Qx.z),Uk.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Uk)}}Vk.prototype.isPointLightShadow=!0;(class zk extends pu{constructor(e,t,i=0,r=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Vk}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}).prototype.isPointLight=!0;class Hk extends WP{constructor(){super(new LE(-5,5,5,-5,.5,500))}}Hk.prototype.isDirectionalLightShadow=!0;(class Gk extends pu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Yi.DefaultUp),this.updateMatrix(),this.target=new Yi,this.shadow=new Hk}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class Wk extends pu{constructor(e,t){super(e,t),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class qk extends pu{constructor(e,t,i=10,r=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}).prototype.isRectAreaLight=!0;class jk{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new $)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.282095),t.addScaledVector(l[1],.488603*r),t.addScaledVector(l[2],.488603*o),t.addScaledVector(l[3],.488603*i),t.addScaledVector(l[4],i*r*1.092548),t.addScaledVector(l[5],r*o*1.092548),t.addScaledVector(l[6],.315392*(3*o*o-1)),t.addScaledVector(l[7],i*o*1.092548),t.addScaledVector(l[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.886227),t.addScaledVector(l[1],1.023328*r),t.addScaledVector(l[2],1.023328*o),t.addScaledVector(l[3],1.023328*i),t.addScaledVector(l[4],.858086*i*r),t.addScaledVector(l[5],.858086*r*o),t.addScaledVector(l[6],.743125*o*o-.247708),t.addScaledVector(l[7],.858086*i*o),t.addScaledVector(l[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const i=e.x,r=e.y,o=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*o,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*i*o,t[8]=.546274*(i*i-r*r)}}jk.prototype.isSphericalHarmonics3=!0;class mC extends pu{constructor(e=new jk,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}mC.prototype.isLightProbe=!0;class gC{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(i){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class jP extends Tn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}let yC;jP.prototype.isInstancedBufferGeometry=!0,class kX extends Xh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=P_.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const c={};c.credentials="anonymous"===this.crossOrigin?"same-origin":"include",c.headers=this.requestHeader,fetch(e,c).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(d){P_.add(e,d),t&&t(d),o.manager.itemEnd(e)}).catch(function(d){r&&r(d),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}.prototype.isImageBitmapLoader=!0;class BX extends Xh{constructor(e){super(e)}load(e,t,i,r){const o=this,l=new Yh(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{const d=c.slice(0);(void 0===yC&&(yC=new(window.AudioContext||window.webkitAudioContext)),yC).decodeAudioData(d,function(y){t(y)})}catch(d){r?r(d):console.error(d),o.manager.itemError(e)}},i,r)}}(class UX extends mC{constructor(e,t,i=1){super(void 0,i);const r=(new Ht).set(e),o=(new Ht).set(t),l=new $(r.r,r.g,r.b),c=new $(o.r,o.g,o.b),d=Math.sqrt(Math.PI),p=d*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(c).multiplyScalar(d),this.sh.coefficients[1].copy(l).sub(c).multiplyScalar(p)}}).prototype.isHemisphereLightProbe=!0,class VX extends mC{constructor(e,t=1){super(void 0,t);const i=(new Ht).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class jX{constructor(e,t,i){let r,o,l;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,o=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,o=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,o=e*r+r;let l=this.cumulativeWeight;if(0===l){for(let c=0;c!==r;++c)i[o+c]=i[c];l=t}else l+=t,this._mixBufferRegion(i,o,0,t/l,r);this.cumulativeWeight=l}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,o=this.cumulativeWeight,l=this.cumulativeWeightAdditive,c=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1&&this._mixBufferRegion(i,r,t*this._origIndex,1-o,t),l>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let d=t,p=t+t;d!==p;++d)if(i[d]!==i[d+t]){c.setValue(i,r);break}}saveOriginalState(){const t=this.buffer,i=this.valueSize,r=i*this._origIndex;this.binding.getValue(t,r);for(let o=i,l=r;o!==l;++o)t[o]=t[r+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,o){if(r>=.5)for(let l=0;l!==o;++l)e[t+l]=e[i+l]}_slerp(e,t,i,r){Mo.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,o){const l=this._workIndex*o;Mo.multiplyQuaternionsFlat(e,l,e,t,e,i),Mo.slerpFlat(e,t,e,t,e,l,r)}_lerp(e,t,i,r,o){const l=1-r;for(let c=0;c!==o;++c){const d=t+c;e[d]=e[d]*l+e[i+c]*r}}_lerpAdditive(e,t,i,r,o){for(let l=0;l!==o;++l){const c=t+l;e[c]=e[c]+e[i+l]*r}}}const XP="\\[\\]\\.:\\/",XX=new RegExp("["+XP+"]","g"),$P="[^"+XP+"]",$X="[^"+XP.replace("\\.","")+"]",YX=/((?:WC+[\/:])*)/.source.replace("WC",$P),KX=/(WCOD+)?/.source.replace("WCOD",$X),ZX=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$P),JX=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$P),QX=new RegExp("^"+YX+KX+ZX+JX+"$"),e$=["material","materials","bones"];class t${constructor(e,t,i){const r=i||Ur.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let Ur=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(XX,"")}static parseTrackName(t){const i=QX.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){const l=r.nodeName.substring(o+1);-1!==e$.indexOf(l)&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=l)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(l){for(let c=0;c<l.length;c++){const d=l[c];if(d.name===i||d.uuid===i)return d;const p=r(d.children);if(p)return p}return null},o=r(t.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)t[i++]=r[o]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let o=0,l=r.length;o!==l;++o)r[o]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,o=i.propertyName;let l=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let y=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let v=0;v<t.length;v++)if(t[v].name===y){y=v;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==y){if(void 0===t[y])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[y]}}const c=t[o];if(void 0===c)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+o+" but it wasn't found.",t);let d=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?d=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(d=this.Versioning.MatrixWorldNeedsUpdate);let p=this.BindingType.Direct;if(void 0!==l){if("morphTargetInfluences"===o){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[l]&&(l=t.morphTargetDictionary[l])}p=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=l}else void 0!==c.fromArray&&void 0!==c.toArray?(p=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(p=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=o;this.getValue=this.GetterByBindingType[p],this.setValue=this.SetterByBindingTypeAndVersioning[p][d]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=t$,n})();Ur.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ur.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ur.prototype.GetterByBindingType=[Ur.prototype._getValue_direct,Ur.prototype._getValue_array,Ur.prototype._getValue_arrayElement,Ur.prototype._getValue_toArray],Ur.prototype.SetterByBindingTypeAndVersioning=[[Ur.prototype._setValue_direct,Ur.prototype._setValue_direct_setNeedsUpdate,Ur.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ur.prototype._setValue_array,Ur.prototype._setValue_array_setNeedsUpdate,Ur.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ur.prototype._setValue_arrayElement,Ur.prototype._setValue_arrayElement_setNeedsUpdate,Ur.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ur.prototype._setValue_fromArray,Ur.prototype._setValue_fromArray_setNeedsUpdate,Ur.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class i${constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const o=t.tracks,l=o.length,c=new Array(l),d={endingStart:Yy,endingEnd:Yy};for(let p=0;p!==l;++p){const y=o[p].createInterpolant(null);c[p]=y,y.settings=d}this._interpolantSettings=d,this._interpolants=c,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,o=e._clip.duration,c=r/o;e.warp(1,o/r,t),this.warp(c,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,o=r.time,l=this.timeScale;let c=this._timeScaleInterpolant;null===c&&(c=r._lendControlInterpolant(),this._timeScaleInterpolant=c);const d=c.parameterPositions,p=c.sampleValues;return d[0]=o,d[1]=o+i,p[0]=e/l,p[1]=t/l,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled)return void this._updateWeight(e);const o=this._startTime;if(null!==o){const d=(e-o)*i;if(d<0||0===i)return;this._startTime=null,t=i*d}t*=this._updateTimeScale(e);const l=this._updateTime(t),c=this._updateWeight(e);if(c>0){const d=this._interpolants,p=this._propertyBindings;if(2501===this.blendMode)for(let y=0,v=d.length;y!==v;++y)d[y].evaluate(l),p[y].accumulateAdditive(c);else for(let y=0,v=d.length;y!==v;++y)d[y].evaluate(l),p[y].accumulate(r,c)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,o=this._loopCount;const l=2202===i;if(0===e)return-1===o?r:l&&1==(1&o)?t-r:r;if(2200===i){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,l)):this._setEndings(0===this.repetitions,!0,l)),r>=t||r<0){const c=Math.floor(r/t);r-=t*c,o+=Math.abs(c);const d=this.repetitions-o;if(d<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===d){const p=e<0;this._setEndings(p,!p,l)}else this._setEndings(!1,!1,l);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c})}}else this.time=r;if(l&&1==(1&o))return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=Ky,r.endingEnd=Ky):(r.endingStart=e?this.zeroSlopeAtStart?Ky:Yy:2402,r.endingEnd=t?this.zeroSlopeAtEnd?Ky:Yy:2402)}_scheduleFading(e,t,i){const r=this._mixer,o=r.time;let l=this._weightInterpolant;null===l&&(l=r._lendControlInterpolant(),this._weightInterpolant=l);const c=l.parameterPositions,d=l.sampleValues;return c[0]=o,d[0]=t,c[1]=o+e,d[1]=i,this}}(class r$ extends _f{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,o=r.length,l=e._propertyBindings,c=e._interpolants,d=i.uuid,p=this._bindingsByRootAndName;let y=p[d];void 0===y&&(y={},p[d]=y);for(let v=0;v!==o;++v){const x=r[v],b=x.name;let S=y[b];if(void 0!==S)++S.referenceCount,l[v]=S;else{if(S=l[v],void 0!==S){null===S._cacheIndex&&(++S.referenceCount,this._addInactiveBinding(S,d,b));continue}S=new jX(Ur.create(i,b,t&&t._propertyBindings[v].binding.parsedPath),x.ValueTypeName,x.getValueSize()),++S.referenceCount,this._addInactiveBinding(S,d,b),l[v]=S}c[v].resultBuffer=S.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];0==--o.useCount&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,o=this._actionsByClip;let l=o[t];if(void 0===l)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=l;else{const c=l.knownActions;e._byClipCacheIndex=c.length,c.push(e)}e._cacheIndex=r.length,r.push(e),l.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,l=this._actionsByClip,c=l[o],d=c.knownActions,p=d[d.length-1],y=e._byClipCacheIndex;p._byClipCacheIndex=y,d[y]=p,d.pop(),e._byClipCacheIndex=null,delete c.actionByRoot[(e._localRoot||this._root).uuid],0===d.length&&delete l[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];0==--o.referenceCount&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,o=this._bindings;let l=r[t];void 0===l&&(l={},r[t]=l),l[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,o=i.path,l=this._bindingsByRootAndName,c=l[r],d=t[t.length-1],p=e._cacheIndex;d._cacheIndex=p,t[p]=d,t.pop(),delete c[o],0===Object.keys(c).length&&delete l[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new Dk(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=t[r];e.__cacheIndex=r,t[r]=e,o.__cacheIndex=i,t[i]=o}clipAction(e,t,i){const r=t||this._root,o=r.uuid;let l="string"==typeof e?fC.findByName(r,e):e;const c=null!==l?l.uuid:e,d=this._actionsByClip[c];let p=null;if(void 0===i&&(i=null!==l?l.blendMode:2500),void 0!==d){const v=d.actionByRoot[o];if(void 0!==v&&v.blendMode===i)return v;p=d.knownActions[0],null===l&&(l=p._clip)}if(null===l)return null;const y=new i$(this,l,t,i);return this._bindAction(y,p),this._addInactiveAction(y,c,o),y}existingAction(e,t){const i=t||this._root,r=i.uuid,o="string"==typeof e?fC.findByName(i,e):e,c=this._actionsByClip[o?o.uuid:e];return void 0!==c&&c.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)e[i].stop();return this}update(e){const t=this._actions,i=this._nActiveActions,r=this.time+=e*=this.timeScale,o=Math.sign(e),l=this._accuIndex^=1;for(let p=0;p!==i;++p)t[p]._update(r,e,o,l);const c=this._bindings,d=this._nActiveBindings;for(let p=0;p!==d;++p)c[p].apply(l);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,o=r[i];if(void 0!==o){const l=o.knownActions;for(let c=0,d=l.length;c!==d;++c){const p=l[c];this._deactivateAction(p);const y=p._cacheIndex,v=t[t.length-1];p._cacheIndex=null,p._byClipCacheIndex=null,v._cacheIndex=y,t[y]=v,t.pop(),this._removeInactiveBindingsForAction(p)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const l in i){const d=i[l].actionByRoot[t];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}const o=this._bindingsByRootAndName[t];if(void 0!==o)for(const l in o){const c=o[l];c.restoreOriginalState(),this._removeInactiveBinding(c)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class YP{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new YP(void 0===this.value.clone?this.value:this.value.clone())}}class _C extends __{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}function tB(n,e){return n.distance-e.distance}function KP(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===i){const r=n.children;for(let o=0,l=r.length;o<l;o++)KP(r[o],e,t,!0)}}_C.prototype.isInstancedInterleavedBuffer=!0;const nB=new ct;class eb{constructor(e=new ct(1/0,1/0),t=new ct(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=nB.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return nB.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}eb.prototype.isBox2=!0;const iB=new $,vC=new $;class rB{constructor(e=new $,t=new $){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){iB.subVectors(e,this.start),vC.subVectors(this.end,this.start);const i=vC.dot(vC);let o=vC.dot(iB)/i;return t&&(o=Rs(o,0,1)),o}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Lf=new $,xC=new Tt,ZP=new Tt;function oB(n){const e=[];!0===n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,oB(n.children[t]));return e}class cB extends E_{constructor(e=10,t=10,i=4473924,r=8947848){i=new Ht(i),r=new Ht(r);const o=t/2,l=e/t,c=e/2,d=[],p=[];for(let x=0,b=0,S=-c;x<=t;x++,S+=l){d.push(-c,0,S,c,0,S),d.push(S,0,-c,S,0,c);const E=x===o?i:r;E.toArray(p,b),b+=3,E.toArray(p,b),b+=3,E.toArray(p,b),b+=3,E.toArray(p,b),b+=3}const y=new Tn;y.setAttribute("position",new Jt(d,3)),y.setAttribute("color",new Jt(p,3)),super(y,new $s({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const fB=new ArrayBuffer(4),Tc=(new Float32Array(fB),new Uint32Array(fB),new Uint32Array(512)),Ac=new Uint32Array(512);for(let n=0;n<256;++n){const e=n-127;e<-27?(Tc[n]=0,Tc[256|n]=32768,Ac[n]=24,Ac[256|n]=24):e<-14?(Tc[n]=1024>>-e-14,Tc[256|n]=1024>>-e-14|32768,Ac[n]=-e-1,Ac[256|n]=-e-1):e<=15?(Tc[n]=e+15<<10,Tc[256|n]=e+15<<10|32768,Ac[n]=13,Ac[256|n]=13):e<128?(Tc[n]=31744,Tc[256|n]=64512,Ac[n]=24,Ac[256|n]=24):(Tc[n]=31744,Tc[256|n]=64512,Ac[n]=13,Ac[256|n]=13)}const QP=new Uint32Array(2048),I_=new Uint32Array(64),gB=new Uint32Array(64);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;0==(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,QP[n]=e|t}for(let n=1024;n<2048;++n)QP[n]=939524096+(n-1024<<13);for(let n=1;n<31;++n)I_[n]=n<<23;I_[31]=1199570944,I_[32]=2147483648;for(let n=33;n<63;++n)I_[n]=2147483648+(n-32<<23);I_[63]=3347054592;for(let n=1;n<64;++n)32!==n&&(gB[n]=1024);jl.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(jl.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n},Wx.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)},cB.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class a$ extends E_{constructor(e){const t=oB(e),i=new Tn,r=[],o=[],l=new Ht(0,0,1),c=new Ht(0,1,0);for(let p=0;p<t.length;p++){const y=t[p];y.parent&&y.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(l.r,l.g,l.b),o.push(c.r,c.g,c.b))}i.setAttribute("position",new Jt(r,3)),i.setAttribute("color",new Jt(o,3)),super(i,new $s({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");ZP.copy(this.root.matrixWorld).invert();for(let o=0,l=0;o<t.length;o++){const c=t[o];c.parent&&c.parent.isBone&&(xC.multiplyMatrices(ZP,c.matrixWorld),Lf.setFromMatrixPosition(xC),r.setXYZ(l,Lf.x,Lf.y,Lf.z),xC.multiplyMatrices(ZP,c.parent.matrixWorld),Lf.setFromMatrixPosition(xC),r.setXYZ(l+1,Lf.x,Lf.y,Lf.z),l+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Xh.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),gC.extractUrlBase(n)},Xh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},eb.prototype.center=function(n){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(n)},eb.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},eb.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},eb.prototype.size=function(n){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(n)},Ko.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)},Ko.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ko.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},Ko.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},Ko.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)},Nm.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},uu.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},IE.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)},rB.prototype.center=function(n){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(n)},wo.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},wo.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},wo.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},wo.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},wo.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},wo.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()},Tt.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)},Tt.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},Tt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new $).setFromMatrixColumn(this,3)},Tt.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)},Tt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Tt.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Tt.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Tt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Tt.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)},Tt.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Tt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Tt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Tt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Tt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Tt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Tt.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Tt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Tt.prototype.makeFrustum=function(n,e,t,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,r,o)},Tt.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()},Wh.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)},Mo.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)},Mo.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},wf.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},wf.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)},wf.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},Ws.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ws.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)},Ws.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)},Ws.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)},Ws.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)},Ws.barycoordFromPoint=function(n,e,t,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ws.getBarycoord(n,e,t,i,r)},Ws.normal=function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ws.getNormal(n,e,t,i)},qh.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)},qh.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Pf(this,n)},qh.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Kx(this,n)},ct.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},ct.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},ct.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},$.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},$.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},$.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)},$.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)},$.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)},$.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)},$.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},$.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},$.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Qi.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},Qi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Yi.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)},Yi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Yi.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)},Yi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Yi.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)},Object.defineProperties(Yi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Xs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Xs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),SP.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Eo.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(n)},Object.defineProperties(pu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}}),Object.defineProperties(Lr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Dx},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Dx)}}}),Lr.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===n?Dx:Ax),this},Lr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Lr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Tn.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)},Tn.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===n?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Lr(arguments[1],arguments[2])))},Tn.prototype.addDrawCall=function(n,e,t){void 0!==t&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)},Tn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Tn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Tn.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)},Tn.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)},Object.defineProperties(Tn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),__.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===n?Dx:Ax),this},__.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Pf.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Pf.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Pf.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},BE.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},YP.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(qs.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ht}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ql.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}}),_r.prototype.clearTarget=function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)},_r.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)},_r.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},_r.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},_r.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},_r.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},_r.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},_r.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},_r.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},_r.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},_r.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},_r.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},_r.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},_r.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},_r.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)},_r.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},_r.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},_r.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},_r.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},_r.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},_r.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},_r.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},_r.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},_r.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},_r.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(_r.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===n?$r:kh}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(O3.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(al.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}}),class GX extends Yi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new BX).load(n,function(i){e.setBuffer(i)}),this},hP.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)},hP.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)},Pm.crossOrigin=void 0,Pm.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Ik;r.setCrossOrigin(this.crossOrigin);const o=r.load(n,t,void 0,i);return e&&(o.mapping=e),o},Pm.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new LX;r.setCrossOrigin(this.crossOrigin);const o=r.load(n,t,void 0,i);return e&&(o.mapping=e),o},Pm.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Pm.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139");var qm=co(765);const EC=new Ht;class c$ extends Xh{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,i,r){const o=this,l=new Yh(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{t(o.parse(c))}catch(d){r?r(d):console.error(d),o.manager.itemError(e)}},i,r)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(b){let E="",T=0;const N=/^ply([\s\S]*)end_header\r?\n/.exec(b);null!==N&&(E=N[1],T=new Blob([N[0]]).size);const F={comments:[],elements:[],headerLength:T,objInfo:""},U=E.split("\n");let k;function H(Q,ie){const ce={type:Q[0]};return"list"===ce.type?(ce.name=Q[3],ce.countType=Q[1],ce.itemType=Q[2]):ce.name=Q[1],ce.name in ie&&(ce.name=ie[ce.name]),ce}for(let Q=0;Q<U.length;Q++){let ie=U[Q];if(ie=ie.trim(),""===ie)continue;const ce=ie.split(/\s+/),De=ce.shift();switch(ie=ce.join(" "),De){case"format":F.format=ce[0],F.version=ce[1];break;case"comment":F.comments.push(ie);break;case"element":void 0!==k&&F.elements.push(k),k={},k.name=ce[0],k.count=parseInt(ce[1]),k.properties=[];break;case"property":k.properties.push(H(ce,x.propertyNameMapping));break;case"obj_info":F.objInfo=ie;break;default:console.log("unhandled",De,ce)}}return void 0!==k&&F.elements.push(k),F}function i(b,S){switch(S){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(b);case"float":case"double":case"float32":case"float64":return parseFloat(b)}}function r(b,S){const E=S.split(/\s+/),T={};for(let N=0;N<b.length;N++)if("list"===b[N].type){const F=[],U=i(E.shift(),b[N].countType);for(let k=0;k<U;k++)F.push(i(E.shift(),b[N].itemType));T[b[N].name]=F}else T[b[N].name]=i(E.shift(),b[N].type);return T}function o(b,S){const E={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let T,F="";null!==(T=/end_header\s([\s\S]*)$/.exec(b))&&(F=T[1]);const U=F.split("\n");let k=0,H=0;for(let Q=0;Q<U.length;Q++){let ie=U[Q];if(ie=ie.trim(),""===ie)continue;H>=S.elements[k].count&&(k++,H=0);const ce=r(S.elements[k].properties,ie);c(E,S.elements[k].name,ce),H++}return l(E)}function l(b){let S=new Tn;return b.indices.length>0&&S.setIndex(b.indices),S.setAttribute("position",new Jt(b.vertices,3)),b.normals.length>0&&S.setAttribute("normal",new Jt(b.normals,3)),b.uvs.length>0&&S.setAttribute("uv",new Jt(b.uvs,2)),b.colors.length>0&&S.setAttribute("color",new Jt(b.colors,3)),b.faceVertexUvs.length>0&&(S=S.toNonIndexed(),S.setAttribute("uv",new Jt(b.faceVertexUvs,2))),S.computeBoundingSphere(),S}function c(b,S,E){function T(oe){for(let qe=0,be=oe.length;qe<be;qe++){const Le=oe[qe];if(Le in E)return Le}return null}const N=T(["x","px","posx"])||"x",F=T(["y","py","posy"])||"y",U=T(["z","pz","posz"])||"z",k=T(["nx","normalx"]),H=T(["ny","normaly"]),Q=T(["nz","normalz"]),ie=T(["s","u","texture_u","tx"]),ce=T(["t","v","texture_v","ty"]),De=T(["red","diffuse_red","r","diffuse_r"]),ve=T(["green","diffuse_green","g","diffuse_g"]),q=T(["blue","diffuse_blue","b","diffuse_b"]);if("vertex"===S)b.vertices.push(E[N],E[F],E[U]),null!==k&&null!==H&&null!==Q&&b.normals.push(E[k],E[H],E[Q]),null!==ie&&null!==ce&&b.uvs.push(E[ie],E[ce]),null!==De&&null!==ve&&null!==q&&(EC.setRGB(E[De]/255,E[ve]/255,E[q]/255).convertSRGBToLinear(),b.colors.push(EC.r,EC.g,EC.b));else if("face"===S){const oe=E.vertex_indices||E.vertex_index,qe=E.texcoord;3===oe.length?(b.indices.push(oe[0],oe[1],oe[2]),qe&&6===qe.length&&(b.faceVertexUvs.push(qe[0],qe[1]),b.faceVertexUvs.push(qe[2],qe[3]),b.faceVertexUvs.push(qe[4],qe[5]))):4===oe.length&&(b.indices.push(oe[0],oe[1],oe[3]),b.indices.push(oe[1],oe[2],oe[3]))}}function d(b,S,E,T){switch(E){case"int8":case"char":return[b.getInt8(S),1];case"uint8":case"uchar":return[b.getUint8(S),1];case"int16":case"short":return[b.getInt16(S,T),2];case"uint16":case"ushort":return[b.getUint16(S,T),2];case"int32":case"int":return[b.getInt32(S,T),4];case"uint32":case"uint":return[b.getUint32(S,T),4];case"float32":case"float":return[b.getFloat32(S,T),4];case"float64":case"double":return[b.getFloat64(S,T),8]}}function p(b,S,E,T){const N={};let F,U=0;for(let k=0;k<E.length;k++)if("list"===E[k].type){const H=[];F=d(b,S+U,E[k].countType,T);const Q=F[0];U+=F[1];for(let ie=0;ie<Q;ie++)F=d(b,S+U,E[k].itemType,T),H.push(F[0]),U+=F[1];N[E[k].name]=H}else F=d(b,S+U,E[k].type,T),N[E[k].name]=F[0],U+=F[1];return[N,U]}let v;const x=this;if(e instanceof ArrayBuffer){const b=gC.decodeText(new Uint8Array(e)),S=t(b);v="ascii"===S.format?o(b,S):function y(b,S){const E={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},T="binary_little_endian"===S.format,N=new DataView(b,S.headerLength);let F,U=0;for(let k=0;k<S.elements.length;k++)for(let H=0;H<S.elements[k].count;H++)F=p(N,U,S.elements[k].properties,T),U+=F[1],c(E,S.elements[k].name,F[0]);return l(E)}(e,S)}else v=o(e,t(e));return v}}var Kh=(()=>{return(n=Kh||(Kh={}))[n.DEFAULT=0]="DEFAULT",n[n.COLOR=1]="COLOR",Kh;var n})();class u$ extends DP{constructor(e,t){super(e,t),this.pointsMaterials=[],this.pointsMaterials[Kh.DEFAULT]=t||new C_({vertexColors:!0,sizeAttenuation:!1,transparent:!0}),this.pointsMaterials[Kh.COLOR]=new C_({sizeAttenuation:!1,transparent:!0})}setColor(e){this.pointsMaterials[Kh.COLOR].color.set(e),this.material=this.pointsMaterials[Kh.COLOR]}getColor(){return this.pointsMaterials[Kh.COLOR].color}getName(){return this.name}setVisibility(e){this.visible=e}getVisibility(){return this.visible}resetColor(){this.material=this.pointsMaterials[Kh.DEFAULT]}setPointSize(e){this.pointsMaterials.forEach(t=>t.size=e)}setOpacity(e){this.pointsMaterials.forEach(t=>t.opacity=e)}}const mu=Object.create(null);mu.open="0",mu.close="1",mu.ping="2",mu.pong="3",mu.message="4",mu.upgrade="5",mu.noop="6";const CC=Object.create(null);Object.keys(mu).forEach(n=>{CC[mu[n]]=n});const h$={type:"error",data:"parser error"},d$="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),f$="function"==typeof ArrayBuffer,yB=(n,e)=>{const t=new FileReader;return t.onload=function(){const i=t.result.split(",")[1];e("b"+i)},t.readAsDataURL(n)},_B=({type:n,data:e},t,i)=>d$&&e instanceof Blob?t?i(e):yB(e,i):f$&&(e instanceof ArrayBuffer||(n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer)(e))?t?i(e):yB(new Blob([e]),i):i(mu[n]+(e||"")),L_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tb="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let n=0;n<L_.length;n++)tb[L_.charCodeAt(n)]=n;const y$="function"==typeof ArrayBuffer,v$=(n,e)=>{if(y$){const t=(n=>{let i,o,l,c,d,e=.75*n.length,t=n.length,r=0;"="===n[n.length-1]&&(e--,"="===n[n.length-2]&&e--);const p=new ArrayBuffer(e),y=new Uint8Array(p);for(i=0;i<t;i+=4)o=tb[n.charCodeAt(i)],l=tb[n.charCodeAt(i+1)],c=tb[n.charCodeAt(i+2)],d=tb[n.charCodeAt(i+3)],y[r++]=o<<2|l>>4,y[r++]=(15&l)<<4|c>>2,y[r++]=(3&c)<<6|63&d;return p})(n);return vB(t,e)}return{base64:!0,data:n}},vB=(n,e)=>"blob"===e&&n instanceof ArrayBuffer?new Blob([n]):n,xB=(n,e)=>{if("string"!=typeof n)return{type:"message",data:vB(n,e)};const t=n.charAt(0);return"b"===t?{type:"message",data:v$(n.substring(1),e)}:CC[t]?n.length>1?{type:CC[t],data:n.substring(1)}:{type:CC[t]}:h$},bB=String.fromCharCode(30);function Ys(n){if(n)return function w$(n){for(var e in Ys.prototype)n[e]=Ys.prototype[e];return n}(n)}Ys.prototype.on=Ys.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this},Ys.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this},Ys.prototype.off=Ys.prototype.removeListener=Ys.prototype.removeAllListeners=Ys.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(var i,r=0;r<t.length;r++)if((i=t[r])===e||i.fn===e){t.splice(r,1);break}return 0===t.length&&delete this._callbacks["$"+n],this},Ys.prototype.emitReserved=Ys.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t){i=0;for(var r=(t=t.slice(0)).length;i<r;++i)t[i].apply(this,e)}return this},Ys.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},Ys.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Ff="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function MB(n,...e){return e.reduce((t,i)=>(n.hasOwnProperty(i)&&(t[i]=n[i]),t),{})}const M$=setTimeout,S$=clearTimeout;function TC(n,e){e.useNativeTimers?(n.setTimeoutFn=M$.bind(Ff),n.clearTimeoutFn=S$.bind(Ff)):(n.setTimeoutFn=setTimeout.bind(Ff),n.clearTimeoutFn=clearTimeout.bind(Ff))}function C$(n){return"string"==typeof n?function T$(n){let e=0,t=0;for(let i=0,r=n.length;i<r;i++)e=n.charCodeAt(i),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(i++,t+=4);return t}(n):Math.ceil(1.33*(n.byteLength||n.size))}class A$ extends Error{constructor(e,t,i){super(e),this.description=t,this.context=i,this.type="TransportError"}}class SB extends Ys{constructor(e){super(),this.writable=!1,TC(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,i){return super.emitReserved("error",new A$(e,t,i)),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=xB(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const EB="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),CB={};let AB,TB=0,Nf=0;function DB(n){let e="";do{e=EB[n%64]+e,n=Math.floor(n/64)}while(n>0);return e}function RB(){const n=DB(+new Date);return n!==AB?(TB=0,AB=n):n+"."+DB(TB++)}for(;Nf<64;Nf++)CB[EB[Nf]]=Nf;function PB(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}let IB=!1;try{IB="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){}const R$=IB;function LB(n){const e=n.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||R$))return new XMLHttpRequest}catch(t){}if(!e)try{return new(Ff[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function P$(){}const I$=null!=new LB({xdomain:!1}).responseType;let DC=(()=>{class n extends Ys{constructor(t,i){super(),TC(this,i),this.opts=i,this.method=i.method||"GET",this.uri=t,this.async=!1!==i.async,this.data=void 0!==i.data?i.data:null,this.create()}create(){const t=MB(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const i=this.xhr=new LB(t);try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{i.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(r){return void this.setTimeoutFn(()=>{this.onError(r)},0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(null!=this.xhr){if(this.xhr.onreadystatechange=P$,t)try{this.xhr.abort()}catch(i){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return n.requestsCount=0,n.requests={},n})();function FB(){for(let n in DC.requests)DC.requests.hasOwnProperty(n)&&DC.requests[n].abort()}"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",FB):"function"==typeof addEventListener&&addEventListener("onpagehide"in Ff?"pagehide":"unload",FB,!1));const F$="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),RC=Ff.WebSocket||Ff.MozWebSocket,NB="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),k$={websocket:class O$ extends SB{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,i=NB?{}:MB(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=NB?new RC(e,t,i):t?new RC(e,t):new RC(e)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=t===e.length-1;_B(e[t],this.supportsBinary,o=>{try{this.ws.send(o)}catch(c){}r&&F$(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let i="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=RB()),this.supportsBinary||(e.b64=1);const r=PB(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(r.length?"?"+r:"")}check(){return!!RC}},polling:class L$ extends SB{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const i="https:"===location.protocol;let r=location.port;r||(r=i?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==i}this.supportsBinary=I$&&!(e&&e.forceBase64)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let i=0;this.polling&&(i++,this.once("pollComplete",function(){--i||t()})),this.writable||(i++,this.once("drain",function(){--i||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((n,e)=>{const t=n.split(bB),i=[];for(let r=0;r<t.length;r++){const o=xB(t[r],e);if(i.push(o),"error"===o.type)break}return i})(e,this.socket.binaryType).forEach(i=>{if("opening"===this.readyState&&"open"===i.type&&this.onOpen(),"close"===i.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((n,e)=>{const t=n.length,i=new Array(t);let r=0;n.forEach((o,l)=>{_B(o,!1,c=>{i[l]=c,++r===t&&e(i.join(bB))})})})(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let i="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=RB()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port);const r=PB(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(r.length?"?"+r:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new DC(this.uri(),e)}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(r,o)=>{this.onError("xhr post error",r,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,i)=>{this.onError("xhr poll error",t,i)}),this.pollXhr=e}}},B$=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,U$=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function tI(n){const e=n,t=n.indexOf("["),i=n.indexOf("]");-1!=t&&-1!=i&&(n=n.substring(0,t)+n.substring(t,i).replace(/:/g,";")+n.substring(i,n.length));let r=B$.exec(n||""),o={},l=14;for(;l--;)o[U$[l]]=r[l]||"";return-1!=t&&-1!=i&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function V$(n,e){const i=e.replace(/\/{2,9}/g,"/").split("/");return("/"==e.substr(0,1)||0===e.length)&&i.splice(0,1),"/"==e.substr(e.length-1,1)&&i.splice(i.length-1,1),i}(0,o.path),o.queryKey=function z$(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,r,o){r&&(t[r]=o)}),t}(0,o.query),o}let OB=(()=>{class n extends Ys{constructor(t,i={}){super(),t&&"object"==typeof t&&(i=t,t=null),t?(t=tI(t),i.hostname=t.host,i.secure="https"===t.protocol||"wss"===t.protocol,i.port=t.port,t.query&&(i.query=t.query)):i.host&&(i.hostname=tI(i.host).host),TC(this,i),this.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=i.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function D$(n){let e={},t=n.split("&");for(let i=0,r=t.length;i<r;i++){let o=t[i].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const i=Object.assign({},this.opts.query);i.EIO=4,i.transport=t,this.id&&(i.sid=this.id);const r=Object.assign({},this.opts.transportOptions[t],this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new k$[t](r)}open(){let t;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(i){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(t){let i=this.createTransport(t),r=!1;n.priorWebsocketSuccess=!1;const o=()=>{r||(i.send([{type:"ping",data:"probe"}]),i.once("packet",x=>{if(!r)if("pong"===x.type&&"probe"===x.data){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;n.priorWebsocketSuccess="websocket"===i.name,this.transport.pause(()=>{r||"closed"!==this.readyState&&(v(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const b=new Error("probe error");b.transport=i.name,this.emitReserved("upgradeError",b)}}))};function l(){r||(r=!0,v(),i.close(),i=null)}const c=x=>{const b=new Error("probe error: "+x);b.transport=i.name,l(),this.emitReserved("upgradeError",b)};function d(){c("transport closed")}function p(){c("socket closed")}function y(x){i&&x.name!==i.name&&l()}const v=()=>{i.removeListener("open",o),i.removeListener("error",c),i.removeListener("close",d),this.off("close",p),this.off("upgrading",y)};i.once("open",o),i.once("error",c),i.once("close",d),this.once("close",p),this.once("upgrading",y),i.open()}onOpen(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const i=this.upgrades.length;for(;t<i;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=t.data,this.onError(i);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let r=0;r<this.writeBuffer.length;r++){const o=this.writeBuffer[r].data;if(o&&(i+=C$(o)),r>0&&i>this.maxPayload)return this.writeBuffer.slice(0,r);i+=2}return this.writeBuffer}write(t,i,r){return this.sendPacket("message",t,i,r),this}send(t,i,r){return this.sendPacket("message",t,i,r),this}sendPacket(t,i,r,o){if("function"==typeof i&&(o=i,i=void 0),"function"==typeof r&&(o=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const l={type:t,data:i,options:r};this.emitReserved("packetCreate",l),this.writeBuffer.push(l),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),t()},r=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){n.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,i){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const i=[];let r=0;const o=t.length;for(;r<o;r++)~this.transports.indexOf(t[r])&&i.push(t[r]);return i}}return n.protocol=4,n})();const G$="function"==typeof ArrayBuffer,kB=Object.prototype.toString,q$="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===kB.call(Blob),j$="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===kB.call(File);function nI(n){return G$&&(n instanceof ArrayBuffer||(n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer)(n))||q$&&n instanceof Blob||j$&&n instanceof File}function PC(n,e){if(!n||"object"!=typeof n)return!1;if(Array.isArray(n)){for(let t=0,i=n.length;t<i;t++)if(PC(n[t]))return!0;return!1}if(nI(n))return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return PC(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&PC(n[t]))return!0;return!1}function X$(n){const e=[],i=n;return i.data=iI(n.data,e),i.attachments=e.length,{packet:i,buffers:e}}function iI(n,e){if(!n)return n;if(nI(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}if(Array.isArray(n)){const t=new Array(n.length);for(let i=0;i<n.length;i++)t[i]=iI(n[i],e);return t}if("object"==typeof n&&!(n instanceof Date)){const t={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=iI(n[i],e));return t}return n}function $$(n,e){return n.data=rI(n.data,e),n.attachments=void 0,n}function rI(n,e){if(!n)return n;if(n&&n._placeholder)return e[n.num];if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=rI(n[t],e);else if("object"==typeof n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=rI(n[t],e));return n}const BB=5;var Wi=(()=>{return(n=Wi||(Wi={}))[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK",Wi;var n})();class Y${constructor(e){this.replacer=e}encode(e){return e.type!==Wi.EVENT&&e.type!==Wi.ACK||!PC(e)?[this.encodeAsString(e)]:(e.type=e.type===Wi.EVENT?Wi.BINARY_EVENT:Wi.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return(e.type===Wi.BINARY_EVENT||e.type===Wi.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=X$(e),i=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(i),r}}class sI extends Ys{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===Wi.BINARY_EVENT||t.type===Wi.BINARY_ACK?(this.reconstructor=new K$(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else{if(!nI(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(void 0===Wi[i.type])throw new Error("unknown packet type "+i.type);if(i.type===Wi.BINARY_EVENT||i.type===Wi.BINARY_ACK){const o=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const l=e.substring(o,t);if(l!=Number(l)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(l)}if("/"===e.charAt(t+1)){const o=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);i.nsp=e.substring(o,t)}else i.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const o=t+1;for(;++t;){const l=e.charAt(t);if(null==l||Number(l)!=l){--t;break}if(t===e.length)break}i.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(!sI.isPayloadValid(i.type,o))throw new Error("invalid payload");i.data=o}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Wi.CONNECT:return"object"==typeof t;case Wi.DISCONNECT:return void 0===t;case Wi.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case Wi.EVENT:case Wi.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case Wi.ACK:case Wi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class K${constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=$$(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Dc(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const Z$=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class oI extends Ys{constructor(e,t,i){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,i&&i.auth&&(this.auth=i.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Dc(e,"open",this.onopen.bind(this)),Dc(e,"packet",this.onpacket.bind(this)),Dc(e,"error",this.onerror.bind(this)),Dc(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Z$.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const i={type:Wi.EVENT,data:t,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const l=this.ids++,c=t.pop();this._registerAckCallback(l,c),i.id=l}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){const i=this.flags.timeout;if(void 0===i)return void(this.acks[e]=t);const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(r),t.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this.packet({type:Wi.CONNECT,data:e})}):this.packet({type:Wi.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Wi.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Wi.EVENT:case Wi.BINARY_EVENT:this.onevent(e);break;case Wi.ACK:case Wi.BINARY_ACK:this.onack(e);break;case Wi.DISCONNECT:this.ondisconnect();break;case Wi.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t)i.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let i=!1;return function(...r){i||(i=!0,t.packet({type:Wi.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Wi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const i of t)i.apply(this,e.data)}}}function F_(n){this.ms=(n=n||{}).min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}F_.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=0==(1&Math.floor(10*e))?n-t:n+t}return 0|Math.min(n,this.max)},F_.prototype.reset=function(){this.attempts=0},F_.prototype.setMin=function(n){this.ms=n},F_.prototype.setMax=function(n){this.max=n},F_.prototype.setJitter=function(n){this.jitter=n};class IC extends Ys{constructor(e,t){var i;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,TC(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=t.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new F_({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||uo;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new OB(this.uri,this.opts);const t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const r=Dc(t,"open",function(){i.onopen(),e&&e()}),o=Dc(t,"error",l=>{i.cleanup(),i._readyState="closed",this.emitReserved("error",l),e?e(l):i.maybeReconnectOnOpen()});if(!1!==this._timeout){const l=this._timeout;0===l&&r();const c=this.setTimeoutFn(()=>{r(),t.close(),t.emit("error",new Error("timeout"))},l);this.opts.autoUnref&&c.unref(),this.subs.push(function(){clearTimeout(c)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Dc(e,"ping",this.onping.bind(this)),Dc(e,"data",this.ondata.bind(this)),Dc(e,"error",this.onerror.bind(this)),Dc(e,"close",this.onclose.bind(this)),Dc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i||(i=new oI(this,e,t),this.nsps[e]=i),i}_destroy(e){const t=Object.keys(this.nsps);for(const i of t)if(this.nsps[i].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},t);this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const nb={};function Of(n,e){"object"==typeof n&&(e=n,n=void 0);const t=function H$(n,e="",t){let i=n;t=t||"undefined"!=typeof location&&location,null==n&&(n=t.protocol+"//"+t.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?t.protocol+n:t.host+n),/^(https?|wss?):\/\//.test(n)||(n=void 0!==t?t.protocol+"//"+n:"https://"+n),i=tI(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const o=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port+e,i.href=i.protocol+"://"+o+(t&&t.port===i.port?"":":"+i.port),i}(n,(e=e||{}).path||"/socket.io"),i=t.source,r=t.id;let d;return e.forceNew||e["force new connection"]||!1===e.multiplex||nb[r]&&t.path in nb[r].nsps?d=new IC(i,e):(nb[r]||(nb[r]=new IC(i,e)),d=nb[r]),t.query&&!e.query&&(e.query=t.queryKey),d.socket(t.path,e)}Object.assign(Of,{Manager:IC,Socket:oI,io:Of,connect:Of});class aI{constructor(e){this.config=e,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===e&&(e=this.emptyConfig),this.ioSocket=(Of||fr)(e.url,e.options)}of(e){this.ioSocket.of(e)}on(e,t){this.ioSocket.on(e,t)}once(e,t){this.ioSocket.once(e,t)}connect(){return this.ioSocket.connect()}disconnect(e){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(e,...t){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(e,t){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(e){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(e){return this.subscribersCounter[e]||(this.subscribersCounter[e]=0),this.subscribersCounter[e]++,this.eventObservables$[e]||(this.eventObservables$[e]=new pr(t=>{const i=r=>{t.next(r)};return this.ioSocket.on(e,i),()=>{this.subscribersCounter[e]--,0===this.subscribersCounter[e]&&(this.ioSocket.removeListener(e,i),delete this.eventObservables$[e])}}).pipe(xg())),this.eventObservables$[e]}fromOneTimeEvent(e){return new Promise(t=>this.once(e,t))}}function J$(n){return new aI(n)}const UB=new Xn("__SOCKET_IO_CONFIG__");let Q$=(()=>{class n{static forRoot(t){return{ngModule:n,providers:[{provide:UB,useValue:t},{provide:aI,useFactory:J$,deps:[UB]}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})(),LC=(()=>{class n{constructor(t){this.socket=t}sendCameraState(t,i){this.sendMessage(n.cameraSyncEvent,JSON.stringify({sceneId:t,state:i}))}startAnimation(t,i,r){this.sendMessage(n.startAnimationEvent,JSON.stringify({sceneId:t,animationName:i,running:r}))}sendMessage(t,i){this.socket.emit(t,i)}getMessage(t){return this.socket.fromEvent(t).pipe(Pn(i=>i))}connect(){this.isConnected()?console.info("[WS]: Socket already connected"):(this.socket.connect(),console.info("[WS]: Connected the socket."))}disconnect(){this.isConnected()?(this.socket.disconnect(),console.info("[WS]: Disconnected the socket.")):console.info("[WS]: Socket already disconnected.")}isConnected(){return this.socket.ioSocket.connected}}return n.cameraSyncEvent="camera_sync",n.startAnimationEvent="start_animation",n.getAnimationEvent="animation",n.\u0275fac=function(t){return new(t||n)(Ot(aI))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wn={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},vr={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},ci={x:0,y:0},hl={camera:new Tt,gizmos:new Tt},Fr={type:"change"},Rc={type:"start"},Xl={type:"end"},eY=new class o${constructor(e,t,i=0,r=1/0){this.ray=new wf(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new QR,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return KP(e,this,i,t),i.sort(tB),i}intersectObjects(e,t=!0,i=[]){for(let r=0,o=e.length;r<o;r++)KP(e[r],this,i,t);return i.sort(tB),i}},Ks=new $,VB=new Tt,zB=new Tt,Pc=new $;class tY extends _f{constructor(e,t,i=null){super(),on(this,"onWindowResize",()=>{const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.camera);const t=this._tbRadius/e,r=new Af(0,0,t,t).getPoints(this._curvePts),o=(new Tn).setFromPoints(r);for(const l in this._gizmos.children)this._gizmos.children[l].geometry=o;this.dispatchEvent(Fr)}),on(this,"onContextMenu",e=>{if(this.enabled)for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}),on(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=vr.NONE}),on(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e),this._downStart=performance.now()):this._downValid=!1,"touch"==e.pointerType&&this._input!=vr.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case vr.NONE:this._input=vr.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case vr.ONE_FINGER:case vr.ONE_FINGER_SWITCHED:this._input=vr.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case vr.TWO_FINGER:this._input=vr.MULT_FINGER,this.onTriplePanStart(e)}else if("touch"!=e.pointerType&&this._input==vr.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),null!=this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=vr.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),on(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=vr.CURSOR)switch(this._input){case vr.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,wn.ROTATE);break;case vr.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility){this._input=vr.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE");break}break;case vr.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case vr.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove(e)}else if("touch"!=e.pointerType&&this._input==vr.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const i=this.getOpStateFromAction(this._button,t);null!=i&&this.onSinglePanMove(e,i)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),on(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=vr.CURSOR){const t=this._touchCurrent.length;for(let i=0;i<t;i++)if(this._touchCurrent[i].pointerId==e.pointerId){this._touchCurrent.splice(i,1),this._touchStart.splice(i,1);break}switch(this._input){case vr.ONE_FINGER:case vr.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=vr.NONE,this.onSinglePanEnd();break;case vr.TWO_FINGER:this.onDoublePanEnd(e),this.onPinchEnd(e),this.onRotateEnd(e),this._input=vr.ONE_FINGER_SWITCHED;break;case vr.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=vr.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==vr.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=vr.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary)if(this._downValid)if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const i=e.timeStamp-this._clickStart,r=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;i<=this._maxInterval&&r<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),on(this,"onWheel",e=>{if(this.enabled&&this.enableZoom){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const i=this.getOpFromAction("WHEEL",t);if(null!=i){e.preventDefault(),this.dispatchEvent(Rc);const r=125;let o=e.deltaY/r,l=1;switch(o>0?l=1/this.scaleFactor:o<0&&(l=this.scaleFactor),i){case"ZOOM":if(this.updateTbState(wn.SCALE,!0),o>0?l=1/Math.pow(this.scaleFactor,o):o<0&&(l=Math.pow(this.scaleFactor,-o)),this.cursorZoom&&this.enablePan){let c;this.camera.isOrthographicCamera?c=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(c=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(l,c))}else this.applyTransformMatrix(this.scale(l,this._gizmos.position));null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Fr),this.dispatchEvent(Xl);break;case"FOV":if(this.camera.isPerspectiveCamera){this.updateTbState(wn.FOV,!0),0!=e.deltaX&&(o=e.deltaX/r,l=1,o>0?l=1/Math.pow(this.scaleFactor,o):o<0&&(l=Math.pow(this.scaleFactor,-o))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const c=this._v3_1.distanceTo(this._gizmos.position);let d=c/l;d=ts.clamp(d,this.minDistance,this.maxDistance);const p=c*Math.tan(ts.DEG2RAD*this.camera.fov*.5);let y=ts.RAD2DEG*(2*Math.atan(p/d));y>this.maxFov?y=this.maxFov:y<this.minFov&&(y=this.minFov),l=c/(p/Math.tan(ts.DEG2RAD*(y/2))),this.setFov(y),this.applyTransformMatrix(this.scale(l,this._gizmos.position,!1))}null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Fr),this.dispatchEvent(Xl)}}}}),on(this,"onSinglePanStart",(e,t)=>{if(this.enabled)switch(this.dispatchEvent(Rc),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Fr)),this.updateTbState(wn.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(Fr));break;case"ROTATE":if(!this.enableRotate)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(wn.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ci.x,ci.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(Fr);break;case"FOV":if(!this.camera.isPerspectiveCamera||!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Fr)),this.updateTbState(wn.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Fr)),this.updateTbState(wn.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),on(this,"onSinglePanMove",(e,t)=>{if(this.enabled){const i=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case wn.PAN:this.enablePan&&(i?(this.dispatchEvent(Xl),this.dispatchEvent(Rc),this.updateTbState(t,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case wn.ROTATE:if(this.enableRotate)if(i)this.dispatchEvent(Xl),this.dispatchEvent(Rc),this.updateTbState(t,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ci.x,ci.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ci.x,ci.y,this.domElement,this._tbRadius));const r=this._startCursorPosition.distanceTo(this._currentCursorPosition),o=this._startCursorPosition.angleTo(this._currentCursorPosition),l=Math.max(r/this._tbRadius,o);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),l)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=l,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case wn.SCALE:if(this.enableZoom)if(i)this.dispatchEvent(Xl),this.dispatchEvent(Rc),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;o<0?l=1/Math.pow(this.scaleFactor,8*-o):o>0&&(l=Math.pow(this.scaleFactor,8*o)),this.applyTransformMatrix(this.scale(l,this._gizmos.position))}break;case wn.FOV:if(this.enableZoom&&this.camera.isPerspectiveCamera)if(i)this.dispatchEvent(Xl),this.dispatchEvent(Rc),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;o<0?l=1/Math.pow(this.scaleFactor,8*-o):o>0&&(l=Math.pow(this.scaleFactor,8*o)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const c=this._v3_1.distanceTo(this._gizmos.position);let d=c/l;d=ts.clamp(d,this.minDistance,this.maxDistance);const p=c*Math.tan(ts.DEG2RAD*this._fovState*.5);let y=ts.RAD2DEG*(2*Math.atan(p/d));y=ts.clamp(y,this.minFov,this.maxFov);const v=p/Math.tan(ts.DEG2RAD*(y/2));l=c/v,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(y),this.applyTransformMatrix(this.scale(l,this._v3_2,!1)),Ks.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(v/c),this._m4_1.makeTranslation(Ks.x,Ks.y,Ks.z)}}this.dispatchEvent(Fr)}}),on(this,"onSinglePanEnd",()=>{if(this._state==wn.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const t=Math.abs((this._wPrev+this._wCurr)/2),i=this;this._animationId=window.requestAnimationFrame(function(r){i.updateTbState(wn.ANIMATION_ROTATE,!0);const o=i.calculateRotationAxis(i._cursorPosPrev,i._cursorPosCurr);i.onRotationAnim(r,o,Math.min(t,i.wMax))})}else this.updateTbState(wn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Fr);else this.updateTbState(wn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Fr)}else(this._state==wn.PAN||this._state==wn.IDLE)&&(this.updateTbState(wn.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(Fr));this.dispatchEvent(Xl)}),on(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&null!=this.scene){this.dispatchEvent(Rc),this.setCenter(e.clientX,e.clientY);const t=this.unprojectOnObj(this.getCursorNDC(ci.x,ci.y,this.domElement),this.camera);if(null!=t&&this.enableAnimations){const i=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(r){i.updateTbState(wn.ANIMATION_FOCUS,!0),i.onFocusAnim(r,t,i._cameraMatrixState,i._gizmoMatrixState)})}else null!=t&&!this.enableAnimations&&(this.updateTbState(wn.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Fr))}this.dispatchEvent(Xl)}),on(this,"onDoublePanStart",()=>{this.enabled&&this.enablePan&&(this.dispatchEvent(Rc),this.updateTbState(wn.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))}),on(this,"onDoublePanMove",()=>{this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=wn.PAN&&(this.updateTbState(wn.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(Fr))}),on(this,"onDoublePanEnd",()=>{this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Xl)}),on(this,"onRotateStart",()=>{this.enabled&&this.enableRotate&&(this.dispatchEvent(Rc),this.updateTbState(wn.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.camera.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}),on(this,"onRotateMove",()=>{if(this.enabled&&this.enableRotate){let e;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=wn.ZROTATE&&(this.updateTbState(wn.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),e=this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):e=(new $).setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.zRotate(e,ts.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation))),this.dispatchEvent(Fr)}}),on(this,"onRotateEnd",()=>{this.updateTbState(wn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Xl)}),on(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(Rc),this.updateTbState(wn.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),on(this,"onPinchMove",()=>{if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const e=12;this._state!=wn.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(wn.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),e*this._devPxRatio);const t=this._currentFingerDistance/this._startFingerDistance;let i;this.enablePan?this.camera.isOrthographicCamera?i=this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(i=this.unprojectOnTbPlane(this.camera,ci.x,ci.y,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):i=this._gizmos.position,this.applyTransformMatrix(this.scale(t,i)),this.dispatchEvent(Fr)}}),on(this,"onPinchEnd",()=>{this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Xl)}),on(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom){this.dispatchEvent(Rc),this.updateTbState(wn.SCALE,!0);let e=0,t=0;const i=this._touchCurrent.length;for(let r=0;r<i;r++)e+=this._touchCurrent[r].clientX,t+=this._touchCurrent[r].clientY;this.setCenter(e/i,t/i),this._startCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),on(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom){let e=0,t=0;const i=this._touchCurrent.length;for(let x=0;x<i;x++)e+=this._touchCurrent[x].clientX,t+=this._touchCurrent[x].clientY;this.setCenter(e/i,t/i);const r=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(ci.x,ci.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;o<0?l=1/Math.pow(this.scaleFactor,-o*r):o>0&&(l=Math.pow(this.scaleFactor,o*r)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const c=this._v3_1.distanceTo(this._gizmos.position);let d=c/l;d=ts.clamp(d,this.minDistance,this.maxDistance);const p=c*Math.tan(ts.DEG2RAD*this._fovState*.5);let y=ts.RAD2DEG*(2*Math.atan(p/d));y=ts.clamp(y,this.minFov,this.maxFov);const v=p/Math.tan(ts.DEG2RAD*(y/2));l=c/v,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(y),this.applyTransformMatrix(this.scale(l,this._v3_2,!1)),Ks.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(v/c),this._m4_1.makeTranslation(Ks.x,Ks.y,Ks.z),this.dispatchEvent(Fr)}}),on(this,"onTriplePanEnd",()=>{this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Xl)}),on(this,"setCenter",(e,t)=>{ci.x=e,ci.y=t}),on(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),on(this,"compareMouseAction",(e,t)=>e.operation==t.operation&&e.mouse==t.mouse&&e.key==t.key),on(this,"setMouseAction",(e,t,i=null)=>{let c;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(i)||"WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":c=wn.PAN;break;case"ROTATE":c=wn.ROTATE;break;case"ZOOM":c=wn.SCALE;break;case"FOV":c=wn.FOV}const d={operation:e,mouse:t,key:i,state:c};for(let p=0;p<this.mouseActions.length;p++)if(this.mouseActions[p].mouse==d.mouse&&this.mouseActions[p].key==d.key)return this.mouseActions.splice(p,1,d),!0;return this.mouseActions.push(d),!0}),on(this,"unsetMouseAction",(e,t=null)=>{for(let i=0;i<this.mouseActions.length;i++)if(this.mouseActions[i].mouse==e&&this.mouseActions[i].key==t)return this.mouseActions.splice(i,1),!0;return!1}),on(this,"getOpFromAction",(e,t)=>{let i;for(let r=0;r<this.mouseActions.length;r++)if(i=this.mouseActions[r],i.mouse==e&&i.key==t)return i.operation;if(null!=t)for(let r=0;r<this.mouseActions.length;r++)if(i=this.mouseActions[r],i.mouse==e&&null==i.key)return i.operation;return null}),on(this,"getOpStateFromAction",(e,t)=>{let i;for(let r=0;r<this.mouseActions.length;r++)if(i=this.mouseActions[r],i.mouse==e&&i.key==t)return i.state;if(null!=t)for(let r=0;r<this.mouseActions.length;r++)if(i=this.mouseActions[r],i.mouse==e&&null==i.key)return i.state;return null}),on(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),on(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),on(this,"calculateAngularSpeed",(e,t,i,r)=>{const l=(r-i)/1e3;return 0==l?0:(t-e)/l}),on(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),on(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),on(this,"calculateTbRadius",e=>{const t=e.position.distanceTo(this._gizmos.position);if("PerspectiveCamera"==e.type){const i=ts.DEG2RAD*e.fov*.5,r=Math.atan(e.aspect*Math.tan(i));return Math.tan(Math.min(i,r))*t*this.radiusFactor}if("OrthographicCamera"==e.type)return Math.min(e.top,e.right)*this.radiusFactor}),on(this,"focus",(e,t,i=1)=>{Ks.copy(e).sub(this._gizmos.position).multiplyScalar(i),this._translationMatrix.makeTranslation(Ks.x,Ks.y,Ks.z),VB.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),zB.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(t,this._gizmos.position)),this._gizmoMatrixState.copy(VB),this._cameraMatrixState.copy(zB)}),on(this,"drawGrid",()=>{if(null!=this.scene){let i,r,o,l;if(this.camera.isOrthographicCamera)o=Math.max(this.camera.right-this.camera.left,this.camera.bottom-this.camera.top),l=o/20,i=o/this.camera.zoom*3,r=i/l*this.camera.zoom;else if(this.camera.isPerspectiveCamera){const c=this.camera.position.distanceTo(this._gizmos.position),d=ts.DEG2RAD*this.camera.fov*.5,p=Math.atan(this.camera.aspect*Math.tan(d));o=Math.tan(Math.max(d,p))*c*2,l=o/20,i=3*o,r=i/l}null==this._grid&&(this._grid=new cB(i,r,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),on(this,"dispose",()=>{-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onWheel),this.domElement.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null!==this.scene&&this.scene.remove(this._gizmos),this.disposeGrid()}),on(this,"disposeGrid",()=>{null!=this._grid&&null!=this.scene&&(this.scene.remove(this._grid),this._grid=null)}),on(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),on(this,"activateGizmos",e=>{const t=this._gizmos.children[0],i=this._gizmos.children[1],r=this._gizmos.children[2];e?(t.material.setValues({opacity:1}),i.material.setValues({opacity:1}),r.material.setValues({opacity:1})):(t.material.setValues({opacity:.6}),i.material.setValues({opacity:.6}),r.material.setValues({opacity:.6}))}),on(this,"getCursorNDC",(e,t,i)=>{const r=i.getBoundingClientRect();return this._v2_1.setX((e-r.left)/r.width*2-1),this._v2_1.setY((r.bottom-t)/r.height*2-1),this._v2_1.clone()}),on(this,"getCursorPosition",(e,t,i)=>(this._v2_1.copy(this.getCursorNDC(e,t,i)),this._v2_1.x*=.5*(this.camera.right-this.camera.left),this._v2_1.y*=.5*(this.camera.top-this.camera.bottom),this._v2_1.clone())),on(this,"setCamera",e=>{e.lookAt(this.target),e.updateMatrix(),"PerspectiveCamera"==e.type&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(e),this.makeGizmos(this.target,this._tbRadius)}),on(this,"makeGizmos",(e,t)=>{const r=new Af(0,0,t,t).getPoints(this._curvePts),o=(new Tn).setFromPoints(r),l=new $s({color:16744576,fog:!1,transparent:!0,opacity:.6}),c=new $s({color:8454016,fog:!1,transparent:!0,opacity:.6}),d=new $s({color:8421631,fog:!1,transparent:!0,opacity:.6}),p=new du(o,l),y=new du(o,c),v=new du(o,d),x=.5*Math.PI;if(p.rotation.x=x,y.rotation.y=x,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),1!=this.camera.zoom){const b=1/this.camera.zoom;this._scaleMatrix.makeScale(b,b,b),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(p),this._gizmos.add(y),this._gizmos.add(v)}),on(this,"onFocusAnim",(e,t,i,r)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==wn.ANIMATION_FOCUS){const l=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(r),l>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(wn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Fr);else{const c=this.easeOutCubic(l),d=1-c+this.scaleFactor*c;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,d,c),this.dispatchEvent(Fr);const p=this;this._animationId=window.requestAnimationFrame(function(y){p.onFocusAnim(y,t,i,r.clone())})}}else this._animationId=-1,this._timeStart=-1}),on(this,"onRotationAnim",(e,t,i)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==wn.ANIMATION_ROTATE){const r=(e-this._timeStart)/1e3;if(i+-this.dampingFactor*r>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(r,2)+i*r+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(Fr);const l=this;this._animationId=window.requestAnimationFrame(function(c){l.onRotationAnim(c,t,i)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(wn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Fr)}else this._animationId=-1,this._timeStart=-1,this._state!=wn.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(Fr))}),on(this,"pan",(e,t,i=!1)=>{const r=e.clone().sub(t);if(this.camera.isOrthographicCamera)r.multiplyScalar(1/this.camera.zoom);else if(this.camera.isPerspectiveCamera&&i){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const o=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);r.multiplyScalar(1/o)}return this._v3_1.set(r.x,r.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),hl}),on(this,"reset",()=>{this.camera.zoom=this._zoom0,this.camera.isPerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Fr)}),on(this,"rotate",(e,t)=>{const i=this._gizmos.position;return this._translationMatrix.makeTranslation(-i.x,-i.y,-i.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),hl}),on(this,"copyState",()=>{let e;this.camera.isOrthographicCamera?e=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}):this.camera.isPerspectiveCamera&&(e=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}})),navigator.clipboard.writeText(e)}),on(this,"pasteState",()=>{const e=this;navigator.clipboard.readText().then(function(i){e.setStateFromJSON(i)})}),on(this,"saveState",()=>{this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera.isPerspectiveCamera&&(this._fov0=this.camera.fov)}),on(this,"scale",(e,t,i=!0)=>{Pc.copy(t);let r=1/e;if(this.camera.isOrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,r=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,r=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(r,r,r),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),Pc.sub(this._v3_1);const o=Pc.clone().multiplyScalar(r);return Pc.sub(o),this._m4_1.makeTranslation(Pc.x,Pc.y,Pc.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),hl}if(this.camera.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let o=this._v3_1.distanceTo(Pc),l=o-o*r;const c=o-l;if(c<this.minDistance?(r=this.minDistance/o,l=o-o*r):c>this.maxDistance&&(r=this.maxDistance/o,l=o-o*r),Ks.copy(Pc).sub(this._v3_1).normalize().multiplyScalar(l),this._m4_1.makeTranslation(Ks.x,Ks.y,Ks.z),i){const d=this._v3_2;o=d.distanceTo(Pc),l=o-o*r,Ks.copy(Pc).sub(this._v3_2).normalize().multiplyScalar(l),this._translationMatrix.makeTranslation(d.x,d.y,d.z),this._scaleMatrix.makeScale(r,r,r),this._m4_2.makeTranslation(Ks.x,Ks.y,Ks.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-d.x,-d.y,-d.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return hl}}),on(this,"setFov",e=>{this.camera.isPerspectiveCamera&&(this.camera.fov=ts.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),on(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),hl)),on(this,"unprojectOnObj",(e,t)=>{const i=this.getRaycaster();i.near=t.near,i.far=t.far,i.setFromCamera(e,t);const r=i.intersectObjects(this.scene.children,!0);for(let o=0;o<r.length;o++)if(r[o].object.uuid!=this._gizmos.uuid&&null!=r[o].face)return r[o].point.clone();return null}),on(this,"unprojectOnTbSurface",(e,t,i,r,o)=>{if("OrthographicCamera"==e.type){this._v2_1.copy(this.getCursorPosition(t,i,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const l=Math.pow(this._v2_1.x,2),c=Math.pow(this._v2_1.y,2),d=Math.pow(this._tbRadius,2);return this._v3_1.setZ(l+c<=.5*d?Math.sqrt(d-(l+c)):.5*d/Math.sqrt(l+c)),this._v3_1}if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(t,i,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const l=this._v3_1.clone().normalize(),c=e.position.distanceTo(this._gizmos.position),d=Math.pow(o,2),p=this._v3_1.z,y=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==y)return l.set(this._v3_1.x,this._v3_1.y,o),l;const v=p/y,x=c;let b=Math.pow(v,2)+1,S=2*v*x,E=Math.pow(x,2)-d,T=Math.pow(S,2)-4*b*E;if(T>=0&&(this._v2_1.setX((-S-Math.sqrt(T))/(2*b)),this._v2_1.setY(v*this._v2_1.x+x),ts.RAD2DEG*this._v2_1.angle()>=45)){const U=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(c-this._v2_1.y,2));return l.multiplyScalar(U),l.z+=c,l}b=v,S=x,E=.5*-d,T=Math.pow(S,2)-4*b*E,this._v2_1.setX((-S-Math.sqrt(T))/(2*b)),this._v2_1.setY(v*this._v2_1.x+x);const N=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(c-this._v2_1.y,2));return l.multiplyScalar(N),l.z+=c,l}}),on(this,"unprojectOnTbPlane",(e,t,i,r,o=!1)=>{if("OrthographicCamera"==e.type)return this._v2_1.copy(this.getCursorPosition(t,i,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(t,i,r)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const l=this._v3_1.clone().normalize(),c=this._v3_1.z,d=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let p;if(p=o?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==d)return l.set(0,0,0),l;const x=-p/(c/d),b=Math.sqrt(Math.pow(p,2)+Math.pow(x,2));return l.multiplyScalar(b),l.z=0,l}}),on(this,"updateMatrixState",()=>{this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera.isOrthographicCamera?(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom):this.camera.isPerspectiveCamera&&(this._fovState=this.camera.fov)}),on(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),on(this,"update",()=>{if(!1===this.target.equals(this._currentTarget)&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.camera.isOrthographicCamera){if(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom){const t=ts.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(t/this.camera.zoom,this._gizmos.position,!0))}}else if(this.camera.isPerspectiveCamera){const t=this.camera.position.distanceTo(this._gizmos.position);if(t>this.maxDistance+1e-6||t<this.minDistance-1e-6){const r=ts.clamp(t,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(r/t,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=ts.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const i=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.camera),i<this._tbRadius-1e-6||i>this._tbRadius+1e-6){const o=this._tbRadius/((this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3),c=new Af(0,0,o,o).getPoints(this._curvePts),d=(new Tn).setFromPoints(c);for(const p in this._gizmos.children)this._gizmos.children[p].geometry=d}}this.camera.lookAt(this._gizmos.position)}),on(this,"setStateFromJSON",e=>{const t=JSON.parse(e);if(null!=t.arcballState){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera.isPerspectiveCamera&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera);const i=(new Tt).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(i),this.camera.lookAt(this._gizmos.position),this.updateTbState(wn.IDLE,!1),this.dispatchEvent(Fr)}}),this.camera=null,this.domElement=t,this.scene=i,this.target=new $,this._currentTarget=new $,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new ct,this._v3_1=new $,this._v3_2=new $,this._m4_1=new Tt,this._m4_2=new Tt,this._quat=new Mo,this._translationMatrix=new Tt,this._rotationMatrix=new Tt,this._scaleMatrix=new Tt,this._rotationAxis=new $,this._cameraMatrixState=new Tt,this._cameraProjectionState=new Tt,this._fovState=1,this._upState=new $,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Tt,this._up0=new $,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Tt,this._gizmoMatrixState0=new Tt,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=vr.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new $,this._startCursorPosition=new $,this._grid=null,this._gridPosition=new $,this._gizmos=new Um,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new $,this._cursorPosCurr=new $,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=wn.IDLE,this.setCamera(e),null!=this.scene&&this.scene.add(this._gizmos),this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("wheel",this.onWheel),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(null!=e.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==wn.ROTATE||this._state==wn.ZROTATE||this._state==wn.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),null!=e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==wn.SCALE||this._state==wn.FOCUS||this._state==wn.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.camera),this.adjustNearFar){const t=this.camera.position.distanceTo(this._gizmos.position),i=new Ko;i.setFromObject(this._gizmos);const r=new uu;i.getBoundingSphere(r);const o=Math.max(this._nearPos0,r.radius+r.center.length()),c=Math.min(o,t-this._initialNear);this.camera.near=t-c;const d=Math.min(this._farPos0,-r.radius+r.center.length()),y=Math.min(d,t-this._initialFar);this.camera.far=t-y,this.camera.updateProjectionMatrix()}else{let t=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,t=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,t=!0),t&&this.camera.updateProjectionMatrix()}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(Fr)}setTbRadius(e){this.radiusFactor=e,this._tbRadius=this.calculateTbRadius(this.camera);const i=new Af(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),r=(new Tn).setFromPoints(i);for(const o in this._gizmos.children)this._gizmos.children[o].geometry=r;this.dispatchEvent(Fr)}setTransformationMatrices(e=null,t=null){null!=e?null!=hl.camera?hl.camera.copy(e):hl.camera=e.clone():hl.camera=null,null!=t?null!=hl.gizmos?hl.gizmos.copy(t):hl.gizmos=t.clone():hl.gizmos=null}getRaycaster(){return eY}}class nY{constructor(e,t,i){this.sceneElementsService=e,this.socket=t,this.http=i,this.renderer=new _r,this.scene=new BE,this.camera=new Eo(45,1,.1,1e3),this.cameraControls=new tY(this.camera,this.renderer.domElement),this.potree=new qm.Potree,this.pointClouds=[],this.renderRequested=!1,this.resize=()=>{if(!this.targetEl)return;const{width:r,height:o}=this.targetEl.getBoundingClientRect();this.camera.aspect=r/o,this.camera.updateProjectionMatrix(),this.renderer.setSize(r,o),this.requestRender()}}initialize(e){this.targetEl||!e||(this.targetEl=e,this.targetEl.appendChild(this.renderer.domElement),this.camera.position.equals(new $(0,0,0))&&(this.camera.position.z=60,this.camera.position.y=10),this.cameraControls.enableZoom=!0,this.cameraControls.enableRotate=!0,this.cameraControls.dampingFactor=.25,this.cameraControls.enableAnimations=!1,this.resize(),window.addEventListener("resize",this.resize),this.cameraControls.addEventListener("change",()=>this.requestRender()),setInterval(()=>{this.requestRender()},100))}destroy(){this.targetEl.removeChild(this.renderer.domElement),this.targetEl=void 0,window.removeEventListener("resize",this.resize),this.pointClouds.map(e=>this.scene.remove(e)),this.pointClouds=[],void 0!==this.reqAnimationFrameHandle&&cancelAnimationFrame(this.reqAnimationFrameHandle)}loadPotreePCO(e,t){return this.potree.loadPointCloud(e,i=>`${t}${i}`).then(i=>(this.scene.add(i),this.pointClouds.push(i),this.requestRender(),i))}loadCameraTrajectory(e){e.cameraFrustums.forEach(t=>{this.loadLineSet(t.lineSet),this.scene.add(t.mesh)}),this.loadLineSet(e.linkingLines)}loadLineSet(e){e.lines.forEach(t=>{this.scene.add(t)}),this.requestRender()}loadDefaultPC(e){return(new c$).loadAsync(e).then(i=>{let r=new u$(i,new C_({vertexColors:!0}));return this.scene.add(r),this.requestRender(),r})}render(){this.renderRequested=!1,this.cameraControls.update(),this.potree.updatePointClouds(this.pointClouds,this.camera,this.renderer),this.renderer.render(this.scene,this.camera)}requestRender(){this.renderRequested||(this.renderRequested=!0,requestAnimationFrame(this.render.bind(this)))}changeBackground(e){this.scene.background=new Ht(e),this.requestRender()}setPointBudget(e){this.potree.pointBudget=e,this.requestRender()}setCameraFOV(e){this.camera.fov=e,this.requestRender()}pickPointTest(){let e;if(!(this.pointClouds.length>0))return;e=this.pointClouds[0];let t=new wf,i=e.pick(this.renderer,this.camera,t);console.log(i)}saveScreenshot(e){this.renderer.render(this.scene,this.camera),this.renderer.domElement.toBlob(t=>{if(t){let i=new FormData;i.append("file",new Blob([t],{type:"image/png"})),this.http.post(this.sceneElementsService.baseUrl+"upload/"+e,i).subscribe(r=>{console.log("Got response"),console.log(r)})}},"image/png",1)}setCameraSync(e){if(e){this.socket.connect();let t=()=>{this.socket.sendCameraState(0,this.getCurrentCameraState())};this.cameraControls.addEventListener("change",t),t(),this.socket.getMessage(LC.cameraSyncEvent).subscribe(i=>{this.setCameraState(i),this.requestRender()})}else this.socket.disconnect()}getCurrentCameraState(){return{position:this.camera.position.toArray(),quaternion:this.camera.quaternion.toArray(),fov:this.camera.fov,near:this.camera.near,far:this.camera.far,up:this.camera.up.toArray(),zoom:this.camera.zoom,lastUpdate:Date.now()}}setCameraState(e){this.camera.position.fromArray(e.position),this.camera.quaternion.fromArray(e.quaternion);let t=(new $).fromArray(e.up);this.camera.up.copy(t),this.camera.near=e.near,this.camera.far=e.far,this.camera.zoom=e.zoom,this.camera.isPerspectiveCamera&&(this.camera.fov=e.fov),this.requestRender()}}var Wa=(()=>{return(n=Wa||(Wa={})).POTREE_POINT_CLOUD="potree_point_cloud",n.DEFAULT_POINT_CLOUD="default_point_cloud",n.LINE_SET="line_set",n.CAMERA_TRAJECTORY="camera_trajectory",n.UNKNOWN="unknown",Wa;var n})();const HB=new Ko,FC=new $;class lI extends jP{constructor(){super(),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Jt([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Jt([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new _C(t,6,1);return this.setAttribute("instanceStart",new ul(i,3,0)),this.setAttribute("instanceEnd",new ul(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new _C(t,6,1);return this.setAttribute("instanceColorStart",new ul(i,3,0)),this.setAttribute("instanceColorEnd",new ul(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new HP(e.geometry)),this}fromLineSegments(e){const t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ko);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),HB.setFromBufferAttribute(t),this.boundingBox.union(HB))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new uu),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let o=0,l=e.count;o<l;o++)FC.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(FC)),FC.fromBufferAttribute(t,o),r=Math.max(r,i.distanceToSquared(FC));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}lI.prototype.isLineSegmentsGeometry=!0,It.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ct(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Ga.line={uniforms:uP.merge([It.common,It.fog,It.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class ib extends ql{constructor(e){super({type:"LineMaterial",uniforms:uP.clone(Ga.line.uniforms),vertexShader:Ga.line.vertexShader,fragmentShader:Ga.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}ib.prototype.isLineMaterial=!0;const GB=new $,WB=new $,ko=new Qi,Bo=new Qi,gu=new Qi,cI=new $,uI=new Tt,Qo=new rB,qB=new $,NC=new Ko,OC=new uu,yu=new Qi;let _u,hI,jB,jm;function XB(n,e,t){return yu.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),yu.multiplyScalar(1/yu.w),yu.x=jm/t.width,yu.y=jm/t.height,yu.applyMatrix4(n.projectionMatrixInverse),yu.multiplyScalar(1/yu.w),Math.abs(Math.max(yu.x,yu.y))}class $B extends Xs{constructor(e=new lI,t=new ib({color:16777215*Math.random()})){super(e,t),this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let l=0,c=0,d=t.count;l<d;l++,c+=2)GB.fromBufferAttribute(t,l),WB.fromBufferAttribute(i,l),r[c]=0===c?0:r[c-1],r[c+1]=r[c]+GB.distanceTo(WB);const o=new _C(r,2,1);return e.setAttribute("instanceDistanceStart",new ul(o,1,0)),e.setAttribute("instanceDistanceEnd",new ul(o,1,1)),this}raycast(e,t){const i=this.material.worldUnits,r=e.camera;null===r&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.'),_u=e.ray;const l=this.matrixWorld,c=this.geometry,d=this.material;let p,y;jm=d.linewidth+(void 0!==e.params.Line2&&e.params.Line2.threshold||0),hI=c.attributes.instanceStart,jB=c.attributes.instanceEnd,null===c.boundingSphere&&c.computeBoundingSphere(),OC.copy(c.boundingSphere).applyMatrix4(l),p=i?.5*jm:XB(r,Math.max(r.near,OC.distanceToPoint(_u.origin)),d.resolution),OC.radius+=p,!1!==_u.intersectsSphere(OC)&&(null===c.boundingBox&&c.computeBoundingBox(),NC.copy(c.boundingBox).applyMatrix4(l),y=i?.5*jm:XB(r,Math.max(r.near,NC.distanceToPoint(_u.origin)),d.resolution),NC.expandByScalar(y),!1!==_u.intersectsBox(NC)&&(i?function iY(n,e){for(let t=0,i=hI.count;t<i;t++){Qo.start.fromBufferAttribute(hI,t),Qo.end.fromBufferAttribute(jB,t);const r=new $,o=new $;_u.distanceSqToSegment(Qo.start,Qo.end,o,r),o.distanceTo(r)<.5*jm&&e.push({point:o,pointOnLine:r,distance:_u.origin.distanceTo(o),object:n,face:null,faceIndex:t,uv:null,uv2:null})}}(this,t):function rY(n,e,t){const i=e.projectionMatrix,o=n.material.resolution,l=n.matrixWorld,c=n.geometry,d=c.attributes.instanceStart,p=c.attributes.instanceEnd,y=-e.near;_u.at(1,gu),gu.w=1,gu.applyMatrix4(e.matrixWorldInverse),gu.applyMatrix4(i),gu.multiplyScalar(1/gu.w),gu.x*=o.x/2,gu.y*=o.y/2,gu.z=0,cI.copy(gu),uI.multiplyMatrices(e.matrixWorldInverse,l);for(let v=0,x=d.count;v<x;v++){if(ko.fromBufferAttribute(d,v),Bo.fromBufferAttribute(p,v),ko.w=1,Bo.w=1,ko.applyMatrix4(uI),Bo.applyMatrix4(uI),ko.z>y&&Bo.z>y)continue;ko.z>y?ko.lerp(Bo,(ko.z-y)/(ko.z-Bo.z)):Bo.z>y&&Bo.lerp(ko,(Bo.z-y)/(Bo.z-ko.z)),ko.applyMatrix4(i),Bo.applyMatrix4(i),ko.multiplyScalar(1/ko.w),Bo.multiplyScalar(1/Bo.w),ko.x*=o.x/2,ko.y*=o.y/2,Bo.x*=o.x/2,Bo.y*=o.y/2,Qo.start.copy(ko),Qo.start.z=0,Qo.end.copy(Bo),Qo.end.z=0;const S=Qo.closestPointToPointParameter(cI,!0);Qo.at(S,qB);const E=ts.lerp(ko.z,Bo.z,S),T=E>=-1&&E<=1,N=cI.distanceTo(qB)<.5*jm;if(T&&N){Qo.start.fromBufferAttribute(d,v),Qo.end.fromBufferAttribute(p,v),Qo.start.applyMatrix4(l),Qo.end.applyMatrix4(l);const F=new $,U=new $;_u.distanceSqToSegment(Qo.start,Qo.end,U,F),t.push({point:U,pointOnLine:F,distance:_u.origin.distanceTo(U),object:n,face:null,faceIndex:v,uv:null,uv2:null})}}}(this,r,t)))}}$B.prototype.isLineSegments2=!0;class dI extends lI{constructor(){super(),this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")}}dI.prototype.isLineGeometry=!0;class YB extends $B{constructor(e=new dI,t=new ib({color:16777215*Math.random()})){super(e,t),this.type="Line2"}}YB.prototype.isLine2=!0;class fI extends Yi{constructor(e,t){super(),this.lines=[],this.material=t||new ib({linewidth:.002}),this.material.transparent=!0,e&&e.forEach(i=>{this.addLine(i)})}addLine(e){let t=new dI;const i=[];e.forEach(o=>i.push(o.x,o.y,o.z)),t.setPositions(i);let r=new YB(t,this.material);this.lines.push(r)}applyMatrix4(e){this.lines.forEach(t=>{t.applyMatrix4(e)})}setVisibility(e){this.visible=e,this.lines.forEach(t=>{t.visible=e})}getVisibility(){return this.visible}setColor(e){this.material.color.set(e)}getColor(){return this.material.color}getName(){return this.name}setLineWidth(e){this.material.linewidth=e}setOpacity(e){this.material.opacity=e}copy(e,t){return super.copy(e,t),this.lines=e.lines,this.material=e.material,this}}class sY extends Yi{constructor(e,t,i,r,o){super(),this.size=1,this.points=this.clonePoints(e),this.lineSet=this.pointsToLineSet(this.points,t),this.mesh=this.createMesh(this.points);let l=new Tt;l.makeRotationFromQuaternion(new Mo(r[1],r[2],r[3],r[0])),l.setPosition(i[0],i[1],i[2]),l.invert(),this.lineSet.applyMatrix4(l),this.mesh.applyMatrix4(l),this.points.x.applyMatrix4(l),o&&new Promise(c=>{let d=new Ik;this.mesh.material=new hu({map:d.load(o),side:2}),c(o)}).then()}applyMatrix4(e){this.lineSet.applyMatrix4(e),this.mesh.applyMatrix4(e)}setVisibility(e){this.lineSet.setVisibility(e),this.setMeshVisibility(e&&this.mesh.visible)}setMeshVisibility(e){this.mesh.visible=e}setFrustumSize(e){let t=e/this.size,i=this.lineSet.position.clone(),r=i.x,o=i.y,l=i.z;this.lineSet.lines.forEach(c=>{c.geometry.translate(-r,-o,-l),c.geometry.scale(t,t,t),c.geometry.translate(r,o,l)}),this.size=e,this.mesh.geometry.translate(-r,-o,-l),this.mesh.geometry.scale(t,t,t),this.mesh.geometry.translate(r,o,l)}createMesh(e){let t=e.y1.distanceTo(e.y2),i=e.y1.distanceTo(e.y4),r=new p_(t,i);r.setFromPoints([e.y3,e.y4,e.y2,e.y1]);let o=new hu,l=new Xs(r,o);return l.visible=!1,l}pointsToLineSet(e,t){let i=[];return i.push([e.x,e.y1]),i.push([e.x,e.y2]),i.push([e.x,e.y3]),i.push([e.x,e.y4]),i.push([e.y1,e.y2]),i.push([e.y2,e.y3]),i.push([e.y3,e.y4]),i.push([e.y4,e.y1]),new fI(i,t)}clonePoints(e){return{x:e.x.clone(),y1:e.y1.clone(),y2:e.y2.clone(),y3:e.y3.clone(),y4:e.y4.clone()}}}class oY extends Yi{constructor(e){super();let t=e.corners[0],i=e.corners[1],r=e.corners[2],o=e.corners[3];this.originFrustumPoints={x:new $(0,0,0),y1:new $(t[0],t[1],t[2]),y2:new $(i[0],i[1],i[2]),y3:new $(r[0],r[1],r[2]),y4:new $(o[0],o[1],o[2])},this.material=new ib({linewidth:.002}),this.cameraFrustums=[],e.cameras.map(c=>{let v=new sY(this.originFrustumPoints,this.material,c[0],c[1],c[2]);this.cameraFrustums.push(v)});let l=[];if(e.linkImages){let c;this.cameraFrustums.map(d=>{c&&l.push([c,d.points.x]),c=d.points.x})}this.linkingLines=new fI(l,this.material)}setColor(e){this.material.color.set(e)}getColor(){return this.material.color}getName(){return this.name}setVisibility(e){this.visible=e,this.cameraFrustums.forEach(t=>{t.setVisibility(e)}),this.linkingLines.setVisibility(e)}getVisibility(){return this.visible}setMeshVisibility(e){this.cameraFrustums.forEach(t=>{t.setMeshVisibility(e)})}setLineWidth(e){this.material.linewidth=e}setFrustumSize(e){this.cameraFrustums.forEach(t=>{t.setFrustumSize(e)})}setOpacity(e){this.material.opacity=e}applyMatrix4(e){this.cameraFrustums.forEach(t=>{t.applyMatrix4(e)}),this.linkingLines.applyMatrix4(e)}}class aY extends Yi{constructor(e){super(),this.pointCloud=e,this.pointCloud.material.pointSizeType=qm.PointSizeType.FIXED,this.pointCloud.material.transparent=!0}resetColor(){this.pointCloud.material.pointColorType=qm.PointColorType.RGB}setColor(e){this.pointCloud.material.pointColorType=qm.PointColorType.COLOR,this.pointCloud.material.uniforms.uColor.value.set(new Ht(e))}setPointSize(e){this.pointCloud.material.size=e}setVisibility(e){this.pointCloud.visible=e}getVisibility(){return this.pointCloud.visible}setElevationType(e){e?this.pointCloud.material.pointColorType=qm.PointColorType.ELEVATION:this.resetColor()}setPointShape(e){this.pointCloud.material.shape=e}setBoundingBox(e){this.pointCloud.showBoundingBox=e}getColor(){return this.pointCloud.material.uniforms.uColor.value}getName(){return this.pointCloud.name}setName(e){this.pointCloud.name=e}setOpacity(e){this.pointCloud.material.opacity=e}applyMatrix4(e){this.pointCloud.applyMatrix4(e)}}class lY{constructor(e,t){this._document=t;const i=this._textarea=this._document.createElement("textarea"),r=i.style;r.position="fixed",r.top=r.opacity="0",r.left="-999em",i.setAttribute("aria-hidden","true"),i.value=e,this._document.body.appendChild(i)}copy(){const e=this._textarea;let t=!1;try{if(e){const i=this._document.activeElement;e.select(),e.setSelectionRange(0,e.value.length),t=this._document.execCommand("copy"),i&&i.focus()}}catch(i){}return t}destroy(){const e=this._textarea;e&&(e.remove(),this._textarea=void 0)}}let pI,KB=(()=>{class n{constructor(t){this._document=t}copy(t){const i=this.beginCopy(t),r=i.copy();return i.destroy(),r}beginCopy(t){return new lY(t,this._document)}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),cY=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})();try{pI="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){pI=!1}let uY=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?IN(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!pI)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(Ot(ux))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hY=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})();class $l extends zt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}const{isArray:pY}=Array,{getPrototypeOf:mY,prototype:gY,keys:yY}=Object;function JB(n){if(1===n.length){const e=n[0];if(pY(e))return{args:e,keys:null};if(function _Y(n){return n&&"object"==typeof n&&mY(n)===gY}(e)){const t=yY(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}const{isArray:vY}=Array;function gI(n){return Pn(e=>function xY(n,e){return vY(e)?n(...e):n(e)}(n,e))}function QB(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function eU(n,e,t){n?vn(t,n,e):e()}const BC=Et(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function yI(...n){return function MY(){return Ui(1)}()(ss(n,xa(n)))}function tU(n){return new pr(e=>{pe(n()).subscribe(e)})}function nU(){return gi((n,e)=>{let t=null;n._refCount++;const i=Mn(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class SY extends pr{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Rn(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new An;const t=this.getSubject();e.add(this.source.subscribe(Mn(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=An.EMPTY)}return e}refCount(){return nU()(this)}}function vu(n,e){return gi((t,i)=>{let r=null,o=0,l=!1;const c=()=>l&&!r&&i.complete();t.subscribe(Mn(i,d=>{null==r||r.unsubscribe();let p=0;const y=o++;pe(n(d,y)).subscribe(r=Mn(i,v=>i.next(e?e(d,v,y,p++):v),()=>{r=null,c()}))},()=>{l=!0,c()}))})}function CY(n,e,t,i,r){return(o,l)=>{let c=t,d=e,p=0;o.subscribe(Mn(l,y=>{const v=p++;d=c?n(d,y,v):(c=!0,y),i&&l.next(d)},r&&(()=>{c&&l.next(d),l.complete()})))}}function _I(n,e){return gi(CY(n,e,arguments.length>=2,!0))}function vI(n){return n<=0?()=>zn:gi((e,t)=>{let i=[];e.subscribe(Mn(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function iU(n=TY){return gi((e,t)=>{let i=!1;e.subscribe(Mn(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function TY(){return new BC}function rU(n){return gi((e,t)=>{let i=!1;e.subscribe(Mn(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function $m(n,e){const t=arguments.length>=2;return i=>i.pipe(n?bo((r,o)=>n(r,o,i)):$t,ld(1),t?rU(e):iU(()=>new BC))}function Zs(n,e,t){const i=yt(n)||e||t?{next:n,error:e,complete:t}:n;return i?gi((r,o)=>{var l;null===(l=i.subscribe)||void 0===l||l.call(i);let c=!0;r.subscribe(Mn(o,d=>{var p;null===(p=i.next)||void 0===p||p.call(i,d),o.next(d)},()=>{var d;c=!1,null===(d=i.complete)||void 0===d||d.call(i),o.complete()},d=>{var p;c=!1,null===(p=i.error)||void 0===p||p.call(i,d),o.error(d)},()=>{var d,p;c&&(null===(d=i.unsubscribe)||void 0===d||d.call(i)),null===(p=i.finalize)||void 0===p||p.call(i)}))}):$t}class Zh{constructor(e,t){this.id=e,this.url=t}}class xI extends Zh{constructor(e,t,i="imperative",r=null){super(e,t),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class sb extends Zh{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class sU extends Zh{constructor(e,t,i){super(e,t),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class RY extends Zh{constructor(e,t,i){super(e,t),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class PY extends Zh{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class IY extends Zh{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class LY extends Zh{constructor(e,t,i,r,o){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class FY extends Zh{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class NY extends Zh{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class oU{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class aU{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class OY{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kY{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class BY{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UY{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class lU{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Ti="primary";class VY{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function O_(n){return new VY(n)}const cU="ngNavigationCancelingError";function bI(n){const e=Error("NavigationCancelingError: "+n);return e[cU]=!0,e}function HY(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let o=0;o<i.length;o++){const l=i[o],c=n[o];if(l.startsWith(":"))r[l.substring(1)]=c;else if(l!==c.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function xu(n,e){const t=n?Object.keys(n):void 0,i=e?Object.keys(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let o=0;o<t.length;o++)if(r=t[o],!uU(n[r],e[r]))return!1;return!0}function uU(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,o)=>i[o]===r)}return n===e}function hU(n){return Array.prototype.concat.apply([],n)}function dU(n){return n.length>0?n[n.length-1]:null}function Uo(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function bu(n){return fa(n)?n:cf(n)?ss(Promise.resolve(n)):si(n)}const qY={exact:function mU(n,e,t){if(!Km(n.segments,e.segments)||!UC(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!mU(n.children[i],e.children[i],t))return!1;return!0},subset:gU},fU={exact:function jY(n,e){return xu(n,e)},subset:function XY(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>uU(n[t],e[t]))},ignored:()=>!0};function pU(n,e,t){return qY[t.paths](n.root,e.root,t.matrixParams)&&fU[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function gU(n,e,t){return yU(n,e,e.segments,t)}function yU(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!Km(r,t)||e.hasChildren()||!UC(r,t,i))}if(n.segments.length===t.length){if(!Km(n.segments,t)||!UC(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!gU(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),o=t.slice(n.segments.length);return!!(Km(n.segments,r)&&UC(n.segments,r,i)&&n.children[Ti])&&yU(n.children[Ti],e,o,i)}}function UC(n,e,t){return e.every((i,r)=>fU[t](n[r].parameters,i.parameters))}class Ym{constructor(e,t,i){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=O_(this.queryParams)),this._queryParamMap}toString(){return KY.serialize(this)}}class Oi{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Uo(t,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return VC(this)}}class ob{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=O_(this.parameters)),this._parameterMap}toString(){return wU(this)}}function Km(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}class _U{}class vU{parse(e){const t=new sK(e);return new Ym(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${ab(e.root,!0)}`,i=function QY(n){const e=Object.keys(n).map(t=>{const i=n[t];return Array.isArray(i)?i.map(r=>`${zC(t)}=${zC(r)}`).join("&"):`${zC(t)}=${zC(i)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function ZY(n){return encodeURI(n)}(e.fragment)}`:""}`}}const KY=new vU;function VC(n){return n.segments.map(e=>wU(e)).join("/")}function ab(n,e){if(!n.hasChildren())return VC(n);if(e){const t=n.children[Ti]?ab(n.children[Ti],!1):"",i=[];return Uo(n.children,(r,o)=>{o!==Ti&&i.push(`${o}:${ab(r,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function YY(n,e){let t=[];return Uo(n.children,(i,r)=>{r===Ti&&(t=t.concat(e(i,r)))}),Uo(n.children,(i,r)=>{r!==Ti&&(t=t.concat(e(i,r)))}),t}(n,(i,r)=>r===Ti?[ab(n.children[Ti],!1)]:[`${r}:${ab(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[Ti]?`${VC(n)}/${t[0]}`:`${VC(n)}/(${t.join("//")})`}}function xU(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zC(n){return xU(n).replace(/%3B/gi,";")}function wI(n){return xU(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function HC(n){return decodeURIComponent(n)}function bU(n){return HC(n.replace(/\+/g,"%20"))}function wU(n){return`${wI(n.path)}${function JY(n){return Object.keys(n).map(e=>`;${wI(e)}=${wI(n[e])}`).join("")}(n.parameters)}`}const eK=/^[^\/()?;=#]+/;function GC(n){const e=n.match(eK);return e?e[0]:""}const tK=/^[^=?&#]+/,iK=/^[^&#]+/;class sK{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Oi([],{}):new Oi([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[Ti]=new Oi(e,t)),i}parseSegment(){const e=GC(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new ob(HC(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=GC(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=GC(this.remaining);r&&(i=r,this.capture(i))}e[HC(t)]=HC(i)}parseQueryParam(e){const t=function nK(n){const e=n.match(tK);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const l=function rK(n){const e=n.match(iK);return e?e[0]:""}(this.remaining);l&&(i=l,this.capture(i))}const r=bU(t),o=bU(i);if(e.hasOwnProperty(r)){let l=e[r];Array.isArray(l)||(l=[l],e[r]=l),l.push(o)}else e[r]=o}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=GC(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let o;i.indexOf(":")>-1?(o=i.substr(0,i.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=Ti);const l=this.parseChildren();t[o]=1===Object.keys(l).length?l[Ti]:new Oi([],l),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class MU{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=MI(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=MI(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=SI(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return SI(e,this._root).map(t=>t.value)}}function MI(n,e){if(n===e.value)return e;for(const t of e.children){const i=MI(n,t);if(i)return i}return null}function SI(n,e){if(n===e.value)return[e];for(const t of e.children){const i=SI(n,t);if(i.length)return i.unshift(e),i}return[]}class Jh{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function k_(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class SU extends MU{constructor(e,t){super(e),this.snapshot=t,EI(this,e)}toString(){return this.snapshot.toString()}}function EU(n,e){const t=function oK(n,e){const l=new WC([],{},{},"",{},Ti,e,null,n.root,-1,{});return new TU("",new Jh(l,[]))}(n,e),i=new $l([new ob("",{})]),r=new $l({}),o=new $l({}),l=new $l({}),c=new $l(""),d=new Zm(i,r,l,c,o,Ti,e,t.root);return d.snapshot=t.root,new SU(new Jh(d,[]),t)}class Zm{constructor(e,t,i,r,o,l,c,d){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=l,this.component=c,this._futureSnapshot=d}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Pn(e=>O_(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Pn(e=>O_(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function CU(n,e="emptyOnly"){const t=n.pathFromRoot;let i=0;if("always"!==e)for(i=t.length-1;i>=1;){const r=t[i],o=t[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(o.component)break;i--}}return function aK(n){return n.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(i))}class WC{constructor(e,t,i,r,o,l,c,d,p,y,v){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=l,this.component=c,this.routeConfig=d,this._urlSegment=p,this._lastPathIndex=y,this._resolve=v}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=O_(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=O_(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class TU extends MU{constructor(e,t){super(t),this.url=e,EI(this,t)}toString(){return AU(this._root)}}function EI(n,e){e.value._routerState=n,e.children.forEach(t=>EI(n,t))}function AU(n){const e=n.children.length>0?` { ${n.children.map(AU).join(", ")} } `:"";return`${n.value}${e}`}function CI(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,xu(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),xu(e.params,t.params)||n.params.next(t.params),function GY(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!xu(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),xu(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function TI(n,e){const t=xu(n.params,e.params)&&function $Y(n,e){return Km(n,e)&&n.every((t,i)=>xu(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||TI(n.parent,e.parent))}function lb(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function cK(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return lb(n,i,r);return lb(n,i)})}(n,e,t);return new Jh(i,r)}{if(n.shouldAttach(e.value)){const o=n.retrieve(e.value);if(null!==o){const l=o.route;return l.value._futureSnapshot=e.value,l.children=e.children.map(c=>lb(n,c)),l}}const i=function uK(n){return new Zm(new $l(n.url),new $l(n.params),new $l(n.queryParams),new $l(n.fragment),new $l(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(o=>lb(n,o));return new Jh(i,r)}}function qC(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function cb(n){return"object"==typeof n&&null!=n&&n.outlets}function AI(n,e,t,i,r){let o={};if(i&&Uo(i,(c,d)=>{o[d]=Array.isArray(c)?c.map(p=>`${p}`):`${c}`}),n===e)return new Ym(t,o,r);const l=DU(n,e,t);return new Ym(l,o,r)}function DU(n,e,t){const i={};return Uo(n.children,(r,o)=>{i[o]=r===e?t:DU(r,e,t)}),new Oi(n.segments,i)}class RU{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&qC(i[0]))throw new Error("Root segment cannot have matrix parameters");const r=i.find(cb);if(r&&r!==dU(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class DI{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function PU(n,e,t){if(n||(n=new Oi([],{})),0===n.segments.length&&n.hasChildren())return jC(n,e,t);const i=function gK(n,e,t){let i=0,r=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return o;const l=n.segments[r],c=t[i];if(cb(c))break;const d=`${c}`,p=i<t.length-1?t[i+1]:null;if(r>0&&void 0===d)break;if(d&&p&&"object"==typeof p&&void 0===p.outlets){if(!LU(d,p,l))return o;i+=2}else{if(!LU(d,{},l))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const o=new Oi(n.segments.slice(0,i.pathIndex),{});return o.children[Ti]=new Oi(n.segments.slice(i.pathIndex),n.children),jC(o,0,r)}return i.match&&0===r.length?new Oi(n.segments,{}):i.match&&!n.hasChildren()?RI(n,e,t):i.match?jC(n,0,r):RI(n,e,t)}function jC(n,e,t){if(0===t.length)return new Oi(n.segments,{});{const i=function mK(n){return cb(n[0])?n[0].outlets:{[Ti]:n}}(t),r={};return Uo(i,(o,l)=>{"string"==typeof o&&(o=[o]),null!==o&&(r[l]=PU(n.children[l],e,o))}),Uo(n.children,(o,l)=>{void 0===i[l]&&(r[l]=o)}),new Oi(n.segments,r)}}function RI(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const o=t[r];if(cb(o)){const d=yK(o.outlets);return new Oi(i,d)}if(0===r&&qC(t[0])){i.push(new ob(n.segments[e].path,IU(t[0]))),r++;continue}const l=cb(o)?o.outlets[Ti]:`${o}`,c=r<t.length-1?t[r+1]:null;l&&c&&qC(c)?(i.push(new ob(l,IU(c))),r+=2):(i.push(new ob(l,{})),r++)}return new Oi(i,{})}function yK(n){const e={};return Uo(n,(t,i)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[i]=RI(new Oi([],{}),0,t))}),e}function IU(n){const e={};return Uo(n,(t,i)=>e[i]=`${t}`),e}function LU(n,e,t){return n==t.path&&xu(e,t.parameters)}class vK{constructor(e,t,i,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),CI(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=k_(t);e.children.forEach(o=>{const l=o.value.outlet;this.deactivateRoutes(o,r[l],i),delete r[l]}),Uo(r,(o,l)=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(e,t,i){const r=e.value,o=t?t.value:null;if(r===o)if(r.component){const l=i.getContext(r.outlet);l&&this.deactivateChildRoutes(e,t,l.children)}else this.deactivateChildRoutes(e,t,i);else o&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=k_(e);for(const l of Object.keys(o))this.deactivateRouteAndItsChildren(o[l],r);if(i&&i.outlet){const l=i.outlet.detach(),c=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:l,route:e,contexts:c})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,o=k_(e);for(const l of Object.keys(o))this.deactivateRouteAndItsChildren(o[l],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(e,t,i){const r=k_(t);e.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new UY(o.value.snapshot))}),e.children.length&&this.forwardEvent(new kY(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,o=t?t.value:null;if(CI(r),r===o)if(r.component){const l=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,l.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const l=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const c=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),l.children.onOutletReAttached(c.contexts),l.attachRef=c.componentRef,l.route=c.route.value,l.outlet&&l.outlet.attach(c.componentRef,c.route.value),CI(c.route.value),this.activateChildRoutes(e,null,l.children)}else{const c=function xK(n){for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(r.snapshot),d=c?c.module.componentFactoryResolver:null;l.attachRef=null,l.route=r,l.resolver=d,l.outlet&&l.outlet.activateWith(r,d),this.activateChildRoutes(e,null,l.children)}}else this.activateChildRoutes(e,null,i)}}class PI{constructor(e,t){this.routes=e,this.module=t}}function kf(n){return"function"==typeof n}function Jm(n){return n instanceof Ym}const ub=Symbol("INITIAL_VALUE");function hb(){return vu(n=>function bY(...n){const e=xa(n),t=Za(n),{args:i,keys:r}=JB(n);if(0===i.length)return ss([],e);const o=new pr(function wY(n,e,t=$t){return i=>{eU(e,()=>{const{length:r}=n,o=new Array(r);let l=r,c=r;for(let d=0;d<r;d++)eU(e,()=>{const p=ss(n[d],e);let y=!1;p.subscribe(Mn(i,v=>{o[d]=v,y||(y=!0,c--),c||i.next(t(o.slice()))},()=>{--l||i.complete()}))},i)},i)}}(i,e,r?l=>QB(r,l):$t));return t?o.pipe(gI(t)):o}(n.map(e=>e.pipe(ld(1),function EY(...n){const e=xa(n);return gi((t,i)=>{(e?yI(n,t,e):yI(n,t)).subscribe(i)})}(ub)))).pipe(_I((e,t)=>{let i=!1;return t.reduce((r,o,l)=>r!==ub?r:(o===ub&&(i=!0),i||!1!==o&&l!==t.length-1&&!Jm(o)?r:o),e)},ub),bo(e=>e!==ub),Pn(e=>Jm(e)?e:!0===e),ld(1)))}class CK{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new db,this.attachRef=null}}class db{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const i=this.getOrCreateContext(e);i.outlet=t,this.contexts.set(e,i)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new CK,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}let FU=(()=>{class n{constructor(t,i,r,o,l){this.parentContexts=t,this.location=i,this.resolver=r,this.changeDetector=l,this.activated=null,this._activatedRoute=null,this.activateEvents=new wi,this.deactivateEvents=new wi,this.attachEvents=new wi,this.detachEvents=new wi,this.name=o||Ti,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const l=(i=i||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),c=this.parentContexts.getOrCreateContext(this.name).children,d=new TK(t,c,this.location.injector);this.activated=this.location.createComponent(l,this.location.length,d),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(Te(db),Te(Ul),Te(Iy),function xp(n){return function tA(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const i=t.length;let r=0;for(;r<i;){const o=t[r];if(iw(o))break;if(0===o)r+=2;else if("number"==typeof o)for(r++;r<i&&"string"==typeof t[r];)r++;else{if(o===e)return t[r+1];r+=2}}}return null}(ds(),n)}("name"),Te(hx))},n.\u0275dir=Sn({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),n})();class TK{constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===Zm?this.route:e===db?this.childContexts:this.parent.get(e,t)}}let NU=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ao({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,i){1&t&&ur(0,"router-outlet")},directives:[FU],encapsulation:2}),n})();function OU(n,e=""){for(let t=0;t<n.length;t++){const i=n[t];AK(i,DK(e,i))}}function AK(n,e){n.children&&OU(n.children,e)}function DK(n,e){return e?n||e.path?n&&!e.path?`${n}/`:!n&&e.path?e.path:`${n}/${e.path}`:"":n}function II(n){const e=n.children&&n.children.map(II),t=e?Object.assign(Object.assign({},n),{children:e}):Object.assign({},n);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Ti&&(t.component=NU),t}function Yl(n){return n.outlet||Ti}function kU(n,e){const t=n.filter(i=>Yl(i)===e);return t.push(...n.filter(i=>Yl(i)!==e)),t}const BU={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function XC(n,e,t){var i;if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?Object.assign({},BU):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const o=(e.matcher||HY)(t,n,e);if(!o)return Object.assign({},BU);const l={};Uo(o.posParams,(d,p)=>{l[p]=d.path});const c=o.consumed.length>0?Object.assign(Object.assign({},l),o.consumed[o.consumed.length-1].parameters):l;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:c,positionalParamSegments:null!==(i=o.posParams)&&void 0!==i?i:{}}}function $C(n,e,t,i,r="corrected"){if(t.length>0&&function IK(n,e,t){return t.some(i=>YC(n,e,i)&&Yl(i)!==Ti)}(n,t,i)){const l=new Oi(e,function PK(n,e,t,i){const r={};r[Ti]=i,i._sourceSegment=n,i._segmentIndexShift=e.length;for(const o of t)if(""===o.path&&Yl(o)!==Ti){const l=new Oi([],{});l._sourceSegment=n,l._segmentIndexShift=e.length,r[Yl(o)]=l}return r}(n,e,i,new Oi(t,n.children)));return l._sourceSegment=n,l._segmentIndexShift=e.length,{segmentGroup:l,slicedSegments:[]}}if(0===t.length&&function LK(n,e,t){return t.some(i=>YC(n,e,i))}(n,t,i)){const l=new Oi(n.segments,function RK(n,e,t,i,r,o){const l={};for(const c of i)if(YC(n,t,c)&&!r[Yl(c)]){const d=new Oi([],{});d._sourceSegment=n,d._segmentIndexShift="legacy"===o?n.segments.length:e.length,l[Yl(c)]=d}return Object.assign(Object.assign({},r),l)}(n,e,t,i,n.children,r));return l._sourceSegment=n,l._segmentIndexShift=e.length,{segmentGroup:l,slicedSegments:t}}const o=new Oi(n.segments,n.children);return o._sourceSegment=n,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:t}}function YC(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function UU(n,e,t,i){return!!(Yl(n)===i||i!==Ti&&YC(e,t,n))&&("**"===n.path||XC(e,n,t).matched)}function VU(n,e,t){return 0===e.length&&!n.children[t]}class KC{constructor(e){this.segmentGroup=e||null}}class zU{constructor(e){this.urlTree=e}}function fb(n){return Uy(new KC(n))}function HU(n){return Uy(new zU(n))}class kK{constructor(e,t,i,r,o){this.configLoader=t,this.urlSerializer=i,this.urlTree=r,this.config=o,this.allowRedirects=!0,this.ngModule=e.get(Ph)}apply(){const e=$C(this.urlTree.root,[],[],this.config).segmentGroup,t=new Oi(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,Ti).pipe(Pn(o=>this.createUrlTree(LI(o),this.urlTree.queryParams,this.urlTree.fragment))).pipe(cu(o=>{if(o instanceof zU)return this.allowRedirects=!1,this.match(o.urlTree);throw o instanceof KC?this.noMatchError(o):o}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Ti).pipe(Pn(r=>this.createUrlTree(LI(r),e.queryParams,e.fragment))).pipe(cu(r=>{throw r instanceof KC?this.noMatchError(r):r}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,i){const r=e.segments.length>0?new Oi([],{[Ti]:e}):e;return new Ym(r,t,i)}expandSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(e,t,i).pipe(Pn(o=>new Oi([],o))):this.expandSegment(e,i,t,i.segments,r,!0)}expandChildren(e,t,i){const r=[];for(const o of Object.keys(i.children))"primary"===o?r.unshift(o):r.push(o);return ss(r).pipe(Vy(o=>{const l=i.children[o],c=kU(t,o);return this.expandSegmentGroup(e,c,l,o).pipe(Pn(d=>({segment:d,outlet:o})))}),_I((o,l)=>(o[l.outlet]=l.segment,o),{}),function AY(n,e){const t=arguments.length>=2;return i=>i.pipe(n?bo((r,o)=>n(r,o,i)):$t,vI(1),t?rU(e):iU(()=>new BC))}())}expandSegment(e,t,i,r,o,l){return ss(i).pipe(Vy(c=>this.expandSegmentAgainstRoute(e,t,i,c,r,o,l).pipe(cu(p=>{if(p instanceof KC)return si(null);throw p}))),$m(c=>!!c),cu((c,d)=>{if(c instanceof BC||"EmptyError"===c.name)return VU(t,r,o)?si(new Oi([],{})):fb(t);throw c}))}expandSegmentAgainstRoute(e,t,i,r,o,l,c){return UU(r,t,o,l)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,o,l):c&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,i,r,o,l):fb(t):fb(t)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,o,l){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,r,l):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,o,l)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,i,r){const o=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?HU(o):this.lineralizeSegments(i,o).pipe(qi(l=>{const c=new Oi(l,{});return this.expandSegment(e,c,t,l,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,o,l){const{matched:c,consumedSegments:d,remainingSegments:p,positionalParamSegments:y}=XC(t,r,o);if(!c)return fb(t);const v=this.applyRedirectCommands(d,r.redirectTo,y);return r.redirectTo.startsWith("/")?HU(v):this.lineralizeSegments(r,v).pipe(qi(x=>this.expandSegment(e,t,i,x.concat(p),l,!1)))}matchSegmentAgainstRoute(e,t,i,r,o){if("**"===i.path)return i.loadChildren?(i._loadedConfig?si(i._loadedConfig):this.configLoader.load(e.injector,i)).pipe(Pn(v=>(i._loadedConfig=v,new Oi(r,{})))):si(new Oi(r,{}));const{matched:l,consumedSegments:c,remainingSegments:d}=XC(t,i,r);return l?this.getChildConfig(e,i,r).pipe(qi(y=>{const v=y.module,x=y.routes,{segmentGroup:b,slicedSegments:S}=$C(t,c,d,x),E=new Oi(b.segments,b.children);if(0===S.length&&E.hasChildren())return this.expandChildren(v,x,E).pipe(Pn(U=>new Oi(c,U)));if(0===x.length&&0===S.length)return si(new Oi(c,{}));const T=Yl(i)===o;return this.expandSegment(v,E,x,S,T?Ti:o,!0).pipe(Pn(F=>new Oi(c.concat(F.segments),F.children)))})):fb(t)}getChildConfig(e,t,i){return t.children?si(new PI(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?si(t._loadedConfig):this.runCanLoadGuards(e.injector,t,i).pipe(qi(r=>r?this.configLoader.load(e.injector,t).pipe(Pn(o=>(t._loadedConfig=o,o))):function NK(n){return Uy(bI(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`))}(t))):si(new PI([],e))}runCanLoadGuards(e,t,i){const r=t.canLoad;return r&&0!==r.length?si(r.map(l=>{const c=e.get(l);let d;if(function wK(n){return n&&kf(n.canLoad)}(c))d=c.canLoad(t,i);else{if(!kf(c))throw new Error("Invalid CanLoad guard");d=c(t,i)}return bu(d)})).pipe(hb(),Zs(l=>{if(!Jm(l))return;const c=bI(`Redirecting to "${this.urlSerializer.serialize(l)}"`);throw c.url=l,c}),Pn(l=>!0===l)):si(!0)}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return si(i);if(r.numberOfChildren>1||!r.children[Ti])return Uy(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e.redirectTo}'`));r=r.children[Ti]}}applyRedirectCommands(e,t,i){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,i)}applyRedirectCreatreUrlTree(e,t,i,r){const o=this.createSegmentGroup(e,t.root,i,r);return new Ym(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return Uo(e,(r,o)=>{if("string"==typeof r&&r.startsWith(":")){const c=r.substring(1);i[o]=t[c]}else i[o]=r}),i}createSegmentGroup(e,t,i,r){const o=this.createSegments(e,t.segments,i,r);let l={};return Uo(t.children,(c,d)=>{l[d]=this.createSegmentGroup(e,c,i,r)}),new Oi(o,l)}createSegments(e,t,i,r){return t.map(o=>o.path.startsWith(":")?this.findPosParam(e,o,r):this.findOrReturn(o,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}function LI(n){const e={};for(const i of Object.keys(n.children)){const o=LI(n.children[i]);(o.segments.length>0||o.hasChildren())&&(e[i]=o)}return function BK(n){if(1===n.numberOfChildren&&n.children[Ti]){const e=n.children[Ti];return new Oi(n.segments.concat(e.segments),e.children)}return n}(new Oi(n.segments,e))}class GU{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class ZC{constructor(e,t){this.component=e,this.route=t}}function VK(n,e,t){const i=n._root;return pb(i,e?e._root:null,t,[i.value])}function JC(n,e,t){const i=function HK(n){if(!n)return null;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(i?i.module.injector:t).get(n)}function pb(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=k_(e);return n.children.forEach(l=>{(function GK(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=n.value,l=e?e.value:null,c=t?t.getContext(n.value.outlet):null;if(l&&o.routeConfig===l.routeConfig){const d=function WK(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!Km(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Km(n.url,e.url)||!xu(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!TI(n,e)||!xu(n.queryParams,e.queryParams);default:return!TI(n,e)}}(l,o,o.routeConfig.runGuardsAndResolvers);d?r.canActivateChecks.push(new GU(i)):(o.data=l.data,o._resolvedData=l._resolvedData),pb(n,e,o.component?c?c.children:null:t,i,r),d&&c&&c.outlet&&c.outlet.isActivated&&r.canDeactivateChecks.push(new ZC(c.outlet.component,l))}else l&&mb(e,c,r),r.canActivateChecks.push(new GU(i)),pb(n,null,o.component?c?c.children:null:t,i,r)})(l,o[l.value.outlet],t,i.concat([l.value]),r),delete o[l.value.outlet]}),Uo(o,(l,c)=>mb(l,t.getContext(c),r)),r}function mb(n,e,t){const i=k_(n),r=n.value;Uo(i,(o,l)=>{mb(o,r.component?e?e.children.getContext(l):null:e,t)}),t.canDeactivateChecks.push(new ZC(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}class QK{}function WU(n){return new pr(e=>e.error(n))}class tZ{constructor(e,t,i,r,o,l){this.rootComponentType=e,this.config=t,this.urlTree=i,this.url=r,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=l}recognize(){const e=$C(this.urlTree.root,[],[],this.config.filter(l=>void 0===l.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Ti);if(null===t)return null;const i=new WC([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Ti,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Jh(i,t),o=new TU(this.url,r);return this.inheritParamsAndData(o._root),o}inheritParamsAndData(e){const t=e.value,i=CU(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),e.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(e,t,i){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,i)}processChildren(e,t){const i=[];for(const o of Object.keys(t.children)){const l=t.children[o],c=kU(e,o),d=this.processSegmentGroup(c,l,o);if(null===d)return null;i.push(...d)}const r=qU(i);return function nZ(n){n.sort((e,t)=>e.value.outlet===Ti?-1:t.value.outlet===Ti?1:e.value.outlet.localeCompare(t.value.outlet))}(r),r}processSegment(e,t,i,r){for(const o of e){const l=this.processSegmentAgainstRoute(o,t,i,r);if(null!==l)return l}return VU(t,i,r)?[]:null}processSegmentAgainstRoute(e,t,i,r){if(e.redirectTo||!UU(e,t,i,r))return null;let o,l=[],c=[];if("**"===e.path){const b=i.length>0?dU(i).parameters:{};o=new WC(i,b,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$U(e),Yl(e),e.component,e,jU(t),XU(t)+i.length,YU(e))}else{const b=XC(t,e,i);if(!b.matched)return null;l=b.consumedSegments,c=b.remainingSegments,o=new WC(l,b.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,$U(e),Yl(e),e.component,e,jU(t),XU(t)+l.length,YU(e))}const d=function iZ(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(e),{segmentGroup:p,slicedSegments:y}=$C(t,l,c,d.filter(b=>void 0===b.redirectTo),this.relativeLinkResolution);if(0===y.length&&p.hasChildren()){const b=this.processChildren(d,p);return null===b?null:[new Jh(o,b)]}if(0===d.length&&0===y.length)return[new Jh(o,[])];const v=Yl(e)===r,x=this.processSegment(d,p,y,v?Ti:r);return null===x?null:[new Jh(o,x)]}}function rZ(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function qU(n){const e=[],t=new Set;for(const i of n){if(!rZ(i)){e.push(i);continue}const r=e.find(o=>i.value.routeConfig===o.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=qU(i.children);e.push(new Jh(i.value,r))}return e.filter(i=>!t.has(i))}function jU(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function XU(n){let e=n,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function $U(n){return n.data||{}}function YU(n){return n.resolve||{}}function KU(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function FI(n){return vu(e=>{const t=n(e);return t?ss(t).pipe(Pn(()=>e)):si(e)})}class dZ extends class hZ{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const NI=new Xn("ROUTES");class ZU{constructor(e,t,i,r){this.injector=e,this.compiler=t,this.onLoadStartListener=i,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const r=this.loadModuleFactory(t.loadChildren).pipe(Pn(o=>{this.onLoadEndListener&&this.onLoadEndListener(t);const l=o.create(e);return new PI(hU(l.injector.get(NI,void 0,Cn.Self|Cn.Optional)).map(II),l)}),cu(o=>{throw t._loader$=void 0,o}));return t._loader$=new SY(r,()=>new zt).pipe(nU()),t._loader$}loadModuleFactory(e){return bu(e()).pipe(qi(t=>t instanceof sF?si(t):ss(this.compiler.compileModuleAsync(t))))}}class pZ{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function mZ(n){throw n}function gZ(n,e,t){return e.parse("/")}function JU(n,e){return si(null)}const yZ={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},_Z={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let dl=(()=>{class n{constructor(t,i,r,o,l,c,d){this.rootComponentType=t,this.urlSerializer=i,this.rootContexts=r,this.location=o,this.config=d,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new zt,this.errorHandler=mZ,this.malformedUriErrorHandler=gZ,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:JU,afterPreactivation:JU},this.urlHandlingStrategy=new pZ,this.routeReuseStrategy=new dZ,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=l.get(Ph),this.console=l.get(r4);const v=l.get(As);this.isNgZoneEnabled=v instanceof As&&As.isInAngularZone(),this.resetConfig(d),this.currentUrlTree=function WY(){return new Ym(new Oi([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new ZU(l,c,x=>this.triggerEvent(new oU(x)),x=>this.triggerEvent(new aU(x))),this.routerState=EU(this.currentUrlTree,this.rootComponentType),this.transitions=new $l({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const i=this.events;return t.pipe(bo(r=>0!==r.id),Pn(r=>Object.assign(Object.assign({},r),{extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),vu(r=>{let o=!1,l=!1;return si(r).pipe(Zs(c=>{this.currentNavigation={id:c.id,initialUrl:c.currentRawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),vu(c=>{const d=this.browserUrlTree.toString(),p=!this.navigated||c.extractedUrl.toString()!==d||d!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||p)&&this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return QU(c.source)&&(this.browserUrlTree=c.extractedUrl),si(c).pipe(vu(v=>{const x=this.transitions.getValue();return i.next(new xI(v.id,this.serializeUrl(v.extractedUrl),v.source,v.restoredState)),x!==this.transitions.getValue()?zn:Promise.resolve(v)}),function UK(n,e,t,i){return vu(r=>function OK(n,e,t,i,r){return new kK(n,e,t,i,r).apply()}(n,e,t,r.extractedUrl,i).pipe(Pn(o=>Object.assign(Object.assign({},r),{urlAfterRedirects:o}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Zs(v=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:v.urlAfterRedirects})}),function sZ(n,e,t,i,r){return qi(o=>function eZ(n,e,t,i,r="emptyOnly",o="legacy"){try{const l=new tZ(n,e,t,i,r,o).recognize();return null===l?WU(new QK):si(l)}catch(l){return WU(l)}}(n,e,o.urlAfterRedirects,t(o.urlAfterRedirects),i,r).pipe(Pn(l=>Object.assign(Object.assign({},o),{targetSnapshot:l}))))}(this.rootComponentType,this.config,v=>this.serializeUrl(v),this.paramsInheritanceStrategy,this.relativeLinkResolution),Zs(v=>{if("eager"===this.urlUpdateStrategy){if(!v.extras.skipLocationChange){const b=this.urlHandlingStrategy.merge(v.urlAfterRedirects,v.rawUrl);this.setBrowserUrl(b,v)}this.browserUrlTree=v.urlAfterRedirects}const x=new PY(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);i.next(x)}));if(p&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:x,extractedUrl:b,source:S,restoredState:E,extras:T}=c,N=new xI(x,this.serializeUrl(b),S,E);i.next(N);const F=EU(b,this.rootComponentType).snapshot;return si(Object.assign(Object.assign({},c),{targetSnapshot:F,urlAfterRedirects:b,extras:Object.assign(Object.assign({},T),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=c.rawUrl,c.resolve(null),zn}),FI(c=>{const{targetSnapshot:d,id:p,extractedUrl:y,rawUrl:v,extras:{skipLocationChange:x,replaceUrl:b}}=c;return this.hooks.beforePreactivation(d,{navigationId:p,appliedUrlTree:y,rawUrlTree:v,skipLocationChange:!!x,replaceUrl:!!b})}),Zs(c=>{const d=new IY(c.id,this.serializeUrl(c.extractedUrl),this.serializeUrl(c.urlAfterRedirects),c.targetSnapshot);this.triggerEvent(d)}),Pn(c=>Object.assign(Object.assign({},c),{guards:VK(c.targetSnapshot,c.currentSnapshot,this.rootContexts)})),function qK(n,e){return qi(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:l}}=t;return 0===l.length&&0===o.length?si(Object.assign(Object.assign({},t),{guardsResult:!0})):function jK(n,e,t,i){return ss(n).pipe(qi(r=>function JK(n,e,t,i,r){const o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return o&&0!==o.length?si(o.map(c=>{const d=JC(c,e,r);let p;if(function EK(n){return n&&kf(n.canDeactivate)}(d))p=bu(d.canDeactivate(n,e,t,i));else{if(!kf(d))throw new Error("Invalid CanDeactivate guard");p=bu(d(n,e,t,i))}return p.pipe($m())})).pipe(hb()):si(!0)}(r.component,r.route,t,e,i)),$m(r=>!0!==r,!0))}(l,i,r,n).pipe(qi(c=>c&&function bK(n){return"boolean"==typeof n}(c)?function XK(n,e,t,i){return ss(e).pipe(Vy(r=>yI(function YK(n,e){return null!==n&&e&&e(new OY(n)),si(!0)}(r.route.parent,i),function $K(n,e){return null!==n&&e&&e(new BY(n)),si(!0)}(r.route,i),function ZK(n,e,t){const i=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(l=>function zK(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(l)).filter(l=>null!==l).map(l=>tU(()=>si(l.guards.map(d=>{const p=JC(d,l.node,t);let y;if(function SK(n){return n&&kf(n.canActivateChild)}(p))y=bu(p.canActivateChild(i,n));else{if(!kf(p))throw new Error("Invalid CanActivateChild guard");y=bu(p(i,n))}return y.pipe($m())})).pipe(hb())));return si(o).pipe(hb())}(n,r.path,t),function KK(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return si(!0);const r=i.map(o=>tU(()=>{const l=JC(o,e,t);let c;if(function MK(n){return n&&kf(n.canActivate)}(l))c=bu(l.canActivate(e,n));else{if(!kf(l))throw new Error("Invalid CanActivate guard");c=bu(l(e,n))}return c.pipe($m())}));return si(r).pipe(hb())}(n,r.route,t))),$m(r=>!0!==r,!0))}(i,o,n,e):si(c)),Pn(c=>Object.assign(Object.assign({},t),{guardsResult:c})))})}(this.ngModule.injector,c=>this.triggerEvent(c)),Zs(c=>{if(Jm(c.guardsResult)){const p=bI(`Redirecting to "${this.serializeUrl(c.guardsResult)}"`);throw p.url=c.guardsResult,p}const d=new LY(c.id,this.serializeUrl(c.extractedUrl),this.serializeUrl(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.triggerEvent(d)}),bo(c=>!!c.guardsResult||(this.restoreHistory(c),this.cancelNavigationTransition(c,""),!1)),FI(c=>{if(c.guards.canActivateChecks.length)return si(c).pipe(Zs(d=>{const p=new FY(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);this.triggerEvent(p)}),vu(d=>{let p=!1;return si(d).pipe(function oZ(n,e){return qi(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return si(t);let o=0;return ss(r).pipe(Vy(l=>function aZ(n,e,t,i){return function lZ(n,e,t,i){const r=KU(n);if(0===r.length)return si({});const o={};return ss(r).pipe(qi(l=>function cZ(n,e,t,i){const r=JC(n,e,i);return bu(r.resolve?r.resolve(e,t):r(e,t))}(n[l],e,t,i).pipe(Zs(c=>{o[l]=c}))),vI(1),qi(()=>KU(o).length===r.length?si(o):zn))}(n._resolve,n,e,i).pipe(Pn(o=>(n._resolvedData=o,n.data=Object.assign(Object.assign({},n.data),CU(n,t).resolve),null)))}(l.route,i,n,e)),Zs(()=>o++),vI(1),qi(l=>o===r.length?si(t):zn))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Zs({next:()=>p=!0,complete:()=>{p||(this.restoreHistory(d),this.cancelNavigationTransition(d,"At least one route resolver didn't emit any value."))}}))}),Zs(d=>{const p=new NY(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);this.triggerEvent(p)}))}),FI(c=>{const{targetSnapshot:d,id:p,extractedUrl:y,rawUrl:v,extras:{skipLocationChange:x,replaceUrl:b}}=c;return this.hooks.afterPreactivation(d,{navigationId:p,appliedUrlTree:y,rawUrlTree:v,skipLocationChange:!!x,replaceUrl:!!b})}),Pn(c=>{const d=function lK(n,e,t){const i=lb(n,e._root,t?t._root:void 0);return new SU(i,e)}(this.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return Object.assign(Object.assign({},c),{targetRouterState:d})}),Zs(c=>{this.currentUrlTree=c.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl),this.routerState=c.targetRouterState,"deferred"===this.urlUpdateStrategy&&(c.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,c),this.browserUrlTree=c.urlAfterRedirects)}),((n,e,t)=>Pn(i=>(new vK(e,i.targetRouterState,i.currentRouterState,t).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,c=>this.triggerEvent(c)),Zs({next(){o=!0},complete(){o=!0}}),function DY(n){return gi((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}(()=>{var c;o||l||this.cancelNavigationTransition(r,`Navigation ID ${r.id} is not equal to the current navigation id ${this.navigationId}`),(null===(c=this.currentNavigation)||void 0===c?void 0:c.id)===r.id&&(this.currentNavigation=null)}),cu(c=>{if(l=!0,function zY(n){return n&&n[cU]}(c)){const d=Jm(c.url);d||(this.navigated=!0,this.restoreHistory(r,!0));const p=new sU(r.id,this.serializeUrl(r.extractedUrl),c.message);i.next(p),d?setTimeout(()=>{const y=this.urlHandlingStrategy.merge(c.url,this.rawUrlTree),v={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||QU(r.source)};this.scheduleNavigation(y,"imperative",null,v,{resolve:r.resolve,reject:r.reject,promise:r.promise})},0):r.resolve(!1)}else{this.restoreHistory(r,!0);const d=new RY(r.id,this.serializeUrl(r.extractedUrl),c);i.next(d);try{r.resolve(this.errorHandler(c))}catch(p){r.reject(p)}}return zn}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var r;const o={replaceUrl:!0},l=(null===(r=t.state)||void 0===r?void 0:r.navigationId)?t.state:null;if(l){const d=Object.assign({},l);delete d.navigationId,delete d.\u0275routerPageId,0!==Object.keys(d).length&&(o.state=d)}const c=this.parseUrl(t.url);this.scheduleNavigation(c,i,l,o)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){OU(t),this.config=t.map(II),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,i={}){const{relativeTo:r,queryParams:o,fragment:l,queryParamsHandling:c,preserveFragment:d}=i,p=r||this.routerState.root,y=d?this.currentUrlTree.fragment:l;let v=null;switch(c){case"merge":v=Object.assign(Object.assign({},this.currentUrlTree.queryParams),o);break;case"preserve":v=this.currentUrlTree.queryParams;break;default:v=o||null}return null!==v&&(v=this.removeEmptyProps(v)),function hK(n,e,t,i,r){if(0===t.length)return AI(e.root,e.root,e.root,i,r);const o=function dK(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new RU(!0,0,n);let e=0,t=!1;const i=n.reduce((r,o,l)=>{if("object"==typeof o&&null!=o){if(o.outlets){const c={};return Uo(o.outlets,(d,p)=>{c[p]="string"==typeof d?d.split("/"):d}),[...r,{outlets:c}]}if(o.segmentPath)return[...r,o.segmentPath]}return"string"!=typeof o?[...r,o]:0===l?(o.split("/").forEach((c,d)=>{0==d&&"."===c||(0==d&&""===c?t=!0:".."===c?e++:""!=c&&r.push(c))}),r):[...r,o]},[]);return new RU(t,e,i)}(t);if(o.toRoot())return AI(e.root,e.root,new Oi([],{}),i,r);const l=function fK(n,e,t){if(n.isAbsolute)return new DI(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const o=t.snapshot._urlSegment;return new DI(o,o===e.root,0)}const i=qC(n.commands[0])?0:1;return function pK(n,e,t){let i=n,r=e,o=t;for(;o>r;){if(o-=r,i=i.parent,!i)throw new Error("Invalid number of '../'");r=i.segments.length}return new DI(i,!1,r-o)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+i,n.numberOfDoubleDots)}(o,e,n),c=l.processChildren?jC(l.segmentGroup,l.index,o.commands):PU(l.segmentGroup,l.index,o.commands);return AI(e.root,l.segmentGroup,c,i,r)}(p,this.currentUrlTree,t,v,null!=y?y:null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=Jm(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,"imperative",null,i)}navigate(t,i={skipLocationChange:!1}){return function vZ(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return i}isActive(t,i){let r;if(r=!0===i?Object.assign({},yZ):!1===i?Object.assign({},_Z):i,Jm(t))return pU(this.currentUrlTree,t,r);const o=this.parseUrl(t);return pU(this.currentUrlTree,o,r)}removeEmptyProps(t){return Object.keys(t).reduce((i,r)=>{const o=t[r];return null!=o&&(i[r]=o),i},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new sb(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,i,r,o,l){var c,d;if(this.disposed)return Promise.resolve(!1);let p,y,v;l?(p=l.resolve,y=l.reject,v=l.promise):v=new Promise((S,E)=>{p=S,y=E});const x=++this.navigationId;let b;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),b=r&&r.\u0275routerPageId?r.\u0275routerPageId:o.replaceUrl||o.skipLocationChange?null!==(c=this.browserPageId)&&void 0!==c?c:0:(null!==(d=this.browserPageId)&&void 0!==d?d:0)+1):b=0,this.setTransition({id:x,targetPageId:b,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:o,resolve:p,reject:y,promise:v,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),v.catch(S=>Promise.reject(S))}setBrowserUrl(t,i){const r=this.urlSerializer.serialize(t),o=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",o):this.location.go(r,"",o)}restoreHistory(t,i=!1){var r,o;if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(r=this.currentNavigation)||void 0===r?void 0:r.finalUrl)||0===l?this.currentUrlTree===(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)&&0===l&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(l)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,i){const r=new sU(t.id,this.serializeUrl(t.extractedUrl),i);this.triggerEvent(r),t.resolve(!1)}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}}return n.\u0275fac=function(t){lf()},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();function QU(n){return"imperative"!==n}class eV{}class tV{preload(e,t){return si(null)}}let nV=(()=>{class n{constructor(t,i,r,o){this.router=t,this.injector=r,this.preloadingStrategy=o,this.loader=new ZU(r,i,d=>t.triggerEvent(new oU(d)),d=>t.triggerEvent(new aU(d)))}setUpPreloading(){this.subscription=this.router.events.pipe(bo(t=>t instanceof sb),Vy(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(Ph);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const r=[];for(const o of i)if(o.loadChildren&&!o.canLoad&&o._loadedConfig){const l=o._loadedConfig;r.push(this.processRoutes(l.module,l.routes))}else o.loadChildren&&!o.canLoad?r.push(this.preloadConfig(t,o)):o.children&&r.push(this.processRoutes(t,o.children));return ss(r).pipe(Ui(),Pn(o=>{}))}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?si(i._loadedConfig):this.loader.load(t.injector,i)).pipe(qi(o=>(i._loadedConfig=o,this.processRoutes(o.module,o.routes)))))}}return n.\u0275fac=function(t){return new(t||n)(Ot(dl),Ot(GF),Ot(Cr),Ot(eV))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),BI=(()=>{class n{constructor(t,i,r={}){this.router=t,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof xI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof sb&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof lU&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.router.triggerEvent(new lU(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){lf()},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const Qm=new Xn("ROUTER_CONFIGURATION"),iV=new Xn("ROUTER_FORROOT_GUARD"),MZ=[tR,{provide:_U,useClass:vU},{provide:dl,useFactory:function DZ(n,e,t,i,r,o,l={},c,d){const p=new dl(null,n,e,t,i,r,hU(o));return c&&(p.urlHandlingStrategy=c),d&&(p.routeReuseStrategy=d),function RZ(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(e.canceledNavigationResolution=n.canceledNavigationResolution)}(l,p),l.enableTracing&&p.events.subscribe(y=>{var v,x;null===(v=console.group)||void 0===v||v.call(console,`Router Event: ${y.constructor.name}`),console.log(y.toString()),console.log(y),null===(x=console.groupEnd)||void 0===x||x.call(console)}),p},deps:[_U,db,tR,Cr,GF,NI,Qm,[class fZ{},new Zu],[class uZ{},new Zu]]},db,{provide:Zm,useFactory:function PZ(n){return n.routerState.root},deps:[dl]},nV,tV,class wZ{preload(e,t){return t().pipe(cu(()=>si(null)))}},{provide:Qm,useValue:{enableTracing:!1}}];function SZ(){return new $F("Router",dl)}let EZ=(()=>{class n{constructor(t,i){}static forRoot(t,i){return{ngModule:n,providers:[MZ,rV(t),{provide:iV,useFactory:AZ,deps:[[dl,new Zu,new Gg]]},{provide:Qm,useValue:i||{}},{provide:Oy,useFactory:TZ,deps:[wm,[new Pv(eR),new Zu],Qm]},{provide:BI,useFactory:CZ,deps:[dl,hW,Qm]},{provide:eV,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:tV},{provide:$F,multi:!0,useFactory:SZ},[UI,{provide:UD,multi:!0,useFactory:IZ,deps:[UI]},{provide:sV,useFactory:LZ,deps:[UI]},{provide:HF,multi:!0,useExisting:sV}]]}}static forChild(t){return{ngModule:n,providers:[rV(t)]}}}return n.\u0275fac=function(t){return new(t||n)(Ot(iV,8),Ot(dl,8))},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})();function CZ(n,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new BI(n,e,t)}function TZ(n,e,t={}){return t.useHash?new K4(n,e):new fN(n,e)}function AZ(n){return"guarded"}function rV(n){return[{provide:oA,multi:!0,useValue:n},{provide:NI,multi:!0,useValue:n}]}let UI=(()=>{class n{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new zt}appInitializer(){return this.injector.get(X4,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const r=new Promise(c=>i=c),o=this.injector.get(dl),l=this.injector.get(Qm);return"disabled"===l.initialNavigation?(o.setUpLocationChangeListener(),i(!0)):"enabled"===l.initialNavigation||"enabledBlocking"===l.initialNavigation?(o.hooks.afterPreactivation=()=>this.initNavigation?si(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),o.initialNavigation()):i(!0),r})}bootstrapListener(t){const i=this.injector.get(Qm),r=this.injector.get(nV),o=this.injector.get(BI),l=this.injector.get(dl),c=this.injector.get(IS);t===c.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&l.initialNavigation(),r.setUpPreloading(),o.init(),l.resetRootComponentType(c.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(t){return new(t||n)(Ot(Cr))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();function IZ(n){return n.appInitializer.bind(n)}function LZ(n){return n.bootstrapListener.bind(n)}const sV=new Xn("Router Initializer");let oV=(()=>{class n{constructor(){this.sidebarWidth=new zt}setNewSidebarWidth(t){this.sidebarWidth.next(t)}getSidebarWidth(){return this.sidebarWidth}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const NZ=["addListener","removeListener"],OZ=["addEventListener","removeEventListener"],kZ=["on","off"];function gb(n,e,t,i){if(yt(t)&&(i=t,t=void 0),i)return gb(n,e,t).pipe(gI(i));const[r,o]=function VZ(n){return yt(n.addEventListener)&&yt(n.removeEventListener)}(n)?OZ.map(l=>c=>n[l](e,c,t)):function BZ(n){return yt(n.addListener)&&yt(n.removeListener)}(n)?NZ.map(aV(n,e)):function UZ(n){return yt(n.on)&&yt(n.off)}(n)?kZ.map(aV(n,e)):[];if(!r&&Ya(n))return qi(l=>gb(l,e,t))(pe(n));if(!r)throw new TypeError("Invalid event target");return new pr(l=>{const c=(...d)=>l.next(1<d.length?d:d[0]);return r(c),()=>o(c)})}function aV(n,e){return t=>i=>n[t](e,i)}function VI(n){let t,e=1/0;return null!=n&&("object"==typeof n?({count:e=1/0,delay:t}=n):e=n),e<=0?()=>zn:gi((i,r)=>{let l,o=0;const c=()=>{if(null==l||l.unsubscribe(),l=null,null!=t){const p="number"==typeof t?By(t):pe(t(o)),y=Mn(r,()=>{y.unsubscribe(),d()});p.subscribe(y)}else d()},d=()=>{let p=!1;l=i.subscribe(Mn(r,void 0,()=>{++o<e?l?c():p=!0:r.complete()})),p&&c()};d()})}const zZ={leading:!0,trailing:!1};function lV(n,e=zZ){return gi((t,i)=>{const{leading:r,trailing:o}=e;let l=!1,c=null,d=null,p=!1;const y=()=>{null==d||d.unsubscribe(),d=null,o&&(b(),p&&i.complete())},v=()=>{d=null,p&&i.complete()},x=S=>d=pe(n(S)).subscribe(Mn(i,y,v)),b=()=>{if(l){l=!1;const S=c;c=null,i.next(S),!p&&x(S)}};t.subscribe(Mn(i,S=>{l=!0,c=S,(!d||d.closed)&&(r?b():x(S))},()=>{p=!0,(!(o&&l&&d)||d.closed)&&i.complete()}))})}function zI(n){return gi((e,t)=>{pe(n).subscribe(Mn(t,()=>t.complete(),rs)),!t.closed&&e.subscribe(t)})}function cV(n){return"function"==typeof n}const ZZ=(n,e)=>{let t=0;for(;t<e.length;){if(n(e[t]))return!0;t+=1}return!1},QC=n=>n,JZ=n=>null==n,wu="undefined"!=typeof navigator&&navigator.userAgent.includes("Mac OS"),eT={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",cmd:wu?"metaKey":"ctrlKey",command:wu?"metaKey":"ctrlKey",meta:wu?"metaKey":"ctrlKey","left command":"metaKey","right command":"MetaRight","\u2318":wu?"metaKey":"ctrlKey",option:"altKey",ctl:"ctrlKey",control:"ctrlKey"},tT={plus:"+"},nT={8:"backspace",9:"tab",13:"enter",16:"shift",17:["ctrl","control"],18:"alt",20:"capslock",27:["esc","escape"],32:["space","spc"],33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:["meta","cmd","command"],93:["meta","cmd","command"],224:["meta","cmd","command"]},hV={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},HI={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},nJ=function KZ(n){const e={};for(const t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}(HI);for(let n=1;n<20;++n)nT[111+n]="f"+n;for(let n=0;n<=9;++n)nT[n+96]=n.toString();var Bf=(()=>{return(n=Bf||(Bf={})).Textarea="TEXTAREA",n.Input="INPUT",n.Select="SELECT",n.ContentEditable="CONTENT-EDITABLE",Bf;var n})();let iJ=0,yb=(()=>{class n{constructor(t){this.document=t,this._shortcuts=[],this._sequences=[],this.throttleTime=0,this._pressed=new zt,this.pressed$=this._pressed.asObservable(),this.disabled=!1,this._shortcutsSub=new $l([]),this.shortcuts$=this._shortcutsSub.pipe(bo(i=>!!i.length)),this._ignored=[Bf.Input,Bf.Textarea,Bf.Select,Bf.ContentEditable],this.isAllowed=i=>{const r=i.event.target,o=!!r.getAttribute("contenteditable"),l=o?Bf.ContentEditable:r.nodeName;return r===i.target||(i.allowIn.length?!((n,e)=>this._ignored.filter(t=>!e.includes(t)))(0,i.allowIn).includes(l):!o&&!this._ignored.includes(r.nodeName))},this.mapEvent=i=>this._shortcuts.filter(r=>!r.isSequence).map(r=>Object.assign({},r,{predicates:ZZ(QC,r.predicates.map(o=>(n=>(...e)=>{let t=0;const i=n.length;for(;t<i;){if(!n[t].apply(void 0,e))return!1;t+=1}return!0})(o)(i))),event:i})).filter(r=>r.predicates).reduce((r,o)=>r.priority>o.priority?r:o,{priority:0}),this.subscriptions=[],this.keydown$=gb(this.document,"keydown"),this.ignore$=this.pressed$.pipe(bo(i=>i.event.defaultPrevented),vu(()=>this.clicks$.pipe($m())),Zs(i=>{i.preventDefault(),i.stopPropagation()}),VI()),this.clicks$=gb(this.document,"click",{capture:!0}),this.keyup$=gb(this.document,"keyup"),this.keydownCombo$=this.keydown$.pipe(bo(i=>!this.disabled),Pn(this.mapEvent),bo(i=>!i.target||i.event.target===i.target),bo(i=>cV(i.command)),bo(i=>this.isAllowed(i)),Zs(i=>{!i.preventDefault||(i.event.preventDefault(),i.event.stopPropagation())}),lV(i=>By(i.throttleTime)),Zs(i=>i.command({event:i.event,key:i.key})),Zs(i=>this._pressed.next({event:i.event,key:i.key})),zI(this.keyup$),VI(),cu(i=>Uy(i))),this.timer$=new zt,this.resetCounter$=this.timer$.asObservable().pipe(vu(()=>By(n.TIMEOUT_SEQUENCE))),this.keydownSequence$=this.keydown$.pipe(Pn(i=>({event:i,sequences:this._sequences})),_I((i,r)=>{const{event:o}=r,l=i.events.length,c=l?i.sequences:r.sequences,[d]=this.characterFromEvent(o),p=Array.isArray(d)?[...d,o.key]:[d,o.key],y=c.map(b=>{const S=b.sequence.filter(T=>p.some(N=>(tT[T[l]]||T[l])===N)),E=S.length>0;return b.fullMatch?b:Object.assign(Object.assign({},b),{sequence:S,partialMatch:E,event:o,fullMatch:E&&this.isFullMatch({command:b,events:i.events})})}).filter(b=>b.partialMatch||b.fullMatch),[v]=y;if(!v||this.modifiersOn(o))return{events:[],sequences:this._sequences};const x=((n,e)=>e.reduce((t,i)=>{const r=(n=>e=>e[n])(n);return r(i)>r(t)?i:t},{[n]:0}))("priority",y);return y.length>1&&x.fullMatch?{events:[],command:x,sequences:this._sequences}:y.length>1?{events:[...i.events,o],command:y,sequences:y}:v.fullMatch?{events:[],command:v,sequences:this._sequences}:{events:[...i.events,o],command:y,sequences:y}},{events:[],sequences:[]}),vu(({command:i})=>Array.isArray(i)?By(500).pipe(Pn(()=>({command:i.filter(r=>r.fullMatch)[0]}))):si({command:i})),zI(this.pressed$),bo(({command:i})=>i&&i.fullMatch),Pn(({command:i})=>i),bo(i=>cV(i.command)),bo(i=>!i.target||i.event.target===i.target),bo(this.isAllowed),Zs(i=>!i.preventDefault||i.event.preventDefault()),lV(i=>By(i.throttleTime)),Zs(i=>i.command({event:i.event,key:i.key})),Zs(i=>this._pressed.next({event:i.event,key:i.key})),zI(this.resetCounter$),VI()),this.getKeys=i=>i.map(r=>r.trim()).filter(r=>"+"!==r).map(r=>eT.hasOwnProperty(r=tT[r]||r)?o=>!!o[eT[r]]:o=>{const l=r===r.toUpperCase(),c=/[^a-zA-Z\d\s:]/.test(r),d=nJ[r],[p]=this.characterFromEvent(o),v=Object.keys(eT).map(b=>eT[b]).some(b=>o[b]),x=Array.isArray(p)?[...p,o.key]:[p,o.key];return!(v&&(!l||c)&&!d&&1===i.length)&&x.some(b=>!(b!==r||!l)||r===b)}),this.subscriptions.push(this.keydownSequence$.subscribe(),this.keydownCombo$.subscribe())}isFullMatch({command:t,events:i}){return!!t&&t.sequence.some(r=>r.length===i.length+1)}get shortcuts(){return this._shortcuts}_characterFromEvent(t){return"number"!=typeof t.which&&(t.which=t.keyCode),tT[t.which]?[tT[t.which],t.shiftKey]:nT[t.which]?[nT[t.which],t.shiftKey]:hV[t.which]?[hV[t.which],t.shiftKey]:String.fromCharCode(t.which).toLowerCase()!==t.key?[String.fromCharCode(t.which).toLowerCase(),t.shiftKey]:[t.key,t.shiftKey]}characterFromEvent(t){const[i,r]=this._characterFromEvent(t);return r&&HI[i]?[HI[i],r]:[i,r]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}isSequence(t){return!t.some(i=>i.includes("+")||1===i.length)}add(t){t=Array.isArray(t)?t:[t];const i=this.parseCommand(t);return i.forEach(r=>{r.isSequence?this._sequences.push(r):this._shortcuts.push(r)}),setTimeout(()=>{this._shortcutsSub.next([...this._shortcuts,...this._sequences])}),i.map(r=>r.id)}remove(t){return t=Array.isArray(t)?t:[t],this._shortcuts=this._shortcuts.filter(i=>!t.includes(i.id)),this._sequences=this._sequences.filter(i=>!t.includes(i.id)),setTimeout(()=>{this._shortcutsSub.next([...this._shortcuts,...this._sequences])}),this}select(t){return this.pressed$.pipe(bo(({key:r})=>!!(r=Array.isArray(r)?r:[r]).find(o=>o===t)))}modifiersOn(t){return["metaKey","altKey","ctrlKey"].some(i=>t[i])}parseCommand(t){return(Array.isArray(t)?t:[t]).map(r=>{const o=Array.isArray(r.key)?r.key:[r.key],l=Math.max(...o.map(y=>y.split(" ").filter(QC).length)),c=o.map(y=>this.getKeys(y.split(" ").filter(QC))),d=this.isSequence(o),p=d?o.map(y=>y.split(" ").filter(QC).map(v=>v.trim())):[];return Object.assign(Object.assign({},r),{isSequence:d,sequence:d?p:[],allowIn:r.allowIn||[],key:o,id:""+iJ++,throttle:JZ(r.throttleTime)?this.throttleTime:r.throttleTime,priority:l,predicates:c})})}}return n.TIMEOUT_SEQUENCE=1e3,n.\u0275fac=function(t){return new(t||n)(Ot(xo))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),rJ=(()=>{class n{constructor(t){this.keyboard=t,this.shortcuts=[],this.clearIds=[],this._disabled=!1}set disabled(t){this._disabled=t,this.clearIds&&(this.keyboard.remove(this.clearIds),this.clearIds=[]),!t&&(this.clearIds=this.keyboard.add(this.shortcuts))}select(t){return this.keyboard.select(t)}ngOnChanges(t){!t.shortcuts||!t.shortcuts.currentValue||(this.clearIds&&this.keyboard.remove(this.clearIds),this._disabled||setTimeout(()=>this.clearIds=this.keyboard.add(t.shortcuts.currentValue)))}ngOnDestroy(){this.keyboard.remove(this.clearIds)}}return n.\u0275fac=function(t){return new(t||n)(Te(yb))},n.\u0275cmp=Ao({type:n,selectors:[["ng-keyboard-shortcuts"]],inputs:{shortcuts:"shortcuts",disabled:"disabled"},features:[Ms],decls:0,vars:0,template:function(t,i){},encapsulation:2}),n})(),sJ=(()=>{class n{constructor(t){this.keyboard=t,this.shortcuts$=this.keyboard.shortcuts$.pipe(Pn(i=>i.filter(r=>Boolean(r.label)&&Boolean(r.description)).map(({key:r,label:o,description:l})=>({key:r,label:o,description:l}))))}}return n.\u0275fac=function(t){return new(t||n)(Ot(yb))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),oJ=(()=>{class n{constructor(t){this.keyboardService=t}select(t){return this.keyboardService.select(t)}}return n.\u0275fac=function(t){return new(t||n)(Ot(yb))},n.\u0275prov=yn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const uJ={multi:!0,provide:yx,useClass:(()=>{class n{constructor(t,i){this.ngZone=t,this.keyboard=i}supports(t){return t.split(".").includes("shortcut")}addEventListener(t,i,r){const o=i.split("."),l=o.includes("prevent");if(0===o.length)throw new Error("please provide a shortcut");const[,c,d,p]=o,y=this.keyboard.add({key:c,command(v){r(v)},description:d,preventDefault:l,label:p});return()=>{this.keyboard.remove(y)}}}return n.\u0275fac=function(t){return new(t||n)(Ot(As),Ot(yb))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})()};let hJ=(()=>{class n{static forRoot(){return{ngModule:n,providers:[yb,sJ,oJ,uJ]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({imports:[[pR]]}),n})();"undefined"!=typeof Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(n){let e=this;do{if(e.matches(n))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null})),Array.prototype.flat||(Array.prototype.flat=function(n){var e=[];return function t(i,r){for(let o of i)Array.isArray(o)&&r>0?t(o,r-1):e.push(o)}(this,Math.floor(n)||1),e}),Array.prototype.flatMap||(Array.prototype.flatMap=function(){return Array.prototype.map.apply(this,arguments).flat(1)});const dJ=["target"];let fJ=(()=>{class n{constructor(t,i,r,o,l,c,d){this.sceneElementsService=t,this.ws=i,this.clipboard=r,this.platform=o,this.activateRoute=l,this.colWidthService=c,this.http=d,this.canvasWidth=75,this.shortcuts=[],this.viewer=new nY(t,i,d),this.data={sceneId:-1,elements:[]}}ngOnInit(){this.colWidthService.getSidebarWidth().subscribe(t=>{this.canvasWidth=t}),this.ws.getMessage(LC.getAnimationEvent).subscribe(t=>{var i,r;t.screenshot&&(null===(i=this.viewer)||void 0===i||i.saveScreenshot(t.screenshotDirectory)),null===(r=this.viewer)||void 0===r||r.setCameraState(t.cameraState)})}ngAfterViewInit(){this.start(),this.shortcuts.push({key:["ctrl + c","cmd + c"],preventDefault:!0,command:()=>{let t=JSON.stringify(this.viewer.getCurrentCameraState());console.log("[Info]: Copying state to clipboard."),this.clipboard.copy(t)}},{key:["ctrl + v","cmd + v"],preventDefault:!0,command:()=>{this.platform.FIREFOX?console.info("Pasting only supported on Chromium Browsers."):navigator.clipboard.readText().then(t=>{console.log("[Info]: Pasting camera position."),this.viewer.setCameraState(JSON.parse(t))})}},{key:["h","H"],preventDefault:!0,command:()=>{this.colWidthService.setNewSidebarWidth(75===this.canvasWidth?100:75)}},{key:["a","A"],preventDefault:!0,command:()=>{this.ws.startAnimation(this.data.sceneId,"animation_1",!0)}},{key:["s","S"],preventDefault:!0,command:()=>{this.viewer.saveScreenshot("keyboard")}}),this.activateRoute.queryParams.subscribe(t=>{0!=Object.keys(t).length&&this.viewer.setCameraState(Mx.urlToCameraState(t))})}start(){null!=this.target?(this.viewer.initialize(this.target.nativeElement),console.info("Initialize Viewer with SceneId: "+this.data.sceneId),this.data.viewer=this.viewer,this.sceneElementsService.addViewerData(this.data),this.data.elements.map(t=>{switch(t.sceneType){case Wa.POTREE_POINT_CLOUD:this.addPotreePointCloud(t.source,t.attributes,t.elementId);break;case Wa.LINE_SET:this.addLineSet(t.source,t.attributes,t.elementId);break;case Wa.CAMERA_TRAJECTORY:this.addCameraTrajectory(t.source,t.attributes,t.elementId);break;case Wa.DEFAULT_POINT_CLOUD:this.addDefaultPointCloud(t.source,t.attributes,t.elementId)}})):console.error("Target element not found")}addDefaultPointCloud(t,i,r){this.viewer.loadDefaultPC(t).then(o=>{var l,c,d;i.transformation&&o.applyMatrix4((new Tt).fromArray(i.transformation)),o.name=i.name,(null===(l=i.material)||void 0===l?void 0:l.pointSize)&&o.setPointSize(i.material.pointSize),(null===(c=i.material)||void 0===c?void 0:c.color)&&o.setColor(i.material.color),(null===(d=i.material)||void 0===d?void 0:d.opacity)&&o.setOpacity(i.material.opacity),this.sceneElementsService.addSceneElement(this.data.sceneId,r,o)})}addCameraTrajectory(t,i,r){var o,l,c,d;let p=new oY(t);p.name=i.name,(null===(o=i.material)||void 0===o?void 0:o.color)?p.setColor(i.material.color):p.setColor("#FF0000"),(null===(l=i.material)||void 0===l?void 0:l.frustumSize)?p.setFrustumSize(i.material.frustumSize):p.setFrustumSize(.5),(null===(c=i.material)||void 0===c?void 0:c.opacity)&&p.setOpacity(i.material.opacity),(null===(d=i.material)||void 0===d?void 0:d.lineWidth)&&p.setLineWidth(i.material.lineWidth),i.transformation&&p.applyMatrix4((new Tt).fromArray(i.transformation)),this.viewer.loadCameraTrajectory(p),this.sceneElementsService.addSceneElement(this.data.sceneId,r,p)}addLineSet(t,i,r){var o,l,c;let d=[];t.forEach(y=>{let v=new $;v.fromArray(y[0]);let x=new $;x.fromArray(y[1]),d.push([v,x])});let p=new fI(d);p.name=i.name,(null===(o=i.material)||void 0===o?void 0:o.color)?p.setColor(i.material.color):p.setColor("#FF0000"),(null===(l=i.material)||void 0===l?void 0:l.lineWidth)&&p.setColor(i.material.lineWidth),(null===(c=i.material)||void 0===c?void 0:c.opacity)&&p.setOpacity(i.material.opacity),i.transformation&&p.applyMatrix4((new Tt).fromArray(i.transformation)),this.viewer.loadLineSet(p),this.sceneElementsService.addSceneElement(this.data.sceneId,r,p)}addPotreePointCloud(t,i,r){this.viewer.loadPotreePCO("cloud.js",t).then(o=>{var l,c,d,p;let y=new aY(o);y.setName(i.name),(null===(l=i.material)||void 0===l?void 0:l.color)&&y.setColor(i.material.color),(null===(c=i.material)||void 0===c?void 0:c.opacity)&&y.setOpacity(i.material.opacity),(null===(d=i.material)||void 0===d?void 0:d.pointType)&&y.setPointShape(i.material.pointType),(null===(p=i.material)||void 0===p?void 0:p.pointSize)&&y.setPointSize(i.material.pointSize),i.transformation&&y.applyMatrix4((new Tt).fromArray(i.transformation)),this.sceneElementsService.addSceneElement(this.data.sceneId,r,y)})}}return n.\u0275fac=function(t){return new(t||n)(Te(wx),Te(LC),Te(KB),Te(uY),Te(Zm),Te(oV),Te(QS))},n.\u0275cmp=Ao({type:n,selectors:[["app-scene"]],viewQuery:function(t,i){if(1&t&&ax(dJ,5),2&t){let r;_m(r=vm())&&(i.target=r.first)}},inputs:{data:"data"},decls:3,vars:5,consts:[[1,"scene-target"],["target",""],[3,"shortcuts"]],template:function(t,i){1&t&&ur(0,"div",0,1)(2,"ng-keyboard-shortcuts",2),2&t&&(Qr("width",i.canvasWidth,"%")("left",100-i.canvasWidth,"%"),at(2),nt("shortcuts",i.shortcuts))},directives:[rJ],styles:[".scene-target[_ngcontent-%COMP%]{position:absolute;width:75%;height:100%;left:25%;top:0}"]}),n})();const pJ=["dialogPopup"],mJ=["hueSlider"],gJ=["alphaSlider"];function yJ(n,e){if(1&n&&ur(0,"div"),2&n){const t=Oe();(function ft(n,e,t){s(la,Nl,bh(ot(),n,e,t),!0)})("arrow arrow-",t.cpUsePosition,""),Qr("top",t.arrowTop,"px")}}function _J(n,e){if(1&n){const t=zi();We(0,"div",28),Ft("newValue",function(r){return vt(t),Oe().onColorChange(r)})("dragStart",function(){return vt(t),Oe().onDragStart("saturation-lightness")})("dragEnd",function(){return vt(t),Oe().onDragEnd("saturation-lightness")}),ur(1,"div",14),Ne()}if(2&n){const t=Oe();Qr("background-color",t.hueSliderColor),nt("rgX",1)("rgY",1),at(1),Qr("top",null==t.slider?null:t.slider.v,"px")("left",null==t.slider?null:t.slider.s,"px")}}function vJ(n,e){1&n&&(function tw(){Qt.lFrame.currentNamespace="svg"}(),We(0,"svg",29),ur(1,"path",30)(2,"path",31),Ne())}function xJ(n,e){if(1&n){const t=zi();We(0,"button",32),Ft("click",function(r){vt(t);const o=Oe();return o.onAddPresetColor(r,o.selectedColor)}),B(1),Ne()}if(2&n){const t=Oe();Ch(t.cpAddColorButtonClass),nt("disabled",t.cpPresetColors&&t.cpPresetColors.length>=t.cpMaxPresetColorsLength),at(1),G(" ",t.cpAddColorButtonText," ")}}function bJ(n,e){1&n&&ur(0,"div",33)}function wJ(n,e){if(1&n){const t=zi();We(0,"input",39),Ft("keyup.enter",function(r){return vt(t),Oe(2).onAcceptColor(r)})("newValue",function(r){return vt(t),Oe(2).onAlphaInput(r)}),Ne()}if(2&n){const t=Oe(2);nt("rg",1)("value",null==t.cmykText?null:t.cmykText.a)}}function MJ(n,e){1&n&&(We(0,"div"),B(1,"A"),Ne())}function SJ(n,e){if(1&n){const t=zi();We(0,"div",34)(1,"div",35)(2,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onCyanInput(r)}),Ne(),We(3,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onMagentaInput(r)}),Ne(),We(4,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onYellowInput(r)}),Ne(),We(5,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onBlackInput(r)}),Ne(),xn(6,wJ,1,2,"input",37),Ne(),We(7,"div",35)(8,"div"),B(9,"C"),Ne(),We(10,"div"),B(11,"M"),Ne(),We(12,"div"),B(13,"Y"),Ne(),We(14,"div"),B(15,"K"),Ne(),xn(16,MJ,2,0,"div",38),Ne()()}if(2&n){const t=Oe();Qr("display",3!==t.format?"none":"block"),at(2),nt("rg",100)("value",null==t.cmykText?null:t.cmykText.c),at(1),nt("rg",100)("value",null==t.cmykText?null:t.cmykText.m),at(1),nt("rg",100)("value",null==t.cmykText?null:t.cmykText.y),at(1),nt("rg",100)("value",null==t.cmykText?null:t.cmykText.k),at(1),nt("ngIf","disabled"!==t.cpAlphaChannel),at(10),nt("ngIf","disabled"!==t.cpAlphaChannel)}}function EJ(n,e){if(1&n){const t=zi();We(0,"input",39),Ft("keyup.enter",function(r){return vt(t),Oe(2).onAcceptColor(r)})("newValue",function(r){return vt(t),Oe(2).onAlphaInput(r)}),Ne()}if(2&n){const t=Oe(2);nt("rg",1)("value",null==t.hslaText?null:t.hslaText.a)}}function CJ(n,e){1&n&&(We(0,"div"),B(1,"A"),Ne())}function TJ(n,e){if(1&n){const t=zi();We(0,"div",40)(1,"div",35)(2,"input",41),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onHueInput(r)}),Ne(),We(3,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onSaturationInput(r)}),Ne(),We(4,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onLightnessInput(r)}),Ne(),xn(5,EJ,1,2,"input",37),Ne(),We(6,"div",35)(7,"div"),B(8,"H"),Ne(),We(9,"div"),B(10,"S"),Ne(),We(11,"div"),B(12,"L"),Ne(),xn(13,CJ,2,0,"div",38),Ne()()}if(2&n){const t=Oe();Qr("display",2!==t.format?"none":"block"),at(2),nt("rg",360)("value",null==t.hslaText?null:t.hslaText.h),at(1),nt("rg",100)("value",null==t.hslaText?null:t.hslaText.s),at(1),nt("rg",100)("value",null==t.hslaText?null:t.hslaText.l),at(1),nt("ngIf","disabled"!==t.cpAlphaChannel),at(8),nt("ngIf","disabled"!==t.cpAlphaChannel)}}function AJ(n,e){if(1&n){const t=zi();We(0,"input",39),Ft("keyup.enter",function(r){return vt(t),Oe(2).onAcceptColor(r)})("newValue",function(r){return vt(t),Oe(2).onAlphaInput(r)}),Ne()}if(2&n){const t=Oe(2);nt("rg",1)("value",null==t.rgbaText?null:t.rgbaText.a)}}function DJ(n,e){1&n&&(We(0,"div"),B(1,"A"),Ne())}function RJ(n,e){if(1&n){const t=zi();We(0,"div",42)(1,"div",35)(2,"input",43),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onRedInput(r)}),Ne(),We(3,"input",43),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onGreenInput(r)}),Ne(),We(4,"input",43),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onBlueInput(r)}),Ne(),xn(5,AJ,1,2,"input",37),Ne(),We(6,"div",35)(7,"div"),B(8,"R"),Ne(),We(9,"div"),B(10,"G"),Ne(),We(11,"div"),B(12,"B"),Ne(),xn(13,DJ,2,0,"div",38),Ne()()}if(2&n){const t=Oe();Qr("display",1!==t.format?"none":"block"),at(2),nt("rg",255)("value",null==t.rgbaText?null:t.rgbaText.r),at(1),nt("rg",255)("value",null==t.rgbaText?null:t.rgbaText.g),at(1),nt("rg",255)("value",null==t.rgbaText?null:t.rgbaText.b),at(1),nt("ngIf","disabled"!==t.cpAlphaChannel),at(8),nt("ngIf","disabled"!==t.cpAlphaChannel)}}function PJ(n,e){if(1&n){const t=zi();We(0,"input",39),Ft("keyup.enter",function(r){return vt(t),Oe(2).onAcceptColor(r)})("newValue",function(r){return vt(t),Oe(2).onAlphaInput(r)}),Ne()}if(2&n){const t=Oe(2);nt("rg",1)("value",t.hexAlpha)}}function IJ(n,e){1&n&&(We(0,"div"),B(1,"A"),Ne())}function LJ(n,e){if(1&n){const t=zi();We(0,"div",44)(1,"div",35)(2,"input",45),Ft("blur",function(){return vt(t),Oe().onHexInput(null)})("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onHexInput(r)}),Ne(),xn(3,PJ,1,2,"input",37),Ne(),We(4,"div",35)(5,"div"),B(6,"Hex"),Ne(),xn(7,IJ,2,0,"div",38),Ne()()}if(2&n){const t=Oe();Qr("display",0!==t.format?"none":"block"),hf("hex-alpha","forced"===t.cpAlphaChannel),at(2),nt("value",t.hexText),at(1),nt("ngIf","forced"===t.cpAlphaChannel),at(4),nt("ngIf","forced"===t.cpAlphaChannel)}}function FJ(n,e){if(1&n){const t=zi();We(0,"input",39),Ft("keyup.enter",function(r){return vt(t),Oe(2).onAcceptColor(r)})("newValue",function(r){return vt(t),Oe(2).onAlphaInput(r)}),Ne()}if(2&n){const t=Oe(2);nt("rg",1)("value",null==t.hslaText?null:t.hslaText.a)}}function NJ(n,e){if(1&n){const t=zi();We(0,"div",46)(1,"div",35)(2,"input",36),Ft("keyup.enter",function(r){return vt(t),Oe().onAcceptColor(r)})("newValue",function(r){return vt(t),Oe().onValueInput(r)}),Ne(),xn(3,FJ,1,2,"input",37),Ne(),We(4,"div",35)(5,"div"),B(6,"V"),Ne(),We(7,"div"),B(8,"A"),Ne()()()}if(2&n){const t=Oe();at(2),nt("rg",100)("value",null==t.hslaText?null:t.hslaText.l),at(1),nt("ngIf","disabled"!==t.cpAlphaChannel)}}function OJ(n,e){if(1&n){const t=zi();We(0,"div",47)(1,"span",48),Ft("click",function(){return vt(t),Oe().onFormatToggle(-1)}),Ne(),We(2,"span",48),Ft("click",function(){return vt(t),Oe().onFormatToggle(1)}),Ne()()}}function kJ(n,e){if(1&n){const t=zi();We(0,"span",55),Ft("click",function(r){vt(t);const o=Oe().$implicit;return Oe(3).onRemovePresetColor(r,o)}),Ne()}2&n&&Ch(Oe(4).cpRemoveColorButtonClass)}function BJ(n,e){if(1&n){const t=zi();We(0,"div",53),Ft("click",function(){const o=vt(t).$implicit;return Oe(3).setColorFromString(o)}),xn(1,kJ,1,3,"span",54),Ne()}if(2&n){const t=e.$implicit,i=Oe(3);Qr("background-color",t),at(1),nt("ngIf",i.cpAddColorButton)}}function UJ(n,e){if(1&n&&(We(0,"div"),xn(1,BJ,2,3,"div",52),Ne()),2&n){const t=Oe(2);Ch(t.cpPresetColorsClass),at(1),nt("ngForOf",t.cpPresetColors)}}function VJ(n,e){if(1&n&&(We(0,"div"),B(1),Ne()),2&n){const t=Oe(2);Ch(t.cpPresetEmptyMessageClass),at(1),j(t.cpPresetEmptyMessage)}}function zJ(n,e){if(1&n&&(We(0,"div",49),ur(1,"hr"),We(2,"div",50),B(3),Ne(),xn(4,UJ,2,4,"div",51),xn(5,VJ,2,4,"div",51),Ne()),2&n){const t=Oe();at(3),j(t.cpPresetLabel),at(1),nt("ngIf",null==t.cpPresetColors?null:t.cpPresetColors.length),at(1),nt("ngIf",!(null!=t.cpPresetColors&&t.cpPresetColors.length)&&t.cpAddColorButton)}}function HJ(n,e){if(1&n){const t=zi();We(0,"button",58),Ft("click",function(r){return vt(t),Oe(2).onCancelColor(r)}),B(1),Ne()}if(2&n){const t=Oe(2);Ch(t.cpCancelButtonClass),at(1),j(t.cpCancelButtonText)}}function GJ(n,e){if(1&n){const t=zi();We(0,"button",58),Ft("click",function(r){return vt(t),Oe(2).onAcceptColor(r)}),B(1),Ne()}if(2&n){const t=Oe(2);Ch(t.cpOKButtonClass),at(1),j(t.cpOKButtonText)}}function WJ(n,e){if(1&n&&(We(0,"div",56),xn(1,HJ,2,4,"button",57),xn(2,GJ,2,4,"button",57),Ne()),2&n){const t=Oe();at(1),nt("ngIf",t.cpCancelButton),at(1),nt("ngIf",t.cpOKButton)}}function qJ(n,e){1&n&&Ay(0)}function jJ(n,e){if(1&n&&(We(0,"div",59),xn(1,qJ,1,0,"ng-container",60),Ne()),2&n){const t=Oe();at(1),nt("ngTemplateOutlet",t.cpExtraTemplate)}}var Vo=(()=>{return(n=Vo||(Vo={}))[n.HEX=0]="HEX",n[n.RGBA=1]="RGBA",n[n.HSLA=2]="HSLA",n[n.CMYK=3]="CMYK",Vo;var n})();class Qh{constructor(e,t,i,r){this.r=e,this.g=t,this.b=i,this.a=r}}class rT{constructor(e,t,i,r){this.h=e,this.s=t,this.v=i,this.a=r}}class eg{constructor(e,t,i,r){this.h=e,this.s=t,this.l=i,this.a=r}}class _b{constructor(e,t,i,r,o=1){this.c=e,this.m=t,this.y=i,this.k=r,this.a=o}}let YJ=(()=>{class n{constructor(){this.newValue=new wi}inputChange(t){const i=t.target.value;if(void 0===this.rg)this.newValue.emit(i);else{const r=parseFloat(i);this.newValue.emit({v:r,rg:this.rg})}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Sn({type:n,selectors:[["","text",""]],hostBindings:function(t,i){1&t&&Ft("input",function(o){return i.inputChange(o)})},inputs:{rg:"rg",text:"text"},outputs:{newValue:"newValue"}}),n})(),KJ=(()=>{class n{constructor(t){this.elRef=t,this.dragEnd=new wi,this.dragStart=new wi,this.newValue=new wi,this.listenerMove=i=>this.move(i),this.listenerStop=()=>this.stop()}mouseDown(t){this.start(t)}touchStart(t){this.start(t)}move(t){t.preventDefault(),this.setCursor(t)}start(t){this.setCursor(t),t.stopPropagation(),document.addEventListener("mouseup",this.listenerStop),document.addEventListener("touchend",this.listenerStop),document.addEventListener("mousemove",this.listenerMove),document.addEventListener("touchmove",this.listenerMove),this.dragStart.emit()}stop(){document.removeEventListener("mouseup",this.listenerStop),document.removeEventListener("touchend",this.listenerStop),document.removeEventListener("mousemove",this.listenerMove),document.removeEventListener("touchmove",this.listenerMove),this.dragEnd.emit()}getX(t){const i=this.elRef.nativeElement.getBoundingClientRect();return(void 0!==t.pageX?t.pageX:t.touches[0].pageX)-i.left-window.pageXOffset}getY(t){const i=this.elRef.nativeElement.getBoundingClientRect();return(void 0!==t.pageY?t.pageY:t.touches[0].pageY)-i.top-window.pageYOffset}setCursor(t){const i=this.elRef.nativeElement.offsetWidth,r=this.elRef.nativeElement.offsetHeight,o=Math.max(0,Math.min(this.getX(t),i)),l=Math.max(0,Math.min(this.getY(t),r));void 0!==this.rgX&&void 0!==this.rgY?this.newValue.emit({s:o/i,v:1-l/r,rgX:this.rgX,rgY:this.rgY}):void 0===this.rgX&&void 0!==this.rgY?this.newValue.emit({v:l/r,rgY:this.rgY}):void 0!==this.rgX&&void 0===this.rgY&&this.newValue.emit({v:o/i,rgX:this.rgX})}}return n.\u0275fac=function(t){return new(t||n)(Te(Yo))},n.\u0275dir=Sn({type:n,selectors:[["","slider",""]],hostBindings:function(t,i){1&t&&Ft("mousedown",function(o){return i.mouseDown(o)})("touchstart",function(o){return i.touchStart(o)})},inputs:{rgX:"rgX",rgY:"rgY",slider:"slider"},outputs:{dragEnd:"dragEnd",dragStart:"dragStart",newValue:"newValue"}}),n})();class pV{constructor(e,t,i,r){this.h=e,this.s=t,this.v=i,this.a=r}}class mV{constructor(e,t,i,r){this.h=e,this.s=t,this.v=i,this.a=r}}let GI=(()=>{class n{constructor(){this.active=null}setActive(t){this.active&&this.active!==t&&"inline"!==this.active.cpDialogDisplay&&this.active.closeDialog(),this.active=t}hsva2hsla(t){const i=t.h,r=t.s,o=t.v,l=t.a;if(0===o)return new eg(i,0,0,l);if(0===r&&1===o)return new eg(i,1,1,l);{const c=o*(2-r)/2;return new eg(i,o*r/(1-Math.abs(2*c-1)),c,l)}}hsla2hsva(t){const i=Math.min(t.h,1),r=Math.min(t.s,1),o=Math.min(t.l,1),l=Math.min(t.a,1);if(0===o)return new rT(i,0,0,l);{const c=o+r*(1-Math.abs(2*o-1))/2;return new rT(i,2*(c-o)/c,c,l)}}hsvaToRgba(t){let i,r,o;const l=t.h,c=t.s,d=t.v,p=t.a,y=Math.floor(6*l),v=6*l-y,x=d*(1-c),b=d*(1-v*c),S=d*(1-(1-v)*c);switch(y%6){case 0:i=d,r=S,o=x;break;case 1:i=b,r=d,o=x;break;case 2:i=x,r=d,o=S;break;case 3:i=x,r=b,o=d;break;case 4:i=S,r=x,o=d;break;case 5:i=d,r=x,o=b;break;default:i=0,r=0,o=0}return new Qh(i,r,o,p)}cmykToRgb(t){return new Qh((1-t.c)*(1-t.k),(1-t.m)*(1-t.k),(1-t.y)*(1-t.k),t.a)}rgbaToCmyk(t){const i=1-Math.max(t.r,t.g,t.b);return 1===i?new _b(0,0,0,1,t.a):new _b((1-t.r-i)/(1-i),(1-t.g-i)/(1-i),(1-t.b-i)/(1-i),i,t.a)}rgbaToHsva(t){let i,r;const o=Math.min(t.r,1),l=Math.min(t.g,1),c=Math.min(t.b,1),d=Math.min(t.a,1),p=Math.max(o,l,c),y=Math.min(o,l,c),v=p,x=p-y;if(r=0===p?0:x/p,p===y)i=0;else{switch(p){case o:i=(l-c)/x+(l<c?6:0);break;case l:i=(c-o)/x+2;break;case c:i=(o-l)/x+4;break;default:i=0}i/=6}return new rT(i,r,v,d)}rgbaToHex(t,i){let r="#"+(16777216|t.r<<16|t.g<<8|t.b).toString(16).substr(1);return i&&(r+=(256|Math.round(255*t.a)).toString(16).substr(1)),r}normalizeCMYK(t){return new _b(t.c/100,t.m/100,t.y/100,t.k/100,t.a)}denormalizeCMYK(t){return new _b(Math.floor(100*t.c),Math.floor(100*t.m),Math.floor(100*t.y),Math.floor(100*t.k),t.a)}denormalizeRGBA(t){return new Qh(Math.round(255*t.r),Math.round(255*t.g),Math.round(255*t.b),t.a)}stringToHsva(t="",i=!1){let r=null;t=(t||"").toLowerCase();const o=[{re:/(rgb)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*%?,\s*(\d{1,3})\s*%?(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(l){return new Qh(parseInt(l[2],10)/255,parseInt(l[3],10)/255,parseInt(l[4],10)/255,isNaN(parseFloat(l[5]))?1:parseFloat(l[5]))}},{re:/(hsl)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(l){return new eg(parseInt(l[2],10)/360,parseInt(l[3],10)/100,parseInt(l[4],10)/100,isNaN(parseFloat(l[5]))?1:parseFloat(l[5]))}}];o.push(i?{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})?$/,parse:function(l){return new Qh(parseInt(l[1],16)/255,parseInt(l[2],16)/255,parseInt(l[3],16)/255,parseInt(l[4]||"FF",16)/255)}}:{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/,parse:function(l){return new Qh(parseInt(l[1],16)/255,parseInt(l[2],16)/255,parseInt(l[3],16)/255,1)}}),o.push({re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/,parse:function(l){return new Qh(parseInt(l[1]+l[1],16)/255,parseInt(l[2]+l[2],16)/255,parseInt(l[3]+l[3],16)/255,1)}});for(const l in o)if(o.hasOwnProperty(l)){const c=o[l],d=c.re.exec(t),p=d&&c.parse(d);if(p)return p instanceof Qh?r=this.rgbaToHsva(p):p instanceof eg&&(r=this.hsla2hsva(p)),r}return r}outputFormat(t,i,r){switch("auto"===i&&(i=t.a<1?"rgba":"hex"),i){case"hsla":const o=this.hsva2hsla(t),l=new eg(Math.round(360*o.h),Math.round(100*o.s),Math.round(100*o.l),Math.round(100*o.a)/100);return t.a<1||"always"===r?"hsla("+l.h+","+l.s+"%,"+l.l+"%,"+l.a+")":"hsl("+l.h+","+l.s+"%,"+l.l+"%)";case"rgba":const c=this.denormalizeRGBA(this.hsvaToRgba(t));return t.a<1||"always"===r?"rgba("+c.r+","+c.g+","+c.b+","+Math.round(100*c.a)/100+")":"rgb("+c.r+","+c.g+","+c.b+")";default:const d="always"===r||"forced"===r;return this.rgbaToHex(this.denormalizeRGBA(this.hsvaToRgba(t)),d)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const gV="undefined"!=typeof window&&"ontouchstart"in window;let ZJ=(()=>{class n{constructor(t,i,r,o,l,c){this.ngZone=t,this.elRef=i,this.cdRef=r,this.document=o,this.platformId=l,this.service=c,this.isIE10=!1,this.dialogArrowSize=10,this.dialogArrowOffset=15,this.dialogInputFields=[Vo.HEX,Vo.RGBA,Vo.HSLA,Vo.CMYK],this.useRootViewContainer=!1,this.eyeDropperSupported=IN(this.platformId)&&"EyeDropper"in this.document.defaultView}handleEsc(t){this.show&&"popup"===this.cpDialogDisplay&&this.onCancelColor(t)}handleEnter(t){this.show&&"popup"===this.cpDialogDisplay&&this.onAcceptColor(t)}ngOnInit(){this.slider=new pV(0,0,0,0),this.sliderDimMax=new mV(this.hueSlider.nativeElement.offsetWidth||140,this.cpWidth,130,this.alphaSlider.nativeElement.offsetWidth||140),this.format=this.cpCmykEnabled?Vo.CMYK:"rgba"===this.cpOutputFormat?Vo.RGBA:"hsla"===this.cpOutputFormat?Vo.HSLA:Vo.HEX,this.listenerMouseDown=r=>{this.onMouseDown(r)},this.listenerResize=()=>{this.onResize()},this.openDialog(this.initialColor,!1)}ngOnDestroy(){this.closeDialog()}ngAfterViewInit(){230===this.cpWidth&&"inline"!==this.cpDialogDisplay||(this.sliderDimMax=new mV(this.hueSlider.nativeElement.offsetWidth||140,this.cpWidth,130,this.alphaSlider.nativeElement.offsetWidth||140),this.updateColorPicker(!1),this.cdRef.detectChanges())}openDialog(t,i=!0){this.service.setActive(this),this.width||(this.cpWidth=this.directiveElementRef.nativeElement.offsetWidth),this.height||(this.height=320),this.setInitialColor(t),this.setColorFromString(t,i),this.openColorPicker()}closeDialog(){this.closeColorPicker()}setupDialog(t,i,r,o,l,c,d,p,y,v,x,b,S,E,T,N,F,U,k,H,Q,ie,ce,De,ve,q,oe,qe,be,Le,de,xe,ue,Re,Ye,gt,st,ln){this.setInitialColor(r),this.setColorMode(p),this.isIE10=10===function $J(){let n="";"undefined"!=typeof navigator&&(n=navigator.userAgent.toLowerCase());const e=n.indexOf("msie ");return e>0&&parseInt(n.substring(e+5,n.indexOf(".",e)),10)}(),this.directiveInstance=t,this.directiveElementRef=i,this.cpDisableInput=b,this.cpCmykEnabled=y,this.cpAlphaChannel=v,this.cpOutputFormat=x,this.cpDialogDisplay=c,this.cpIgnoredElements=S,this.cpSaveClickOutside=E,this.cpCloseClickOutside=T,this.useRootViewContainer=N,this.width=this.cpWidth=parseInt(o,10),this.height=this.cpHeight=parseInt(l,10),this.cpPosition=F,this.cpPositionOffset=parseInt(U,10),this.cpOKButton=q,this.cpOKButtonText=qe,this.cpOKButtonClass=oe,this.cpCancelButton=be,this.cpCancelButtonText=de,this.cpCancelButtonClass=Le,this.cpEyeDropper=gt,this.fallbackColor=d||"#fff",this.setPresetConfig(H,Q),this.cpPresetColorsClass=ie,this.cpMaxPresetColorsLength=ce,this.cpPresetEmptyMessage=De,this.cpPresetEmptyMessageClass=ve,this.cpAddColorButton=xe,this.cpAddColorButtonText=Re,this.cpAddColorButtonClass=ue,this.cpRemoveColorButtonClass=Ye,this.cpTriggerElement=st,this.cpExtraTemplate=ln,k||(this.dialogArrowOffset=0),"inline"===c&&(this.dialogArrowSize=0,this.dialogArrowOffset=0),"hex"===x&&"always"!==v&&"forced"!==v&&(this.cpAlphaChannel="disabled")}setColorMode(t){switch(t.toString().toUpperCase()){case"1":case"C":case"COLOR":default:this.cpColorMode=1;break;case"2":case"G":case"GRAYSCALE":this.cpColorMode=2;break;case"3":case"P":case"PRESETS":this.cpColorMode=3}}setInitialColor(t){this.initialColor=t}setPresetConfig(t,i){this.cpPresetLabel=t,this.cpPresetColors=i}setColorFromString(t,i=!0,r=!0){let o;"always"===this.cpAlphaChannel||"forced"===this.cpAlphaChannel?(o=this.service.stringToHsva(t,!0),!o&&!this.hsva&&(o=this.service.stringToHsva(t,!1))):o=this.service.stringToHsva(t,!1),!o&&!this.hsva&&(o=this.service.stringToHsva(this.fallbackColor,!1)),o&&(this.hsva=o,this.sliderH=this.hsva.h,"hex"===this.cpOutputFormat&&"disabled"===this.cpAlphaChannel&&(this.hsva.a=1),this.updateColorPicker(i,r))}onResize(){"fixed"===this.position?this.setDialogPosition():"inline"!==this.cpDialogDisplay&&this.closeColorPicker()}onDragEnd(t){this.directiveInstance.sliderDragEnd({slider:t,color:this.outputColor})}onDragStart(t){this.directiveInstance.sliderDragStart({slider:t,color:this.outputColor})}onMouseDown(t){this.show&&!this.isIE10&&"popup"===this.cpDialogDisplay&&t.target!==this.directiveElementRef.nativeElement&&!this.isDescendant(this.elRef.nativeElement,t.target)&&!this.isDescendant(this.directiveElementRef.nativeElement,t.target)&&0===this.cpIgnoredElements.filter(i=>i===t.target).length&&this.ngZone.run(()=>{this.cpSaveClickOutside?this.directiveInstance.colorSelected(this.outputColor):(this.hsva=null,this.setColorFromString(this.initialColor,!1),this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.initialColor),this.directiveInstance.colorCanceled()),this.cpCloseClickOutside&&this.closeColorPicker()})}onAcceptColor(t){t.stopPropagation(),this.outputColor&&this.directiveInstance.colorSelected(this.outputColor),"popup"===this.cpDialogDisplay&&this.closeColorPicker()}onCancelColor(t){this.hsva=null,t.stopPropagation(),this.directiveInstance.colorCanceled(),this.setColorFromString(this.initialColor,!0),"popup"===this.cpDialogDisplay&&(this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.initialColor,!0),this.closeColorPicker())}onEyeDropper(){this.eyeDropperSupported&&(new window.EyeDropper).open().then(i=>{this.setColorFromString(i.sRGBHex,!0)})}onFormatToggle(t){const i=this.dialogInputFields.length-(this.cpCmykEnabled?0:1),r=((this.dialogInputFields.indexOf(this.format)+t)%i+i)%i;this.format=this.dialogInputFields[r]}onColorChange(t){this.hsva.s=t.s/t.rgX,this.hsva.v=t.v/t.rgY,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"lightness",value:this.hsva.v,color:this.outputColor}),this.directiveInstance.sliderChanged({slider:"saturation",value:this.hsva.s,color:this.outputColor})}onHueChange(t){this.hsva.h=t.v/t.rgX,this.sliderH=this.hsva.h,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"hue",value:this.hsva.h,color:this.outputColor})}onValueChange(t){this.hsva.v=t.v/t.rgX,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"value",value:this.hsva.v,color:this.outputColor})}onAlphaChange(t){this.hsva.a=t.v/t.rgX,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"alpha",value:this.hsva.a,color:this.outputColor})}onHexInput(t){if(null===t)this.updateColorPicker();else{t&&"#"!==t[0]&&(t="#"+t);let i=/^#([a-f0-9]{3}|[a-f0-9]{6})$/gi;"always"===this.cpAlphaChannel&&(i=/^#([a-f0-9]{3}|[a-f0-9]{6}|[a-f0-9]{8})$/gi);const r=i.test(t);r&&(t.length<5&&(t="#"+t.substring(1).split("").map(o=>o+o).join("")),"forced"===this.cpAlphaChannel&&(t+=Math.round(255*this.hsva.a).toString(16)),this.setColorFromString(t,!0,!1)),this.directiveInstance.inputChanged({input:"hex",valid:r,value:t,color:this.outputColor})}}onRedInput(t){const i=this.service.hsvaToRgba(this.hsva),r=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;r&&(i.r=t.v/t.rg,this.hsva=this.service.rgbaToHsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"red",valid:r,value:i.r,color:this.outputColor})}onBlueInput(t){const i=this.service.hsvaToRgba(this.hsva),r=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;r&&(i.b=t.v/t.rg,this.hsva=this.service.rgbaToHsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"blue",valid:r,value:i.b,color:this.outputColor})}onGreenInput(t){const i=this.service.hsvaToRgba(this.hsva),r=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;r&&(i.g=t.v/t.rg,this.hsva=this.service.rgbaToHsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"green",valid:r,value:i.g,color:this.outputColor})}onHueInput(t){const i=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;i&&(this.hsva.h=t.v/t.rg,this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"hue",valid:i,value:this.hsva.h,color:this.outputColor})}onValueInput(t){const i=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;i&&(this.hsva.v=t.v/t.rg,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"value",valid:i,value:this.hsva.v,color:this.outputColor})}onAlphaInput(t){const i=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;i&&(this.hsva.a=t.v/t.rg,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"alpha",valid:i,value:this.hsva.a,color:this.outputColor})}onLightnessInput(t){const i=this.service.hsva2hsla(this.hsva),r=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;r&&(i.l=t.v/t.rg,this.hsva=this.service.hsla2hsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"lightness",valid:r,value:i.l,color:this.outputColor})}onSaturationInput(t){const i=this.service.hsva2hsla(this.hsva),r=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;r&&(i.s=t.v/t.rg,this.hsva=this.service.hsla2hsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"saturation",valid:r,value:i.s,color:this.outputColor})}onCyanInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.c=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"cyan",valid:!0,value:this.cmyk.c,color:this.outputColor})}onMagentaInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.m=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"magenta",valid:!0,value:this.cmyk.m,color:this.outputColor})}onYellowInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.y=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"yellow",valid:!0,value:this.cmyk.y,color:this.outputColor})}onBlackInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.k=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"black",valid:!0,value:this.cmyk.k,color:this.outputColor})}onAddPresetColor(t,i){t.stopPropagation(),this.cpPresetColors.filter(r=>r===i).length||(this.cpPresetColors=this.cpPresetColors.concat(i),this.directiveInstance.presetColorsChanged(this.cpPresetColors))}onRemovePresetColor(t,i){t.stopPropagation(),this.cpPresetColors=this.cpPresetColors.filter(r=>r!==i),this.directiveInstance.presetColorsChanged(this.cpPresetColors)}openColorPicker(){this.show||(this.show=!0,this.hidden=!0,setTimeout(()=>{this.hidden=!1,this.setDialogPosition(),this.cdRef.detectChanges()},0),this.directiveInstance.stateChanged(!0),this.isIE10||this.ngZone.runOutsideAngular(()=>{gV?document.addEventListener("touchstart",this.listenerMouseDown):document.addEventListener("mousedown",this.listenerMouseDown)}),window.addEventListener("resize",this.listenerResize))}closeColorPicker(){this.show&&(this.show=!1,this.directiveInstance.stateChanged(!1),this.isIE10||(gV?document.removeEventListener("touchstart",this.listenerMouseDown):document.removeEventListener("mousedown",this.listenerMouseDown)),window.removeEventListener("resize",this.listenerResize),this.cdRef.destroyed||this.cdRef.detectChanges())}updateColorPicker(t=!0,i=!0,r=!1){if(this.sliderDimMax){let o,l,c;2===this.cpColorMode&&(this.hsva.s=0);const d=this.outputColor;if(l=this.service.hsva2hsla(this.hsva),this.cpCmykEnabled?(r?(c=this.service.cmykToRgb(this.service.normalizeCMYK(this.cmyk)),this.hsva=this.service.rgbaToHsva(c)):(c=this.service.hsvaToRgba(this.hsva),this.cmyk=this.service.denormalizeCMYK(this.service.rgbaToCmyk(c))),c=this.service.denormalizeRGBA(c),this.sliderH=this.hsva.h):c=this.service.denormalizeRGBA(this.service.hsvaToRgba(this.hsva)),o=this.service.denormalizeRGBA(this.service.hsvaToRgba(new rT(this.sliderH||this.hsva.h,1,1,1))),i&&(this.hslaText=new eg(Math.round(360*l.h),Math.round(100*l.s),Math.round(100*l.l),Math.round(100*l.a)/100),this.rgbaText=new Qh(c.r,c.g,c.b,Math.round(100*c.a)/100),this.cpCmykEnabled&&(this.cmykText=new _b(this.cmyk.c,this.cmyk.m,this.cmyk.y,this.cmyk.k,Math.round(100*this.cmyk.a)/100)),this.hexText=this.service.rgbaToHex(c,"always"===this.cpAlphaChannel),this.hexAlpha=this.rgbaText.a),"auto"===this.cpOutputFormat&&this.format!==Vo.RGBA&&this.format!==Vo.CMYK&&this.format!==Vo.HSLA&&this.hsva.a<1&&(this.format=this.hsva.a<1?Vo.RGBA:Vo.HEX),this.hueSliderColor="rgb("+o.r+","+o.g+","+o.b+")",this.alphaSliderColor="rgb("+c.r+","+c.g+","+c.b+")",this.outputColor=this.service.outputFormat(this.hsva,this.cpOutputFormat,this.cpAlphaChannel),this.selectedColor=this.service.outputFormat(this.hsva,"rgba",null),this.format!==Vo.CMYK)this.cmykColor="";else if("always"===this.cpAlphaChannel||"enabled"===this.cpAlphaChannel||"forced"===this.cpAlphaChannel){const p=Math.round(100*this.cmyk.a)/100;this.cmykColor=`cmyka(${this.cmyk.c},${this.cmyk.m},${this.cmyk.y},${this.cmyk.k},${p})`}else this.cmykColor=`cmyk(${this.cmyk.c},${this.cmyk.m},${this.cmyk.y},${this.cmyk.k})`;this.slider=new pV((this.sliderH||this.hsva.h)*this.sliderDimMax.h-8,this.hsva.s*this.sliderDimMax.s-8,(1-this.hsva.v)*this.sliderDimMax.v-8,this.hsva.a*this.sliderDimMax.a-8),t&&d!==this.outputColor&&(this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.outputColor))}}setDialogPosition(){if("inline"===this.cpDialogDisplay)this.position="relative";else{let r,t="static",i="",o=null,l=null,c=this.directiveElementRef.nativeElement.parentNode;const d=this.dialogElement.nativeElement.offsetHeight;for(;null!==c&&"HTML"!==c.tagName;){if(r=window.getComputedStyle(c),t=r.getPropertyValue("position"),i=r.getPropertyValue("transform"),"static"!==t&&null===o&&(o=c),i&&"none"!==i&&null===l&&(l=c),"fixed"===t){o=l;break}c=c.parentNode}const p=this.createDialogBox(this.directiveElementRef.nativeElement,"fixed"!==t);if(this.useRootViewContainer||"fixed"===t&&(!o||o instanceof HTMLUnknownElement))this.top=p.top,this.left=p.left;else{null===o&&(o=c);const v=this.createDialogBox(o,"fixed"!==t);this.top=p.top-v.top,this.left=p.left-v.left}"fixed"===t&&(this.position="fixed");let y=this.cpPosition;"auto"===this.cpPosition&&(y=function XJ(n,e){let t="right",i="bottom";const{height:r,width:o}=n,{top:l,left:c}=e,d=l+e.height,p=c+e.width,y=l-r<0,v=d+r>(window.innerHeight||document.documentElement.clientHeight),x=c-o<0,b=p+o>(window.innerWidth||document.documentElement.clientWidth);return v&&(i="top"),y&&(i="bottom"),x&&(t="right"),b&&(t="left"),y&&v&&x&&b?["left","right","top","bottom"].reduce((T,N)=>n[T]>n[N]?T:N):x&&b?y?"bottom":v||l>d?"top":"bottom":y&&v?x?"right":b||c>p?"left":"right":`${i}-${t}`}(this.dialogElement.nativeElement.getBoundingClientRect(),this.cpTriggerElement.nativeElement.getBoundingClientRect())),"top"===y?(this.arrowTop=d-1,this.top-=d+this.dialogArrowSize,this.left+=this.cpPositionOffset/100*p.width-this.dialogArrowOffset):"bottom"===y?(this.top+=p.height+this.dialogArrowSize,this.left+=this.cpPositionOffset/100*p.width-this.dialogArrowOffset):"top-left"===y||"left-top"===y?(this.top-=d-p.height+p.height*this.cpPositionOffset/100,this.left-=this.cpWidth+this.dialogArrowSize-2-this.dialogArrowOffset):"top-right"===y||"right-top"===y?(this.top-=d-p.height+p.height*this.cpPositionOffset/100,this.left+=p.width+this.dialogArrowSize-2-this.dialogArrowOffset):"left"===y||"bottom-left"===y||"left-bottom"===y?(this.top+=p.height*this.cpPositionOffset/100-this.dialogArrowOffset,this.left-=this.cpWidth+this.dialogArrowSize-2):(this.top+=p.height*this.cpPositionOffset/100-this.dialogArrowOffset,this.left+=p.width+this.dialogArrowSize-2),this.cpUsePosition=y}}isDescendant(t,i){let r=i.parentNode;for(;null!==r;){if(r===t)return!0;r=r.parentNode}return!1}createDialogBox(t,i){const{top:r,left:o}=t.getBoundingClientRect();return{top:r+(i?window.pageYOffset:0),left:o+(i?window.pageXOffset:0),width:t.offsetWidth,height:t.offsetHeight}}}return n.\u0275fac=function(t){return new(t||n)(Te(As),Te(Yo),Te(hx),Te(xo),Te(ux),Te(GI))},n.\u0275cmp=Ao({type:n,selectors:[["color-picker"]],viewQuery:function(t,i){if(1&t&&(ax(pJ,7),ax(mJ,7),ax(gJ,7)),2&t){let r;_m(r=vm())&&(i.dialogElement=r.first),_m(r=vm())&&(i.hueSlider=r.first),_m(r=vm())&&(i.alphaSlider=r.first)}},hostBindings:function(t,i){1&t&&Ft("keyup.esc",function(o){return i.handleEsc(o)},!1,$v)("keyup.enter",function(o){return i.handleEnter(o)},!1,$v)},decls:30,vars:51,consts:[[1,"color-picker",3,"click"],["dialogPopup",""],[3,"class","top",4,"ngIf"],["class","saturation-lightness",3,"slider","rgX","rgY","background-color","newValue","dragStart","dragEnd",4,"ngIf"],[1,"hue-alpha","box"],[1,"left"],[1,"selected-color-background"],[1,"selected-color",3,"click"],["class","eyedropper-icon","xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#000000",4,"ngIf"],["type","button",3,"class","disabled","click",4,"ngIf"],[1,"right"],["style","height: 16px;",4,"ngIf"],[1,"hue",3,"slider","rgX","newValue","dragStart","dragEnd"],["hueSlider",""],[1,"cursor"],[1,"value",3,"slider","rgX","newValue","dragStart","dragEnd"],["valueSlider",""],[1,"alpha",3,"slider","rgX","newValue","dragStart","dragEnd"],["alphaSlider",""],["class","cmyk-text",3,"display",4,"ngIf"],["class","hsla-text",3,"display",4,"ngIf"],["class","rgba-text",3,"display",4,"ngIf"],["class","hex-text",3,"hex-alpha","display",4,"ngIf"],["class","value-text",4,"ngIf"],["class","type-policy",4,"ngIf"],["class","preset-area",4,"ngIf"],["class","button-area",4,"ngIf"],["class","extra-template",4,"ngIf"],[1,"saturation-lightness",3,"slider","rgX","rgY","newValue","dragStart","dragEnd"],["xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#000000",1,"eyedropper-icon"],["d","M0 0h24v24H0V0z","fill","none"],["d","M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"],["type","button",3,"disabled","click"],[2,"height","16px"],[1,"cmyk-text"],[1,"box"],["type","number","pattern","[0-9]*","min","0","max","100",3,"text","rg","value","keyup.enter","newValue"],["type","number","pattern","[0-9]+([\\.,][0-9]{1,2})?","min","0","max","1","step","0.1",3,"text","rg","value","keyup.enter","newValue",4,"ngIf"],[4,"ngIf"],["type","number","pattern","[0-9]+([\\.,][0-9]{1,2})?","min","0","max","1","step","0.1",3,"text","rg","value","keyup.enter","newValue"],[1,"hsla-text"],["type","number","pattern","[0-9]*","min","0","max","360",3,"text","rg","value","keyup.enter","newValue"],[1,"rgba-text"],["type","number","pattern","[0-9]*","min","0","max","255",3,"text","rg","value","keyup.enter","newValue"],[1,"hex-text"],[3,"text","value","blur","keyup.enter","newValue"],[1,"value-text"],[1,"type-policy"],[1,"type-policy-arrow",3,"click"],[1,"preset-area"],[1,"preset-label"],[3,"class",4,"ngIf"],["class","preset-color",3,"backgroundColor","click",4,"ngFor","ngForOf"],[1,"preset-color",3,"click"],[3,"class","click",4,"ngIf"],[3,"click"],[1,"button-area"],["type","button",3,"class","click",4,"ngIf"],["type","button",3,"click"],[1,"extra-template"],[4,"ngTemplateOutlet"]],template:function(t,i){1&t&&(We(0,"div",0,1),Ft("click",function(o){return o.stopPropagation()}),xn(2,yJ,1,5,"div",2),xn(3,_J,2,8,"div",3),We(4,"div",4)(5,"div",5),ur(6,"div",6),We(7,"div",7),Ft("click",function(){return i.eyeDropperSupported&&i.cpEyeDropper&&i.onEyeDropper()}),xn(8,vJ,3,0,"svg",8),Ne(),xn(9,xJ,2,5,"button",9),Ne(),We(10,"div",10),xn(11,bJ,1,0,"div",11),We(12,"div",12,13),Ft("newValue",function(o){return i.onHueChange(o)})("dragStart",function(){return i.onDragStart("hue")})("dragEnd",function(){return i.onDragEnd("hue")}),ur(14,"div",14),Ne(),We(15,"div",15,16),Ft("newValue",function(o){return i.onValueChange(o)})("dragStart",function(){return i.onDragStart("value")})("dragEnd",function(){return i.onDragEnd("value")}),ur(17,"div",14),Ne(),We(18,"div",17,18),Ft("newValue",function(o){return i.onAlphaChange(o)})("dragStart",function(){return i.onDragStart("alpha")})("dragEnd",function(){return i.onDragEnd("alpha")}),ur(20,"div",14),Ne()()(),xn(21,SJ,17,12,"div",19),xn(22,TJ,14,10,"div",20),xn(23,RJ,14,10,"div",21),xn(24,LJ,8,7,"div",22),xn(25,NJ,9,3,"div",23),xn(26,OJ,3,0,"div",24),xn(27,zJ,6,3,"div",25),xn(28,WJ,3,2,"div",26),xn(29,jJ,2,1,"div",27),Ne()),2&t&&(Qr("display",i.show?"block":"none")("visibility",i.hidden?"hidden":"visible")("top",i.top,"px")("left",i.left,"px")("position",i.position)("height",i.cpHeight,"px")("width",i.cpWidth,"px"),hf("open",i.show),at(2),nt("ngIf","popup"===i.cpDialogDisplay),at(1),nt("ngIf",1===(i.cpColorMode||1)),at(4),Qr("background-color",i.selectedColor)("cursor",i.eyeDropperSupported&&i.cpEyeDropper?"pointer":null),at(1),nt("ngIf",i.eyeDropperSupported&&i.cpEyeDropper),at(1),nt("ngIf",i.cpAddColorButton),at(2),nt("ngIf","disabled"===i.cpAlphaChannel),at(1),Qr("display",1===(i.cpColorMode||1)?"block":"none"),nt("rgX",1),at(2),Qr("left",null==i.slider?null:i.slider.h,"px"),at(1),Qr("display",2===(i.cpColorMode||1)?"block":"none"),nt("rgX",1),at(2),Qr("right",null==i.slider?null:i.slider.v,"px"),at(1),Qr("display","disabled"===i.cpAlphaChannel?"none":"block")("background-color",i.alphaSliderColor),nt("rgX",1),at(2),Qr("left",null==i.slider?null:i.slider.a,"px"),at(1),nt("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),at(1),nt("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),at(1),nt("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),at(1),nt("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),at(1),nt("ngIf",!i.cpDisableInput&&2===(i.cpColorMode||1)),at(1),nt("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),at(1),nt("ngIf",(null==i.cpPresetColors?null:i.cpPresetColors.length)||i.cpAddColorButton),at(1),nt("ngIf",i.cpOKButton||i.cpCancelButton),at(1),nt("ngIf",i.cpExtraTemplate))},directives:[ky,KJ,YJ,mx,AN],styles:['.color-picker{position:absolute;z-index:1000;width:230px;height:auto;border:#777 solid 1px;cursor:default;-webkit-user-select:none;user-select:none;background-color:#fff}.color-picker *{box-sizing:border-box;margin:0;font-size:11px}.color-picker input{width:0;height:26px;min-width:0;font-size:13px;text-align:center;color:#000}.color-picker input:invalid,.color-picker input:-moz-ui-invalid,.color-picker input:-moz-submit-invalid{box-shadow:none}.color-picker input::-webkit-inner-spin-button,.color-picker input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none}.color-picker .arrow{position:absolute;z-index:999999;width:0;height:0;border-style:solid}.color-picker .arrow.arrow-top{left:8px;border-width:10px 5px;border-color:#777 rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .arrow.arrow-bottom{top:-20px;left:8px;border-width:10px 5px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) #777 rgba(0,0,0,0)}.color-picker .arrow.arrow-top-left,.color-picker .arrow.arrow-left-top{right:-21px;bottom:8px;border-width:5px 10px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #777}.color-picker .arrow.arrow-top-right,.color-picker .arrow.arrow-right-top{bottom:8px;left:-20px;border-width:5px 10px;border-color:rgba(0,0,0,0) #777 rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .arrow.arrow-left,.color-picker .arrow.arrow-left-bottom,.color-picker .arrow.arrow-bottom-left{top:8px;right:-21px;border-width:5px 10px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #777}.color-picker .arrow.arrow-right,.color-picker .arrow.arrow-right-bottom,.color-picker .arrow.arrow-bottom-right{top:8px;left:-20px;border-width:5px 10px;border-color:rgba(0,0,0,0) #777 rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .cursor{position:relative;width:16px;height:16px;border:#222 solid 2px;border-radius:50%;cursor:default}.color-picker .box{display:flex;padding:4px 8px}.color-picker .left{position:relative;padding:16px 8px}.color-picker .right{flex:1 1 auto;padding:12px 8px}.color-picker .button-area{padding:0 16px 16px;text-align:right}.color-picker .button-area button{margin-left:8px}.color-picker .preset-area{padding:4px 15px}.color-picker .preset-area .preset-label{overflow:hidden;width:100%;padding:4px;font-size:11px;white-space:nowrap;text-align:left;text-overflow:ellipsis;color:#555}.color-picker .preset-area .preset-color{position:relative;display:inline-block;width:18px;height:18px;margin:4px 6px 8px;border:#a9a9a9 solid 1px;border-radius:25%;cursor:pointer}.color-picker .preset-area .preset-empty-message{min-height:18px;margin-top:4px;margin-bottom:8px;font-style:italic;text-align:center}.color-picker .hex-text{width:100%;padding:4px 8px;font-size:11px}.color-picker .hex-text .box{padding:0 24px 8px 8px}.color-picker .hex-text .box div{float:left;flex:1 1 auto;text-align:center;color:#555;clear:left}.color-picker .hex-text .box input{flex:1 1 auto;padding:1px;border:#a9a9a9 solid 1px}.color-picker .hex-alpha .box div:first-child,.color-picker .hex-alpha .box input:first-child{flex-grow:3;margin-right:8px}.color-picker .cmyk-text,.color-picker .hsla-text,.color-picker .rgba-text,.color-picker .value-text{width:100%;padding:4px 8px;font-size:11px}.color-picker .cmyk-text .box,.color-picker .hsla-text .box,.color-picker .rgba-text .box{padding:0 24px 8px 8px}.color-picker .value-text .box{padding:0 8px 8px}.color-picker .cmyk-text .box div,.color-picker .hsla-text .box div,.color-picker .rgba-text .box div,.color-picker .value-text .box div{flex:1 1 auto;margin-right:8px;text-align:center;color:#555}.color-picker .cmyk-text .box div:last-child,.color-picker .hsla-text .box div:last-child,.color-picker .rgba-text .box div:last-child,.color-picker .value-text .box div:last-child{margin-right:0}.color-picker .cmyk-text .box input,.color-picker .hsla-text .box input,.color-picker .rgba-text .box input,.color-picker .value-text .box input{float:left;flex:1;padding:1px;margin:0 8px 0 0;border:#a9a9a9 solid 1px}.color-picker .cmyk-text .box input:last-child,.color-picker .hsla-text .box input:last-child,.color-picker .rgba-text .box input:last-child,.color-picker .value-text .box input:last-child{margin-right:0}.color-picker .hue-alpha{align-items:center;margin-bottom:3px}.color-picker .hue{direction:ltr;width:100%;height:16px;margin-bottom:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwkUFWbCCAAAAFxJREFUaN7t0kEKg0AQAME2x83/n2qu5qCgD1iDhCoYdpnbQC9bbY1qVO/jvc6k3ad91s7/7F1/csgPrujuQ17BDYSFsBAWwgJhISyEBcJCWAgLhIWwEBYIi2f7Ar/1TCgFH2X9AAAAAElFTkSuQmCC)}.color-picker .value{direction:rtl;width:100%;height:16px;margin-bottom:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAACTklEQVR42u3SYUcrABhA4U2SkmRJMmWSJklKJiWZZpKUJJskKUmaTFImKZOUzMySpGRmliRNJilJSpKSJEtmSpIpmWmSdO736/6D+x7OP3gUCoWCv1cqlSQlJZGcnExKSgqpqamkpaWRnp5ORkYGmZmZqFQqsrKyyM7OJicnh9zcXNRqNXl5eeTn56PRaCgoKKCwsJCioiK0Wi3FxcWUlJRQWlpKWVkZ5eXlVFRUUFlZiU6no6qqiurqampqaqitraWurg69Xk99fT0GgwGj0UhDQwONjY00NTXR3NxMS0sLra2ttLW10d7ejslkwmw209HRQWdnJ11dXXR3d9PT00Nvby99fX309/czMDDA4OAgFouFoaEhrFYrw8PDjIyMMDo6ytjYGDabjfHxcSYmJpicnGRqagq73c709DQzMzPMzs4yNzfH/Pw8DocDp9OJy+XC7XazsLDA4uIiS0tLLC8vs7KywurqKmtra3g8HrxeLz6fD7/fz/r6OhsbG2xubrK1tcX29jaBQICdnR2CwSC7u7vs7e2xv7/PwcEBh4eHHB0dcXx8zMnJCaenp5ydnXF+fs7FxQWXl5dcXV1xfX3Nzc0Nt7e33N3dEQqFuL+/5+HhgXA4TCQS4fHxkaenJ56fn3l5eeH19ZVoNMrb2xvv7+98fHwQi8WIx+N8fn6SSCT4+vri+/ubn58ffn9/+VcKgSWwBJbAElgCS2AJLIElsASWwBJYAktgCSyBJbAElsASWAJLYAksgSWwBJbAElgCS2AJLIElsP4/WH8AmJ5Z6jHS4h8AAAAASUVORK5CYII=)}.color-picker .alpha{direction:ltr;width:100%;height:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwYQlZMa3gAAAWVJREFUaN7tmEGO6jAQRCsOArHgBpyAJYGjcGocxAm4A2IHpmoWE0eBH+ezmFlNvU06shJ3W6VEelWMUQAIIF9f6qZpimsA1LYtS2uF51/u27YVAFZVRUkEoGHdPV/sIcbIEIIkUdI/9Xa7neyv61+SWFUVAVCSct00TWn2fv6u3+Ecfd3tXzy/0+nEUu+SPjo/kqzrmiQpScN6v98XewfA8/lMkiLJ2WxGSUopcT6fM6U0NX9/frfbjev1WtfrlZfLhYfDQQHG/AIOlnGwjINlHCxjHCzjYJm/TJWdCwquJXseFFzGwDNNeiKMOJTO8xQdDQaeB29+K9efeLaBo9J7vdvtJj1RjFFjfiv7qv95tjx/7leSQgh93e1ffMeIp6O+YQjho/N791t1XVOSSI7N//K+4/GoxWLBx+PB5/Op5XLJ+/3OlJJWqxU3m83ovv5iGf8KjYNlHCxjHCzjYBkHy5gf5gusvQU7U37jTAAAAABJRU5ErkJggg==)}.color-picker .type-policy{position:absolute;top:218px;right:12px;width:16px;height:24px;background-size:8px 16px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgCAYAAAAffCjxAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACewAAAnsB01CO3AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIASURBVEiJ7ZY9axRRFIafsxMStrLQJpAgpBFhi+C9w1YSo00I6RZ/g9vZpBf/QOr4GyRgkSKNSrAadsZqQGwCkuAWyRZJsySwvhZ7N/vhzrgbLH3Ld8597jlzz50zJokyxXH8DqDVar0qi6v8BbItqSGpEcfxdlmsFWXkvX8AfAVWg3UKPEnT9GKujMzsAFgZsVaCN1VTQd77XUnrgE1kv+6935268WRpzrnHZvYRWC7YvC3pRZZl3wozqtVqiyH9IgjAspkd1Gq1xUJQtVrdB9ZKIAOthdg/Qc65LUk7wNIMoCVJO865rYFhkqjX6/d7vV4GPJwBMqofURS5JEk6FYBer/eeYb/Mo9WwFnPOvQbeAvfuAAK4BN4sAJtAG/gJIElmNuiJyba3EGNmZiPeZuEVmVell/Y/6N+CzDn3AXhEOOo7Hv/3BeAz8IzQkMPnJbuPx1wC+yYJ7/0nYIP5S/0FHKdp+rwCEEXRS/rf5Hl1Gtb2M0iSpCOpCZzPATmX1EySpHMLAsiy7MjMDoHrGSDXZnaYZdnRwBh7J91utwmczAA6CbG3GgPleX4jqUH/a1CktqRGnuc3hSCAMB32gKspkCtgb3KCQMmkjeP4WNJThrNNZval1WptTIsv7JtQ4tmIdRa8qSoEpWl6YWZNoAN0zKxZNPehpLSBZv2t+Q0CJ9lLnARQLAAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center}.color-picker .type-policy .type-policy-arrow{display:block;width:100%;height:50%}.color-picker .selected-color{position:absolute;top:16px;left:8px;width:40px;height:40px;border:1px solid #a9a9a9;border-radius:50%}.color-picker .selected-color-background{width:40px;height:40px;border-radius:50%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAh0lEQVRYR+2W0QlAMQgD60zdfwOdqa8TmI/wQMr5K0I5bZLIzLOa2nt37VVVbd+dDx5obgCC3KBLwJ2ff4PnVidkf+ucIhw80HQaCLo3DMH3CRK3iFsmAWVl6hPNDwt8EvNE5q+YuEXcMgkonVM6SdyCoEvAnZ8v1Hjx817MilmxSUB5rdLJDycZgUAZUch/AAAAAElFTkSuQmCC)}.color-picker .saturation-lightness{direction:ltr;width:100%;height:130px;border:none;cursor:pointer;touch-action:manipulation;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOYAAACCCAYAAABSD7T3AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwksPWR6lgAAIABJREFUeNrtnVuT47gRrAHN+P//Or/61Y5wONZ7mZ1u3XAeLMjJZGZVgdKsfc5xR3S0RIIUW+CHzCpc2McYo7XGv3ex7UiZd57rjyzzv+v+33X/R/+3r/f7vR386Y+TvKNcf/wdhTLPcv9qU2wZd74uth0t1821jkIZLPcsI/6nWa4XvutquU0Z85mnx80S/ZzgpnLnOtHNt7/ofx1TKXcSNzN/7qbMQ3ju7rNQmMYYd/4s2j9aa+P+gGaMcZrb1M/tdrvf7/d2v99P9/t93O/3cbvdxu12G9frdVwul3E+n8c///nP+2+//Xb66aefxl//+tfx5z//2YK5Al2rgvf4UsbpdGrB52bAvArXpuzjmiqAVSGz5eDmGYXzhbAZmCrnmzddpUU+8Y1dAOYeXCtDUwVwV7YCGH6uAmyMcZ9l5vkUaBPGMUZ7/J5w/792/fvv9Xq93263dr/fTxPECeME8nK5jM/Pz/HTTz/dv337dvrll1/GP/7xj/G3v/1t/OUvfwkVswongjdOp9PzH3U3D3zmWGnZVXn4jCqs7wC2BKP4/8tAzkZsoWx6XrqeHZymvp4ABCBJhTQwKfDT8gzrZCIqi5AhiACjBfEB2rP8/X63MM7f6/V6v9/v7Xa7bYC83W7jcrlsVHIq5ffv30+//fbb+OWXX8ZPP/00/v73v4+ff/75JSvbeu+bL2WMMaFbAlpBNM85QX+ct6qoSqkPAwuQlBVKqGNFSUOAA3Bmu7gC5hNOd15nSwvAOUW7C4giUCV8Sgn5L9hNFIqTsp0GxI0ysioyjAjkY/tGJVEpz+fz+OWXX+7fv38//f777+Pbt2/j119/HT///PP49ddfx8fHRwrmTjV779EXu2px2xhjwtdJZQcAWQIPLPISsMJaSwiD8gzIKrwSyATE5j5nAbR5c1dBUwBlsEWW0h6LqiYsqFPAQxCyRZ3wOSARxmlXMX5k64pQfvv27f75+dk+Pj5OHx8f4/v37+Pbt2/jt99+G9++fRsfHx/jcrmUFLO31gYDWblxRIs/TqfT7ousxJsAxXA2Gc7TA9XdgfdoHbFsj76X2+1WArgI1ageGwA3qupqoHsmcbI6Fu93quggFa9d7LeDtgKfAFHBJ+NEByIkcJ5KervdTmhhGcgJJSZ5vn//fj+fz+18Pp8+Pz/H5+fnmGD+/vvv4/v37+Pj42N8fn6O2+1Ws7JjjP6wraMI5E4RZ8x2vV5TSwkquotV7/d7Tz6HFWsD/qNcdw0CQ3q/321c686TwDVIdbuy73zNldhSHb8I2klZznm+InBS4U6n0302aBFsLhHDAKJVJVglfI9jhvu53W53sLANYNxAiDA6MCeUHx8f9+v12i6XS7tcLqcZW57P5yeY8/fz83Ocz+fnsSmYUyknWEG85WBst9stzSLyMdfr9Qi08iY15UZ0LlDGLhR3o5zK2j7OPUTD0E+nU3tk7Xb/16NFbhloAMuY1zjLUOO3BKeIDe+Z8s3/J4gFo4TM5jPmuRg28foUKKVSwo16TgA5npywcWLHgYl/Pz8/73/605/ab7/91m63W7tcLie0sZj4mao5gTyfz88E0f1+j8EcYzwTPEG2cqjyfHNF0M8fuqEiaOVnRzZZQNh5fwQyHg/HDGfJo89Q1zb/quu5XC6773I2XKfTqd/v9+d3wuqWva/YTdUdEV3fhIv/Viyps6YE3x3r43K5bJQS66zaxVGFsvd+//j4aF+/fm3fv39vt9utff36tf3+++/tdrudvn37ZuNLBaaCMgUzC+rZRiFowxUuJI8YMqcCp9Opq5vagaYU6lGJA1XQqejchw6Cj0Gw5nYBrGw01A2O206n04BGouNNyTfp/FwElhUey6nXrIKw7QQWddxuN2ldL5fL839gSPF8ahu/JvBO48CPSuqMf8Vp9/P53L58+dLu93s7n8/tfr8/39/v9/b5+TkhPJ3P56mQ436/j+/fv+/iSgbzer0+AZx/5+88bv6OMda6S5z6kd21fYC9dxv7cIJJ2d9AOS30fPMzyHiTM8B4DF6XUlYHp4KQW3W+1t77MNB1vGHxWq7Xa7vf78+y5/N5A+H1et29xuP5dbYtyaRu4AksbPq6936fjRzXRxBbPr/b+b18+fKljTHaBBBfn8/n0/1+H1++fBnn8zm0sB8fH5u4cr5GuBhMVk0EEn9RsctgVhM+ixlJtMA23R8B6yysAstBOgFXIKKCMIgToMqNEu2fYMH7ztc732dQKkCj1ytAZtY0Kx8pIr8GGJ+AT3V+2Hirhl++fBmXy2Wz73w+b17P8p+fn8/tUwGVleVkTyUb68DkfayWY4zxNRihU4EpLJPZVrK+u7J4/mgfKqeLW9X2REWlItL1diynbDDb3+jXgYjQqn0rrxWc+NkILP7F7xIbMvx7vV53x40xnlbWJF12ZSag/N0pW6t+ZzmOMzHjajKwDfond78zYTdfq18up97zr2q8v3IioBprRtBl0EZ9og5WBRGOdOHjIjXF7UotFbgOWnXzIJyzYvjG5IYgsmMOxHkz8OsMSrVNWeq5T8DaOcbEv1Od5rbs9aO7YvMet63EkF++fMExq+MRl4/L5bLZN/+ez+fnZ6KazuMqXSQVO5spJXflHAIzes/xJseckRJiDMog9d6VfRrqXMr6KpVV27jRwJacGovOAM1zMdQMnwK1AubK63kdCChvI1C7g0z9nf/D+Xze2Vj8H7Gx4P9duQlsYCrqyN8XqG3Hm/10Oj3jw/n+crlstuM+jPmmxT2dTuPz83Pzt2pn1XsEHX/bnPaVqVmh0xwOt0o6XLLAHePUU203wHfcrspCwmV3TryB5s0Mseeg97x/BwzCjBlbB+pRAPla0BVQuT6V6QHdBlj3d0KG147b+DqxQeUymDO43W4dQar+TIjwmAd0z8/h65vf0/yLv3Pb5XLpru/ydDo9s7ET0I+Pj6dKK9VUEIeKWQWPAOrJ8LKd4vE+t91Y3e7UFlWatg2VwJnb+HPmtvm/sfK59/OaWF3x/eP1UPHvA5DDYDpYXfb0drv1V2DkBkxtw/tEWVVlXWdC9pFYs5/jfh9dS/16vW7s6lTG+TfqsxSJHxkXXq/Xdr1eu4LsfD6P3vsT3N77DkL+zPm5jSdKL4zR3AxQd6rHkLkYlSowsrq7znzu6wSwdsMJOXmA5fBcjxtgMGBYHlr5zokhtsMCTgXLQOW4XC6dEyEMprL8mAQzXRgduix2yZzorxkYsDn3hB1VeMLGsXsVtgl2pW8S3svk0vw7R4hNaHvv4cACl5HFzwIH0Kc6zu4XjDPR/jpAVxWzO1Xk2DDb3vTcxeGU1iWZHkmIDWziWKvirCJ4Dravs6IJ/GG6cTqWdXDy+fArQDVVkLqkVjAoZIITdmmIqXwqa95N3+MGYoZQdRVNO53Y1xRkhO16vY7eu507Ca9lJnbGpxOemQhSw/AQsmmp5zU9BiU8G6wvX76M6/U6Pj4+do0Bz4CpgiknTUeDqwlKBmg3u4OVjrZ1A+rAcgaejWq6eJCvCYFDONSwOgHX4EQRw8lxbzDOdEK6gZ3Hk1b+8g2o1JFtKXyv/fEdTXuWjWXdAZiBp6ADeDrCFiim7B6ZFneeI7Gvm/PMkUDX67W7xI8b0D7/v8dA9qfN5oaCf74WZjH0mf1cmfY1Y0JUFmVrTWu8uzkNcLtEj7u5FXBTkfC6GOA5q8YMxO8KVvF6sAVGdcrUbsKODcQKkLMOMdmlxum642YrPm26AlhZW1YB1R+rrGswE8TaYAWeUMxdf+WjwSvZ2Ef3ytOyfn5+PpVPAaqOn43MtNBqvmjjxbjM4lZjZY4gqNMI5ktaW/sYKNwS+9lFQzGihmMCKPa7+Z0V6Eb0GRmobtpX8JljWu5FMLN5ja6hG9kwQgZqf5+1NH5UxzkFReCdWhJ8XdlGUkxO7HRlYRm4mVO43W7ter12TPJEw/rmEN3L5SKHIWZg9mz+pUoKOYq5bJTJdX2gme1UcxMZQFaEQIlHct32M+Y1BzGkGuzfiyAN9z+ugplZ1symCrDCYYkGxDTpI9RzBy0rHyeDUC1nWaeUaD9n4xkNyYMBDZtzZ3B++fJlY21XFDOcARJlabOyiS3uCpLI9jrZjCDkaVvcCCjwognKShWdzXZWlZMvVTgD8LpqlCLrqgbcB+qYwrgKYpT0ccCqbKyCValkEabn/FynogCrPKfqf51xJ7sGB2ZXcZmxoSOztjx300DZi7a0/2AIR0UlBag9SuDw6KcAzlaB7vHZvWpjK90dyrq6bKyDUZQbR0B05biLQkHIcSUmgIK+SwuqgHCnoio2RQU1yj+BnBy9pphVKLGyC7ZzFK1pxWK+E8IhVCWLN/uLtnUU4ayoYLoaANz8FdtaSvY4pV0BEW2ls61czqllBKpTyKgMAhrZ1cdc1RROtPmvWNkdcKZ7ZKxaWjiPLJMpp7OZKxA+rqG/oJLjxf0pnJlqLoDZo3gyU0mKGys2taKecj/d1C+rJSplBqlTyAqgR+D8KjKlmRL2gtUcAdCtsL+ijCNT1oqqqkH2OHEbG5sDFnUg5Aa+yLou2VU1ptj1S2ZQqv1ORZN9IWzRfgaRBxKoBE8UWyqlJFtrIc0AxNjSjed99CTY/XDfSzCz5M0IZoVEsWnPFNTsl8ooVC1TzbGgqFZNDSgVwKK+1sGDMKqxZCWGVMDysiEr1jVSQJUYwj5iHOlThdHt44SQg9CN+nl8D90NMIgAdgr46JqRiR9I8vRdFvbr17m/yxUMKjNLMiVUADwu2CWGhhi+F55TWM9M9cogzms1dnM4uOF/LAEYWdcqnM7yFmyq3IfwmOROd7Y1iFWtOjoY8To41mTV5IysgFFuRzsbWFGbNIIJCDv1dOo4lZG7jWBwRFtVTKuWyeCByJKOan8oZ3ep9XddNl0tDuaywLz9cXPYeDAA0SpkBO9sbVcTOVWldPv4uyzEkzxHtjvonHoSkFEWNoo1d8DhcQputd2ppNon4BzoAiJ1hBFQg0dVtdbGHHDQWushmNEQukLM2QO1G2Y8bgTXqFhcBJj7EjPgcPts8US8qPpPB/dXznOh5Z438tzH5ec6QgrOKrRRfKmysBmUDB+PhYabMlVPER+GCSITTzr7am2tArH3bgcEzPJm+cr5jJ4NnHNFDVrFXcI5Le9k5Jnw+bedbV+FfRzZIHaOOaOsLY0/7UGs58DjrGwKMIMFIGzOEW1/jGsdAtCN6hEAI4hBe9YXeRROBSVPAVPAqvIM5bx5hVKWAMP6zBRy3iescridVdFBinBxXDnG2GRY2XbCvp1lhvGtO9Bxu5h908XQu42lnSArMFdizMim8uwRCxPGnnOS8lwpnbOiDqTAjsrRN/PcoAScCbaACqVM40ylnjjTBs+bwWlAG23/UKbdkiwKWIQPGzWaczpoSlxPEj822cNWkpS7FyzsDrqpfgpG3jahw2vgbaSQAxuLWZYt7JzyNe8JoZpNAcvDFOdw0wqYT9AK1rZz/DdbSlLPp0ryIxgQJlK9AZlEq7IOXpohg9PIhrCng88JsOxiV4ZWAYfg4sikx/8ky2Z9l862uqwrfscIH8+ugTmVGyiddeVYUgEMn4GZzg14EwIsh9sx2cKKiWXReuOE5gzGOQgdlRKVVdlevqb279Xq0Qnsts2VDaBO0coezsruWtHApu6sKG4IBhN0aGU2kLrMKGRTN3HmbCDwKV14zvkMEDG4QfZVspVlaNU2mhc5TEZ3N1h/zqTheuLpW05ZWTGVjb3dbnNmxKZBnN8JqidaVLKAOyARNLS+MB54Z2+VaqoMLKroVBlngefnTPAcoHNWCSvlfA8CI0HEmBNBnBlXyMrzU7A7WVm94PPqQ2gmqKx+WDGsnvilmcSOBJqOK1nYyAIzuAyesq3UdSK3KfWcYKD95HmfYOU3qser2CtYEUA+FpfqdNvgPBZUBhDrGONRVlQsh8rLcaUCykHG0OOUwTlLBrsh5soEMGezi1E4HRVt1icp5wZEFXdibCkG8Y8vX75sbO4E0iom9z+hjSiOfy3DhpXItpVhE+UGQdvoWjtChmrGHf4YAzKgBNnGtuJxFCeGdhUAfQLLK8kBYAP6gvFJZajMG3Xkycy8KuC0q4Eyymwtwdxdv2M0mIBtK0LKnf640j00Auq4gUkdWGlhs22qJc6dZCsL19oxnlTJG4SYVRIGpD8TPFBuM6OElbS1pldid4mGAyN6ZIupbC5bXJN9fdpbThSxLUaI8IG1XIYBxW3Tjs6KQosKcxfxcQmdnwRGM10GnFcCy2XYunLMyAkdgk4mePiczsLygthcBut6goOqS7YVFXADLjaosB6s6ofcZWAZSIRYqSUkizYwttYab3vUOQ9w2HRxIIg8WwRVeE68xi4UtL3zRphxplzwuZrcqYCq1I3jPI5dnJIygEohMbPqVJSzrwzxBJTs5zN+ReUSgxikPQVF3JVBeNQxbHENrEMNvEdFZVV9lH9+ORGEsNZQpyTNc4C3AG7XF4ngzq+DrO2zbuaaOXgdaFcdkEotoSFBVX2qJ0C8OWZeG4KGlpghA0XfTOPCqV2qqwQ26QWfF2PMLhI2w1lVAa2aPsYd0za25MQRwgcZN6uQDCi+ZxiD4XEM2kZxOT41FnZnaRlcpZouzlRqqdbQVWopQoSB58RV50lBNrHi/AwXS5LrwDVlpY3Fc3ByiYGc52Trist6kOXdwInAQtJpp5QchyaquYOV7Su+fxVMaV3dc0RE2S6mUY0gLt2pMcYqrKIQ9w2l1gpQUMtQYcmmbt5DTNxdhnUCjQqtbK9SUSzvrC0mmhhE1e2FS2+oxypy/ZASutkmtjx3vcBC24PX65nbqkBCRhfjS9kIYPnee8cMagVOhI/3T1fAmdtAWZsCswTJCkQVNa0qWKSKPOpHAUhD9DrbVcyoYkwqhvh17vYAayXLQyKGYdxlUDFp494rBXRjYgO17DDYetNIUj/ezp6S0lnlpEwsWmJMkOwsKXeZKEAjIHn0EQJISaRBcO6UMINz7p/bEjjnw4ft+xmDvksxX4G2rIris7qaeKwAFMP2Oi7n4criuZwtpSUwpfLxSnORSrIqusc5ZFaXysqRWjiZ2DyAWEIL35tVSoQElFACjOeGGSE7AHEQgdo/LSvCOgGBvkxsmDbvlS3Fp5vhaB2TAGqRKrKKMrhLVpaGzEVjZ0OQxDhaCTA+QyRR1d15aQzrJntL3RibsipjG6jlgL4yqbS0sNYg1e84vhbBVrElK64CUcWYXDfKxhpIuxiVJZUxsbMy/uRBKTNRQ4kQ3LdRYLS0rJjRPlTPqY6gdJsEDc+aQXAn+HgsNUCbRuF0Oj0zwnA7bWDkbhO5Ens00qeQhS1laBMl5M/cAaxsLF8rKyql+Tf7ELLEGu/ixiimdCvo0TjfpjKwaggen4eh5v7LokLKbLuyvHhcZG8dhGrEDx7Hg93ZppJF7qBqO3iVveXEDQNInzeoe8Yq6ePaZBZ2JviM3W2UAGotekRCAGq4EkF1X3DOnR11yRsBL1tRa0PVcZiNFXZ2c34FskvomInQQ6lzpJoZbJxk43NwKJFBquJSsrByHydxKOnTxQASBmS3j+JMnsHSla3Ec6K9VWoJVn9zfjwOM7hqYAAqJQwE2a3nA48J2QGegRkpZNivSY+ys3EkKd4oJIwsvIHl3cWgLt5k4NH6OmtLWdpurOkwEMupYc7eMtDRhOcI2ui5JhVIzXzLyto/GAPuZoyo8wkoduVgJglCt7OhGbgID4Mq4si+63zUS1FuFFXFlqyaj2emHlLMcBqYu0FMuR28BbB7lOxRMSiCQXFhCKuwkhZ+pYDiGSgbsKKV8MiSRsuHSIWM9rklRiIlZZuqXjsQK8ooYJMgq3JKWVkhHbhsVxFUzthOWPkYijcbx54IKsSdT+uLr3crGKyoYgFiGR9iBk4kfloUX+JIlQRQqabmpgnhqtpQpb6RVQ1WH5DnrS4hEoGZqaerQ2dhFbz8XePxShmDbo70eISjoorO2vK8SJXI4SUmEU4zWKDzUDtWTYw7xXlbSTEj4FRg7zKnKoGRALv0Gs9Tgc1BpCywGZRQAtqVz2xrBcAMzEpfZwFSa2G5W0QBFjSMapWAEFa3HcGN7CxDzECyIkJ97qwrqWNTWVo876PPsjPkj2wvgroM5lLZKMETKVql/CvnWVFiFa/SzJUQwkoZsr67Y6vlSRV3/2tmNTOY3vnaxYwMuoPKqdzR1w7IqHymlPxaAThfU7Ko2ZXYj4AYJHL+kNdKwRQYESTRa5fsUZ/rVC1TMTyWVyYoqNtuzaHsMyv2tvoarxdfqwYgU1axFo/cnql1FGsqK+uAROV8BX4GU8WcZTATi2q7Qcyi0O0V+GhWBMNRUkn8H1SsWVE5By3Gi0ECqUeJoBfAtDa4amkdXG37AGP5Ggeb84p7UazpoKRzdFzeQ8HkoHGxprKy/Hpm5t12p47J6xTYDEz7uINEXSuxYXvFskYAc+ySxH9sf5ftKzU6IbwVBcUGg5e5FMCEXSErZR0wGayV19woM9guPjTqJdVTqR4uE4nJnLldWVkECCZLd2VLF+xtamex7IpiriSDUpvrpn9lrwGMCHyppMH+ps6LILsuFGUj1XEOXiqbqSHPUKnClpWV68kqtURVNDY4TNaocykoYeTU5ngGEQa/S1DnnE4AeXMcKjHPAmFVjCBENaeyLVNHfr3px8xUstJ94hIpfH4HKE/eDaArK6lSyVVFbdt1gxTIVk3pppVlFXi4pEhVBTObquohU85MLXn1iahvUkHJjSCMc01tLFveVVBx0DodM6jftCu7DOtIzYxrc0qp1JGP2ayYFz2Gb6HvMrO8cnGtV6Gjm3uImSfD2GpWK6uowbZGMxFKQCo1pOMtcMXFpRst+hXGoAomF3sSTBGgTglbBKWwsQ3tZqaYSp0Z1CimRDWFcCJUPYJ00BI5FkKYNoifuQxmN88SWVXWLMaUqqqgC0BmQJR6sk3u9NCf6jYLXxAfqsYEgVLAhRY2AtgtflZNFmFyhxdrLkAdWlk4D88M2ixHyepIdhMHrG/iR1ZGtq0MGpbDbRPYOXeSY1M6Ny4ZstvGSktK+XbFPATj2D371saPEsAMXhXrsZ0km/XStkhhMyBfsa6uXFZe2VCe+YMr1+GKgwrQyNYq1VRrB+EizAow6NsdNKcyVEkYeM73ys6q4kAHp6BiFklTkIrVC5oYV7uzwOGCz4UJ0Stq2lWMJy4wtb+RetL6tZFicnJmBw5UjCvXXMZVJX2MQkbf+XN5EWd78Vz8/JEsMZTBiKNzsm1inLRUQ74H4NidaqI68j5sAFgxcRveC7ieLJXfQYxjZZ2CsiWFewZXJmBIlZ1tdtrX4hSuateKso/RZOtOKW2nmq1oTzeK6dRWAWu2NRVb4hq0SXm1GvtugHrbr5IXqmSktg5CuDE2MSlPwsY5kNE2Wp3AqiZbWVLAxiBF+2iBZbuNj6MB6rsMLC7FyasaYDyo7KkoPyEtw3pEMXfPvxAJi2jAQQgjrz0rLIZSWZlIoNhwd5xK4AR9mYNjWAaLrnuImJeBVN9zBORObVvbr+mTTfFSEJLSRnHo7hEJoIi8MFqjxmvgmF5URZz4zLFgZZ8Ctu2X7ggVccKm9gVxIsOHqxXgNMKnFWZYnf1dBnOhayXq17QwFlWW09eNKyVJFmXqaONGA5aCegMbJ3UUkGY1ic3nKWgjq8qfVYGQG1gRt6rs62a6HiqqUOqdesK5NmX4nGofJoiE1d0dF9lVVkvT1/kEEaaCoYOwFpcVcoLM+7669PxC9rWqktH0sWUYld0VCpuBZ/stVRcGgy9WX2+U1Qthi9SzAqSxzZsy+OiFzBYnySGV6Gku44rD8BCOZBV3BvD5+AKRHNwMEsB6EzHnJpkTAeiUlEGkcECeB6GDZTp5YEJTlvdrknxYjTllMkfNtXwDjM7uVjK5JXUUn43rrqpK2jytaxHW0M5G8DC8rtHMYs7KSgduVQMGTYFqFvVS6rkD3sDJ46afdYFwoq11AOKCBLhvwoUgc8IGANycR6knZrdJPdsuxnyjfd3FovTlRMdEdtOl5CMV5EHsXQBis7TOwvIDZaGj2Vnpbh7cpK63VwYEMLwqbjzyl699sawFFkF1yqjUU31HfC6sW1ZFVFuXVXVgz9keEaw0ys1lWfm+azQAQSWA+hKYVfsZjPncAcUB9oIayy/UZXRNckDGji77GsWbvBo6tPrWPqOyVkBUq+INeqpzNdYs/u0ifh5qmpqIW+33JVSUcwY70KL4U9lYdU6ljtSls7lmfi9g3YzeQfVkaGFaV3ODCnaD2N8wsEDFklE3RzM3ZghdYkWHsszq70FIecnKkVkt8ezMzRq9bkGuKojRLBVSod3Y1yPqKgYW7JRQTPVyy5xIYLjOgxgT52RKJUY1dOrIiRd4futQx/A5AcSmEjz0vFWrkLzvbWAu9HOWbGgxFk1VNTpnBKk6TgwisI/HcxYXP1uAWO72ULFlBTq+aSu2VTUs6hrxM2CF+hEor1VIA9ZmFUaab1lSSgZsVs4sxzHlVLoJHr9H4DhONTkI1XC0/wiY2NoWAG5RlnHFnq6oLccpQddMuJ/O17JVA5OHLi0BqCztq7Y1++ucCd98qLI8MIHBV/cKjxQTme3hFBS3MyCqnDsuym2o80HjvFFTtrURmNaGJsmVahImjTsUXKtQZTAVs7Mvv8/+fzUrZAXcLJ6M4koe6XP0b6SmWWNDzyUpQ8bl+LtWx4tuqZ36cRYV3yuVxPNwvIiqiQCSmu7srgTzR6nkyhpCarXwFy1vGd5iP2cY06lFr5Njhhg1Y6+NB28ftbK83s8rf7kLJbKwDFPbLg25a0AdZJEiqr5phixKMDlRUtcssq1hriLqGoH+zeNgVm9OemjsETV8JdF0NHnkIFxWY1OB4Yrp7rtWJ7NgAAAPXklEQVQ3oNs5nplyVf8u2FoLu1JrHveaZWQjqAkshtFa2gzsSG3Zpkbvg3HafF9slPPlldjFlK80Gysm8Mr4MPhneNWENPGjAIpmilTPATdTRTXlCBYHYAQuPwA36xIpWtGN4q3Y2MhiGsUpuSSnlEJRD8PorC7CFYVw+F51qThgabxsTxWzCGY0ZSsb3lfqAy0OPNjNy8xiQQKsHYFQ2HBZVvVbBuq3m1oWKajqaonsM6uZUr6CjXWNZ0l5E3h3jURma6kP3MJIiy1Lm+kahQq41N2iZja5sjtlLYNZHZrH6qUGm4vMbDp6Rw2CFmvuyFkrBcCyMtFqBaECmsHoK9BZ2LA/lJcRqSaDqnaWbrZdGaz3DLgIvBln4woGztbyJGqslwxkhhHrTjTYFXCtOoKS8uLdofVdAbOylGU6nlYpXWZts4nXBq6WxJitMNokHUJnbnJplQm+aGpY2a5GMV2QD1hRubBPFKdumf5OHkLHz0F9luE5kjBjRa0nFE5CUGqHw32MmjZ6xkgINVnSnZ1VZStK2qKlRaLlQgK7uTq7JFXJwM+3SOEKyhZNI+tJ0I5qMYy9k2qJD7dVWdqKXa0CKNR0Ccjg+B2IYu2fcBZJZkMFgM11r0X92wilghFGgzVnexlqB7xL9mS29SiYUVY2nXOZjNBRsyDsQPRWW5hrZ4XcdC4HVWRbjgJr4sFofK5SzjQ7rhI1UebdPdEbj6sqIvTZQZ5va08rABsAW0UxeWytAk7A2KJ9ZpxzCioB24XFtYAeXYxr6anSqhLgppEqWbGwLunTgrV+IjWlL29ljaAl4EQMGsErp4apeZiquwRXLXAqOCeru32mmydc6oWTSWpFAGdzeTB8RTHVMEtlM90CbbQCYhPjq3egYr1FGdYIQjiuDGZ5zZ/AzobKGOyLxti6c4Rwtv2anyWlLICnlLhxJRXt6A5ebDBWFNONbxWZ2d02mnu4S9YECpeppV1zSWRBWxHYzVIv1CXSouwqqX3jBBBDZdYQbpTQW4ZQlS8r5kH4suSRmg2++3JN10x1PaAmEkmtYlEdeGpJEM6kOuCqCR22oSujj5IV2HdT0zj5prLKTjXFAPjdQlyq7xIBxAQP5yMczG4VxAKw0n6ilZ2QBce2pLulkuxxqnoIzFfgqyqjil9S1VNwBrFmeyeops8yOjZUybZdfS8CuaTIJumzs5tODaNtLpFDQ/PcJGweLhmeL1nB0KqiUDScsiUVD89Di3HtrKtSULw3RLiygZD+7sF8JTObgYsrGvDNUFRGl1iy0Ll1YkUc2aJYMog920I8qW6YDCg1Mqk0JHJFKXkbgbRreI+qpYNOZHrVcDUba7pjsphSJNtK6upgRNAVoOS0mugBeN4bIZgHhuPZ/s1ENaX6KsVr+YNrh1Nb7ipR0PE5zbNRegCbrHRUw6Yf07dLBJl1f8KB9as2V1nNqAsl62LBBhehwalerkHmB1JFIEZKSEusdl5JQj1nJlHXSCF342gJ9CYGrXelknJIXqVP8sD+qtplCR3XH2qfKq0ygMp+KnVkKxNlZ8m2YkIlVMiCnXUwl7qznBKSvQz3m3Pt6oQbXO5b5FixCh/fHxUQW/AEcK6zCNqKQnL9sywqmKuwvqSYzT/aPVNNpVyhvRW21aqciCsjdWvBwILUvh5VyCzbWoC1pJjJ680CWsl+udKB6T5RwG1mlohnlpbg47iz5U9ha0FGtmRLFYBtO99y97Ap0z+ZDTAog6kSLZsMHg/IFkkgp6CpvU2U0cYVSdnmkjwBdOmXbxTWNWzuIbipMioVxEckZEoahSOiy2M3K0jcC1LhVDwaqG0ZvkcWqCnrG4GIxykrqlbWdw6LQyBaZR8HmLRIhQWsHswD42ZXVLNkf9l+FlW0HVQ2lwFsC/Z1FdzlQR0KaPfo+Fdfu+/dwVRICu1CGR7AEIiAhc+AZUF0kOBaPxmUqg4i64vQnU4nFDYJ9Nz+1fVXveH9qmr+kPILx8oKcRV/BFbxbE0JMT0kSD4w6L/lNY8ocsqagVdU3A3MjxhxcGuqzsPH4irpaow1q6OyrVjvp9Npc59E91LldboYVzJWdimWfAW2SNEKcDaX2FmBLLA/uKxlmhh613Is1URQApbKfttwxL02q6Onx5pQxSbPojAg+v5hAnN6LHVRDXIsvKtRjiS0qJUyZTAXVbAK82ElFJWaQdVoqUC1Unt7BVaTQudM6SuqexjQJN4+0icaxv/utbKv83ETbT8H8gjcOKxOJmbUa6OOVXht3dFY6rHv9XoNzFLceEA1o8+pKm0LAHPHZ2rYKjFq0hfZFixsqHJgD3eD5n+U0kb1mFjXkn2lvMSSOsNE/CdIAKF0Sytq6urOHUN5gwg4GZosgbmggM5ucra2qrS2Ig1cbiBBcxYzgzUDNLCvL8GbZXNp6ORy3LmS+Kk83zRIAK6A1ioKa2I9NapIuiUFdfC9766PFZUtqUr6KbWk+zZU1a/ZrIXEztrjTOfz7hwKziCeXIaraHtbZIMz+2pGgazCmw4qWAFvEdhodYp0Xq0pV7G1YWYWbO4qhGq42+Z8BYtrLWvluNPpZAeaFFS1vubPgbgxsqcpnAaszBovKaFoDQ8BGtjfUOl4NAG2nmQV04feJgumvX2fsrQEWZghL0JnVdYkn3DOZIeRN86RqPWCmsvGVqEMRnwxQAxwS8EMYo3IzmY2+BCcLp4MKiuyuhImamlbZFcNoNl7tp+RHd18ZjQIRKyXdFRhN98/hyKqwXWNo7O1wiaXoHN108REZZWEq6grnIfjzeg8jdRf1XEL4kkXa5bBjKxoKaljBjeHlVxQ4GaycpW4lDOAKtnTxHAtOfzOtZwHAM7sqVXkV6yu6kap1nHkXKqWF/4XHqjenNKqBjpR3l1ch3Ejg1+EsgdQhsdG0B4FM9sWAVWpuAyiwTPleZxt9VyZVS2qXfReWqTAilpr9ApoWTjxymit7NwV4JTriZyOA9B0k7HFfULourmKYHVnRQvqGL5HMHdqFcR2qWpmcK6eTwx2dipWrviDilr+fKWq3OWRWdHKwA4eu8wjchbeRzFilqjjZN3ufCpfkJ0/scVpnYk6L0PI77lxdWCZ87WiWm7B/AGquQSnujGKsB8CJmiJq8q1pKIVWyqOiTK66r18BN8r74/AE71fdC3yPS2MxdOpnE1tlVxD9JmVOoggN+r4PjAXVFPa3Eg5jVJGFVUGNolH20GVrUB7BOySWq6WqYQdWR92pcFMYMwckbSgCKCqD67DiiWu1g8MQC9ByfcFqW1L+jL714qNCuznoSxt0da2gtWN1G8F0BK0NN0nuimelUF9dIdAfjO44UT3CjQLoUeLHJFTO3gmpRuIIOvwBQCbqNeo3qtZ9iF6xVK13GRlo4zqimq+CGdTiR1uRY8oqgE02hZBa79kZXPMquxRHKla2saZWN4mRqZUj0vLCKhkjKnqOQHNuSZVJoKvAqS1wpEquvWDC1B2ypwrCPsRMEPVTODMLJMDv6qeKXwi2JYV5Sq4qKyvgGsHCLiuj2jR59V8gMqSJ2FJZRXEHVRHj3sFPrct6OpqlW1GpatQdt0GvwfM6n63InsGVFhJGaBqgqqIV6IsXllZgySPq4R3bnt3wi5cv+cN2yqQLW1T95KYVsWWtKk4cB9W53WQQflQYR6Wl4HaJZjvVE0D5yvq+RKgZCs5qdBEP5sD94cAvQLlSgNaSMAtHx88BuNQ41zdFsX30zKbcs0MLD/ihkpQzl0wiTqKLTfbKmCmyYICnK0IbaieC4CG9iSyLQ7cIMGQwau6TKoq60Apl3WN40LZpca1CKKK9VQyyIEn8w0F8F6CL2h8o3ixGwC7s7EWzCOqmcApYxYD4jsAzVS0sl2t98pA7vrKophCVSonbYpgH6mvSn24pTBV4sdtV3BtMq5k82y+IADvUJ0uAlkCVTxIaPm+UNu/qkV4F1TzHXCGrXIAqItBKypqK99VtAOVs64O4ObX7pHLVCpYHcRmwvLR7TvYAKBBN58LGVzDuFz+hQbWgncQyCZAk+VbsPSouf93261iZgmfCpwRbAvqmSqriU2PwhjaoOyYqtIegVXViTsmyta6bGySpY3gyRrpIyAeaWDDxtpsXwKyalMDKNP7YBXMqEskUsi2uC8FNAPxAKTVfT1o6VzM0E0jF+1rWcUuHvdyg7vgoFplX8HpvHpMCOMRUPHzZkInsqlFKNX/EIO52E0SxSzOwob2VmRLW5D1XIU0rbgM1AzWgyC7fe8G7xUAK/taEBat7luqtyP7EmsaJQOj5F+mrnZfCuYCfBUAWwShyd6pMY/vAHG1UqOYpbI/gy5T0CMKm+UO3gFuC85dgfDVeguPDfITrIBLsLrcgdh3CFgFZjaKJ4Iv3F8ANEqvuxR1tVKOgLoCa1jxboBAkj6v7j/icFbA7f4rfRnQDLRViG13i0vqBQrYVqBbADZT0ZpiHoSzvQpopKIFS3sE1HfBWlHXd0H7LnArqvougMtljHBgZnh3Eoz/BKjLML4Z2Aq0+hEJr9jaVUBbvNzCIUiroC7AWmmFw4o5AK3MtB5VypZMSFgs05JyGVwlwBqsEGAAa2ZU1CjUexXGsE4rKriilBvFzOKKo3AuAroE6QFQU3u8YpNXwS5k+1TZt5UrwouN4KiUEw+k3ZWDp1RXHNRqXb21Ts39945yZSg3VnZFNQ9CF3XeZyr5DgBXKiwCMa2MxeTDYXgP1Fsf9QNKZc0k81RJk3r6EQ3rCmBVyLL75EjZ1pIVDHoFtiOAHoB0BdTVylqBsKKKS+AeBXJVLY+CXASuGvO/Auq7GuEjDfGKg1oKa1z/dmmi9I9SUGNhl0AtfulHAawoYrnSkmNXAVuGEhrEVXvUF+A5Ct2PqNOjDetyna4CmeUolmeXLN4Aq7C5Sj10Q7yjgl+t6CNxSRHmI5X+CpwreYB3Qfdqna4q21KdBuc4GoZsn49ZOOiVinwHqK9WzjvgeweEh2AU5+vtxZ9Cd9Wqkh49V18E5oj6vVyn0RStAyGIO5edXRKd5B0VGVXq2yr3xYp+5Ut+C4QJ4P1N339pQMjRejj4vb/Dcr6rQc3O/0rjmtZpeYCBiCHfCemRbNhbK/pNUPc3wfKy5f2D7OlL3/uPhve/oU4T0F8f+VNM2vyoiv0jK+KHQfdHq+0bncz4oz73/+Y6LbKw1o/5B7eOf1Rl/0du9B9tn/9bvrf/j+v0h6ttn2tp/r/4819y4/zv5391uvzzfwDifz6phT1MPgAAAABJRU5ErkJggg==)}.color-picker .cp-add-color-button-class{position:absolute;display:inline;padding:0;margin:3px -3px;border:0;cursor:pointer;background:transparent}.color-picker .cp-add-color-button-class:hover{text-decoration:underline}.color-picker .cp-add-color-button-class:disabled{cursor:not-allowed;color:#999}.color-picker .cp-add-color-button-class:disabled:hover{text-decoration:none}.color-picker .cp-remove-color-button-class{position:absolute;top:-5px;right:-5px;display:block;width:10px;height:10px;border-radius:50%;cursor:pointer;text-align:center;background:#fff;box-shadow:1px 1px 5px #333}.color-picker .cp-remove-color-button-class:before{content:"x";position:relative;bottom:3.5px;display:inline-block;font-size:10px}.color-picker .eyedropper-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);fill:#fff;mix-blend-mode:exclusion}\n'],encapsulation:2}),n})(),yV=(()=>{class n{constructor(t,i,r,o,l,c){this.injector=t,this.cfr=i,this.appRef=r,this.vcRef=o,this.elRef=l,this._service=c,this.dialogCreated=!1,this.ignoreChanges=!1,this.viewAttachedToAppRef=!1,this.cpWidth="230px",this.cpHeight="auto",this.cpToggle=!1,this.cpDisabled=!1,this.cpIgnoredElements=[],this.cpFallbackColor="",this.cpColorMode="color",this.cpCmykEnabled=!1,this.cpOutputFormat="auto",this.cpAlphaChannel="enabled",this.cpDisableInput=!1,this.cpDialogDisplay="popup",this.cpSaveClickOutside=!0,this.cpCloseClickOutside=!0,this.cpUseRootViewContainer=!1,this.cpPosition="auto",this.cpPositionOffset="0%",this.cpPositionRelativeToArrow=!1,this.cpOKButton=!1,this.cpOKButtonText="OK",this.cpOKButtonClass="cp-ok-button-class",this.cpCancelButton=!1,this.cpCancelButtonText="Cancel",this.cpCancelButtonClass="cp-cancel-button-class",this.cpEyeDropper=!1,this.cpPresetLabel="Preset colors",this.cpPresetColorsClass="cp-preset-colors-class",this.cpMaxPresetColorsLength=6,this.cpPresetEmptyMessage="No colors added",this.cpPresetEmptyMessageClass="preset-empty-message",this.cpAddColorButton=!1,this.cpAddColorButtonText="Add color",this.cpAddColorButtonClass="cp-add-color-button-class",this.cpRemoveColorButtonClass="cp-remove-color-button-class",this.cpInputChange=new wi(!0),this.cpToggleChange=new wi(!0),this.cpSliderChange=new wi(!0),this.cpSliderDragEnd=new wi(!0),this.cpSliderDragStart=new wi(!0),this.colorPickerOpen=new wi(!0),this.colorPickerClose=new wi(!0),this.colorPickerCancel=new wi(!0),this.colorPickerSelect=new wi(!0),this.colorPickerChange=new wi(!1),this.cpCmykColorChange=new wi(!0),this.cpPresetColorsChange=new wi(!0)}handleClick(){this.inputFocus()}handleFocus(){this.inputFocus()}handleInput(t){this.inputChange(t)}ngOnDestroy(){null!=this.cmpRef&&(this.viewAttachedToAppRef&&this.appRef.detachView(this.cmpRef.hostView),this.cmpRef.destroy(),this.cmpRef=null,this.dialog=null)}ngOnChanges(t){t.cpToggle&&!this.cpDisabled&&(t.cpToggle.currentValue?this.openDialog():t.cpToggle.currentValue||this.closeDialog()),t.colorPicker&&(this.dialog&&!this.ignoreChanges&&("inline"===this.cpDialogDisplay&&this.dialog.setInitialColor(t.colorPicker.currentValue),this.dialog.setColorFromString(t.colorPicker.currentValue,!1),this.cpUseRootViewContainer&&"inline"!==this.cpDialogDisplay&&this.cmpRef.changeDetectorRef.detectChanges()),this.ignoreChanges=!1),(t.cpPresetLabel||t.cpPresetColors)&&this.dialog&&this.dialog.setPresetConfig(this.cpPresetLabel,this.cpPresetColors)}openDialog(){if(this.dialogCreated)this.dialog&&this.dialog.openDialog(this.colorPicker);else{let t=this.vcRef;if(this.dialogCreated=!0,this.viewAttachedToAppRef=!1,this.cpUseRootViewContainer&&"inline"!==this.cpDialogDisplay){const o=this.injector.get(this.appRef.componentTypes[0],Cr.NULL);o!==Cr.NULL?t=o.vcRef||o.viewContainerRef||this.vcRef:this.viewAttachedToAppRef=!0}const i=this.cfr.resolveComponentFactory(ZJ);if(this.viewAttachedToAppRef)this.cmpRef=i.create(this.injector),this.appRef.attachView(this.cmpRef.hostView),document.body.appendChild(this.cmpRef.hostView.rootNodes[0]);else{const r=Cr.create({providers:[],parent:t.injector});this.cmpRef=t.createComponent(i,0,r,[])}this.cmpRef.instance.setupDialog(this,this.elRef,this.colorPicker,this.cpWidth,this.cpHeight,this.cpDialogDisplay,this.cpFallbackColor,this.cpColorMode,this.cpCmykEnabled,this.cpAlphaChannel,this.cpOutputFormat,this.cpDisableInput,this.cpIgnoredElements,this.cpSaveClickOutside,this.cpCloseClickOutside,this.cpUseRootViewContainer,this.cpPosition,this.cpPositionOffset,this.cpPositionRelativeToArrow,this.cpPresetLabel,this.cpPresetColors,this.cpPresetColorsClass,this.cpMaxPresetColorsLength,this.cpPresetEmptyMessage,this.cpPresetEmptyMessageClass,this.cpOKButton,this.cpOKButtonClass,this.cpOKButtonText,this.cpCancelButton,this.cpCancelButtonClass,this.cpCancelButtonText,this.cpAddColorButton,this.cpAddColorButtonClass,this.cpAddColorButtonText,this.cpRemoveColorButtonClass,this.cpEyeDropper,this.elRef,this.cpExtraTemplate),this.dialog=this.cmpRef.instance,this.vcRef!==t&&this.cmpRef.changeDetectorRef.detectChanges()}}closeDialog(){this.dialog&&"popup"===this.cpDialogDisplay&&this.dialog.closeDialog()}cmykChanged(t){this.cpCmykColorChange.emit(t)}stateChanged(t){this.cpToggleChange.emit(t),t?this.colorPickerOpen.emit(this.colorPicker):this.colorPickerClose.emit(this.colorPicker)}colorChanged(t,i=!0){this.ignoreChanges=i,this.colorPickerChange.emit(t)}colorSelected(t){this.colorPickerSelect.emit(t)}colorCanceled(){this.colorPickerCancel.emit()}inputFocus(){const t=this.elRef.nativeElement,i=this.cpIgnoredElements.filter(r=>r===t);!this.cpDisabled&&!i.length&&("undefined"!=typeof document&&t===document.activeElement?this.openDialog():this.dialog&&this.dialog.show?this.closeDialog():this.openDialog())}inputChange(t){this.dialog?this.dialog.setColorFromString(t.target.value,!0):(this.colorPicker=t.target.value,this.colorPickerChange.emit(this.colorPicker))}inputChanged(t){this.cpInputChange.emit(t)}sliderChanged(t){this.cpSliderChange.emit(t)}sliderDragEnd(t){this.cpSliderDragEnd.emit(t)}sliderDragStart(t){this.cpSliderDragStart.emit(t)}presetColorsChanged(t){this.cpPresetColorsChange.emit(t)}}return n.\u0275fac=function(t){return new(t||n)(Te(Cr),Te(Iy),Te(IS),Te(Ul),Te(Yo),Te(GI))},n.\u0275dir=Sn({type:n,selectors:[["","colorPicker",""]],hostBindings:function(t,i){1&t&&Ft("click",function(){return i.handleClick()})("focus",function(){return i.handleFocus()})("input",function(o){return i.handleInput(o)})},inputs:{colorPicker:"colorPicker",cpWidth:"cpWidth",cpHeight:"cpHeight",cpToggle:"cpToggle",cpDisabled:"cpDisabled",cpIgnoredElements:"cpIgnoredElements",cpFallbackColor:"cpFallbackColor",cpColorMode:"cpColorMode",cpCmykEnabled:"cpCmykEnabled",cpOutputFormat:"cpOutputFormat",cpAlphaChannel:"cpAlphaChannel",cpDisableInput:"cpDisableInput",cpDialogDisplay:"cpDialogDisplay",cpSaveClickOutside:"cpSaveClickOutside",cpCloseClickOutside:"cpCloseClickOutside",cpUseRootViewContainer:"cpUseRootViewContainer",cpPosition:"cpPosition",cpPositionOffset:"cpPositionOffset",cpPositionRelativeToArrow:"cpPositionRelativeToArrow",cpOKButton:"cpOKButton",cpOKButtonText:"cpOKButtonText",cpOKButtonClass:"cpOKButtonClass",cpCancelButton:"cpCancelButton",cpCancelButtonText:"cpCancelButtonText",cpCancelButtonClass:"cpCancelButtonClass",cpEyeDropper:"cpEyeDropper",cpPresetLabel:"cpPresetLabel",cpPresetColors:"cpPresetColors",cpPresetColorsClass:"cpPresetColorsClass",cpMaxPresetColorsLength:"cpMaxPresetColorsLength",cpPresetEmptyMessage:"cpPresetEmptyMessage",cpPresetEmptyMessageClass:"cpPresetEmptyMessageClass",cpAddColorButton:"cpAddColorButton",cpAddColorButtonText:"cpAddColorButtonText",cpAddColorButtonClass:"cpAddColorButtonClass",cpRemoveColorButtonClass:"cpRemoveColorButtonClass",cpExtraTemplate:"cpExtraTemplate"},outputs:{cpInputChange:"cpInputChange",cpToggleChange:"cpToggleChange",cpSliderChange:"cpSliderChange",cpSliderDragEnd:"cpSliderDragEnd",cpSliderDragStart:"cpSliderDragStart",colorPickerOpen:"colorPickerOpen",colorPickerClose:"colorPickerClose",colorPickerCancel:"colorPickerCancel",colorPickerSelect:"colorPickerSelect",colorPickerChange:"colorPickerChange",cpCmykColorChange:"cpCmykColorChange",cpPresetColorsChange:"cpPresetColorsChange"},exportAs:["ngxColorPicker"],features:[Ms]}),n})(),QJ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({providers:[GI],imports:[[pR]]}),n})(),_V=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(Te(Rh),Te(Yo))},n.\u0275dir=Sn({type:n}),n})(),tg=(()=>{class n extends _V{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=go(n)))(i||n)}}(),n.\u0275dir=Sn({type:n,features:[Vi]}),n})();const Mu=new Xn("NgValueAccessor"),tQ={provide:Mu,useExisting:cr(()=>sT),multi:!0};let sT=(()=>{class n extends tg{writeValue(t){this.setProperty("checked",t)}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=go(n)))(i||n)}}(),n.\u0275dir=Sn({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(t,i){1&t&&Ft("change",function(o){return i.onChange(o.target.checked)})("blur",function(){return i.onTouched()})},features:[Xr([tQ]),Vi]}),n})();const nQ={provide:Mu,useExisting:cr(()=>vb),multi:!0},rQ=new Xn("CompositionEventMode");let vb=(()=>{class n extends _V{constructor(t,i,r){super(t,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function iQ(){const n=lu()?lu().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(Te(Rh),Te(Yo),Te(rQ,8))},n.\u0275dir=Sn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,i){1&t&&Ft("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[Xr([nQ]),Vi]}),n})();const ea=new Xn("NgValidators"),Vf=new Xn("NgAsyncValidators");function AV(n){return null!=n}function DV(n){const e=cf(n)?ss(n):n;return fa(e),e}function RV(n){let e={};return n.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function PV(n,e){return e.map(t=>t(n))}function IV(n){return n.map(e=>function oQ(n){return!n.validate}(e)?e:t=>e.validate(t))}function WI(n){return null!=n?function LV(n){if(!n)return null;const e=n.filter(AV);return 0==e.length?null:function(t){return RV(PV(t,e))}}(IV(n)):null}function qI(n){return null!=n?function FV(n){if(!n)return null;const e=n.filter(AV);return 0==e.length?null:function(t){return function eQ(...n){const e=Za(n),{args:t,keys:i}=JB(n),r=new pr(o=>{const{length:l}=t;if(!l)return void o.complete();const c=new Array(l);let d=l,p=l;for(let y=0;y<l;y++){let v=!1;pe(t[y]).subscribe(Mn(o,x=>{v||(v=!0,p--),c[y]=x},()=>d--,void 0,()=>{(!d||!v)&&(p||o.next(i?QB(i,c):c),o.complete())}))}});return e?r.pipe(gI(e)):r}(PV(t,e).map(DV)).pipe(Pn(RV))}}(IV(n)):null}function NV(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function jI(n){return n?Array.isArray(n)?n:[n]:[]}function aT(n,e){return Array.isArray(n)?n.includes(e):n===e}function BV(n,e){const t=jI(e);return jI(n).forEach(r=>{aT(t,r)||t.push(r)}),t}function UV(n,e){return jI(e).filter(t=>!aT(n,t))}class VV{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=WI(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=qI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class zf extends VV{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class ya extends VV{get formDirective(){return null}get path(){return null}}let lT=(()=>{class n extends class zV{constructor(e){this._cd=e}is(e){var t,i,r;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(r=null===(i=this._cd)||void 0===i?void 0:i.control)||void 0===r?void 0:r[e])}}{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Te(zf,2))},n.\u0275dir=Sn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,i){2&t&&hf("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))},features:[Vi]}),n})();function xb(n,e){(function YI(n,e){const t=function OV(n){return n._rawValidators}(n);null!==e.validator?n.setValidators(NV(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const i=function kV(n){return n._rawAsyncValidators}(n);null!==e.asyncValidator?n.setAsyncValidators(NV(i,e.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();dT(e._rawValidators,r),dT(e._rawAsyncValidators,r)})(n,e),e.valueAccessor.writeValue(n.value),function mQ(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&GV(n,e)})}(n,e),function yQ(n,e){const t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function gQ(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&GV(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function pQ(n,e){if(e.valueAccessor.setDisabledState){const t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function dT(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function GV(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function JI(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const bb="VALID",pT="INVALID",U_="PENDING",wb="DISABLED";function eL(n){return(mT(n)?n.validators:n)||null}function XV(n){return Array.isArray(n)?WI(n):n||null}function tL(n,e){return(mT(e)?e.asyncValidators:n)||null}function $V(n){return Array.isArray(n)?qI(n):n||null}function mT(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}const nL=n=>n instanceof rL;function KV(n){return(n=>n instanceof QV)(n)?n.value:n.getRawValue()}function ZV(n,e){const t=nL(n),i=n.controls;if(!(t?Object.keys(i):i).length)throw new Yt(1e3,"");if(!i[e])throw new Yt(1001,"")}function JV(n,e){nL(n),n._forEachChild((i,r)=>{if(void 0===e[r])throw new Yt(1002,"")})}class iL{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=XV(this._rawValidators),this._composedAsyncValidatorFn=$V(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===bb}get invalid(){return this.status===pT}get pending(){return this.status==U_}get disabled(){return this.status===wb}get enabled(){return this.status!==wb}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=XV(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=$V(e)}addValidators(e){this.setValidators(BV(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(BV(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(UV(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(UV(e,this._rawAsyncValidators))}hasValidator(e){return aT(this._rawValidators,e)}hasAsyncValidator(e){return aT(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=U_,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=wb,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=bb,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===bb||this.status===U_)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wb:bb}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=U_,this._hasOwnPendingAsyncValidator=!0;const t=DV(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function bQ(n,e,t){if(null==e||(Array.isArray(e)||(e=e.split(t)),Array.isArray(e)&&0===e.length))return null;let i=n;return e.forEach(r=>{i=nL(i)?i.controls.hasOwnProperty(r)?i.controls[r]:null:(n=>n instanceof MQ)(i)&&i.at(r)||null}),i}(this,e,".")}getError(e,t){const i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new wi,this.statusChanges=new wi}_calculateStatus(){return this._allControlsDisabled()?wb:this.errors?pT:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(U_)?U_:this._anyControlsHaveStatus(pT)?pT:bb}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){mT(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class QV extends iL{constructor(e=null,t,i){super(eL(t),tL(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),mT(t)&&t.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){JI(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){JI(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class rL extends iL{constructor(e,t,i){super(eL(t),tL(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,i={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){JV(this,e),Object.keys(e).forEach(i=>{ZV(this,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((i,r)=>{i.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,i)=>(e[i]=KV(t),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,i)=>!!i._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const i=this.controls[t];i&&e(i,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const i=this.controls[t];if(this.contains(t)&&e(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,i)=>((t.enabled||this.disabled)&&(e[i]=t.value),e))}_reduceChildren(e,t){let i=e;return this._forEachChild((r,o)=>{i=t(i,r,o)}),i}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class MQ extends iL{constructor(e,t,i){super(eL(t),tL(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,i={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){JV(this,e),e.forEach((i,r)=>{ZV(this,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((i,r)=>{i.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>KV(e))}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,i)=>!!i._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,i)=>{e(t,i)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const CQ={provide:zf,useExisting:cr(()=>Sb)},nz=(()=>Promise.resolve(null))();let Sb=(()=>{class n extends zf{constructor(t,i,r,o,l){super(),this._changeDetectorRef=l,this.control=new QV,this._registered=!1,this.update=new wi,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=function ZI(n,e){if(!e)return null;let t,i,r;return Array.isArray(e),e.forEach(o=>{o.constructor===vb?t=o:function xQ(n){return Object.getPrototypeOf(n.constructor)===tg}(o)?i=o:r=o}),r||i||t||null}(0,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function KI(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){xb(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){nz.then(()=>{var i;this.control.setValue(t,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(t){const i=t.isDisabled.currentValue,r=""===i||i&&"false"!==i;nz.then(()=>{var o;r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),null===(o=this._changeDetectorRef)||void 0===o||o.markForCheck()})}_getPath(t){return this._parent?function uT(n,e){return[...e.path,n]}(t,this._parent):[t]}}return n.\u0275fac=function(t){return new(t||n)(Te(ya,9),Te(ea,10),Te(Vf,10),Te(Mu,10),Te(hx,8))},n.\u0275dir=Sn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Xr([CQ]),Vi,Ms]}),n})(),rz=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({}),n})();const PQ={provide:Mu,useExisting:cr(()=>gT),multi:!0};let gT=(()=>{class n extends tg{writeValue(t){this.setProperty("value",parseFloat(t))}registerOnChange(t){this.onChange=i=>{t(""==i?null:parseFloat(i))}}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=go(n)))(i||n)}}(),n.\u0275dir=Sn({type:n,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(t,i){1&t&&Ft("change",function(o){return i.onChange(o.target.value)})("input",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},features:[Xr([PQ]),Vi]}),n})(),JQ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({imports:[[rz]]}),n})(),QQ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({imports:[JQ]}),n})(),bz=(()=>{class n extends zy{constructor(t){super(),this.colWidthService=t,this.data={width:1},this.colWidth=25}ngOnInit(){this.colWidthService.getSidebarWidth().subscribe(t=>{3===this.data.width&&(this.colWidth=t)})}}return n.\u0275fac=function(t){return new(t||n)(Te(oV))},n.\u0275cmp=Ao({type:n,selectors:[["app-col"]],inputs:{data:"data"},features:[Vi],decls:3,vars:2,consts:[[1,"col-flex",3,"hidden"],[1,"col-app-base-wrapper"],[3,"children"]],template:function(t,i){1&t&&(We(0,"div",0)(1,"div",1),ur(2,"app-base",2),Ne()()),2&t&&(nt("hidden",100===i.colWidth),at(2),nt("children",i.children))},styles:[".col-app-base-wrapper[_ngcontent-%COMP%]{overflow-x:clip;overflow-y:auto;max-height:99vh;padding-right:1rem}.col-flex[_ngcontent-%COMP%]{width:25%}"]}),n})(),wz=(()=>{class n extends zy{constructor(){super(),this.data={}}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ao({type:n,selectors:[["app-row"]],inputs:{data:"data"},features:[Vi],decls:1,vars:1,consts:[[3,"children"]],template:function(t,i){1&t&&ur(0,"app-base",0),2&t&&nt("children",i.children)},styles:[""]}),n})();function eee(n,e){if(1&n){const t=zi();We(0,"div",3)(1,"div",4)(2,"div",5)(3,"label"),B(4,"Scene Id:"),Ne()(),We(5,"div",6),B(6),Ne()(),We(7,"div",4)(8,"div",5)(9,"label",7),B(10,"Select Background Color:"),Ne()(),We(11,"div",8)(12,"input",9),Ft("colorPickerChange",function(r){return vt(t),Oe().backgroundColor=r})("colorPickerChange",function(){return vt(t),Oe().changeBackground()}),Ne()()(),We(13,"div",4)(14,"div",5)(15,"label"),B(16),function pF(n,e){const t=Ri();let i;const r=n+20;t.firstCreatePass?(i=function bG(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(r,i.onDestroy)):i=t.data[r];const o=i.factory||(i.factory=Wo(i.type)),l=Uc(Te);try{const c=Ng(!1),d=o();return Ng(c),function W1(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,ot(),r,d),d}finally{Uc(l)}}(17,"number"),Ne()(),We(18,"div",6)(19,"p",10)(20,"input",11),Ft("ngModelChange",function(r){return vt(t),Oe().pointBudget=r})("ngModelChange",function(){return vt(t),Oe().onPointBudgetChange()}),Ne()()()(),We(21,"div",4)(22,"div",5)(23,"label"),B(24),Ne()(),We(25,"div",6)(26,"p",10)(27,"input",11),Ft("ngModelChange",function(r){return vt(t),Oe().fov=r})("ngModelChange",function(){return vt(t),Oe().onFovChange()}),Ne()()()(),We(28,"div",4)(29,"div",5)(30,"label"),B(31,"Activate Camera Sync:"),Ne()(),We(32,"div",6),ur(33,"input",12),We(34,"span",13),Ft("click",function(){return vt(t),Oe().onCameraSync()}),B(35,"Toggle"),Ne()()(),We(36,"div",4)(37,"div",5)(38,"label"),B(39,"Start Animation:"),Ne()(),We(40,"div",6)(41,"button",14),Ft("click",function(){return vt(t),Oe().onStartAnimation()}),B(42,"Start Animation"),Ne()()(),We(43,"div",4)(44,"div",5)(45,"label"),B(46,"Share Camera State:"),Ne()(),We(47,"div",6)(48,"button",14),Ft("click",function(){return vt(t),Oe().onShareCameraState()}),B(49,"Copy to Clipboard"),Ne()()(),We(50,"div",4)(51,"div",5)(52,"label"),B(53,"Save Screenshot (gets saved on server):"),Ne()(),We(54,"div",6)(55,"button",14),Ft("click",function(){return vt(t),Oe().onCreateScreenshot()}),B(56,"Screenshot"),Ne()()()()}if(2&n){const t=Oe();nt("hidden",t.hidden),at(6),G(" ",t.data.sceneId," "),at(6),Qr("background",t.backgroundColor),nt("colorPicker",t.backgroundColor),at(4),G("Point Budget (",mF(17,18,t.pointBudget,"1.0-0","en-US"),"):"),at(4),$o("min",t.pointBudgetOptions.min),$o("max",t.pointBudgetOptions.max),$o("step",t.pointBudgetOptions.step),nt("value",t.pointBudget)("ngModel",t.pointBudget),at(4),G("Camera FOV (",t.fov,"):"),at(3),$o("min",t.fovOptions.min),$o("max",t.fovOptions.max),$o("step",t.fovOptions.step),nt("value",t.fov)("ngModel",t.fov),at(6),nt("checked",t.cameraSync)}}let tee=(()=>{class n{constructor(t,i,r){this.ws=t,this.sceneElementsService=i,this.clipboard=r,this.pointBudgetOptions={min:1e5,max:2e8,step:25e3},this.fovOptions={min:45,max:120,step:5},this.hidden=!1,this.pointBudget=1e6,this.fov=60,this.backgroundColor="#FFFFFF",this.cameraSync=!1,this._data={sceneId:-1}}set data(t){this._data=t,this.loadViewer()}get data(){return this._data}ngOnInit(){}onPointBudgetChange(){var t,i;null===(t=this.viewer)||void 0===t||t.setPointBudget(this.pointBudget),null===(i=this.viewer)||void 0===i||i.requestRender()}changeBackground(){var t,i;null===(t=this.viewer)||void 0===t||t.changeBackground(this.backgroundColor),null===(i=this.viewer)||void 0===i||i.requestRender()}onFovChange(){var t,i;null===(t=this.viewer)||void 0===t||t.setCameraFOV(this.fov),null===(i=this.viewer)||void 0===i||i.requestRender()}onCameraSync(){var t;this.cameraSync=!this.cameraSync,null===(t=this.viewer)||void 0===t||t.setCameraSync(this.cameraSync)}onStartAnimation(){this.ws.startAnimation(this.data.sceneId,"animation_1",!0)}onShareCameraState(){if(this.viewer){let t=Mx.cameraStateToUrlParams(this.viewer.getCurrentCameraState());this.clipboard.copy(this.sceneElementsService.baseUrl+t)}}onCreateScreenshot(){var t;null===(t=this.viewer)||void 0===t||t.saveScreenshot("sidebar")}pickerTest(){var t;null===(t=this.viewer)||void 0===t||t.pickPointTest()}loadViewer(){this.sceneElementsService.getViewerData().subscribe(t=>{t.has(this.data.sceneId)&&setTimeout(()=>{var i;this.viewer=null===(i=t.get(this.data.sceneId))||void 0===i?void 0:i.viewer,this.changeBackground()})})}}return n.\u0275fac=function(t){return new(t||n)(Te(LC),Te(wx),Te(KB))},n.\u0275cmp=Ao({type:n,selectors:[["app-scene-settings"]],inputs:{data:"data"},decls:5,vars:1,consts:[[1,"sidebar"],[1,"title-divider",3,"click"],[3,"hidden",4,"ngIf"],[3,"hidden"],[1,"row"],[1,"col","s4","description"],[1,"col","s8"],["for","background-color"],[1,"col","s8","ngx-color-picker"],["id","background-color",3,"colorPicker","colorPickerChange"],[1,"range-field"],["type","range",3,"min","max","step","value","ngModel","ngModelChange"],["type","checkbox",1,"filled-in","checkbox-blue",3,"checked"],[3,"click"],[1,"waves-effect","btn-small",3,"click"]],template:function(t,i){1&t&&(We(0,"div",0)(1,"div",1),Ft("click",function(){return i.hidden=!i.hidden}),We(2,"span"),B(3,"Scene Settings"),Ne()(),xn(4,eee,57,22,"div",2),Ne()),2&t&&(at(4),nt("ngIf",i.viewer))},directives:[ky,yV,gT,vb,lT,Sb],pipes:[RN],styles:["",".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.ngx-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none;cursor:pointer}.btn-small[_ngcontent-%COMP%]{margin-right:5px}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}.pc-color-picker[_ngcontent-%COMP%]{cursor:pointer}"]}),n})();function nee(n,e){if(1&n){const t=zi();We(0,"div")(1,"app-group",5),Ft("selectedElementEvent",function(r){return vt(t),Oe().setSelectedElement(r)}),Ne()()}if(2&n){const t=e.$implicit,i=Oe();at(1),nt("sceneId",i.data.sceneId)("data",t)}}let Mz=(()=>{class n{constructor(){this.elem=Wa,this.hidden=!1,this.selectedElement=[],this.data={sceneId:-1,groups:[]}}setSelectedElement(t){this.selectedElement=this.selectedElement===t?[]:t}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ao({type:n,selectors:[["app-element-tree"]],inputs:{data:"data"},decls:7,vars:3,consts:[[1,"sidebar"],[1,"title-divider",3,"click"],[3,"hidden"],[4,"ngFor","ngForOf"],[3,"data"],[3,"sceneId","data","selectedElementEvent"]],template:function(t,i){1&t&&(We(0,"div",0)(1,"div",1),Ft("click",function(){return i.hidden=!i.hidden}),We(2,"span"),B(3,"Scene Elements"),Ne()(),We(4,"div",2),xn(5,nee,2,2,"div",3),ur(6,"app-element-setting",4),Ne()()),2&t&&(at(4),nt("hidden",i.hidden),at(1),nt("ngForOf",i.data.groups),at(1),nt("data",i.selectedElement))},styles:[".element-tree-element[_ngcontent-%COMP%]{margin-bottom:5px}"]}),n})();function iee(n,e){if(1&n){const t=zi();We(0,"div",3),Ft("click",function(){vt(t);const r=Oe(2);return r.setSelectedElement(r.data.sceneElements)}),We(1,"label")(2,"input",4),Ft("ngModelChange",function(r){return vt(t),Oe(2).data.visible=r})("change",function(){vt(t);const r=Oe(2);return r.setSceneElementsVisibility(r.data.sceneElements,r.data.visible)}),Ne(),ur(3,"span"),Ne(),We(4,"span"),B(5),Ne()()}if(2&n){const t=Oe(2);at(2),nt("ngModel",t.data.visible),at(3),j(t.data.name)}}function ree(n,e){if(1&n){const t=zi();We(0,"div",7)(1,"app-group",8),Ft("selectedElementEvent",function(r){return vt(t),Oe(3).setSelectedElement(r)}),Ne()()}if(2&n){const t=e.$implicit,i=Oe(3);at(1),nt("sceneId",i.sceneId)("data",t)}}function see(n,e){if(1&n){const t=zi();We(0,"div",5)(1,"label")(2,"input",4),Ft("ngModelChange",function(r){return vt(t),Oe(2).data.visible=r})("change",function(){vt(t);const r=Oe(2);return r.setGroupVisibility([r.data],r.data.visible)}),Ne(),We(3,"span"),B(4),Ne()(),xn(5,ree,2,2,"div",6),Ne()}if(2&n){const t=Oe(2);at(2),nt("ngModel",t.data.visible),at(2),j(t.data.name),at(1),nt("ngForOf",t.data.groups)}}function oee(n,e){if(1&n&&(We(0,"div"),xn(1,iee,6,2,"div",1),xn(2,see,6,3,"div",2),Ne()),2&n){const t=Oe();at(1),nt("ngIf",t.data.ids.length>0),at(1),nt("ngIf",t.data.groups.length>0)}}let aee=(()=>{class n{constructor(t){this.sceneElementsService=t,this.selectedElementEvent=new wi,this.sceneId=-1,this._data={groupId:-1,name:"Unknown",ids:[],groups:[],visible:!1}}set data(t){this._data=t,this.loadComponents(this.data.ids)}get data(){return this._data}ngOnInit(){}setGroupVisibility(t,i){t.map(r=>{r.visible=i,r.sceneElements&&this.setSceneElementsVisibility(r.sceneElements,i),this.setGroupVisibility(r.groups,i)})}setSceneElementsVisibility(t,i){var r;null==t||t.forEach(o=>{this.setSceneElementVisibility(o,i)}),null===(r=this.viewer)||void 0===r||r.requestRender()}setSceneElementVisibility(t,i){switch(Mx.enumFromStringValue(Wa,t.sceneType)){case Wa.POTREE_POINT_CLOUD:case Wa.DEFAULT_POINT_CLOUD:case Wa.LINE_SET:case Wa.CAMERA_TRAJECTORY:t.element.setVisibility(i)}}setSelectedElement(t){t&&this.selectedElementEvent.emit(t)}loadComponents(t){this.sceneElementsService.getViewerData().subscribe(i=>{var r;this.viewer=null===(r=i.get(this.sceneId))||void 0===r?void 0:r.viewer,this.data.sceneElements=[];let o=i.get(this.sceneId);o&&o.elements.map(l=>{var c;t.includes(l.elementId)&&(null===(c=this.data.sceneElements)||void 0===c||c.push(l))})})}}return n.\u0275fac=function(t){return new(t||n)(Te(wx))},n.\u0275cmp=Ao({type:n,selectors:[["app-group"]],inputs:{sceneId:"sceneId",data:"data"},outputs:{selectedElementEvent:"selectedElementEvent"},decls:1,vars:1,consts:[[4,"ngIf"],["class","single-element",3,"click",4,"ngIf"],["style","padding-left: 6px",4,"ngIf"],[1,"single-element",3,"click"],["type","checkbox",1,"filled-in","checkbox-blue",3,"ngModel","ngModelChange","change"],[2,"padding-left","6px"],["class","element-group",4,"ngFor","ngForOf"],[1,"element-group"],[3,"sceneId","data","selectedElementEvent"]],template:function(t,i){1&t&&xn(0,oee,3,2,"div",0),2&t&&nt("ngIf",i.data)},directives:[ky,sT,lT,Sb,mx,n],styles:[".element-group[_ngcontent-%COMP%]{margin-left:30px}.element-group[_ngcontent-%COMP%] > .element-group[_ngcontent-%COMP%]{margin-left:30px}.element-list[_ngcontent-%COMP%]{margin-left:30px}.element-list[_ngcontent-%COMP%] > ul[_ngcontent-%COMP%]{margin:0}.single-element[_ngcontent-%COMP%]{padding-top:6px;padding-left:6px;display:flex;flex-direction:row;cursor:pointer}.single-element[_ngcontent-%COMP%]:hover, .highlight[_ngcontent-%COMP%]{background-color:var(--color-black)}"]}),n})();function lee(n,e){1&n&&(We(0,"div",2),ur(1,"div",3),Ne())}let cee=(()=>{class n{constructor(){this.active=!0}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ao({type:n,selectors:[["app-loading"]],inputs:{active:"active"},decls:2,vars:1,consts:[[1,"loading-wrapper"],["class","loading-ring",4,"ngIf"],[1,"loading-ring"],[1,"lds-dual-ring"]],template:function(t,i){1&t&&(We(0,"div",0),xn(1,lee,2,0,"div",1),Ne()),2&t&&(at(1),nt("ngIf",i.active))},directives:[ky],styles:['.loading-wrapper[_ngcontent-%COMP%]{width:100%}.loading-ring[_ngcontent-%COMP%]{position:relative;bottom:10%;left:90%;transform:translate(-50%,-50%);margin-top:30%}.lds-dual-ring[_ngcontent-%COMP%]{display:inline-block;width:80px;height:80px}.lds-dual-ring[_ngcontent-%COMP%]:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid var(--color-secondary-2-0);border-color:var(--color-secondary-2-1) transparent var(--color-secondary-2-1) transparent;animation:lds-dual-ring 1.2s linear infinite}@keyframes lds-dual-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']}),n})();function uee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Reset Color:"),Ne()(),We(4,"div",6)(5,"button",13),Ft("click",function(){return vt(t),Oe(2).resetColor()}),B(6,"Reset"),Ne()()()}}function hee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Point Size:"),Ne()(),We(4,"div",6)(5,"p",10)(6,"input",14),Ft("ngModelChange",function(r){return vt(t),Oe(2).settings.pointSize=r})("ngModelChange",function(){return vt(t),Oe(2).setPointSize()}),Ne()()()()}if(2&n){const t=Oe(2);at(6),$o("min",t.options.min),$o("max",t.options.max),nt("value",t.settings.pointSize)("ngModel",t.settings.pointSize)}}function dee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Frustum Size:"),Ne()(),We(4,"div",6)(5,"p",10)(6,"input",14),Ft("ngModelChange",function(r){return vt(t),Oe(2).settings.frustumSize=r})("ngModelChange",function(){return vt(t),Oe(2).setFrustumSize()}),Ne()()()()}if(2&n){const t=Oe(2);at(6),$o("min",t.options.min),$o("max",t.options.max),nt("value",t.settings.frustumSize)("ngModel",t.settings.frustumSize)}}function fee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Line Width:"),Ne()(),We(4,"div",6)(5,"p",10)(6,"input",14),Ft("ngModelChange",function(r){return vt(t),Oe(2).settings.lineWidth=r})("ngModelChange",function(){return vt(t),Oe(2).setLineWidth()}),Ne()()()()}if(2&n){const t=Oe(2);at(6),$o("min",t.options.min),$o("max",t.options.max/2),nt("value",t.settings.lineWidth)("ngModel",t.settings.lineWidth)}}function pee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Show Image:"),Ne()(),We(4,"div",6)(5,"label")(6,"input",15),Ft("change",function(){return vt(t),Oe(2).setMeshVisibility()})("ngModelChange",function(r){return vt(t),Oe(2).settings.meshVisible=r}),Ne(),We(7,"span"),B(8,"Show/Hide"),Ne()()()()}if(2&n){const t=Oe(2);at(6),nt("ngModel",t.settings.meshVisible)}}function mee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Show Bounding Box:"),Ne()(),We(4,"div",6)(5,"label")(6,"input",15),Ft("change",function(){return vt(t),Oe(2).setBoundingBox()})("ngModelChange",function(r){return vt(t),Oe(2).settings.boundingBox=r}),Ne(),We(7,"span"),B(8,"Show/Hide"),Ne()()()()}if(2&n){const t=Oe(2);at(6),nt("ngModel",t.settings.boundingBox)}}function gee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Activate Elevation:"),Ne()(),We(4,"div",6)(5,"label")(6,"input",15),Ft("change",function(){return vt(t),Oe(2).setElevationType()})("ngModelChange",function(r){return vt(t),Oe(2).settings.useElevation=r}),Ne(),We(7,"span"),B(8,"Activate"),Ne()()()()}if(2&n){const t=Oe(2);at(6),nt("ngModel",t.settings.useElevation)}}function yee(n,e){if(1&n){const t=zi();We(0,"div",4)(1,"div",5)(2,"label"),B(3,"Point Shape:"),Ne()(),We(4,"div",6)(5,"button",13),Ft("click",function(){vt(t);const r=Oe(2);return r.setPointShape(r.ps.SQUARE)}),B(6,"Square"),Ne(),We(7,"button",13),Ft("click",function(){vt(t);const r=Oe(2);return r.setPointShape(r.ps.CIRCLE)}),B(8,"Circle"),Ne()()()}}function _ee(n,e){if(1&n){const t=zi();We(0,"div")(1,"div",2),Ft("click",function(){vt(t);const r=Oe();return r.hidden=!r.hidden}),We(2,"span"),B(3,"Element Settings"),Ne()(),We(4,"div",3)(5,"div",4)(6,"div",5)(7,"label"),B(8,"Name:"),Ne()(),We(9,"div",6),B(10),Ne()(),We(11,"div",7)(12,"div",5)(13,"label",8),B(14,"Select Color:"),Ne()(),We(15,"div",6)(16,"input",9),Ft("colorPickerChange",function(r){return vt(t),Oe().settings.color=r})("colorPickerChange",function(){return vt(t),Oe().setColor()}),Ne()()(),We(17,"div",4)(18,"div",5)(19,"label"),B(20,"Opacity:"),Ne()(),We(21,"div",6)(22,"p",10)(23,"input",11),Ft("ngModelChange",function(r){return vt(t),Oe().settings.opacity=r})("ngModelChange",function(){return vt(t),Oe().setOpacity()}),Ne()()()(),xn(24,uee,7,0,"div",12),xn(25,hee,7,4,"div",12),xn(26,dee,7,4,"div",12),xn(27,fee,7,4,"div",12),xn(28,pee,9,1,"div",12),xn(29,mee,9,1,"div",12),xn(30,gee,9,1,"div",12),xn(31,yee,9,0,"div",12),Ne()()}if(2&n){const t=Oe();at(4),nt("hidden",t.hidden),at(6),G(" ",t.sceneElement[0].getName()," "),at(6),Qr("background",t.settings.color),nt("colorPicker",t.settings.color),at(7),nt("value",t.settings.opacity)("ngModel",t.settings.opacity),at(1),nt("ngIf",t.sceneElement[0].resetColor),at(1),nt("ngIf",t.sceneElement[0].setPointSize),at(1),nt("ngIf",t.sceneElement[0].setFrustumSize),at(1),nt("ngIf",t.sceneElement[0].setLineWidth),at(1),nt("ngIf",t.sceneElement[0].setMeshVisibility),at(1),nt("ngIf",t.sceneElement[0].setBoundingBox),at(1),nt("ngIf",t.sceneElement[0].setElevationType),at(1),nt("ngIf",t.sceneElement[0].setPointShape)}}let vee=(()=>{class n{constructor(t){this.sceneElementsService=t,this.options={min:1,max:20},this.hidden=!1,this.ps=qm.PointShape,this.settings={frustumSize:3,color:"#000000",meshVisible:!1,lineWidth:2,pointSize:1,opacity:1,boundingBox:!1,useElevation:!1,pointShape:qm.PointShape.SQUARE},this.type=Wa.UNKNOWN}set data(t){var i;this._data=t,this.sceneElement=[],null===(i=this._data)||void 0===i||i.forEach(r=>{var o;let l=r.element;this.type=r.sceneType,this.settings.color="#"+l.getColor().getHexString(),null===(o=this.sceneElement)||void 0===o||o.push(l)}),this.loadViewer()}get data(){return this._data?this._data:[]}ngOnInit(){}setColor(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setColor(this.settings.color)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setFrustumSize(){var t,i;let r=Mx.logRange(.1,1.5,this.options.min,this.options.max,this.settings.frustumSize);null===(t=this.sceneElement)||void 0===t||t.forEach(o=>{o.setFrustumSize&&o.setFrustumSize(r)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setMeshVisibility(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setMeshVisibility&&r.setMeshVisibility(this.settings.meshVisible)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setLineWidth(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setLineWidth&&r.setLineWidth(this.settings.lineWidth/1e3)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setOpacity(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setOpacity(this.settings.opacity)}),null===(i=this.viewer)||void 0===i||i.requestRender()}resetColor(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.resetColor&&r.resetColor()}),null===(i=this.viewer)||void 0===i||i.requestRender()}setPointSize(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setPointSize&&r.setPointSize(this.settings.pointSize)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setBoundingBox(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setBoundingBox&&r.setBoundingBox(this.settings.boundingBox)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setElevationType(){var t,i;null===(t=this.sceneElement)||void 0===t||t.forEach(r=>{r.setElevationType&&r.setElevationType(this.settings.useElevation)}),null===(i=this.viewer)||void 0===i||i.requestRender()}setPointShape(t){var i,r;this.settings.pointShape=t,null===(i=this.sceneElement)||void 0===i||i.forEach(o=>{o.setPointShape&&o.setPointShape(this.settings.pointShape)}),null===(r=this.viewer)||void 0===r||r.requestRender()}loadViewer(){this.sceneElementsService.getViewerData().subscribe(t=>{t.has(0)&&setTimeout(()=>{var i;this.viewer=null===(i=t.get(0))||void 0===i?void 0:i.viewer})})}}return n.\u0275fac=function(t){return new(t||n)(Te(wx))},n.\u0275cmp=Ao({type:n,selectors:[["app-element-setting"]],inputs:{data:"data"},decls:3,vars:2,consts:[[4,"ngIf"],[3,"active"],[1,"title-divider",3,"click"],[3,"hidden"],[1,"row"],[1,"col","s4","description"],[1,"col","s8"],[1,"row","ngx-color-picker"],["for","pc-color-picker"],["id","pc-color-picker",1,"pc-color-picker",3,"colorPicker","colorPickerChange"],[1,"range-field"],["type","range","min","0}","max","1","step","0.1",3,"value","ngModel","ngModelChange"],["class","row",4,"ngIf"],[1,"waves-effect","btn-small",3,"click"],["type","range",3,"min","max","value","ngModel","ngModelChange"],["type","checkbox",1,"checkbox-blue","filled-in",3,"ngModel","change","ngModelChange"]],template:function(t,i){1&t&&(xn(0,_ee,32,15,"div",0),We(1,"div"),ur(2,"app-loading",1),Ne()),2&t&&(nt("ngIf",i.sceneElement&&i.sceneElement.length>0),at(2),nt("active",!i.sceneElement))},directives:[ky,yV,gT,vb,lT,Sb,sT,cee],styles:[".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.ngx-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none;cursor:pointer}.btn-small[_ngcontent-%COMP%]{margin-right:5px}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}.pc-color-picker[_ngcontent-%COMP%]{cursor:pointer}"]}),n})();class Sz{}const ed="*";function Ez(n,e=null){return{type:2,steps:n,options:e}}function Cz(n){return{type:6,styles:n,offset:null}}function Tz(n){Promise.resolve(null).then(n)}class Eb{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Tz(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class Az{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0;const o=this.players.length;0==o?Tz(()=>this._onFinish()):this.players.forEach(l=>{l.onDone(()=>{++t==o&&this._onFinish()}),l.onDestroy(()=>{++i==o&&this._onDestroy()}),l.onStart(()=>{++r==o&&this._onStart()})}),this.totalTime=this.players.reduce((l,c)=>Math.max(l,c.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}const ki=!1;function Dz(n){return new Yt(3e3,ki)}function ete(){return"undefined"!=typeof window&&void 0!==window.document}function fL(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Hf(n){switch(n.length){case 0:return new Eb;case 1:return n[0];default:return new Az(n)}}function Rz(n,e,t,i,r={},o={}){const l=[],c=[];let d=-1,p=null;if(i.forEach(y=>{const v=y.offset,x=v==d,b=x&&p||{};Object.keys(y).forEach(S=>{let E=S,T=y[S];if("offset"!==S)switch(E=e.normalizePropertyName(E,l),T){case"!":T=r[S];break;case ed:T=o[S];break;default:T=e.normalizeStyleValue(S,E,T,l)}b[E]=T}),x||c.push(b),p=b,d=v}),l.length)throw function Gee(n){return new Yt(3502,ki)}();return c}function pL(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&mL(t,"start",n)));break;case"done":n.onDone(()=>i(t&&mL(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&mL(t,"destroy",n)))}}function mL(n,e,t){const i=t.totalTime,o=gL(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,null==i?n.totalTime:i,!!t.disabled),l=n._data;return null!=l&&(o._data=l),o}function gL(n,e,t,i,r="",o=0,l){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:o,disabled:!!l}}function fl(n,e,t){let i;return n instanceof Map?(i=n.get(e),i||n.set(e,i=t)):(i=n[e],i||(i=n[e]=t)),i}function Pz(n){const e=n.indexOf(":");return[n.substring(1,e),n.substr(e+1)]}let yL=(n,e)=>!1,Iz=(n,e,t)=>[],Lz=null;function _L(n){const e=n.parentNode||n.host;return e===Lz?null:e}(fL()||"undefined"!=typeof Element)&&(ete()?(Lz=(()=>document.documentElement)(),yL=(n,e)=>{for(;e;){if(e===n)return!0;e=_L(e)}return!1}):yL=(n,e)=>n.contains(e),Iz=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]});let ig=null,Fz=!1;function Nz(n){ig||(ig=function nte(){return"undefined"!=typeof document?document.body:null}()||{},Fz=!!ig.style&&"WebkitAppearance"in ig.style);let e=!0;return ig.style&&!function tte(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in ig.style,!e&&Fz&&(e="Webkit"+n.charAt(0).toUpperCase()+n.substr(1)in ig.style)),e}const Oz=yL,kz=Iz;let Bz=(()=>{class n{validateStyleProperty(t){return Nz(t)}matchesElement(t,i){return!1}containsElement(t,i){return Oz(t,i)}getParentElement(t){return _L(t)}query(t,i,r){return kz(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,o,l,c=[],d){return new Eb(r,o)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})(),vL=(()=>{class n{}return n.NOOP=new Bz,n})();const xL="ng-enter",_T="ng-leave",vT="ng-trigger",xT=".ng-trigger",Vz="ng-animating",bL=".ng-animating";function rg(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:wL(parseFloat(e[1]),e[2])}function wL(n,e){return"s"===e?1e3*n:n}function bT(n,e,t){return n.hasOwnProperty("duration")?n:function ste(n,e,t){let r,o=0,l="";if("string"==typeof n){const c=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===c)return e.push(Dz()),{duration:0,delay:0,easing:""};r=wL(parseFloat(c[1]),c[2]);const d=c[3];null!=d&&(o=wL(parseFloat(d),c[4]));const p=c[5];p&&(l=p)}else r=n;if(!t){let c=!1,d=e.length;r<0&&(e.push(function bee(){return new Yt(3100,ki)}()),c=!0),o<0&&(e.push(function wee(){return new Yt(3101,ki)}()),c=!0),c&&e.splice(d,0,Dz())}return{duration:r,delay:o,easing:l}}(n,e,t)}function V_(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function Gf(n,e,t={}){if(e)for(let i in n)t[i]=n[i];else V_(n,t);return t}function Hz(n,e,t){return t?e+":"+t+";":""}function Gz(n){let e="";for(let t=0;t<n.style.length;t++){const i=n.style.item(t);e+=Hz(0,i,n.style.getPropertyValue(i))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=Hz(0,lte(t),n.style[t]));n.setAttribute("style",e)}function Su(n,e,t){n.style&&(Object.keys(e).forEach(i=>{const r=SL(i);t&&!t.hasOwnProperty(i)&&(t[i]=n.style[r]),n.style[r]=e[i]}),fL()&&Gz(n))}function sg(n,e){n.style&&(Object.keys(e).forEach(t=>{const i=SL(t);n.style[i]=""}),fL()&&Gz(n))}function Cb(n){return Array.isArray(n)?1==n.length?n[0]:Ez(n):n}const ML=new RegExp("{{\\s*(.+?)\\s*}}","g");function Wz(n){let e=[];if("string"==typeof n){let t;for(;t=ML.exec(n);)e.push(t[1]);ML.lastIndex=0}return e}function wT(n,e,t){const i=n.toString(),r=i.replace(ML,(o,l)=>{let c=e[l];return e.hasOwnProperty(l)||(t.push(function See(n){return new Yt(3003,ki)}()),c=""),c.toString()});return r==i?n:r}function MT(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const ate=/-+([a-z0-9])/g;function SL(n){return n.replace(ate,(...e)=>e[1].toUpperCase())}function lte(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function pl(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function Eee(n){return new Yt(3004,ki)}()}}function qz(n,e){return window.getComputedStyle(n)[e]}function pte(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function mte(n,e,t){if(":"==n[0]){const d=function gte(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function Uee(n){return new Yt(3016,ki)}()),"* => *"}}(n,t);if("function"==typeof d)return void e.push(d);n=d}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function Bee(n){return new Yt(3015,ki)}()),e;const r=i[1],o=i[2],l=i[3];e.push(jz(r,l));"<"==o[0]&&!("*"==r&&"*"==l)&&e.push(jz(l,r))}(i,t,e)):t.push(n),t}const TT=new Set(["true","1"]),AT=new Set(["false","0"]);function jz(n,e){const t=TT.has(n)||AT.has(n),i=TT.has(e)||AT.has(e);return(r,o)=>{let l="*"==n||n==r,c="*"==e||e==o;return!l&&t&&"boolean"==typeof r&&(l=r?TT.has(n):AT.has(n)),!c&&i&&"boolean"==typeof o&&(c=o?TT.has(e):AT.has(e)),l&&c}}const yte=new RegExp("s*:selfs*,?","g");function EL(n,e,t,i){return new _te(n).build(e,t,i)}class _te{constructor(e){this._driver=e}build(e,t,i){const r=new bte(t);this._resetContextStyleTimingState(r);const o=pl(this,Cb(e),r);return r.unsupportedCSSPropertiesFound.size&&r.unsupportedCSSPropertiesFound.keys(),o}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const o=[],l=[];return"@"==e.name.charAt(0)&&t.errors.push(function Tee(){return new Yt(3006,ki)}()),e.definitions.forEach(c=>{if(this._resetContextStyleTimingState(t),0==c.type){const d=c,p=d.name;p.toString().split(/\s*,\s*/).forEach(y=>{d.name=y,o.push(this.visitState(d,t))}),d.name=p}else if(1==c.type){const d=this.visitTransition(c,t);i+=d.queryCount,r+=d.depCount,l.push(d)}else t.errors.push(function Aee(){return new Yt(3007,ki)}())}),{type:7,name:e.name,states:o,transitions:l,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const o=new Set,l=r||{};i.styles.forEach(c=>{if(DT(c)){const d=c;Object.keys(d).forEach(p=>{Wz(d[p]).forEach(y=>{l.hasOwnProperty(y)||o.add(y)})})}}),o.size&&(MT(o.values()),t.errors.push(function Dee(n,e){return new Yt(3008,ki)}()))}return{type:0,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=pl(this,Cb(e.animation),t);return{type:1,matchers:pte(e.expr,t.errors),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:og(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(i=>pl(this,i,t)),options:og(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const o=e.steps.map(l=>{t.currentTime=i;const c=pl(this,l,t);return r=Math.max(r,t.currentTime),c});return t.currentTime=r,{type:3,steps:o,options:og(e.options)}}visitAnimate(e,t){const i=function Mte(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return CL(bT(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(o=>"{"==o.charAt(0)&&"{"==o.charAt(1))){const o=CL(0,0,"");return o.dynamic=!0,o.strValue=t,o}const r=bT(t,e);return CL(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,o=e.styles?e.styles:Cz({});if(5==o.type)r=this.visitKeyframes(o,t);else{let l=e.styles,c=!1;if(!l){c=!0;const p={};i.easing&&(p.easing=i.easing),l=Cz(p)}t.currentTime+=i.duration+i.delay;const d=this.visitStyle(l,t);d.isEmptyStep=c,r=d}return t.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[];Array.isArray(e.styles)?e.styles.forEach(l=>{"string"==typeof l?l==ed?i.push(l):t.errors.push(function Ree(n){return new Yt(3002,ki)}()):i.push(l)}):i.push(e.styles);let r=!1,o=null;return i.forEach(l=>{if(DT(l)){const c=l,d=c.easing;if(d&&(o=d,delete c.easing),!r)for(let p in c)if(c[p].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:i,easing:o,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,o=t.currentTime;i&&o>0&&(o-=i.duration+i.delay),e.styles.forEach(l=>{"string"!=typeof l&&Object.keys(l).forEach(c=>{if(!this._driver.validateStyleProperty(c))return delete l[c],void t.unsupportedCSSPropertiesFound.add(c);const d=t.collectedStyles[t.currentQuerySelector],p=d[c];let y=!0;p&&(o!=r&&o>=p.startTime&&r<=p.endTime&&(t.errors.push(function Pee(n,e,t,i,r){return new Yt(3010,ki)}()),y=!1),o=p.startTime),y&&(d[c]={startTime:o,endTime:r}),t.options&&function ote(n,e,t){const i=e.params||{},r=Wz(n);r.length&&r.forEach(o=>{i.hasOwnProperty(o)||t.push(function Mee(n){return new Yt(3001,ki)}())})}(l[c],t.options,t.errors)})})}visitKeyframes(e,t){const i={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function Iee(){return new Yt(3011,ki)}()),i;let o=0;const l=[];let c=!1,d=!1,p=0;const y=e.steps.map(N=>{const F=this._makeStyleAst(N,t);let U=null!=F.offset?F.offset:function wte(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(DT(t)&&t.hasOwnProperty("offset")){const i=t;e=parseFloat(i.offset),delete i.offset}});else if(DT(n)&&n.hasOwnProperty("offset")){const t=n;e=parseFloat(t.offset),delete t.offset}return e}(F.styles),k=0;return null!=U&&(o++,k=F.offset=U),d=d||k<0||k>1,c=c||k<p,p=k,l.push(k),F});d&&t.errors.push(function Lee(){return new Yt(3012,ki)}()),c&&t.errors.push(function Fee(){return new Yt(3200,ki)}());const v=e.steps.length;let x=0;o>0&&o<v?t.errors.push(function Nee(){return new Yt(3202,ki)}()):0==o&&(x=1/(v-1));const b=v-1,S=t.currentTime,E=t.currentAnimateTimings,T=E.duration;return y.forEach((N,F)=>{const U=x>0?F==b?1:x*F:l[F],k=U*T;t.currentTime=S+E.delay+k,E.duration=k,this._validateStyleAst(N,t),N.offset=U,i.styles.push(N)}),i}visitReference(e,t){return{type:8,animation:pl(this,Cb(e.animation),t),options:og(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:og(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:og(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[o,l]=function vte(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(yte,"")),n=n.replace(/@\*/g,xT).replace(/@\w+/g,t=>xT+"-"+t.substr(1)).replace(/:animating/g,bL),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+o:o,fl(t.collectedStyles,t.currentQuerySelector,{});const c=pl(this,Cb(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:11,selector:o,limit:r.limit||0,optional:!!r.optional,includeSelf:l,animation:c,originalSelector:e.selector,options:og(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function Oee(){return new Yt(3013,ki)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:bT(e.timings,t.errors,!0);return{type:12,animation:pl(this,Cb(e.animation),t),timings:i,options:null}}}class bte{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function DT(n){return!Array.isArray(n)&&"object"==typeof n}function og(n){return n?(n=V_(n)).params&&(n.params=function xte(n){return n?V_(n):null}(n.params)):n={},n}function CL(n,e,t){return{duration:n,delay:e,easing:t}}function TL(n,e,t,i,r,o,l=null,c=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:o,totalTime:r+o,easing:l,subTimeline:c}}class RT{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const Cte=new RegExp(":enter","g"),Ate=new RegExp(":leave","g");function AL(n,e,t,i,r,o={},l={},c,d,p=[]){return(new Dte).buildKeyframes(n,e,t,i,r,o,l,c,d,p)}class Dte{buildKeyframes(e,t,i,r,o,l,c,d,p,y=[]){p=p||new RT;const v=new DL(e,t,p,r,o,y,[]);v.options=d,v.currentTimeline.setStyles([l],null,v.errors,d),pl(this,i,v);const x=v.timelines.filter(b=>b.containsAnimation());if(Object.keys(c).length){let b;for(let S=x.length-1;S>=0;S--){const E=x[S];if(E.element===t){b=E;break}}b&&!b.allowOnlyTimelineStyles()&&b.setStyles([c],null,v.errors,d)}return x.length?x.map(b=>b.buildKeyframes()):[TL(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),o=t.currentTimeline.currentTime,l=this._visitSubInstructions(i,r,r.options);o!=l&&t.transformIntoNewTimeline(l)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,i){let o=t.currentTimeline.currentTime;const l=null!=i.duration?rg(i.duration):null,c=null!=i.delay?rg(i.delay):null;return 0!==l&&e.forEach(d=>{const p=t.appendInstructionToTimeline(d,l,c);o=Math.max(o,p.duration+p.delay)}),o}visitReference(e,t){t.updateOptions(e.options,!0),pl(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const o=e.options;if(o&&(o.params||o.delay)&&(r=t.createSubContext(o),r.transformIntoNewTimeline(),null!=o.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=PT);const l=rg(o.delay);r.delayNextStep(l)}e.steps.length&&(e.steps.forEach(l=>pl(this,l,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const o=e.options&&e.options.delay?rg(e.options.delay):0;e.steps.forEach(l=>{const c=t.createSubContext(e.options);o&&c.delayNextStep(o),pl(this,l,c),r=Math.max(r,c.currentTimeline.currentTime),i.push(c.currentTimeline)}),i.forEach(l=>t.currentTimeline.mergeTimelineCollectedStyles(l)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return bT(t.params?wT(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const o=e.style;5==o.type?this.visitKeyframes(o,t):(t.incrementTime(i.duration),this.visitStyle(o,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.getCurrentStyleProperties().length&&i.forwardFrame();const o=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(o):i.setStyles(e.styles,o,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,o=i.duration,c=t.createSubContext().currentTimeline;c.easing=i.easing,e.styles.forEach(d=>{c.forwardTime((d.offset||0)*o),c.setStyles(d.styles,d.easing,t.errors,t.options),c.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(c),t.transformIntoNewTimeline(r+o),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},o=r.delay?rg(r.delay):0;o&&(6===t.previousNode.type||0==i&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=PT);let l=i;const c=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=c.length;let d=null;c.forEach((p,y)=>{t.currentQueryIndex=y;const v=t.createSubContext(e.options,p);o&&v.delayNextStep(o),p===t.element&&(d=v.currentTimeline),pl(this,e.animation,v),v.currentTimeline.applyStylesToKeyframe(),l=Math.max(l,v.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(l),d&&(t.currentTimeline.mergeTimelineCollectedStyles(d),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,o=e.timings,l=Math.abs(o.duration),c=l*(t.currentQueryTotal-1);let d=l*t.currentQueryIndex;switch(o.duration<0?"reverse":o.easing){case"reverse":d=c-d;break;case"full":d=i.currentStaggerTime}const y=t.currentTimeline;d&&y.delayNextStep(d);const v=y.currentTime;pl(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-v+(r.startTime-i.currentTimeline.startTime)}}const PT={};class DL{constructor(e,t,i,r,o,l,c,d){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=o,this.errors=l,this.timelines=c,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=PT,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=d||new IT(this._driver,t,0),c.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=rg(i.duration)),null!=i.delay&&(r.delay=rg(i.delay));const o=i.params;if(o){let l=r.params;l||(l=this.options.params={}),Object.keys(o).forEach(c=>{(!t||!l.hasOwnProperty(c))&&(l[c]=wT(o[c],l,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,o=new DL(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(e),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}transformIntoNewTimeline(e){return this.previousNode=PT,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=i?i:0)+e.delay,easing:""},o=new Rte(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(o),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,o,l){let c=[];if(r&&c.push(this.element),e.length>0){e=(e=e.replace(Cte,"."+this._enterClassName)).replace(Ate,"."+this._leaveClassName);let p=this._driver.query(this.element,e,1!=i);0!==i&&(p=i<0?p.slice(p.length+i,p.length):p.slice(0,i)),c.push(...p)}return!o&&0==c.length&&l.push(function kee(n){return new Yt(3014,ki)}()),c}}class IT{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new IT(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(t=>{this._backFill[t]=this._globalTimelineStyles[t]||ed,this._currentKeyframe[t]=ed}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&(this._previousKeyframe.easing=t);const o=r&&r.params||{},l=function Pte(n,e){const t={};let i;return n.forEach(r=>{"*"===r?(i=i||Object.keys(e),i.forEach(o=>{t[o]=ed})):Gf(r,!1,t)}),t}(e,this._globalTimelineStyles);Object.keys(l).forEach(c=>{const d=wT(l[c],o,i);this._pendingStyles[c]=d,this._localTimelineStyles.hasOwnProperty(c)||(this._backFill[c]=this._globalTimelineStyles.hasOwnProperty(c)?this._globalTimelineStyles[c]:ed),this._updateStyle(c,d)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(i=>{this._currentKeyframe[i]=e[i]}),Object.keys(this._localTimelineStyles).forEach(i=>{this._currentKeyframe.hasOwnProperty(i)||(this._currentKeyframe[i]=this._localTimelineStyles[i])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const i=this._styleSummary[t],r=e._styleSummary[t];(!i||r.time>i.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((c,d)=>{const p=Gf(c,!0);Object.keys(p).forEach(y=>{const v=p[y];"!"==v?e.add(y):v==ed&&t.add(y)}),i||(p.offset=d/this.duration),r.push(p)});const o=e.size?MT(e.values()):[],l=t.size?MT(t.values()):[];if(i){const c=r[0],d=V_(c);c.offset=0,d.offset=1,r=[c,d]}return TL(this.element,r,o,l,this.duration,this.startTime,this.easing,!1)}}class Rte extends IT{constructor(e,t,i,r,o,l,c=!1){super(e,t,l.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=o,this._stretchStartingKeyframe=c,this.timings={duration:l.duration,delay:l.delay,easing:l.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const o=[],l=i+t,c=t/l,d=Gf(e[0],!1);d.offset=0,o.push(d);const p=Gf(e[0],!1);p.offset=Yz(c),o.push(p);const y=e.length-1;for(let v=1;v<=y;v++){let x=Gf(e[v],!1);x.offset=Yz((t+x.offset*i)/l),o.push(x)}i=l,t=0,r="",e=o}return TL(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function Yz(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class RL{}class Ite extends RL{normalizePropertyName(e,t){return SL(e)}normalizeStyleValue(e,t,i,r){let o="";const l=i.toString().trim();if(Lte[t]&&0!==i&&"0"!==i)if("number"==typeof i)o="px";else{const c=i.match(/^[+-]?[\d\.]+([a-z]*)$/);c&&0==c[1].length&&r.push(function Cee(n,e){return new Yt(3005,ki)}())}return l+o}}const Lte=(()=>function Fte(n){const e={};return n.forEach(t=>e[t]=!0),e}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function Kz(n,e,t,i,r,o,l,c,d,p,y,v,x){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:o,toState:i,toStyles:l,timelines:c,queriedElements:d,preStyleProps:p,postStyleProps:y,totalTime:v,errors:x}}const PL={};class Zz{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function Nte(n,e,t,i,r){return n.some(o=>o(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){const r=this._stateStyles["*"],o=this._stateStyles[e],l=r?r.buildStyles(t,i):{};return o?o.buildStyles(t,i):l}build(e,t,i,r,o,l,c,d,p,y){const v=[],x=this.ast.options&&this.ast.options.params||PL,S=this.buildStyles(i,c&&c.params||PL,v),E=d&&d.params||PL,T=this.buildStyles(r,E,v),N=new Set,F=new Map,U=new Map,k="void"===r,H={params:Object.assign(Object.assign({},x),E)},Q=y?[]:AL(e,t,this.ast.animation,o,l,S,T,H,p,v);let ie=0;if(Q.forEach(De=>{ie=Math.max(De.duration+De.delay,ie)}),v.length)return Kz(t,this._triggerName,i,r,k,S,T,[],[],F,U,ie,v);Q.forEach(De=>{const ve=De.element,q=fl(F,ve,{});De.preStyleProps.forEach(qe=>q[qe]=!0);const oe=fl(U,ve,{});De.postStyleProps.forEach(qe=>oe[qe]=!0),ve!==t&&N.add(ve)});const ce=MT(N.values());return Kz(t,this._triggerName,i,r,k,S,T,Q,ce,F,U,ie)}}class Ote{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i={},r=V_(this.defaultParams);return Object.keys(e).forEach(o=>{const l=e[o];null!=l&&(r[o]=l)}),this.styles.styles.forEach(o=>{if("string"!=typeof o){const l=o;Object.keys(l).forEach(c=>{let d=l[c];d.length>1&&(d=wT(d,r,t));const p=this.normalizer.normalizePropertyName(c,t);d=this.normalizer.normalizeStyleValue(c,p,d,t),i[p]=d})}}),i}}class Bte{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states={},t.states.forEach(r=>{this.states[r.name]=new Ote(r.style,r.options&&r.options.params||{},i)}),Jz(this.states,"true","1"),Jz(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new Zz(e,r,this.states))}),this.fallbackTransition=function Ute(n,e,t){return new Zz(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(l,c)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(l=>l.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function Jz(n,e,t){n.hasOwnProperty(e)?n.hasOwnProperty(t)||(n[t]=n[e]):n.hasOwnProperty(t)&&(n[e]=n[t])}const Vte=new RT;class zte{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations={},this._playersById={},this.players=[]}register(e,t){const i=[],o=EL(this._driver,t,i,[]);if(i.length)throw function Wee(n){return new Yt(3503,ki)}();this._animations[e]=o}_buildPlayer(e,t,i){const r=e.element,o=Rz(0,this._normalizer,0,e.keyframes,t,i);return this._driver.animate(r,o,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],o=this._animations[e];let l;const c=new Map;if(o?(l=AL(this._driver,t,o,xL,_T,{},{},i,Vte,r),l.forEach(y=>{const v=fl(c,y.element,{});y.postStyleProps.forEach(x=>v[x]=null)})):(r.push(function qee(){return new Yt(3300,ki)}()),l=[]),r.length)throw function jee(n){return new Yt(3504,ki)}();c.forEach((y,v)=>{Object.keys(y).forEach(x=>{y[x]=this._driver.computeStyle(v,x,ed)})});const p=Hf(l.map(y=>{const v=c.get(y.element);return this._buildPlayer(y,{},v)}));return this._playersById[e]=p,p.onDestroy(()=>this.destroy(e)),this.players.push(p),p}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw function Xee(n){return new Yt(3301,ki)}();return t}listen(e,t,i,r){const o=gL(t,"","","");return pL(this._getPlayer(e),i,o,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const o=this._getPlayer(e);switch(i){case"play":o.play();break;case"pause":o.pause();break;case"reset":o.reset();break;case"restart":o.restart();break;case"finish":o.finish();break;case"init":o.init();break;case"setPosition":o.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const Qz="ng-animate-queued",IL="ng-animate-disabled",jte=[],eH={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Xte={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Kl="__ng_removed";class LL{constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function Zte(n){return null!=n?n:null}(i?e.value:e),i){const o=V_(e);delete o.value,this.options=o}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const Tb="void",FL=new LL(Tb);class $te{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Zl(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.hasOwnProperty(t))throw function $ee(n,e){return new Yt(3302,ki)}();if(null==i||0==i.length)throw function Yee(n){return new Yt(3303,ki)}();if(!function Jte(n){return"start"==n||"done"==n}(i))throw function Kee(n,e){return new Yt(3400,ki)}();const o=fl(this._elementListeners,e,[]),l={name:t,phase:i,callback:r};o.push(l);const c=fl(this._engine.statesByElement,e,{});return c.hasOwnProperty(t)||(Zl(e,vT),Zl(e,vT+"-"+t),c[t]=FL),()=>{this._engine.afterFlush(()=>{const d=o.indexOf(l);d>=0&&o.splice(d,1),this._triggers[t]||delete c[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw function Zee(n){return new Yt(3401,ki)}();return t}trigger(e,t,i,r=!0){const o=this._getTrigger(t),l=new NL(this.id,t,e);let c=this._engine.statesByElement.get(e);c||(Zl(e,vT),Zl(e,vT+"-"+t),this._engine.statesByElement.set(e,c={}));let d=c[t];const p=new LL(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&d&&p.absorbOptions(d.options),c[t]=p,d||(d=FL),p.value!==Tb&&d.value===p.value){if(!function tne(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const o=t[r];if(!e.hasOwnProperty(o)||n[o]!==e[o])return!1}return!0}(d.params,p.params)){const E=[],T=o.matchStyles(d.value,d.params,E),N=o.matchStyles(p.value,p.params,E);E.length?this._engine.reportError(E):this._engine.afterFlush(()=>{sg(e,T),Su(e,N)})}return}const x=fl(this._engine.playersByElement,e,[]);x.forEach(E=>{E.namespaceId==this.id&&E.triggerName==t&&E.queued&&E.destroy()});let b=o.matchTransition(d.value,p.value,e,p.params),S=!1;if(!b){if(!r)return;b=o.fallbackTransition,S=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:b,fromState:d,toState:p,player:l,isFallbackTransition:S}),S||(Zl(e,Qz),l.onStart(()=>{z_(e,Qz)})),l.onDone(()=>{let E=this.players.indexOf(l);E>=0&&this.players.splice(E,1);const T=this._engine.playersByElement.get(e);if(T){let N=T.indexOf(l);N>=0&&T.splice(N,1)}}),this.players.push(l),x.push(l),l}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,i)=>{delete t[e]}),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,xT,!0);i.forEach(r=>{if(r[Kl])return;const o=this._engine.fetchNamespacesByElement(r);o.size?o.forEach(l=>l.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const o=this._engine.statesByElement.get(e),l=new Map;if(o){const c=[];if(Object.keys(o).forEach(d=>{if(l.set(d,o[d].value),this._triggers[d]){const p=this.trigger(e,d,Tb,r);p&&c.push(p)}}),c.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,l),i&&Hf(c).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(o=>{const l=o.name;if(r.has(l))return;r.add(l);const d=this._triggers[l].fallbackTransition,p=i[l]||FL,y=new LL(Tb),v=new NL(this.id,l,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:l,transition:d,fromState:p,toState:y,player:v,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const o=i.players.length?i.playersByQueriedElement.get(e):[];if(o&&o.length)r=!0;else{let l=e;for(;l=l.parentNode;)if(i.statesByElement.get(l)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const o=e[Kl];(!o||o===eH)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){Zl(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const o=i.element,l=this._elementListeners.get(o);l&&l.forEach(c=>{if(c.name==i.triggerName){const d=gL(o,i.triggerName,i.fromState.value,i.toState.value);d._data=e,pL(i.player,c.phase,d,c.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const o=i.transition.ast.depCount,l=r.transition.ast.depCount;return 0==o||0==l?o-l:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(i=>i.element===e)||t,t}}class Yte{constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,o)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new $te(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement,o=i.length-1;if(o>=0){let l=!1;if(void 0!==this.driver.getParentElement){let c=this.driver.getParentElement(t);for(;c;){const d=r.get(c);if(d){const p=i.indexOf(d);i.splice(p+1,0,e),l=!0;break}c=this.driver.getParentElement(c)}}else for(let c=o;c>=0;c--)if(this.driver.containsElement(i[c].hostElement,t)){i.splice(c+1,0,e),l=!0;break}l||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){if(!e)return;const i=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[e];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i){const r=Object.keys(i);for(let o=0;o<r.length;o++){const l=i[r[o]].namespaceId;if(l){const c=this._fetchNamespace(l);c&&t.add(c)}}}return t}trigger(e,t,i,r){if(LT(t)){const o=this._fetchNamespace(e);if(o)return o.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!LT(t))return;const o=t[Kl];if(o&&o.setForRemoval){o.setForRemoval=!1,o.setForMove=!0;const l=this.collectedLeaveElements.indexOf(t);l>=0&&this.collectedLeaveElements.splice(l,1)}if(e){const l=this._fetchNamespace(e);l&&l.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Zl(e,IL)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),z_(e,IL))}removeNode(e,t,i,r){if(LT(t)){const o=e?this._fetchNamespace(e):null;if(o?o.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),i){const l=this.namespacesByHostElement.get(t);l&&l.id!==e&&l.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,i,r,o){this.collectedLeaveElements.push(t),t[Kl]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:o}}listen(e,t,i,r,o){return LT(t)?this._fetchNamespace(e).listen(t,i,r,o):()=>{}}_buildInstruction(e,t,i,r,o){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,o)}destroyInnerAnimations(e){let t=this.driver.query(e,xT,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,bL,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Hf(this.players).onDone(()=>e());e()})}processLeaveNode(e){var t;const i=e[Kl];if(i&&i.setForRemoval){if(e[Kl]=eH,i.namespaceId){this.destroyInnerAnimations(e);const r=this._fetchNamespace(i.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,i.setForRemoval)}(null===(t=e.classList)||void 0===t?void 0:t.contains(IL))&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Zl(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?Hf(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function Jee(n){return new Yt(3402,ki)}()}_flushAnimations(e,t){const i=new RT,r=[],o=new Map,l=[],c=new Map,d=new Map,p=new Map,y=new Set;this.disabledNodes.forEach(de=>{y.add(de);const xe=this.driver.query(de,".ng-animate-queued",!0);for(let ue=0;ue<xe.length;ue++)y.add(xe[ue])});const v=this.bodyNode,x=Array.from(this.statesByElement.keys()),b=iH(x,this.collectedEnterElements),S=new Map;let E=0;b.forEach((de,xe)=>{const ue=xL+E++;S.set(xe,ue),de.forEach(Re=>Zl(Re,ue))});const T=[],N=new Set,F=new Set;for(let de=0;de<this.collectedLeaveElements.length;de++){const xe=this.collectedLeaveElements[de],ue=xe[Kl];ue&&ue.setForRemoval&&(T.push(xe),N.add(xe),ue.hasAnimation?this.driver.query(xe,".ng-star-inserted",!0).forEach(Re=>N.add(Re)):F.add(xe))}const U=new Map,k=iH(x,Array.from(N));k.forEach((de,xe)=>{const ue=_T+E++;U.set(xe,ue),de.forEach(Re=>Zl(Re,ue))}),e.push(()=>{b.forEach((de,xe)=>{const ue=S.get(xe);de.forEach(Re=>z_(Re,ue))}),k.forEach((de,xe)=>{const ue=U.get(xe);de.forEach(Re=>z_(Re,ue))}),T.forEach(de=>{this.processLeaveNode(de)})});const H=[],Q=[];for(let de=this._namespaceList.length-1;de>=0;de--)this._namespaceList[de].drainQueuedTransitions(t).forEach(ue=>{const Re=ue.player,Ye=ue.element;if(H.push(Re),this.collectedEnterElements.length){const Yn=Ye[Kl];if(Yn&&Yn.setForMove){if(Yn.previousTriggersValues&&Yn.previousTriggersValues.has(ue.triggerName)){const Gn=Yn.previousTriggersValues.get(ue.triggerName),Vn=this.statesByElement.get(ue.element);Vn&&Vn[ue.triggerName]&&(Vn[ue.triggerName].value=Gn)}return void Re.destroy()}}const gt=!v||!this.driver.containsElement(v,Ye),st=U.get(Ye),ln=S.get(Ye),hn=this._buildInstruction(ue,i,ln,st,gt);if(hn.errors&&hn.errors.length)return void Q.push(hn);if(gt)return Re.onStart(()=>sg(Ye,hn.fromStyles)),Re.onDestroy(()=>Su(Ye,hn.toStyles)),void r.push(Re);if(ue.isFallbackTransition)return Re.onStart(()=>sg(Ye,hn.fromStyles)),Re.onDestroy(()=>Su(Ye,hn.toStyles)),void r.push(Re);const qn=[];hn.timelines.forEach(Yn=>{Yn.stretchStartingKeyframe=!0,this.disabledNodes.has(Yn.element)||qn.push(Yn)}),hn.timelines=qn,i.append(Ye,hn.timelines),l.push({instruction:hn,player:Re,element:Ye}),hn.queriedElements.forEach(Yn=>fl(c,Yn,[]).push(Re)),hn.preStyleProps.forEach((Yn,Gn)=>{const Vn=Object.keys(Yn);if(Vn.length){let bt=d.get(Gn);bt||d.set(Gn,bt=new Set),Vn.forEach(di=>bt.add(di))}}),hn.postStyleProps.forEach((Yn,Gn)=>{const Vn=Object.keys(Yn);let bt=p.get(Gn);bt||p.set(Gn,bt=new Set),Vn.forEach(di=>bt.add(di))})});if(Q.length){const de=[];Q.forEach(xe=>{de.push(function Qee(n,e){return new Yt(3505,ki)}())}),H.forEach(xe=>xe.destroy()),this.reportError(de)}const ie=new Map,ce=new Map;l.forEach(de=>{const xe=de.element;i.has(xe)&&(ce.set(xe,xe),this._beforeAnimationBuild(de.player.namespaceId,de.instruction,ie))}),r.forEach(de=>{const xe=de.element;this._getPreviousPlayers(xe,!1,de.namespaceId,de.triggerName,null).forEach(Re=>{fl(ie,xe,[]).push(Re),Re.destroy()})});const De=T.filter(de=>sH(de,d,p)),ve=new Map;nH(ve,this.driver,F,p,ed).forEach(de=>{sH(de,d,p)&&De.push(de)});const oe=new Map;b.forEach((de,xe)=>{nH(oe,this.driver,new Set(de),d,"!")}),De.forEach(de=>{const xe=ve.get(de),ue=oe.get(de);ve.set(de,Object.assign(Object.assign({},xe),ue))});const qe=[],be=[],Le={};l.forEach(de=>{const{element:xe,player:ue,instruction:Re}=de;if(i.has(xe)){if(y.has(xe))return ue.onDestroy(()=>Su(xe,Re.toStyles)),ue.disabled=!0,ue.overrideTotalTime(Re.totalTime),void r.push(ue);let Ye=Le;if(ce.size>1){let st=xe;const ln=[];for(;st=st.parentNode;){const hn=ce.get(st);if(hn){Ye=hn;break}ln.push(st)}ln.forEach(hn=>ce.set(hn,Ye))}const gt=this._buildAnimation(ue.namespaceId,Re,ie,o,oe,ve);if(ue.setRealPlayer(gt),Ye===Le)qe.push(ue);else{const st=this.playersByElement.get(Ye);st&&st.length&&(ue.parentPlayer=Hf(st)),r.push(ue)}}else sg(xe,Re.fromStyles),ue.onDestroy(()=>Su(xe,Re.toStyles)),be.push(ue),y.has(xe)&&r.push(ue)}),be.forEach(de=>{const xe=o.get(de.element);if(xe&&xe.length){const ue=Hf(xe);de.setRealPlayer(ue)}}),r.forEach(de=>{de.parentPlayer?de.syncPlayerEvents(de.parentPlayer):de.destroy()});for(let de=0;de<T.length;de++){const xe=T[de],ue=xe[Kl];if(z_(xe,_T),ue&&ue.hasAnimation)continue;let Re=[];if(c.size){let gt=c.get(xe);gt&&gt.length&&Re.push(...gt);let st=this.driver.query(xe,bL,!0);for(let ln=0;ln<st.length;ln++){let hn=c.get(st[ln]);hn&&hn.length&&Re.push(...hn)}}const Ye=Re.filter(gt=>!gt.destroyed);Ye.length?Qte(this,xe,Ye):this.processLeaveNode(xe)}return T.length=0,qe.forEach(de=>{this.players.push(de),de.onDone(()=>{de.destroy();const xe=this.players.indexOf(de);this.players.splice(xe,1)}),de.play()}),qe}elementContainsData(e,t){let i=!1;const r=t[Kl];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(t)&&(i=!0),this.playersByQueriedElement.has(t)&&(i=!0),this.statesByElement.has(t)&&(i=!0),this._fetchNamespace(e).elementContainsData(t)||i}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,o){let l=[];if(t){const c=this.playersByQueriedElement.get(e);c&&(l=c)}else{const c=this.playersByElement.get(e);if(c){const d=!o||o==Tb;c.forEach(p=>{p.queued||!d&&p.triggerName!=r||l.push(p)})}}return(i||r)&&(l=l.filter(c=>!(i&&i!=c.namespaceId||r&&r!=c.triggerName))),l}_beforeAnimationBuild(e,t,i){const o=t.element,l=t.isRemovalTransition?void 0:e,c=t.isRemovalTransition?void 0:t.triggerName;for(const d of t.timelines){const p=d.element,y=p!==o,v=fl(i,p,[]);this._getPreviousPlayers(p,y,l,c,t.toState).forEach(b=>{const S=b.getRealPlayer();S.beforeDestroy&&S.beforeDestroy(),b.destroy(),v.push(b)})}sg(o,t.fromStyles)}_buildAnimation(e,t,i,r,o,l){const c=t.triggerName,d=t.element,p=[],y=new Set,v=new Set,x=t.timelines.map(S=>{const E=S.element;y.add(E);const T=E[Kl];if(T&&T.removedBeforeQueried)return new Eb(S.duration,S.delay);const N=E!==d,F=function ene(n){const e=[];return rH(n,e),e}((i.get(E)||jte).map(ie=>ie.getRealPlayer())).filter(ie=>!!ie.element&&ie.element===E),U=o.get(E),k=l.get(E),H=Rz(0,this._normalizer,0,S.keyframes,U,k),Q=this._buildPlayer(S,H,F);if(S.subTimeline&&r&&v.add(E),N){const ie=new NL(e,c,E);ie.setRealPlayer(Q),p.push(ie)}return Q});p.forEach(S=>{fl(this.playersByQueriedElement,S.element,[]).push(S),S.onDone(()=>function Kte(n,e,t){let i;if(n instanceof Map){if(i=n.get(e),i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}}else if(i=n[e],i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&delete n[e]}return i}(this.playersByQueriedElement,S.element,S))}),y.forEach(S=>Zl(S,Vz));const b=Hf(x);return b.onDestroy(()=>{y.forEach(S=>z_(S,Vz)),Su(d,t.toStyles)}),v.forEach(S=>{fl(r,S,[]).push(b)}),b}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new Eb(e.duration,e.delay)}}class NL{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new Eb,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(i=>pL(e,t,void 0,i))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){fl(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function LT(n){return n&&1===n.nodeType}function tH(n,e){const t=n.style.display;return n.style.display=null!=e?e:"none",t}function nH(n,e,t,i,r){const o=[];t.forEach(d=>o.push(tH(d)));const l=[];i.forEach((d,p)=>{const y={};d.forEach(v=>{const x=y[v]=e.computeStyle(p,v,r);(!x||0==x.length)&&(p[Kl]=Xte,l.push(p))}),n.set(p,y)});let c=0;return t.forEach(d=>tH(d,o[c++])),l}function iH(n,e){const t=new Map;if(n.forEach(c=>t.set(c,[])),0==e.length)return t;const r=new Set(e),o=new Map;function l(c){if(!c)return 1;let d=o.get(c);if(d)return d;const p=c.parentNode;return d=t.has(p)?p:r.has(p)?1:l(p),o.set(c,d),d}return e.forEach(c=>{const d=l(c);1!==d&&t.get(d).push(c)}),t}function Zl(n,e){var t;null===(t=n.classList)||void 0===t||t.add(e)}function z_(n,e){var t;null===(t=n.classList)||void 0===t||t.remove(e)}function Qte(n,e,t){Hf(t).onDone(()=>n.processLeaveNode(e))}function rH(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof Az?rH(i.players,e):e.push(i)}}function sH(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(o=>r.add(o)):e.set(n,i),t.delete(n),!0}class FT{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,o)=>{},this._transitionEngine=new Yte(e,t,i),this._timelineEngine=new zte(e,t,i),this._transitionEngine.onRemovalComplete=(r,o)=>this.onRemovalComplete(r,o)}registerTrigger(e,t,i,r,o){const l=e+"-"+r;let c=this._triggerCache[l];if(!c){const d=[],y=EL(this._driver,o,d,[]);if(d.length)throw function Hee(n,e){return new Yt(3404,ki)}();c=function kte(n,e,t){return new Bte(n,e,t)}(r,y,this._normalizer),this._triggerCache[l]=c}this._transitionEngine.registerTrigger(t,r,c)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i,r){this._transitionEngine.removeNode(e,t,r||!1,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[o,l]=Pz(i);this._timelineEngine.command(o,t,l,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,o){if("@"==i.charAt(0)){const[l,c]=Pz(i);return this._timelineEngine.listen(l,t,c,o)}return this._transitionEngine.listen(e,t,i,r,o)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let ine=(()=>{class n{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let o=n.initialStylesByElement.get(t);o||n.initialStylesByElement.set(t,o={}),this._initialStyles=o}start(){this._state<1&&(this._startStyles&&Su(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Su(this._element,this._initialStyles),this._endStyles&&(Su(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(sg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(sg(this._element,this._endStyles),this._endStyles=null),Su(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function OL(n){let e=null;const t=Object.keys(n);for(let i=0;i<t.length;i++){const r=t[i];rne(r)&&(e=e||{},e[r]=n[r])}return e}function rne(n){return"display"===n||"position"===n}class oH{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,i){return e.animate(t,i)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};if(this.hasStarted()){const t=this._finalKeyframe;Object.keys(t).forEach(i=>{"offset"!=i&&(e[i]=this._finished?t[i]:qz(this.element,i))})}this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class sne{validateStyleProperty(e){return Nz(e)}matchesElement(e,t){return!1}containsElement(e,t){return Oz(e,t)}getParentElement(e){return _L(e)}query(e,t,i){return kz(e,t,i)}computeStyle(e,t,i){return window.getComputedStyle(e)[t]}animate(e,t,i,r,o,l=[]){const d={duration:i,delay:r,fill:0==r?"both":"forwards"};o&&(d.easing=o);const p={},y=l.filter(x=>x instanceof oH);(function cte(n,e){return 0===n||0===e})(i,r)&&y.forEach(x=>{let b=x.currentSnapshot;Object.keys(b).forEach(S=>p[S]=b[S])}),t=function ute(n,e,t){const i=Object.keys(t);if(i.length&&e.length){let o=e[0],l=[];if(i.forEach(c=>{o.hasOwnProperty(c)||l.push(c),o[c]=t[c]}),l.length)for(var r=1;r<e.length;r++){let c=e[r];l.forEach(function(d){c[d]=qz(n,d)})}}return e}(e,t=t.map(x=>Gf(x,!1)),p);const v=function nne(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=OL(e[0]),e.length>1&&(i=OL(e[e.length-1]))):e&&(t=OL(e)),t||i?new ine(n,t,i):null}(e,t);return new oH(e,t,d,v)}}let one=(()=>{class n extends Sz{constructor(t,i){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(i.body,{id:"0",encapsulation:Ho.None,styles:[],data:{animation:[]}})}build(t){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(t)?Ez(t):t;return aH(this._renderer,null,i,"register",[r]),new ane(i,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(Ot(nx),Ot(xo))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();class ane extends class xee{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new lne(this._id,e,t||{},this._renderer)}}class lne{constructor(e,t,i,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return aH(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function aH(n,e,t,i,r){return n.setProperty(e,`@@${t}:${i}`,r)}const lH="@.disabled";let cne=(()=>{class n{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(o,l)=>{const c=null==l?void 0:l.parentNode(o);c&&l.removeChild(c,o)}}createRenderer(t,i){const o=this.delegate.createRenderer(t,i);if(!(t&&i&&i.data&&i.data.animation)){let y=this._rendererCache.get(o);return y||(y=new cH("",o,this.engine),this._rendererCache.set(o,y)),y}const l=i.id,c=i.id+"-"+this._currentId;this._currentId++,this.engine.register(c,t);const d=y=>{Array.isArray(y)?y.forEach(d):this.engine.registerTrigger(l,c,t,y.name,y)};return i.data.animation.forEach(d),new une(this,c,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){t>=0&&t<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(o=>{const[l,c]=o;l(c)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(Ot(nx),Ot(FT),Ot(As))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();class cH{constructor(e,t,i){this.namespaceId=e,this.delegate=t,this.engine=i,this.destroyNode=this.delegate.destroyNode?r=>t.destroyNode(r):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.engine.onRemove(this.namespaceId,t,this.delegate,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==lH?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class une extends cH{constructor(e,t,i,r){super(t,i,r),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==lH?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.substr(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if("@"==t.charAt(0)){const r=function hne(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let o=t.substr(1),l="";return"@"!=o.charAt(0)&&([o,l]=function dne(n){const e=n.indexOf(".");return[n.substring(0,e),n.substr(e+1)]}(o)),this.engine.listen(this.namespaceId,r,o,l,c=>{this.factory.scheduleListenerCallback(c._data||-1,i,c)})}return this.delegate.listen(e,t,i)}}let fne=(()=>{class n extends FT{constructor(t,i,r){super(t.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(Ot(xo),Ot(vL),Ot(RL))},n.\u0275prov=yn({token:n,factory:n.\u0275fac}),n})();const uH=new Xn("AnimationModuleType"),hH=[{provide:Sz,useClass:one},{provide:RL,useFactory:function pne(){return new Ite}},{provide:FT,useClass:fne},{provide:nx,useFactory:function mne(n,e,t){return new cne(n,e,t)},deps:[KS,FT,As]}],dH=[{provide:vL,useFactory:()=>new sne},{provide:uH,useValue:"BrowserAnimations"},...hH],gne=[{provide:vL,useClass:Bz},{provide:uH,useValue:"NoopAnimations"},...hH];let yne=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?gne:dH}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n}),n.\u0275inj=Fs({providers:dH,imports:[qN]}),n})();const _ne={url:`http://127.0.0.1:${xx_port}`,options:{transports:["websocket","polling"]}};let vne=(()=>{class n{constructor(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=xs({type:n,bootstrap:[b8]}),n.\u0275inj=Fs({providers:[QS],imports:[[qN,QJ,QQ,p8,Q$.forRoot(_ne),hJ.forRoot(),cY,hY,EZ.forRoot([]),yne]]}),n})();tp(zy,[mx,jS,CN,bz,wz,fJ,tee,Mz],[]),tp(bz,[zy],[]),tp(wz,[zy],[]),tp(Mz,[mx,aee,vee],[]),function C4(){QF=!1}(),OW().bootstrapModule(vne).catch(n=>console.error(n))},765:(Co,O,co)=>{var uo;window,Co.exports=(uo=co(712),function(fr){var yt={};function Et(fn){if(yt[fn])return yt[fn].exports;var tn=yt[fn]={i:fn,l:!1,exports:{}};return fr[fn].call(tn.exports,tn,tn.exports,Et),tn.l=!0,tn.exports}return Et.m=fr,Et.c=yt,Et.d=function(fn,tn,An){Et.o(fn,tn)||Object.defineProperty(fn,tn,{enumerable:!0,get:An})},Et.r=function(fn){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(fn,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(fn,"__esModule",{value:!0})},Et.t=function(fn,tn){if(1&tn&&(fn=Et(fn)),8&tn||4&tn&&"object"==typeof fn&&fn&&fn.__esModule)return fn;var An=Object.create(null);if(Et.r(An),Object.defineProperty(An,"default",{enumerable:!0,value:fn}),2&tn&&"string"!=typeof fn)for(var mi in fn)Et.d(An,mi,function(tr){return fn[tr]}.bind(null,mi));return An},Et.n=function(fn){var tn=fn&&fn.__esModule?function(){return fn.default}:function(){return fn};return Et.d(tn,"a",tn),tn},Et.o=function(fn,tn){return Object.prototype.hasOwnProperty.call(fn,tn)},Et.p="",Et(Et.s=8)}([function(fr,yt){fr.exports=uo},function(fr,yt,Et){"use strict";function fn(tn){this.content=[],this.scoreFunction=tn}Object.defineProperty(yt,"__esModule",{value:!0}),yt.BinaryHeap=fn,fn.prototype={push:function(tn){this.content.push(tn),this.bubbleUp(this.content.length-1)},pop:function(){var tn=this.content[0],An=this.content.pop();return this.content.length>0&&(this.content[0]=An,this.sinkDown(0)),tn},remove:function(tn){for(var An=this.content.length,mi=0;mi<An;mi++)if(this.content[mi]==tn){var tr=this.content.pop();if(mi==An-1)break;this.content[mi]=tr,this.bubbleUp(mi),this.sinkDown(mi);break}},size:function(){return this.content.length},bubbleUp:function(tn){for(var An=this.content[tn],mi=this.scoreFunction(An);tn>0;){var tr=Math.floor((tn+1)/2)-1,Si=this.content[tr];if(mi>=this.scoreFunction(Si))break;this.content[tr]=An,this.content[tn]=Si,tn=tr}},sinkDown:function(tn){for(var An=this.content.length,mi=this.content[tn],tr=this.scoreFunction(mi);;){var Si=2*(tn+1),Qs=Si-1,Mr=null;if(Qs<An){var rs=this.scoreFunction(this.content[Qs]);rs<tr&&(Mr=Qs)}if(Si<An&&this.scoreFunction(this.content[Si])<(null==Mr?tr:rs)&&(Mr=Si),null==Mr)break;this.content[tn]=this.content[Mr],this.content[Mr]=mi,tn=Mr}}}},function(fr,yt,Et){"use strict";Et.r(yt),yt.default="precision highp float;\r\nprecision highp int;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv;\r\n\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n\r\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}"},function(fr,yt,Et){"use strict";Et.r(yt),yt.default="precision highp float;\r\nprecision highp int;\r\n\r\nuniform mat4 projectionMatrix;\r\n\r\nuniform float screenWidth;\r\nuniform float screenHeight;\r\n\r\nuniform sampler2D map;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tfloat dx = 1.0 / screenWidth;\r\n\tfloat dy = 1.0 / screenHeight;\r\n\r\n\tvec3 color = vec3(0.0, 0.0, 0.0);\r\n\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;\r\n    \r\n\tcolor = color / 9.0;\r\n\t\r\n\tgl_FragColor = vec4(color, 1.0);\r\n\t\r\n\t\r\n}"},function(fr,yt,Et){"use strict";Et.r(yt),yt.default="precision highp float;\r\nprecision highp int;\r\n\r\n#define max_clip_boxes 30\r\n\r\nattribute vec3 position;\r\nattribute vec3 color;\r\nattribute vec3 normal;\r\nattribute float intensity;\r\nattribute float classification;\r\nattribute float returnNumber;\r\nattribute float numberOfReturns;\r\nattribute float pointSourceID;\r\nattribute vec4 indices;\r\nattribute vec2 uv;\r\n\r\nuniform mat4 modelMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat3 normalMatrix;\r\n\r\nuniform float pcIndex;\r\n\r\nuniform float screenWidth;\r\nuniform float screenHeight;\r\nuniform float fov;\r\nuniform float spacing;\r\n\r\n#if defined use_clip_box\r\n\tuniform mat4 clipBoxes[max_clip_boxes];\r\n#endif\r\n\r\nuniform float heightMin;\r\nuniform float heightMax;\r\nuniform float size; // pixel size factor\r\nuniform float minSize; // minimum pixel size\r\nuniform float maxSize; // maximum pixel size\r\nuniform float octreeSize;\r\nuniform vec3 bbSize;\r\nuniform vec3 uColor;\r\nuniform float opacity;\r\nuniform float clipBoxCount;\r\nuniform float level;\r\nuniform float vnStart;\r\nuniform bool isLeafNode;\r\n\r\nuniform float filterByNormalThreshold;\r\nuniform vec2 intensityRange;\r\nuniform float opacityAttenuation;\r\nuniform float intensityGamma;\r\nuniform float intensityContrast;\r\nuniform float intensityBrightness;\r\nuniform float rgbGamma;\r\nuniform float rgbContrast;\r\nuniform float rgbBrightness;\r\nuniform float transition;\r\nuniform float wRGB;\r\nuniform float wIntensity;\r\nuniform float wElevation;\r\nuniform float wClassification;\r\nuniform float wReturnNumber;\r\nuniform float wSourceID;\r\n\r\nuniform sampler2D visibleNodes;\r\nuniform sampler2D gradient;\r\nuniform sampler2D classificationLUT;\r\nuniform sampler2D depthMap;\r\n\r\n#ifdef use_texture_blending\r\n\tuniform sampler2D backgroundMap;\r\n#endif\r\n\r\n#ifdef use_point_cloud_mixing\r\n\tuniform int pointCloudMixingMode;\r\n\tuniform float pointCloudID;\r\n\r\n\tuniform float pointCloudMixAngle;\r\n\tuniform float stripeDistanceX;\r\n\tuniform float stripeDistanceY;\r\n\r\n\tuniform float stripeDivisorX;\r\n\tuniform float stripeDivisorY;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tuniform vec3 highlightedPointCoordinate;\r\n\tuniform bool enablePointHighlighting;\r\n\tuniform float highlightedPointScale;\r\n#endif\r\n\r\n#ifdef use_filter_by_normal\r\n\tuniform int normalFilteringMode;\r\n#endif\r\n\r\nvarying vec3 vColor;\r\n\r\n#if !defined(color_type_point_index)\r\n\tvarying float vOpacity;\r\n#endif\r\n\r\n#if defined(weighted_splats)\r\n\tvarying float vLinearDepth;\r\n#endif\r\n\r\n#if !defined(paraboloid_point_shape) && defined(use_edl)\r\n\tvarying float vLogDepth;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\r\n\tvarying vec3 vViewPosition;\r\n#endif\r\n\r\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\r\n\tvarying float vRadius;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\r\n\tvarying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tvarying float vHighlight;\r\n#endif\r\n\r\n// ---------------------\r\n// OCTREE\r\n// ---------------------\r\n\r\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)\r\n\r\n/**\r\n * Rounds the specified number to the closest integer.\r\n */\r\nfloat round(float number){\r\n\treturn floor(number + 0.5);\r\n}\r\n\r\n/**\r\n * Gets the number of 1-bits up to inclusive index position.\r\n *\r\n * number is treated as if it were an integer in the range 0-255\r\n */\r\nint numberOfOnes(int number, int index) {\r\n\tint numOnes = 0;\r\n\tint tmp = 128;\r\n\tfor (int i = 7; i >= 0; i--) {\r\n\r\n\t\tif (number >= tmp) {\r\n\t\t\tnumber = number - tmp;\r\n\r\n\t\t\tif (i <= index) {\r\n\t\t\t\tnumOnes++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttmp = tmp / 2;\r\n\t}\r\n\r\n\treturn numOnes;\r\n}\r\n\r\n/**\r\n * Checks whether the bit at index is 1.0\r\n *\r\n * number is treated as if it were an integer in the range 0-255\r\n */\r\nbool isBitSet(int number, int index){\r\n\r\n\t// weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\r\n\tint powi = 1;\r\n\tif (index == 0) {\r\n\t\tpowi = 1;\r\n\t} else if (index == 1) {\r\n\t\tpowi = 2;\r\n\t} else if (index == 2) {\r\n\t\tpowi = 4;\r\n\t} else if (index == 3) {\r\n\t\tpowi = 8;\r\n\t} else if (index == 4) {\r\n\t\tpowi = 16;\r\n\t} else if (index == 5) {\r\n\t\tpowi = 32;\r\n\t} else if (index == 6) {\r\n\t\tpowi = 64;\r\n\t} else if (index == 7) {\r\n\t\tpowi = 128;\r\n\t}\r\n\r\n\tint ndp = number / powi;\r\n\r\n\treturn mod(float(ndp), 2.0) != 0.0;\r\n}\r\n\r\n/**\r\n * Gets the the LOD at the point position.\r\n */\r\nfloat getLOD() {\r\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\r\n\tint iOffset = int(vnStart);\r\n\tfloat depth = level;\r\n\r\n\tfor (float i = 0.0; i <= 30.0; i++) {\r\n\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i + level + 0.0);\r\n\r\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\r\n\t\tindex3d = floor(index3d + 0.5);\r\n\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\r\n\r\n\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\r\n\t\tint mask = int(round(value.r * 255.0));\r\n\r\n\t\tif (isBitSet(mask, index)) {\r\n\t\t\t// there are more visible child nodes at this position\r\n\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\r\n\t\t\tint advanceB = int(round(value.b * 255.0));\r\n\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\r\n\t\t\tint advance = advanceG + advanceB + advanceChild;\r\n\r\n\t\t\tiOffset = iOffset + advance;\r\n\r\n\t\t\tdepth++;\r\n\t\t} else {\r\n\t\t\treturn value.a * 255.0; // no more visible child nodes at this position\r\n\t\t}\r\n\r\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\r\n\t}\r\n\r\n\treturn depth;\r\n}\r\n\r\nfloat getPointSizeAttenuation() {\r\n\treturn 0.5 * pow(2.0, getLOD());\r\n}\r\n\r\n#endif\r\n\r\n// ---------------------\r\n// KD-TREE\r\n// ---------------------\r\n\r\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)\r\n\r\nfloat getLOD() {\r\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\r\n\tfloat intOffset = 0.0;\r\n\tfloat depth = 0.0;\r\n\r\n\tvec3 size = bbSize;\r\n\tvec3 pos = position;\r\n\r\n\tfor (float i = 0.0; i <= 1000.0; i++) {\r\n\r\n\t\tvec4 value = texture2D(visibleNodes, vec2(intOffset / 2048.0, 0.0));\r\n\r\n\t\tint children = int(value.r * 255.0);\r\n\t\tfloat next = value.g * 255.0;\r\n\t\tint split = int(value.b * 255.0);\r\n\r\n\t\tif (next == 0.0) {\r\n\t\t \treturn depth;\r\n\t\t}\r\n\r\n\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\r\n\t\tif (split == 1) {\r\n\t\t\tsplitv.x = 1.0;\r\n\t\t} else if (split == 2) {\r\n\t\t \tsplitv.y = 1.0;\r\n\t\t} else if (split == 4) {\r\n\t\t \tsplitv.z = 1.0;\r\n\t\t}\r\n\r\n\t\tintOffset = intOffset + next;\r\n\r\n\t\tfloat factor = length(pos * splitv / size);\r\n\t\tif (factor < 0.5) {\r\n\t\t \t// left\r\n\t\t\tif (children == 0 || children == 2) {\r\n\t\t\t\treturn depth;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// right\r\n\t\t\tpos = pos - size * splitv * 0.5;\r\n\t\t\tif (children == 0 || children == 1) {\r\n\t\t\t\treturn depth;\r\n\t\t\t}\r\n\t\t\tif (children == 3) {\r\n\t\t\t\tintOffset = intOffset + 1.0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\r\n\r\n\t\tdepth++;\r\n\t}\r\n\r\n\r\n\treturn depth;\r\n}\r\n\r\nfloat getPointSizeAttenuation() {\r\n\treturn 0.5 * pow(1.3, getLOD());\r\n}\r\n\r\n#endif\r\n\r\n// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\r\nfloat getContrastFactor(float contrast) {\r\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\r\n}\r\n\r\nvec3 getRGB() {\r\n\t#if defined(use_rgb_gamma_contrast_brightness)\r\n\t  vec3 rgb = color;\r\n\t\trgb = pow(rgb, vec3(rgbGamma));\r\n\t\trgb = rgb + rgbBrightness;\r\n\t\trgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;\r\n\t\trgb = clamp(rgb, 0.0, 1.0);\r\n\t\treturn rgb;\r\n\t#else\r\n\t\treturn color;\r\n\t#endif\r\n}\r\n\r\nfloat getIntensity() {\r\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\r\n\tw = pow(w, intensityGamma);\r\n\tw = w + intensityBrightness;\r\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\r\n\tw = clamp(w, 0.0, 1.0);\r\n\r\n\treturn w;\r\n}\r\n\r\nvec3 getElevation() {\r\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\r\n\tfloat w = (world.z - heightMin) / (heightMax-heightMin);\r\n\tvec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\r\n\r\n\treturn cElevation;\r\n}\r\n\r\nvec4 getClassification() {\r\n\tvec2 uv = vec2(classification / 255.0, 0.5);\r\n\tvec4 classColor = texture2D(classificationLUT, uv);\r\n\r\n\treturn classColor;\r\n}\r\n\r\nvec3 getReturnNumber() {\r\n\tif (numberOfReturns == 1.0) {\r\n\t\treturn vec3(1.0, 1.0, 0.0);\r\n\t} else {\r\n\t\tif (returnNumber == 1.0) {\r\n\t\t\treturn vec3(1.0, 0.0, 0.0);\r\n\t\t} else if (returnNumber == numberOfReturns) {\r\n\t\t\treturn vec3(0.0, 0.0, 1.0);\r\n\t\t} else {\r\n\t\t\treturn vec3(0.0, 1.0, 0.0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvec3 getSourceID() {\r\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\r\n\treturn texture2D(gradient, vec2(w, 1.0 - w)).rgb;\r\n}\r\n\r\nvec3 getCompositeColor() {\r\n\tvec3 c;\r\n\tfloat w;\r\n\r\n\tc += wRGB * getRGB();\r\n\tw += wRGB;\r\n\r\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\r\n\tw += wIntensity;\r\n\r\n\tc += wElevation * getElevation();\r\n\tw += wElevation;\r\n\r\n\tc += wReturnNumber * getReturnNumber();\r\n\tw += wReturnNumber;\r\n\r\n\tc += wSourceID * getSourceID();\r\n\tw += wSourceID;\r\n\r\n\tvec4 cl = wClassification * getClassification();\r\n\tc += cl.a * cl.rgb;\r\n\tw += wClassification * cl.a;\r\n\r\n\tc = c / w;\r\n\r\n\tif (w == 0.0) {\r\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\r\n\t}\r\n\r\n\treturn c;\r\n}\r\n\r\nvoid main() {\r\n\tvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n\r\n\tgl_Position = projectionMatrix * mvPosition;\r\n\r\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\r\n\t\tvViewPosition = mvPosition.xyz;\r\n\t#endif\r\n\r\n\t#if defined weighted_splats\r\n\t\tvLinearDepth = gl_Position.w;\r\n\t#endif\r\n\r\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\r\n\t\tvNormal = normalize(normalMatrix * normal);\r\n\t#endif\r\n\r\n\t#if !defined(paraboloid_point_shape) && defined(use_edl)\r\n\t\tvLogDepth = log2(-mvPosition.z);\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// POINT SIZE\r\n\t// ---------------------\r\n\r\n\tfloat pointSize = 1.0;\r\n\tfloat slope = tan(fov / 2.0);\r\n\tfloat projFactor =  -0.5 * screenHeight / (slope * mvPosition.z);\r\n\r\n\t#if defined fixed_point_size\r\n\t\tpointSize = size;\r\n\t#elif defined attenuated_point_size\r\n\t\tpointSize = size * spacing * projFactor;\r\n\t#elif defined adaptive_point_size\r\n\t\tfloat worldSpaceSize = 2.0 * size * spacing / getPointSizeAttenuation();\r\n\t\tpointSize = worldSpaceSize * projFactor;\r\n\t#endif\r\n\r\n\tpointSize = max(minSize, pointSize);\r\n\tpointSize = min(maxSize, pointSize);\r\n\r\n\t#if defined(weighted_splats) || defined(paraboloid_point_shape)\r\n\t\tvRadius = pointSize / projFactor;\r\n\t#endif\r\n\r\n\tgl_PointSize = pointSize;\r\n\r\n\t// ---------------------\r\n\t// HIGHLIGHTING\r\n\t// ---------------------\r\n\r\n\t#ifdef highlight_point\r\n\t\tvec4 mPosition = modelMatrix * vec4(position, 1.0);\r\n\t\tif (enablePointHighlighting && abs(mPosition.x - highlightedPointCoordinate.x) < 0.0001 &&\r\n\t\t\tabs(mPosition.y - highlightedPointCoordinate.y) < 0.0001 &&\r\n\t\t\tabs(mPosition.z - highlightedPointCoordinate.z) < 0.0001) {\r\n\t\t\tvHighlight = 1.0;\r\n\t\t\tgl_PointSize = pointSize * highlightedPointScale;\r\n\t\t} else {\r\n\t\t\tvHighlight = 0.0;\r\n\t\t}\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// OPACITY\r\n\t// ---------------------\r\n\r\n\t#ifndef color_type_point_index\r\n\t\t#ifdef attenuated_opacity\r\n\t\t\tvOpacity = opacity * exp(-length(-mvPosition.xyz) / opacityAttenuation);\r\n\t\t#else\r\n\t\t\tvOpacity = opacity;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// FILTERING\r\n\t// ---------------------\r\n\r\n\t#ifdef use_filter_by_normal\r\n\t\tbool discardPoint = false;\r\n\t\t// Absolute normal filtering\r\n\t\tif (normalFilteringMode == 1) {\r\n\t\t\tdiscardPoint = (abs((modelViewMatrix * vec4(normal, 0.0)).z) > filterByNormalThreshold);\r\n\t\t}\r\n\t\t// less than equal to\r\n\t\telse if (normalFilteringMode == 2) {\r\n\t\t\tdiscardPoint = (modelViewMatrix * vec4(normal, 0.0)).z <= filterByNormalThreshold;\r\n\t\t\t}\r\n\t\t// greater than\r\n\t\telse if(normalFilteringMode == 3) {\r\n\t\t\tdiscardPoint = (modelViewMatrix * vec4(normal, 0.0)).z > filterByNormalThreshold;\r\n\t\t\t}\r\n\r\n\t\tif (discardPoint)\r\n\t\t{\r\n\t\t\tgl_Position = vec4(0.0, 0.0, 2.0, 1.0);\r\n\t\t}\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// POINT COLOR\r\n\t// ---------------------\r\n\r\n\t#ifdef color_type_rgb\r\n\t\tvColor = getRGB();\r\n\t#elif defined color_type_height\r\n\t\tvColor = getElevation();\r\n\t#elif defined color_type_rgb_height\r\n\t\tvec3 cHeight = getElevation();\r\n\t\tvColor = (1.0 - transition) * getRGB() + transition * cHeight;\r\n\t#elif defined color_type_depth\r\n\t\tfloat linearDepth = -mvPosition.z ;\r\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\r\n\t\tvColor = vec3(linearDepth, expDepth, 0.0);\r\n\t#elif defined color_type_intensity\r\n\t\tfloat w = getIntensity();\r\n\t\tvColor = vec3(w, w, w);\r\n\t#elif defined color_type_intensity_gradient\r\n\t\tfloat w = getIntensity();\r\n\t\tvColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\r\n\t#elif defined color_type_color\r\n\t\tvColor = uColor;\r\n\t#elif defined color_type_lod\r\n\tfloat w = getLOD() / 10.0;\r\n\tvColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\r\n\t#elif defined color_type_point_index\r\n\t\tvColor = indices.rgb;\r\n\t#elif defined color_type_classification\r\n\t  vec4 cl = getClassification();\r\n\t\tvColor = cl.rgb;\r\n\t#elif defined color_type_return_number\r\n\t\tvColor = getReturnNumber();\r\n\t#elif defined color_type_source\r\n\t\tvColor = getSourceID();\r\n\t#elif defined color_type_normal\r\n\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz;\r\n\t#elif defined color_type_phong\r\n\t\tvColor = color;\r\n\t#elif defined color_type_composite\r\n\t\tvColor = getCompositeColor();\r\n\t#endif\r\n\r\n\t#if !defined color_type_composite && defined color_type_classification\r\n\t\tif (cl.a == 0.0) {\r\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\r\n\t\t\treturn;\r\n\t\t}\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// CLIPPING\r\n\t// ---------------------\r\n\r\n\t#if defined use_clip_box\r\n\t\tbool insideAny = false;\r\n\t\tfor (int i = 0; i < max_clip_boxes; i++) {\r\n\t\t\tif (i == int(clipBoxCount)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4(position, 1.0);\r\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\r\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\r\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\r\n\t\t\tinsideAny = insideAny || inside;\r\n\t\t}\r\n\r\n\t\tif (!insideAny) {\r\n\t\t\t#if defined clip_outside\r\n\t\t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\r\n\t\t\t#elif defined clip_highlight_inside && !defined(color_type_depth)\r\n\t\t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;\r\n\t\t\t#endif\r\n\t\t} else {\r\n\t\t\t#if defined clip_highlight_inside\r\n\t\t\t\tvColor.r += 0.5;\r\n\t\t\t#endif\r\n\t\t}\r\n\t#endif\r\n}\r\n"},function(fr,yt,Et){"use strict";Et.r(yt),yt.default="precision highp float;\r\nprecision highp int;\r\n\r\n#if defined paraboloid_point_shape\r\n\t#extension GL_EXT_frag_depth : enable\r\n#endif\r\n\r\nuniform mat4 viewMatrix;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform float opacity;\r\n\r\nuniform float blendHardness;\r\nuniform float blendDepthSupplement;\r\nuniform float fov;\r\nuniform float spacing;\r\nuniform float pcIndex;\r\nuniform float screenWidth;\r\nuniform float screenHeight;\r\n\r\nuniform sampler2D depthMap;\r\n\r\n#if defined (clip_horizontally) || defined (clip_vertically)\r\n\tuniform vec4 clipExtent;\r\n#endif\r\n\r\n#ifdef use_texture_blending\r\n\tuniform sampler2D backgroundMap;\r\n#endif\r\n\r\n\r\n#ifdef use_point_cloud_mixing\r\n\tuniform int pointCloudMixingMode;\r\n\tuniform float pointCloudID;\r\n\tuniform float pointCloudMixAngle;\r\n\tuniform float stripeDistanceX;\r\n\tuniform float stripeDistanceY;\r\n\r\n\tuniform float stripeDivisorX;\r\n\tuniform float stripeDivisorY;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tuniform vec4 highlightedPointColor;\r\n#endif\r\n\r\nvarying vec3 vColor;\r\n\r\n#if !defined(color_type_point_index)\r\n\tvarying float vOpacity;\r\n#endif\r\n\r\n#if defined(weighted_splats)\r\n\tvarying float vLinearDepth;\r\n#endif\r\n\r\n#if !defined(paraboloid_point_shape) && defined(use_edl)\r\n\tvarying float vLogDepth;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\r\n\tvarying vec3 vViewPosition;\r\n#endif\r\n\r\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\r\n\tvarying float vRadius;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\r\n\tvarying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tvarying float vHighlight;\r\n#endif\r\n\r\nfloat specularStrength = 1.0;\r\n\r\nvoid main() {\r\n\tvec3 color = vColor;\r\n\tfloat depth = gl_FragCoord.z;\r\n\r\n\t#if defined (clip_horizontally) || defined (clip_vertically)\r\n\tvec2 ndc = vec2((gl_FragCoord.x / screenWidth), 1.0 - (gl_FragCoord.y / screenHeight));\r\n\r\n\tif(step(clipExtent.x, ndc.x) * step(ndc.x, clipExtent.z) < 1.0)\r\n\t{\r\n\t\tdiscard;\r\n\t}\r\n\r\n\tif(step(clipExtent.y, ndc.y) * step(ndc.y, clipExtent.w) < 1.0)\r\n\t{\r\n\t\tdiscard;\r\n\t}\r\n\t#endif  \r\n\r\n\t#if defined(circle_point_shape) || defined(paraboloid_point_shape) || defined (weighted_splats)\r\n\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;\r\n\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;\r\n\t#endif\r\n\r\n\t#if defined(circle_point_shape) || defined (weighted_splats)\r\n\t\tfloat cc = u*u + v*v;\r\n\t\tif(cc > 1.0){\r\n\t\t\tdiscard;\r\n\t\t}\r\n\t#endif\r\n\r\n\t#if defined weighted_splats\r\n\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\r\n\t\tfloat sDepth = texture2D(depthMap, uv).r;\r\n\t\tif(vLinearDepth > sDepth + vRadius + blendDepthSupplement){\r\n\t\t\tdiscard;\r\n\t\t}\r\n\t#endif\r\n\r\n\t#if defined color_type_point_index\r\n\t\tgl_FragColor = vec4(color, pcIndex / 255.0);\r\n\t#else\r\n\t\tgl_FragColor = vec4(color, vOpacity);\r\n\t#endif\r\n\r\n\t#ifdef use_point_cloud_mixing\r\n\t\tbool discardFragment = false;\r\n\r\n\t\tif (pointCloudMixingMode == 1) {  // Checkboard\r\n\t\t\tfloat vPointCloudID = pointCloudID > 10. ? pointCloudID/10.: pointCloudID;\r\n\t\t\tdiscardFragment = mod(gl_FragCoord.x, vPointCloudID) > 0.5 && mod(gl_FragCoord.y, vPointCloudID) > 0.5;\r\n\t\t}\r\n\t\telse if (pointCloudMixingMode == 2) {  // Stripes\r\n\t\t\tfloat angle = pointCloudMixAngle * pointCloudID / 180.;\r\n\t\t\tfloat u = cos(angle) * gl_FragCoord.x + sin(angle) * gl_FragCoord.y;\r\n\t\t\tfloat v = -sin(angle) * gl_FragCoord.x + cos(angle) * gl_FragCoord.y;\r\n\r\n\t\t\tdiscardFragment = mod(u, stripeDistanceX) >= stripeDistanceX/stripeDivisorX && mod(v, stripeDistanceY) >= stripeDistanceY/stripeDivisorY;\r\n\t\t}\r\n\t\tif (discardFragment) {\r\n\t\t\tdiscard;\r\n\t\t}\r\n\t#endif\r\n\r\n\t#ifdef use_texture_blending\r\n\t\tvec2 vUv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\r\n\r\n\t\tvec4 tColor = texture2D(backgroundMap, vUv);\r\n\t\tgl_FragColor = vec4(vOpacity * color, 1.) + vec4((1. - vOpacity) * tColor.rgb, 0.);\r\n\t#endif\r\n\r\n\t#if defined(color_type_phong)\r\n\t\t#if MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0\r\n\t\t\tvec3 normal = normalize( vNormal );\r\n\t\t\tnormal.z = abs(normal.z);\r\n\r\n\t\t\tvec3 viewPosition = normalize( vViewPosition );\r\n\t\t#endif\r\n\r\n\t\t// code taken from three.js phong light fragment shader\r\n\r\n\t\t#if MAX_POINT_LIGHTS > 0\r\n\r\n\t\t\tvec3 pointDiffuse = vec3( 0.0 );\r\n\t\t\tvec3 pointSpecular = vec3( 0.0 );\r\n\r\n\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n\t\t\t\tfloat lDistance = 1.0;\r\n\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )\r\n\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\r\n\r\n\t\t\t\tlVector = normalize( lVector );\r\n\r\n\t\t\t\t\t\t// diffuse\r\n\r\n\t\t\t\tfloat dotProduct = dot( normal, lVector );\r\n\r\n\t\t\t\t#ifdef WRAP_AROUND\r\n\r\n\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\r\n\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\r\n\r\n\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\r\n\r\n\t\t\t\t#else\r\n\r\n\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\r\n\r\n\t\t\t\t// specular\r\n\r\n\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\r\n\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\r\n\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\r\n\r\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\r\n\r\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\r\n\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\r\n\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);\r\n\t\t\t}\r\n\r\n\t\t#endif\r\n\r\n\t\t#if MAX_DIR_LIGHTS > 0\r\n\r\n\t\t\tvec3 dirDiffuse = vec3( 0.0 );\r\n\t\t\tvec3 dirSpecular = vec3( 0.0 );\r\n\r\n\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\r\n\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );\r\n\r\n\t\t\t\t\t\t// diffuse\r\n\r\n\t\t\t\tfloat dotProduct = dot( normal, dirVector );\r\n\r\n\t\t\t\t#ifdef WRAP_AROUND\r\n\r\n\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\r\n\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\r\n\r\n\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\r\n\r\n\t\t\t\t#else\r\n\r\n\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\r\n\r\n\t\t\t\t// specular\r\n\r\n\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\r\n\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\r\n\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\r\n\r\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\r\n\r\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\r\n\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\r\n\t\t\t}\r\n\r\n\t\t#endif\r\n\r\n\t\tvec3 totalDiffuse = vec3( 0.0 );\r\n\t\tvec3 totalSpecular = vec3( 0.0 );\r\n\r\n\t\t#if MAX_POINT_LIGHTS > 0\r\n\r\n\t\t\ttotalDiffuse += pointDiffuse;\r\n\t\t\ttotalSpecular += pointSpecular;\r\n\r\n\t\t#endif\r\n\r\n\t\t#if MAX_DIR_LIGHTS > 0\r\n\r\n\t\t\ttotalDiffuse += dirDiffuse;\r\n\t\t\ttotalSpecular += dirSpecular;\r\n\r\n\t\t#endif\r\n\r\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\r\n\r\n\t#endif\r\n\r\n\t#if defined weighted_splats\r\n\t    //float w = pow(1.0 - (u*u + v*v), blendHardness);\r\n\r\n\t\tfloat wx = 2.0 * length(2.0 * gl_PointCoord - 1.0);\r\n\t\tfloat w = exp(-wx * wx * 0.5);\r\n\r\n\t\t//float distance = length(2.0 * gl_PointCoord - 1.0);\r\n\t\t//float w = exp( -(distance * distance) / blendHardness);\r\n\r\n\t\tgl_FragColor.rgb = gl_FragColor.rgb * w;\r\n\t\tgl_FragColor.a = w;\r\n\t#endif\r\n\r\n\t#if defined paraboloid_point_shape\r\n\t\tfloat wi = 0.0 - ( u*u + v*v);\r\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\r\n\t\tpos.z += wi * vRadius;\r\n\t\tfloat linearDepth = -pos.z;\r\n\t\tpos = projectionMatrix * pos;\r\n\t\tpos = pos / pos.w;\r\n\t\tfloat expDepth = pos.z;\r\n\t\tdepth = (pos.z + 1.0) / 2.0;\r\n\t\tgl_FragDepthEXT = depth;\r\n\r\n\t\t#if defined(color_type_depth)\r\n\t\t\tgl_FragColor.r = linearDepth;\r\n\t\t\tgl_FragColor.g = expDepth;\r\n\t\t#endif\r\n\r\n\t\t#if defined(use_edl)\r\n\t\t\tgl_FragColor.a = log2(linearDepth);\r\n\t\t#endif\r\n\r\n\t#else\r\n\t\t#if defined(use_edl)\r\n\t\t\tgl_FragColor.a = vLogDepth;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef highlight_point\r\n\t\tif (vHighlight > 0.0) {\r\n\t\t\tgl_FragColor = highlightedPointColor;\r\n\t\t}\r\n\t#endif\r\n}\r\n"},function(fr,yt,Et){fr.exports=function(){return Et(7)('!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var r=n(1);onmessage=r.handleMessage},function(t,e,n){"use strict";var r;n.r(e),n.d(e,"handleMessage",(function(){return I})),function(t){t[t.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",t[t.COLOR_PACKED=1]="COLOR_PACKED",t[t.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",t[t.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",t[t.NORMAL_FLOATS=4]="NORMAL_FLOATS",t[t.FILLER=5]="FILLER",t[t.INTENSITY=6]="INTENSITY",t[t.CLASSIFICATION=7]="CLASSIFICATION",t[t.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",t[t.NORMAL_OCT16=9]="NORMAL_OCT16",t[t.NORMAL=10]="NORMAL"}(r||(r={}));const i={ordinal:1,size:4},o={ordinal:2,size:1},s={ordinal:3,size:1},u={ordinal:5,size:2};function a(t,e,n){return{name:t,type:e,numElements:n,byteSize:n*e.size}}const f=a(r.COLOR_PACKED,o,4),A={POSITION_CARTESIAN:a(r.POSITION_CARTESIAN,i,3),RGBA_PACKED:f,COLOR_PACKED:f,RGB_PACKED:a(r.COLOR_PACKED,o,3),NORMAL_FLOATS:a(r.NORMAL_FLOATS,i,3),FILLER_1B:a(r.FILLER,s,1),INTENSITY:a(r.INTENSITY,u,1),CLASSIFICATION:a(r.CLASSIFICATION,s,1),NORMAL_SPHEREMAPPED:a(r.NORMAL_SPHEREMAPPED,s,2),NORMAL_OCT16:a(r.NORMAL_OCT16,s,2),NORMAL:a(r.NORMAL,i,3)};class O{constructor(t){this.versionMinor=0,this.version=t;const e=-1===t.indexOf(".")?t.length:t.indexOf(".");this.versionMajor=parseInt(t.substr(0,e),10),this.versionMinor=parseInt(t.substr(e+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}newerThan(t){const e=new O(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>e.versionMinor}equalOrHigher(t){const e=new O(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>=e.versionMinor}upTo(t){return!this.newerThan(t)}}class c{constructor(t){this.tmp=new ArrayBuffer(4),this.tmpf=new Float32Array(this.tmp),this.tmpu8=new Uint8Array(this.tmp),this.u8=new Uint8Array(t)}getUint32(t){return this.u8[t+3]<<24|this.u8[t+2]<<16|this.u8[t+1]<<8|this.u8[t]}getUint16(t){return this.u8[t+1]<<8|this.u8[t]}getFloat32(t){const e=this.tmpu8,n=this.u8,r=this.tmpf;return e[0]=n[t+0],e[1]=n[t+1],e[2]=n[t+2],e[3]=n[t+3],r[0]}getUint8(t){return this.u8[t]}}const b=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1};function I(t){const e=t.data.buffer,n=t.data.pointAttributes,i={attributeBuffers:{},currentOffset:0,data:new c(e),mean:[0,0,0],nodeOffset:t.data.offset,numPoints:t.data.buffer.byteLength/n.byteSize,pointAttributes:n,scale:t.data.scale,tightBoxMax:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],tightBoxMin:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],transferables:[],version:new O(t.data.version)};for(const t of i.pointAttributes.attributes)M(t,i),i.currentOffset+=t.byteSize;const o=new ArrayBuffer(4*i.numPoints),s=new Uint32Array(o);for(let t=0;t<i.numPoints;t++)s[t]=t;i.attributeBuffers[r.CLASSIFICATION]||function(t){const e=new ArrayBuffer(4*t.numPoints),n=new Float32Array(e);for(let e=0;e<t.numPoints;e++)n[e]=0;t.attributeBuffers[r.CLASSIFICATION]={buffer:e,attribute:A.CLASSIFICATION}}(i);const u={buffer:e,mean:i.mean,attributeBuffers:i.attributeBuffers,tightBoundingBox:{min:i.tightBoxMin,max:i.tightBoxMax},indices:o};postMessage(u,i.transferables)}function M(t,e){const n=function(t,e){switch(t.name){case r.POSITION_CARTESIAN:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){let n,i,o;e.version.newerThan("1.3")?(n=e.data.getUint32(e.currentOffset+t*e.pointAttributes.byteSize+0)*e.scale,i=e.data.getUint32(e.currentOffset+t*e.pointAttributes.byteSize+4)*e.scale,o=e.data.getUint32(e.currentOffset+t*e.pointAttributes.byteSize+8)*e.scale):(n=e.data.getFloat32(t*e.pointAttributes.byteSize+0)+e.nodeOffset[0],i=e.data.getFloat32(t*e.pointAttributes.byteSize+4)+e.nodeOffset[1],o=e.data.getFloat32(t*e.pointAttributes.byteSize+8)+e.nodeOffset[2]),r[3*t+0]=n,r[3*t+1]=i,r[3*t+2]=o,e.mean[0]+=n/e.numPoints,e.mean[1]+=i/e.numPoints,e.mean[2]+=o/e.numPoints,e.tightBoxMin[0]=Math.min(e.tightBoxMin[0],n),e.tightBoxMin[1]=Math.min(e.tightBoxMin[1],i),e.tightBoxMin[2]=Math.min(e.tightBoxMin[2],o),e.tightBoxMax[0]=Math.max(e.tightBoxMax[0],n),e.tightBoxMax[1]=Math.max(e.tightBoxMax[1],i),e.tightBoxMax[2]=Math.max(e.tightBoxMax[2],o)}return{buffer:n,attribute:t}}(t,e);case r.COLOR_PACKED:return function(t,e){const n=new ArrayBuffer(3*e.numPoints),r=new Uint8Array(n);for(let t=0;t<e.numPoints;t++)r[3*t+0]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+0),r[3*t+1]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+1),r[3*t+2]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+2);return{buffer:n,attribute:t}}(t,e);case r.INTENSITY:return function(t,e){const n=new ArrayBuffer(4*e.numPoints),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++)r[t]=e.data.getUint16(e.currentOffset+t*e.pointAttributes.byteSize);return{buffer:n,attribute:t}}(t,e);case r.CLASSIFICATION:return function(t,e){const n=new ArrayBuffer(e.numPoints),r=new Uint8Array(n);for(let t=0;t<e.numPoints;t++)r[t]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize);return{buffer:n,attribute:t}}(t,e);case r.NORMAL_SPHEREMAPPED:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){const n=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+0),i=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+1);let o=2*(n/255)-1,s=2*(i/255)-1,u=1;const a=o*-o+s*-s+u*- -1;u=a,o*=Math.sqrt(a),s*=Math.sqrt(a),o*=2,s*=2,u=2*u-1,r[3*t+0]=o,r[3*t+1]=s,r[3*t+2]=u}return{buffer:n,attribute:t}}(t,e);case r.NORMAL_OCT16:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){const n=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+0),i=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+1),o=n/255*2-1,s=i/255*2-1;let u=1-Math.abs(o)-Math.abs(s),a=0,f=0;u>=0?(a=o,f=s):(a=-(s/b(s)-1)/b(o),f=-(o/b(o)-1)/b(s));const A=Math.sqrt(a*a+f*f+u*u);a/=A,f/=A,u/=A,r[3*t+0]=a,r[3*t+1]=f,r[3*t+2]=u}return{buffer:n,attribute:t}}(t,e);case r.NORMAL:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){const n=e.data.getFloat32(e.currentOffset+t*e.pointAttributes.byteSize+0),i=e.data.getFloat32(e.currentOffset+t*e.pointAttributes.byteSize+4),o=e.data.getFloat32(e.currentOffset+t*e.pointAttributes.byteSize+8);r[3*t+0]=n,r[3*t+1]=i,r[3*t+2]=o}return{buffer:n,attribute:t}}(t,e);default:return}}(t,e);void 0!==n&&(e.attributeBuffers[n.attribute.name]=n,e.transferables.push(n.buffer))}}]);',null)}},function(fr,yt,Et){"use strict";var fn=window.URL||window.webkitURL;fr.exports=function(tn,An){try{try{var mi;try{(mi=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(tn),mi=mi.getBlob()}catch(tr){mi=new Blob([tn])}return new Worker(fn.createObjectURL(mi))}catch(tr){return new Worker("data:application/javascript,"+encodeURIComponent(tn))}}catch(tr){if(!An)throw Error("Inline worker is not supported");return new Worker(An)}}},function(fr,yt,Et){"use strict";Et.r(yt),Et.d(yt,"BlurMaterial",function(){return rs}),Et.d(yt,"ClipMode",function(){return fn}),Et.d(yt,"PointSizeType",function(){return tn}),Et.d(yt,"PointShape",function(){return An}),Et.d(yt,"TreeType",function(){return mi}),Et.d(yt,"PointOpacityType",function(){return tr}),Et.d(yt,"PointColorType",function(){return Si}),Et.d(yt,"NormalFilteringMode",function(){return Qs}),Et.d(yt,"PointCloudMixingMode",function(){return Mr}),Et.d(yt,"PointCloudMaterial",function(){return Vt}),Et.d(yt,"generateDataTexture",function(){return Ru}),Et.d(yt,"generateGradientTexture",function(){return nd}),Et.d(yt,"generateClassificationTexture",function(){return Nc}),Et.d(yt,"GRAYSCALE",function(){return Du}),Et.d(yt,"INFERNO",function(){return lg}),Et.d(yt,"PLASMA",function(){return ja}),Et.d(yt,"RAINBOW",function(){return cg}),Et.d(yt,"SPECTRAL",function(){return Lc}),Et.d(yt,"VIRIDIS",function(){return Fc}),Et.d(yt,"YELLOW_GREEN",function(){return Xf}),Et.d(yt,"PointAttributeName",function(){return Mn}),Et.d(yt,"POINT_ATTRIBUTE_TYPES",function(){return zo}),Et.d(yt,"POINT_ATTRIBUTES",function(){return Iu}),Et.d(yt,"PointAttributes",function(){return Lu}),Et.d(yt,"PointCloudOctreeGeometryNode",function(){return rd}),Et.d(yt,"PointCloudOctreeGeometry",function(){return mg}),Et.d(yt,"PointCloudOctreeNode",function(){return sd}),Et.d(yt,"PointCloudOctreePicker",function(){return Bi}),Et.d(yt,"PointCloudOctree",function(){return Fu}),Et.d(yt,"PointCloudTree",function(){return $a}),Et.d(yt,"QueueItem",function(){return Ou}),Et.d(yt,"Potree",function(){return va}),Et.d(yt,"Version",function(){return kc});var fn,tn,An,mi,tr,Si,Qs,Mr,ae,_e=Et(0);class rs extends _e.ShaderMaterial{constructor(){super(...arguments),this.vertexShader=Et(2),this.fragmentShader=Et(3),this.uniforms={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},map:{type:"t",value:null}}}}(ae=fn||(fn={}))[ae.DISABLED=0]="DISABLED",ae[ae.CLIP_OUTSIDE=1]="CLIP_OUTSIDE",ae[ae.HIGHLIGHT_INSIDE=2]="HIGHLIGHT_INSIDE",ae[ae.CLIP_HORIZONTALLY=3]="CLIP_HORIZONTALLY",ae[ae.CLIP_VERTICALLY=4]="CLIP_VERTICALLY",function(ae){ae[ae.FIXED=0]="FIXED",ae[ae.ATTENUATED=1]="ATTENUATED",ae[ae.ADAPTIVE=2]="ADAPTIVE"}(tn||(tn={})),function(ae){ae[ae.SQUARE=0]="SQUARE",ae[ae.CIRCLE=1]="CIRCLE",ae[ae.PARABOLOID=2]="PARABOLOID"}(An||(An={})),function(ae){ae[ae.OCTREE=0]="OCTREE",ae[ae.KDTREE=1]="KDTREE"}(mi||(mi={})),function(ae){ae[ae.FIXED=0]="FIXED",ae[ae.ATTENUATED=1]="ATTENUATED"}(tr||(tr={})),function(ae){ae[ae.RGB=0]="RGB",ae[ae.COLOR=1]="COLOR",ae[ae.DEPTH=2]="DEPTH",ae[ae.HEIGHT=3]="HEIGHT",ae[ae.ELEVATION=3]="ELEVATION",ae[ae.INTENSITY=4]="INTENSITY",ae[ae.INTENSITY_GRADIENT=5]="INTENSITY_GRADIENT",ae[ae.LOD=6]="LOD",ae[ae.LEVEL_OF_DETAIL=6]="LEVEL_OF_DETAIL",ae[ae.POINT_INDEX=7]="POINT_INDEX",ae[ae.CLASSIFICATION=8]="CLASSIFICATION",ae[ae.RETURN_NUMBER=9]="RETURN_NUMBER",ae[ae.SOURCE=10]="SOURCE",ae[ae.NORMAL=11]="NORMAL",ae[ae.PHONG=12]="PHONG",ae[ae.RGB_HEIGHT=13]="RGB_HEIGHT",ae[ae.COMPOSITE=50]="COMPOSITE"}(Si||(Si={})),function(ae){ae[ae.ABSOLUTE_NORMAL_FILTERING_MODE=1]="ABSOLUTE_NORMAL_FILTERING_MODE",ae[ae.LESS_EQUAL_NORMAL_FILTERING_MODE=2]="LESS_EQUAL_NORMAL_FILTERING_MODE",ae[ae.GREATER_NORMAL_FILTERING_MODE=3]="GREATER_NORMAL_FILTERING_MODE"}(Qs||(Qs={})),function(ae){ae[ae.CHECKBOARD=1]="CHECKBOARD",ae[ae.STRIPES=2]="STRIPES"}(Mr||(Mr={}));const qa=new _e.Color(0,0,0),qf=new _e.Vector4(1,0,0,1);function jf(ae){return parseInt(ae.charAt(ae.length-1),10)}function na(ae,V){const W=ae.name,re=V.name;return W.length!==re.length?W.length-re.length:W<re?-1:W>re?1:0}function eo(ae){if(200!==ae.status)throw Error("Response error");return ae}function Jl(ae){if(!ae||0===ae.byteLength)throw Error("Empty buffer");return ae}const td={0:new _e.Vector4(.5,.5,.5,1),1:new _e.Vector4(.5,.5,.5,1),2:new _e.Vector4(.63,.32,.18,1),3:new _e.Vector4(0,1,0,1),4:new _e.Vector4(0,.8,0,1),5:new _e.Vector4(0,.6,0,1),6:new _e.Vector4(1,.66,0,1),7:new _e.Vector4(1,0,1,1),8:new _e.Vector4(1,0,0,1),9:new _e.Vector4(0,0,1,1),12:new _e.Vector4(1,1,0,1),DEFAULT:new _e.Vector4(.3,.6,.6,.5)},Du=[[0,new _e.Color(0,0,0)],[1,new _e.Color(1,1,1)]],lg=[[0,new _e.Color(.077,.042,.206)],[.1,new _e.Color(.225,.036,.388)],[.2,new _e.Color(.373,.074,.432)],[.3,new _e.Color(.522,.128,.42)],[.4,new _e.Color(.665,.182,.37)],[.5,new _e.Color(.797,.255,.287)],[.6,new _e.Color(.902,.364,.184)],[.7,new _e.Color(.969,.516,.063)],[.8,new _e.Color(.988,.683,.072)],[.9,new _e.Color(.961,.859,.298)],[1,new _e.Color(.988,.998,.645)]],ja=[[0,new _e.Color(.241,.015,.61)],[.1,new _e.Color(.387,.001,.654)],[.2,new _e.Color(.524,.025,.653)],[.3,new _e.Color(.651,.125,.596)],[.4,new _e.Color(.752,.227,.513)],[.5,new _e.Color(.837,.329,.431)],[.6,new _e.Color(.907,.435,.353)],[.7,new _e.Color(.963,.554,.272)],[.8,new _e.Color(.992,.681,.195)],[.9,new _e.Color(.987,.822,.144)],[1,new _e.Color(.94,.975,.131)]],cg=[[0,new _e.Color(.278,0,.714)],[1/6,new _e.Color(0,0,1)],[2/6,new _e.Color(0,1,1)],[.5,new _e.Color(0,1,0)],[4/6,new _e.Color(1,1,0)],[5/6,new _e.Color(1,.64,0)],[1,new _e.Color(1,0,0)]],Lc=[[0,new _e.Color(.3686,.3098,.6353)],[.1,new _e.Color(.1961,.5333,.7412)],[.2,new _e.Color(.4,.7608,.6471)],[.3,new _e.Color(.6706,.8667,.6431)],[.4,new _e.Color(.902,.9608,.5961)],[.5,new _e.Color(1,1,.749)],[.6,new _e.Color(.9961,.8784,.5451)],[.7,new _e.Color(.9922,.6824,.3804)],[.8,new _e.Color(.9569,.4275,.2627)],[.9,new _e.Color(.8353,.2431,.3098)],[1,new _e.Color(.6196,.0039,.2588)]],Fc=[[0,new _e.Color(.267,.005,.329)],[.1,new _e.Color(.283,.141,.458)],[.2,new _e.Color(.254,.265,.53)],[.3,new _e.Color(.207,.372,.553)],[.4,new _e.Color(.164,.471,.558)],[.5,new _e.Color(.128,.567,.551)],[.6,new _e.Color(.135,.659,.518)],[.7,new _e.Color(.267,.749,.441)],[.8,new _e.Color(.478,.821,.318)],[.9,new _e.Color(.741,.873,.15)],[1,new _e.Color(.993,.906,.144)]],Xf=[[0,new _e.Color(.1647,.2824,.3451)],[.1,new _e.Color(.1338,.3555,.4227)],[.2,new _e.Color(.061,.4319,.4864)],[.3,new _e.Color(0,.5099,.5319)],[.4,new _e.Color(0,.5881,.5569)],[.5,new _e.Color(.137,.665,.5614)],[.6,new _e.Color(.2906,.7395,.5477)],[.7,new _e.Color(.4453,.8099,.5201)],[.8,new _e.Color(.6102,.8748,.485)],[.9,new _e.Color(.7883,.9323,.4514)],[1,new _e.Color(.9804,.9804,.4314)]];function Ru(ae,V,W){const re=ae*V,pe=new Uint8Array(4*re),He=Math.floor(255*W.r),Ze=Math.floor(255*W.g),jt=Math.floor(255*W.b);for(let At=0;At<re;At++)pe[3*At]=He,pe[3*At+1]=Ze,pe[3*At+2]=jt;const gn=new _e.DataTexture(pe,ae,V,_e.RGBAFormat);return gn.needsUpdate=!0,gn.magFilter=_e.NearestFilter,gn}function nd(ae){const V=document.createElement("canvas");V.width=64,V.height=64;const W=V.getContext("2d");W.rect(0,0,64,64);const re=W.createLinearGradient(0,0,64,64);for(let He=0;He<ae.length;He++){const Ze=ae[He];re.addColorStop(Ze[0],"#"+Ze[1].getHexString())}W.fillStyle=re,W.fill();const pe=new _e.CanvasTexture(V);return pe.needsUpdate=!0,pe.minFilter=_e.LinearFilter,pe}function Nc(ae){const V=new Uint8Array(262144);for(let re=0;re<256;re++)for(let pe=0;pe<256;pe++){const He=re+256*pe;let Ze;Ze=ae[re]?ae[re]:ae[re%32]?ae[re%32]:ae.DEFAULT,V[4*He+0]=255*Ze.x,V[4*He+1]=255*Ze.y,V[4*He+2]=255*Ze.z,V[4*He+3]=255*Ze.w}const W=new _e.DataTexture(V,256,256,_e.RGBAFormat);return W.magFilter=_e.NearestFilter,W.needsUpdate=!0,W}var $t=function(ae,V,W,re){var pe,He=arguments.length,Ze=He<3?V:null===re?re=Object.getOwnPropertyDescriptor(V,W):re;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Ze=Reflect.decorate(ae,V,W,re);else for(var jt=ae.length-1;jt>=0;jt--)(pe=ae[jt])&&(Ze=(He<3?pe(Ze):He>3?pe(V,W,Ze):pe(V,W))||Ze);return He>3&&Ze&&Object.defineProperty(V,W,Ze),Ze};const ug={[mi.OCTREE]:"tree_type_octree",[mi.KDTREE]:"tree_type_kdtree"},id={[tn.FIXED]:"fixed_point_size",[tn.ATTENUATED]:"attenuated_point_size",[tn.ADAPTIVE]:"adaptive_point_size"},pr={[tr.ATTENUATED]:"attenuated_opacity",[tr.FIXED]:"fixed_opacity"},$f={[An.SQUARE]:"square_point_shape",[An.CIRCLE]:"circle_point_shape",[An.PARABOLOID]:"paraboloid_point_shape"},hg={[Si.RGB]:"color_type_rgb",[Si.COLOR]:"color_type_color",[Si.DEPTH]:"color_type_depth",[Si.HEIGHT]:"color_type_height",[Si.INTENSITY]:"color_type_intensity",[Si.INTENSITY_GRADIENT]:"color_type_intensity_gradient",[Si.LOD]:"color_type_lod",[Si.POINT_INDEX]:"color_type_point_index",[Si.CLASSIFICATION]:"color_type_classification",[Si.RETURN_NUMBER]:"color_type_return_number",[Si.SOURCE]:"color_type_source",[Si.NORMAL]:"color_type_normal",[Si.PHONG]:"color_type_phong",[Si.RGB_HEIGHT]:"color_type_rgb_height",[Si.COMPOSITE]:"color_type_composite"},dg={[fn.DISABLED]:"clip_disabled",[fn.CLIP_OUTSIDE]:"clip_outside",[fn.HIGHLIGHT_INSIDE]:"clip_highlight_inside",[fn.CLIP_HORIZONTALLY]:"clip_horizontally",[fn.CLIP_VERTICALLY]:"clip_vertically"};class Vt extends _e.RawShaderMaterial{constructor(V={}){super(),this.useDrawingBufferSize=!1,this.lights=!1,this.fog=!1,this.numClipBoxes=0,this.clipBoxes=[],this.visibleNodeTextureOffsets=new Map,this._gradient=Lc,this.gradientTexture=nd(this._gradient),this._classification=td,this.classificationTexture=Nc(this._classification),this.uniforms={bbSize:zt("fv",[0,0,0]),blendDepthSupplement:zt("f",0),blendHardness:zt("f",2),classificationLUT:zt("t",this.classificationTexture||new _e.Texture),clipBoxCount:zt("f",0),clipBoxes:zt("Matrix4fv",[]),clipExtent:zt("fv",[0,0,1,1]),depthMap:zt("t",null),diffuse:zt("fv",[1,1,1]),fov:zt("f",1),gradient:zt("t",this.gradientTexture||new _e.Texture),heightMax:zt("f",1),heightMin:zt("f",0),intensityBrightness:zt("f",0),intensityContrast:zt("f",0),intensityGamma:zt("f",1),intensityRange:zt("fv",[0,65e3]),isLeafNode:zt("b",0),level:zt("f",0),maxSize:zt("f",50),minSize:zt("f",2),octreeSize:zt("f",0),opacity:zt("f",1),pcIndex:zt("f",0),rgbBrightness:zt("f",0),rgbContrast:zt("f",0),rgbGamma:zt("f",1),screenHeight:zt("f",1),screenWidth:zt("f",1),size:zt("f",1),spacing:zt("f",1),toModel:zt("Matrix4f",[]),transition:zt("f",.5),uColor:zt("c",new _e.Color(16777215)),visibleNodes:zt("t",this.visibleNodesTexture||new _e.Texture),vnStart:zt("f",0),wClassification:zt("f",0),wElevation:zt("f",0),wIntensity:zt("f",0),wReturnNumber:zt("f",0),wRGB:zt("f",1),wSourceID:zt("f",0),opacityAttenuation:zt("f",1),filterByNormalThreshold:zt("f",0),highlightedPointCoordinate:zt("fv",new _e.Vector3),highlightedPointColor:zt("fv",qf.clone()),enablePointHighlighting:zt("b",!0),highlightedPointScale:zt("f",2),backgroundMap:zt("t",null),normalFilteringMode:zt("i",Qs.ABSOLUTE_NORMAL_FILTERING_MODE),pointCloudID:zt("f",2),pointCloudMixingMode:zt("i",Mr.CHECKBOARD),stripeDistanceX:zt("f",5),stripeDistanceY:zt("f",5),stripeDivisorX:zt("f",2),stripeDivisorY:zt("f",2),pointCloudMixAngle:zt("f",31)},this.useClipBox=!1,this.weighted=!1,this.pointColorType=Si.RGB,this.pointSizeType=tn.ADAPTIVE,this.clipMode=fn.DISABLED,this.useEDL=!1,this.shape=An.SQUARE,this.treeType=mi.OCTREE,this.pointOpacityType=tr.FIXED,this.useFilterByNormal=!1,this.useTextureBlending=!1,this.usePointCloudMixing=!1,this.highlightPoint=!1,this.attributes={position:{type:"fv",value:[]},color:{type:"fv",value:[]},normal:{type:"fv",value:[]},intensity:{type:"f",value:[]},classification:{type:"f",value:[]},returnNumber:{type:"f",value:[]},numberOfReturns:{type:"f",value:[]},pointSourceID:{type:"f",value:[]},indices:{type:"fv",value:[]}};const W=this.visibleNodesTexture=Ru(2048,1,new _e.Color(16777215));W.minFilter=_e.NearestFilter,W.magFilter=_e.NearestFilter,this.setUniform("visibleNodes",W),this.treeType=Oc(V.treeType,mi.OCTREE),this.size=Oc(V.size,1),this.minSize=Oc(V.minSize,2),this.maxSize=Oc(V.maxSize,50),this.classification=td,this.defaultAttributeValues.normal=[0,0,0],this.defaultAttributeValues.classification=[0,0,0],this.defaultAttributeValues.indices=[0,0,0,0],this.vertexColors=!0,this.updateShaderSource()}dispose(){super.dispose(),this.gradientTexture&&(this.gradientTexture.dispose(),this.gradientTexture=void 0),this.visibleNodesTexture&&(this.visibleNodesTexture.dispose(),this.visibleNodesTexture=void 0),this.clearVisibleNodeTextureOffsets(),this.classificationTexture&&(this.classificationTexture.dispose(),this.classificationTexture=void 0),this.depthMap&&(this.depthMap.dispose(),this.depthMap=void 0),this.backgroundMap&&(this.backgroundMap.dispose(),this.backgroundMap=void 0)}clearVisibleNodeTextureOffsets(){this.visibleNodeTextureOffsets.clear()}updateShaderSource(){this.vertexShader=this.applyDefines(Et(4).default),this.fragmentShader=this.applyDefines(Et(5).default),1===this.opacity?(this.blending=_e.NoBlending,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=_e.LessEqualDepth):this.opacity<1&&!this.useEDL&&(this.blending=_e.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0),this.weighted&&(this.blending=_e.AdditiveBlending,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.depthFunc=_e.LessEqualDepth),this.needsUpdate=!0}applyDefines(V){const W=[];function re(pe){pe&&W.push("#define "+pe)}return re(ug[this.treeType]),re(id[this.pointSizeType]),re($f[this.shape]),re(hg[this.pointColorType]),re(dg[this.clipMode]),re(pr[this.pointOpacityType]),1===this.rgbGamma&&0===this.rgbBrightness&&0===this.rgbContrast||re("use_rgb_gamma_contrast_brightness"),this.useFilterByNormal&&re("use_filter_by_normal"),this.useEDL&&re("use_edl"),this.weighted&&re("weighted_splats"),this.numClipBoxes>0&&re("use_clip_box"),this.highlightPoint&&re("highlight_point"),this.useTextureBlending&&re("use_texture_blending"),this.usePointCloudMixing&&re("use_point_cloud_mixing"),re("MAX_POINT_LIGHTS 0"),re("MAX_DIR_LIGHTS 0"),W.push(V),W.join("\n")}setPointCloudMixingMode(V){this.pointCloudMixingMode=V}getPointCloudMixingMode(){return this.pointCloudMixingMode===Mr.STRIPES?Mr.STRIPES:Mr.CHECKBOARD}setClipBoxes(V){if(!V)return;this.clipBoxes=V;const W=this.numClipBoxes!==V.length&&(0===V.length||0===this.numClipBoxes);this.numClipBoxes=V.length,this.setUniform("clipBoxCount",this.numClipBoxes),W&&this.updateShaderSource();const re=16*this.numClipBoxes,pe=new Float32Array(re);for(let He=0;He<this.numClipBoxes;He++)pe.set(V[He].inverse.elements,16*He);for(let He=0;He<re;He++)isNaN(pe[He])&&(pe[He]=1/0);this.setUniform("clipBoxes",pe)}get gradient(){return this._gradient}set gradient(V){this._gradient!==V&&(this._gradient=V,this.gradientTexture=nd(this._gradient),this.setUniform("gradient",this.gradientTexture))}get classification(){return this._classification}set classification(V){const W={};for(const pe of Object.keys(V))W[pe]=V[pe].clone();let re=!1;if(void 0===this._classification)re=!1;else{re=Object.keys(W).length===Object.keys(this._classification).length;for(const pe of Object.keys(W))re=re&&void 0!==this._classification[pe],re=re&&W[pe].equals(this._classification[pe])}re||(this._classification=W,this.recomputeClassification())}recomputeClassification(){this.classificationTexture=Nc(this._classification),this.setUniform("classificationLUT",this.classificationTexture)}get elevationRange(){return[this.heightMin,this.heightMax]}set elevationRange(V){this.heightMin=V[0],this.heightMax=V[1]}getUniform(V){return void 0===this.uniforms?void 0:this.uniforms[V].value}setUniform(V,W){if(void 0===this.uniforms)return;const re=this.uniforms[V];"c"===re.type?re.value.copy(W):W!==re.value&&(re.value=W)}updateMaterial(V,W,re,pe){const He=pe.getPixelRatio();this.fov="PerspectiveCamera"===re.type?re.fov*(Math.PI/180):Math.PI/2;const Ze=pe.getRenderTarget();null!==Ze?(this.screenWidth=Ze.width,this.screenHeight=Ze.height):(this.screenWidth=pe.domElement.clientWidth*He,this.screenHeight=pe.domElement.clientHeight*He),this.useDrawingBufferSize&&(pe.getDrawingBufferSize(Vt.helperVec2),this.screenWidth=Vt.helperVec2.width,this.screenHeight=Vt.helperVec2.height);const jt=Math.max(V.scale.x,V.scale.y,V.scale.z);this.spacing=V.pcoGeometry.spacing*jt,this.octreeSize=V.pcoGeometry.boundingBox.getSize(Vt.helperVec3).x,this.pointSizeType!==tn.ADAPTIVE&&this.pointColorType!==Si.LOD||this.updateVisibilityTextureData(W)}updateVisibilityTextureData(V){V.sort(na);const W=new Uint8Array(4*V.length),re=new Array(V.length).fill(1/0);this.visibleNodeTextureOffsets.clear();for(let He=0;He<V.length;He++){const Ze=V[He];if(this.visibleNodeTextureOffsets.set(Ze.name,He),He>0){const jt=Ze.name.slice(0,-1),gn=this.visibleNodeTextureOffsets.get(jt);re[gn]=Math.min(re[gn],He-gn);const Zt=4*gn;W[Zt]=W[Zt]|1<<Ze.index,W[Zt+1]=re[gn]>>8,W[Zt+2]=re[gn]%256}W[4*He+3]=Ze.name.length}const pe=this.visibleNodesTexture;pe&&(pe.image.data.set(W),pe.needsUpdate=!0)}static makeOnBeforeRender(V,W,re){return(pe,He,Ze,jt,gn)=>{const At=gn,Zt=At.uniforms;Zt.level.value=W.level,Zt.isLeafNode.value=W.isLeafNode;const Ei=At.visibleNodeTextureOffsets.get(W.name);void 0!==Ei&&(Zt.vnStart.value=Ei),Zt.pcIndex.value=void 0!==re?re:V.visibleNodes.indexOf(W),gn.uniformsNeedUpdate=!0}}}function zt(ae,V){return{type:ae,value:V}}function Oc(ae,V){return void 0===ae?V:ae}function Rn(ae,V=!1){return(W,re)=>{Object.defineProperty(W,re,{get(){return this.getUniform(ae)},set(pe){pe!==this.getUniform(ae)&&(this.setUniform(ae,pe),V&&this.updateShaderSource())}})}}function gi(){return(ae,V)=>{const W="_"+V.toString();Object.defineProperty(ae,V,{get(){return this[W]},set(re){re!==this[W]&&(this[W]=re,this.updateShaderSource())}})}}var Mn;Vt.helperVec3=new _e.Vector3,Vt.helperVec2=new _e.Vector2,$t([Rn("bbSize")],Vt.prototype,"bbSize",void 0),$t([Rn("clipExtent")],Vt.prototype,"clipExtent",void 0),$t([Rn("depthMap")],Vt.prototype,"depthMap",void 0),$t([Rn("fov")],Vt.prototype,"fov",void 0),$t([Rn("heightMax")],Vt.prototype,"heightMax",void 0),$t([Rn("heightMin")],Vt.prototype,"heightMin",void 0),$t([Rn("intensityBrightness")],Vt.prototype,"intensityBrightness",void 0),$t([Rn("intensityContrast")],Vt.prototype,"intensityContrast",void 0),$t([Rn("intensityGamma")],Vt.prototype,"intensityGamma",void 0),$t([Rn("intensityRange")],Vt.prototype,"intensityRange",void 0),$t([Rn("maxSize")],Vt.prototype,"maxSize",void 0),$t([Rn("minSize")],Vt.prototype,"minSize",void 0),$t([Rn("octreeSize")],Vt.prototype,"octreeSize",void 0),$t([Rn("opacity",!0)],Vt.prototype,"opacity",void 0),$t([Rn("rgbBrightness",!0)],Vt.prototype,"rgbBrightness",void 0),$t([Rn("rgbContrast",!0)],Vt.prototype,"rgbContrast",void 0),$t([Rn("rgbGamma",!0)],Vt.prototype,"rgbGamma",void 0),$t([Rn("screenHeight")],Vt.prototype,"screenHeight",void 0),$t([Rn("screenWidth")],Vt.prototype,"screenWidth",void 0),$t([Rn("size")],Vt.prototype,"size",void 0),$t([Rn("spacing")],Vt.prototype,"spacing",void 0),$t([Rn("transition")],Vt.prototype,"transition",void 0),$t([Rn("uColor")],Vt.prototype,"color",void 0),$t([Rn("wClassification")],Vt.prototype,"weightClassification",void 0),$t([Rn("wElevation")],Vt.prototype,"weightElevation",void 0),$t([Rn("wIntensity")],Vt.prototype,"weightIntensity",void 0),$t([Rn("wReturnNumber")],Vt.prototype,"weightReturnNumber",void 0),$t([Rn("wRGB")],Vt.prototype,"weightRGB",void 0),$t([Rn("wSourceID")],Vt.prototype,"weightSourceID",void 0),$t([Rn("opacityAttenuation")],Vt.prototype,"opacityAttenuation",void 0),$t([Rn("filterByNormalThreshold")],Vt.prototype,"filterByNormalThreshold",void 0),$t([Rn("highlightedPointCoordinate")],Vt.prototype,"highlightedPointCoordinate",void 0),$t([Rn("highlightedPointColor")],Vt.prototype,"highlightedPointColor",void 0),$t([Rn("enablePointHighlighting")],Vt.prototype,"enablePointHighlighting",void 0),$t([Rn("highlightedPointScale")],Vt.prototype,"highlightedPointScale",void 0),$t([Rn("normalFilteringMode")],Vt.prototype,"normalFilteringMode",void 0),$t([Rn("backgroundMap")],Vt.prototype,"backgroundMap",void 0),$t([Rn("pointCloudID")],Vt.prototype,"pointCloudID",void 0),$t([Rn("pointCloudMixingMode")],Vt.prototype,"pointCloudMixingMode",void 0),$t([Rn("stripeDistanceX")],Vt.prototype,"stripeDistanceX",void 0),$t([Rn("stripeDistanceY")],Vt.prototype,"stripeDistanceY",void 0),$t([Rn("stripeDivisorX")],Vt.prototype,"stripeDivisorX",void 0),$t([Rn("stripeDivisorY")],Vt.prototype,"stripeDivisorY",void 0),$t([Rn("pointCloudMixAngle")],Vt.prototype,"pointCloudMixAngle",void 0),$t([gi()],Vt.prototype,"useClipBox",void 0),$t([gi()],Vt.prototype,"weighted",void 0),$t([gi()],Vt.prototype,"pointColorType",void 0),$t([gi()],Vt.prototype,"pointSizeType",void 0),$t([gi()],Vt.prototype,"clipMode",void 0),$t([gi()],Vt.prototype,"useEDL",void 0),$t([gi()],Vt.prototype,"shape",void 0),$t([gi()],Vt.prototype,"treeType",void 0),$t([gi()],Vt.prototype,"pointOpacityType",void 0),$t([gi()],Vt.prototype,"useFilterByNormal",void 0),$t([gi()],Vt.prototype,"useTextureBlending",void 0),$t([gi()],Vt.prototype,"usePointCloudMixing",void 0),$t([gi()],Vt.prototype,"highlightPoint",void 0),function(ae){ae[ae.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",ae[ae.COLOR_PACKED=1]="COLOR_PACKED",ae[ae.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",ae[ae.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",ae[ae.NORMAL_FLOATS=4]="NORMAL_FLOATS",ae[ae.FILLER=5]="FILLER",ae[ae.INTENSITY=6]="INTENSITY",ae[ae.CLASSIFICATION=7]="CLASSIFICATION",ae[ae.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",ae[ae.NORMAL_OCT16=9]="NORMAL_OCT16",ae[ae.NORMAL=10]="NORMAL"}(Mn||(Mn={}));const zo={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};function Pn(ae,V,W){return{name:ae,type:V,numElements:W,byteSize:W*V.size}}const Pu=Pn(Mn.COLOR_PACKED,zo.DATA_TYPE_INT8,4),Iu={POSITION_CARTESIAN:Pn(Mn.POSITION_CARTESIAN,zo.DATA_TYPE_FLOAT,3),RGBA_PACKED:Pu,COLOR_PACKED:Pu,RGB_PACKED:Pn(Mn.COLOR_PACKED,zo.DATA_TYPE_INT8,3),NORMAL_FLOATS:Pn(Mn.NORMAL_FLOATS,zo.DATA_TYPE_FLOAT,3),FILLER_1B:Pn(Mn.FILLER,zo.DATA_TYPE_UINT8,1),INTENSITY:Pn(Mn.INTENSITY,zo.DATA_TYPE_UINT16,1),CLASSIFICATION:Pn(Mn.CLASSIFICATION,zo.DATA_TYPE_UINT8,1),NORMAL_SPHEREMAPPED:Pn(Mn.NORMAL_SPHEREMAPPED,zo.DATA_TYPE_UINT8,2),NORMAL_OCT16:Pn(Mn.NORMAL_OCT16,zo.DATA_TYPE_UINT8,2),NORMAL:Pn(Mn.NORMAL,zo.DATA_TYPE_FLOAT,3)};class Lu{constructor(V=[]){this.attributes=[],this.byteSize=0,this.size=0;for(let W=0;W<V.length;W++){const pe=Iu[V[W]];this.attributes.push(pe),this.byteSize+=pe.byteSize,this.size++}}add(V){this.attributes.push(V),this.byteSize+=V.byteSize,this.size++}hasColors(){return void 0!==this.attributes.find(q_)}hasNormals(){return void 0!==this.attributes.find(Xa)}}function q_({name:ae}){return ae===Mn.COLOR_PACKED}function Xa({name:ae}){return ae===Mn.NORMAL_SPHEREMAPPED||ae===Mn.NORMAL_FLOATS||ae===Mn.NORMAL||ae===Mn.NORMAL_OCT16}function fg(ae,V){return(new _e.Box3).setFromPoints([new _e.Vector3(ae.min.x,ae.min.y,ae.min.z).applyMatrix4(V),new _e.Vector3(ae.min.x,ae.min.y,ae.min.z).applyMatrix4(V),new _e.Vector3(ae.max.x,ae.min.y,ae.min.z).applyMatrix4(V),new _e.Vector3(ae.min.x,ae.max.y,ae.min.z).applyMatrix4(V),new _e.Vector3(ae.min.x,ae.min.y,ae.max.z).applyMatrix4(V),new _e.Vector3(ae.min.x,ae.max.y,ae.max.z).applyMatrix4(V),new _e.Vector3(ae.max.x,ae.max.y,ae.min.z).applyMatrix4(V),new _e.Vector3(ae.max.x,ae.min.y,ae.max.z).applyMatrix4(V),new _e.Vector3(ae.max.x,ae.max.y,ae.max.z).applyMatrix4(V)])}function pg(ae,V){const W=ae.min.clone(),re=ae.max.clone(),pe=(new _e.Vector3).subVectors(re,W);return(1&V)>0?W.z+=pe.z/2:re.z-=pe.z/2,(2&V)>0?W.y+=pe.y/2:re.y-=pe.y/2,(4&V)>0?W.x+=pe.x/2:re.x-=pe.x/2,new _e.Box3(W,re)}let rd=(()=>{class ae extends _e.EventDispatcher{constructor(W,re,pe){super(),this.id=ae.idCount++,this.level=0,this.spacing=0,this.hasChildren=!1,this.children=[null,null,null,null,null,null,null,null],this.mean=new _e.Vector3,this.numPoints=0,this.loaded=!1,this.loading=!1,this.failed=!1,this.parent=null,this.oneTimeDisposeHandlers=[],this.isLeafNode=!0,this.isTreeNode=!1,this.isGeometryNode=!0,this.name=W,this.index=jf(W),this.pcoGeometry=re,this.boundingBox=pe,this.tightBoundingBox=pe.clone(),this.boundingSphere=pe.getBoundingSphere(new _e.Sphere)}dispose(){this.geometry&&this.parent&&(this.geometry.dispose(),this.geometry=void 0,this.loaded=!1,this.oneTimeDisposeHandlers.forEach(W=>W()),this.oneTimeDisposeHandlers=[])}getUrl(){const W=this.pcoGeometry,re=W.loader.version,pe=[W.octreeDir];return W.loader&&re.equalOrHigher("1.5")?(pe.push(this.getHierarchyBaseUrl()),pe.push(this.name)):(re.equalOrHigher("1.4")||re.upTo("1.3"))&&pe.push(this.name),pe.join("/")}getHierarchyUrl(){return`${this.pcoGeometry.octreeDir}/${this.getHierarchyBaseUrl()}/${this.name}.hrc`}addChild(W){this.children[W.index]=W,this.isLeafNode=!1,W.parent=this}traverse(W,re=!0){const pe=re?[this]:[];let He;for(;void 0!==(He=pe.pop());){W(He);for(const Ze of He.children)null!==Ze&&pe.push(Ze)}}load(){if(!this.canLoad())return Promise.resolve();let W;return this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.needsUpdate=!0,W=this.pcoGeometry.loader.version.equalOrHigher("1.5")&&this.level%this.pcoGeometry.hierarchyStepSize==0&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints(),W.catch(re=>{throw this.loading=!1,this.failed=!0,this.pcoGeometry.numNodesLoading--,re})}canLoad(){return!this.loading&&!this.loaded&&!this.pcoGeometry.disposed&&!this.pcoGeometry.loader.disposed&&this.pcoGeometry.numNodesLoading<this.pcoGeometry.maxNumNodesLoading}loadPoints(){return this.pcoGeometry.needsUpdate=!0,this.pcoGeometry.loader.load(this)}loadHierachyThenPoints(){return this.level%this.pcoGeometry.hierarchyStepSize!=0?Promise.resolve():Promise.resolve(this.pcoGeometry.loader.getUrl(this.getHierarchyUrl())).then(W=>this.pcoGeometry.xhrRequest(W,{mode:"cors"})).then(W=>eo(W)).then(W=>W.arrayBuffer()).then(W=>Jl(W)).then(W=>this.loadHierarchy(this,W))}getHierarchyBaseUrl(){const W=this.pcoGeometry.hierarchyStepSize,re=this.name.substr(1),pe=Math.floor(re.length/W);let He="r/";for(let Ze=0;Ze<pe;Ze++)He+=re.substr(Ze*W,W)+"/";return He.slice(0,-1)}loadHierarchy(W,re){const pe=new DataView(re),He=this.getNodeData(W.name,0,pe);W.numPoints=He.numPoints;const Ze=[He],jt=[];let gn=5;for(;Ze.length>0;){const Zt=Ze.shift();let Ei=1;for(let vn=0;vn<8&&gn+1<re.byteLength;vn++){if(0!=(Zt.children&Ei)){const mr=this.getNodeData(Zt.name+vn,gn,pe);jt.push(mr),Ze.push(mr),gn+=5}Ei*=2}}W.pcoGeometry.needsUpdate=!0;const At=new Map;At.set(W.name,W),jt.forEach(Zt=>this.addNode(Zt,W.pcoGeometry,At)),W.loadPoints()}getNodeData(W,re,pe){return{children:pe.getUint8(re),numPoints:pe.getUint32(re+1,!0),name:W}}addNode({name:W,numPoints:re,children:pe},He,Ze){const jt=jf(W),gn=W.substring(0,W.length-1),At=Ze.get(gn),Zt=W.length-1,Ei=pg(At.boundingBox,jt),vn=new ae(W,He,Ei);vn.level=Zt,vn.numPoints=re,vn.hasChildren=pe>0,vn.spacing=He.spacing/Math.pow(2,Zt),At.addChild(vn),Ze.set(W,vn)}}return ae.idCount=0,ae})();class mg{constructor(V,W,re,pe,He){this.loader=V,this.boundingBox=W,this.tightBoundingBox=re,this.offset=pe,this.xhrRequest=He,this.disposed=!1,this.needsUpdate=!0,this.octreeDir="",this.hierarchyStepSize=-1,this.nodes={},this.numNodesLoading=0,this.maxNumNodesLoading=3,this.spacing=0,this.pointAttributes=new Lu([]),this.projection=null,this.url=null}dispose(){this.loader.dispose(),this.root.traverse(V=>V.dispose()),this.disposed=!0}addNodeLoadedCallback(V){this.loader.callbacks.push(V)}clearNodeLoadedCallbacks(){this.loader.callbacks=[]}}class sd extends _e.EventDispatcher{constructor(V,W){super(),this.pcIndex=void 0,this.boundingBoxNode=null,this.loaded=!0,this.isTreeNode=!0,this.isGeometryNode=!1,this.geometryNode=V,this.sceneNode=W,this.children=V.children.slice()}dispose(){this.geometryNode.dispose()}disposeSceneNode(){const V=this.sceneNode;if(V.geometry instanceof _e.BufferGeometry){const W=V.geometry.attributes;for(const re in W)"position"===re&&delete W[re].array,delete W[re];V.geometry.dispose(),V.geometry=void 0}}traverse(V,W){this.geometryNode.traverse(V,W)}get id(){return this.geometryNode.id}get name(){return this.geometryNode.name}get level(){return this.geometryNode.level}get isLeafNode(){return this.geometryNode.isLeafNode}get numPoints(){return this.geometryNode.numPoints}get index(){return this.geometryNode.index}get boundingSphere(){return this.geometryNode.boundingSphere}get boundingBox(){return this.geometryNode.boundingBox}get spacing(){return this.geometryNode.spacing}}function od(ae,V,W){return Math.min(Math.max(V,ae),W)}class Bi{dispose(){this.pickState&&(this.pickState.material.dispose(),this.pickState.renderTarget.dispose())}pick(V,W,re,pe,He={}){if(0===pe.length)return null;const Ze=this.pickState?this.pickState:this.pickState=Bi.getPickState(),jt=Ze.material,gn=V.getPixelRatio(),At=Math.ceil(V.domElement.clientWidth*gn),Zt=Math.ceil(V.domElement.clientHeight*gn);Bi.updatePickRenderTarget(this.pickState,At,Zt);const Ei=Bi.helperVec3;He.pixelPosition?Ei.copy(He.pixelPosition):(Ei.addVectors(W.position,re.direction).project(W),Ei.x=(Ei.x+1)*At*.5,Ei.y=(Ei.y+1)*Zt*.5);const vn=Math.floor((He.pickWindowSize||15)*gn),mr=(vn-1)/2,qi=Math.floor(od(Ei.x-mr,0,At)),Ui=Math.floor(od(Ei.y-mr,0,Zt));Bi.prepareRender(V,qi,Ui,vn,jt,Ze);const zn=Bi.render(V,W,jt,pe,re,Ze,He);jt.clearVisibleNodeTextureOffsets();const vs=Bi.readPixels(V,qi,Ui,vn),Sr=Bi.findHit(vs,vn);return Bi.getPickPoint(Sr,zn)}static prepareRender(V,W,re,pe,He,Ze){V.setScissor(W,re,pe,pe),V.setScissorTest(!0),V.state.buffers.depth.setTest(He.depthTest),V.state.buffers.depth.setMask(He.depthWrite),V.state.setBlending(_e.NoBlending),V.setRenderTarget(Ze.renderTarget),V.getClearColor(this.clearColor);const jt=V.getClearAlpha();V.setClearColor(qa,0),V.clear(!0,!0,!0),V.setClearColor(this.clearColor,jt)}static render(V,W,re,pe,He,Ze,jt){const gn=[];for(const At of pe){const Zt=Bi.nodesOnRay(At,He);Zt.length&&(Bi.updatePickMaterial(re,At.material,jt),re.updateMaterial(At,Zt,W,V),jt.onBeforePickRender&&jt.onBeforePickRender(re,Ze.renderTarget),Ze.scene.children=Bi.createTempNodes(At,Zt,re,gn.length),V.render(Ze.scene,W),Zt.forEach(Ei=>gn.push({node:Ei,octree:At})))}return gn}static nodesOnRay(V,W){const re=[],pe=W.clone();for(const He of V.visibleNodes){const Ze=Bi.helperSphere.copy(He.boundingSphere).applyMatrix4(V.matrixWorld);pe.intersectsSphere(Ze)&&re.push(He)}return re}static readPixels(V,W,re,pe){const He=new Uint8Array(4*pe*pe);return V.readRenderTargetPixels(V.getRenderTarget(),W,re,pe,pe,He),V.setScissorTest(!1),V.setRenderTarget(null),He}static createTempNodes(V,W,re,pe){const He=[];for(let Ze=0;Ze<W.length;Ze++){const jt=W[Ze],gn=jt.sceneNode,At=new _e.Points(gn.geometry,re);At.matrix=gn.matrix,At.matrixWorld=gn.matrixWorld,At.matrixAutoUpdate=!1,At.frustumCulled=!1;const Zt=pe+Ze+1;Zt>255&&console.error("More than 255 nodes for pick are not supported."),At.onBeforeRender=Vt.makeOnBeforeRender(V,jt,Zt),He.push(At)}return He}static updatePickMaterial(V,W,re){V.pointSizeType=W.pointSizeType,V.shape=W.shape,V.size=W.size,V.minSize=W.minSize,V.maxSize=W.maxSize,V.classification=W.classification,V.useFilterByNormal=W.useFilterByNormal,V.filterByNormalThreshold=W.filterByNormalThreshold,re.pickOutsideClipRegion?V.clipMode=fn.DISABLED:(V.clipMode=W.clipMode,V.setClipBoxes(W.clipMode===fn.CLIP_OUTSIDE?W.clipBoxes:[]))}static updatePickRenderTarget(V,W,re){V.renderTarget.width===W&&V.renderTarget.height===re||(V.renderTarget.dispose(),V.renderTarget=Bi.makePickRenderTarget(),V.renderTarget.setSize(W,re))}static makePickRenderTarget(){return new _e.WebGLRenderTarget(1,1,{minFilter:_e.LinearFilter,magFilter:_e.NearestFilter,format:_e.RGBAFormat})}static findHit(V,W){const re=new Uint32Array(V.buffer);let pe=Number.MAX_VALUE,He=null;for(let Ze=0;Ze<W;Ze++)for(let jt=0;jt<W;jt++){const gn=Ze+jt*W,At=Math.pow(Ze-(W-1)/2,2)+Math.pow(jt-(W-1)/2,2),Zt=V[4*gn+3];V[4*gn+3]=0;const Ei=re[gn];Zt>0&&At<pe&&(He={pIndex:Ei,pcIndex:Zt-1},pe=At)}return He}static getPickPoint(V,W){if(!V)return null;const re={},pe=W[V.pcIndex]&&W[V.pcIndex].node.sceneNode;if(!pe)return null;re.pointCloud=W[V.pcIndex].octree;const He=pe.geometry.attributes;for(const Ze in He){if(!He.hasOwnProperty(Ze))continue;const jt=He[Ze];if("position"===Ze)Bi.addPositionToPickPoint(re,V,jt,pe);else if("normal"===Ze)Bi.addNormalToPickPoint(re,V,jt,pe);else if("indices"!==Ze)if(1===jt.itemSize)re[Ze]=jt.array[V.pIndex];else{const gn=[];for(let At=0;At<jt.itemSize;At++)gn.push(jt.array[jt.itemSize*V.pIndex+At]);re[Ze]=gn}}return re}static addPositionToPickPoint(V,W,re,pe){V.position=(new _e.Vector3).fromBufferAttribute(re,W.pIndex).applyMatrix4(pe.matrixWorld)}static addNormalToPickPoint(V,W,re,pe){const He=(new _e.Vector3).fromBufferAttribute(re,W.pIndex),Ze=new _e.Vector4(He.x,He.y,He.z,0).applyMatrix4(pe.matrixWorld);He.set(Ze.x,Ze.y,Ze.z),V.normal=He}static getPickState(){const V=new _e.Scene;V.autoUpdate=!1;const W=new Vt;return W.pointColorType=Si.POINT_INDEX,{renderTarget:Bi.makePickRenderTarget(),material:W,scene:V}}}Bi.helperVec3=new _e.Vector3,Bi.helperSphere=new _e.Sphere,Bi.clearColor=new _e.Color;class $a extends _e.Object3D{constructor(){super(...arguments),this.root=null}initialized(){return null!==this.root}}class Fu extends $a{constructor(V,W,re){super(),this.disposed=!1,this.level=0,this.maxLevel=1/0,this.minNodePixelSize=50,this.root=null,this.boundingBoxNodes=[],this.visibleNodes=[],this.visibleGeometry=[],this.numVisiblePoints=0,this.showBoundingBox=!1,this.visibleBounds=new _e.Box3,this.name="",this.potree=V,this.root=W.root,this.pcoGeometry=W,this.boundingBox=W.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new _e.Sphere),this.position.copy(W.offset),this.updateMatrix(),this.material=re||new Vt,this.initMaterial(this.material)}initMaterial(V){this.updateMatrixWorld(!0);const{min:W,max:re}=fg(this.pcoGeometry.tightBoundingBox||this.getBoundingBoxWorld(),this.matrixWorld),pe=re.z-W.z;V.heightMin=W.z-.2*pe,V.heightMax=re.z+.2*pe}dispose(){this.root&&this.root.dispose(),this.pcoGeometry.root.traverse(V=>this.potree.lru.remove(V)),this.pcoGeometry.dispose(),this.material.dispose(),this.visibleNodes=[],this.visibleGeometry=[],this.picker&&(this.picker.dispose(),this.picker=void 0),this.disposed=!0}get pointSizeType(){return this.material.pointSizeType}set pointSizeType(V){this.material.pointSizeType=V}toTreeNode(V,W){const re=new _e.Points(V.geometry,this.material),pe=new sd(V,re);return re.name=V.name,re.position.copy(V.boundingBox.min),re.frustumCulled=!1,re.onBeforeRender=Vt.makeOnBeforeRender(this,pe),W?(W.sceneNode.add(re),W.children[V.index]=pe,V.oneTimeDisposeHandlers.push(()=>{pe.disposeSceneNode(),W.sceneNode.remove(pe.sceneNode),W.children[V.index]=V})):(this.root=pe,this.add(re)),pe}updateVisibleBounds(){const V=this.visibleBounds;V.min.set(1/0,1/0,1/0),V.max.set(-1/0,-1/0,-1/0);for(const W of this.visibleNodes)W.isLeafNode&&(V.expandByPoint(W.boundingBox.min),V.expandByPoint(W.boundingBox.max))}updateBoundingBoxes(){if(!this.showBoundingBox||!this.parent)return;let V=this.parent.getObjectByName("bbroot");V||(V=new _e.Object3D,V.name="bbroot",this.parent.add(V));const W=[];for(const re of this.visibleNodes)void 0!==re.boundingBoxNode&&re.isLeafNode&&W.push(re.boundingBoxNode);V.children=W}updateMatrixWorld(V){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==V||(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,V=!0)}hideDescendants(V){const W=[];for(re(V);W.length>0;){const pe=W.shift();pe.visible=!1,re(pe)}function re(pe){for(const He of pe.children)He.visible&&W.push(He)}}moveToOrigin(){this.position.set(0,0,0),this.position.set(0,0,0).sub(this.getBoundingBoxWorld().getCenter(new _e.Vector3))}moveToGroundPlane(){this.position.y+=-this.getBoundingBoxWorld().min.y}getBoundingBoxWorld(){return this.updateMatrixWorld(!0),fg(this.boundingBox,this.matrixWorld)}getVisibleExtent(){return this.visibleBounds.applyMatrix4(this.matrixWorld)}pick(V,W,re,pe={}){return this.picker=this.picker||new Bi,this.picker.pick(V,W,re,[this],pe)}get progress(){return 0===this.visibleGeometry.length?0:this.visibleNodes.length/this.visibleGeometry.length}}const Nr=document.createElement("canvas").getContext("webgl"),Nu={SHADER_INTERPOLATION:ho("EXT_frag_depth")&&_s(8),SHADER_SPLATS:ho("EXT_frag_depth")&&ho("OES_texture_float")&&_s(8),SHADER_EDL:ho("OES_texture_float")&&_s(8),precision:function(){if(null===Nr)return"";const ae=Nr.getShaderPrecisionFormat(Nr.VERTEX_SHADER,Nr.HIGH_FLOAT),V=Nr.getShaderPrecisionFormat(Nr.VERTEX_SHADER,Nr.MEDIUM_FLOAT),W=Nr.getShaderPrecisionFormat(Nr.FRAGMENT_SHADER,Nr.HIGH_FLOAT),re=Nr.getShaderPrecisionFormat(Nr.FRAGMENT_SHADER,Nr.MEDIUM_FLOAT);return ae&&W&&ae.precision>0&&W.precision>0?"highp":V&&re&&V.precision>0&&re.precision>0?"mediump":"lowp"}()};function ho(ae){return null!==Nr&&Boolean(Nr.getExtension(ae))}function _s(ae){return null!==Nr&&Nr.getParameter(Nr.MAX_VARYING_VECTORS)>=ae}class ad{constructor(){this.resolvers=[],this.promises=[]}enqueue(V){this.resolvers.length||this.add(),this.resolvers.shift()(V)}dequeue(){return this.promises.length||this.add(),this.promises.shift()}add(){this.promises.push(new Promise(V=>{this.resolvers.push(V)}))}}class zr{constructor(V,W){this.wrappedWorker=V,this.maxIdle=W,this.timeoutId=void 0,this.terminated=!1}get worker(){return this.wrappedWorker}get isTerminated(){return this.terminated}markIdle(){this.timeoutId=window.setTimeout(()=>{this.terminated=!0,this.wrappedWorker.terminate()},this.maxIdle)}markInUse(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}let Yf=(()=>{class ae{constructor(W,re){this.maxWorkers=W,this.workerType=re,this.pool=new ad,this.poolSize=0}getWorker(){return this.poolSize<this.maxWorkers?(this.poolSize++,Promise.resolve(new zr(new this.workerType,ae.POOL_MAX_IDLE))):this.pool.dequeue().then(W=>(W.markInUse(),W.isTerminated?(this.poolSize--,this.getWorker()):W))}releaseWorker(W){W.markIdle(),this.pool.enqueue(W)}}return ae.POOL_MAX_IDLE=7e3,ae})();class kc{constructor(V){this.versionMinor=0,this.version=V;const W=-1===V.indexOf(".")?V.length:V.indexOf(".");this.versionMajor=parseInt(V.substr(0,W),10),this.versionMinor=parseInt(V.substr(W+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}newerThan(V){const W=new kc(V);return this.versionMajor>W.versionMajor||this.versionMajor===W.versionMajor&&this.versionMinor>W.versionMinor}equalOrHigher(V){const W=new kc(V);return this.versionMajor>W.versionMajor||this.versionMajor===W.versionMajor&&this.versionMinor>=W.versionMinor}upTo(V){return!this.newerThan(V)}}class _a{constructor({getUrl:V=(Ze=>Promise.resolve(Ze)),version:W,boundingBox:re,scale:pe,xhrRequest:He}){this.disposed=!1,this.version="string"==typeof W?new kc(W):W,this.xhrRequest=He,this.getUrl=V,this.boundingBox=re,this.scale=pe,this.callbacks=[]}dispose(){this.disposed=!0}load(V){return V.loaded||this.disposed?Promise.resolve():Promise.resolve(this.getUrl(this.getNodeUrl(V))).then(W=>this.xhrRequest(W,{mode:"cors"})).then(W=>eo(W)).then(W=>W.arrayBuffer()).then(W=>Jl(W)).then(W=>new Promise(re=>this.parse(V,W,re)))}getNodeUrl(V){let W=V.getUrl();return this.version.equalOrHigher("1.4")&&(W+=".bin"),W}parse(V,W,re){this.disposed?re():_a.WORKER_POOL.getWorker().then(pe=>{const He=V.pcoGeometry.pointAttributes,Ze=W.byteLength/He.byteSize;this.version.upTo("1.5")&&(V.numPoints=Ze),pe.worker.onmessage=gn=>{if(this.disposed)return re(),void _a.WORKER_POOL.releaseWorker(pe);const At=gn.data,Zt=V.geometry=V.geometry||new _e.BufferGeometry;Zt.boundingBox=V.boundingBox,this.addBufferAttributes(Zt,At.attributeBuffers),this.addIndices(Zt,At.indices),this.addNormalAttribute(Zt,Ze),V.mean=(new _e.Vector3).fromArray(At.mean),V.tightBoundingBox=this.getTightBoundingBox(At.tightBoundingBox),V.loaded=!0,V.loading=!1,V.failed=!1,V.pcoGeometry.numNodesLoading--,V.pcoGeometry.needsUpdate=!0,this.callbacks.forEach(Ei=>Ei(V)),re(),_a.WORKER_POOL.releaseWorker(pe)};const jt={buffer:W,pointAttributes:He,version:this.version.version,min:V.boundingBox.min.toArray(),offset:V.pcoGeometry.offset.toArray(),scale:this.scale,spacing:V.spacing,hasChildren:V.hasChildren};pe.worker.postMessage(jt,[jt.buffer])})}getTightBoundingBox({min:V,max:W}){const re=new _e.Box3((new _e.Vector3).fromArray(V),(new _e.Vector3).fromArray(W));return re.max.sub(re.min),re.min.set(0,0,0),re}addBufferAttributes(V,W){Object.keys(W).forEach(re=>{const pe=W[re].buffer;this.isAttribute(re,Mn.POSITION_CARTESIAN)?V.setAttribute("position",new _e.BufferAttribute(new Float32Array(pe),3)):this.isAttribute(re,Mn.COLOR_PACKED)?V.setAttribute("color",new _e.BufferAttribute(new Uint8Array(pe),3,!0)):this.isAttribute(re,Mn.INTENSITY)?V.setAttribute("intensity",new _e.BufferAttribute(new Float32Array(pe),1)):this.isAttribute(re,Mn.CLASSIFICATION)?V.setAttribute("classification",new _e.BufferAttribute(new Uint8Array(pe),1)):(this.isAttribute(re,Mn.NORMAL_SPHEREMAPPED)||this.isAttribute(re,Mn.NORMAL_OCT16)||this.isAttribute(re,Mn.NORMAL))&&V.setAttribute("normal",new _e.BufferAttribute(new Float32Array(pe),3))})}addIndices(V,W){const re=new _e.Uint8BufferAttribute(W,4);re.normalized=!0,V.setAttribute("indices",re)}addNormalAttribute(V,W){if(!V.getAttribute("normal")){const re=new Float32Array(3*W);V.setAttribute("normal",new _e.BufferAttribute(new Float32Array(re),3))}}isAttribute(V,W){return parseInt(V,10)===W}}function Hr(ae){return{index:jf(ae),parentName:ae.substring(0,ae.length-1),level:ae.length-1}}function gg(ae){return null!=ae&&ae.isGeometryNode}function yg(ae){return null!=ae&&ae.isTreeNode}_a.WORKER_POOL=new Yf(32,Et(6));var Ya=Et(1);class _g extends _e.LineSegments{constructor(V,W=new _e.Color(16776960)){const re=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),pe=new Float32Array([V.min.x,V.min.y,V.min.z,V.max.x,V.min.y,V.min.z,V.max.x,V.min.y,V.max.z,V.min.x,V.min.y,V.max.z,V.min.x,V.max.y,V.min.z,V.max.x,V.max.y,V.min.z,V.max.x,V.max.y,V.max.z,V.min.x,V.max.y,V.max.z]),He=new _e.BufferGeometry;He.setIndex(new _e.BufferAttribute(re,1)),He.setAttribute("position",new _e.BufferAttribute(pe,3)),super(He,new _e.LineBasicMaterial({color:W}))}}class Ka{constructor(V){this.node=V,this.next=null,this.previous=null}}class Kf{constructor(V=1e6){this.pointBudget=V,this.first=null,this.last=null,this.numPoints=0,this.items=new Map}get size(){return this.items.size}has(V){return this.items.has(V.id)}touch(V){if(!V.loaded)return;const W=this.items.get(V.id);W?this.touchExisting(W):this.addNew(V)}addNew(V){const W=new Ka(V);W.previous=this.last,this.last=W,W.previous&&(W.previous.next=W),this.first||(this.first=W),this.items.set(V.id,W),this.numPoints+=V.numPoints}touchExisting(V){V.previous?V.next&&(V.previous.next=V.next,V.next.previous=V.previous,V.previous=this.last,V.next=null,this.last=V,V.previous&&(V.previous.next=V)):V.next&&(this.first=V.next,this.first.previous=null,V.previous=this.last,V.next=null,this.last=V,V.previous&&(V.previous.next=V))}remove(V){const W=this.items.get(V.id);W&&(1===this.items.size?(this.first=null,this.last=null):(W.previous||(this.first=W.next,this.first.previous=null),W.next||(this.last=W.previous,this.last.next=null),W.previous&&W.next&&(W.previous.next=W.next,W.next.previous=W.previous)),this.items.delete(V.id),this.numPoints-=V.numPoints)}getLRUItem(){return this.first?this.first.node:void 0}freeMemory(){if(!(this.items.size<=1))for(;this.numPoints>2*this.pointBudget;){const V=this.getLRUItem();V&&this.disposeSubtree(V)}}disposeSubtree(V){const W=[V];V.traverse(re=>{re.loaded&&W.push(re)});for(const re of W)re.dispose(),this.remove(re)}}class Ou{constructor(V,W,re,pe){this.pointCloudIndex=V,this.weight=W,this.node=re,this.parent=pe}}class va{constructor(){this._pointBudget=1e6,this._rendererSize=new _e.Vector2,this.maxNumNodesLoading=4,this.features=Nu,this.lru=new Kf(this._pointBudget),this.updateVisibilityStructures=(()=>{const V=new _e.Matrix4,W=new _e.Matrix4,re=new _e.Matrix4;return(pe,He)=>{const Ze=[],jt=[],gn=new Ya.BinaryHeap(At=>1/At.weight);for(let At=0;At<pe.length;At++){const Zt=pe[At];if(!Zt.initialized())continue;Zt.numVisiblePoints=0,Zt.visibleNodes=[],Zt.visibleGeometry=[],He.updateMatrixWorld(!1);const Ei=He.matrixWorldInverse,vn=Zt.matrixWorld;V.identity().multiply(He.projectionMatrix).multiply(Ei).multiply(vn),Ze.push((new _e.Frustum).setFromProjectionMatrix(V)),W.copy(vn).invert(),re.identity().multiply(W).multiply(He.matrixWorld),jt.push((new _e.Vector3).setFromMatrixPosition(re)),Zt.visible&&null!==Zt.root&&gn.push(new Ou(At,Number.MAX_VALUE,Zt.root)),yg(Zt.root)&&Zt.hideDescendants(Zt.root.sceneNode);for(const mr of Zt.boundingBoxNodes)mr.visible=!1}return{frustums:Ze,cameraPositions:jt,priorityQueue:gn}}})()}loadPointCloud(V,W,re=((pe,He)=>fetch(pe,He))){return function Rb(ae,V,W){return Promise.resolve(V(ae)).then(re=>{return W(re,{mode:"cors"}).then(pe=>eo(pe)).then(pe=>pe.json()).then((pe=re,He=V,Ze=W,jt=>{const{offset:gn,boundingBox:At,tightBoundingBox:Zt}=function(Ui){const zn=new _e.Vector3(Ui.boundingBox.lx,Ui.boundingBox.ly,Ui.boundingBox.lz),vs=new _e.Vector3(Ui.boundingBox.ux,Ui.boundingBox.uy,Ui.boundingBox.uz),Sr=new _e.Box3(zn,vs),Ar=Sr.clone(),Is=zn.clone();if(Ui.tightBoundingBox){const{lx:Za,ly:xa,lz:ku,ux:Ql,uy:Bc,uz:ba}=Ui.tightBoundingBox;Ar.min.set(Za,xa,ku),Ar.max.set(Ql,Bc,ba)}return Sr.min.sub(Is),Sr.max.sub(Is),Ar.min.sub(Is),Ar.max.sub(Is),{offset:Is,boundingBox:Sr,tightBoundingBox:Ar}}(jt),Ei=new _a({getUrl:He,version:jt.version,boundingBox:At,scale:jt.scale,xhrRequest:Ze}),vn=new mg(Ei,At,Zt,gn,Ze);vn.url=pe,vn.octreeDir=jt.octreeDir,vn.needsUpdate=!0,vn.spacing=jt.spacing,vn.hierarchyStepSize=jt.hierarchyStepSize,vn.projection=jt.projection,vn.offset=gn,vn.pointAttributes=new Lu(jt.pointAttributes);const mr={},qi=new kc(jt.version);return function(Ui,zn,vs,Sr){const Ar=new rd("r",Ui,Ui.boundingBox);return Ar.hasChildren=!0,Ar.spacing=Ui.spacing,Ar.numPoints=Sr.upTo("1.5")?zn.hierarchy[0][1]:0,Ui.root=Ar,vs.r=Ar,Ui.root.load()}(vn,jt,mr,qi).then(()=>(qi.upTo("1.4")&&function(Ui,zn,vs){for(let Sr=1;Sr<zn.hierarchy.length;Sr++){const[Ar,Is]=zn.hierarchy[Sr],{index:Za,parentName:xa,level:ku}=Hr(Ar),Ql=vs[xa],Bc=pg(Ql.boundingBox,Za),ba=new rd(Ar,Ui,Bc);ba.level=ku,ba.numPoints=Is,ba.spacing=Ui.spacing/Math.pow(2,ba.level),vs[Ar]=ba,Ql.addChild(ba)}}(vn,jt,mr),vn.nodes=mr,vn))}));var pe,He,Ze})}(V,W,re).then(pe=>new Fu(this,pe))}updatePointClouds(V,W,re){const pe=this.updateVisibility(V,W,re);for(let He=0;He<V.length;He++){const Ze=V[He];Ze.disposed||(Ze.material.updateMaterial(Ze,Ze.visibleNodes,W,re),Ze.updateVisibleBounds(),Ze.updateBoundingBoxes())}return this.lru.freeMemory(),pe}static pick(V,W,re,pe,He={}){return va.picker=va.picker||new Bi,va.picker.pick(W,re,pe,V,He)}get pointBudget(){return this._pointBudget}set pointBudget(V){V!==this._pointBudget&&(this._pointBudget=V,this.lru.pointBudget=V,this.lru.freeMemory())}static set maxLoaderWorkers(V){_a.WORKER_POOL.maxWorkers=V}static get maxLoaderWorkers(){return _a.WORKER_POOL.maxWorkers}updateVisibility(V,W,re){let pe=0;const He=[],Ze=[],{frustums:jt,cameraPositions:gn,priorityQueue:At}=this.updateVisibilityStructures(V,W);let Zt,Ei=0,vn=!1,mr=!1;for(;void 0!==(Zt=At.pop());){let zn=Zt.node;if(pe+zn.numPoints>this.pointBudget)break;const vs=Zt.pointCloudIndex,Sr=V[vs];if(zn.level>(void 0!==Sr.maxLevel?Sr.maxLevel:1/0)||!jt[vs].intersectsBox(zn.boundingBox)||this.shouldClip(Sr,zn.boundingBox))continue;pe+=zn.numPoints,Sr.numVisiblePoints+=zn.numPoints;const Is=Zt.parent;if(gg(zn)&&(!Is||yg(Is)))if(zn.loaded&&Ei<2)zn=Sr.toTreeNode(zn,Is),Ei++;else{if(zn.failed){mr=!0;continue}zn.loaded&&Ei>=2&&(vn=!0),Ze.push(zn),Sr.visibleGeometry.push(zn)}yg(zn)&&(this.updateTreeNodeVisibility(Sr,zn,He),Sr.visibleGeometry.push(zn.geometryNode));const Za=.5*re.getSize(this._rendererSize).height*re.getPixelRatio();this.updateChildVisibility(Zt,At,Sr,zn,gn[vs],W,Za)}const qi=Math.min(this.maxNumNodesLoading,Ze.length),Ui=[];for(let zn=0;zn<qi;zn++)Ui.push(Ze[zn].load());return{visibleNodes:He,numVisiblePoints:pe,exceededMaxLoadsToGPU:vn,nodeLoadFailed:mr,nodeLoadPromises:Ui}}updateTreeNodeVisibility(V,W,re){this.lru.touch(W.geometryNode);const pe=W.sceneNode;pe.visible=!0,pe.material=V.material,pe.updateMatrix(),pe.matrixWorld.multiplyMatrices(V.matrixWorld,pe.matrix),re.push(W),V.visibleNodes.push(W),this.updateBoundingBoxVisibility(V,W)}updateChildVisibility(V,W,re,pe,He,Ze,jt){const gn=pe.children;for(let At=0;At<gn.length;At++){const Zt=gn[At];if(null===Zt)continue;const Ei=Zt.boundingSphere,vn=Ei.center.distanceTo(He),mr=Ei.radius;let qi=0;if("PerspectiveCamera"===Ze.type){const vs=Ze.fov*Math.PI/180;qi=jt/(Math.tan(vs/2)*vn)}else qi=2*jt/(Ze.top-Ze.bottom);const Ui=mr*qi;Ui<re.minNodePixelSize||W.push(new Ou(V.pointCloudIndex,vn<mr?Number.MAX_VALUE:Ui+1/vn,Zt,pe))}}updateBoundingBoxVisibility(V,W){if(V.showBoundingBox&&!W.boundingBoxNode){const re=new _g(W.boundingBox);re.matrixAutoUpdate=!1,V.boundingBoxNodes.push(re),W.boundingBoxNode=re,W.boundingBoxNode.matrix.copy(V.matrixWorld)}else V.showBoundingBox&&W.boundingBoxNode?(W.boundingBoxNode.visible=!0,W.boundingBoxNode.matrix.copy(V.matrixWorld)):!V.showBoundingBox&&W.boundingBoxNode&&(W.boundingBoxNode.visible=!1)}shouldClip(V,W){const re=V.material;if(0===re.numClipBoxes||re.clipMode!==fn.CLIP_OUTSIDE)return!1;const pe=W.clone();V.updateMatrixWorld(!0),pe.applyMatrix4(V.matrixWorld);const He=re.clipBoxes;for(let Ze=0;Ze<He.length;Ze++){const jt=He[Ze].matrix,gn=new _e.Box3(new _e.Vector3(-.5,-.5,-.5),new _e.Vector3(.5,.5,.5)).applyMatrix4(jt);if(pe.intersectsBox(gn))return!1}return!0}}}]))},926:Co=>{function O(uo,fr,yt,Et,fn,tn,An){try{var mi=uo[tn](An),tr=mi.value}catch(Si){return void yt(Si)}mi.done?fr(tr):Promise.resolve(tr).then(Et,fn)}Co.exports=function co(uo){return function(){var fr=this,yt=arguments;return new Promise(function(Et,fn){var tn=uo.apply(fr,yt);function An(tr){O(tn,Et,fn,An,mi,"next",tr)}function mi(tr){O(tn,Et,fn,An,mi,"throw",tr)}An(void 0)})}},Co.exports.__esModule=!0,Co.exports.default=Co.exports},712:(Co,O,co)=>{"use strict";var uo=co(926).default;Object.defineProperty(O,"__esModule",{value:!0});const Bi=301,$a=302,ho=1e3,_s=1001,ad=1002,zr=1003,Hr=1006,Ya=1008,Ka=1009,va=1012,V=1014,W=1015,re=1016,Ze=1020,At=1023,vn=1026,mr=1027,Ar=33776,Is=33777,Za=33778,xa=33779,Bu=2300,In=2301,Uu=2400,cd=2401,bg=2402,Ls=3e3,Dr=3001,ml="srgb",zu="srgb-linear",hd=35044,Cn=35048,Ob="300 es";class zc{addEventListener(s,a){void 0===this._listeners&&(this._listeners={});const u=this._listeners;void 0===u[s]&&(u[s]=[]),-1===u[s].indexOf(a)&&u[s].push(a)}hasEventListener(s,a){if(void 0===this._listeners)return!1;const u=this._listeners;return void 0!==u[s]&&-1!==u[s].indexOf(a)}removeEventListener(s,a){if(void 0===this._listeners)return;const h=this._listeners[s];if(void 0!==h){const m=h.indexOf(a);-1!==m&&h.splice(m,1)}}dispatchEvent(s){if(void 0===this._listeners)return;const u=this._listeners[s.type];if(void 0!==u){s.target=this;const h=u.slice(0);for(let m=0,g=h.length;m<g;m++)h[m].call(this,s);s.target=null}}}const to=[];for(let f=0;f<256;f++)to[f]=(f<16?"0":"")+f.toString(16);let kb=1234567;const dd=Math.PI/180,ji=180/Math.PI;function wa(){const f=4294967295*Math.random()|0,s=4294967295*Math.random()|0,a=4294967295*Math.random()|0,u=4294967295*Math.random()|0;return(to[255&f]+to[f>>8&255]+to[f>>16&255]+to[f>>24&255]+"-"+to[255&s]+to[s>>8&255]+"-"+to[s>>16&15|64]+to[s>>24&255]+"-"+to[63&a|128]+to[a>>8&255]+"-"+to[a>>16&255]+to[a>>24&255]+to[255&u]+to[u>>8&255]+to[u>>16&255]+to[u>>24&255]).toLowerCase()}function as(f,s,a){return Math.max(s,Math.min(a,f))}function Hc(f,s){return(f%s+s)%s}function Hu(f,s,a){return(1-a)*f+a*s}function xs(f){return 0==(f&f-1)&&0!==f}function Hb(f){return Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))}function np(f){return Math.pow(2,Math.floor(Math.log(f)/Math.LN2))}var tc=Object.freeze({__proto__:null,DEG2RAD:dd,RAD2DEG:ji,generateUUID:wa,clamp:as,euclideanModulo:Hc,mapLinear:function gr(f,s,a,u,h){return u+(f-s)*(h-u)/(a-s)},inverseLerp:function Mg(f,s,a){return f!==s?(a-f)/(s-f):0},lerp:Hu,damp:function iv(f,s,a,u){return Hu(f,s,1-Math.exp(-a*u))},pingpong:function Bb(f,s=1){return s-Math.abs(Hc(f,2*s)-s)},smoothstep:function ec(f,s,a){return f<=s?0:f>=a?1:(f=(f-s)/(a-s))*f*(3-2*f)},smootherstep:function ep(f,s,a){return f<=s?0:f>=a?1:(f=(f-s)/(a-s))*f*f*(f*(6*f-15)+10)},randInt:function qT(f,s){return f+Math.floor(Math.random()*(s-f+1))},randFloat:function Ao(f,s){return f+Math.random()*(s-f)},randFloatSpread:function tp(f){return f*(.5-Math.random())},seededRandom:function Ub(f){void 0!==f&&(kb=f);let s=kb+=1831565813;return s=Math.imul(s^s>>>15,1|s),s^=s+Math.imul(s^s>>>7,61|s),((s^s>>>14)>>>0)/4294967296},degToRad:function Vb(f){return f*dd},radToDeg:function zb(f){return f*ji},isPowerOfTwo:xs,ceilPowerOfTwo:Hb,floorPowerOfTwo:np,setQuaternionFromProperEuler:function Sn(f,s,a,u,h){const m=Math.cos,g=Math.sin,_=m(a/2),w=g(a/2),M=m((s+u)/2),C=g((s+u)/2),A=m((s-u)/2),D=g((s-u)/2),R=m((u-s)/2),L=g((u-s)/2);switch(h){case"XYX":f.set(_*C,w*A,w*D,_*M);break;case"YZY":f.set(w*D,_*C,w*A,_*M);break;case"ZXZ":f.set(w*A,w*D,_*C,_*M);break;case"XZX":f.set(_*C,w*L,w*R,_*M);break;case"YXY":f.set(w*R,_*C,w*L,_*M);break;case"ZYZ":f.set(w*L,w*R,_*C,_*M);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+h)}},normalize:function fo(f,s){switch(s.constructor){case Float32Array:return f;case Uint16Array:return Math.round(65535*f);case Uint8Array:return Math.round(255*f);case Int16Array:return Math.round(32767*f);case Int8Array:return Math.round(127*f);default:throw new Error("Invalid component type.")}},denormalize:function Go(f,s){switch(s.constructor){case Float32Array:return f;case Uint16Array:return f/65535;case Uint8Array:return f/255;case Int16Array:return Math.max(f/32767,-1);case Int8Array:return Math.max(f/127,-1);default:throw new Error("Invalid component type.")}}});class Qe{constructor(s=0,a=0){this.x=s,this.y=a}get width(){return this.x}set width(s){this.x=s}get height(){return this.y}set height(s){this.y=s}set(s,a){return this.x=s,this.y=a,this}setScalar(s){return this.x=s,this.y=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setComponent(s,a){switch(s){case 0:this.x=a;break;case 1:this.y=a;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y)}copy(s){return this.x=s.x,this.y=s.y,this}add(s,a){return void 0!==a?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(s,a)):(this.x+=s.x,this.y+=s.y,this)}addScalar(s){return this.x+=s,this.y+=s,this}addVectors(s,a){return this.x=s.x+a.x,this.y=s.y+a.y,this}addScaledVector(s,a){return this.x+=s.x*a,this.y+=s.y*a,this}sub(s,a){return void 0!==a?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(s,a)):(this.x-=s.x,this.y-=s.y,this)}subScalar(s){return this.x-=s,this.y-=s,this}subVectors(s,a){return this.x=s.x-a.x,this.y=s.y-a.y,this}multiply(s){return this.x*=s.x,this.y*=s.y,this}multiplyScalar(s){return this.x*=s,this.y*=s,this}divide(s){return this.x/=s.x,this.y/=s.y,this}divideScalar(s){return this.multiplyScalar(1/s)}applyMatrix3(s){const a=this.x,u=this.y,h=s.elements;return this.x=h[0]*a+h[3]*u+h[6],this.y=h[1]*a+h[4]*u+h[7],this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this}clamp(s,a){return this.x=Math.max(s.x,Math.min(a.x,this.x)),this.y=Math.max(s.y,Math.min(a.y,this.y)),this}clampScalar(s,a){return this.x=Math.max(s,Math.min(a,this.x)),this.y=Math.max(s,Math.min(a,this.y)),this}clampLength(s,a){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(s,Math.min(a,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(s){return this.x*s.x+this.y*s.y}cross(s){return this.x*s.y-this.y*s.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(s){return Math.sqrt(this.distanceToSquared(s))}distanceToSquared(s){const a=this.x-s.x,u=this.y-s.y;return a*a+u*u}manhattanDistanceTo(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,a){return this.x+=(s.x-this.x)*a,this.y+=(s.y-this.y)*a,this}lerpVectors(s,a,u){return this.x=s.x+(a.x-s.x)*u,this.y=s.y+(a.y-s.y)*u,this}equals(s){return s.x===this.x&&s.y===this.y}fromArray(s,a=0){return this.x=s[a],this.y=s[a+1],this}toArray(s=[],a=0){return s[a]=this.x,s[a+1]=this.y,s}fromBufferAttribute(s,a,u){return void 0!==u&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=s.getX(a),this.y=s.getY(a),this}rotateAround(s,a){const u=Math.cos(a),h=Math.sin(a),m=this.x-s.x,g=this.y-s.y;return this.x=m*u-g*h+s.x,this.y=m*h+g*u+s.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Qe.prototype.isVector2=!0;class ir{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(s,a,u,h,m,g,_,w,M){const C=this.elements;return C[0]=s,C[1]=h,C[2]=_,C[3]=a,C[4]=m,C[5]=w,C[6]=u,C[7]=g,C[8]=M,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(s){const a=this.elements,u=s.elements;return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],this}extractBasis(s,a,u){return s.setFromMatrix3Column(this,0),a.setFromMatrix3Column(this,1),u.setFromMatrix3Column(this,2),this}setFromMatrix4(s){const a=s.elements;return this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]),this}multiply(s){return this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,a){const u=s.elements,h=a.elements,m=this.elements,g=u[0],_=u[3],w=u[6],M=u[1],C=u[4],A=u[7],D=u[2],R=u[5],L=u[8],P=h[0],I=h[3],z=h[6],B=h[1],j=h[4],G=h[7],Y=h[2],le=h[5],fe=h[8];return m[0]=g*P+_*B+w*Y,m[3]=g*I+_*j+w*le,m[6]=g*z+_*G+w*fe,m[1]=M*P+C*B+A*Y,m[4]=M*I+C*j+A*le,m[7]=M*z+C*G+A*fe,m[2]=D*P+R*B+L*Y,m[5]=D*I+R*j+L*le,m[8]=D*z+R*G+L*fe,this}multiplyScalar(s){const a=this.elements;return a[0]*=s,a[3]*=s,a[6]*=s,a[1]*=s,a[4]*=s,a[7]*=s,a[2]*=s,a[5]*=s,a[8]*=s,this}determinant(){const s=this.elements,a=s[0],u=s[1],h=s[2],m=s[3],g=s[4],_=s[5],w=s[6],M=s[7],C=s[8];return a*g*C-a*_*M-u*m*C+u*_*w+h*m*M-h*g*w}invert(){const s=this.elements,a=s[0],u=s[1],h=s[2],m=s[3],g=s[4],_=s[5],w=s[6],M=s[7],C=s[8],A=C*g-_*M,D=_*w-C*m,R=M*m-g*w,L=a*A+u*D+h*R;if(0===L)return this.set(0,0,0,0,0,0,0,0,0);const P=1/L;return s[0]=A*P,s[1]=(h*M-C*u)*P,s[2]=(_*u-h*g)*P,s[3]=D*P,s[4]=(C*a-h*w)*P,s[5]=(h*m-_*a)*P,s[6]=R*P,s[7]=(u*w-M*a)*P,s[8]=(g*a-u*m)*P,this}transpose(){let s;const a=this.elements;return s=a[1],a[1]=a[3],a[3]=s,s=a[2],a[2]=a[6],a[6]=s,s=a[5],a[5]=a[7],a[7]=s,this}getNormalMatrix(s){return this.setFromMatrix4(s).invert().transpose()}transposeIntoArray(s){const a=this.elements;return s[0]=a[0],s[1]=a[3],s[2]=a[6],s[3]=a[1],s[4]=a[4],s[5]=a[7],s[6]=a[2],s[7]=a[5],s[8]=a[8],this}setUvTransform(s,a,u,h,m,g,_){const w=Math.cos(m),M=Math.sin(m);return this.set(u*w,u*M,-u*(w*g+M*_)+g+s,-h*M,h*w,-h*(-M*g+w*_)+_+a,0,0,1),this}scale(s,a){const u=this.elements;return u[0]*=s,u[3]*=s,u[6]*=s,u[1]*=a,u[4]*=a,u[7]*=a,this}rotate(s){const a=Math.cos(s),u=Math.sin(s),h=this.elements,m=h[0],g=h[3],_=h[6],w=h[1],M=h[4],C=h[7];return h[0]=a*m+u*w,h[3]=a*g+u*M,h[6]=a*_+u*C,h[1]=-u*m+a*w,h[4]=-u*g+a*M,h[7]=-u*_+a*C,this}translate(s,a){const u=this.elements;return u[0]+=s*u[2],u[3]+=s*u[5],u[6]+=s*u[8],u[1]+=a*u[2],u[4]+=a*u[5],u[7]+=a*u[8],this}equals(s){const a=this.elements,u=s.elements;for(let h=0;h<9;h++)if(a[h]!==u[h])return!1;return!0}fromArray(s,a=0){for(let u=0;u<9;u++)this.elements[u]=s[u+a];return this}toArray(s=[],a=0){const u=this.elements;return s[a]=u[0],s[a+1]=u[1],s[a+2]=u[2],s[a+3]=u[3],s[a+4]=u[4],s[a+5]=u[5],s[a+6]=u[6],s[a+7]=u[7],s[a+8]=u[8],s}clone(){return(new this.constructor).fromArray(this.elements)}}function ip(f){for(let s=f.length-1;s>=0;--s)if(f[s]>65535)return!0;return!1}ir.prototype.isMatrix3=!0;const rv={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function gl(f,s){return new rv[f](s)}function Gc(f){return document.createElementNS("http://www.w3.org/1999/xhtml",f)}function ra(f){return f<.04045?.0773993808*f:Math.pow(.9478672986*f+.0521327014,2.4)}function bs(f){return f<.0031308?12.92*f:1.055*Math.pow(f,.41666)-.055}const sv={[ml]:{[zu]:ra},[zu]:{[ml]:bs}},Or={legacyMode:!0,get workingColorSpace(){return zu},set workingColorSpace(f){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(f,s,a){if(this.legacyMode||s===a||!s||!a)return f;if(sv[s]&&void 0!==sv[s][a]){const u=sv[s][a];return f.r=u(f.r),f.g=u(f.g),f.b=u(f.b),f}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(f,s){return this.convert(f,this.workingColorSpace,s)},toWorkingColorSpace:function(f,s){return this.convert(f,s,this.workingColorSpace)}},Bt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_n={r:0,g:0,b:0},Fi={h:0,s:0,l:0},po={h:0,s:0,l:0};function nc(f,s,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?f+6*(s-f)*a:a<.5?s:a<2/3?f+6*(s-f)*(2/3-a):f}function Kr(f,s){return s.r=f.r,s.g=f.g,s.b=f.b,s}let br,Dt=(()=>{class f{constructor(a,u,h){return void 0===u&&void 0===h?this.set(a):this.setRGB(a,u,h)}set(a){return a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,u=ml){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,Or.toWorkingColorSpace(this,u),this}setRGB(a,u,h,m=zu){return this.r=a,this.g=u,this.b=h,Or.toWorkingColorSpace(this,m),this}setHSL(a,u,h,m=zu){if(a=Hc(a,1),u=as(u,0,1),h=as(h,0,1),0===u)this.r=this.g=this.b=h;else{const g=h<=.5?h*(1+u):h+u-h*u,_=2*h-g;this.r=nc(_,g,a+1/3),this.g=nc(_,g,a),this.b=nc(_,g,a-1/3)}return Or.toWorkingColorSpace(this,m),this}setStyle(a,u=ml){function h(g){void 0!==g&&parseFloat(g)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let m;if(m=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(a)){let g;const w=m[2];switch(m[1]){case"rgb":case"rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w))return this.r=Math.min(255,parseInt(g[1],10))/255,this.g=Math.min(255,parseInt(g[2],10))/255,this.b=Math.min(255,parseInt(g[3],10))/255,Or.toWorkingColorSpace(this,u),h(g[4]),this;if(g=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w))return this.r=Math.min(100,parseInt(g[1],10))/100,this.g=Math.min(100,parseInt(g[2],10))/100,this.b=Math.min(100,parseInt(g[3],10))/100,Or.toWorkingColorSpace(this,u),h(g[4]),this;break;case"hsl":case"hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w)){const M=parseFloat(g[1])/360,C=parseInt(g[2],10)/100,A=parseInt(g[3],10)/100;return h(g[4]),this.setHSL(M,C,A,u)}}}else if(m=/^\#([A-Fa-f\d]+)$/.exec(a)){const g=m[1],_=g.length;if(3===_)return this.r=parseInt(g.charAt(0)+g.charAt(0),16)/255,this.g=parseInt(g.charAt(1)+g.charAt(1),16)/255,this.b=parseInt(g.charAt(2)+g.charAt(2),16)/255,Or.toWorkingColorSpace(this,u),this;if(6===_)return this.r=parseInt(g.charAt(0)+g.charAt(1),16)/255,this.g=parseInt(g.charAt(2)+g.charAt(3),16)/255,this.b=parseInt(g.charAt(4)+g.charAt(5),16)/255,Or.toWorkingColorSpace(this,u),this}return a&&a.length>0?this.setColorName(a,u):this}setColorName(a,u=ml){const h=Bt[a.toLowerCase()];return void 0!==h?this.setHex(h,u):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=ra(a.r),this.g=ra(a.g),this.b=ra(a.b),this}copyLinearToSRGB(a){return this.r=bs(a.r),this.g=bs(a.g),this.b=bs(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=ml){return Or.fromWorkingColorSpace(Kr(this,_n),a),as(255*_n.r,0,255)<<16^as(255*_n.g,0,255)<<8^as(255*_n.b,0,255)<<0}getHexString(a=ml){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,u=zu){Or.fromWorkingColorSpace(Kr(this,_n),u);const h=_n.r,m=_n.g,g=_n.b,_=Math.max(h,m,g),w=Math.min(h,m,g);let M,C;const A=(w+_)/2;if(w===_)M=0,C=0;else{const D=_-w;switch(C=A<=.5?D/(_+w):D/(2-_-w),_){case h:M=(m-g)/D+(m<g?6:0);break;case m:M=(g-h)/D+2;break;case g:M=(h-m)/D+4}M/=6}return a.h=M,a.s=C,a.l=A,a}getRGB(a,u=zu){return Or.fromWorkingColorSpace(Kr(this,_n),u),a.r=_n.r,a.g=_n.g,a.b=_n.b,a}getStyle(a=ml){return Or.fromWorkingColorSpace(Kr(this,_n),a),a!==ml?`color(${a} ${_n.r} ${_n.g} ${_n.b})`:`rgb(${255*_n.r|0},${255*_n.g|0},${255*_n.b|0})`}offsetHSL(a,u,h){return this.getHSL(Fi),Fi.h+=a,Fi.s+=u,Fi.l+=h,this.setHSL(Fi.h,Fi.s,Fi.l),this}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,u){return this.r=a.r+u.r,this.g=a.g+u.g,this.b=a.b+u.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,u){return this.r+=(a.r-this.r)*u,this.g+=(a.g-this.g)*u,this.b+=(a.b-this.b)*u,this}lerpColors(a,u,h){return this.r=a.r+(u.r-a.r)*h,this.g=a.g+(u.g-a.g)*h,this.b=a.b+(u.b-a.b)*h,this}lerpHSL(a,u){this.getHSL(Fi),a.getHSL(po);const h=Hu(Fi.h,po.h,u),m=Hu(Fi.s,po.s,u),g=Hu(Fi.l,po.l,u);return this.setHSL(h,m,g),this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,u=0){return this.r=a[u],this.g=a[u+1],this.b=a[u+2],this}toArray(a=[],u=0){return a[u]=this.r,a[u+1]=this.g,a[u+2]=this.b,a}fromBufferAttribute(a,u){return this.r=a.getX(u),this.g=a.getY(u),this.b=a.getZ(u),!0===a.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return f.NAMES=Bt,f})();Dt.prototype.isColor=!0,Dt.prototype.r=1,Dt.prototype.g=1,Dt.prototype.b=1;class Ma{static getDataURL(s){if(/^data:/i.test(s.src)||"undefined"==typeof HTMLCanvasElement)return s.src;let a;if(s instanceof HTMLCanvasElement)a=s;else{void 0===br&&(br=Gc("canvas")),br.width=s.width,br.height=s.height;const u=br.getContext("2d");s instanceof ImageData?u.putImageData(s,0,0):u.drawImage(s,0,0,s.width,s.height),a=br}return a.width>2048||a.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",s),a.toDataURL("image/jpeg",.6)):a.toDataURL("image/png")}static sRGBToLinear(s){if("undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&s instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&s instanceof ImageBitmap){const a=Gc("canvas");a.width=s.width,a.height=s.height;const u=a.getContext("2d");u.drawImage(s,0,0,s.width,s.height);const h=u.getImageData(0,0,s.width,s.height),m=h.data;for(let g=0;g<m.length;g++)m[g]=255*ra(m[g]/255);return u.putImageData(h,0,0),a}if(s.data){const a=s.data.slice(0);for(let u=0;u<a.length;u++)a[u]=a instanceof Uint8Array||a instanceof Uint8ClampedArray?Math.floor(255*ra(a[u]/255)):ra(a[u]);return{data:a,width:s.width,height:s.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),s}}class Sa{constructor(s=null){this.uuid=wa(),this.data=s,this.version=0}set needsUpdate(s){!0===s&&this.version++}toJSON(s){const a=void 0===s||"string"==typeof s;if(!a&&void 0!==s.images[this.uuid])return s.images[this.uuid];const u={uuid:this.uuid,url:""},h=this.data;if(null!==h){let m;if(Array.isArray(h)){m=[];for(let g=0,_=h.length;g<_;g++)m.push(Zn(h[g].isDataTexture?h[g].image:h[g]))}else m=Zn(h);u.url=m}return a||(s.images[this.uuid]=u),u}}function Zn(f){return"undefined"!=typeof HTMLImageElement&&f instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&f instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&f instanceof ImageBitmap?Ma.getDataURL(f):f.data?{data:Array.prototype.slice.call(f.data),width:f.width,height:f.height,type:f.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Sa.prototype.isSource=!0;let Sg=0,ls=(()=>{class f extends zc{constructor(a=f.DEFAULT_IMAGE,u=f.DEFAULT_MAPPING,h=_s,m=_s,g=Hr,_=Ya,w=At,M=Ka,C=1,A=Ls){super(),Object.defineProperty(this,"id",{value:Sg++}),this.uuid=wa(),this.name="",this.source=new Sa(a),this.mipmaps=[],this.mapping=u,this.wrapS=h,this.wrapT=m,this.magFilter=g,this.minFilter=_,this.anisotropy=C,this.format=w,this.internalFormat=null,this.type=M,this.offset=new Qe(0,0),this.repeat=new Qe(1,1),this.center=new Qe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ir,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=A,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(a){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.encoding=a.encoding,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const u=void 0===a||"string"==typeof a;if(!u&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];const h={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(h.userData=this.userData),u||(a.textures[this.uuid]=h),h}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(300!==this.mapping)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case ho:a.x=a.x-Math.floor(a.x);break;case _s:a.x=a.x<0?0:1;break;case ad:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case ho:a.y=a.y-Math.floor(a.y);break;case _s:a.y=a.y<0?0:1;break;case ad:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){!0===a&&(this.version++,this.source.needsUpdate=!0)}}return f.DEFAULT_IMAGE=null,f.DEFAULT_MAPPING=300,f})();ls.prototype.isTexture=!0;class Xi{constructor(s=0,a=0,u=0,h=1){this.x=s,this.y=a,this.z=u,this.w=h}get width(){return this.z}set width(s){this.z=s}get height(){return this.w}set height(s){this.w=s}set(s,a,u,h){return this.x=s,this.y=a,this.z=u,this.w=h,this}setScalar(s){return this.x=s,this.y=s,this.z=s,this.w=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setZ(s){return this.z=s,this}setW(s){return this.w=s,this}setComponent(s,a){switch(s){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=void 0!==s.w?s.w:1,this}add(s,a){return void 0!==a?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(s,a)):(this.x+=s.x,this.y+=s.y,this.z+=s.z,this.w+=s.w,this)}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this}addVectors(s,a){return this.x=s.x+a.x,this.y=s.y+a.y,this.z=s.z+a.z,this.w=s.w+a.w,this}addScaledVector(s,a){return this.x+=s.x*a,this.y+=s.y*a,this.z+=s.z*a,this.w+=s.w*a,this}sub(s,a){return void 0!==a?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(s,a)):(this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this)}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this}subVectors(s,a){return this.x=s.x-a.x,this.y=s.y-a.y,this.z=s.z-a.z,this.w=s.w-a.w,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this.w*=s.w,this}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}applyMatrix4(s){const a=this.x,u=this.y,h=this.z,m=this.w,g=s.elements;return this.x=g[0]*a+g[4]*u+g[8]*h+g[12]*m,this.y=g[1]*a+g[5]*u+g[9]*h+g[13]*m,this.z=g[2]*a+g[6]*u+g[10]*h+g[14]*m,this.w=g[3]*a+g[7]*u+g[11]*h+g[15]*m,this}divideScalar(s){return this.multiplyScalar(1/s)}setAxisAngleFromQuaternion(s){this.w=2*Math.acos(s.w);const a=Math.sqrt(1-s.w*s.w);return a<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=s.x/a,this.y=s.y/a,this.z=s.z/a),this}setAxisAngleFromRotationMatrix(s){let a,u,h,m;const w=s.elements,M=w[0],C=w[4],A=w[8],D=w[1],R=w[5],L=w[9],P=w[2],I=w[6],z=w[10];if(Math.abs(C-D)<.01&&Math.abs(A-P)<.01&&Math.abs(L-I)<.01){if(Math.abs(C+D)<.1&&Math.abs(A+P)<.1&&Math.abs(L+I)<.1&&Math.abs(M+R+z-3)<.1)return this.set(1,0,0,0),this;a=Math.PI;const j=(M+1)/2,G=(R+1)/2,Y=(z+1)/2,le=(C+D)/4,fe=(A+P)/4,ye=(L+I)/4;return j>G&&j>Y?j<.01?(u=0,h=.707106781,m=.707106781):(u=Math.sqrt(j),h=le/u,m=fe/u):G>Y?G<.01?(u=.707106781,h=0,m=.707106781):(h=Math.sqrt(G),u=le/h,m=ye/h):Y<.01?(u=.707106781,h=.707106781,m=0):(m=Math.sqrt(Y),u=fe/m,h=ye/m),this.set(u,h,m,a),this}let B=Math.sqrt((I-L)*(I-L)+(A-P)*(A-P)+(D-C)*(D-C));return Math.abs(B)<.001&&(B=1),this.x=(I-L)/B,this.y=(A-P)/B,this.z=(D-C)/B,this.w=Math.acos((M+R+z-1)/2),this}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this.w=Math.min(this.w,s.w),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this.w=Math.max(this.w,s.w),this}clamp(s,a){return this.x=Math.max(s.x,Math.min(a.x,this.x)),this.y=Math.max(s.y,Math.min(a.y,this.y)),this.z=Math.max(s.z,Math.min(a.z,this.z)),this.w=Math.max(s.w,Math.min(a.w,this.w)),this}clampScalar(s,a){return this.x=Math.max(s,Math.min(a,this.x)),this.y=Math.max(s,Math.min(a,this.y)),this.z=Math.max(s,Math.min(a,this.z)),this.w=Math.max(s,Math.min(a,this.w)),this}clampLength(s,a){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(s,Math.min(a,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z+this.w*s.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,a){return this.x+=(s.x-this.x)*a,this.y+=(s.y-this.y)*a,this.z+=(s.z-this.z)*a,this.w+=(s.w-this.w)*a,this}lerpVectors(s,a,u){return this.x=s.x+(a.x-s.x)*u,this.y=s.y+(a.y-s.y)*u,this.z=s.z+(a.z-s.z)*u,this.w=s.w+(a.w-s.w)*u,this}equals(s){return s.x===this.x&&s.y===this.y&&s.z===this.z&&s.w===this.w}fromArray(s,a=0){return this.x=s[a],this.y=s[a+1],this.z=s[a+2],this.w=s[a+3],this}toArray(s=[],a=0){return s[a]=this.x,s[a+1]=this.y,s[a+2]=this.z,s[a+3]=this.w,s}fromBufferAttribute(s,a,u){return void 0!==u&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=s.getX(a),this.y=s.getY(a),this.z=s.getZ(a),this.w=s.getW(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Xi.prototype.isVector4=!0;class cs extends zc{constructor(s,a,u={}){super(),this.width=s,this.height=a,this.depth=1,this.scissor=new Xi(0,0,s,a),this.scissorTest=!1,this.viewport=new Xi(0,0,s,a),this.texture=new ls({width:s,height:a,depth:1},u.mapping,u.wrapS,u.wrapT,u.magFilter,u.minFilter,u.format,u.type,u.anisotropy,u.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==u.generateMipmaps&&u.generateMipmaps,this.texture.internalFormat=void 0!==u.internalFormat?u.internalFormat:null,this.texture.minFilter=void 0!==u.minFilter?u.minFilter:Hr,this.depthBuffer=void 0===u.depthBuffer||u.depthBuffer,this.stencilBuffer=void 0!==u.stencilBuffer&&u.stencilBuffer,this.depthTexture=void 0!==u.depthTexture?u.depthTexture:null,this.samples=void 0!==u.samples?u.samples:0}setSize(s,a,u=1){(this.width!==s||this.height!==a||this.depth!==u)&&(this.width=s,this.height=a,this.depth=u,this.texture.image.width=s,this.texture.image.height=a,this.texture.image.depth=u,this.dispose()),this.viewport.set(0,0,s,a),this.scissor.set(0,0,s,a)}clone(){return(new this.constructor).copy(this)}copy(s){return this.width=s.width,this.height=s.height,this.depth=s.depth,this.viewport.copy(s.viewport),this.texture=s.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},s.texture.image),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,null!==s.depthTexture&&(this.depthTexture=s.depthTexture.clone()),this.samples=s.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}cs.prototype.isWebGLRenderTarget=!0;class ws extends ls{constructor(s=null,a=1,u=1,h=1){super(null),this.image={data:s,width:a,height:u,depth:h},this.magFilter=zr,this.minFilter=zr,this.wrapR=_s,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}ws.prototype.isDataArrayTexture=!0;class fd extends cs{constructor(s,a,u){super(s,a),this.depth=u,this.texture=new ws(null,s,a,u),this.texture.isRenderTargetTexture=!0}}fd.prototype.isWebGLArrayRenderTarget=!0;class yl extends ls{constructor(s=null,a=1,u=1,h=1){super(null),this.image={data:s,width:a,height:u,depth:h},this.magFilter=zr,this.minFilter=zr,this.wrapR=_s,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}yl.prototype.isData3DTexture=!0;class Ea extends cs{constructor(s,a,u){super(s,a),this.depth=u,this.texture=new yl(null,s,a,u),this.texture.isRenderTargetTexture=!0}}Ea.prototype.isWebGL3DRenderTarget=!0;class yr extends cs{constructor(s,a,u,h={}){super(s,a,h);const m=this.texture;this.texture=[];for(let g=0;g<u;g++)this.texture[g]=m.clone(),this.texture[g].isRenderTargetTexture=!0}setSize(s,a,u=1){if(this.width!==s||this.height!==a||this.depth!==u){this.width=s,this.height=a,this.depth=u;for(let h=0,m=this.texture.length;h<m;h++)this.texture[h].image.width=s,this.texture[h].image.height=a,this.texture[h].image.depth=u;this.dispose()}return this.viewport.set(0,0,s,a),this.scissor.set(0,0,s,a),this}copy(s){this.dispose(),this.width=s.width,this.height=s.height,this.depth=s.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.depthTexture=s.depthTexture,this.texture.length=0;for(let a=0,u=s.texture.length;a<u;a++)this.texture[a]=s.texture[a].clone();return this}}yr.prototype.isWebGLMultipleRenderTargets=!0;class no{constructor(s=0,a=0,u=0,h=1){this._x=s,this._y=a,this._z=u,this._w=h}static slerp(s,a,u,h){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),u.slerpQuaternions(s,a,h)}static slerpFlat(s,a,u,h,m,g,_){let w=u[h+0],M=u[h+1],C=u[h+2],A=u[h+3];const D=m[g+0],R=m[g+1],L=m[g+2],P=m[g+3];if(0===_)return s[a+0]=w,s[a+1]=M,s[a+2]=C,void(s[a+3]=A);if(1===_)return s[a+0]=D,s[a+1]=R,s[a+2]=L,void(s[a+3]=P);if(A!==P||w!==D||M!==R||C!==L){let I=1-_;const z=w*D+M*R+C*L+A*P,B=z>=0?1:-1,j=1-z*z;if(j>Number.EPSILON){const Y=Math.sqrt(j),le=Math.atan2(Y,z*B);I=Math.sin(I*le)/Y,_=Math.sin(_*le)/Y}const G=_*B;if(w=w*I+D*G,M=M*I+R*G,C=C*I+L*G,A=A*I+P*G,I===1-_){const Y=1/Math.sqrt(w*w+M*M+C*C+A*A);w*=Y,M*=Y,C*=Y,A*=Y}}s[a]=w,s[a+1]=M,s[a+2]=C,s[a+3]=A}static multiplyQuaternionsFlat(s,a,u,h,m,g){const _=u[h],w=u[h+1],M=u[h+2],C=u[h+3],A=m[g],D=m[g+1],R=m[g+2],L=m[g+3];return s[a]=_*L+C*A+w*R-M*D,s[a+1]=w*L+C*D+M*A-_*R,s[a+2]=M*L+C*R+_*D-w*A,s[a+3]=C*L-_*A-w*D-M*R,s}get x(){return this._x}set x(s){this._x=s,this._onChangeCallback()}get y(){return this._y}set y(s){this._y=s,this._onChangeCallback()}get z(){return this._z}set z(s){this._z=s,this._onChangeCallback()}get w(){return this._w}set w(s){this._w=s,this._onChangeCallback()}set(s,a,u,h){return this._x=s,this._y=a,this._z=u,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(s){return this._x=s.x,this._y=s.y,this._z=s.z,this._w=s.w,this._onChangeCallback(),this}setFromEuler(s,a){if(!s||!s.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const u=s._x,h=s._y,m=s._z,g=s._order,_=Math.cos,w=Math.sin,M=_(u/2),C=_(h/2),A=_(m/2),D=w(u/2),R=w(h/2),L=w(m/2);switch(g){case"XYZ":this._x=D*C*A+M*R*L,this._y=M*R*A-D*C*L,this._z=M*C*L+D*R*A,this._w=M*C*A-D*R*L;break;case"YXZ":this._x=D*C*A+M*R*L,this._y=M*R*A-D*C*L,this._z=M*C*L-D*R*A,this._w=M*C*A+D*R*L;break;case"ZXY":this._x=D*C*A-M*R*L,this._y=M*R*A+D*C*L,this._z=M*C*L+D*R*A,this._w=M*C*A-D*R*L;break;case"ZYX":this._x=D*C*A-M*R*L,this._y=M*R*A+D*C*L,this._z=M*C*L-D*R*A,this._w=M*C*A+D*R*L;break;case"YZX":this._x=D*C*A+M*R*L,this._y=M*R*A+D*C*L,this._z=M*C*L-D*R*A,this._w=M*C*A-D*R*L;break;case"XZY":this._x=D*C*A-M*R*L,this._y=M*R*A-D*C*L,this._z=M*C*L+D*R*A,this._w=M*C*A+D*R*L;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+g)}return!1!==a&&this._onChangeCallback(),this}setFromAxisAngle(s,a){const u=a/2,h=Math.sin(u);return this._x=s.x*h,this._y=s.y*h,this._z=s.z*h,this._w=Math.cos(u),this._onChangeCallback(),this}setFromRotationMatrix(s){const a=s.elements,u=a[0],h=a[4],m=a[8],g=a[1],_=a[5],w=a[9],M=a[2],C=a[6],A=a[10],D=u+_+A;if(D>0){const R=.5/Math.sqrt(D+1);this._w=.25/R,this._x=(C-w)*R,this._y=(m-M)*R,this._z=(g-h)*R}else if(u>_&&u>A){const R=2*Math.sqrt(1+u-_-A);this._w=(C-w)/R,this._x=.25*R,this._y=(h+g)/R,this._z=(m+M)/R}else if(_>A){const R=2*Math.sqrt(1+_-u-A);this._w=(m-M)/R,this._x=(h+g)/R,this._y=.25*R,this._z=(w+C)/R}else{const R=2*Math.sqrt(1+A-u-_);this._w=(g-h)/R,this._x=(m+M)/R,this._y=(w+C)/R,this._z=.25*R}return this._onChangeCallback(),this}setFromUnitVectors(s,a){let u=s.dot(a)+1;return u<Number.EPSILON?(u=0,Math.abs(s.x)>Math.abs(s.z)?(this._x=-s.y,this._y=s.x,this._z=0,this._w=u):(this._x=0,this._y=-s.z,this._z=s.y,this._w=u)):(this._x=s.y*a.z-s.z*a.y,this._y=s.z*a.x-s.x*a.z,this._z=s.x*a.y-s.y*a.x,this._w=u),this.normalize()}angleTo(s){return 2*Math.acos(Math.abs(as(this.dot(s),-1,1)))}rotateTowards(s,a){const u=this.angleTo(s);if(0===u)return this;const h=Math.min(1,a/u);return this.slerp(s,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(s){return this._x*s._x+this._y*s._y+this._z*s._z+this._w*s._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let s=this.length();return 0===s?(this._x=0,this._y=0,this._z=0,this._w=1):(s=1/s,this._x=this._x*s,this._y=this._y*s,this._z=this._z*s,this._w=this._w*s),this._onChangeCallback(),this}multiply(s,a){return void 0!==a?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(s,a)):this.multiplyQuaternions(this,s)}premultiply(s){return this.multiplyQuaternions(s,this)}multiplyQuaternions(s,a){const u=s._x,h=s._y,m=s._z,g=s._w,_=a._x,w=a._y,M=a._z,C=a._w;return this._x=u*C+g*_+h*M-m*w,this._y=h*C+g*w+m*_-u*M,this._z=m*C+g*M+u*w-h*_,this._w=g*C-u*_-h*w-m*M,this._onChangeCallback(),this}slerp(s,a){if(0===a)return this;if(1===a)return this.copy(s);const u=this._x,h=this._y,m=this._z,g=this._w;let _=g*s._w+u*s._x+h*s._y+m*s._z;if(_<0?(this._w=-s._w,this._x=-s._x,this._y=-s._y,this._z=-s._z,_=-_):this.copy(s),_>=1)return this._w=g,this._x=u,this._y=h,this._z=m,this;const w=1-_*_;if(w<=Number.EPSILON){const R=1-a;return this._w=R*g+a*this._w,this._x=R*u+a*this._x,this._y=R*h+a*this._y,this._z=R*m+a*this._z,this.normalize(),this._onChangeCallback(),this}const M=Math.sqrt(w),C=Math.atan2(M,_),A=Math.sin((1-a)*C)/M,D=Math.sin(a*C)/M;return this._w=g*A+this._w*D,this._x=u*A+this._x*D,this._y=h*A+this._y*D,this._z=m*A+this._z*D,this._onChangeCallback(),this}slerpQuaternions(s,a,u){return this.copy(s).slerp(a,u)}random(){const s=Math.random(),a=Math.sqrt(1-s),u=Math.sqrt(s),h=2*Math.PI*Math.random(),m=2*Math.PI*Math.random();return this.set(a*Math.cos(h),u*Math.sin(m),u*Math.cos(m),a*Math.sin(h))}equals(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._w===this._w}fromArray(s,a=0){return this._x=s[a],this._y=s[a+1],this._z=s[a+2],this._w=s[a+3],this._onChangeCallback(),this}toArray(s=[],a=0){return s[a]=this._x,s[a+1]=this._y,s[a+2]=this._z,s[a+3]=this._w,s}fromBufferAttribute(s,a){return this._x=s.getX(a),this._y=s.getY(a),this._z=s.getZ(a),this._w=s.getW(a),this}_onChange(s){return this._onChangeCallback=s,this}_onChangeCallback(){}}no.prototype.isQuaternion=!0;class J{constructor(s=0,a=0,u=0){this.x=s,this.y=a,this.z=u}set(s,a,u){return void 0===u&&(u=this.z),this.x=s,this.y=a,this.z=u,this}setScalar(s){return this.x=s,this.y=s,this.z=s,this}setX(s){return this.x=s,this}setY(s){return this.y=s,this}setZ(s){return this.z=s,this}setComponent(s,a){switch(s){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;default:throw new Error("index is out of range: "+s)}return this}getComponent(s){switch(s){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+s)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this}add(s,a){return void 0!==a?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(s,a)):(this.x+=s.x,this.y+=s.y,this.z+=s.z,this)}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this}addVectors(s,a){return this.x=s.x+a.x,this.y=s.y+a.y,this.z=s.z+a.z,this}addScaledVector(s,a){return this.x+=s.x*a,this.y+=s.y*a,this.z+=s.z*a,this}sub(s,a){return void 0!==a?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(s,a)):(this.x-=s.x,this.y-=s.y,this.z-=s.z,this)}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this}subVectors(s,a){return this.x=s.x-a.x,this.y=s.y-a.y,this.z=s.z-a.z,this}multiply(s,a){return void 0!==a?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(s,a)):(this.x*=s.x,this.y*=s.y,this.z*=s.z,this)}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this}multiplyVectors(s,a){return this.x=s.x*a.x,this.y=s.y*a.y,this.z=s.z*a.z,this}applyEuler(s){return s&&s.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ta.setFromEuler(s))}applyAxisAngle(s,a){return this.applyQuaternion(Ta.setFromAxisAngle(s,a))}applyMatrix3(s){const a=this.x,u=this.y,h=this.z,m=s.elements;return this.x=m[0]*a+m[3]*u+m[6]*h,this.y=m[1]*a+m[4]*u+m[7]*h,this.z=m[2]*a+m[5]*u+m[8]*h,this}applyNormalMatrix(s){return this.applyMatrix3(s).normalize()}applyMatrix4(s){const a=this.x,u=this.y,h=this.z,m=s.elements,g=1/(m[3]*a+m[7]*u+m[11]*h+m[15]);return this.x=(m[0]*a+m[4]*u+m[8]*h+m[12])*g,this.y=(m[1]*a+m[5]*u+m[9]*h+m[13])*g,this.z=(m[2]*a+m[6]*u+m[10]*h+m[14])*g,this}applyQuaternion(s){const a=this.x,u=this.y,h=this.z,m=s.x,g=s.y,_=s.z,w=s.w,M=w*a+g*h-_*u,C=w*u+_*a-m*h,A=w*h+m*u-g*a,D=-m*a-g*u-_*h;return this.x=M*w+D*-m+C*-_-A*-g,this.y=C*w+D*-g+A*-m-M*-_,this.z=A*w+D*-_+M*-g-C*-m,this}project(s){return this.applyMatrix4(s.matrixWorldInverse).applyMatrix4(s.projectionMatrix)}unproject(s){return this.applyMatrix4(s.projectionMatrixInverse).applyMatrix4(s.matrixWorld)}transformDirection(s){const a=this.x,u=this.y,h=this.z,m=s.elements;return this.x=m[0]*a+m[4]*u+m[8]*h,this.y=m[1]*a+m[5]*u+m[9]*h,this.z=m[2]*a+m[6]*u+m[10]*h,this.normalize()}divide(s){return this.x/=s.x,this.y/=s.y,this.z/=s.z,this}divideScalar(s){return this.multiplyScalar(1/s)}min(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this}max(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this}clamp(s,a){return this.x=Math.max(s.x,Math.min(a.x,this.x)),this.y=Math.max(s.y,Math.min(a.y,this.y)),this.z=Math.max(s.z,Math.min(a.z,this.z)),this}clampScalar(s,a){return this.x=Math.max(s,Math.min(a,this.x)),this.y=Math.max(s,Math.min(a,this.y)),this.z=Math.max(s,Math.min(a,this.z)),this}clampLength(s,a){const u=this.length();return this.divideScalar(u||1).multiplyScalar(Math.max(s,Math.min(a,u)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(s){return this.x*s.x+this.y*s.y+this.z*s.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(s){return this.normalize().multiplyScalar(s)}lerp(s,a){return this.x+=(s.x-this.x)*a,this.y+=(s.y-this.y)*a,this.z+=(s.z-this.z)*a,this}lerpVectors(s,a,u){return this.x=s.x+(a.x-s.x)*u,this.y=s.y+(a.y-s.y)*u,this.z=s.z+(a.z-s.z)*u,this}cross(s,a){return void 0!==a?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(s,a)):this.crossVectors(this,s)}crossVectors(s,a){const u=s.x,h=s.y,m=s.z,g=a.x,_=a.y,w=a.z;return this.x=h*w-m*_,this.y=m*g-u*w,this.z=u*_-h*g,this}projectOnVector(s){const a=s.lengthSq();if(0===a)return this.set(0,0,0);const u=s.dot(this)/a;return this.copy(s).multiplyScalar(u)}projectOnPlane(s){return Ca.copy(this).projectOnVector(s),this.sub(Ca)}reflect(s){return this.sub(Ca.copy(s).multiplyScalar(2*this.dot(s)))}angleTo(s){const a=Math.sqrt(this.lengthSq()*s.lengthSq());if(0===a)return Math.PI/2;const u=this.dot(s)/a;return Math.acos(as(u,-1,1))}distanceTo(s){return Math.sqrt(this.distanceToSquared(s))}distanceToSquared(s){const a=this.x-s.x,u=this.y-s.y,h=this.z-s.z;return a*a+u*u+h*h}manhattanDistanceTo(s){return Math.abs(this.x-s.x)+Math.abs(this.y-s.y)+Math.abs(this.z-s.z)}setFromSpherical(s){return this.setFromSphericalCoords(s.radius,s.phi,s.theta)}setFromSphericalCoords(s,a,u){const h=Math.sin(a)*s;return this.x=h*Math.sin(u),this.y=Math.cos(a)*s,this.z=h*Math.cos(u),this}setFromCylindrical(s){return this.setFromCylindricalCoords(s.radius,s.theta,s.y)}setFromCylindricalCoords(s,a,u){return this.x=s*Math.sin(a),this.y=u,this.z=s*Math.cos(a),this}setFromMatrixPosition(s){const a=s.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}setFromMatrixScale(s){const a=this.setFromMatrixColumn(s,0).length(),u=this.setFromMatrixColumn(s,1).length(),h=this.setFromMatrixColumn(s,2).length();return this.x=a,this.y=u,this.z=h,this}setFromMatrixColumn(s,a){return this.fromArray(s.elements,4*a)}setFromMatrix3Column(s,a){return this.fromArray(s.elements,3*a)}setFromEuler(s){return this.x=s._x,this.y=s._y,this.z=s._z,this}equals(s){return s.x===this.x&&s.y===this.y&&s.z===this.z}fromArray(s,a=0){return this.x=s[a],this.y=s[a+1],this.z=s[a+2],this}toArray(s=[],a=0){return s[a]=this.x,s[a+1]=this.y,s[a+2]=this.z,s}fromBufferAttribute(s,a,u){return void 0!==u&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=s.getX(a),this.y=s.getY(a),this.z=s.getZ(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const s=2*(Math.random()-.5),a=Math.random()*Math.PI*2,u=Math.sqrt(1-s**2);return this.x=u*Math.cos(a),this.y=u*Math.sin(a),this.z=s,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}J.prototype.isVector3=!0;const Ca=new J,Ta=new no;class Do{constructor(s=new J(1/0,1/0,1/0),a=new J(-1/0,-1/0,-1/0)){this.min=s,this.max=a}set(s,a){return this.min.copy(s),this.max.copy(a),this}setFromArray(s){let a=1/0,u=1/0,h=1/0,m=-1/0,g=-1/0,_=-1/0;for(let w=0,M=s.length;w<M;w+=3){const C=s[w],A=s[w+1],D=s[w+2];C<a&&(a=C),A<u&&(u=A),D<h&&(h=D),C>m&&(m=C),A>g&&(g=A),D>_&&(_=D)}return this.min.set(a,u,h),this.max.set(m,g,_),this}setFromBufferAttribute(s){let a=1/0,u=1/0,h=1/0,m=-1/0,g=-1/0,_=-1/0;for(let w=0,M=s.count;w<M;w++){const C=s.getX(w),A=s.getY(w),D=s.getZ(w);C<a&&(a=C),A<u&&(u=A),D<h&&(h=D),C>m&&(m=C),A>g&&(g=A),D>_&&(_=D)}return this.min.set(a,u,h),this.max.set(m,g,_),this}setFromPoints(s){this.makeEmpty();for(let a=0,u=s.length;a<u;a++)this.expandByPoint(s[a]);return this}setFromCenterAndSize(s,a){const u=_l.copy(a).multiplyScalar(.5);return this.min.copy(s).sub(u),this.max.copy(s).add(u),this}setFromObject(s,a=!1){return this.makeEmpty(),this.expandByObject(s,a)}clone(){return(new this.constructor).copy(this)}copy(s){return this.min.copy(s.min),this.max.copy(s.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(s){return this.isEmpty()?s.set(0,0,0):s.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(s){return this.isEmpty()?s.set(0,0,0):s.subVectors(this.max,this.min)}expandByPoint(s){return this.min.min(s),this.max.max(s),this}expandByVector(s){return this.min.sub(s),this.max.add(s),this}expandByScalar(s){return this.min.addScalar(-s),this.max.addScalar(s),this}expandByObject(s,a=!1){s.updateWorldMatrix(!1,!1);const u=s.geometry;if(void 0!==u)if(a&&null!=u.attributes&&void 0!==u.attributes.position){const m=u.attributes.position;for(let g=0,_=m.count;g<_;g++)_l.fromBufferAttribute(m,g).applyMatrix4(s.matrixWorld),this.expandByPoint(_l)}else null===u.boundingBox&&u.computeBoundingBox(),sa.copy(u.boundingBox),sa.applyMatrix4(s.matrixWorld),this.union(sa);const h=s.children;for(let m=0,g=h.length;m<g;m++)this.expandByObject(h[m],a);return this}containsPoint(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y||s.z<this.min.z||s.z>this.max.z)}containsBox(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y&&this.min.z<=s.min.z&&s.max.z<=this.max.z}getParameter(s,a){return a.set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y),(s.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y||s.max.z<this.min.z||s.min.z>this.max.z)}intersectsSphere(s){return this.clampPoint(s.center,_l),_l.distanceToSquared(s.center)<=s.radius*s.radius}intersectsPlane(s){let a,u;return s.normal.x>0?(a=s.normal.x*this.min.x,u=s.normal.x*this.max.x):(a=s.normal.x*this.max.x,u=s.normal.x*this.min.x),s.normal.y>0?(a+=s.normal.y*this.min.y,u+=s.normal.y*this.max.y):(a+=s.normal.y*this.max.y,u+=s.normal.y*this.min.y),s.normal.z>0?(a+=s.normal.z*this.min.z,u+=s.normal.z*this.max.z):(a+=s.normal.z*this.max.z,u+=s.normal.z*this.min.z),a<=-s.constant&&u>=-s.constant}intersectsTriangle(s){if(this.isEmpty())return!1;this.getCenter(Eg),ov.subVectors(this.max,Eg),pd.subVectors(s.a,Eg),rp.subVectors(s.b,Eg),md.subVectors(s.c,Eg),Wc.subVectors(rp,pd),Gu.subVectors(md,rp),gd.subVectors(pd,md);let a=[0,-Wc.z,Wc.y,0,-Gu.z,Gu.y,0,-gd.z,gd.y,Wc.z,0,-Wc.x,Gu.z,0,-Gu.x,gd.z,0,-gd.x,-Wc.y,Wc.x,0,-Gu.y,Gu.x,0,-gd.y,gd.x,0];return!(!Gb(a,pd,rp,md,ov)||(a=[1,0,0,0,1,0,0,0,1],!Gb(a,pd,rp,md,ov)))&&(av.crossVectors(Wc,Gu),a=[av.x,av.y,av.z],Gb(a,pd,rp,md,ov))}clampPoint(s,a){return a.copy(s).clamp(this.min,this.max)}distanceToPoint(s){return _l.copy(s).clamp(this.min,this.max).sub(s).length()}getBoundingSphere(s){return this.getCenter(s.center),s.radius=.5*this.getSize(_l).length(),s}intersect(s){return this.min.max(s.min),this.max.min(s.max),this.isEmpty()&&this.makeEmpty(),this}union(s){return this.min.min(s.min),this.max.max(s.max),this}applyMatrix4(s){return this.isEmpty()||(Aa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(s),Aa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(s),Aa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(s),Aa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(s),Aa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(s),Aa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(s),Aa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(s),Aa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(s),this.setFromPoints(Aa)),this}translate(s){return this.min.add(s),this.max.add(s),this}equals(s){return s.min.equals(this.min)&&s.max.equals(this.max)}}Do.prototype.isBox3=!0;const Aa=[new J,new J,new J,new J,new J,new J,new J,new J],_l=new J,sa=new Do,pd=new J,rp=new J,md=new J,Wc=new J,Gu=new J,gd=new J,Eg=new J,ov=new J,av=new J,yd=new J;function Gb(f,s,a,u,h){for(let m=0,g=f.length-3;m<=g;m+=3){yd.fromArray(f,m);const _=h.x*Math.abs(yd.x)+h.y*Math.abs(yd.y)+h.z*Math.abs(yd.z),w=s.dot(yd),M=a.dot(yd),C=u.dot(yd);if(Math.max(-Math.max(w,M,C),Math.min(w,M,C))>_)return!1}return!0}const $L=new Do,jT=new J,lv=new J,Wb=new J;class Wu{constructor(s=new J,a=-1){this.center=s,this.radius=a}set(s,a){return this.center.copy(s),this.radius=a,this}setFromPoints(s,a){const u=this.center;void 0!==a?u.copy(a):$L.setFromPoints(s).getCenter(u);let h=0;for(let m=0,g=s.length;m<g;m++)h=Math.max(h,u.distanceToSquared(s[m]));return this.radius=Math.sqrt(h),this}copy(s){return this.center.copy(s.center),this.radius=s.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(s){return s.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(s){return s.distanceTo(this.center)-this.radius}intersectsSphere(s){const a=this.radius+s.radius;return s.center.distanceToSquared(this.center)<=a*a}intersectsBox(s){return s.intersectsSphere(this)}intersectsPlane(s){return Math.abs(s.distanceToPoint(this.center))<=this.radius}clampPoint(s,a){const u=this.center.distanceToSquared(s);return a.copy(s),u>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a}getBoundingBox(s){return this.isEmpty()?(s.makeEmpty(),s):(s.set(this.center,this.center),s.expandByScalar(this.radius),s)}applyMatrix4(s){return this.center.applyMatrix4(s),this.radius=this.radius*s.getMaxScaleOnAxis(),this}translate(s){return this.center.add(s),this}expandByPoint(s){Wb.subVectors(s,this.center);const a=Wb.lengthSq();if(a>this.radius*this.radius){const u=Math.sqrt(a),h=.5*(u-this.radius);this.center.add(Wb.multiplyScalar(h/u)),this.radius+=h}return this}union(s){return!0===this.center.equals(s.center)?lv.set(0,0,1).multiplyScalar(s.radius):lv.subVectors(s.center,this.center).normalize().multiplyScalar(s.radius),this.expandByPoint(jT.copy(s.center).add(lv)),this.expandByPoint(jT.copy(s.center).sub(lv)),this}equals(s){return s.center.equals(this.center)&&s.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const qc=new J,qb=new J,sp=new J,vl=new J,jb=new J,cv=new J,Xb=new J;class Wo{constructor(s=new J,a=new J(0,0,-1)){this.origin=s,this.direction=a}set(s,a){return this.origin.copy(s),this.direction.copy(a),this}copy(s){return this.origin.copy(s.origin),this.direction.copy(s.direction),this}at(s,a){return a.copy(this.direction).multiplyScalar(s).add(this.origin)}lookAt(s){return this.direction.copy(s).sub(this.origin).normalize(),this}recast(s){return this.origin.copy(this.at(s,qc)),this}closestPointToPoint(s,a){a.subVectors(s,this.origin);const u=a.dot(this.direction);return u<0?a.copy(this.origin):a.copy(this.direction).multiplyScalar(u).add(this.origin)}distanceToPoint(s){return Math.sqrt(this.distanceSqToPoint(s))}distanceSqToPoint(s){const a=qc.subVectors(s,this.origin).dot(this.direction);return a<0?this.origin.distanceToSquared(s):(qc.copy(this.direction).multiplyScalar(a).add(this.origin),qc.distanceToSquared(s))}distanceSqToSegment(s,a,u,h){qb.copy(s).add(a).multiplyScalar(.5),sp.copy(a).sub(s).normalize(),vl.copy(this.origin).sub(qb);const m=.5*s.distanceTo(a),g=-this.direction.dot(sp),_=vl.dot(this.direction),w=-vl.dot(sp),M=vl.lengthSq(),C=Math.abs(1-g*g);let A,D,R,L;if(C>0)if(A=g*w-_,D=g*_-w,L=m*C,A>=0)if(D>=-L)if(D<=L){const P=1/C;A*=P,D*=P,R=A*(A+g*D+2*_)+D*(g*A+D+2*w)+M}else D=m,A=Math.max(0,-(g*D+_)),R=-A*A+D*(D+2*w)+M;else D=-m,A=Math.max(0,-(g*D+_)),R=-A*A+D*(D+2*w)+M;else D<=-L?(A=Math.max(0,-(-g*m+_)),D=A>0?-m:Math.min(Math.max(-m,-w),m),R=-A*A+D*(D+2*w)+M):D<=L?(A=0,D=Math.min(Math.max(-m,-w),m),R=D*(D+2*w)+M):(A=Math.max(0,-(g*m+_)),D=A>0?m:Math.min(Math.max(-m,-w),m),R=-A*A+D*(D+2*w)+M);else D=g>0?-m:m,A=Math.max(0,-(g*D+_)),R=-A*A+D*(D+2*w)+M;return u&&u.copy(this.direction).multiplyScalar(A).add(this.origin),h&&h.copy(sp).multiplyScalar(D).add(qb),R}intersectSphere(s,a){qc.subVectors(s.center,this.origin);const u=qc.dot(this.direction),h=qc.dot(qc)-u*u,m=s.radius*s.radius;if(h>m)return null;const g=Math.sqrt(m-h),_=u-g,w=u+g;return _<0&&w<0?null:this.at(_<0?w:_,a)}intersectsSphere(s){return this.distanceSqToPoint(s.center)<=s.radius*s.radius}distanceToPlane(s){const a=s.normal.dot(this.direction);if(0===a)return 0===s.distanceToPoint(this.origin)?0:null;const u=-(this.origin.dot(s.normal)+s.constant)/a;return u>=0?u:null}intersectPlane(s,a){const u=this.distanceToPlane(s);return null===u?null:this.at(u,a)}intersectsPlane(s){const a=s.distanceToPoint(this.origin);return 0===a||s.normal.dot(this.direction)*a<0}intersectBox(s,a){let u,h,m,g,_,w;const M=1/this.direction.x,C=1/this.direction.y,A=1/this.direction.z,D=this.origin;return M>=0?(u=(s.min.x-D.x)*M,h=(s.max.x-D.x)*M):(u=(s.max.x-D.x)*M,h=(s.min.x-D.x)*M),C>=0?(m=(s.min.y-D.y)*C,g=(s.max.y-D.y)*C):(m=(s.max.y-D.y)*C,g=(s.min.y-D.y)*C),u>g||m>h||((m>u||u!=u)&&(u=m),(g<h||h!=h)&&(h=g),A>=0?(_=(s.min.z-D.z)*A,w=(s.max.z-D.z)*A):(_=(s.max.z-D.z)*A,w=(s.min.z-D.z)*A),u>w||_>h)||((_>u||u!=u)&&(u=_),(w<h||h!=h)&&(h=w),h<0)?null:this.at(u>=0?u:h,a)}intersectsBox(s){return null!==this.intersectBox(s,qc)}intersectTriangle(s,a,u,h,m){jb.subVectors(a,s),cv.subVectors(u,s),Xb.crossVectors(jb,cv);let _,g=this.direction.dot(Xb);if(g>0){if(h)return null;_=1}else{if(!(g<0))return null;_=-1,g=-g}vl.subVectors(this.origin,s);const w=_*this.direction.dot(cv.crossVectors(vl,cv));if(w<0)return null;const M=_*this.direction.dot(jb.cross(vl));if(M<0||w+M>g)return null;const C=-_*vl.dot(Xb);return C<0?null:this.at(C/g,m)}applyMatrix4(s){return this.origin.applyMatrix4(s),this.direction.transformDirection(s),this}equals(s){return s.origin.equals(this.origin)&&s.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class cn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(s,a,u,h,m,g,_,w,M,C,A,D,R,L,P,I){const z=this.elements;return z[0]=s,z[4]=a,z[8]=u,z[12]=h,z[1]=m,z[5]=g,z[9]=_,z[13]=w,z[2]=M,z[6]=C,z[10]=A,z[14]=D,z[3]=R,z[7]=L,z[11]=P,z[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new cn).fromArray(this.elements)}copy(s){const a=this.elements,u=s.elements;return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],this}copyPosition(s){const a=this.elements,u=s.elements;return a[12]=u[12],a[13]=u[13],a[14]=u[14],this}setFromMatrix3(s){const a=s.elements;return this.set(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1),this}extractBasis(s,a,u){return s.setFromMatrixColumn(this,0),a.setFromMatrixColumn(this,1),u.setFromMatrixColumn(this,2),this}makeBasis(s,a,u){return this.set(s.x,a.x,u.x,0,s.y,a.y,u.y,0,s.z,a.z,u.z,0,0,0,0,1),this}extractRotation(s){const a=this.elements,u=s.elements,h=1/Ms.setFromMatrixColumn(s,0).length(),m=1/Ms.setFromMatrixColumn(s,1).length(),g=1/Ms.setFromMatrixColumn(s,2).length();return a[0]=u[0]*h,a[1]=u[1]*h,a[2]=u[2]*h,a[3]=0,a[4]=u[4]*m,a[5]=u[5]*m,a[6]=u[6]*m,a[7]=0,a[8]=u[8]*g,a[9]=u[9]*g,a[10]=u[10]*g,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromEuler(s){s&&s.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const a=this.elements,u=s.x,h=s.y,m=s.z,g=Math.cos(u),_=Math.sin(u),w=Math.cos(h),M=Math.sin(h),C=Math.cos(m),A=Math.sin(m);if("XYZ"===s.order){const D=g*C,R=g*A,L=_*C,P=_*A;a[0]=w*C,a[4]=-w*A,a[8]=M,a[1]=R+L*M,a[5]=D-P*M,a[9]=-_*w,a[2]=P-D*M,a[6]=L+R*M,a[10]=g*w}else if("YXZ"===s.order){const D=w*C,R=w*A,L=M*C,P=M*A;a[0]=D+P*_,a[4]=L*_-R,a[8]=g*M,a[1]=g*A,a[5]=g*C,a[9]=-_,a[2]=R*_-L,a[6]=P+D*_,a[10]=g*w}else if("ZXY"===s.order){const D=w*C,R=w*A,L=M*C,P=M*A;a[0]=D-P*_,a[4]=-g*A,a[8]=L+R*_,a[1]=R+L*_,a[5]=g*C,a[9]=P-D*_,a[2]=-g*M,a[6]=_,a[10]=g*w}else if("ZYX"===s.order){const D=g*C,R=g*A,L=_*C,P=_*A;a[0]=w*C,a[4]=L*M-R,a[8]=D*M+P,a[1]=w*A,a[5]=P*M+D,a[9]=R*M-L,a[2]=-M,a[6]=_*w,a[10]=g*w}else if("YZX"===s.order){const D=g*w,R=g*M,L=_*w,P=_*M;a[0]=w*C,a[4]=P-D*A,a[8]=L*A+R,a[1]=A,a[5]=g*C,a[9]=-_*C,a[2]=-M*C,a[6]=R*A+L,a[10]=D-P*A}else if("XZY"===s.order){const D=g*w,R=g*M,L=_*w,P=_*M;a[0]=w*C,a[4]=-A,a[8]=M*C,a[1]=D*A+P,a[5]=g*C,a[9]=R*A-L,a[2]=L*A-R,a[6]=_*C,a[10]=P*A+D}return a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(s){return this.compose(XT,s,$T)}lookAt(s,a,u){const h=this.elements;return oa.subVectors(s,a),0===oa.lengthSq()&&(oa.z=1),oa.normalize(),ic.crossVectors(u,oa),0===ic.lengthSq()&&(1===Math.abs(u.z)?oa.x+=1e-4:oa.z+=1e-4,oa.normalize(),ic.crossVectors(u,oa)),ic.normalize(),op.crossVectors(oa,ic),h[0]=ic.x,h[4]=op.x,h[8]=oa.x,h[1]=ic.y,h[5]=op.y,h[9]=oa.y,h[2]=ic.z,h[6]=op.z,h[10]=oa.z,this}multiply(s,a){return void 0!==a?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(s,a)):this.multiplyMatrices(this,s)}premultiply(s){return this.multiplyMatrices(s,this)}multiplyMatrices(s,a){const u=s.elements,h=a.elements,m=this.elements,g=u[0],_=u[4],w=u[8],M=u[12],C=u[1],A=u[5],D=u[9],R=u[13],L=u[2],P=u[6],I=u[10],z=u[14],B=u[3],j=u[7],G=u[11],Y=u[15],le=h[0],fe=h[4],ye=h[8],Ve=h[12],we=h[1],X=h[5],he=h[9],ft=h[13],Ee=h[2],Be=h[6],Ie=h[10],je=h[14],Me=h[3],lt=h[7],dt=h[11],wt=h[15];return m[0]=g*le+_*we+w*Ee+M*Me,m[4]=g*fe+_*X+w*Be+M*lt,m[8]=g*ye+_*he+w*Ie+M*dt,m[12]=g*Ve+_*ft+w*je+M*wt,m[1]=C*le+A*we+D*Ee+R*Me,m[5]=C*fe+A*X+D*Be+R*lt,m[9]=C*ye+A*he+D*Ie+R*dt,m[13]=C*Ve+A*ft+D*je+R*wt,m[2]=L*le+P*we+I*Ee+z*Me,m[6]=L*fe+P*X+I*Be+z*lt,m[10]=L*ye+P*he+I*Ie+z*dt,m[14]=L*Ve+P*ft+I*je+z*wt,m[3]=B*le+j*we+G*Ee+Y*Me,m[7]=B*fe+j*X+G*Be+Y*lt,m[11]=B*ye+j*he+G*Ie+Y*dt,m[15]=B*Ve+j*ft+G*je+Y*wt,this}multiplyScalar(s){const a=this.elements;return a[0]*=s,a[4]*=s,a[8]*=s,a[12]*=s,a[1]*=s,a[5]*=s,a[9]*=s,a[13]*=s,a[2]*=s,a[6]*=s,a[10]*=s,a[14]*=s,a[3]*=s,a[7]*=s,a[11]*=s,a[15]*=s,this}determinant(){const s=this.elements,a=s[0],u=s[4],h=s[8],m=s[12],g=s[1],_=s[5],w=s[9],M=s[13],C=s[2],A=s[6],D=s[10],R=s[14];return s[3]*(+m*w*A-h*M*A-m*_*D+u*M*D+h*_*R-u*w*R)+s[7]*(+a*w*R-a*M*D+m*g*D-h*g*R+h*M*C-m*w*C)+s[11]*(+a*M*A-a*_*R-m*g*A+u*g*R+m*_*C-u*M*C)+s[15]*(-h*_*C-a*w*A+a*_*D+h*g*A-u*g*D+u*w*C)}transpose(){const s=this.elements;let a;return a=s[1],s[1]=s[4],s[4]=a,a=s[2],s[2]=s[8],s[8]=a,a=s[6],s[6]=s[9],s[9]=a,a=s[3],s[3]=s[12],s[12]=a,a=s[7],s[7]=s[13],s[13]=a,a=s[11],s[11]=s[14],s[14]=a,this}setPosition(s,a,u){const h=this.elements;return s.isVector3?(h[12]=s.x,h[13]=s.y,h[14]=s.z):(h[12]=s,h[13]=a,h[14]=u),this}invert(){const s=this.elements,a=s[0],u=s[1],h=s[2],m=s[3],g=s[4],_=s[5],w=s[6],M=s[7],C=s[8],A=s[9],D=s[10],R=s[11],L=s[12],P=s[13],I=s[14],z=s[15],B=A*I*M-P*D*M+P*w*R-_*I*R-A*w*z+_*D*z,j=L*D*M-C*I*M-L*w*R+g*I*R+C*w*z-g*D*z,G=C*P*M-L*A*M+L*_*R-g*P*R-C*_*z+g*A*z,Y=L*A*w-C*P*w-L*_*D+g*P*D+C*_*I-g*A*I,le=a*B+u*j+h*G+m*Y;if(0===le)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const fe=1/le;return s[0]=B*fe,s[1]=(P*D*m-A*I*m-P*h*R+u*I*R+A*h*z-u*D*z)*fe,s[2]=(_*I*m-P*w*m+P*h*M-u*I*M-_*h*z+u*w*z)*fe,s[3]=(A*w*m-_*D*m-A*h*M+u*D*M+_*h*R-u*w*R)*fe,s[4]=j*fe,s[5]=(C*I*m-L*D*m+L*h*R-a*I*R-C*h*z+a*D*z)*fe,s[6]=(L*w*m-g*I*m-L*h*M+a*I*M+g*h*z-a*w*z)*fe,s[7]=(g*D*m-C*w*m+C*h*M-a*D*M-g*h*R+a*w*R)*fe,s[8]=G*fe,s[9]=(L*A*m-C*P*m-L*u*R+a*P*R+C*u*z-a*A*z)*fe,s[10]=(g*P*m-L*_*m+L*u*M-a*P*M-g*u*z+a*_*z)*fe,s[11]=(C*_*m-g*A*m-C*u*M+a*A*M+g*u*R-a*_*R)*fe,s[12]=Y*fe,s[13]=(C*P*h-L*A*h+L*u*D-a*P*D-C*u*I+a*A*I)*fe,s[14]=(L*_*h-g*P*h-L*u*w+a*P*w+g*u*I-a*_*I)*fe,s[15]=(g*A*h-C*_*h+C*u*w-a*A*w-g*u*D+a*_*D)*fe,this}scale(s){const a=this.elements,u=s.x,h=s.y,m=s.z;return a[0]*=u,a[4]*=h,a[8]*=m,a[1]*=u,a[5]*=h,a[9]*=m,a[2]*=u,a[6]*=h,a[10]*=m,a[3]*=u,a[7]*=h,a[11]*=m,this}getMaxScaleOnAxis(){const s=this.elements;return Math.sqrt(Math.max(s[0]*s[0]+s[1]*s[1]+s[2]*s[2],s[4]*s[4]+s[5]*s[5]+s[6]*s[6],s[8]*s[8]+s[9]*s[9]+s[10]*s[10]))}makeTranslation(s,a,u){return this.set(1,0,0,s,0,1,0,a,0,0,1,u,0,0,0,1),this}makeRotationX(s){const a=Math.cos(s),u=Math.sin(s);return this.set(1,0,0,0,0,a,-u,0,0,u,a,0,0,0,0,1),this}makeRotationY(s){const a=Math.cos(s),u=Math.sin(s);return this.set(a,0,u,0,0,1,0,0,-u,0,a,0,0,0,0,1),this}makeRotationZ(s){const a=Math.cos(s),u=Math.sin(s);return this.set(a,-u,0,0,u,a,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(s,a){const u=Math.cos(a),h=Math.sin(a),m=1-u,g=s.x,_=s.y,w=s.z,M=m*g,C=m*_;return this.set(M*g+u,M*_-h*w,M*w+h*_,0,M*_+h*w,C*_+u,C*w-h*g,0,M*w-h*_,C*w+h*g,m*w*w+u,0,0,0,0,1),this}makeScale(s,a,u){return this.set(s,0,0,0,0,a,0,0,0,0,u,0,0,0,0,1),this}makeShear(s,a,u,h,m,g){return this.set(1,u,m,0,s,1,g,0,a,h,1,0,0,0,0,1),this}compose(s,a,u){const h=this.elements,m=a._x,g=a._y,_=a._z,w=a._w,M=m+m,C=g+g,A=_+_,D=m*M,R=m*C,L=m*A,P=g*C,I=g*A,z=_*A,B=w*M,j=w*C,G=w*A,Y=u.x,le=u.y,fe=u.z;return h[0]=(1-(P+z))*Y,h[1]=(R+G)*Y,h[2]=(L-j)*Y,h[3]=0,h[4]=(R-G)*le,h[5]=(1-(D+z))*le,h[6]=(I+B)*le,h[7]=0,h[8]=(L+j)*fe,h[9]=(I-B)*fe,h[10]=(1-(D+P))*fe,h[11]=0,h[12]=s.x,h[13]=s.y,h[14]=s.z,h[15]=1,this}decompose(s,a,u){const h=this.elements;let m=Ms.set(h[0],h[1],h[2]).length();const g=Ms.set(h[4],h[5],h[6]).length(),_=Ms.set(h[8],h[9],h[10]).length();this.determinant()<0&&(m=-m),s.x=h[12],s.y=h[13],s.z=h[14],Da.copy(this);const M=1/m,C=1/g,A=1/_;return Da.elements[0]*=M,Da.elements[1]*=M,Da.elements[2]*=M,Da.elements[4]*=C,Da.elements[5]*=C,Da.elements[6]*=C,Da.elements[8]*=A,Da.elements[9]*=A,Da.elements[10]*=A,a.setFromRotationMatrix(Da),u.x=m,u.y=g,u.z=_,this}makePerspective(s,a,u,h,m,g){void 0===g&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const _=this.elements,M=2*m/(u-h),C=(a+s)/(a-s),A=(u+h)/(u-h),D=-(g+m)/(g-m),R=-2*g*m/(g-m);return _[0]=2*m/(a-s),_[4]=0,_[8]=C,_[12]=0,_[1]=0,_[5]=M,_[9]=A,_[13]=0,_[2]=0,_[6]=0,_[10]=D,_[14]=R,_[3]=0,_[7]=0,_[11]=-1,_[15]=0,this}makeOrthographic(s,a,u,h,m,g){const _=this.elements,w=1/(a-s),M=1/(u-h),C=1/(g-m),A=(a+s)*w,D=(u+h)*M,R=(g+m)*C;return _[0]=2*w,_[4]=0,_[8]=0,_[12]=-A,_[1]=0,_[5]=2*M,_[9]=0,_[13]=-D,_[2]=0,_[6]=0,_[10]=-2*C,_[14]=-R,_[3]=0,_[7]=0,_[11]=0,_[15]=1,this}equals(s){const a=this.elements,u=s.elements;for(let h=0;h<16;h++)if(a[h]!==u[h])return!1;return!0}fromArray(s,a=0){for(let u=0;u<16;u++)this.elements[u]=s[u+a];return this}toArray(s=[],a=0){const u=this.elements;return s[a]=u[0],s[a+1]=u[1],s[a+2]=u[2],s[a+3]=u[3],s[a+4]=u[4],s[a+5]=u[5],s[a+6]=u[6],s[a+7]=u[7],s[a+8]=u[8],s[a+9]=u[9],s[a+10]=u[10],s[a+11]=u[11],s[a+12]=u[12],s[a+13]=u[13],s[a+14]=u[14],s[a+15]=u[15],s}}cn.prototype.isMatrix4=!0;const Ms=new J,Da=new cn,XT=new J(0,0,0),$T=new J(1,1,1),ic=new J,op=new J,oa=new J,Cg=new cn,$b=new no;class Ss{constructor(s=0,a=0,u=0,h=Ss.DefaultOrder){this._x=s,this._y=a,this._z=u,this._order=h}get x(){return this._x}set x(s){this._x=s,this._onChangeCallback()}get y(){return this._y}set y(s){this._y=s,this._onChangeCallback()}get z(){return this._z}set z(s){this._z=s,this._onChangeCallback()}get order(){return this._order}set order(s){this._order=s,this._onChangeCallback()}set(s,a,u,h=this._order){return this._x=s,this._y=a,this._z=u,this._order=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(s){return this._x=s._x,this._y=s._y,this._z=s._z,this._order=s._order,this._onChangeCallback(),this}setFromRotationMatrix(s,a=this._order,u=!0){const h=s.elements,m=h[0],g=h[4],_=h[8],w=h[1],M=h[5],C=h[9],A=h[2],D=h[6],R=h[10];switch(a){case"XYZ":this._y=Math.asin(as(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-C,R),this._z=Math.atan2(-g,m)):(this._x=Math.atan2(D,M),this._z=0);break;case"YXZ":this._x=Math.asin(-as(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(_,R),this._z=Math.atan2(w,M)):(this._y=Math.atan2(-A,m),this._z=0);break;case"ZXY":this._x=Math.asin(as(D,-1,1)),Math.abs(D)<.9999999?(this._y=Math.atan2(-A,R),this._z=Math.atan2(-g,M)):(this._y=0,this._z=Math.atan2(w,m));break;case"ZYX":this._y=Math.asin(-as(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(D,R),this._z=Math.atan2(w,m)):(this._x=0,this._z=Math.atan2(-g,M));break;case"YZX":this._z=Math.asin(as(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(-C,M),this._y=Math.atan2(-A,m)):(this._x=0,this._y=Math.atan2(_,R));break;case"XZY":this._z=Math.asin(-as(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(D,M),this._y=Math.atan2(_,m)):(this._x=Math.atan2(-C,R),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+a)}return this._order=a,!0===u&&this._onChangeCallback(),this}setFromQuaternion(s,a,u){return Cg.makeRotationFromQuaternion(s),this.setFromRotationMatrix(Cg,a,u)}setFromVector3(s,a=this._order){return this.set(s.x,s.y,s.z,a)}reorder(s){return $b.setFromEuler(this),this.setFromQuaternion($b,s)}equals(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._order===this._order}fromArray(s){return this._x=s[0],this._y=s[1],this._z=s[2],void 0!==s[3]&&(this._order=s[3]),this._onChangeCallback(),this}toArray(s=[],a=0){return s[a]=this._x,s[a+1]=this._y,s[a+2]=this._z,s[a+3]=this._order,s}_onChange(s){return this._onChangeCallback=s,this}_onChangeCallback(){}}Ss.prototype.isEuler=!0,Ss.DefaultOrder="XYZ",Ss.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class _d{constructor(){this.mask=1}set(s){this.mask=(1<<s|0)>>>0}enable(s){this.mask|=1<<s|0}enableAll(){this.mask=-1}toggle(s){this.mask^=1<<s|0}disable(s){this.mask&=~(1<<s|0)}disableAll(){this.mask=0}test(s){return 0!=(this.mask&s.mask)}isEnabled(s){return 0!=(this.mask&(1<<s|0))}}let YT=0;const Tg=new J,vd=new no,rc=new cn,xd=new J,ap=new J,uv=new J,YL=new no,kr=new J(1,0,0),hv=new J(0,1,0),Yb=new J(0,0,1),us={type:"added"},Kb={type:"removed"};class Ci extends zc{constructor(){super(),Object.defineProperty(this,"id",{value:YT++}),this.uuid=wa(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ci.DefaultUp.clone();const s=new J,a=new Ss,u=new no,h=new J(1,1,1);a._onChange(function m(){u.setFromEuler(a,!1)}),u._onChange(function g(){a.setFromQuaternion(u,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:s},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:u},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new cn},normalMatrix:{value:new ir}}),this.matrix=new cn,this.matrixWorld=new cn,this.matrixAutoUpdate=Ci.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _d,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(s){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(s),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(s){return this.quaternion.premultiply(s),this}setRotationFromAxisAngle(s,a){this.quaternion.setFromAxisAngle(s,a)}setRotationFromEuler(s){this.quaternion.setFromEuler(s,!0)}setRotationFromMatrix(s){this.quaternion.setFromRotationMatrix(s)}setRotationFromQuaternion(s){this.quaternion.copy(s)}rotateOnAxis(s,a){return vd.setFromAxisAngle(s,a),this.quaternion.multiply(vd),this}rotateOnWorldAxis(s,a){return vd.setFromAxisAngle(s,a),this.quaternion.premultiply(vd),this}rotateX(s){return this.rotateOnAxis(kr,s)}rotateY(s){return this.rotateOnAxis(hv,s)}rotateZ(s){return this.rotateOnAxis(Yb,s)}translateOnAxis(s,a){return Tg.copy(s).applyQuaternion(this.quaternion),this.position.add(Tg.multiplyScalar(a)),this}translateX(s){return this.translateOnAxis(kr,s)}translateY(s){return this.translateOnAxis(hv,s)}translateZ(s){return this.translateOnAxis(Yb,s)}localToWorld(s){return s.applyMatrix4(this.matrixWorld)}worldToLocal(s){return s.applyMatrix4(rc.copy(this.matrixWorld).invert())}lookAt(s,a,u){s.isVector3?xd.copy(s):xd.set(s,a,u);const h=this.parent;this.updateWorldMatrix(!0,!1),ap.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?rc.lookAt(ap,xd,this.up):rc.lookAt(xd,ap,this.up),this.quaternion.setFromRotationMatrix(rc),h&&(rc.extractRotation(h.matrixWorld),vd.setFromRotationMatrix(rc),this.quaternion.premultiply(vd.invert()))}add(s){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return s===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",s),this):(s&&s.isObject3D?(null!==s.parent&&s.parent.remove(s),s.parent=this,this.children.push(s),s.dispatchEvent(us)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",s),this)}remove(s){if(arguments.length>1){for(let u=0;u<arguments.length;u++)this.remove(arguments[u]);return this}const a=this.children.indexOf(s);return-1!==a&&(s.parent=null,this.children.splice(a,1),s.dispatchEvent(Kb)),this}removeFromParent(){const s=this.parent;return null!==s&&s.remove(this),this}clear(){for(let s=0;s<this.children.length;s++){const a=this.children[s];a.parent=null,a.dispatchEvent(Kb)}return this.children.length=0,this}attach(s){return this.updateWorldMatrix(!0,!1),rc.copy(this.matrixWorld).invert(),null!==s.parent&&(s.parent.updateWorldMatrix(!0,!1),rc.multiply(s.parent.matrixWorld)),s.applyMatrix4(rc),this.add(s),s.updateWorldMatrix(!1,!0),this}getObjectById(s){return this.getObjectByProperty("id",s)}getObjectByName(s){return this.getObjectByProperty("name",s)}getObjectByProperty(s,a){if(this[s]===a)return this;for(let u=0,h=this.children.length;u<h;u++){const g=this.children[u].getObjectByProperty(s,a);if(void 0!==g)return g}}getWorldPosition(s){return this.updateWorldMatrix(!0,!1),s.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(s){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ap,s,uv),s}getWorldScale(s){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ap,YL,s),s}getWorldDirection(s){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return s.set(a[8],a[9],a[10]).normalize()}raycast(){}traverse(s){s(this);const a=this.children;for(let u=0,h=a.length;u<h;u++)a[u].traverse(s)}traverseVisible(s){if(!1===this.visible)return;s(this);const a=this.children;for(let u=0,h=a.length;u<h;u++)a[u].traverseVisible(s)}traverseAncestors(s){const a=this.parent;null!==a&&(s(a),a.traverseAncestors(s))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(s){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||s)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,s=!0);const a=this.children;for(let u=0,h=a.length;u<h;u++)a[u].updateMatrixWorld(s)}updateWorldMatrix(s,a){const u=this.parent;if(!0===s&&null!==u&&u.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===a){const h=this.children;for(let m=0,g=h.length;m<g;m++)h[m].updateWorldMatrix(!1,!0)}}toJSON(s){const a=void 0===s||"string"==typeof s,u={};a&&(s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},u.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const h={};function m(_,w){return void 0===_[w.uuid]&&(_[w.uuid]=w.toJSON(s)),w.uuid}if(h.uuid=this.uuid,h.type=this.type,""!==this.name&&(h.name=this.name),!0===this.castShadow&&(h.castShadow=!0),!0===this.receiveShadow&&(h.receiveShadow=!0),!1===this.visible&&(h.visible=!1),!1===this.frustumCulled&&(h.frustumCulled=!1),0!==this.renderOrder&&(h.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(h.userData=this.userData),h.layers=this.layers.mask,h.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(h.matrixAutoUpdate=!1),this.isInstancedMesh&&(h.type="InstancedMesh",h.count=this.count,h.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(h.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?h.background=this.background.toJSON():this.background.isTexture&&(h.background=this.background.toJSON(s).uuid)),this.environment&&this.environment.isTexture&&(h.environment=this.environment.toJSON(s).uuid);else if(this.isMesh||this.isLine||this.isPoints){h.geometry=m(s.geometries,this.geometry);const _=this.geometry.parameters;if(void 0!==_&&void 0!==_.shapes){const w=_.shapes;if(Array.isArray(w))for(let M=0,C=w.length;M<C;M++)m(s.shapes,w[M]);else m(s.shapes,w)}}if(this.isSkinnedMesh&&(h.bindMode=this.bindMode,h.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(m(s.skeletons,this.skeleton),h.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const _=[];for(let w=0,M=this.material.length;w<M;w++)_.push(m(s.materials,this.material[w]));h.material=_}else h.material=m(s.materials,this.material);if(this.children.length>0){h.children=[];for(let _=0;_<this.children.length;_++)h.children.push(this.children[_].toJSON(s).object)}if(this.animations.length>0){h.animations=[];for(let _=0;_<this.animations.length;_++)h.animations.push(m(s.animations,this.animations[_]))}if(a){const _=g(s.geometries),w=g(s.materials),M=g(s.textures),C=g(s.images),A=g(s.shapes),D=g(s.skeletons),R=g(s.animations),L=g(s.nodes);_.length>0&&(u.geometries=_),w.length>0&&(u.materials=w),M.length>0&&(u.textures=M),C.length>0&&(u.images=C),A.length>0&&(u.shapes=A),D.length>0&&(u.skeletons=D),R.length>0&&(u.animations=R),L.length>0&&(u.nodes=L)}return u.object=h,u;function g(_){const w=[];for(const M in _){const C=_[M];delete C.metadata,w.push(C)}return w}}clone(s){return(new this.constructor).copy(this,s)}copy(s,a=!0){if(this.name=s.name,this.up.copy(s.up),this.position.copy(s.position),this.rotation.order=s.rotation.order,this.quaternion.copy(s.quaternion),this.scale.copy(s.scale),this.matrix.copy(s.matrix),this.matrixWorld.copy(s.matrixWorld),this.matrixAutoUpdate=s.matrixAutoUpdate,this.matrixWorldNeedsUpdate=s.matrixWorldNeedsUpdate,this.layers.mask=s.layers.mask,this.visible=s.visible,this.castShadow=s.castShadow,this.receiveShadow=s.receiveShadow,this.frustumCulled=s.frustumCulled,this.renderOrder=s.renderOrder,this.userData=JSON.parse(JSON.stringify(s.userData)),!0===a)for(let u=0;u<s.children.length;u++)this.add(s.children[u].clone());return this}}Ci.DefaultUp=new J(0,1,0),Ci.DefaultMatrixAutoUpdate=!0,Ci.prototype.isObject3D=!0;const qo=new J,hs=new J,dv=new J,Qa=new J,el=new J,Ns=new J,fv=new J,lp=new J,pv=new J,xl=new J;class Gr{constructor(s=new J,a=new J,u=new J){this.a=s,this.b=a,this.c=u}static getNormal(s,a,u,h){h.subVectors(u,a),qo.subVectors(s,a),h.cross(qo);const m=h.lengthSq();return m>0?h.multiplyScalar(1/Math.sqrt(m)):h.set(0,0,0)}static getBarycoord(s,a,u,h,m){qo.subVectors(h,a),hs.subVectors(u,a),dv.subVectors(s,a);const g=qo.dot(qo),_=qo.dot(hs),w=qo.dot(dv),M=hs.dot(hs),C=hs.dot(dv),A=g*M-_*_;if(0===A)return m.set(-2,-1,-1);const D=1/A,R=(M*w-_*C)*D,L=(g*C-_*w)*D;return m.set(1-R-L,L,R)}static containsPoint(s,a,u,h){return this.getBarycoord(s,a,u,h,Qa),Qa.x>=0&&Qa.y>=0&&Qa.x+Qa.y<=1}static getUV(s,a,u,h,m,g,_,w){return this.getBarycoord(s,a,u,h,Qa),w.set(0,0),w.addScaledVector(m,Qa.x),w.addScaledVector(g,Qa.y),w.addScaledVector(_,Qa.z),w}static isFrontFacing(s,a,u,h){return qo.subVectors(u,a),hs.subVectors(s,a),qo.cross(hs).dot(h)<0}set(s,a,u){return this.a.copy(s),this.b.copy(a),this.c.copy(u),this}setFromPointsAndIndices(s,a,u,h){return this.a.copy(s[a]),this.b.copy(s[u]),this.c.copy(s[h]),this}setFromAttributeAndIndices(s,a,u,h){return this.a.fromBufferAttribute(s,a),this.b.fromBufferAttribute(s,u),this.c.fromBufferAttribute(s,h),this}clone(){return(new this.constructor).copy(this)}copy(s){return this.a.copy(s.a),this.b.copy(s.b),this.c.copy(s.c),this}getArea(){return qo.subVectors(this.c,this.b),hs.subVectors(this.a,this.b),.5*qo.cross(hs).length()}getMidpoint(s){return s.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(s){return Gr.getNormal(this.a,this.b,this.c,s)}getPlane(s){return s.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(s,a){return Gr.getBarycoord(s,this.a,this.b,this.c,a)}getUV(s,a,u,h,m){return Gr.getUV(s,this.a,this.b,this.c,a,u,h,m)}containsPoint(s){return Gr.containsPoint(s,this.a,this.b,this.c)}isFrontFacing(s){return Gr.isFrontFacing(this.a,this.b,this.c,s)}intersectsBox(s){return s.intersectsTriangle(this)}closestPointToPoint(s,a){const u=this.a,h=this.b,m=this.c;let g,_;el.subVectors(h,u),Ns.subVectors(m,u),lp.subVectors(s,u);const w=el.dot(lp),M=Ns.dot(lp);if(w<=0&&M<=0)return a.copy(u);pv.subVectors(s,h);const C=el.dot(pv),A=Ns.dot(pv);if(C>=0&&A<=C)return a.copy(h);const D=w*A-C*M;if(D<=0&&w>=0&&C<=0)return g=w/(w-C),a.copy(u).addScaledVector(el,g);xl.subVectors(s,m);const R=el.dot(xl),L=Ns.dot(xl);if(L>=0&&R<=L)return a.copy(m);const P=R*M-w*L;if(P<=0&&M>=0&&L<=0)return _=M/(M-L),a.copy(u).addScaledVector(Ns,_);const I=C*L-R*A;if(I<=0&&A-C>=0&&R-L>=0)return fv.subVectors(m,h),_=(A-C)/(A-C+(R-L)),a.copy(h).addScaledVector(fv,_);const z=1/(I+P+D);return g=P*z,_=D*z,a.copy(u).addScaledVector(el,g).addScaledVector(Ns,_)}equals(s){return s.a.equals(this.a)&&s.b.equals(this.b)&&s.c.equals(this.c)}}let mv=0;class Qt extends zc{constructor(){super(),Object.defineProperty(this,"id",{value:mv++}),this.uuid=wa(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(s){this._alphaTest>0!=s>0&&this.version++,this._alphaTest=s}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(s){if(void 0!==s)for(const a in s){const u=s[a];if(void 0===u){console.warn("THREE.Material: '"+a+"' parameter is undefined.");continue}if("shading"===a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===u;continue}const h=this[a];void 0!==h?h&&h.isColor?h.set(u):h&&h.isVector3&&u&&u.isVector3?h.copy(u):this[a]=u:console.warn("THREE."+this.type+": '"+a+"' is not a property of this material.")}}toJSON(s){const a=void 0===s||"string"==typeof s;a&&(s={textures:{},images:{}});const u={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function h(m){const g=[];for(const _ in m){const w=m[_];delete w.metadata,g.push(w)}return g}if(u.uuid=this.uuid,u.type=this.type,""!==this.name&&(u.name=this.name),this.color&&this.color.isColor&&(u.color=this.color.getHex()),void 0!==this.roughness&&(u.roughness=this.roughness),void 0!==this.metalness&&(u.metalness=this.metalness),void 0!==this.sheen&&(u.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(u.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(u.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(u.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(u.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(u.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(u.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(u.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(u.shininess=this.shininess),void 0!==this.clearcoat&&(u.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(u.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(u.clearcoatMap=this.clearcoatMap.toJSON(s).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(u.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(s).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(u.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(s).uuid,u.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(u.map=this.map.toJSON(s).uuid),this.matcap&&this.matcap.isTexture&&(u.matcap=this.matcap.toJSON(s).uuid),this.alphaMap&&this.alphaMap.isTexture&&(u.alphaMap=this.alphaMap.toJSON(s).uuid),this.lightMap&&this.lightMap.isTexture&&(u.lightMap=this.lightMap.toJSON(s).uuid,u.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(u.aoMap=this.aoMap.toJSON(s).uuid,u.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(u.bumpMap=this.bumpMap.toJSON(s).uuid,u.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(u.normalMap=this.normalMap.toJSON(s).uuid,u.normalMapType=this.normalMapType,u.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(u.displacementMap=this.displacementMap.toJSON(s).uuid,u.displacementScale=this.displacementScale,u.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(u.roughnessMap=this.roughnessMap.toJSON(s).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(u.metalnessMap=this.metalnessMap.toJSON(s).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(u.emissiveMap=this.emissiveMap.toJSON(s).uuid),this.specularMap&&this.specularMap.isTexture&&(u.specularMap=this.specularMap.toJSON(s).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(u.specularIntensityMap=this.specularIntensityMap.toJSON(s).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(u.specularColorMap=this.specularColorMap.toJSON(s).uuid),this.envMap&&this.envMap.isTexture&&(u.envMap=this.envMap.toJSON(s).uuid,void 0!==this.combine&&(u.combine=this.combine)),void 0!==this.envMapIntensity&&(u.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(u.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(u.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(u.gradientMap=this.gradientMap.toJSON(s).uuid),void 0!==this.transmission&&(u.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(u.transmissionMap=this.transmissionMap.toJSON(s).uuid),void 0!==this.thickness&&(u.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(u.thicknessMap=this.thicknessMap.toJSON(s).uuid),void 0!==this.attenuationDistance&&(u.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(u.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(u.size=this.size),null!==this.shadowSide&&(u.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(u.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(u.blending=this.blending),0!==this.side&&(u.side=this.side),this.vertexColors&&(u.vertexColors=!0),this.opacity<1&&(u.opacity=this.opacity),!0===this.transparent&&(u.transparent=this.transparent),u.depthFunc=this.depthFunc,u.depthTest=this.depthTest,u.depthWrite=this.depthWrite,u.colorWrite=this.colorWrite,u.stencilWrite=this.stencilWrite,u.stencilWriteMask=this.stencilWriteMask,u.stencilFunc=this.stencilFunc,u.stencilRef=this.stencilRef,u.stencilFuncMask=this.stencilFuncMask,u.stencilFail=this.stencilFail,u.stencilZFail=this.stencilZFail,u.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(u.rotation=this.rotation),!0===this.polygonOffset&&(u.polygonOffset=!0),0!==this.polygonOffsetFactor&&(u.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(u.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(u.linewidth=this.linewidth),void 0!==this.dashSize&&(u.dashSize=this.dashSize),void 0!==this.gapSize&&(u.gapSize=this.gapSize),void 0!==this.scale&&(u.scale=this.scale),!0===this.dithering&&(u.dithering=!0),this.alphaTest>0&&(u.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(u.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(u.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(u.wireframe=this.wireframe),this.wireframeLinewidth>1&&(u.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(u.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(u.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(u.flatShading=this.flatShading),!1===this.visible&&(u.visible=!1),!1===this.toneMapped&&(u.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(u.userData=this.userData),a){const m=h(s.textures),g=h(s.images);m.length>0&&(u.textures=m),g.length>0&&(u.images=g)}return u}clone(){return(new this.constructor).copy(this)}copy(s){this.name=s.name,this.fog=s.fog,this.blending=s.blending,this.side=s.side,this.vertexColors=s.vertexColors,this.opacity=s.opacity,this.transparent=s.transparent,this.blendSrc=s.blendSrc,this.blendDst=s.blendDst,this.blendEquation=s.blendEquation,this.blendSrcAlpha=s.blendSrcAlpha,this.blendDstAlpha=s.blendDstAlpha,this.blendEquationAlpha=s.blendEquationAlpha,this.depthFunc=s.depthFunc,this.depthTest=s.depthTest,this.depthWrite=s.depthWrite,this.stencilWriteMask=s.stencilWriteMask,this.stencilFunc=s.stencilFunc,this.stencilRef=s.stencilRef,this.stencilFuncMask=s.stencilFuncMask,this.stencilFail=s.stencilFail,this.stencilZFail=s.stencilZFail,this.stencilZPass=s.stencilZPass,this.stencilWrite=s.stencilWrite;const a=s.clippingPlanes;let u=null;if(null!==a){const h=a.length;u=new Array(h);for(let m=0;m!==h;++m)u[m]=a[m].clone()}return this.clippingPlanes=u,this.clipIntersection=s.clipIntersection,this.clipShadows=s.clipShadows,this.shadowSide=s.shadowSide,this.colorWrite=s.colorWrite,this.precision=s.precision,this.polygonOffset=s.polygonOffset,this.polygonOffsetFactor=s.polygonOffsetFactor,this.polygonOffsetUnits=s.polygonOffsetUnits,this.dithering=s.dithering,this.alphaTest=s.alphaTest,this.alphaToCoverage=s.alphaToCoverage,this.premultipliedAlpha=s.premultipliedAlpha,this.visible=s.visible,this.toneMapped=s.toneMapped,this.userData=JSON.parse(JSON.stringify(s.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(s){!0===s&&this.version++}}Qt.prototype.isMaterial=!0,Qt.fromType=function(){return null};class bl extends Qt{constructor(s){super(),this.type="MeshBasicMaterial",this.color=new Dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this}}bl.prototype.isMeshBasicMaterial=!0;const Es=new J,Ag=new Qe;class Ni{constructor(s,a,u){if(Array.isArray(s))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=s,this.itemSize=a,this.count=void 0!==s?s.length/a:0,this.normalized=!0===u,this.usage=hd,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(s){!0===s&&this.version++}setUsage(s){return this.usage=s,this}copy(s){return this.name=s.name,this.array=new s.array.constructor(s.array),this.itemSize=s.itemSize,this.count=s.count,this.normalized=s.normalized,this.usage=s.usage,this}copyAt(s,a,u){s*=this.itemSize,u*=a.itemSize;for(let h=0,m=this.itemSize;h<m;h++)this.array[s+h]=a.array[u+h];return this}copyArray(s){return this.array.set(s),this}copyColorsArray(s){const a=this.array;let u=0;for(let h=0,m=s.length;h<m;h++){let g=s[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",h),g=new Dt),a[u++]=g.r,a[u++]=g.g,a[u++]=g.b}return this}copyVector2sArray(s){const a=this.array;let u=0;for(let h=0,m=s.length;h<m;h++){let g=s[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",h),g=new Qe),a[u++]=g.x,a[u++]=g.y}return this}copyVector3sArray(s){const a=this.array;let u=0;for(let h=0,m=s.length;h<m;h++){let g=s[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",h),g=new J),a[u++]=g.x,a[u++]=g.y,a[u++]=g.z}return this}copyVector4sArray(s){const a=this.array;let u=0;for(let h=0,m=s.length;h<m;h++){let g=s[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",h),g=new Xi),a[u++]=g.x,a[u++]=g.y,a[u++]=g.z,a[u++]=g.w}return this}applyMatrix3(s){if(2===this.itemSize)for(let a=0,u=this.count;a<u;a++)Ag.fromBufferAttribute(this,a),Ag.applyMatrix3(s),this.setXY(a,Ag.x,Ag.y);else if(3===this.itemSize)for(let a=0,u=this.count;a<u;a++)Es.fromBufferAttribute(this,a),Es.applyMatrix3(s),this.setXYZ(a,Es.x,Es.y,Es.z);return this}applyMatrix4(s){for(let a=0,u=this.count;a<u;a++)Es.fromBufferAttribute(this,a),Es.applyMatrix4(s),this.setXYZ(a,Es.x,Es.y,Es.z);return this}applyNormalMatrix(s){for(let a=0,u=this.count;a<u;a++)Es.fromBufferAttribute(this,a),Es.applyNormalMatrix(s),this.setXYZ(a,Es.x,Es.y,Es.z);return this}transformDirection(s){for(let a=0,u=this.count;a<u;a++)Es.fromBufferAttribute(this,a),Es.transformDirection(s),this.setXYZ(a,Es.x,Es.y,Es.z);return this}set(s,a=0){return this.array.set(s,a),this}getX(s){return this.array[s*this.itemSize]}setX(s,a){return this.array[s*this.itemSize]=a,this}getY(s){return this.array[s*this.itemSize+1]}setY(s,a){return this.array[s*this.itemSize+1]=a,this}getZ(s){return this.array[s*this.itemSize+2]}setZ(s,a){return this.array[s*this.itemSize+2]=a,this}getW(s){return this.array[s*this.itemSize+3]}setW(s,a){return this.array[s*this.itemSize+3]=a,this}setXY(s,a,u){return this.array[0+(s*=this.itemSize)]=a,this.array[s+1]=u,this}setXYZ(s,a,u,h){return this.array[0+(s*=this.itemSize)]=a,this.array[s+1]=u,this.array[s+2]=h,this}setXYZW(s,a,u,h,m){return this.array[0+(s*=this.itemSize)]=a,this.array[s+1]=u,this.array[s+2]=h,this.array[s+3]=m,this}onUpload(s){return this.onUploadCallback=s,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const s={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(s.name=this.name),this.usage!==hd&&(s.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(s.updateRange=this.updateRange),s}}Ni.prototype.isBufferAttribute=!0;class Zb extends Ni{constructor(s,a,u){super(new Int8Array(s),a,u)}}class gv extends Ni{constructor(s,a,u){super(new Uint8Array(s),a,u)}}class Jb extends Ni{constructor(s,a,u){super(new Uint8ClampedArray(s),a,u)}}class Qb extends Ni{constructor(s,a,u){super(new Int16Array(s),a,u)}}class ot extends Ni{constructor(s,a,u){super(new Uint16Array(s),a,u)}}class Ri extends Ni{constructor(s,a,u){super(new Int32Array(s),a,u)}}class vt extends Ni{constructor(s,a,u){super(new Uint32Array(s),a,u)}}class ds extends Ni{constructor(s,a,u){super(new Uint16Array(s),a,u)}}ds.prototype.isFloat16BufferAttribute=!0;class nn extends Ni{constructor(s,a,u){super(new Float32Array(s),a,u)}}class bd extends Ni{constructor(s,a,u){super(new Float64Array(s),a,u)}}let wl=0;const jo=new cn,cp=new Ci,up=new J,aa=new Do,Dg=new Do,Zr=new J;class en extends zc{constructor(){super(),Object.defineProperty(this,"id",{value:wl++}),this.uuid=wa(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(s){return this.index=Array.isArray(s)?new(ip(s)?vt:ot)(s,1):s,this}getAttribute(s){return this.attributes[s]}setAttribute(s,a){return this.attributes[s]=a,this}deleteAttribute(s){return delete this.attributes[s],this}hasAttribute(s){return void 0!==this.attributes[s]}addGroup(s,a,u=0){this.groups.push({start:s,count:a,materialIndex:u})}clearGroups(){this.groups=[]}setDrawRange(s,a){this.drawRange.start=s,this.drawRange.count=a}applyMatrix4(s){const a=this.attributes.position;void 0!==a&&(a.applyMatrix4(s),a.needsUpdate=!0);const u=this.attributes.normal;if(void 0!==u){const m=(new ir).getNormalMatrix(s);u.applyNormalMatrix(m),u.needsUpdate=!0}const h=this.attributes.tangent;return void 0!==h&&(h.transformDirection(s),h.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(s){return jo.makeRotationFromQuaternion(s),this.applyMatrix4(jo),this}rotateX(s){return jo.makeRotationX(s),this.applyMatrix4(jo),this}rotateY(s){return jo.makeRotationY(s),this.applyMatrix4(jo),this}rotateZ(s){return jo.makeRotationZ(s),this.applyMatrix4(jo),this}translate(s,a,u){return jo.makeTranslation(s,a,u),this.applyMatrix4(jo),this}scale(s,a,u){return jo.makeScale(s,a,u),this.applyMatrix4(jo),this}lookAt(s){return cp.lookAt(s),cp.updateMatrix(),this.applyMatrix4(cp.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(up).negate(),this.translate(up.x,up.y,up.z),this}setFromPoints(s){const a=[];for(let u=0,h=s.length;u<h;u++){const m=s[u];a.push(m.x,m.y,m.z||0)}return this.setAttribute("position",new nn(a,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Do);const s=this.attributes.position,a=this.morphAttributes.position;if(s&&s.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new J(-1/0,-1/0,-1/0),new J(1/0,1/0,1/0));if(void 0!==s){if(this.boundingBox.setFromBufferAttribute(s),a)for(let u=0,h=a.length;u<h;u++)aa.setFromBufferAttribute(a[u]),this.morphTargetsRelative?(Zr.addVectors(this.boundingBox.min,aa.min),this.boundingBox.expandByPoint(Zr),Zr.addVectors(this.boundingBox.max,aa.max),this.boundingBox.expandByPoint(Zr)):(this.boundingBox.expandByPoint(aa.min),this.boundingBox.expandByPoint(aa.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Wu);const s=this.attributes.position,a=this.morphAttributes.position;if(s&&s.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new J,1/0);if(s){const u=this.boundingSphere.center;if(aa.setFromBufferAttribute(s),a)for(let m=0,g=a.length;m<g;m++)Dg.setFromBufferAttribute(a[m]),this.morphTargetsRelative?(Zr.addVectors(aa.min,Dg.min),aa.expandByPoint(Zr),Zr.addVectors(aa.max,Dg.max),aa.expandByPoint(Zr)):(aa.expandByPoint(Dg.min),aa.expandByPoint(Dg.max));aa.getCenter(u);let h=0;for(let m=0,g=s.count;m<g;m++)Zr.fromBufferAttribute(s,m),h=Math.max(h,u.distanceToSquared(Zr));if(a)for(let m=0,g=a.length;m<g;m++){const _=a[m],w=this.morphTargetsRelative;for(let M=0,C=_.count;M<C;M++)Zr.fromBufferAttribute(_,M),w&&(up.fromBufferAttribute(s,M),Zr.add(up)),h=Math.max(h,u.distanceToSquared(Zr))}this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const s=this.index,a=this.attributes;if(null===s||void 0===a.position||void 0===a.normal||void 0===a.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const u=s.array,h=a.position.array,m=a.normal.array,g=a.uv.array,_=h.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Ni(new Float32Array(4*_),4));const w=this.getAttribute("tangent").array,M=[],C=[];for(let we=0;we<_;we++)M[we]=new J,C[we]=new J;const A=new J,D=new J,R=new J,L=new Qe,P=new Qe,I=new Qe,z=new J,B=new J;function j(we,X,he){A.fromArray(h,3*we),D.fromArray(h,3*X),R.fromArray(h,3*he),L.fromArray(g,2*we),P.fromArray(g,2*X),I.fromArray(g,2*he),D.sub(A),R.sub(A),P.sub(L),I.sub(L);const ft=1/(P.x*I.y-I.x*P.y);!isFinite(ft)||(z.copy(D).multiplyScalar(I.y).addScaledVector(R,-P.y).multiplyScalar(ft),B.copy(R).multiplyScalar(P.x).addScaledVector(D,-I.x).multiplyScalar(ft),M[we].add(z),M[X].add(z),M[he].add(z),C[we].add(B),C[X].add(B),C[he].add(B))}let G=this.groups;0===G.length&&(G=[{start:0,count:u.length}]);for(let we=0,X=G.length;we<X;++we){const he=G[we],ft=he.start;for(let Be=ft,Ie=ft+he.count;Be<Ie;Be+=3)j(u[Be+0],u[Be+1],u[Be+2])}const Y=new J,le=new J,fe=new J,ye=new J;function Ve(we){fe.fromArray(m,3*we),ye.copy(fe);const X=M[we];Y.copy(X),Y.sub(fe.multiplyScalar(fe.dot(X))).normalize(),le.crossVectors(ye,X);const ft=le.dot(C[we])<0?-1:1;w[4*we]=Y.x,w[4*we+1]=Y.y,w[4*we+2]=Y.z,w[4*we+3]=ft}for(let we=0,X=G.length;we<X;++we){const he=G[we],ft=he.start;for(let Be=ft,Ie=ft+he.count;Be<Ie;Be+=3)Ve(u[Be+0]),Ve(u[Be+1]),Ve(u[Be+2])}}computeVertexNormals(){const s=this.index,a=this.getAttribute("position");if(void 0!==a){let u=this.getAttribute("normal");if(void 0===u)u=new Ni(new Float32Array(3*a.count),3),this.setAttribute("normal",u);else for(let D=0,R=u.count;D<R;D++)u.setXYZ(D,0,0,0);const h=new J,m=new J,g=new J,_=new J,w=new J,M=new J,C=new J,A=new J;if(s)for(let D=0,R=s.count;D<R;D+=3){const L=s.getX(D+0),P=s.getX(D+1),I=s.getX(D+2);h.fromBufferAttribute(a,L),m.fromBufferAttribute(a,P),g.fromBufferAttribute(a,I),C.subVectors(g,m),A.subVectors(h,m),C.cross(A),_.fromBufferAttribute(u,L),w.fromBufferAttribute(u,P),M.fromBufferAttribute(u,I),_.add(C),w.add(C),M.add(C),u.setXYZ(L,_.x,_.y,_.z),u.setXYZ(P,w.x,w.y,w.z),u.setXYZ(I,M.x,M.y,M.z)}else for(let D=0,R=a.count;D<R;D+=3)h.fromBufferAttribute(a,D+0),m.fromBufferAttribute(a,D+1),g.fromBufferAttribute(a,D+2),C.subVectors(g,m),A.subVectors(h,m),C.cross(A),u.setXYZ(D+0,C.x,C.y,C.z),u.setXYZ(D+1,C.x,C.y,C.z),u.setXYZ(D+2,C.x,C.y,C.z);this.normalizeNormals(),u.needsUpdate=!0}}merge(s,a){if(!s||!s.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",s);void 0===a&&(a=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const u=this.attributes;for(const h in u){if(void 0===s.attributes[h])continue;const g=u[h].array,_=s.attributes[h],w=_.array,M=_.itemSize*a,C=Math.min(w.length,g.length-M);for(let A=0,D=M;A<C;A++,D++)g[D]=w[A]}return this}normalizeNormals(){const s=this.attributes.normal;for(let a=0,u=s.count;a<u;a++)Zr.fromBufferAttribute(s,a),Zr.normalize(),s.setXYZ(a,Zr.x,Zr.y,Zr.z)}toNonIndexed(){function s(_,w){const M=_.array,C=_.itemSize,A=_.normalized,D=new M.constructor(w.length*C);let R=0,L=0;for(let P=0,I=w.length;P<I;P++){R=_.isInterleavedBufferAttribute?w[P]*_.data.stride+_.offset:w[P]*C;for(let z=0;z<C;z++)D[L++]=M[R++]}return new Ni(D,C,A)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const a=new en,u=this.index.array,h=this.attributes;for(const _ in h){const M=s(h[_],u);a.setAttribute(_,M)}const m=this.morphAttributes;for(const _ in m){const w=[],M=m[_];for(let C=0,A=M.length;C<A;C++){const R=s(M[C],u);w.push(R)}a.morphAttributes[_]=w}a.morphTargetsRelative=this.morphTargetsRelative;const g=this.groups;for(let _=0,w=g.length;_<w;_++){const M=g[_];a.addGroup(M.start,M.count,M.materialIndex)}return a}toJSON(){const s={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),Object.keys(this.userData).length>0&&(s.userData=this.userData),void 0!==this.parameters){const w=this.parameters;for(const M in w)void 0!==w[M]&&(s[M]=w[M]);return s}s.data={attributes:{}};const a=this.index;null!==a&&(s.data.index={type:a.array.constructor.name,array:Array.prototype.slice.call(a.array)});const u=this.attributes;for(const w in u)s.data.attributes[w]=u[w].toJSON(s.data);const h={};let m=!1;for(const w in this.morphAttributes){const M=this.morphAttributes[w],C=[];for(let A=0,D=M.length;A<D;A++)C.push(M[A].toJSON(s.data));C.length>0&&(h[w]=C,m=!0)}m&&(s.data.morphAttributes=h,s.data.morphTargetsRelative=this.morphTargetsRelative);const g=this.groups;g.length>0&&(s.data.groups=JSON.parse(JSON.stringify(g)));const _=this.boundingSphere;return null!==_&&(s.data.boundingSphere={center:_.center.toArray(),radius:_.radius}),s}clone(){return(new this.constructor).copy(this)}copy(s){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const a={};this.name=s.name;const u=s.index;null!==u&&this.setIndex(u.clone(a));const h=s.attributes;for(const M in h)this.setAttribute(M,h[M].clone(a));const m=s.morphAttributes;for(const M in m){const C=[],A=m[M];for(let D=0,R=A.length;D<R;D++)C.push(A[D].clone(a));this.morphAttributes[M]=C}this.morphTargetsRelative=s.morphTargetsRelative;const g=s.groups;for(let M=0,C=g.length;M<C;M++){const A=g[M];this.addGroup(A.start,A.count,A.materialIndex)}const _=s.boundingBox;null!==_&&(this.boundingBox=_.clone());const w=s.boundingSphere;return null!==w&&(this.boundingSphere=w.clone()),this.drawRange.start=s.drawRange.start,this.drawRange.count=s.drawRange.count,this.userData=s.userData,void 0!==s.parameters&&(this.parameters=Object.assign({},s.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}en.prototype.isBufferGeometry=!0;const Ml=new cn,qu=new Wo,jc=new Wu,mo=new J,Xc=new J,sc=new J,yv=new J,_v=new J,hp=new J,wd=new J,dp=new J,Md=new J,Rg=new Qe,fp=new Qe,ju=new Qe,Pg=new J,pp=new J;class Jr extends Ci{constructor(s=new en,a=new bl){super(),this.type="Mesh",this.geometry=s,this.material=a,this.updateMorphTargets()}copy(s){return super.copy(s),void 0!==s.morphTargetInfluences&&(this.morphTargetInfluences=s.morphTargetInfluences.slice()),void 0!==s.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},s.morphTargetDictionary)),this.material=s.material,this.geometry=s.geometry,this}updateMorphTargets(){const s=this.geometry;if(s.isBufferGeometry){const a=s.morphAttributes,u=Object.keys(a);if(u.length>0){const h=a[u[0]];if(void 0!==h){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,g=h.length;m<g;m++){const _=h[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=m}}}}else{const a=s.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(s,a){const u=this.geometry,h=this.material,m=this.matrixWorld;if(void 0===h||(null===u.boundingSphere&&u.computeBoundingSphere(),jc.copy(u.boundingSphere),jc.applyMatrix4(m),!1===s.ray.intersectsSphere(jc))||(Ml.copy(m).invert(),qu.copy(s.ray).applyMatrix4(Ml),null!==u.boundingBox&&!1===qu.intersectsBox(u.boundingBox)))return;let g;if(u.isBufferGeometry){const _=u.index,w=u.attributes.position,M=u.morphAttributes.position,C=u.morphTargetsRelative,A=u.attributes.uv,D=u.attributes.uv2,R=u.groups,L=u.drawRange;if(null!==_)if(Array.isArray(h))for(let P=0,I=R.length;P<I;P++){const z=R[P],B=h[z.materialIndex];for(let Y=Math.max(z.start,L.start),le=Math.min(_.count,Math.min(z.start+z.count,L.start+L.count));Y<le;Y+=3){const fe=_.getX(Y),ye=_.getX(Y+1),Ve=_.getX(Y+2);g=Xu(this,B,s,qu,w,M,C,A,D,fe,ye,Ve),g&&(g.faceIndex=Math.floor(Y/3),g.face.materialIndex=z.materialIndex,a.push(g))}}else for(let z=Math.max(0,L.start),B=Math.min(_.count,L.start+L.count);z<B;z+=3){const j=_.getX(z),G=_.getX(z+1),Y=_.getX(z+2);g=Xu(this,h,s,qu,w,M,C,A,D,j,G,Y),g&&(g.faceIndex=Math.floor(z/3),a.push(g))}else if(void 0!==w)if(Array.isArray(h))for(let P=0,I=R.length;P<I;P++){const z=R[P],B=h[z.materialIndex];for(let Y=Math.max(z.start,L.start),le=Math.min(w.count,Math.min(z.start+z.count,L.start+L.count));Y<le;Y+=3)g=Xu(this,B,s,qu,w,M,C,A,D,Y,Y+1,Y+2),g&&(g.faceIndex=Math.floor(Y/3),g.face.materialIndex=z.materialIndex,a.push(g))}else for(let z=Math.max(0,L.start),B=Math.min(w.count,L.start+L.count);z<B;z+=3)g=Xu(this,h,s,qu,w,M,C,A,D,z,z+1,z+2),g&&(g.faceIndex=Math.floor(z/3),a.push(g))}else u.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Xu(f,s,a,u,h,m,g,_,w,M,C,A){mo.fromBufferAttribute(h,M),Xc.fromBufferAttribute(h,C),sc.fromBufferAttribute(h,A);const D=f.morphTargetInfluences;if(m&&D){wd.set(0,0,0),dp.set(0,0,0),Md.set(0,0,0);for(let L=0,P=m.length;L<P;L++){const I=D[L],z=m[L];0!==I&&(yv.fromBufferAttribute(z,M),_v.fromBufferAttribute(z,C),hp.fromBufferAttribute(z,A),g?(wd.addScaledVector(yv,I),dp.addScaledVector(_v,I),Md.addScaledVector(hp,I)):(wd.addScaledVector(yv.sub(mo),I),dp.addScaledVector(_v.sub(Xc),I),Md.addScaledVector(hp.sub(sc),I)))}mo.add(wd),Xc.add(dp),sc.add(Md)}f.isSkinnedMesh&&(f.boneTransform(M,mo),f.boneTransform(C,Xc),f.boneTransform(A,sc));const R=function ew(f,s,a,u,h,m,g,_){let w;if(w=1===s.side?u.intersectTriangle(g,m,h,!0,_):u.intersectTriangle(h,m,g,2!==s.side,_),null===w)return null;pp.copy(_),pp.applyMatrix4(f.matrixWorld);const M=a.ray.origin.distanceTo(pp);return M<a.near||M>a.far?null:{distance:M,point:pp.clone(),object:f}}(f,s,a,u,mo,Xc,sc,Pg);if(R){_&&(Rg.fromBufferAttribute(_,M),fp.fromBufferAttribute(_,C),ju.fromBufferAttribute(_,A),R.uv=Gr.getUV(Pg,mo,Xc,sc,Rg,fp,ju,new Qe)),w&&(Rg.fromBufferAttribute(w,M),fp.fromBufferAttribute(w,C),ju.fromBufferAttribute(w,A),R.uv2=Gr.getUV(Pg,mo,Xc,sc,Rg,fp,ju,new Qe));const L={a:M,b:C,c:A,normal:new J,materialIndex:0};Gr.getNormal(mo,Xc,sc,L.normal),R.face=L}return R}Jr.prototype.isMesh=!0;class oc extends en{constructor(s=1,a=1,u=1,h=1,m=1,g=1){super(),this.type="BoxGeometry",this.parameters={width:s,height:a,depth:u,widthSegments:h,heightSegments:m,depthSegments:g};const _=this;h=Math.floor(h),m=Math.floor(m),g=Math.floor(g);const w=[],M=[],C=[],A=[];let D=0,R=0;function L(P,I,z,B,j,G,Y,le,fe,ye,Ve){const we=G/fe,X=Y/ye,he=G/2,ft=Y/2,Ee=le/2,Be=fe+1,Ie=ye+1;let je=0,Me=0;const lt=new J;for(let dt=0;dt<Ie;dt++){const wt=dt*X-ft;for(let mt=0;mt<Be;mt++)lt[P]=(mt*we-he)*B,lt[I]=wt*j,lt[z]=Ee,M.push(lt.x,lt.y,lt.z),lt[P]=0,lt[I]=0,lt[z]=le>0?1:-1,C.push(lt.x,lt.y,lt.z),A.push(mt/fe),A.push(1-dt/ye),je+=1}for(let dt=0;dt<ye;dt++)for(let wt=0;wt<fe;wt++){const bn=D+wt+Be*(dt+1),yi=D+(wt+1)+Be*(dt+1),$n=D+(wt+1)+Be*dt;w.push(D+wt+Be*dt,bn,$n),w.push(bn,yi,$n),Me+=6}_.addGroup(R,Me,Ve),R+=Me,D+=je}L("z","y","x",-1,-1,u,a,s,g,m,0),L("z","y","x",1,-1,u,a,-s,g,m,1),L("x","z","y",1,1,s,u,a,h,g,2),L("x","z","y",1,-1,s,u,-a,h,g,3),L("x","y","z",1,-1,s,a,u,h,m,4),L("x","y","z",-1,-1,s,a,-u,h,m,5),this.setIndex(w),this.setAttribute("position",new nn(M,3)),this.setAttribute("normal",new nn(C,3)),this.setAttribute("uv",new nn(A,2))}static fromJSON(s){return new oc(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments)}}function Sd(f){const s={};for(const a in f){s[a]={};for(const u in f[a]){const h=f[a][u];s[a][u]=h&&(h.isColor||h.isMatrix3||h.isMatrix4||h.isVector2||h.isVector3||h.isVector4||h.isTexture||h.isQuaternion)?h.clone():Array.isArray(h)?h.slice():h}}return s}function rr(f){const s={};for(let a=0;a<f.length;a++){const u=Sd(f[a]);for(const h in u)s[h]=u[h]}return s}const ac={clone:Sd,merge:rr};class Ra extends Qt{constructor(s){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==s&&(void 0!==s.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(s))}copy(s){return super.copy(s),this.fragmentShader=s.fragmentShader,this.vertexShader=s.vertexShader,this.uniforms=Sd(s.uniforms),this.defines=Object.assign({},s.defines),this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.lights=s.lights,this.clipping=s.clipping,this.extensions=Object.assign({},s.extensions),this.glslVersion=s.glslVersion,this}toJSON(s){const a=super.toJSON(s);a.glslVersion=this.glslVersion,a.uniforms={};for(const h in this.uniforms){const g=this.uniforms[h].value;a.uniforms[h]=g&&g.isTexture?{type:"t",value:g.toJSON(s).uuid}:g&&g.isColor?{type:"c",value:g.getHex()}:g&&g.isVector2?{type:"v2",value:g.toArray()}:g&&g.isVector3?{type:"v3",value:g.toArray()}:g&&g.isVector4?{type:"v4",value:g.toArray()}:g&&g.isMatrix3?{type:"m3",value:g.toArray()}:g&&g.isMatrix4?{type:"m4",value:g.toArray()}:{value:g}}Object.keys(this.defines).length>0&&(a.defines=this.defines),a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader;const u={};for(const h in this.extensions)!0===this.extensions[h]&&(u[h]=!0);return Object.keys(u).length>0&&(a.extensions=u),a}}Ra.prototype.isShaderMaterial=!0;class mp extends Ci{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new cn,this.projectionMatrix=new cn,this.projectionMatrixInverse=new cn}copy(s,a){return super.copy(s,a),this.matrixWorldInverse.copy(s.matrixWorldInverse),this.projectionMatrix.copy(s.projectionMatrix),this.projectionMatrixInverse.copy(s.projectionMatrixInverse),this}getWorldDirection(s){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return s.set(-a[8],-a[9],-a[10]).normalize()}updateMatrixWorld(s){super.updateMatrixWorld(s),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(s,a){super.updateWorldMatrix(s,a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}mp.prototype.isCamera=!0;class Os extends mp{constructor(s=50,a=1,u=.1,h=2e3){super(),this.type="PerspectiveCamera",this.fov=s,this.zoom=1,this.near=u,this.far=h,this.focus=10,this.aspect=a,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(s,a){return super.copy(s,a),this.fov=s.fov,this.zoom=s.zoom,this.near=s.near,this.far=s.far,this.focus=s.focus,this.aspect=s.aspect,this.view=null===s.view?null:Object.assign({},s.view),this.filmGauge=s.filmGauge,this.filmOffset=s.filmOffset,this}setFocalLength(s){const a=.5*this.getFilmHeight()/s;this.fov=2*ji*Math.atan(a),this.updateProjectionMatrix()}getFocalLength(){const s=Math.tan(.5*dd*this.fov);return.5*this.getFilmHeight()/s}getEffectiveFOV(){return 2*ji*Math.atan(Math.tan(.5*dd*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(s,a,u,h,m,g){this.aspect=s/a,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=s,this.view.fullHeight=a,this.view.offsetX=u,this.view.offsetY=h,this.view.width=m,this.view.height=g,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const s=this.near;let a=s*Math.tan(.5*dd*this.fov)/this.zoom,u=2*a,h=this.aspect*u,m=-.5*h;const g=this.view;if(null!==this.view&&this.view.enabled){const w=g.fullWidth,M=g.fullHeight;m+=g.offsetX*h/w,a-=g.offsetY*u/M,h*=g.width/w,u*=g.height/M}const _=this.filmOffset;0!==_&&(m+=s*_/this.getFilmWidth()),this.projectionMatrix.makePerspective(m,m+h,a,a-u,s,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(s){const a=super.toJSON(s);return a.object.fov=this.fov,a.object.zoom=this.zoom,a.object.near=this.near,a.object.far=this.far,a.object.focus=this.focus,a.object.aspect=this.aspect,null!==this.view&&(a.object.view=Object.assign({},this.view)),a.object.filmGauge=this.filmGauge,a.object.filmOffset=this.filmOffset,a}}Os.prototype.isPerspectiveCamera=!0;class $u extends Ci{constructor(s,a,u){if(super(),this.type="CubeCamera",!0!==u.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=u;const h=new Os(90,1,s,a);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new J(1,0,0)),this.add(h);const m=new Os(90,1,s,a);m.layers=this.layers,m.up.set(0,-1,0),m.lookAt(new J(-1,0,0)),this.add(m);const g=new Os(90,1,s,a);g.layers=this.layers,g.up.set(0,0,1),g.lookAt(new J(0,1,0)),this.add(g);const _=new Os(90,1,s,a);_.layers=this.layers,_.up.set(0,0,-1),_.lookAt(new J(0,-1,0)),this.add(_);const w=new Os(90,1,s,a);w.layers=this.layers,w.up.set(0,-1,0),w.lookAt(new J(0,0,1)),this.add(w);const M=new Os(90,1,s,a);M.layers=this.layers,M.up.set(0,-1,0),M.lookAt(new J(0,0,-1)),this.add(M)}update(s,a){null===this.parent&&this.updateMatrixWorld();const u=this.renderTarget,[h,m,g,_,w,M]=this.children,C=s.getRenderTarget(),A=s.outputEncoding,D=s.toneMapping,R=s.xr.enabled;s.outputEncoding=Ls,s.toneMapping=0,s.xr.enabled=!1;const L=u.texture.generateMipmaps;u.texture.generateMipmaps=!1,s.setRenderTarget(u,0),s.render(a,h),s.setRenderTarget(u,1),s.render(a,m),s.setRenderTarget(u,2),s.render(a,g),s.setRenderTarget(u,3),s.render(a,_),s.setRenderTarget(u,4),s.render(a,w),u.texture.generateMipmaps=L,s.setRenderTarget(u,5),s.render(a,M),s.setRenderTarget(C),s.outputEncoding=A,s.toneMapping=D,s.xr.enabled=R,u.texture.needsPMREMUpdate=!0}}class lc extends ls{constructor(s,a,u,h,m,g,_,w,M,C){super(s=void 0!==s?s:[],a=void 0!==a?a:Bi,u,h,m,g,_,w,M,C),this.flipY=!1}get images(){return this.image}set images(s){this.image=s}}lc.prototype.isCubeTexture=!0;class Yu extends cs{constructor(s,a={}){super(s,s,a);const u={width:s,height:s,depth:1};this.texture=new lc([u,u,u,u,u,u],a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,this.texture.minFilter=void 0!==a.minFilter?a.minFilter:Hr}fromEquirectangularTexture(s,a){this.texture.type=a.type,this.texture.encoding=a.encoding,this.texture.generateMipmaps=a.generateMipmaps,this.texture.minFilter=a.minFilter,this.texture.magFilter=a.magFilter;const u_uniforms={tEquirect:{value:null}},u_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",u_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",h=new oc(5,5,5),m=new Ra({name:"CubemapFromEquirect",uniforms:Sd(u_uniforms),vertexShader:u_vertexShader,fragmentShader:u_fragmentShader,side:1,blending:0});m.uniforms.tEquirect.value=a;const g=new Jr(h,m),_=a.minFilter;return a.minFilter===Ya&&(a.minFilter=Hr),new $u(1,10,this).update(s,g),a.minFilter=_,g.geometry.dispose(),g.material.dispose(),this}clear(s,a,u,h){const m=s.getRenderTarget();for(let g=0;g<6;g++)s.setRenderTarget(this,g),s.clear(a,u,h);s.setRenderTarget(m)}}Yu.prototype.isWebGLCubeRenderTarget=!0;const gp=new J,nw=new J,KT=new ir;class io{constructor(s=new J(1,0,0),a=0){this.normal=s,this.constant=a}set(s,a){return this.normal.copy(s),this.constant=a,this}setComponents(s,a,u,h){return this.normal.set(s,a,u),this.constant=h,this}setFromNormalAndCoplanarPoint(s,a){return this.normal.copy(s),this.constant=-a.dot(this.normal),this}setFromCoplanarPoints(s,a,u){const h=gp.subVectors(u,a).cross(nw.subVectors(s,a)).normalize();return this.setFromNormalAndCoplanarPoint(h,s),this}copy(s){return this.normal.copy(s.normal),this.constant=s.constant,this}normalize(){const s=1/this.normal.length();return this.normal.multiplyScalar(s),this.constant*=s,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(s){return this.normal.dot(s)+this.constant}distanceToSphere(s){return this.distanceToPoint(s.center)-s.radius}projectPoint(s,a){return a.copy(this.normal).multiplyScalar(-this.distanceToPoint(s)).add(s)}intersectLine(s,a){const u=s.delta(gp),h=this.normal.dot(u);if(0===h)return 0===this.distanceToPoint(s.start)?a.copy(s.start):null;const m=-(s.start.dot(this.normal)+this.constant)/h;return m<0||m>1?null:a.copy(u).multiplyScalar(m).add(s.start)}intersectsLine(s){const a=this.distanceToPoint(s.start),u=this.distanceToPoint(s.end);return a<0&&u>0||u<0&&a>0}intersectsBox(s){return s.intersectsPlane(this)}intersectsSphere(s){return s.intersectsPlane(this)}coplanarPoint(s){return s.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(s,a){const u=a||KT.getNormalMatrix(s),h=this.coplanarPoint(gp).applyMatrix4(s),m=this.normal.applyMatrix3(u).normalize();return this.constant=-h.dot(m),this}translate(s){return this.constant-=s.dot(this.normal),this}equals(s){return s.normal.equals(this.normal)&&s.constant===this.constant}clone(){return(new this.constructor).copy(this)}}io.prototype.isPlane=!0;const Sl=new Wu,Ig=new J;class yp{constructor(s=new io,a=new io,u=new io,h=new io,m=new io,g=new io){this.planes=[s,a,u,h,m,g]}set(s,a,u,h,m,g){const _=this.planes;return _[0].copy(s),_[1].copy(a),_[2].copy(u),_[3].copy(h),_[4].copy(m),_[5].copy(g),this}copy(s){const a=this.planes;for(let u=0;u<6;u++)a[u].copy(s.planes[u]);return this}setFromProjectionMatrix(s){const a=this.planes,u=s.elements,h=u[0],m=u[1],g=u[2],_=u[3],w=u[4],M=u[5],C=u[6],A=u[7],D=u[8],R=u[9],L=u[10],P=u[11],I=u[12],z=u[13],B=u[14],j=u[15];return a[0].setComponents(_-h,A-w,P-D,j-I).normalize(),a[1].setComponents(_+h,A+w,P+D,j+I).normalize(),a[2].setComponents(_+m,A+M,P+R,j+z).normalize(),a[3].setComponents(_-m,A-M,P-R,j-z).normalize(),a[4].setComponents(_-g,A-C,P-L,j-B).normalize(),a[5].setComponents(_+g,A+C,P+L,j+B).normalize(),this}intersectsObject(s){const a=s.geometry;return null===a.boundingSphere&&a.computeBoundingSphere(),Sl.copy(a.boundingSphere).applyMatrix4(s.matrixWorld),this.intersectsSphere(Sl)}intersectsSprite(s){return Sl.center.set(0,0,0),Sl.radius=.7071067811865476,Sl.applyMatrix4(s.matrixWorld),this.intersectsSphere(Sl)}intersectsSphere(s){const a=this.planes,u=s.center,h=-s.radius;for(let m=0;m<6;m++)if(a[m].distanceToPoint(u)<h)return!1;return!0}intersectsBox(s){const a=this.planes;for(let u=0;u<6;u++){const h=a[u];if(Ig.x=h.normal.x>0?s.max.x:s.min.x,Ig.y=h.normal.y>0?s.max.y:s.min.y,Ig.z=h.normal.z>0?s.max.z:s.min.z,h.distanceToPoint(Ig)<0)return!1}return!0}containsPoint(s){const a=this.planes;for(let u=0;u<6;u++)if(a[u].distanceToPoint(s)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Td(){let f=null,s=!1,a=null,u=null;function h(m,g){a(m,g),u=f.requestAnimationFrame(h)}return{start:function(){!0!==s&&null!==a&&(u=f.requestAnimationFrame(h),s=!0)},stop:function(){f.cancelAnimationFrame(u),s=!1},setAnimationLoop:function(m){a=m},setContext:function(m){f=m}}}function vv(f,s){const a=s.isWebGL2,u=new WeakMap;return{get:function g(M){return M.isInterleavedBufferAttribute&&(M=M.data),u.get(M)},remove:function _(M){M.isInterleavedBufferAttribute&&(M=M.data);const C=u.get(M);C&&(f.deleteBuffer(C.buffer),u.delete(M))},update:function w(M,C){if(M.isGLBufferAttribute){const D=u.get(M);return void((!D||D.version<M.version)&&u.set(M,{buffer:M.buffer,type:M.type,bytesPerElement:M.elementSize,version:M.version}))}M.isInterleavedBufferAttribute&&(M=M.data);const A=u.get(M);void 0===A?u.set(M,function h(M,C){const A=M.array,D=M.usage,R=f.createBuffer();let L;if(f.bindBuffer(C,R),f.bufferData(C,A,D),M.onUploadCallback(),A instanceof Float32Array)L=f.FLOAT;else if(A instanceof Uint16Array)if(M.isFloat16BufferAttribute){if(!a)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");L=f.HALF_FLOAT}else L=f.UNSIGNED_SHORT;else if(A instanceof Int16Array)L=f.SHORT;else if(A instanceof Uint32Array)L=f.UNSIGNED_INT;else if(A instanceof Int32Array)L=f.INT;else if(A instanceof Int8Array)L=f.BYTE;else if(A instanceof Uint8Array)L=f.UNSIGNED_BYTE;else{if(!(A instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+A);L=f.UNSIGNED_BYTE}return{buffer:R,type:L,bytesPerElement:A.BYTES_PER_ELEMENT,version:M.version}}(M,C)):A.version<M.version&&(function m(M,C,A){const D=C.array,R=C.updateRange;f.bindBuffer(A,M),-1===R.count?f.bufferSubData(A,0,D):(a?f.bufferSubData(A,R.offset*D.BYTES_PER_ELEMENT,D,R.offset,R.count):f.bufferSubData(A,R.offset*D.BYTES_PER_ELEMENT,D.subarray(R.offset,R.offset+R.count)),R.count=-1)}(A.buffer,M,C),A.version=M.version)}}}class Ku extends en{constructor(s=1,a=1,u=1,h=1){super(),this.type="PlaneGeometry",this.parameters={width:s,height:a,widthSegments:u,heightSegments:h};const m=s/2,g=a/2,_=Math.floor(u),w=Math.floor(h),M=_+1,C=w+1,A=s/_,D=a/w,R=[],L=[],P=[],I=[];for(let z=0;z<C;z++){const B=z*D-g;for(let j=0;j<M;j++)L.push(j*A-m,-B,0),P.push(0,0,1),I.push(j/_),I.push(1-z/w)}for(let z=0;z<w;z++)for(let B=0;B<_;B++){const G=B+M*(z+1),Y=B+1+M*(z+1),le=B+1+M*z;R.push(B+M*z,G,le),R.push(G,Y,le)}this.setIndex(R),this.setAttribute("position",new nn(L,3)),this.setAttribute("normal",new nn(P,3)),this.setAttribute("uv",new nn(I,2))}static fromJSON(s){return new Ku(s.width,s.height,s.widthSegments,s.heightSegments)}}const oi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Rt={common:{diffuse:{value:new Dt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ir},uv2Transform:{value:new ir},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Qe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Dt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Dt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ir}},sprite:{diffuse:{value:new Dt(16777215)},opacity:{value:1},center:{value:new Qe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ir}}},Ia={basic:{uniforms:rr([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.fog]),vertexShader:oi.meshbasic_vert,fragmentShader:oi.meshbasic_frag},lambert:{uniforms:rr([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.fog,Rt.lights,{emissive:{value:new Dt(0)}}]),vertexShader:oi.meshlambert_vert,fragmentShader:oi.meshlambert_frag},phong:{uniforms:rr([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,Rt.lights,{emissive:{value:new Dt(0)},specular:{value:new Dt(1118481)},shininess:{value:30}}]),vertexShader:oi.meshphong_vert,fragmentShader:oi.meshphong_frag},standard:{uniforms:rr([Rt.common,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.roughnessmap,Rt.metalnessmap,Rt.fog,Rt.lights,{emissive:{value:new Dt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag},toon:{uniforms:rr([Rt.common,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.gradientmap,Rt.fog,Rt.lights,{emissive:{value:new Dt(0)}}]),vertexShader:oi.meshtoon_vert,fragmentShader:oi.meshtoon_frag},matcap:{uniforms:rr([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,{matcap:{value:null}}]),vertexShader:oi.meshmatcap_vert,fragmentShader:oi.meshmatcap_frag},points:{uniforms:rr([Rt.points,Rt.fog]),vertexShader:oi.points_vert,fragmentShader:oi.points_frag},dashed:{uniforms:rr([Rt.common,Rt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oi.linedashed_vert,fragmentShader:oi.linedashed_frag},depth:{uniforms:rr([Rt.common,Rt.displacementmap]),vertexShader:oi.depth_vert,fragmentShader:oi.depth_frag},normal:{uniforms:rr([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,{opacity:{value:1}}]),vertexShader:oi.meshnormal_vert,fragmentShader:oi.meshnormal_frag},sprite:{uniforms:rr([Rt.sprite,Rt.fog]),vertexShader:oi.sprite_vert,fragmentShader:oi.sprite_frag},background:{uniforms:{uvTransform:{value:new ir},t2D:{value:null}},vertexShader:oi.background_vert,fragmentShader:oi.background_frag},cube:{uniforms:rr([Rt.envmap,{opacity:{value:1}}]),vertexShader:oi.cube_vert,fragmentShader:oi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oi.equirect_vert,fragmentShader:oi.equirect_frag},distanceRGBA:{uniforms:rr([Rt.common,Rt.displacementmap,{referencePosition:{value:new J},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oi.distanceRGBA_vert,fragmentShader:oi.distanceRGBA_frag},shadow:{uniforms:rr([Rt.lights,Rt.fog,{color:{value:new Dt(0)},opacity:{value:1}}]),vertexShader:oi.shadow_vert,fragmentShader:oi.shadow_frag}};function Ew(f,s,a,u,h,m){const g=new Dt(0);let w,M,_=!0===h?0:1,C=null,A=0,D=null;function L(P,I){a.buffers.color.setClear(P.r,P.g,P.b,I,m)}return{getClearColor:function(){return g},setClearColor:function(P,I=1){g.set(P),_=I,L(g,_)},getClearAlpha:function(){return _},setClearAlpha:function(P){_=P,L(g,_)},render:function R(P,I){let z=!1,B=!0===I.isScene?I.background:null;B&&B.isTexture&&(B=s.get(B));const j=f.xr,G=j.getSession&&j.getSession();G&&"additive"===G.environmentBlendMode&&(B=null),null===B?L(g,_):B&&B.isColor&&(L(B,1),z=!0),(f.autoClear||z)&&f.clear(f.autoClearColor,f.autoClearDepth,f.autoClearStencil),B&&(B.isCubeTexture||306===B.mapping)?(void 0===M&&(M=new Jr(new oc(1,1,1),new Ra({name:"BackgroundCubeMaterial",uniforms:Sd(Ia.cube.uniforms),vertexShader:Ia.cube.vertexShader,fragmentShader:Ia.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),M.geometry.deleteAttribute("normal"),M.geometry.deleteAttribute("uv"),M.onBeforeRender=function(Y,le,fe){this.matrixWorld.copyPosition(fe.matrixWorld)},Object.defineProperty(M.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),u.update(M)),M.material.uniforms.envMap.value=B,M.material.uniforms.flipEnvMap.value=B.isCubeTexture&&!1===B.isRenderTargetTexture?-1:1,(C!==B||A!==B.version||D!==f.toneMapping)&&(M.material.needsUpdate=!0,C=B,A=B.version,D=f.toneMapping),P.unshift(M,M.geometry,M.material,0,0,null)):B&&B.isTexture&&(void 0===w&&(w=new Jr(new Ku(2,2),new Ra({name:"BackgroundMaterial",uniforms:Sd(Ia.background.uniforms),vertexShader:Ia.background.vertexShader,fragmentShader:Ia.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),Object.defineProperty(w.material,"map",{get:function(){return this.uniforms.t2D.value}}),u.update(w)),w.material.uniforms.t2D.value=B,!0===B.matrixAutoUpdate&&B.updateMatrix(),w.material.uniforms.uvTransform.value.copy(B.matrix),(C!==B||A!==B.version||D!==f.toneMapping)&&(w.material.needsUpdate=!0,C=B,A=B.version,D=f.toneMapping),P.unshift(w,w.geometry,w.material,0,0,null))}}}function Cw(f,s,a,u){const h=f.getParameter(f.MAX_VERTEX_ATTRIBS),m=u.isWebGL2?null:s.get("OES_vertex_array_object"),g=u.isWebGL2||null!==m,_={},w=I(null);let M=w,C=!1;function R(Ee){return u.isWebGL2?f.bindVertexArray(Ee):m.bindVertexArrayOES(Ee)}function L(Ee){return u.isWebGL2?f.deleteVertexArray(Ee):m.deleteVertexArrayOES(Ee)}function I(Ee){const Be=[],Ie=[],je=[];for(let Me=0;Me<h;Me++)Be[Me]=0,Ie[Me]=0,je[Me]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Be,enabledAttributes:Ie,attributeDivisors:je,object:Ee,attributes:{},index:null}}function j(){const Ee=M.newAttributes;for(let Be=0,Ie=Ee.length;Be<Ie;Be++)Ee[Be]=0}function G(Ee){Y(Ee,0)}function Y(Ee,Be){const je=M.enabledAttributes,Me=M.attributeDivisors;M.newAttributes[Ee]=1,0===je[Ee]&&(f.enableVertexAttribArray(Ee),je[Ee]=1),Me[Ee]!==Be&&((u.isWebGL2?f:s.get("ANGLE_instanced_arrays"))[u.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ee,Be),Me[Ee]=Be)}function le(){const Ee=M.newAttributes,Be=M.enabledAttributes;for(let Ie=0,je=Be.length;Ie<je;Ie++)Be[Ie]!==Ee[Ie]&&(f.disableVertexAttribArray(Ie),Be[Ie]=0)}function fe(Ee,Be,Ie,je,Me,lt){!0!==u.isWebGL2||Ie!==f.INT&&Ie!==f.UNSIGNED_INT?f.vertexAttribPointer(Ee,Be,Ie,je,Me,lt):f.vertexAttribIPointer(Ee,Be,Ie,Me,lt)}function he(){ft(),C=!0,M!==w&&(M=w,R(M.object))}function ft(){w.geometry=null,w.program=null,w.wireframe=!1}return{setup:function A(Ee,Be,Ie,je,Me){let lt=!1;if(g){const dt=function P(Ee,Be,Ie){const je=!0===Ie.wireframe;let Me=_[Ee.id];void 0===Me&&(Me={},_[Ee.id]=Me);let lt=Me[Be.id];void 0===lt&&(lt={},Me[Be.id]=lt);let dt=lt[je];return void 0===dt&&(dt=I(function D(){return u.isWebGL2?f.createVertexArray():m.createVertexArrayOES()}()),lt[je]=dt),dt}(je,Ie,Be);M!==dt&&(M=dt,R(M.object)),lt=function z(Ee,Be){const Ie=M.attributes,je=Ee.attributes;let Me=0;for(const lt in je){const dt=Ie[lt],wt=je[lt];if(void 0===dt||dt.attribute!==wt||dt.data!==wt.data)return!0;Me++}return M.attributesNum!==Me||M.index!==Be}(je,Me),lt&&function B(Ee,Be){const Ie={},je=Ee.attributes;let Me=0;for(const lt in je){const dt=je[lt],wt={};wt.attribute=dt,dt.data&&(wt.data=dt.data),Ie[lt]=wt,Me++}M.attributes=Ie,M.attributesNum=Me,M.index=Be}(je,Me)}else{const dt=!0===Be.wireframe;(M.geometry!==je.id||M.program!==Ie.id||M.wireframe!==dt)&&(M.geometry=je.id,M.program=Ie.id,M.wireframe=dt,lt=!0)}!0===Ee.isInstancedMesh&&(lt=!0),null!==Me&&a.update(Me,f.ELEMENT_ARRAY_BUFFER),(lt||C)&&(C=!1,function ye(Ee,Be,Ie,je){if(!1===u.isWebGL2&&(Ee.isInstancedMesh||je.isInstancedBufferGeometry)&&null===s.get("ANGLE_instanced_arrays"))return;j();const Me=je.attributes,lt=Ie.getAttributes(),dt=Be.defaultAttributeValues;for(const wt in lt){const mt=lt[wt];if(mt.location>=0){let bn=Me[wt];if(void 0===bn&&("instanceMatrix"===wt&&Ee.instanceMatrix&&(bn=Ee.instanceMatrix),"instanceColor"===wt&&Ee.instanceColor&&(bn=Ee.instanceColor)),void 0!==bn){const yi=bn.normalized,$n=bn.itemSize,Se=a.get(bn);if(void 0===Se)continue;const sr=Se.buffer,ai=Se.type,li=Se.bytesPerElement;if(bn.isInterleavedBufferAttribute){const Pt=bn.data,_i=Pt.stride,Je=bn.offset;if(Pt.isInstancedInterleavedBuffer){for(let rt=0;rt<mt.locationSize;rt++)Y(mt.location+rt,Pt.meshPerAttribute);!0!==Ee.isInstancedMesh&&void 0===je._maxInstanceCount&&(je._maxInstanceCount=Pt.meshPerAttribute*Pt.count)}else for(let rt=0;rt<mt.locationSize;rt++)G(mt.location+rt);f.bindBuffer(f.ARRAY_BUFFER,sr);for(let rt=0;rt<mt.locationSize;rt++)fe(mt.location+rt,$n/mt.locationSize,ai,yi,_i*li,(Je+$n/mt.locationSize*rt)*li)}else{if(bn.isInstancedBufferAttribute){for(let Pt=0;Pt<mt.locationSize;Pt++)Y(mt.location+Pt,bn.meshPerAttribute);!0!==Ee.isInstancedMesh&&void 0===je._maxInstanceCount&&(je._maxInstanceCount=bn.meshPerAttribute*bn.count)}else for(let Pt=0;Pt<mt.locationSize;Pt++)G(mt.location+Pt);f.bindBuffer(f.ARRAY_BUFFER,sr);for(let Pt=0;Pt<mt.locationSize;Pt++)fe(mt.location+Pt,$n/mt.locationSize,ai,yi,$n*li,$n/mt.locationSize*Pt*li)}}else if(void 0!==dt){const yi=dt[wt];if(void 0!==yi)switch(yi.length){case 2:f.vertexAttrib2fv(mt.location,yi);break;case 3:f.vertexAttrib3fv(mt.location,yi);break;case 4:f.vertexAttrib4fv(mt.location,yi);break;default:f.vertexAttrib1fv(mt.location,yi)}}}}le()}(Ee,Be,Ie,je),null!==Me&&f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a.get(Me).buffer))},reset:he,resetDefaultState:ft,dispose:function Ve(){he();for(const Ee in _){const Be=_[Ee];for(const Ie in Be){const je=Be[Ie];for(const Me in je)L(je[Me].object),delete je[Me];delete Be[Ie]}delete _[Ee]}},releaseStatesOfGeometry:function we(Ee){if(void 0===_[Ee.id])return;const Be=_[Ee.id];for(const Ie in Be){const je=Be[Ie];for(const Me in je)L(je[Me].object),delete je[Me];delete Be[Ie]}delete _[Ee.id]},releaseStatesOfProgram:function X(Ee){for(const Be in _){const Ie=_[Be];if(void 0===Ie[Ee.id])continue;const je=Ie[Ee.id];for(const Me in je)L(je[Me].object),delete je[Me];delete Ie[Ee.id]}},initAttributes:j,enableAttribute:G,disableUnusedAttributes:le}}function EA(f,s,a,u){const h=u.isWebGL2;let m;this.setMode=function g(M){m=M},this.render=function _(M,C){f.drawArrays(m,M,C),a.update(C,m,1)},this.renderInstances=function w(M,C,A){if(0===A)return;let D,R;if(h)D=f,R="drawArraysInstanced";else if(D=s.get("ANGLE_instanced_arrays"),R="drawArraysInstancedANGLE",null===D)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");D[R](m,M,C,A),a.update(C,m,A)}}function CA(f,s,a){let u;function m(fe){if("highp"===fe){if(f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).precision>0&&f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).precision>0)return"highp";fe="mediump"}return"mediump"===fe&&f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).precision>0&&f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const g="undefined"!=typeof WebGL2RenderingContext&&f instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&f instanceof WebGL2ComputeRenderingContext;let _=void 0!==a.precision?a.precision:"highp";const w=m(_);w!==_&&(console.warn("THREE.WebGLRenderer:",_,"not supported, using",w,"instead."),_=w);const M=g||s.has("WEBGL_draw_buffers"),C=!0===a.logarithmicDepthBuffer,A=f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS),D=f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS),R=f.getParameter(f.MAX_TEXTURE_SIZE),L=f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE),P=f.getParameter(f.MAX_VERTEX_ATTRIBS),I=f.getParameter(f.MAX_VERTEX_UNIFORM_VECTORS),z=f.getParameter(f.MAX_VARYING_VECTORS),B=f.getParameter(f.MAX_FRAGMENT_UNIFORM_VECTORS),j=D>0,G=g||s.has("OES_texture_float");return{isWebGL2:g,drawBuffers:M,getMaxAnisotropy:function h(){if(void 0!==u)return u;if(!0===s.has("EXT_texture_filter_anisotropic")){const fe=s.get("EXT_texture_filter_anisotropic");u=f.getParameter(fe.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else u=0;return u},getMaxPrecision:m,precision:_,logarithmicDepthBuffer:C,maxTextures:A,maxVertexTextures:D,maxTextureSize:R,maxCubemapSize:L,maxAttributes:P,maxVertexUniforms:I,maxVaryings:z,maxFragmentUniforms:B,vertexTextures:j,floatFragmentTextures:G,floatVertexTextures:j&&G,maxSamples:g?f.getParameter(f.MAX_SAMPLES):0}}function TA(f){const s=this;let a=null,u=0,h=!1,m=!1;const g=new io,_=new ir,w={value:null,needsUpdate:!1};function M(){w.value!==a&&(w.value=a,w.needsUpdate=u>0),s.numPlanes=u,s.numIntersection=0}function C(A,D,R,L){const P=null!==A?A.length:0;let I=null;if(0!==P){if(I=w.value,!0!==L||null===I){const z=R+4*P,B=D.matrixWorldInverse;_.getNormalMatrix(B),(null===I||I.length<z)&&(I=new Float32Array(z));for(let j=0,G=R;j!==P;++j,G+=4)g.copy(A[j]).applyMatrix4(B,_),g.normal.toArray(I,G),I[G+3]=g.constant}w.value=I,w.needsUpdate=!0}return s.numPlanes=P,s.numIntersection=0,I}this.uniform=w,this.numPlanes=0,this.numIntersection=0,this.init=function(A,D,R){const L=0!==A.length||D||0!==u||h;return h=D,a=C(A,R,0),u=A.length,L},this.beginShadows=function(){m=!0,C(null)},this.endShadows=function(){m=!1,M()},this.setState=function(A,D,R){const L=A.clippingPlanes,P=A.clipIntersection,I=A.clipShadows,z=f.get(A);if(!h||null===L||0===L.length||m&&!I)m?C(null):M();else{const B=m?0:u,j=4*B;let G=z.clippingState||null;w.value=G,G=C(L,D,j,R);for(let Y=0;Y!==j;++Y)G[Y]=a[Y];z.clippingState=G,this.numIntersection=P?this.numPlanes:0,this.numPlanes+=B}}}function AA(f){let s=new WeakMap;function a(g,_){return 303===_?g.mapping=Bi:304===_&&(g.mapping=$a),g}function h(g){const _=g.target;_.removeEventListener("dispose",h);const w=s.get(_);void 0!==w&&(s.delete(_),w.dispose())}return{get:function u(g){if(g&&g.isTexture&&!1===g.isRenderTargetTexture){const _=g.mapping;if(303===_||304===_){if(s.has(g))return a(s.get(g).texture,g.mapping);{const w=g.image;if(w&&w.height>0){const M=new Yu(w.height/2);return M.fromEquirectangularTexture(f,g),s.set(g,M),g.addEventListener("dispose",h),a(M.texture,g.mapping)}return null}}}return g},dispose:function m(){s=new WeakMap}}}Ia.physical={uniforms:rr([Ia.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Qe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Dt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Qe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Dt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Dt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:oi.meshphysical_vert,fragmentShader:oi.meshphysical_frag};class Ap extends mp{constructor(s=-1,a=1,u=1,h=-1,m=.1,g=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=s,this.right=a,this.top=u,this.bottom=h,this.near=m,this.far=g,this.updateProjectionMatrix()}copy(s,a){return super.copy(s,a),this.left=s.left,this.right=s.right,this.top=s.top,this.bottom=s.bottom,this.near=s.near,this.far=s.far,this.zoom=s.zoom,this.view=null===s.view?null:Object.assign({},s.view),this}setViewOffset(s,a,u,h,m,g){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=s,this.view.fullHeight=a,this.view.offsetX=u,this.view.offsetY=h,this.view.width=m,this.view.height=g,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const s=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),u=(this.right+this.left)/2,h=(this.top+this.bottom)/2;let m=u-s,g=u+s,_=h+a,w=h-a;if(null!==this.view&&this.view.enabled){const M=(this.right-this.left)/this.view.fullWidth/this.zoom,C=(this.top-this.bottom)/this.view.fullHeight/this.zoom;m+=M*this.view.offsetX,g=m+M*this.view.width,_-=C*this.view.offsetY,w=_-C*this.view.height}this.projectionMatrix.makeOrthographic(m,g,_,w,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(s){const a=super.toJSON(s);return a.object.zoom=this.zoom,a.object.left=this.left,a.object.right=this.right,a.object.top=this.top,a.object.bottom=this.bottom,a.object.near=this.near,a.object.far=this.far,null!==this.view&&(a.object.view=Object.assign({},this.view)),a}}Ap.prototype.isOrthographicCamera=!0;const Od=[.125,.215,.35,.446,.526,.582],Tw=new Ap,DA=new Dt;let Aw=null;const kd=(1+Math.sqrt(5))/2,Dp=1/kd,Nv=[new J(1,1,1),new J(-1,1,1),new J(1,1,-1),new J(-1,1,-1),new J(0,kd,Dp),new J(0,kd,-Dp),new J(Dp,0,kd),new J(-Dp,0,kd),new J(kd,Dp,0),new J(-kd,Dp,0)];class Ov{constructor(s){this._renderer=s,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(s,a=0,u=.1,h=100){Aw=this._renderer.getRenderTarget(),this._setSize(256);const m=this._allocateTargets();return m.depthBuffer=!0,this._sceneToCubeUV(s,u,h,m),a>0&&this._blur(m,0,0,a),this._applyPMREM(m),this._cleanup(m),m}fromEquirectangular(s,a=null){return this._fromTexture(s,a)}fromCubemap(s,a=null){return this._fromTexture(s,a)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Rp(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Rw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(s){this._lodMax=Math.floor(Math.log2(s)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let s=0;s<this._lodPlanes.length;s++)this._lodPlanes[s].dispose()}_cleanup(s){this._renderer.setRenderTarget(Aw),s.scissorTest=!1,qg(s,0,0,s.width,s.height)}_fromTexture(s,a){this._setSize(s.mapping===Bi||s.mapping===$a?0===s.image.length?16:s.image[0].width||s.image[0].image.width:s.image.width/4),Aw=this._renderer.getRenderTarget();const u=a||this._allocateTargets();return this._textureToCubeUV(s,u),this._applyPMREM(u),this._cleanup(u),u}_allocateTargets(){const s=3*Math.max(this._cubeSize,112),a=4*this._cubeSize-32,u={magFilter:Hr,minFilter:Hr,generateMipmaps:!1,type:re,format:At,encoding:Ls,depthBuffer:!1},h=Dw(s,a,u);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==s){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Dw(s,a,u);const{_lodMax:m}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function RA(f){const s=[],a=[],u=[];let h=f;const m=f-4+1+Od.length;for(let g=0;g<m;g++){const _=Math.pow(2,h);a.push(_);let w=1/_;g>f-4?w=Od[g-f+4-1]:0===g&&(w=0),u.push(w);const M=1/(_-1),C=-M/2,A=1+M/2,D=[C,C,A,C,A,A,C,C,A,A,C,A],R=6,L=6,P=3,I=2,z=1,B=new Float32Array(P*L*R),j=new Float32Array(I*L*R),G=new Float32Array(z*L*R);for(let le=0;le<R;le++){const fe=le%3*2/3-1,ye=le>2?0:-1;B.set([fe,ye,0,fe+2/3,ye,0,fe+2/3,ye+1,0,fe,ye,0,fe+2/3,ye+1,0,fe,ye+1,0],P*L*le),j.set(D,I*L*le),G.set([le,le,le,le,le,le],z*L*le)}const Y=new en;Y.setAttribute("position",new Ni(B,P)),Y.setAttribute("uv",new Ni(j,I)),Y.setAttribute("faceIndex",new Ni(G,z)),s.push(Y),h>4&&h--}return{lodPlanes:s,sizeLods:a,sigmas:u}}(m)),this._blurMaterial=function E2(f,s,a){const u=new Float32Array(20),h=new J(0,1,0);return new Ra({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/s,CUBEUV_TEXEL_HEIGHT:1/a,CUBEUV_MAX_MIP:`${f}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:u},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:h}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(m,s,a)}return h}_compileMaterial(s){const a=new Jr(this._lodPlanes[0],s);this._renderer.compile(a,Tw)}_sceneToCubeUV(s,a,u,h){const _=new Os(90,1,a,u),w=[1,-1,1,1,1,1],M=[1,1,1,-1,-1,-1],C=this._renderer,A=C.autoClear,D=C.toneMapping;C.getClearColor(DA),C.toneMapping=0,C.autoClear=!1;const R=new bl({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),L=new Jr(new oc,R);let P=!1;const I=s.background;I?I.isColor&&(R.color.copy(I),s.background=null,P=!0):(R.color.copy(DA),P=!0);for(let z=0;z<6;z++){const B=z%3;0===B?(_.up.set(0,w[z],0),_.lookAt(M[z],0,0)):1===B?(_.up.set(0,0,w[z]),_.lookAt(0,M[z],0)):(_.up.set(0,w[z],0),_.lookAt(0,0,M[z]));const j=this._cubeSize;qg(h,B*j,z>2?j:0,j,j),C.setRenderTarget(h),P&&C.render(L,_),C.render(s,_)}L.geometry.dispose(),L.material.dispose(),C.toneMapping=D,C.autoClear=A,s.background=I}_textureToCubeUV(s,a){const u=this._renderer,h=s.mapping===Bi||s.mapping===$a;h?(null===this._cubemapMaterial&&(this._cubemapMaterial=Rp()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===s.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Rw());const m=h?this._cubemapMaterial:this._equirectMaterial,g=new Jr(this._lodPlanes[0],m);m.uniforms.envMap.value=s;const w=this._cubeSize;qg(a,0,0,3*w,2*w),u.setRenderTarget(a),u.render(g,Tw)}_applyPMREM(s){const a=this._renderer,u=a.autoClear;a.autoClear=!1;for(let h=1;h<this._lodPlanes.length;h++){const m=Math.sqrt(this._sigmas[h]*this._sigmas[h]-this._sigmas[h-1]*this._sigmas[h-1]);this._blur(s,h-1,h,m,Nv[(h-1)%Nv.length])}a.autoClear=u}_blur(s,a,u,h,m){const g=this._pingPongRenderTarget;this._halfBlur(s,g,a,u,h,"latitudinal",m),this._halfBlur(g,s,u,u,h,"longitudinal",m)}_halfBlur(s,a,u,h,m,g,_){const w=this._renderer,M=this._blurMaterial;"latitudinal"!==g&&"longitudinal"!==g&&console.error("blur direction must be either latitudinal or longitudinal!");const A=new Jr(this._lodPlanes[h],M),D=M.uniforms,R=this._sizeLods[u]-1,L=isFinite(m)?Math.PI/(2*R):2*Math.PI/39,P=m/L,I=isFinite(m)?1+Math.floor(3*P):20;I>20&&console.warn(`sigmaRadians, ${m}, is too large and will clip, as it requested ${I} samples when the maximum is set to 20`);const z=[];let B=0;for(let fe=0;fe<20;++fe){const ye=fe/P,Ve=Math.exp(-ye*ye/2);z.push(Ve),0===fe?B+=Ve:fe<I&&(B+=2*Ve)}for(let fe=0;fe<z.length;fe++)z[fe]=z[fe]/B;D.envMap.value=s.texture,D.samples.value=I,D.weights.value=z,D.latitudinal.value="latitudinal"===g,_&&(D.poleAxis.value=_);const{_lodMax:j}=this;D.dTheta.value=L,D.mipInt.value=j-u;const G=this._sizeLods[h];qg(a,3*G*(h>j-4?h-j+4:0),4*(this._cubeSize-G),3*G,2*G),w.setRenderTarget(a),w.render(A,Tw)}}function Dw(f,s,a){const u=new cs(f,s,a);return u.texture.mapping=306,u.texture.name="PMREM.cubeUv",u.scissorTest=!0,u}function qg(f,s,a,u,h){f.viewport.set(s,a,u,h),f.scissor.set(s,a,u,h)}function Rw(){return new Ra({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Rp(){return new Ra({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Cl(f){let s=new WeakMap,a=null;function m(_){const w=_.target;w.removeEventListener("dispose",m);const M=s.get(w);void 0!==M&&(s.delete(w),M.dispose())}return{get:function u(_){if(_&&_.isTexture){const w=_.mapping,M=303===w||304===w,C=w===Bi||w===$a;if(M||C){if(_.isRenderTargetTexture&&!0===_.needsPMREMUpdate){_.needsPMREMUpdate=!1;let A=s.get(_);return null===a&&(a=new Ov(f)),A=M?a.fromEquirectangular(_,A):a.fromCubemap(_,A),s.set(_,A),A.texture}if(s.has(_))return s.get(_).texture;{const A=_.image;if(M&&A&&A.height>0||C&&A&&function h(_){let w=0;for(let C=0;C<6;C++)void 0!==_[C]&&w++;return 6===w}(A)){null===a&&(a=new Ov(f));const D=M?a.fromEquirectangular(_):a.fromCubemap(_);return s.set(_,D),_.addEventListener("dispose",m),D.texture}return null}}}return _},dispose:function g(){s=new WeakMap,null!==a&&(a.dispose(),a=null)}}}function Pp(f){const s={};function a(u){if(void 0!==s[u])return s[u];let h;switch(u){case"WEBGL_depth_texture":h=f.getExtension("WEBGL_depth_texture")||f.getExtension("MOZ_WEBGL_depth_texture")||f.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":h=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":h=f.getExtension("WEBGL_compressed_texture_s3tc")||f.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||f.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":h=f.getExtension("WEBGL_compressed_texture_pvrtc")||f.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:h=f.getExtension(u)}return s[u]=h,h}return{has:function(u){return null!==a(u)},init:function(u){u.isWebGL2?a("EXT_color_buffer_float"):(a("WEBGL_depth_texture"),a("OES_texture_float"),a("OES_texture_half_float"),a("OES_texture_half_float_linear"),a("OES_standard_derivatives"),a("OES_element_index_uint"),a("OES_vertex_array_object"),a("ANGLE_instanced_arrays")),a("OES_texture_float_linear"),a("EXT_color_buffer_half_float"),a("WEBGL_multisampled_render_to_texture")},get:function(u){const h=a(u);return null===h&&console.warn("THREE.WebGLRenderer: "+u+" extension not supported."),h}}}function Pw(f,s,a,u){const h={},m=new WeakMap;function g(A){const D=A.target;null!==D.index&&s.remove(D.index);for(const L in D.attributes)s.remove(D.attributes[L]);D.removeEventListener("dispose",g),delete h[D.id];const R=m.get(D);R&&(s.remove(R),m.delete(D)),u.releaseStatesOfGeometry(D),!0===D.isInstancedBufferGeometry&&delete D._maxInstanceCount,a.memory.geometries--}function M(A){const D=[],R=A.index,L=A.attributes.position;let P=0;if(null!==R){const B=R.array;P=R.version;for(let j=0,G=B.length;j<G;j+=3){const Y=B[j+0],le=B[j+1],fe=B[j+2];D.push(Y,le,le,fe,fe,Y)}}else{P=L.version;for(let j=0,G=L.array.length/3-1;j<G;j+=3){const Y=j+0,le=j+1,fe=j+2;D.push(Y,le,le,fe,fe,Y)}}const I=new(ip(D)?vt:ot)(D,1);I.version=P;const z=m.get(A);z&&s.remove(z),m.set(A,I)}return{get:function _(A,D){return!0===h[D.id]||(D.addEventListener("dispose",g),h[D.id]=!0,a.memory.geometries++),D},update:function w(A){const D=A.attributes;for(const L in D)s.update(D[L],f.ARRAY_BUFFER);const R=A.morphAttributes;for(const L in R){const P=R[L];for(let I=0,z=P.length;I<z;I++)s.update(P[I],f.ARRAY_BUFFER)}},getWireframeAttribute:function C(A){const D=m.get(A);if(D){const R=A.index;null!==R&&D.version<R.version&&M(A)}else M(A);return m.get(A)}}}function Iw(f,s,a,u){const h=u.isWebGL2;let m,_,w;this.setMode=function g(D){m=D},this.setIndex=function M(D){_=D.type,w=D.bytesPerElement},this.render=function C(D,R){f.drawElements(m,R,_,D*w),a.update(R,m,1)},this.renderInstances=function A(D,R,L){if(0===L)return;let P,I;if(h)P=f,I="drawElementsInstanced";else if(P=s.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",null===P)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");P[I](m,R,_,D*w,L),a.update(R,m,L)}}function Lw(f){const a={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:a,programs:null,autoReset:!0,reset:function h(){a.frame++,a.calls=0,a.triangles=0,a.points=0,a.lines=0},update:function u(m,g,_){switch(a.calls++,g){case f.TRIANGLES:a.triangles+=_*(m/3);break;case f.LINES:a.lines+=_*(m/2);break;case f.LINE_STRIP:a.lines+=_*(m-1);break;case f.LINE_LOOP:a.lines+=_*m;break;case f.POINTS:a.points+=_*m;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",g)}}}}function C2(f,s){return f[0]-s[0]}function T2(f,s){return Math.abs(s[1])-Math.abs(f[1])}function Fw(f,s){let a=1;const u=s.isInterleavedBufferAttribute?s.data.array:s.array;u instanceof Int8Array?a=127:u instanceof Int16Array?a=32767:u instanceof Int32Array?a=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",u),f.divideScalar(a)}function kv(f,s,a){const u={},h=new Float32Array(8),m=new WeakMap,g=new Xi,_=[];for(let M=0;M<8;M++)_[M]=[M,0];return{update:function w(M,C,A,D){const R=M.morphTargetInfluences;if(!0===s.isWebGL2){const L=C.morphAttributes.position||C.morphAttributes.normal||C.morphAttributes.color,P=void 0!==L?L.length:0;let I=m.get(C);if(void 0===I||I.count!==P){let Be=function(){ft.dispose(),m.delete(C),C.removeEventListener("dispose",Be)};void 0!==I&&I.texture.dispose();const j=void 0!==C.morphAttributes.position,G=void 0!==C.morphAttributes.normal,Y=void 0!==C.morphAttributes.color,le=C.morphAttributes.position||[],fe=C.morphAttributes.normal||[],ye=C.morphAttributes.color||[];let Ve=0;!0===j&&(Ve=1),!0===G&&(Ve=2),!0===Y&&(Ve=3);let we=C.attributes.position.count*Ve,X=1;we>s.maxTextureSize&&(X=Math.ceil(we/s.maxTextureSize),we=s.maxTextureSize);const he=new Float32Array(we*X*4*P),ft=new ws(he,we,X,P);ft.type=W,ft.needsUpdate=!0;const Ee=4*Ve;for(let Ie=0;Ie<P;Ie++){const je=le[Ie],Me=fe[Ie],lt=ye[Ie],dt=we*X*4*Ie;for(let wt=0;wt<je.count;wt++){const mt=wt*Ee;!0===j&&(g.fromBufferAttribute(je,wt),!0===je.normalized&&Fw(g,je),he[dt+mt+0]=g.x,he[dt+mt+1]=g.y,he[dt+mt+2]=g.z,he[dt+mt+3]=0),!0===G&&(g.fromBufferAttribute(Me,wt),!0===Me.normalized&&Fw(g,Me),he[dt+mt+4]=g.x,he[dt+mt+5]=g.y,he[dt+mt+6]=g.z,he[dt+mt+7]=0),!0===Y&&(g.fromBufferAttribute(lt,wt),!0===lt.normalized&&Fw(g,lt),he[dt+mt+8]=g.x,he[dt+mt+9]=g.y,he[dt+mt+10]=g.z,he[dt+mt+11]=4===lt.itemSize?g.w:1)}}I={count:P,texture:ft,size:new Qe(we,X)},m.set(C,I),C.addEventListener("dispose",Be)}let z=0;for(let j=0;j<R.length;j++)z+=R[j];const B=C.morphTargetsRelative?1:1-z;D.getUniforms().setValue(f,"morphTargetBaseInfluence",B),D.getUniforms().setValue(f,"morphTargetInfluences",R),D.getUniforms().setValue(f,"morphTargetsTexture",I.texture,a),D.getUniforms().setValue(f,"morphTargetsTextureSize",I.size)}else{const L=void 0===R?0:R.length;let P=u[C.id];if(void 0===P||P.length!==L){P=[];for(let G=0;G<L;G++)P[G]=[G,0];u[C.id]=P}for(let G=0;G<L;G++){const Y=P[G];Y[0]=G,Y[1]=R[G]}P.sort(T2);for(let G=0;G<8;G++)G<L&&P[G][1]?(_[G][0]=P[G][0],_[G][1]=P[G][1]):(_[G][0]=Number.MAX_SAFE_INTEGER,_[G][1]=0);_.sort(C2);const I=C.morphAttributes.position,z=C.morphAttributes.normal;let B=0;for(let G=0;G<8;G++){const Y=_[G],le=Y[0],fe=Y[1];le!==Number.MAX_SAFE_INTEGER&&fe?(I&&C.getAttribute("morphTarget"+G)!==I[le]&&C.setAttribute("morphTarget"+G,I[le]),z&&C.getAttribute("morphNormal"+G)!==z[le]&&C.setAttribute("morphNormal"+G,z[le]),h[G]=fe,B+=fe):(I&&!0===C.hasAttribute("morphTarget"+G)&&C.deleteAttribute("morphTarget"+G),z&&!0===C.hasAttribute("morphNormal"+G)&&C.deleteAttribute("morphNormal"+G),h[G]=0)}const j=C.morphTargetsRelative?1:1-B;D.getUniforms().setValue(f,"morphTargetBaseInfluence",j),D.getUniforms().setValue(f,"morphTargetInfluences",h)}}}}function Bv(f,s,a,u){let h=new WeakMap;function _(w){const M=w.target;M.removeEventListener("dispose",_),a.remove(M.instanceMatrix),null!==M.instanceColor&&a.remove(M.instanceColor)}return{update:function m(w){const M=u.render.frame,A=s.get(w,w.geometry);return h.get(A)!==M&&(s.update(A),h.set(A,M)),w.isInstancedMesh&&(!1===w.hasEventListener("dispose",_)&&w.addEventListener("dispose",_),a.update(w.instanceMatrix,f.ARRAY_BUFFER),null!==w.instanceColor&&a.update(w.instanceColor,f.ARRAY_BUFFER)),A},dispose:function g(){h=new WeakMap}}}const Xg=new ls,PA=new ws,IA=new yl,Uv=new lc,Nw=[],Ow=[],kw=new Float32Array(16),Bw=new Float32Array(9),Vv=new Float32Array(4);function cc(f,s,a){const u=f[0];if(u<=0||u>0)return f;const h=s*a;let m=Nw[h];if(void 0===m&&(m=new Float32Array(h),Nw[h]=m),0!==s){u.toArray(m,0);for(let g=1,_=0;g!==s;++g)_+=a,f[g].toArray(m,_)}return m}function Ro(f,s){if(f.length!==s.length)return!1;for(let a=0,u=f.length;a<u;a++)if(f[a]!==s[a])return!1;return!0}function ks(f,s){for(let a=0,u=s.length;a<u;a++)f[a]=s[a]}function $g(f,s){let a=Ow[s];void 0===a&&(a=new Int32Array(s),Ow[s]=a);for(let u=0;u!==s;++u)a[u]=f.allocateTextureUnit();return a}function fs(f,s){const a=this.cache;a[0]!==s&&(f.uniform1f(this.addr,s),a[0]=s)}function LA(f,s){const a=this.cache;if(void 0!==s.x)(a[0]!==s.x||a[1]!==s.y)&&(f.uniform2f(this.addr,s.x,s.y),a[0]=s.x,a[1]=s.y);else{if(Ro(a,s))return;f.uniform2fv(this.addr,s),ks(a,s)}}function FA(f,s){const a=this.cache;if(void 0!==s.x)(a[0]!==s.x||a[1]!==s.y||a[2]!==s.z)&&(f.uniform3f(this.addr,s.x,s.y,s.z),a[0]=s.x,a[1]=s.y,a[2]=s.z);else if(void 0!==s.r)(a[0]!==s.r||a[1]!==s.g||a[2]!==s.b)&&(f.uniform3f(this.addr,s.r,s.g,s.b),a[0]=s.r,a[1]=s.g,a[2]=s.b);else{if(Ro(a,s))return;f.uniform3fv(this.addr,s),ks(a,s)}}function zv(f,s){const a=this.cache;if(void 0!==s.x)(a[0]!==s.x||a[1]!==s.y||a[2]!==s.z||a[3]!==s.w)&&(f.uniform4f(this.addr,s.x,s.y,s.z,s.w),a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=s.w);else{if(Ro(a,s))return;f.uniform4fv(this.addr,s),ks(a,s)}}function Uw(f,s){const a=this.cache,u=s.elements;if(void 0===u){if(Ro(a,s))return;f.uniformMatrix2fv(this.addr,!1,s),ks(a,s)}else{if(Ro(a,u))return;Vv.set(u),f.uniformMatrix2fv(this.addr,!1,Vv),ks(a,u)}}function NA(f,s){const a=this.cache,u=s.elements;if(void 0===u){if(Ro(a,s))return;f.uniformMatrix3fv(this.addr,!1,s),ks(a,s)}else{if(Ro(a,u))return;Bw.set(u),f.uniformMatrix3fv(this.addr,!1,Bw),ks(a,u)}}function OA(f,s){const a=this.cache,u=s.elements;if(void 0===u){if(Ro(a,s))return;f.uniformMatrix4fv(this.addr,!1,s),ks(a,s)}else{if(Ro(a,u))return;kw.set(u),f.uniformMatrix4fv(this.addr,!1,kw),ks(a,u)}}function kA(f,s){const a=this.cache;a[0]!==s&&(f.uniform1i(this.addr,s),a[0]=s)}function BA(f,s){const a=this.cache;Ro(a,s)||(f.uniform2iv(this.addr,s),ks(a,s))}function UA(f,s){const a=this.cache;Ro(a,s)||(f.uniform3iv(this.addr,s),ks(a,s))}function A2(f,s){const a=this.cache;Ro(a,s)||(f.uniform4iv(this.addr,s),ks(a,s))}function D2(f,s){const a=this.cache;a[0]!==s&&(f.uniform1ui(this.addr,s),a[0]=s)}function Ip(f,s){const a=this.cache;Ro(a,s)||(f.uniform2uiv(this.addr,s),ks(a,s))}function Po(f,s){const a=this.cache;Ro(a,s)||(f.uniform3uiv(this.addr,s),ks(a,s))}function Hv(f,s){const a=this.cache;Ro(a,s)||(f.uniform4uiv(this.addr,s),ks(a,s))}function Vw(f,s,a){const u=this.cache,h=a.allocateTextureUnit();u[0]!==h&&(f.uniform1i(this.addr,h),u[0]=h),a.setTexture2D(s||Xg,h)}function zw(f,s,a){const u=this.cache,h=a.allocateTextureUnit();u[0]!==h&&(f.uniform1i(this.addr,h),u[0]=h),a.setTexture3D(s||IA,h)}function yo(f,s,a){const u=this.cache,h=a.allocateTextureUnit();u[0]!==h&&(f.uniform1i(this.addr,h),u[0]=h),a.setTextureCube(s||Uv,h)}function Lp(f,s,a){const u=this.cache,h=a.allocateTextureUnit();u[0]!==h&&(f.uniform1i(this.addr,h),u[0]=h),a.setTexture2DArray(s||PA,h)}function VA(f,s){f.uniform1fv(this.addr,s)}function zA(f,s){const a=cc(s,this.size,2);f.uniform2fv(this.addr,a)}function Hw(f,s){const a=cc(s,this.size,3);f.uniform3fv(this.addr,a)}function HA(f,s){const a=cc(s,this.size,4);f.uniform4fv(this.addr,a)}function Gw(f,s){const a=cc(s,this.size,4);f.uniformMatrix2fv(this.addr,!1,a)}function GA(f,s){const a=cc(s,this.size,9);f.uniformMatrix3fv(this.addr,!1,a)}function Ww(f,s){const a=cc(s,this.size,16);f.uniformMatrix4fv(this.addr,!1,a)}function WA(f,s){f.uniform1iv(this.addr,s)}function qA(f,s){f.uniform2iv(this.addr,s)}function Wv(f,s){f.uniform3iv(this.addr,s)}function jA(f,s){f.uniform4iv(this.addr,s)}function XA(f,s){f.uniform1uiv(this.addr,s)}function qv(f,s){f.uniform2uiv(this.addr,s)}function $A(f,s){f.uniform3uiv(this.addr,s)}function YA(f,s){f.uniform4uiv(this.addr,s)}function Fp(f,s,a){const u=s.length,h=$g(a,u);f.uniform1iv(this.addr,h);for(let m=0;m!==u;++m)a.setTexture2D(s[m]||Xg,h[m])}function KA(f,s,a){const u=s.length,h=$g(a,u);f.uniform1iv(this.addr,h);for(let m=0;m!==u;++m)a.setTexture3D(s[m]||IA,h[m])}function ZA(f,s,a){const u=s.length,h=$g(a,u);f.uniform1iv(this.addr,h);for(let m=0;m!==u;++m)a.setTextureCube(s[m]||Uv,h[m])}function JA(f,s,a){const u=s.length,h=$g(a,u);f.uniform1iv(this.addr,h);for(let m=0;m!==u;++m)a.setTexture2DArray(s[m]||PA,h[m])}function e1(f,s,a){this.id=f,this.addr=a,this.cache=[],this.setValue=function Gv(f){switch(f){case 5126:return fs;case 35664:return LA;case 35665:return FA;case 35666:return zv;case 35674:return Uw;case 35675:return NA;case 35676:return OA;case 5124:case 35670:return kA;case 35667:case 35671:return BA;case 35668:case 35672:return UA;case 35669:case 35673:return A2;case 5125:return D2;case 36294:return Ip;case 36295:return Po;case 36296:return Hv;case 35678:case 36198:case 36298:case 36306:case 35682:return Vw;case 35679:case 36299:case 36307:return zw;case 35680:case 36300:case 36308:case 36293:return yo;case 36289:case 36303:case 36311:case 36292:return Lp}}(s.type)}function jv(f,s,a){this.id=f,this.addr=a,this.cache=[],this.size=s.size,this.setValue=function QA(f){switch(f){case 5126:return VA;case 35664:return zA;case 35665:return Hw;case 35666:return HA;case 35674:return Gw;case 35675:return GA;case 35676:return Ww;case 5124:case 35670:return WA;case 35667:case 35671:return qA;case 35668:case 35672:return Wv;case 35669:case 35673:return jA;case 5125:return XA;case 36294:return qv;case 36295:return $A;case 36296:return YA;case 35678:case 36198:case 36298:case 36306:case 35682:return Fp;case 35679:case 36299:case 36307:return KA;case 35680:case 36300:case 36308:case 36293:return ZA;case 36289:case 36303:case 36311:case 36292:return JA}}(s.type)}function qw(f){this.id=f,this.seq=[],this.map={}}jv.prototype.updateCache=function(f){const s=this.cache;f instanceof Float32Array&&s.length!==f.length&&(this.cache=new Float32Array(f.length)),ks(s,f)},qw.prototype.setValue=function(f,s,a){const u=this.seq;for(let h=0,m=u.length;h!==m;++h){const g=u[h];g.setValue(f,s[g.id],a)}};const Xv=/(\w+)(\])?(\[|\.)?/g;function jw(f,s){f.seq.push(s),f.map[s.id]=s}function t1(f,s,a){const u=f.name,h=u.length;for(Xv.lastIndex=0;;){const m=Xv.exec(u),g=Xv.lastIndex;let _=m[1];const M=m[3];if("]"===m[2]&&(_|=0),void 0===M||"["===M&&g+2===h){jw(a,void 0===M?new e1(_,f,s):new jv(_,f,s));break}{let A=a.map[_];void 0===A&&(A=new qw(_),jw(a,A)),a=A}}}function $c(f,s){this.seq=[],this.map={};const a=f.getProgramParameter(s,f.ACTIVE_UNIFORMS);for(let u=0;u<a;++u){const h=f.getActiveUniform(s,u);t1(h,f.getUniformLocation(s,h.name),this)}}function Xw(f,s,a){const u=f.createShader(s);return f.shaderSource(u,a),f.compileShader(u),u}$c.prototype.setValue=function(f,s,a,u){const h=this.map[s];void 0!==h&&h.setValue(f,a,u)},$c.prototype.setOptional=function(f,s,a){const u=s[a];void 0!==u&&this.setValue(f,a,u)},$c.upload=function(f,s,a,u){for(let h=0,m=s.length;h!==m;++h){const g=s[h],_=a[g.id];!1!==_.needsUpdate&&g.setValue(f,_.value,u)}},$c.seqWithValue=function(f,s){const a=[];for(let u=0,h=f.length;u!==h;++u){const m=f[u];m.id in s&&a.push(m)}return a};let $v=0;function tl(f,s,a){const u=f.getShaderParameter(s,f.COMPILE_STATUS),h=f.getShaderInfoLog(s).trim();if(u&&""===h)return"";const m=parseInt(/ERROR: 0:(\d+)/.exec(h)[1]);return a.toUpperCase()+"\n\n"+h+"\n\n"+function n1(f,s){const a=f.split("\n"),u=[],h=Math.max(s-6,0),m=Math.min(s+6,a.length);for(let g=h;g<m;g++)u.push(g+1+": "+a[g]);return u.join("\n")}(f.getShaderSource(s),m)}function R2(f,s){const a=function Bd(f){switch(f){case Ls:return["Linear","( value )"];case Dr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",f),["Linear","( value )"]}}(s);return"vec4 "+f+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function P2(f,s){let a;switch(s){case 1:a="Linear";break;case 2:a="Reinhard";break;case 3:a="OptimizedCineon";break;case 4:a="ACESFilmic";break;case 5:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",s),a="Linear"}return"vec3 "+f+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function Qu(f){return""!==f}function Yg(f,s){return f.replace(/NUM_DIR_LIGHTS/g,s.numDirLights).replace(/NUM_SPOT_LIGHTS/g,s.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,s.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,s.numPointLights).replace(/NUM_HEMI_LIGHTS/g,s.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,s.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,s.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,s.numPointLightShadows)}function Yw(f,s){return f.replace(/NUM_CLIPPING_PLANES/g,s.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,s.numClippingPlanes-s.numClipIntersection)}const Kw=/^[ \t]*#include +<([\w\d./]+)>/gm;function eh(f){return f.replace(Kw,Zw)}function Zw(f,s){const a=oi[s];if(void 0===a)throw new Error("Can not resolve #include <"+s+">");return eh(a)}const Jw=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Yv=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Kg(f){return f.replace(Yv,r1).replace(Jw,Qw)}function Qw(f,s,a,u){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),r1(0,s,a,u)}function r1(f,s,a,u){let h="";for(let m=parseInt(s);m<parseInt(a);m++)h+=u.replace(/\[\s*i\s*\]/g,"[ "+m+" ]").replace(/UNROLLED_LOOP_INDEX/g,m);return h}function th(f){let s="precision "+f.precision+" float;\nprecision "+f.precision+" int;";return"highp"===f.precision?s+="\n#define HIGH_PRECISION":"mediump"===f.precision?s+="\n#define MEDIUM_PRECISION":"lowp"===f.precision&&(s+="\n#define LOW_PRECISION"),s}function a1(f,s,a,u){const h=f.getContext(),m=a.defines;let g=a.vertexShader,_=a.fragmentShader;const w=function Kv(f){let s="SHADOWMAP_TYPE_BASIC";return 1===f.shadowMapType?s="SHADOWMAP_TYPE_PCF":2===f.shadowMapType?s="SHADOWMAP_TYPE_PCF_SOFT":3===f.shadowMapType&&(s="SHADOWMAP_TYPE_VSM"),s}(a),M=function eM(f){let s="ENVMAP_TYPE_CUBE";if(f.envMap)switch(f.envMapMode){case Bi:case $a:s="ENVMAP_TYPE_CUBE";break;case 306:s="ENVMAP_TYPE_CUBE_UV"}return s}(a),C=function s1(f){let s="ENVMAP_MODE_REFLECTION";return f.envMap&&f.envMapMode===$a&&(s="ENVMAP_MODE_REFRACTION"),s}(a),A=function Zv(f){let s="ENVMAP_BLENDING_NONE";if(f.envMap)switch(f.combine){case 0:s="ENVMAP_BLENDING_MULTIPLY";break;case 1:s="ENVMAP_BLENDING_MIX";break;case 2:s="ENVMAP_BLENDING_ADD"}return s}(a),D=function o1(f){const s=f.envMapCubeUVHeight;if(null===s)return null;const a=Math.log2(s/32+1)+3,u=1/s;return{texelWidth:1/(3*Math.max(Math.pow(2,a),112)),texelHeight:u,maxMip:a}}(a),R=a.isWebGL2?"":function $w(f){return[f.extensionDerivatives||f.envMapCubeUVHeight||f.bumpMap||f.tangentSpaceNormalMap||f.clearcoatNormalMap||f.flatShading||"physical"===f.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(f.extensionFragDepth||f.logarithmicDepthBuffer)&&f.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",f.extensionDrawBuffers&&f.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(f.extensionShaderTextureLOD||f.envMap||f.transmission)&&f.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Qu).join("\n")}(a),L=function I2(f){const s=[];for(const a in f){const u=f[a];!1!==u&&s.push("#define "+a+" "+u)}return s.join("\n")}(m),P=h.createProgram();let I,z,B=a.glslVersion?"#version "+a.glslVersion+"\n":"";a.isRawShaderMaterial?(I=[L].filter(Qu).join("\n"),I.length>0&&(I+="\n"),z=[R,L].filter(Qu).join("\n"),z.length>0&&(z+="\n")):(I=[th(a),"#define SHADER_NAME "+a.shaderName,L,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+C:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.morphColors&&a.isWebGL2?"#define USE_MORPHCOLORS":"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+a.morphTextureStride:"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Qu).join("\n"),z=[R,th(a),"#define SHADER_NAME "+a.shaderName,L,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+M:"",a.envMap?"#define "+C:"",a.envMap?"#define "+A:"",D?"#define CUBEUV_TEXEL_WIDTH "+D.texelWidth:"",D?"#define CUBEUV_TEXEL_HEIGHT "+D.texelHeight:"",D?"#define CUBEUV_MAX_MIP "+D.maxMip+".0":"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?oi.tonemapping_pars_fragment:"",0!==a.toneMapping?P2("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.opaque?"#define OPAQUE":"",oi.encodings_pars_fragment,R2("linearToOutputTexel",a.outputEncoding),a.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(Qu).join("\n")),g=eh(g),g=Yg(g,a),g=Yw(g,a),_=eh(_),_=Yg(_,a),_=Yw(_,a),g=Kg(g),_=Kg(_),a.isWebGL2&&!0!==a.isRawShaderMaterial&&(B="#version 300 es\n",I=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+I,z=["#define varying in",a.glslVersion===Ob?"":"layout(location = 0) out highp vec4 pc_fragColor;",a.glslVersion===Ob?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+z);const G=B+z+_,Y=Xw(h,h.VERTEX_SHADER,B+I+g),le=Xw(h,h.FRAGMENT_SHADER,G);if(h.attachShader(P,Y),h.attachShader(P,le),void 0!==a.index0AttributeName?h.bindAttribLocation(P,0,a.index0AttributeName):!0===a.morphTargets&&h.bindAttribLocation(P,0,"position"),h.linkProgram(P),f.debug.checkShaderErrors){const Ve=h.getProgramInfoLog(P).trim(),we=h.getShaderInfoLog(Y).trim(),X=h.getShaderInfoLog(le).trim();let he=!0,ft=!0;if(!1===h.getProgramParameter(P,h.LINK_STATUS)){he=!1;const Ee=tl(h,Y,"vertex"),Be=tl(h,le,"fragment");console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(P,h.VALIDATE_STATUS)+"\n\nProgram Info Log: "+Ve+"\n"+Ee+"\n"+Be)}else""!==Ve?console.warn("THREE.WebGLProgram: Program Info Log:",Ve):(""===we||""===X)&&(ft=!1);ft&&(this.diagnostics={runnable:he,programLog:Ve,vertexShader:{log:we,prefix:I},fragmentShader:{log:X,prefix:z}})}let fe,ye;return h.deleteShader(Y),h.deleteShader(le),this.getUniforms=function(){return void 0===fe&&(fe=new $c(h,P)),fe},this.getAttributes=function(){return void 0===ye&&(ye=function ua(f,s){const a={},u=f.getProgramParameter(s,f.ACTIVE_ATTRIBUTES);for(let h=0;h<u;h++){const m=f.getActiveAttrib(s,h),g=m.name;let _=1;m.type===f.FLOAT_MAT2&&(_=2),m.type===f.FLOAT_MAT3&&(_=3),m.type===f.FLOAT_MAT4&&(_=4),a[g]={type:m.type,location:f.getAttribLocation(s,g),locationSize:_}}return a}(h,P)),ye},this.destroy=function(){u.releaseStatesOfProgram(this),h.deleteProgram(P),this.program=void 0},this.name=a.shaderName,this.id=$v++,this.cacheKey=s,this.usedTimes=1,this.program=P,this.vertexShader=Y,this.fragmentShader=le,this}let l1=0;class c1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(s){const u=s.fragmentShader,h=this._getShaderStage(s.vertexShader),m=this._getShaderStage(u),g=this._getShaderCacheForMaterial(s);return!1===g.has(h)&&(g.add(h),h.usedTimes++),!1===g.has(m)&&(g.add(m),m.usedTimes++),this}remove(s){const a=this.materialCache.get(s);for(const u of a)u.usedTimes--,0===u.usedTimes&&this.shaderCache.delete(u.code);return this.materialCache.delete(s),this}getVertexShaderID(s){return this._getShaderStage(s.vertexShader).id}getFragmentShaderID(s){return this._getShaderStage(s.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(s){const a=this.materialCache;return!1===a.has(s)&&a.set(s,new Set),a.get(s)}_getShaderStage(s){const a=this.shaderCache;if(!1===a.has(s)){const u=new u1(s);a.set(s,u)}return a.get(s)}}class u1{constructor(s){this.id=l1++,this.code=s,this.usedTimes=0}}function h1(f,s,a,u,h,m,g){const _=new _d,w=new c1,M=[],C=h.isWebGL2,A=h.logarithmicDepthBuffer,D=h.floatVertexTextures,R=h.maxVertexUniforms,L=h.vertexTextures;let P=h.precision;const I={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function B(X,he,ft,Ee,Be){const Ie=Ee.fog,je=Be.geometry,lt=(X.isMeshStandardMaterial?a:s).get(X.envMap||(X.isMeshStandardMaterial?Ee.environment:null)),dt=lt&&306===lt.mapping?lt.image.height:null,wt=I[X.type],mt=Be.isSkinnedMesh?function z(X){const ft=X.skeleton.bones;if(D)return 1024;{const Be=Math.floor((R-20)/4),Ie=Math.min(Be,ft.length);return Ie<ft.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ft.length+" bones. This GPU supports "+Ie+"."),0):Ie}}(Be):0;null!==X.precision&&(P=h.getMaxPrecision(X.precision),P!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",P,"instead."));const bn=je.morphAttributes.position||je.morphAttributes.normal||je.morphAttributes.color,yi=void 0!==bn?bn.length:0;let Se,sr,ai,li,$n=0;if(void 0!==je.morphAttributes.position&&($n=1),void 0!==je.morphAttributes.normal&&($n=2),void 0!==je.morphAttributes.color&&($n=3),wt){const xt=Ia[wt];Se=xt.vertexShader,sr=xt.fragmentShader}else Se=X.vertexShader,sr=X.fragmentShader,w.update(X),ai=w.getVertexShaderID(X),li=w.getFragmentShaderID(X);const Pt=f.getRenderTarget(),Je=X.clearcoat>0;return{isWebGL2:C,shaderID:wt,shaderName:X.type,vertexShader:Se,fragmentShader:sr,defines:X.defines,customVertexShaderID:ai,customFragmentShaderID:li,isRawShaderMaterial:!0===X.isRawShaderMaterial,glslVersion:X.glslVersion,precision:P,instancing:!0===Be.isInstancedMesh,instancingColor:!0===Be.isInstancedMesh&&null!==Be.instanceColor,supportsVertexTextures:L,outputEncoding:null===Pt?f.outputEncoding:!0===Pt.isXRRenderTarget?Pt.texture.encoding:Ls,map:!!X.map,matcap:!!X.matcap,envMap:!!lt,envMapMode:lt&&lt.mapping,envMapCubeUVHeight:dt,lightMap:!!X.lightMap,aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:1===X.normalMapType,tangentSpaceNormalMap:0===X.normalMapType,decodeVideoTexture:!!X.map&&!0===X.map.isVideoTexture&&X.map.encoding===Dr,clearcoat:Je,clearcoatMap:Je&&!!X.clearcoatMap,clearcoatRoughnessMap:Je&&!!X.clearcoatRoughnessMap,clearcoatNormalMap:Je&&!!X.clearcoatNormalMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,specularIntensityMap:!!X.specularIntensityMap,specularColorMap:!!X.specularColorMap,opaque:!1===X.transparent&&1===X.blending,alphaMap:!!X.alphaMap,alphaTest:X.alphaTest>0,gradientMap:!!X.gradientMap,sheen:X.sheen>0,sheenColorMap:!!X.sheenColorMap,sheenRoughnessMap:!!X.sheenRoughnessMap,transmission:X.transmission>0,transmissionMap:!!X.transmissionMap,thicknessMap:!!X.thicknessMap,combine:X.combine,vertexTangents:!!X.normalMap&&!!je.attributes.tangent,vertexColors:X.vertexColors,vertexAlphas:!0===X.vertexColors&&!!je.attributes.color&&4===je.attributes.color.itemSize,vertexUvs:!!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatMap||X.clearcoatRoughnessMap||X.clearcoatNormalMap||X.displacementMap||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheenColorMap||X.sheenRoughnessMap),uvsVertexOnly:!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatNormalMap||X.transmission>0||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheen>0||X.sheenColorMap||X.sheenRoughnessMap||!X.displacementMap),fog:!!Ie,useFog:X.fog,fogExp2:Ie&&Ie.isFogExp2,flatShading:!!X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:A,skinning:!0===Be.isSkinnedMesh&&mt>0,maxBones:mt,useVertexTexture:D,morphTargets:void 0!==je.morphAttributes.position,morphNormals:void 0!==je.morphAttributes.normal,morphColors:void 0!==je.morphAttributes.color,morphTargetsCount:yi,morphTextureStride:$n,numDirLights:he.directional.length,numPointLights:he.point.length,numSpotLights:he.spot.length,numRectAreaLights:he.rectArea.length,numHemiLights:he.hemi.length,numDirLightShadows:he.directionalShadowMap.length,numPointLightShadows:he.pointShadowMap.length,numSpotLightShadows:he.spotShadowMap.length,numClippingPlanes:g.numPlanes,numClipIntersection:g.numIntersection,dithering:X.dithering,shadowMapEnabled:f.shadowMap.enabled&&ft.length>0,shadowMapType:f.shadowMap.type,toneMapping:X.toneMapped?f.toneMapping:0,physicallyCorrectLights:f.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,doubleSided:2===X.side,flipSided:1===X.side,depthPacking:void 0!==X.depthPacking&&X.depthPacking,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:C||u.has("EXT_frag_depth"),rendererExtensionDrawBuffers:C||u.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:C||u.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}},getProgramCacheKey:function j(X){const he=[];if(X.shaderID?he.push(X.shaderID):(he.push(X.customVertexShaderID),he.push(X.customFragmentShaderID)),void 0!==X.defines)for(const ft in X.defines)he.push(ft),he.push(X.defines[ft]);return!1===X.isRawShaderMaterial&&(function G(X,he){X.push(he.precision),X.push(he.outputEncoding),X.push(he.envMapMode),X.push(he.envMapCubeUVHeight),X.push(he.combine),X.push(he.vertexUvs),X.push(he.fogExp2),X.push(he.sizeAttenuation),X.push(he.maxBones),X.push(he.morphTargetsCount),X.push(he.morphAttributeCount),X.push(he.numDirLights),X.push(he.numPointLights),X.push(he.numSpotLights),X.push(he.numHemiLights),X.push(he.numRectAreaLights),X.push(he.numDirLightShadows),X.push(he.numPointLightShadows),X.push(he.numSpotLightShadows),X.push(he.shadowMapType),X.push(he.toneMapping),X.push(he.numClippingPlanes),X.push(he.numClipIntersection)}(he,X),function Y(X,he){_.disableAll(),he.isWebGL2&&_.enable(0),he.supportsVertexTextures&&_.enable(1),he.instancing&&_.enable(2),he.instancingColor&&_.enable(3),he.map&&_.enable(4),he.matcap&&_.enable(5),he.envMap&&_.enable(6),he.lightMap&&_.enable(7),he.aoMap&&_.enable(8),he.emissiveMap&&_.enable(9),he.bumpMap&&_.enable(10),he.normalMap&&_.enable(11),he.objectSpaceNormalMap&&_.enable(12),he.tangentSpaceNormalMap&&_.enable(13),he.clearcoat&&_.enable(14),he.clearcoatMap&&_.enable(15),he.clearcoatRoughnessMap&&_.enable(16),he.clearcoatNormalMap&&_.enable(17),he.displacementMap&&_.enable(18),he.specularMap&&_.enable(19),he.roughnessMap&&_.enable(20),he.metalnessMap&&_.enable(21),he.gradientMap&&_.enable(22),he.alphaMap&&_.enable(23),he.alphaTest&&_.enable(24),he.vertexColors&&_.enable(25),he.vertexAlphas&&_.enable(26),he.vertexUvs&&_.enable(27),he.vertexTangents&&_.enable(28),he.uvsVertexOnly&&_.enable(29),he.fog&&_.enable(30),X.push(_.mask),_.disableAll(),he.useFog&&_.enable(0),he.flatShading&&_.enable(1),he.logarithmicDepthBuffer&&_.enable(2),he.skinning&&_.enable(3),he.useVertexTexture&&_.enable(4),he.morphTargets&&_.enable(5),he.morphNormals&&_.enable(6),he.morphColors&&_.enable(7),he.premultipliedAlpha&&_.enable(8),he.shadowMapEnabled&&_.enable(9),he.physicallyCorrectLights&&_.enable(10),he.doubleSided&&_.enable(11),he.flipSided&&_.enable(12),he.depthPacking&&_.enable(13),he.dithering&&_.enable(14),he.specularIntensityMap&&_.enable(15),he.specularColorMap&&_.enable(16),he.transmission&&_.enable(17),he.transmissionMap&&_.enable(18),he.thicknessMap&&_.enable(19),he.sheen&&_.enable(20),he.sheenColorMap&&_.enable(21),he.sheenRoughnessMap&&_.enable(22),he.decodeVideoTexture&&_.enable(23),he.opaque&&_.enable(24),X.push(_.mask)}(he,X),he.push(f.outputEncoding)),he.push(X.customProgramCacheKey),he.join()},getUniforms:function le(X){const he=I[X.type];let ft;return ft=he?ac.clone(Ia[he].uniforms):X.uniforms,ft},acquireProgram:function fe(X,he){let ft;for(let Ee=0,Be=M.length;Ee<Be;Ee++){const Ie=M[Ee];if(Ie.cacheKey===he){ft=Ie,++ft.usedTimes;break}}return void 0===ft&&(ft=new a1(f,he,X,m),M.push(ft)),ft},releaseProgram:function ye(X){if(0==--X.usedTimes){const he=M.indexOf(X);M[he]=M[M.length-1],M.pop(),X.destroy()}},releaseShaderCache:function Ve(X){w.remove(X)},programs:M,dispose:function we(){w.dispose()}}}function tM(){let f=new WeakMap;return{get:function s(m){let g=f.get(m);return void 0===g&&(g={},f.set(m,g)),g},remove:function a(m){f.delete(m)},update:function u(m,g,_){f.get(m)[g]=_},dispose:function h(){f=new WeakMap}}}function Jv(f,s){return f.groupOrder!==s.groupOrder?f.groupOrder-s.groupOrder:f.renderOrder!==s.renderOrder?f.renderOrder-s.renderOrder:f.material.id!==s.material.id?f.material.id-s.material.id:f.z!==s.z?f.z-s.z:f.id-s.id}function Qv(f,s){return f.groupOrder!==s.groupOrder?f.groupOrder-s.groupOrder:f.renderOrder!==s.renderOrder?f.renderOrder-s.renderOrder:f.z!==s.z?s.z-f.z:f.id-s.id}function Zg(){const f=[];let s=0;const a=[],u=[],h=[];function g(A,D,R,L,P,I){let z=f[s];return void 0===z?(z={id:A.id,object:A,geometry:D,material:R,groupOrder:L,renderOrder:A.renderOrder,z:P,group:I},f[s]=z):(z.id=A.id,z.object=A,z.geometry=D,z.material=R,z.groupOrder=L,z.renderOrder=A.renderOrder,z.z=P,z.group=I),s++,z}return{opaque:a,transmissive:u,transparent:h,init:function m(){s=0,a.length=0,u.length=0,h.length=0},push:function _(A,D,R,L,P,I){const z=g(A,D,R,L,P,I);R.transmission>0?u.push(z):!0===R.transparent?h.push(z):a.push(z)},unshift:function w(A,D,R,L,P,I){const z=g(A,D,R,L,P,I);R.transmission>0?u.unshift(z):!0===R.transparent?h.unshift(z):a.unshift(z)},finish:function C(){for(let A=s,D=f.length;A<D;A++){const R=f[A];if(null===R.id)break;R.id=null,R.object=null,R.geometry=null,R.material=null,R.group=null}},sort:function M(A,D){a.length>1&&a.sort(A||Jv),u.length>1&&u.sort(D||Qv),h.length>1&&h.sort(D||Qv)}}}function d1(){let f=new WeakMap;return{get:function s(u,h){let m;return!1===f.has(u)?(m=new Zg,f.set(u,[m])):h>=f.get(u).length?(m=new Zg,f.get(u).push(m)):m=f.get(u)[h],m},dispose:function a(){f=new WeakMap}}}function f1(){const f={};return{get:function(s){if(void 0!==f[s.id])return f[s.id];let a;switch(s.type){case"DirectionalLight":a={direction:new J,color:new Dt};break;case"SpotLight":a={position:new J,direction:new J,color:new Dt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new J,color:new Dt,distance:0,decay:0};break;case"HemisphereLight":a={direction:new J,skyColor:new Dt,groundColor:new Dt};break;case"RectAreaLight":a={color:new Dt,position:new J,halfWidth:new J,halfHeight:new J}}return f[s.id]=a,a}}}let iM=0;function nh(f,s){return(s.castShadow?1:0)-(f.castShadow?1:0)}function rM(f,s){const a=new f1,u=function nM(){const f={};return{get:function(s){if(void 0!==f[s.id])return f[s.id];let a;switch(s.type){case"DirectionalLight":case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe,shadowCameraNear:1,shadowCameraFar:1e3}}return f[s.id]=a,a}}}(),h={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let C=0;C<9;C++)h.probe.push(new J);const m=new J,g=new cn,_=new cn;return{setup:function w(C,A){let D=0,R=0,L=0;for(let Ve=0;Ve<9;Ve++)h.probe[Ve].set(0,0,0);let P=0,I=0,z=0,B=0,j=0,G=0,Y=0,le=0;C.sort(nh);const fe=!0!==A?Math.PI:1;for(let Ve=0,we=C.length;Ve<we;Ve++){const X=C[Ve],he=X.color,ft=X.intensity,Ee=X.distance,Be=X.shadow&&X.shadow.map?X.shadow.map.texture:null;if(X.isAmbientLight)D+=he.r*ft*fe,R+=he.g*ft*fe,L+=he.b*ft*fe;else if(X.isLightProbe)for(let Ie=0;Ie<9;Ie++)h.probe[Ie].addScaledVector(X.sh.coefficients[Ie],ft);else if(X.isDirectionalLight){const Ie=a.get(X);if(Ie.color.copy(X.color).multiplyScalar(X.intensity*fe),X.castShadow){const je=X.shadow,Me=u.get(X);Me.shadowBias=je.bias,Me.shadowNormalBias=je.normalBias,Me.shadowRadius=je.radius,Me.shadowMapSize=je.mapSize,h.directionalShadow[P]=Me,h.directionalShadowMap[P]=Be,h.directionalShadowMatrix[P]=X.shadow.matrix,G++}h.directional[P]=Ie,P++}else if(X.isSpotLight){const Ie=a.get(X);if(Ie.position.setFromMatrixPosition(X.matrixWorld),Ie.color.copy(he).multiplyScalar(ft*fe),Ie.distance=Ee,Ie.coneCos=Math.cos(X.angle),Ie.penumbraCos=Math.cos(X.angle*(1-X.penumbra)),Ie.decay=X.decay,X.castShadow){const je=X.shadow,Me=u.get(X);Me.shadowBias=je.bias,Me.shadowNormalBias=je.normalBias,Me.shadowRadius=je.radius,Me.shadowMapSize=je.mapSize,h.spotShadow[z]=Me,h.spotShadowMap[z]=Be,h.spotShadowMatrix[z]=X.shadow.matrix,le++}h.spot[z]=Ie,z++}else if(X.isRectAreaLight){const Ie=a.get(X);Ie.color.copy(he).multiplyScalar(ft),Ie.halfWidth.set(.5*X.width,0,0),Ie.halfHeight.set(0,.5*X.height,0),h.rectArea[B]=Ie,B++}else if(X.isPointLight){const Ie=a.get(X);if(Ie.color.copy(X.color).multiplyScalar(X.intensity*fe),Ie.distance=X.distance,Ie.decay=X.decay,X.castShadow){const je=X.shadow,Me=u.get(X);Me.shadowBias=je.bias,Me.shadowNormalBias=je.normalBias,Me.shadowRadius=je.radius,Me.shadowMapSize=je.mapSize,Me.shadowCameraNear=je.camera.near,Me.shadowCameraFar=je.camera.far,h.pointShadow[I]=Me,h.pointShadowMap[I]=Be,h.pointShadowMatrix[I]=X.shadow.matrix,Y++}h.point[I]=Ie,I++}else if(X.isHemisphereLight){const Ie=a.get(X);Ie.skyColor.copy(X.color).multiplyScalar(ft*fe),Ie.groundColor.copy(X.groundColor).multiplyScalar(ft*fe),h.hemi[j]=Ie,j++}}B>0&&(s.isWebGL2||!0===f.has("OES_texture_float_linear")?(h.rectAreaLTC1=Rt.LTC_FLOAT_1,h.rectAreaLTC2=Rt.LTC_FLOAT_2):!0===f.has("OES_texture_half_float_linear")?(h.rectAreaLTC1=Rt.LTC_HALF_1,h.rectAreaLTC2=Rt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),h.ambient[0]=D,h.ambient[1]=R,h.ambient[2]=L;const ye=h.hash;(ye.directionalLength!==P||ye.pointLength!==I||ye.spotLength!==z||ye.rectAreaLength!==B||ye.hemiLength!==j||ye.numDirectionalShadows!==G||ye.numPointShadows!==Y||ye.numSpotShadows!==le)&&(h.directional.length=P,h.spot.length=z,h.rectArea.length=B,h.point.length=I,h.hemi.length=j,h.directionalShadow.length=G,h.directionalShadowMap.length=G,h.pointShadow.length=Y,h.pointShadowMap.length=Y,h.spotShadow.length=le,h.spotShadowMap.length=le,h.directionalShadowMatrix.length=G,h.pointShadowMatrix.length=Y,h.spotShadowMatrix.length=le,ye.directionalLength=P,ye.pointLength=I,ye.spotLength=z,ye.rectAreaLength=B,ye.hemiLength=j,ye.numDirectionalShadows=G,ye.numPointShadows=Y,ye.numSpotShadows=le,h.version=iM++)},setupView:function M(C,A){let D=0,R=0,L=0,P=0,I=0;const z=A.matrixWorldInverse;for(let B=0,j=C.length;B<j;B++){const G=C[B];if(G.isDirectionalLight){const Y=h.directional[D];Y.direction.setFromMatrixPosition(G.matrixWorld),m.setFromMatrixPosition(G.target.matrixWorld),Y.direction.sub(m),Y.direction.transformDirection(z),D++}else if(G.isSpotLight){const Y=h.spot[L];Y.position.setFromMatrixPosition(G.matrixWorld),Y.position.applyMatrix4(z),Y.direction.setFromMatrixPosition(G.matrixWorld),m.setFromMatrixPosition(G.target.matrixWorld),Y.direction.sub(m),Y.direction.transformDirection(z),L++}else if(G.isRectAreaLight){const Y=h.rectArea[P];Y.position.setFromMatrixPosition(G.matrixWorld),Y.position.applyMatrix4(z),_.identity(),g.copy(G.matrixWorld),g.premultiply(z),_.extractRotation(g),Y.halfWidth.set(.5*G.width,0,0),Y.halfHeight.set(0,.5*G.height,0),Y.halfWidth.applyMatrix4(_),Y.halfHeight.applyMatrix4(_),P++}else if(G.isPointLight){const Y=h.point[R];Y.position.setFromMatrixPosition(G.matrixWorld),Y.position.applyMatrix4(z),R++}else if(G.isHemisphereLight){const Y=h.hemi[I];Y.direction.setFromMatrixPosition(G.matrixWorld),Y.direction.transformDirection(z),Y.direction.normalize(),I++}}},state:h}}function e0(f,s){const a=new rM(f,s),u=[],h=[];return{init:function m(){u.length=0,h.length=0},state:{lightsArray:u,shadowsArray:h,lights:a},setupLights:function w(A){a.setup(u,A)},setupLightsView:function M(A){a.setupView(u,A)},pushLight:function g(A){u.push(A)},pushShadow:function _(A){h.push(A)}}}function p1(f,s){let a=new WeakMap;return{get:function u(m,g=0){let _;return!1===a.has(m)?(_=new e0(f,s),a.set(m,[_])):g>=a.get(m).length?(_=new e0(f,s),a.get(m).push(_)):_=a.get(m)[g],_},dispose:function h(){a=new WeakMap}}}class ih extends Qt{constructor(s){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(s)}copy(s){return super.copy(s),this.depthPacking=s.depthPacking,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this}}ih.prototype.isMeshDepthMaterial=!0;class Jg extends Qt{constructor(s){super(),this.type="MeshDistanceMaterial",this.referencePosition=new J,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(s)}copy(s){return super.copy(s),this.referencePosition.copy(s.referencePosition),this.nearDistance=s.nearDistance,this.farDistance=s.farDistance,this.map=s.map,this.alphaMap=s.alphaMap,this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this}}function t0(f,s,a){let u=new yp;const h=new Qe,m=new Qe,g=new Xi,_=new ih({depthPacking:3201}),w=new Jg,M={},C=a.maxTextureSize,A={0:1,1:0,2:2},D=new Ra({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qe},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),R=D.clone();R.defines.HORIZONTAL_PASS=1;const L=new en;L.setAttribute("position",new Ni(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const P=new Jr(L,D),I=this;function z(G,Y){const le=s.update(P);D.defines.VSM_SAMPLES!==G.blurSamples&&(D.defines.VSM_SAMPLES=G.blurSamples,R.defines.VSM_SAMPLES=G.blurSamples,D.needsUpdate=!0,R.needsUpdate=!0),D.uniforms.shadow_pass.value=G.map.texture,D.uniforms.resolution.value=G.mapSize,D.uniforms.radius.value=G.radius,f.setRenderTarget(G.mapPass),f.clear(),f.renderBufferDirect(Y,null,le,D,P,null),R.uniforms.shadow_pass.value=G.mapPass.texture,R.uniforms.resolution.value=G.mapSize,R.uniforms.radius.value=G.radius,f.setRenderTarget(G.map),f.clear(),f.renderBufferDirect(Y,null,le,R,P,null)}function B(G,Y,le,fe,ye,Ve){let we=null;const X=!0===le.isPointLight?G.customDistanceMaterial:G.customDepthMaterial;if(we=void 0!==X?X:!0===le.isPointLight?w:_,f.localClippingEnabled&&!0===Y.clipShadows&&0!==Y.clippingPlanes.length||Y.displacementMap&&0!==Y.displacementScale||Y.alphaMap&&Y.alphaTest>0){const he=we.uuid,ft=Y.uuid;let Ee=M[he];void 0===Ee&&(Ee={},M[he]=Ee);let Be=Ee[ft];void 0===Be&&(Be=we.clone(),Ee[ft]=Be),we=Be}return we.visible=Y.visible,we.wireframe=Y.wireframe,we.side=3===Ve?null!==Y.shadowSide?Y.shadowSide:Y.side:null!==Y.shadowSide?Y.shadowSide:A[Y.side],we.alphaMap=Y.alphaMap,we.alphaTest=Y.alphaTest,we.clipShadows=Y.clipShadows,we.clippingPlanes=Y.clippingPlanes,we.clipIntersection=Y.clipIntersection,we.displacementMap=Y.displacementMap,we.displacementScale=Y.displacementScale,we.displacementBias=Y.displacementBias,we.wireframeLinewidth=Y.wireframeLinewidth,we.linewidth=Y.linewidth,!0===le.isPointLight&&!0===we.isMeshDistanceMaterial&&(we.referencePosition.setFromMatrixPosition(le.matrixWorld),we.nearDistance=fe,we.farDistance=ye),we}function j(G,Y,le,fe,ye){if(!1===G.visible)return;if(G.layers.test(Y.layers)&&(G.isMesh||G.isLine||G.isPoints)&&(G.castShadow||G.receiveShadow&&3===ye)&&(!G.frustumCulled||u.intersectsObject(G))){G.modelViewMatrix.multiplyMatrices(le.matrixWorldInverse,G.matrixWorld);const X=s.update(G),he=G.material;if(Array.isArray(he)){const ft=X.groups;for(let Ee=0,Be=ft.length;Ee<Be;Ee++){const Ie=ft[Ee],je=he[Ie.materialIndex];if(je&&je.visible){const Me=B(G,je,fe,le.near,le.far,ye);f.renderBufferDirect(le,null,X,Me,G,Ie)}}}else if(he.visible){const ft=B(G,he,fe,le.near,le.far,ye);f.renderBufferDirect(le,null,X,ft,G,null)}}const we=G.children;for(let X=0,he=we.length;X<he;X++)j(we[X],Y,le,fe,ye)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(G,Y,le){if(!1===I.enabled||!1===I.autoUpdate&&!1===I.needsUpdate||0===G.length)return;const fe=f.getRenderTarget(),ye=f.getActiveCubeFace(),Ve=f.getActiveMipmapLevel(),we=f.state;we.setBlending(0),we.buffers.color.setClear(1,1,1,1),we.buffers.depth.setTest(!0),we.setScissorTest(!1);for(let X=0,he=G.length;X<he;X++){const ft=G[X],Ee=ft.shadow;if(void 0===Ee){console.warn("THREE.WebGLShadowMap:",ft,"has no shadow.");continue}if(!1===Ee.autoUpdate&&!1===Ee.needsUpdate)continue;h.copy(Ee.mapSize);const Be=Ee.getFrameExtents();h.multiply(Be),m.copy(Ee.mapSize),(h.x>C||h.y>C)&&(h.x>C&&(m.x=Math.floor(C/Be.x),h.x=m.x*Be.x,Ee.mapSize.x=m.x),h.y>C&&(m.y=Math.floor(C/Be.y),h.y=m.y*Be.y,Ee.mapSize.y=m.y)),null===Ee.map&&!Ee.isPointLightShadow&&3===this.type&&(Ee.map=new cs(h.x,h.y),Ee.map.texture.name=ft.name+".shadowMap",Ee.mapPass=new cs(h.x,h.y),Ee.camera.updateProjectionMatrix()),null===Ee.map&&(Ee.map=new cs(h.x,h.y,{minFilter:zr,magFilter:zr,format:At}),Ee.map.texture.name=ft.name+".shadowMap",Ee.camera.updateProjectionMatrix()),f.setRenderTarget(Ee.map),f.clear();const Ie=Ee.getViewportCount();for(let je=0;je<Ie;je++){const Me=Ee.getViewport(je);g.set(m.x*Me.x,m.y*Me.y,m.x*Me.z,m.y*Me.w),we.viewport(g),Ee.updateMatrices(ft,je),u=Ee.getFrustum(),j(Y,le,Ee.camera,ft,this.type)}!Ee.isPointLightShadow&&3===this.type&&z(Ee,le),Ee.needsUpdate=!1}I.needsUpdate=!1,f.setRenderTarget(fe,ye,Ve)}}function n0(f,s,a){const u=a.isWebGL2,_=new function h(){let me=!1;const Ut=new Xi;let Lt=null;const Fn=new Xi(0,0,0,0);return{setMask:function(an){Lt!==an&&!me&&(f.colorMask(an,an,an,an),Lt=an)},setLocked:function(an){me=an},setClear:function(an,Nn,St,rn,Pr){!0===Pr&&(an*=rn,Nn*=rn,St*=rn),Ut.set(an,Nn,St,rn),!1===Fn.equals(Ut)&&(f.clearColor(an,Nn,St,rn),Fn.copy(Ut))},reset:function(){me=!1,Lt=null,Fn.set(-1,0,0,0)}}},w=new function m(){let me=!1,Ut=null,Lt=null,Fn=null;return{setTest:function(an){an?$n(f.DEPTH_TEST):Se(f.DEPTH_TEST)},setMask:function(an){Ut!==an&&!me&&(f.depthMask(an),Ut=an)},setFunc:function(an){if(Lt!==an){if(an)switch(an){case 0:f.depthFunc(f.NEVER);break;case 1:f.depthFunc(f.ALWAYS);break;case 2:f.depthFunc(f.LESS);break;case 3:default:f.depthFunc(f.LEQUAL);break;case 4:f.depthFunc(f.EQUAL);break;case 5:f.depthFunc(f.GEQUAL);break;case 6:f.depthFunc(f.GREATER);break;case 7:f.depthFunc(f.NOTEQUAL)}else f.depthFunc(f.LEQUAL);Lt=an}},setLocked:function(an){me=an},setClear:function(an){Fn!==an&&(f.clearDepth(an),Fn=an)},reset:function(){me=!1,Ut=null,Lt=null,Fn=null}}},M=new function g(){let me=!1,Ut=null,Lt=null,Fn=null,an=null,Nn=null,St=null,rn=null,Pr=null;return{setTest:function(Pi){me||(Pi?$n(f.STENCIL_TEST):Se(f.STENCIL_TEST))},setMask:function(Pi){Ut!==Pi&&!me&&(f.stencilMask(Pi),Ut=Pi)},setFunc:function(Pi,Ol,kl){(Lt!==Pi||Fn!==Ol||an!==kl)&&(f.stencilFunc(Pi,Ol,kl),Lt=Pi,Fn=Ol,an=kl)},setOp:function(Pi,Ol,kl){(Nn!==Pi||St!==Ol||rn!==kl)&&(f.stencilOp(Pi,Ol,kl),Nn=Pi,St=Ol,rn=kl)},setLocked:function(Pi){me=Pi},setClear:function(Pi){Pr!==Pi&&(f.clearStencil(Pi),Pr=Pi)},reset:function(){me=!1,Ut=null,Lt=null,Fn=null,an=null,Nn=null,St=null,rn=null,Pr=null}}};let C={},A={},D=new WeakMap,R=[],L=null,P=!1,I=null,z=null,B=null,j=null,G=null,Y=null,le=null,fe=!1,ye=null,Ve=null,we=null,X=null,he=null;const ft=f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ee=!1,Be=0;const Ie=f.getParameter(f.VERSION);-1!==Ie.indexOf("WebGL")?(Be=parseFloat(/^WebGL (\d)/.exec(Ie)[1]),Ee=Be>=1):-1!==Ie.indexOf("OpenGL ES")&&(Be=parseFloat(/^OpenGL ES (\d)/.exec(Ie)[1]),Ee=Be>=2);let je=null,Me={};const lt=f.getParameter(f.SCISSOR_BOX),dt=f.getParameter(f.VIEWPORT),wt=(new Xi).fromArray(lt),mt=(new Xi).fromArray(dt);function bn(me,Ut,Lt){const Fn=new Uint8Array(4),an=f.createTexture();f.bindTexture(me,an),f.texParameteri(me,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(me,f.TEXTURE_MAG_FILTER,f.NEAREST);for(let Nn=0;Nn<Lt;Nn++)f.texImage2D(Ut+Nn,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,Fn);return an}const yi={};function $n(me){!0!==C[me]&&(f.enable(me),C[me]=!0)}function Se(me){!1!==C[me]&&(f.disable(me),C[me]=!1)}yi[f.TEXTURE_2D]=bn(f.TEXTURE_2D,f.TEXTURE_2D,1),yi[f.TEXTURE_CUBE_MAP]=bn(f.TEXTURE_CUBE_MAP,f.TEXTURE_CUBE_MAP_POSITIVE_X,6),_.setClear(0,0,0,1),w.setClear(1),M.setClear(0),$n(f.DEPTH_TEST),w.setFunc(3),xt(!1),un(1),$n(f.CULL_FACE),Je(0);const Pt={100:f.FUNC_ADD,101:f.FUNC_SUBTRACT,102:f.FUNC_REVERSE_SUBTRACT};if(u)Pt[103]=f.MIN,Pt[104]=f.MAX;else{const me=s.get("EXT_blend_minmax");null!==me&&(Pt[103]=me.MIN_EXT,Pt[104]=me.MAX_EXT)}const _i={200:f.ZERO,201:f.ONE,202:f.SRC_COLOR,204:f.SRC_ALPHA,210:f.SRC_ALPHA_SATURATE,208:f.DST_COLOR,206:f.DST_ALPHA,203:f.ONE_MINUS_SRC_COLOR,205:f.ONE_MINUS_SRC_ALPHA,209:f.ONE_MINUS_DST_COLOR,207:f.ONE_MINUS_DST_ALPHA};function Je(me,Ut,Lt,Fn,an,Nn,St,rn){if(0!==me){if(!1===P&&($n(f.BLEND),P=!0),5===me)an=an||Ut,Nn=Nn||Lt,St=St||Fn,(Ut!==z||an!==G)&&(f.blendEquationSeparate(Pt[Ut],Pt[an]),z=Ut,G=an),(Lt!==B||Fn!==j||Nn!==Y||St!==le)&&(f.blendFuncSeparate(_i[Lt],_i[Fn],_i[Nn],_i[St]),B=Lt,j=Fn,Y=Nn,le=St),I=me,fe=null;else if(me!==I||rn!==fe){if((100!==z||100!==G)&&(f.blendEquation(f.FUNC_ADD),z=100,G=100),rn)switch(me){case 1:f.blendFuncSeparate(f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case 2:f.blendFunc(f.ONE,f.ONE);break;case 3:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case 4:f.blendFuncSeparate(f.ZERO,f.SRC_COLOR,f.ZERO,f.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",me)}else switch(me){case 1:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case 2:f.blendFunc(f.SRC_ALPHA,f.ONE);break;case 3:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case 4:f.blendFunc(f.ZERO,f.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",me)}B=null,j=null,Y=null,le=null,I=me,fe=rn}}else!0===P&&(Se(f.BLEND),P=!1)}function xt(me){ye!==me&&(f.frontFace(me?f.CW:f.CCW),ye=me)}function un(me){0!==me?($n(f.CULL_FACE),me!==Ve&&f.cullFace(1===me?f.BACK:2===me?f.FRONT:f.FRONT_AND_BACK)):Se(f.CULL_FACE),Ve=me}function ni(me,Ut,Lt){me?($n(f.POLYGON_OFFSET_FILL),(X!==Ut||he!==Lt)&&(f.polygonOffset(Ut,Lt),X=Ut,he=Lt)):Se(f.POLYGON_OFFSET_FILL)}function En(me){void 0===me&&(me=f.TEXTURE0+ft-1),je!==me&&(f.activeTexture(me),je=me)}return{buffers:{color:_,depth:w,stencil:M},enable:$n,disable:Se,bindFramebuffer:function sr(me,Ut){return A[me]!==Ut&&(f.bindFramebuffer(me,Ut),A[me]=Ut,u&&(me===f.DRAW_FRAMEBUFFER&&(A[f.FRAMEBUFFER]=Ut),me===f.FRAMEBUFFER&&(A[f.DRAW_FRAMEBUFFER]=Ut)),!0)},drawBuffers:function ai(me,Ut){let Lt=R,Fn=!1;if(me)if(Lt=D.get(Ut),void 0===Lt&&(Lt=[],D.set(Ut,Lt)),me.isWebGLMultipleRenderTargets){const an=me.texture;if(Lt.length!==an.length||Lt[0]!==f.COLOR_ATTACHMENT0){for(let Nn=0,St=an.length;Nn<St;Nn++)Lt[Nn]=f.COLOR_ATTACHMENT0+Nn;Lt.length=an.length,Fn=!0}}else Lt[0]!==f.COLOR_ATTACHMENT0&&(Lt[0]=f.COLOR_ATTACHMENT0,Fn=!0);else Lt[0]!==f.BACK&&(Lt[0]=f.BACK,Fn=!0);Fn&&(a.isWebGL2?f.drawBuffers(Lt):s.get("WEBGL_draw_buffers").drawBuffersWEBGL(Lt))},useProgram:function li(me){return L!==me&&(f.useProgram(me),L=me,!0)},setBlending:Je,setMaterial:function rt(me,Ut){2===me.side?Se(f.CULL_FACE):$n(f.CULL_FACE);let Lt=1===me.side;Ut&&(Lt=!Lt),xt(Lt),1===me.blending&&!1===me.transparent?Je(0):Je(me.blending,me.blendEquation,me.blendSrc,me.blendDst,me.blendEquationAlpha,me.blendSrcAlpha,me.blendDstAlpha,me.premultipliedAlpha),w.setFunc(me.depthFunc),w.setTest(me.depthTest),w.setMask(me.depthWrite),_.setMask(me.colorWrite);const Fn=me.stencilWrite;M.setTest(Fn),Fn&&(M.setMask(me.stencilWriteMask),M.setFunc(me.stencilFunc,me.stencilRef,me.stencilFuncMask),M.setOp(me.stencilFail,me.stencilZFail,me.stencilZPass)),ni(me.polygonOffset,me.polygonOffsetFactor,me.polygonOffsetUnits),!0===me.alphaToCoverage?$n(f.SAMPLE_ALPHA_TO_COVERAGE):Se(f.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:xt,setCullFace:un,setLineWidth:function Wt(me){me!==we&&(Ee&&f.lineWidth(me),we=me)},setPolygonOffset:ni,setScissorTest:function Ln(me){me?$n(f.SCISSOR_TEST):Se(f.SCISSOR_TEST)},activeTexture:En,bindTexture:function Rr(me,Ut){null===je&&En();let Lt=Me[je];void 0===Lt&&(Lt={type:void 0,texture:void 0},Me[je]=Lt),(Lt.type!==me||Lt.texture!==Ut)&&(f.bindTexture(me,Ut||yi[me]),Lt.type=me,Lt.texture=Ut)},unbindTexture:function hr(){const me=Me[je];void 0!==me&&void 0!==me.type&&(f.bindTexture(me.type,null),me.type=void 0,me.texture=void 0)},compressedTexImage2D:function ne(){try{f.compressedTexImage2D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},texImage2D:function Bn(){try{f.texImage2D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},texImage3D:function $e(){try{f.texImage3D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},texStorage2D:function qt(){try{f.texStorage2D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},texStorage3D:function Ct(){try{f.texStorage3D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},texSubImage2D:function K(){try{f.texSubImage2D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},texSubImage3D:function Ge(){try{f.texSubImage3D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},compressedTexSubImage2D:function pt(){try{f.compressedTexSubImage2D.apply(f,arguments)}catch(me){console.error("THREE.WebGLState:",me)}},scissor:function ri(me){!1===wt.equals(me)&&(f.scissor(me.x,me.y,me.z,me.w),wt.copy(me))},viewport:function bi(me){!1===mt.equals(me)&&(f.viewport(me.x,me.y,me.z,me.w),mt.copy(me))},reset:function ke(){f.disable(f.BLEND),f.disable(f.CULL_FACE),f.disable(f.DEPTH_TEST),f.disable(f.POLYGON_OFFSET_FILL),f.disable(f.SCISSOR_TEST),f.disable(f.STENCIL_TEST),f.disable(f.SAMPLE_ALPHA_TO_COVERAGE),f.blendEquation(f.FUNC_ADD),f.blendFunc(f.ONE,f.ZERO),f.blendFuncSeparate(f.ONE,f.ZERO,f.ONE,f.ZERO),f.colorMask(!0,!0,!0,!0),f.clearColor(0,0,0,0),f.depthMask(!0),f.depthFunc(f.LESS),f.clearDepth(1),f.stencilMask(4294967295),f.stencilFunc(f.ALWAYS,0,4294967295),f.stencilOp(f.KEEP,f.KEEP,f.KEEP),f.clearStencil(0),f.cullFace(f.BACK),f.frontFace(f.CCW),f.polygonOffset(0,0),f.activeTexture(f.TEXTURE0),f.bindFramebuffer(f.FRAMEBUFFER,null),!0===u&&(f.bindFramebuffer(f.DRAW_FRAMEBUFFER,null),f.bindFramebuffer(f.READ_FRAMEBUFFER,null)),f.useProgram(null),f.lineWidth(1),f.scissor(0,0,f.canvas.width,f.canvas.height),f.viewport(0,0,f.canvas.width,f.canvas.height),C={},je=null,Me={},A={},D=new WeakMap,R=[],L=null,P=!1,I=null,z=null,B=null,j=null,G=null,Y=null,le=null,fe=!1,ye=null,Ve=null,we=null,X=null,he=null,wt.set(0,0,f.canvas.width,f.canvas.height),mt.set(0,0,f.canvas.width,f.canvas.height),_.reset(),w.reset(),M.reset()}}}function aM(f,s,a,u,h,m,g){const _=h.isWebGL2,w=h.maxTextures,M=h.maxCubemapSize,C=h.maxTextureSize,A=h.maxSamples,D=s.has("WEBGL_multisampled_render_to_texture")?s.get("WEBGL_multisampled_render_to_texture"):null,R=/OculusBrowser/g.test(navigator.userAgent),L=new WeakMap;let P;const I=new WeakMap;let z=!1;try{z="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(ne){}function B(ne,K){return z?new OffscreenCanvas(ne,K):Gc("canvas")}function j(ne,K,Ge,pt){let qt=1;if((ne.width>pt||ne.height>pt)&&(qt=pt/Math.max(ne.width,ne.height)),qt<1||!0===K){if("undefined"!=typeof HTMLImageElement&&ne instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&ne instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&ne instanceof ImageBitmap){const Ct=K?np:Math.floor,Bn=Ct(qt*ne.width),$e=Ct(qt*ne.height);void 0===P&&(P=B(Bn,$e));const ri=Ge?B(Bn,$e):P;return ri.width=Bn,ri.height=$e,ri.getContext("2d").drawImage(ne,0,0,Bn,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+Bn+"x"+$e+")."),ri}return"data"in ne&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),ne}return ne}function G(ne){return xs(ne.width)&&xs(ne.height)}function le(ne,K){return ne.generateMipmaps&&K&&ne.minFilter!==zr&&ne.minFilter!==Hr}function fe(ne){f.generateMipmap(ne)}function ye(ne,K,Ge,pt,qt=!1){if(!1===_)return K;if(null!==ne){if(void 0!==f[ne])return f[ne];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ne+"'")}let Ct=K;return K===f.RED&&(Ge===f.FLOAT&&(Ct=f.R32F),Ge===f.HALF_FLOAT&&(Ct=f.R16F),Ge===f.UNSIGNED_BYTE&&(Ct=f.R8)),K===f.RG&&(Ge===f.FLOAT&&(Ct=f.RG32F),Ge===f.HALF_FLOAT&&(Ct=f.RG16F),Ge===f.UNSIGNED_BYTE&&(Ct=f.RG8)),K===f.RGBA&&(Ge===f.FLOAT&&(Ct=f.RGBA32F),Ge===f.HALF_FLOAT&&(Ct=f.RGBA16F),Ge===f.UNSIGNED_BYTE&&(Ct=pt===Dr&&!1===qt?f.SRGB8_ALPHA8:f.RGBA8),Ge===f.UNSIGNED_SHORT_4_4_4_4&&(Ct=f.RGBA4),Ge===f.UNSIGNED_SHORT_5_5_5_1&&(Ct=f.RGB5_A1)),(Ct===f.R16F||Ct===f.R32F||Ct===f.RG16F||Ct===f.RG32F||Ct===f.RGBA16F||Ct===f.RGBA32F)&&s.get("EXT_color_buffer_float"),Ct}function Ve(ne,K,Ge){return!0===le(ne,Ge)||ne.isFramebufferTexture&&ne.minFilter!==zr&&ne.minFilter!==Hr?Math.log2(Math.max(K.width,K.height))+1:void 0!==ne.mipmaps&&ne.mipmaps.length>0?ne.mipmaps.length:ne.isCompressedTexture&&Array.isArray(ne.image)?K.mipmaps.length:1}function we(ne){return ne===zr||1004===ne||1005===ne?f.NEAREST:f.LINEAR}function X(ne){const K=ne.target;K.removeEventListener("dispose",X),function ft(ne){const K=u.get(ne);if(void 0===K.__webglInit)return;const Ge=ne.source,pt=I.get(Ge);if(pt){const qt=pt[K.__cacheKey];qt.usedTimes--,0===qt.usedTimes&&Ee(ne),0===Object.keys(pt).length&&I.delete(Ge)}u.remove(ne)}(K),K.isVideoTexture&&L.delete(K)}function he(ne){const K=ne.target;K.removeEventListener("dispose",he),function Be(ne){const K=ne.texture,Ge=u.get(ne),pt=u.get(K);if(void 0!==pt.__webglTexture&&(f.deleteTexture(pt.__webglTexture),g.memory.textures--),ne.depthTexture&&ne.depthTexture.dispose(),ne.isWebGLCubeRenderTarget)for(let qt=0;qt<6;qt++)f.deleteFramebuffer(Ge.__webglFramebuffer[qt]),Ge.__webglDepthbuffer&&f.deleteRenderbuffer(Ge.__webglDepthbuffer[qt]);else f.deleteFramebuffer(Ge.__webglFramebuffer),Ge.__webglDepthbuffer&&f.deleteRenderbuffer(Ge.__webglDepthbuffer),Ge.__webglMultisampledFramebuffer&&f.deleteFramebuffer(Ge.__webglMultisampledFramebuffer),Ge.__webglColorRenderbuffer&&f.deleteRenderbuffer(Ge.__webglColorRenderbuffer),Ge.__webglDepthRenderbuffer&&f.deleteRenderbuffer(Ge.__webglDepthRenderbuffer);if(ne.isWebGLMultipleRenderTargets)for(let qt=0,Ct=K.length;qt<Ct;qt++){const Bn=u.get(K[qt]);Bn.__webglTexture&&(f.deleteTexture(Bn.__webglTexture),g.memory.textures--),u.remove(K[qt])}u.remove(K),u.remove(ne)}(K)}function Ee(ne){const K=u.get(ne);f.deleteTexture(K.__webglTexture),delete I.get(ne.source)[K.__cacheKey],g.memory.textures--}let Ie=0;function dt(ne,K){const Ge=u.get(ne);if(ne.isVideoTexture&&function Rr(ne){const K=g.render.frame;L.get(ne)!==K&&(L.set(ne,K),ne.update())}(ne),!1===ne.isRenderTargetTexture&&ne.version>0&&Ge.__version!==ne.version){const pt=ne.image;if(null===pt)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==pt.complete)return void ai(Ge,ne,K);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}a.activeTexture(f.TEXTURE0+K),a.bindTexture(f.TEXTURE_2D,Ge.__webglTexture)}const yi={[ho]:f.REPEAT,[_s]:f.CLAMP_TO_EDGE,[ad]:f.MIRRORED_REPEAT},$n={[zr]:f.NEAREST,1004:f.NEAREST_MIPMAP_NEAREST,1005:f.NEAREST_MIPMAP_LINEAR,[Hr]:f.LINEAR,1007:f.LINEAR_MIPMAP_NEAREST,[Ya]:f.LINEAR_MIPMAP_LINEAR};function Se(ne,K,Ge){if(Ge?(f.texParameteri(ne,f.TEXTURE_WRAP_S,yi[K.wrapS]),f.texParameteri(ne,f.TEXTURE_WRAP_T,yi[K.wrapT]),(ne===f.TEXTURE_3D||ne===f.TEXTURE_2D_ARRAY)&&f.texParameteri(ne,f.TEXTURE_WRAP_R,yi[K.wrapR]),f.texParameteri(ne,f.TEXTURE_MAG_FILTER,$n[K.magFilter]),f.texParameteri(ne,f.TEXTURE_MIN_FILTER,$n[K.minFilter])):(f.texParameteri(ne,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(ne,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),(ne===f.TEXTURE_3D||ne===f.TEXTURE_2D_ARRAY)&&f.texParameteri(ne,f.TEXTURE_WRAP_R,f.CLAMP_TO_EDGE),(K.wrapS!==_s||K.wrapT!==_s)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),f.texParameteri(ne,f.TEXTURE_MAG_FILTER,we(K.magFilter)),f.texParameteri(ne,f.TEXTURE_MIN_FILTER,we(K.minFilter)),K.minFilter!==zr&&K.minFilter!==Hr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===s.has("EXT_texture_filter_anisotropic")){const pt=s.get("EXT_texture_filter_anisotropic");if(K.type===W&&!1===s.has("OES_texture_float_linear")||!1===_&&K.type===re&&!1===s.has("OES_texture_half_float_linear"))return;(K.anisotropy>1||u.get(K).__currentAnisotropy)&&(f.texParameterf(ne,pt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(K.anisotropy,h.getMaxAnisotropy())),u.get(K).__currentAnisotropy=K.anisotropy)}}function sr(ne,K){let Ge=!1;void 0===ne.__webglInit&&(ne.__webglInit=!0,K.addEventListener("dispose",X));const pt=K.source;let qt=I.get(pt);void 0===qt&&(qt={},I.set(pt,qt));const Ct=function lt(ne){const K=[];return K.push(ne.wrapS),K.push(ne.wrapT),K.push(ne.magFilter),K.push(ne.minFilter),K.push(ne.anisotropy),K.push(ne.internalFormat),K.push(ne.format),K.push(ne.type),K.push(ne.generateMipmaps),K.push(ne.premultiplyAlpha),K.push(ne.flipY),K.push(ne.unpackAlignment),K.push(ne.encoding),K.join()}(K);if(Ct!==ne.__cacheKey){void 0===qt[Ct]&&(qt[Ct]={texture:f.createTexture(),usedTimes:0},g.memory.textures++,Ge=!0),qt[Ct].usedTimes++;const Bn=qt[ne.__cacheKey];void 0!==Bn&&(qt[ne.__cacheKey].usedTimes--,0===Bn.usedTimes&&Ee(K)),ne.__cacheKey=Ct,ne.__webglTexture=qt[Ct].texture}return Ge}function ai(ne,K,Ge){let pt=f.TEXTURE_2D;K.isDataArrayTexture&&(pt=f.TEXTURE_2D_ARRAY),K.isData3DTexture&&(pt=f.TEXTURE_3D);const qt=sr(ne,K),Ct=K.source;if(a.activeTexture(f.TEXTURE0+Ge),a.bindTexture(pt,ne.__webglTexture),Ct.version!==Ct.__currentVersion||!0===qt){f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,K.flipY),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),f.pixelStorei(f.UNPACK_ALIGNMENT,K.unpackAlignment),f.pixelStorei(f.UNPACK_COLORSPACE_CONVERSION_WEBGL,f.NONE);const Bn=function Y(ne){return!_&&(ne.wrapS!==_s||ne.wrapT!==_s||ne.minFilter!==zr&&ne.minFilter!==Hr)}(K)&&!1===G(K.image);let $e=j(K.image,Bn,!1,C);$e=hr(K,$e);const ri=G($e)||_,bi=m.convert(K.format,K.encoding);let Ut,ke=m.convert(K.type),me=ye(K.internalFormat,bi,ke,K.encoding,K.isVideoTexture);Se(pt,K,ri);const Lt=K.mipmaps,Fn=_&&!0!==K.isVideoTexture,an=void 0===ne.__version,Nn=Ve(K,$e,ri);if(K.isDepthTexture)me=f.DEPTH_COMPONENT,_?me=K.type===W?f.DEPTH_COMPONENT32F:K.type===V?f.DEPTH_COMPONENT24:K.type===Ze?f.DEPTH24_STENCIL8:f.DEPTH_COMPONENT16:K.type===W&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),K.format===vn&&me===f.DEPTH_COMPONENT&&K.type!==va&&K.type!==V&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),K.type=va,ke=m.convert(K.type)),K.format===mr&&me===f.DEPTH_COMPONENT&&(me=f.DEPTH_STENCIL,K.type!==Ze&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),K.type=Ze,ke=m.convert(K.type))),Fn&&an?a.texStorage2D(f.TEXTURE_2D,1,me,$e.width,$e.height):a.texImage2D(f.TEXTURE_2D,0,me,$e.width,$e.height,0,bi,ke,null);else if(K.isDataTexture)if(Lt.length>0&&ri){Fn&&an&&a.texStorage2D(f.TEXTURE_2D,Nn,me,Lt[0].width,Lt[0].height);for(let St=0,rn=Lt.length;St<rn;St++)Ut=Lt[St],Fn?a.texSubImage2D(f.TEXTURE_2D,St,0,0,Ut.width,Ut.height,bi,ke,Ut.data):a.texImage2D(f.TEXTURE_2D,St,me,Ut.width,Ut.height,0,bi,ke,Ut.data);K.generateMipmaps=!1}else Fn?(an&&a.texStorage2D(f.TEXTURE_2D,Nn,me,$e.width,$e.height),a.texSubImage2D(f.TEXTURE_2D,0,0,0,$e.width,$e.height,bi,ke,$e.data)):a.texImage2D(f.TEXTURE_2D,0,me,$e.width,$e.height,0,bi,ke,$e.data);else if(K.isCompressedTexture){Fn&&an&&a.texStorage2D(f.TEXTURE_2D,Nn,me,Lt[0].width,Lt[0].height);for(let St=0,rn=Lt.length;St<rn;St++)Ut=Lt[St],K.format!==At?null!==bi?Fn?a.compressedTexSubImage2D(f.TEXTURE_2D,St,0,0,Ut.width,Ut.height,bi,Ut.data):a.compressedTexImage2D(f.TEXTURE_2D,St,me,Ut.width,Ut.height,0,Ut.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Fn?a.texSubImage2D(f.TEXTURE_2D,St,0,0,Ut.width,Ut.height,bi,ke,Ut.data):a.texImage2D(f.TEXTURE_2D,St,me,Ut.width,Ut.height,0,bi,ke,Ut.data)}else if(K.isDataArrayTexture)Fn?(an&&a.texStorage3D(f.TEXTURE_2D_ARRAY,Nn,me,$e.width,$e.height,$e.depth),a.texSubImage3D(f.TEXTURE_2D_ARRAY,0,0,0,0,$e.width,$e.height,$e.depth,bi,ke,$e.data)):a.texImage3D(f.TEXTURE_2D_ARRAY,0,me,$e.width,$e.height,$e.depth,0,bi,ke,$e.data);else if(K.isData3DTexture)Fn?(an&&a.texStorage3D(f.TEXTURE_3D,Nn,me,$e.width,$e.height,$e.depth),a.texSubImage3D(f.TEXTURE_3D,0,0,0,0,$e.width,$e.height,$e.depth,bi,ke,$e.data)):a.texImage3D(f.TEXTURE_3D,0,me,$e.width,$e.height,$e.depth,0,bi,ke,$e.data);else if(K.isFramebufferTexture)Fn&&an?a.texStorage2D(f.TEXTURE_2D,Nn,me,$e.width,$e.height):a.texImage2D(f.TEXTURE_2D,0,me,$e.width,$e.height,0,bi,ke,null);else if(Lt.length>0&&ri){Fn&&an&&a.texStorage2D(f.TEXTURE_2D,Nn,me,Lt[0].width,Lt[0].height);for(let St=0,rn=Lt.length;St<rn;St++)Ut=Lt[St],Fn?a.texSubImage2D(f.TEXTURE_2D,St,0,0,bi,ke,Ut):a.texImage2D(f.TEXTURE_2D,St,me,bi,ke,Ut);K.generateMipmaps=!1}else Fn?(an&&a.texStorage2D(f.TEXTURE_2D,Nn,me,$e.width,$e.height),a.texSubImage2D(f.TEXTURE_2D,0,0,0,bi,ke,$e)):a.texImage2D(f.TEXTURE_2D,0,me,bi,ke,$e);le(K,ri)&&fe(pt),Ct.__currentVersion=Ct.version,K.onUpdate&&K.onUpdate(K)}ne.__version=K.version}function Pt(ne,K,Ge,pt,qt){const Ct=m.convert(Ge.format,Ge.encoding),Bn=m.convert(Ge.type),$e=ye(Ge.internalFormat,Ct,Bn,Ge.encoding);u.get(K).__hasExternalTextures||(qt===f.TEXTURE_3D||qt===f.TEXTURE_2D_ARRAY?a.texImage3D(qt,0,$e,K.width,K.height,K.depth,0,Ct,Bn,null):a.texImage2D(qt,0,$e,K.width,K.height,0,Ct,Bn,null)),a.bindFramebuffer(f.FRAMEBUFFER,ne),En(K)?D.framebufferTexture2DMultisampleEXT(f.FRAMEBUFFER,pt,qt,u.get(Ge).__webglTexture,0,Ln(K)):f.framebufferTexture2D(f.FRAMEBUFFER,pt,qt,u.get(Ge).__webglTexture,0),a.bindFramebuffer(f.FRAMEBUFFER,null)}function _i(ne,K,Ge){if(f.bindRenderbuffer(f.RENDERBUFFER,ne),K.depthBuffer&&!K.stencilBuffer){let pt=f.DEPTH_COMPONENT16;if(Ge||En(K)){const qt=K.depthTexture;qt&&qt.isDepthTexture&&(qt.type===W?pt=f.DEPTH_COMPONENT32F:qt.type===V&&(pt=f.DEPTH_COMPONENT24));const Ct=Ln(K);En(K)?D.renderbufferStorageMultisampleEXT(f.RENDERBUFFER,Ct,pt,K.width,K.height):f.renderbufferStorageMultisample(f.RENDERBUFFER,Ct,pt,K.width,K.height)}else f.renderbufferStorage(f.RENDERBUFFER,pt,K.width,K.height);f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,ne)}else if(K.depthBuffer&&K.stencilBuffer){const pt=Ln(K);Ge&&!1===En(K)?f.renderbufferStorageMultisample(f.RENDERBUFFER,pt,f.DEPTH24_STENCIL8,K.width,K.height):En(K)?D.renderbufferStorageMultisampleEXT(f.RENDERBUFFER,pt,f.DEPTH24_STENCIL8,K.width,K.height):f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_STENCIL,K.width,K.height),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,ne)}else{const pt=!0===K.isWebGLMultipleRenderTargets?K.texture[0]:K.texture,qt=m.convert(pt.format,pt.encoding),Ct=m.convert(pt.type),Bn=ye(pt.internalFormat,qt,Ct,pt.encoding),$e=Ln(K);Ge&&!1===En(K)?f.renderbufferStorageMultisample(f.RENDERBUFFER,$e,Bn,K.width,K.height):En(K)?D.renderbufferStorageMultisampleEXT(f.RENDERBUFFER,$e,Bn,K.width,K.height):f.renderbufferStorage(f.RENDERBUFFER,Bn,K.width,K.height)}f.bindRenderbuffer(f.RENDERBUFFER,null)}function rt(ne){const K=u.get(ne),Ge=!0===ne.isWebGLCubeRenderTarget;if(ne.depthTexture&&!K.__autoAllocateDepthBuffer){if(Ge)throw new Error("target.depthTexture not supported in Cube render targets");!function Je(ne,K){if(K&&K.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(f.FRAMEBUFFER,ne),!K.depthTexture||!K.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!u.get(K.depthTexture).__webglTexture||K.depthTexture.image.width!==K.width||K.depthTexture.image.height!==K.height)&&(K.depthTexture.image.width=K.width,K.depthTexture.image.height=K.height,K.depthTexture.needsUpdate=!0),dt(K.depthTexture,0);const pt=u.get(K.depthTexture).__webglTexture,qt=Ln(K);if(K.depthTexture.format===vn)En(K)?D.framebufferTexture2DMultisampleEXT(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.TEXTURE_2D,pt,0,qt):f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.TEXTURE_2D,pt,0);else{if(K.depthTexture.format!==mr)throw new Error("Unknown depthTexture format");En(K)?D.framebufferTexture2DMultisampleEXT(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,pt,0,qt):f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,pt,0)}}(K.__webglFramebuffer,ne)}else if(Ge){K.__webglDepthbuffer=[];for(let pt=0;pt<6;pt++)a.bindFramebuffer(f.FRAMEBUFFER,K.__webglFramebuffer[pt]),K.__webglDepthbuffer[pt]=f.createRenderbuffer(),_i(K.__webglDepthbuffer[pt],ne,!1)}else a.bindFramebuffer(f.FRAMEBUFFER,K.__webglFramebuffer),K.__webglDepthbuffer=f.createRenderbuffer(),_i(K.__webglDepthbuffer,ne,!1);a.bindFramebuffer(f.FRAMEBUFFER,null)}function Ln(ne){return Math.min(A,ne.samples)}function En(ne){const K=u.get(ne);return _&&ne.samples>0&&!0===s.has("WEBGL_multisampled_render_to_texture")&&!1!==K.__useRenderToTexture}function hr(ne,K){const Ge=ne.encoding,pt=ne.format,qt=ne.type;return!0===ne.isCompressedTexture||!0===ne.isVideoTexture||1035===ne.format||Ge!==Ls&&(Ge===Dr?!1===_?!0===s.has("EXT_sRGB")&&pt===At?(ne.format=1035,ne.minFilter=Hr,ne.generateMipmaps=!1):K=Ma.sRGBToLinear(K):(pt!==At||qt!==Ka)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Ge)),K}this.allocateTextureUnit=function Me(){const ne=Ie;return ne>=w&&console.warn("THREE.WebGLTextures: Trying to use "+ne+" texture units while this GPU supports only "+w),Ie+=1,ne},this.resetTextureUnits=function je(){Ie=0},this.setTexture2D=dt,this.setTexture2DArray=function wt(ne,K){const Ge=u.get(ne);ne.version>0&&Ge.__version!==ne.version?ai(Ge,ne,K):(a.activeTexture(f.TEXTURE0+K),a.bindTexture(f.TEXTURE_2D_ARRAY,Ge.__webglTexture))},this.setTexture3D=function mt(ne,K){const Ge=u.get(ne);ne.version>0&&Ge.__version!==ne.version?ai(Ge,ne,K):(a.activeTexture(f.TEXTURE0+K),a.bindTexture(f.TEXTURE_3D,Ge.__webglTexture))},this.setTextureCube=function bn(ne,K){const Ge=u.get(ne);ne.version>0&&Ge.__version!==ne.version?function li(ne,K,Ge){if(6!==K.image.length)return;const pt=sr(ne,K),qt=K.source;if(a.activeTexture(f.TEXTURE0+Ge),a.bindTexture(f.TEXTURE_CUBE_MAP,ne.__webglTexture),qt.version!==qt.__currentVersion||!0===pt){f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,K.flipY),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),f.pixelStorei(f.UNPACK_ALIGNMENT,K.unpackAlignment),f.pixelStorei(f.UNPACK_COLORSPACE_CONVERSION_WEBGL,f.NONE);const Ct=K.isCompressedTexture||K.image[0].isCompressedTexture,Bn=K.image[0]&&K.image[0].isDataTexture,$e=[];for(let St=0;St<6;St++)$e[St]=Ct||Bn?Bn?K.image[St].image:K.image[St]:j(K.image[St],!1,!0,M),$e[St]=hr(K,$e[St]);const ri=$e[0],bi=G(ri)||_,ke=m.convert(K.format,K.encoding),me=m.convert(K.type),Ut=ye(K.internalFormat,ke,me,K.encoding),Lt=_&&!0!==K.isVideoTexture,Fn=void 0===ne.__version;let Nn,an=Ve(K,ri,bi);if(Se(f.TEXTURE_CUBE_MAP,K,bi),Ct){Lt&&Fn&&a.texStorage2D(f.TEXTURE_CUBE_MAP,an,Ut,ri.width,ri.height);for(let St=0;St<6;St++){Nn=$e[St].mipmaps;for(let rn=0;rn<Nn.length;rn++){const Pr=Nn[rn];K.format!==At?null!==ke?Lt?a.compressedTexSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn,0,0,Pr.width,Pr.height,ke,Pr.data):a.compressedTexImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn,Ut,Pr.width,Pr.height,0,Pr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Lt?a.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn,0,0,Pr.width,Pr.height,ke,me,Pr.data):a.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn,Ut,Pr.width,Pr.height,0,ke,me,Pr.data)}}}else{Nn=K.mipmaps,Lt&&Fn&&(Nn.length>0&&an++,a.texStorage2D(f.TEXTURE_CUBE_MAP,an,Ut,$e[0].width,$e[0].height));for(let St=0;St<6;St++)if(Bn){Lt?a.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,0,0,0,$e[St].width,$e[St].height,ke,me,$e[St].data):a.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,0,Ut,$e[St].width,$e[St].height,0,ke,me,$e[St].data);for(let rn=0;rn<Nn.length;rn++){const Pi=Nn[rn].image[St].image;Lt?a.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn+1,0,0,Pi.width,Pi.height,ke,me,Pi.data):a.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn+1,Ut,Pi.width,Pi.height,0,ke,me,Pi.data)}}else{Lt?a.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,0,0,0,ke,me,$e[St]):a.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,0,Ut,ke,me,$e[St]);for(let rn=0;rn<Nn.length;rn++){const Pr=Nn[rn];Lt?a.texSubImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn+1,0,0,ke,me,Pr.image[St]):a.texImage2D(f.TEXTURE_CUBE_MAP_POSITIVE_X+St,rn+1,Ut,ke,me,Pr.image[St])}}}le(K,bi)&&fe(f.TEXTURE_CUBE_MAP),qt.__currentVersion=qt.version,K.onUpdate&&K.onUpdate(K)}ne.__version=K.version}(Ge,ne,K):(a.activeTexture(f.TEXTURE0+K),a.bindTexture(f.TEXTURE_CUBE_MAP,Ge.__webglTexture))},this.rebindTextures=function xt(ne,K,Ge){const pt=u.get(ne);void 0!==K&&Pt(pt.__webglFramebuffer,ne,ne.texture,f.COLOR_ATTACHMENT0,f.TEXTURE_2D),void 0!==Ge&&rt(ne)},this.setupRenderTarget=function un(ne){const K=ne.texture,Ge=u.get(ne),pt=u.get(K);ne.addEventListener("dispose",he),!0!==ne.isWebGLMultipleRenderTargets&&(void 0===pt.__webglTexture&&(pt.__webglTexture=f.createTexture()),pt.__version=K.version,g.memory.textures++);const qt=!0===ne.isWebGLCubeRenderTarget,Ct=!0===ne.isWebGLMultipleRenderTargets,Bn=G(ne)||_;if(qt){Ge.__webglFramebuffer=[];for(let $e=0;$e<6;$e++)Ge.__webglFramebuffer[$e]=f.createFramebuffer()}else if(Ge.__webglFramebuffer=f.createFramebuffer(),Ct)if(h.drawBuffers){const $e=ne.texture;for(let ri=0,bi=$e.length;ri<bi;ri++){const ke=u.get($e[ri]);void 0===ke.__webglTexture&&(ke.__webglTexture=f.createTexture(),g.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(_&&ne.samples>0&&!1===En(ne)){Ge.__webglMultisampledFramebuffer=f.createFramebuffer(),Ge.__webglColorRenderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(f.RENDERBUFFER,Ge.__webglColorRenderbuffer);const $e=m.convert(K.format,K.encoding),ri=m.convert(K.type),bi=ye(K.internalFormat,$e,ri,K.encoding),ke=Ln(ne);f.renderbufferStorageMultisample(f.RENDERBUFFER,ke,bi,ne.width,ne.height),a.bindFramebuffer(f.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.RENDERBUFFER,Ge.__webglColorRenderbuffer),f.bindRenderbuffer(f.RENDERBUFFER,null),ne.depthBuffer&&(Ge.__webglDepthRenderbuffer=f.createRenderbuffer(),_i(Ge.__webglDepthRenderbuffer,ne,!0)),a.bindFramebuffer(f.FRAMEBUFFER,null)}if(qt){a.bindTexture(f.TEXTURE_CUBE_MAP,pt.__webglTexture),Se(f.TEXTURE_CUBE_MAP,K,Bn);for(let $e=0;$e<6;$e++)Pt(Ge.__webglFramebuffer[$e],ne,K,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+$e);le(K,Bn)&&fe(f.TEXTURE_CUBE_MAP),a.unbindTexture()}else if(Ct){const $e=ne.texture;for(let ri=0,bi=$e.length;ri<bi;ri++){const ke=$e[ri],me=u.get(ke);a.bindTexture(f.TEXTURE_2D,me.__webglTexture),Se(f.TEXTURE_2D,ke,Bn),Pt(Ge.__webglFramebuffer,ne,ke,f.COLOR_ATTACHMENT0+ri,f.TEXTURE_2D),le(ke,Bn)&&fe(f.TEXTURE_2D)}a.unbindTexture()}else{let $e=f.TEXTURE_2D;(ne.isWebGL3DRenderTarget||ne.isWebGLArrayRenderTarget)&&(_?$e=ne.isWebGL3DRenderTarget?f.TEXTURE_3D:f.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),a.bindTexture($e,pt.__webglTexture),Se($e,K,Bn),Pt(Ge.__webglFramebuffer,ne,K,f.COLOR_ATTACHMENT0,$e),le(K,Bn)&&fe($e),a.unbindTexture()}ne.depthBuffer&&rt(ne)},this.updateRenderTargetMipmap=function Wt(ne){const K=G(ne)||_,Ge=!0===ne.isWebGLMultipleRenderTargets?ne.texture:[ne.texture];for(let pt=0,qt=Ge.length;pt<qt;pt++){const Ct=Ge[pt];if(le(Ct,K)){const Bn=ne.isWebGLCubeRenderTarget?f.TEXTURE_CUBE_MAP:f.TEXTURE_2D,$e=u.get(Ct).__webglTexture;a.bindTexture(Bn,$e),fe(Bn),a.unbindTexture()}}},this.updateMultisampleRenderTarget=function ni(ne){if(_&&ne.samples>0&&!1===En(ne)){const K=ne.width,Ge=ne.height;let pt=f.COLOR_BUFFER_BIT;const qt=[f.COLOR_ATTACHMENT0],Ct=ne.stencilBuffer?f.DEPTH_STENCIL_ATTACHMENT:f.DEPTH_ATTACHMENT;ne.depthBuffer&&qt.push(Ct);const Bn=u.get(ne),$e=void 0!==Bn.__ignoreDepthValues&&Bn.__ignoreDepthValues;!1===$e&&(ne.depthBuffer&&(pt|=f.DEPTH_BUFFER_BIT),ne.stencilBuffer&&(pt|=f.STENCIL_BUFFER_BIT)),a.bindFramebuffer(f.READ_FRAMEBUFFER,Bn.__webglMultisampledFramebuffer),a.bindFramebuffer(f.DRAW_FRAMEBUFFER,Bn.__webglFramebuffer),!0===$e&&(f.invalidateFramebuffer(f.READ_FRAMEBUFFER,[Ct]),f.invalidateFramebuffer(f.DRAW_FRAMEBUFFER,[Ct])),f.blitFramebuffer(0,0,K,Ge,0,0,K,Ge,pt,f.NEAREST),R&&f.invalidateFramebuffer(f.READ_FRAMEBUFFER,qt),a.bindFramebuffer(f.READ_FRAMEBUFFER,null),a.bindFramebuffer(f.DRAW_FRAMEBUFFER,Bn.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=rt,this.setupFrameBufferTexture=Pt,this.useMultisampledRTT=En}function Np(f,s,a){const u=a.isWebGL2;return{convert:function h(m,g=null){let _;if(m===Ka)return f.UNSIGNED_BYTE;if(1017===m)return f.UNSIGNED_SHORT_4_4_4_4;if(1018===m)return f.UNSIGNED_SHORT_5_5_5_1;if(1010===m)return f.BYTE;if(1011===m)return f.SHORT;if(m===va)return f.UNSIGNED_SHORT;if(1013===m)return f.INT;if(m===V)return f.UNSIGNED_INT;if(m===W)return f.FLOAT;if(m===re)return u?f.HALF_FLOAT:(_=s.get("OES_texture_half_float"),null!==_?_.HALF_FLOAT_OES:null);if(1021===m)return f.ALPHA;if(m===At)return f.RGBA;if(1024===m)return f.LUMINANCE;if(1025===m)return f.LUMINANCE_ALPHA;if(m===vn)return f.DEPTH_COMPONENT;if(m===mr)return f.DEPTH_STENCIL;if(1028===m)return f.RED;if(1022===m)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),f.RGBA;if(1035===m)return _=s.get("EXT_sRGB"),null!==_?_.SRGB_ALPHA_EXT:null;if(1029===m)return f.RED_INTEGER;if(1030===m)return f.RG;if(1031===m)return f.RG_INTEGER;if(1033===m)return f.RGBA_INTEGER;if(m===Ar||m===Is||m===Za||m===xa)if(g===Dr){if(_=s.get("WEBGL_compressed_texture_s3tc_srgb"),null===_)return null;if(m===Ar)return _.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(m===Is)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(m===Za)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(m===xa)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(_=s.get("WEBGL_compressed_texture_s3tc"),null===_)return null;if(m===Ar)return _.COMPRESSED_RGB_S3TC_DXT1_EXT;if(m===Is)return _.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(m===Za)return _.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(m===xa)return _.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===m||35841===m||35842===m||35843===m){if(_=s.get("WEBGL_compressed_texture_pvrtc"),null===_)return null;if(35840===m)return _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===m)return _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===m)return _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===m)return _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===m)return _=s.get("WEBGL_compressed_texture_etc1"),null!==_?_.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===m||37496===m){if(_=s.get("WEBGL_compressed_texture_etc"),null===_)return null;if(37492===m)return g===Dr?_.COMPRESSED_SRGB8_ETC2:_.COMPRESSED_RGB8_ETC2;if(37496===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:_.COMPRESSED_RGBA8_ETC2_EAC}if(37808===m||37809===m||37810===m||37811===m||37812===m||37813===m||37814===m||37815===m||37816===m||37817===m||37818===m||37819===m||37820===m||37821===m){if(_=s.get("WEBGL_compressed_texture_astc"),null===_)return null;if(37808===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:_.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:_.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:_.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:_.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:_.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:_.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:_.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:_.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:_.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:_.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:_.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:_.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:_.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===m)return g===Dr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:_.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===m){if(_=s.get("EXT_texture_compression_bptc"),null===_)return null;if(36492===m)return g===Dr?_.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:_.COMPRESSED_RGBA_BPTC_UNORM_EXT}return m===Ze?u?f.UNSIGNED_INT_24_8:(_=s.get("WEBGL_depth_texture"),null!==_?_.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}Jg.prototype.isMeshDistanceMaterial=!0;class Ud extends Os{constructor(s=[]){super(),this.cameras=s}}Ud.prototype.isArrayCamera=!0;class Yc extends Ci{constructor(){super(),this.type="Group"}}Yc.prototype.isGroup=!0;const r0={type:"move"};class Qg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Yc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Yc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new J,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new J),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Yc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new J,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new J),this._grip}dispatchEvent(s){return null!==this._targetRay&&this._targetRay.dispatchEvent(s),null!==this._grip&&this._grip.dispatchEvent(s),null!==this._hand&&this._hand.dispatchEvent(s),this}disconnect(s){return this.dispatchEvent({type:"disconnected",data:s}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(s,a,u){let h=null,m=null,g=null;const _=this._targetRay,w=this._grip,M=this._hand;if(s&&"visible-blurred"!==a.session.visibilityState)if(null!==_&&(h=a.getPose(s.targetRaySpace,u),null!==h&&(_.matrix.fromArray(h.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),h.linearVelocity?(_.hasLinearVelocity=!0,_.linearVelocity.copy(h.linearVelocity)):_.hasLinearVelocity=!1,h.angularVelocity?(_.hasAngularVelocity=!0,_.angularVelocity.copy(h.angularVelocity)):_.hasAngularVelocity=!1,this.dispatchEvent(r0))),M&&s.hand){g=!0;for(const P of s.hand.values()){const I=a.getJointPose(P,u);if(void 0===M.joints[P.jointName]){const B=new Yc;B.matrixAutoUpdate=!1,B.visible=!1,M.joints[P.jointName]=B,M.add(B)}const z=M.joints[P.jointName];null!==I&&(z.matrix.fromArray(I.transform.matrix),z.matrix.decompose(z.position,z.rotation,z.scale),z.jointRadius=I.radius),z.visible=null!==I}const D=M.joints["index-finger-tip"].position.distanceTo(M.joints["thumb-tip"].position),R=.02,L=.005;M.inputState.pinching&&D>R+L?(M.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:s.handedness,target:this})):!M.inputState.pinching&&D<=R-L&&(M.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:s.handedness,target:this}))}else null!==w&&s.gripSpace&&(m=a.getPose(s.gripSpace,u),null!==m&&(w.matrix.fromArray(m.transform.matrix),w.matrix.decompose(w.position,w.rotation,w.scale),m.linearVelocity?(w.hasLinearVelocity=!0,w.linearVelocity.copy(m.linearVelocity)):w.hasLinearVelocity=!1,m.angularVelocity?(w.hasAngularVelocity=!0,w.angularVelocity.copy(m.angularVelocity)):w.hasAngularVelocity=!1));return null!==_&&(_.visible=null!==h),null!==w&&(w.visible=null!==m),null!==M&&(M.visible=null!==g),this}}class Op extends ls{constructor(s,a,u,h,m,g,_,w,M,C){if((C=void 0!==C?C:vn)!==vn&&C!==mr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===u&&C===vn&&(u=va),void 0===u&&C===mr&&(u=Ze),super(null,h,m,g,_,w,C,u,M),this.image={width:s,height:a},this.magFilter=void 0!==_?_:zr,this.minFilter=void 0!==w?w:zr,this.flipY=!1,this.generateMipmaps=!1}}Op.prototype.isDepthTexture=!0;class kp extends zc{constructor(s,a){super();const u=this;let h=null,m=1,g=null,_="local-floor",w=null,M=null,C=null,A=null,D=null;const R=a.getContextAttributes();let L=null,P=null;const I=[],z=new Map,B=new Os;B.layers.enable(1),B.viewport=new Xi;const j=new Os;j.layers.enable(2),j.viewport=new Xi;const G=[B,j],Y=new Ud;Y.layers.enable(1),Y.layers.enable(2);let le=null,fe=null;function ye(Me){const lt=z.get(Me.inputSource);lt&&lt.dispatchEvent({type:Me.type,data:Me.inputSource})}function Ve(){z.forEach(function(Me,lt){Me.disconnect(lt)}),z.clear(),le=null,fe=null,s.setRenderTarget(L),A=null,C=null,M=null,h=null,P=null,je.stop(),u.isPresenting=!1,u.dispatchEvent({type:"sessionend"})}function we(Me){const lt=h.inputSources;for(let dt=0;dt<I.length;dt++)z.set(lt[dt],I[dt]);for(let dt=0;dt<Me.removed.length;dt++){const wt=Me.removed[dt],mt=z.get(wt);mt&&(mt.dispatchEvent({type:"disconnected",data:wt}),z.delete(wt))}for(let dt=0;dt<Me.added.length;dt++){const wt=Me.added[dt],mt=z.get(wt);mt&&mt.dispatchEvent({type:"connected",data:wt})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Me){let lt=I[Me];return void 0===lt&&(lt=new Qg,I[Me]=lt),lt.getTargetRaySpace()},this.getControllerGrip=function(Me){let lt=I[Me];return void 0===lt&&(lt=new Qg,I[Me]=lt),lt.getGripSpace()},this.getHand=function(Me){let lt=I[Me];return void 0===lt&&(lt=new Qg,I[Me]=lt),lt.getHandSpace()},this.setFramebufferScaleFactor=function(Me){m=Me,!0===u.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Me){_=Me,!0===u.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return g},this.getBaseLayer=function(){return null!==C?C:A},this.getBinding=function(){return M},this.getFrame=function(){return D},this.getSession=function(){return h},this.setSession=function(){var Me=uo(function*(lt){if(h=lt,null!==h){if(L=s.getRenderTarget(),h.addEventListener("select",ye),h.addEventListener("selectstart",ye),h.addEventListener("selectend",ye),h.addEventListener("squeeze",ye),h.addEventListener("squeezestart",ye),h.addEventListener("squeezeend",ye),h.addEventListener("end",Ve),h.addEventListener("inputsourceschange",we),!0!==R.xrCompatible&&(yield a.makeXRCompatible()),void 0===h.renderState.layers||!1===s.capabilities.isWebGL2)A=new XRWebGLLayer(h,a,{antialias:void 0!==h.renderState.layers||R.antialias,alpha:R.alpha,depth:R.depth,stencil:R.stencil,framebufferScaleFactor:m}),h.updateRenderState({baseLayer:A}),P=new cs(A.framebufferWidth,A.framebufferHeight,{format:At,type:Ka,encoding:s.outputEncoding});else{let dt=null,wt=null,mt=null;R.depth&&(mt=R.stencil?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24,dt=R.stencil?mr:vn,wt=R.stencil?Ze:va);const bn={colorFormat:s.outputEncoding===Dr?a.SRGB8_ALPHA8:a.RGBA8,depthFormat:mt,scaleFactor:m};M=new XRWebGLBinding(h,a),C=M.createProjectionLayer(bn),h.updateRenderState({layers:[C]}),P=new cs(C.textureWidth,C.textureHeight,{format:At,type:Ka,depthTexture:new Op(C.textureWidth,C.textureHeight,wt,void 0,void 0,void 0,void 0,void 0,void 0,dt),stencilBuffer:R.stencil,encoding:s.outputEncoding,samples:R.antialias?4:0}),s.properties.get(P).__ignoreDepthValues=C.ignoreDepthValues}P.isXRRenderTarget=!0,this.setFoveation(1),g=yield h.requestReferenceSpace(_),je.setContext(h),je.start(),u.isPresenting=!0,u.dispatchEvent({type:"sessionstart"})}});return function(lt){return Me.apply(this,arguments)}}();const X=new J,he=new J;function Ee(Me,lt){null===lt?Me.matrixWorld.copy(Me.matrix):Me.matrixWorld.multiplyMatrices(lt.matrixWorld,Me.matrix),Me.matrixWorldInverse.copy(Me.matrixWorld).invert()}this.updateCamera=function(Me){if(null===h)return;Y.near=j.near=B.near=Me.near,Y.far=j.far=B.far=Me.far,(le!==Y.near||fe!==Y.far)&&(h.updateRenderState({depthNear:Y.near,depthFar:Y.far}),le=Y.near,fe=Y.far);const lt=Me.parent,dt=Y.cameras;Ee(Y,lt);for(let mt=0;mt<dt.length;mt++)Ee(dt[mt],lt);Y.matrixWorld.decompose(Y.position,Y.quaternion,Y.scale),Me.position.copy(Y.position),Me.quaternion.copy(Y.quaternion),Me.scale.copy(Y.scale),Me.matrix.copy(Y.matrix),Me.matrixWorld.copy(Y.matrixWorld);const wt=Me.children;for(let mt=0,bn=wt.length;mt<bn;mt++)wt[mt].updateMatrixWorld(!0);2===dt.length?function ft(Me,lt,dt){X.setFromMatrixPosition(lt.matrixWorld),he.setFromMatrixPosition(dt.matrixWorld);const wt=X.distanceTo(he),mt=lt.projectionMatrix.elements,bn=dt.projectionMatrix.elements,yi=mt[14]/(mt[10]-1),$n=mt[14]/(mt[10]+1),Se=(mt[9]+1)/mt[5],sr=(mt[9]-1)/mt[5],ai=(mt[8]-1)/mt[0],li=(bn[8]+1)/bn[0],Pt=yi*ai,_i=yi*li,Je=wt/(-ai+li),rt=Je*-ai;lt.matrixWorld.decompose(Me.position,Me.quaternion,Me.scale),Me.translateX(rt),Me.translateZ(Je),Me.matrixWorld.compose(Me.position,Me.quaternion,Me.scale),Me.matrixWorldInverse.copy(Me.matrixWorld).invert();const xt=yi+Je,un=$n+Je;Me.projectionMatrix.makePerspective(Pt-rt,_i+(wt-rt),Se*$n/un*xt,sr*$n/un*xt,xt,un)}(Y,B,j):Y.projectionMatrix.copy(B.projectionMatrix)},this.getCamera=function(){return Y},this.getFoveation=function(){return null!==C?C.fixedFoveation:null!==A?A.fixedFoveation:void 0},this.setFoveation=function(Me){null!==C&&(C.fixedFoveation=Me),null!==A&&void 0!==A.fixedFoveation&&(A.fixedFoveation=Me)};let Be=null;const je=new Td;je.setAnimationLoop(function Ie(Me,lt){if(w=lt.getViewerPose(g),D=lt,null!==w){const wt=w.views;null!==A&&(s.setRenderTargetFramebuffer(P,A.framebuffer),s.setRenderTarget(P));let mt=!1;wt.length!==Y.cameras.length&&(Y.cameras.length=0,mt=!0);for(let bn=0;bn<wt.length;bn++){const yi=wt[bn];let $n=null;if(null!==A)$n=A.getViewport(yi);else{const sr=M.getViewSubImage(C,yi);$n=sr.viewport,0===bn&&(s.setRenderTargetTextures(P,sr.colorTexture,C.ignoreDepthValues?void 0:sr.depthStencilTexture),s.setRenderTarget(P))}const Se=G[bn];Se.matrix.fromArray(yi.transform.matrix),Se.projectionMatrix.fromArray(yi.projectionMatrix),Se.viewport.set($n.x,$n.y,$n.width,$n.height),0===bn&&Y.matrix.copy(Se.matrix),!0===mt&&Y.cameras.push(Se)}}const dt=h.inputSources;for(let wt=0;wt<I.length;wt++)I[wt].update(dt[wt],lt,g);Be&&Be(Me,lt),D=null}),this.setAnimationLoop=function(Me){Be=Me},this.dispose=function(){}}}function m1(f,s){function h(P,I){P.opacity.value=I.opacity,I.color&&P.diffuse.value.copy(I.color),I.emissive&&P.emissive.value.copy(I.emissive).multiplyScalar(I.emissiveIntensity),I.map&&(P.map.value=I.map),I.alphaMap&&(P.alphaMap.value=I.alphaMap),I.bumpMap&&(P.bumpMap.value=I.bumpMap,P.bumpScale.value=I.bumpScale,1===I.side&&(P.bumpScale.value*=-1)),I.displacementMap&&(P.displacementMap.value=I.displacementMap,P.displacementScale.value=I.displacementScale,P.displacementBias.value=I.displacementBias),I.emissiveMap&&(P.emissiveMap.value=I.emissiveMap),I.normalMap&&(P.normalMap.value=I.normalMap,P.normalScale.value.copy(I.normalScale),1===I.side&&P.normalScale.value.negate()),I.specularMap&&(P.specularMap.value=I.specularMap),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest);const z=s.get(I).envMap;if(z&&(P.envMap.value=z,P.flipEnvMap.value=z.isCubeTexture&&!1===z.isRenderTargetTexture?-1:1,P.reflectivity.value=I.reflectivity,P.ior.value=I.ior,P.refractionRatio.value=I.refractionRatio),I.lightMap){P.lightMap.value=I.lightMap;const G=!0!==f.physicallyCorrectLights?Math.PI:1;P.lightMapIntensity.value=I.lightMapIntensity*G}let B,j;I.aoMap&&(P.aoMap.value=I.aoMap,P.aoMapIntensity.value=I.aoMapIntensity),I.map?B=I.map:I.specularMap?B=I.specularMap:I.displacementMap?B=I.displacementMap:I.normalMap?B=I.normalMap:I.bumpMap?B=I.bumpMap:I.roughnessMap?B=I.roughnessMap:I.metalnessMap?B=I.metalnessMap:I.alphaMap?B=I.alphaMap:I.emissiveMap?B=I.emissiveMap:I.clearcoatMap?B=I.clearcoatMap:I.clearcoatNormalMap?B=I.clearcoatNormalMap:I.clearcoatRoughnessMap?B=I.clearcoatRoughnessMap:I.specularIntensityMap?B=I.specularIntensityMap:I.specularColorMap?B=I.specularColorMap:I.transmissionMap?B=I.transmissionMap:I.thicknessMap?B=I.thicknessMap:I.sheenColorMap?B=I.sheenColorMap:I.sheenRoughnessMap&&(B=I.sheenRoughnessMap),void 0!==B&&(B.isWebGLRenderTarget&&(B=B.texture),!0===B.matrixAutoUpdate&&B.updateMatrix(),P.uvTransform.value.copy(B.matrix)),I.aoMap?j=I.aoMap:I.lightMap&&(j=I.lightMap),void 0!==j&&(j.isWebGLRenderTarget&&(j=j.texture),!0===j.matrixAutoUpdate&&j.updateMatrix(),P.uv2Transform.value.copy(j.matrix))}return{refreshFogUniforms:function a(P,I){P.fogColor.value.copy(I.color),I.isFog?(P.fogNear.value=I.near,P.fogFar.value=I.far):I.isFogExp2&&(P.fogDensity.value=I.density)},refreshMaterialUniforms:function u(P,I,z,B,j){I.isMeshBasicMaterial||I.isMeshLambertMaterial?h(P,I):I.isMeshToonMaterial?(h(P,I),function C(P,I){I.gradientMap&&(P.gradientMap.value=I.gradientMap)}(P,I)):I.isMeshPhongMaterial?(h(P,I),function M(P,I){P.specular.value.copy(I.specular),P.shininess.value=Math.max(I.shininess,1e-4)}(P,I)):I.isMeshStandardMaterial?(h(P,I),function A(P,I){P.roughness.value=I.roughness,P.metalness.value=I.metalness,I.roughnessMap&&(P.roughnessMap.value=I.roughnessMap),I.metalnessMap&&(P.metalnessMap.value=I.metalnessMap),s.get(I).envMap&&(P.envMapIntensity.value=I.envMapIntensity)}(P,I),I.isMeshPhysicalMaterial&&function D(P,I,z){P.ior.value=I.ior,I.sheen>0&&(P.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),P.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(P.sheenColorMap.value=I.sheenColorMap),I.sheenRoughnessMap&&(P.sheenRoughnessMap.value=I.sheenRoughnessMap)),I.clearcoat>0&&(P.clearcoat.value=I.clearcoat,P.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(P.clearcoatMap.value=I.clearcoatMap),I.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap),I.clearcoatNormalMap&&(P.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),P.clearcoatNormalMap.value=I.clearcoatNormalMap,1===I.side&&P.clearcoatNormalScale.value.negate())),I.transmission>0&&(P.transmission.value=I.transmission,P.transmissionSamplerMap.value=z.texture,P.transmissionSamplerSize.value.set(z.width,z.height),I.transmissionMap&&(P.transmissionMap.value=I.transmissionMap),P.thickness.value=I.thickness,I.thicknessMap&&(P.thicknessMap.value=I.thicknessMap),P.attenuationDistance.value=I.attenuationDistance,P.attenuationColor.value.copy(I.attenuationColor)),P.specularIntensity.value=I.specularIntensity,P.specularColor.value.copy(I.specularColor),I.specularIntensityMap&&(P.specularIntensityMap.value=I.specularIntensityMap),I.specularColorMap&&(P.specularColorMap.value=I.specularColorMap)}(P,I,j)):I.isMeshMatcapMaterial?(h(P,I),function R(P,I){I.matcap&&(P.matcap.value=I.matcap)}(P,I)):I.isMeshDepthMaterial?h(P,I):I.isMeshDistanceMaterial?(h(P,I),function L(P,I){P.referencePosition.value.copy(I.referencePosition),P.nearDistance.value=I.nearDistance,P.farDistance.value=I.farDistance}(P,I)):I.isMeshNormalMaterial?h(P,I):I.isLineBasicMaterial?(function m(P,I){P.diffuse.value.copy(I.color),P.opacity.value=I.opacity}(P,I),I.isLineDashedMaterial&&function g(P,I){P.dashSize.value=I.dashSize,P.totalSize.value=I.dashSize+I.gapSize,P.scale.value=I.scale}(P,I)):I.isPointsMaterial?function _(P,I,z,B){let j;P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,P.size.value=I.size*z,P.scale.value=.5*B,I.map&&(P.map.value=I.map),I.alphaMap&&(P.alphaMap.value=I.alphaMap),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest),I.map?j=I.map:I.alphaMap&&(j=I.alphaMap),void 0!==j&&(!0===j.matrixAutoUpdate&&j.updateMatrix(),P.uvTransform.value.copy(j.matrix))}(P,I,z,B):I.isSpriteMaterial?function w(P,I){let z;P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,P.rotation.value=I.rotation,I.map&&(P.map.value=I.map),I.alphaMap&&(P.alphaMap.value=I.alphaMap),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest),I.map?z=I.map:I.alphaMap&&(z=I.alphaMap),void 0!==z&&(!0===z.matrixAutoUpdate&&z.updateMatrix(),P.uvTransform.value.copy(z.matrix))}(P,I):I.isShadowMaterial?(P.color.value.copy(I.color),P.opacity.value=I.opacity):I.isShaderMaterial&&(I.uniformsNeedUpdate=!1)}}}function lr(f={}){const s=void 0!==f.canvas?f.canvas:function lM(){const f=Gc("canvas");return f.style.display="block",f}(),a=void 0!==f.context?f.context:null,u=void 0===f.depth||f.depth,h=void 0===f.stencil||f.stencil,m=void 0!==f.antialias&&f.antialias,g=void 0===f.premultipliedAlpha||f.premultipliedAlpha,_=void 0!==f.preserveDrawingBuffer&&f.preserveDrawingBuffer,w=void 0!==f.powerPreference?f.powerPreference:"default",M=void 0!==f.failIfMajorPerformanceCaveat&&f.failIfMajorPerformanceCaveat;let C;C=void 0!==f.context?a.getContextAttributes().alpha:void 0!==f.alpha&&f.alpha;let A=null,D=null;const R=[],L=[];this.domElement=s,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ls,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const P=this;let I=!1,z=0,B=0,j=null,G=-1,Y=null;const le=new Xi,fe=new Xi;let ye=null,Ve=s.width,we=s.height,X=1,he=null,ft=null;const Ee=new Xi(0,0,Ve,we),Be=new Xi(0,0,Ve,we);let Ie=!1;const je=new yp;let Me=!1,lt=!1,dt=null;const wt=new cn,mt=new Qe,bn=new J,yi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $n(){return null===j?X:1}let ai,li,Pt,_i,Je,rt,xt,un,Wt,ni,Ln,En,Rr,hr,ne,K,Ge,pt,qt,Ct,Bn,$e,ri,Se=a;function sr(ee,Ce){for(let Ue=0;Ue<ee.length;Ue++){const it=s.getContext(ee[Ue],Ce);if(null!==it)return it}return null}try{const ee={alpha:!0,depth:u,stencil:h,antialias:m,premultipliedAlpha:g,preserveDrawingBuffer:_,powerPreference:w,failIfMajorPerformanceCaveat:M};if("setAttribute"in s&&s.setAttribute("data-engine","three.js r139"),s.addEventListener("webglcontextlost",me,!1),s.addEventListener("webglcontextrestored",Ut,!1),null===Se){const Ce=["webgl2","webgl","experimental-webgl"];if(!0===P.isWebGL1Renderer&&Ce.shift(),Se=sr(Ce,ee),null===Se)throw sr(Ce)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Se.getShaderPrecisionFormat&&(Se.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ee){throw console.error("THREE.WebGLRenderer: "+ee.message),ee}function bi(){ai=new Pp(Se),li=new CA(Se,ai,f),ai.init(li),$e=new Np(Se,ai,li),Pt=new n0(Se,ai,li),_i=new Lw(Se),Je=new tM,rt=new aM(Se,ai,Pt,Je,li,$e,_i),xt=new AA(P),un=new Cl(P),Wt=new vv(Se,li),ri=new Cw(Se,ai,Wt,li),ni=new Pw(Se,Wt,_i,ri),Ln=new Bv(Se,ni,Wt,_i),qt=new kv(Se,li,rt),K=new TA(Je),En=new h1(P,xt,un,ai,li,ri,K),Rr=new m1(P,Je),hr=new d1,ne=new p1(ai,li),pt=new Ew(P,xt,Pt,Ln,C,g),Ge=new t0(P,Ln,li),Ct=new EA(Se,ai,_i,li),Bn=new Iw(Se,ai,_i,li),_i.programs=En.programs,P.capabilities=li,P.extensions=ai,P.properties=Je,P.renderLists=hr,P.shadowMap=Ge,P.state=Pt,P.info=_i}bi();const ke=new kp(P,Se);function me(ee){ee.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function Ut(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const ee=_i.autoReset,Ce=Ge.enabled,Ue=Ge.autoUpdate,Pe=Ge.needsUpdate,it=Ge.type;bi(),_i.autoReset=ee,Ge.enabled=Ce,Ge.autoUpdate=Ue,Ge.needsUpdate=Pe,Ge.type=it}function Lt(ee){const Ce=ee.target;Ce.removeEventListener("dispose",Lt),function Fn(ee){(function an(ee){const Ce=Je.get(ee).programs;void 0!==Ce&&(Ce.forEach(function(Ue){En.releaseProgram(Ue)}),ee.isShaderMaterial&&En.releaseShaderCache(ee))})(ee),Je.remove(ee)}(Ce)}this.xr=ke,this.getContext=function(){return Se},this.getContextAttributes=function(){return Se.getContextAttributes()},this.forceContextLoss=function(){const ee=ai.get("WEBGL_lose_context");ee&&ee.loseContext()},this.forceContextRestore=function(){const ee=ai.get("WEBGL_lose_context");ee&&ee.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(ee){void 0!==ee&&(X=ee,this.setSize(Ve,we,!1))},this.getSize=function(ee){return ee.set(Ve,we)},this.setSize=function(ee,Ce,Ue){ke.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ve=ee,we=Ce,s.width=Math.floor(ee*X),s.height=Math.floor(Ce*X),!1!==Ue&&(s.style.width=ee+"px",s.style.height=Ce+"px"),this.setViewport(0,0,ee,Ce))},this.getDrawingBufferSize=function(ee){return ee.set(Ve*X,we*X).floor()},this.setDrawingBufferSize=function(ee,Ce,Ue){Ve=ee,we=Ce,X=Ue,s.width=Math.floor(ee*Ue),s.height=Math.floor(Ce*Ue),this.setViewport(0,0,ee,Ce)},this.getCurrentViewport=function(ee){return ee.copy(le)},this.getViewport=function(ee){return ee.copy(Ee)},this.setViewport=function(ee,Ce,Ue,Pe){ee.isVector4?Ee.set(ee.x,ee.y,ee.z,ee.w):Ee.set(ee,Ce,Ue,Pe),Pt.viewport(le.copy(Ee).multiplyScalar(X).floor())},this.getScissor=function(ee){return ee.copy(Be)},this.setScissor=function(ee,Ce,Ue,Pe){ee.isVector4?Be.set(ee.x,ee.y,ee.z,ee.w):Be.set(ee,Ce,Ue,Pe),Pt.scissor(fe.copy(Be).multiplyScalar(X).floor())},this.getScissorTest=function(){return Ie},this.setScissorTest=function(ee){Pt.setScissorTest(Ie=ee)},this.setOpaqueSort=function(ee){he=ee},this.setTransparentSort=function(ee){ft=ee},this.getClearColor=function(ee){return ee.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor.apply(pt,arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha.apply(pt,arguments)},this.clear=function(ee=!0,Ce=!0,Ue=!0){let Pe=0;ee&&(Pe|=Se.COLOR_BUFFER_BIT),Ce&&(Pe|=Se.DEPTH_BUFFER_BIT),Ue&&(Pe|=Se.STENCIL_BUFFER_BIT),Se.clear(Pe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){s.removeEventListener("webglcontextlost",me,!1),s.removeEventListener("webglcontextrestored",Ut,!1),hr.dispose(),ne.dispose(),Je.dispose(),xt.dispose(),un.dispose(),Ln.dispose(),ri.dispose(),En.dispose(),ke.dispose(),ke.removeEventListener("sessionstart",rn),ke.removeEventListener("sessionend",Pr),dt&&(dt.dispose(),dt=null),Pi.stop()},this.renderBufferDirect=function(ee,Ce,Ue,Pe,it,Hn){null===Ce&&(Ce=yi);const ii=it.isMesh&&it.matrixWorld.determinant()<0,vi=function pD(ee,Ce,Ue,Pe,it){!0!==Ce.isScene&&(Ce=yi),rt.resetTextureUnits();const Hn=Ce.fog,vi=null===j?P.outputEncoding:!0===j.isXRRenderTarget?j.texture.encoding:Ls,Jn=(Pe.isMeshStandardMaterial?un:xt).get(Pe.envMap||(Pe.isMeshStandardMaterial?Ce.environment:null)),Hi=!0===Pe.vertexColors&&!!Ue.attributes.color&&4===Ue.attributes.color.itemSize,Gi=!!Pe.normalMap&&!!Ue.attributes.tangent,$i=!!Ue.morphAttributes.position,jr=!!Ue.morphAttributes.normal,ou=!!Ue.morphAttributes.color,Th=Pe.toneMapped?P.toneMapping:0,Ah=Ue.morphAttributes.position||Ue.morphAttributes.normal||Ue.morphAttributes.color,Bl=void 0!==Ah?Ah.length:0,Ji=Je.get(Pe),df=D.state.lights;!0!==Me||!0!==lt&&ee===Y||K.setState(Pe,ee,ee===Y&&Pe.id===G);let ms=!1;Pe.version===Ji.__version?(Ji.needsLights&&Ji.lightsStateVersion!==df.state.version||Ji.outputEncoding!==vi||it.isInstancedMesh&&!1===Ji.instancing||!it.isInstancedMesh&&!0===Ji.instancing||it.isSkinnedMesh&&!1===Ji.skinning||!it.isSkinnedMesh&&!0===Ji.skinning||Ji.envMap!==Jn||Pe.fog&&Ji.fog!==Hn||void 0!==Ji.numClippingPlanes&&(Ji.numClippingPlanes!==K.numPlanes||Ji.numIntersection!==K.numIntersection)||Ji.vertexAlphas!==Hi||Ji.vertexTangents!==Gi||Ji.morphTargets!==$i||Ji.morphNormals!==jr||Ji.morphColors!==ou||Ji.toneMapping!==Th||!0===li.isWebGL2&&Ji.morphTargetsCount!==Bl)&&(ms=!0):(ms=!0,Ji.__version=Pe.version);let xc=Ji.currentProgram;!0===ms&&(xc=Dy(Pe,Ce,it));let Dh=!1,Ry=!1,CS=!1;const so=xc.getUniforms(),au=Ji.uniforms;if(Pt.useProgram(xc.program)&&(Dh=!0,Ry=!0,CS=!0),Pe.id!==G&&(G=Pe.id,Ry=!0),Dh||Y!==ee){if(so.setValue(Se,"projectionMatrix",ee.projectionMatrix),li.logarithmicDepthBuffer&&so.setValue(Se,"logDepthBufFC",2/(Math.log(ee.far+1)/Math.LN2)),Y!==ee&&(Y=ee,Ry=!0,CS=!0),Pe.isShaderMaterial||Pe.isMeshPhongMaterial||Pe.isMeshToonMaterial||Pe.isMeshStandardMaterial||Pe.envMap){const sl=so.map.cameraPosition;void 0!==sl&&sl.setValue(Se,bn.setFromMatrixPosition(ee.matrixWorld))}(Pe.isMeshPhongMaterial||Pe.isMeshToonMaterial||Pe.isMeshLambertMaterial||Pe.isMeshBasicMaterial||Pe.isMeshStandardMaterial||Pe.isShaderMaterial)&&so.setValue(Se,"isOrthographic",!0===ee.isOrthographicCamera),(Pe.isMeshPhongMaterial||Pe.isMeshToonMaterial||Pe.isMeshLambertMaterial||Pe.isMeshBasicMaterial||Pe.isMeshStandardMaterial||Pe.isShaderMaterial||Pe.isShadowMaterial||it.isSkinnedMesh)&&so.setValue(Se,"viewMatrix",ee.matrixWorldInverse)}if(it.isSkinnedMesh){so.setOptional(Se,it,"bindMatrix"),so.setOptional(Se,it,"bindMatrixInverse");const sl=it.skeleton;sl&&(li.floatVertexTextures?(null===sl.boneTexture&&sl.computeBoneTexture(),so.setValue(Se,"boneTexture",sl.boneTexture,rt),so.setValue(Se,"boneTextureSize",sl.boneTextureSize)):so.setOptional(Se,sl,"boneMatrices"))}const ex=Ue.morphAttributes;return(void 0!==ex.position||void 0!==ex.normal||void 0!==ex.color&&!0===li.isWebGL2)&&qt.update(it,Ue,Pe,xc),(Ry||Ji.receiveShadow!==it.receiveShadow)&&(Ji.receiveShadow=it.receiveShadow,so.setValue(Se,"receiveShadow",it.receiveShadow)),Ry&&(so.setValue(Se,"toneMappingExposure",P.toneMappingExposure),Ji.needsLights&&function mD(ee,Ce){ee.ambientLightColor.needsUpdate=Ce,ee.lightProbe.needsUpdate=Ce,ee.directionalLights.needsUpdate=Ce,ee.directionalLightShadows.needsUpdate=Ce,ee.pointLights.needsUpdate=Ce,ee.pointLightShadows.needsUpdate=Ce,ee.spotLights.needsUpdate=Ce,ee.spotLightShadows.needsUpdate=Ce,ee.rectAreaLights.needsUpdate=Ce,ee.hemisphereLights.needsUpdate=Ce}(au,CS),Hn&&Pe.fog&&Rr.refreshFogUniforms(au,Hn),Rr.refreshMaterialUniforms(au,Pe,X,we,dt),$c.upload(Se,Ji.uniformsList,au,rt)),Pe.isShaderMaterial&&!0===Pe.uniformsNeedUpdate&&($c.upload(Se,Ji.uniformsList,au,rt),Pe.uniformsNeedUpdate=!1),Pe.isSpriteMaterial&&so.setValue(Se,"center",it.center),so.setValue(Se,"modelViewMatrix",it.modelViewMatrix),so.setValue(Se,"normalMatrix",it.normalMatrix),so.setValue(Se,"modelMatrix",it.matrixWorld),xc}(ee,Ce,Ue,Pe,it);Pt.setMaterial(Pe,ii);let Jn=Ue.index;const Hi=Ue.attributes.position;if(null===Jn){if(void 0===Hi||0===Hi.count)return}else if(0===Jn.count)return;let Gi=1;!0===Pe.wireframe&&(Jn=ni.getWireframeAttribute(Ue),Gi=2),ri.setup(it,Pe,vi,Ue,Jn);let $i,jr=Ct;null!==Jn&&($i=Wt.get(Jn),jr=Bn,jr.setIndex($i));const ou=null!==Jn?Jn.count:Hi.count,Th=Ue.drawRange.start*Gi,Ah=Ue.drawRange.count*Gi,Bl=null!==Hn?Hn.start*Gi:0,Ji=null!==Hn?Hn.count*Gi:1/0,df=Math.max(Th,Bl),ms=Math.min(ou,Th+Ah,Bl+Ji)-1,xc=Math.max(0,ms-df+1);if(0!==xc){if(it.isMesh)!0===Pe.wireframe?(Pt.setLineWidth(Pe.wireframeLinewidth*$n()),jr.setMode(Se.LINES)):jr.setMode(Se.TRIANGLES);else if(it.isLine){let Dh=Pe.linewidth;void 0===Dh&&(Dh=1),Pt.setLineWidth(Dh*$n()),jr.setMode(it.isLineSegments?Se.LINES:it.isLineLoop?Se.LINE_LOOP:Se.LINE_STRIP)}else it.isPoints?jr.setMode(Se.POINTS):it.isSprite&&jr.setMode(Se.TRIANGLES);if(it.isInstancedMesh)jr.renderInstances(df,xc,it.count);else if(Ue.isInstancedBufferGeometry){const Dh=Math.min(Ue.instanceCount,Ue._maxInstanceCount);jr.renderInstances(df,xc,Dh)}else jr.render(df,xc)}},this.compile=function(ee,Ce){D=ne.get(ee),D.init(),L.push(D),ee.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(Ce.layers)&&(D.pushLight(Ue),Ue.castShadow&&D.pushShadow(Ue))}),D.setupLights(P.physicallyCorrectLights),ee.traverse(function(Ue){const Pe=Ue.material;if(Pe)if(Array.isArray(Pe))for(let it=0;it<Pe.length;it++)Dy(Pe[it],ee,Ue);else Dy(Pe,ee,Ue)}),L.pop(),D=null};let Nn=null;function rn(){Pi.stop()}function Pr(){Pi.start()}const Pi=new Td;function Ol(ee,Ce,Ue,Pe){if(!1===ee.visible)return;if(ee.layers.test(Ce.layers))if(ee.isGroup)Ue=ee.renderOrder;else if(ee.isLOD)!0===ee.autoUpdate&&ee.update(Ce);else if(ee.isLight)D.pushLight(ee),ee.castShadow&&D.pushShadow(ee);else if(ee.isSprite){if(!ee.frustumCulled||je.intersectsSprite(ee)){Pe&&bn.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(wt);const ii=Ln.update(ee),vi=ee.material;vi.visible&&A.push(ee,ii,vi,Ue,bn.z,null)}}else if((ee.isMesh||ee.isLine||ee.isPoints)&&(ee.isSkinnedMesh&&ee.skeleton.frame!==_i.render.frame&&(ee.skeleton.update(),ee.skeleton.frame=_i.render.frame),!ee.frustumCulled||je.intersectsObject(ee))){Pe&&bn.setFromMatrixPosition(ee.matrixWorld).applyMatrix4(wt);const ii=Ln.update(ee),vi=ee.material;if(Array.isArray(vi)){const Jn=ii.groups;for(let Hi=0,Gi=Jn.length;Hi<Gi;Hi++){const $i=Jn[Hi],jr=vi[$i.materialIndex];jr&&jr.visible&&A.push(ee,ii,jr,Ue,bn.z,$i)}}else vi.visible&&A.push(ee,ii,vi,Ue,bn.z,null)}const Hn=ee.children;for(let ii=0,vi=Hn.length;ii<vi;ii++)Ol(Hn[ii],Ce,Ue,Pe)}function kl(ee,Ce,Ue,Pe){const it=ee.opaque,Hn=ee.transmissive,ii=ee.transparent;D.setupLightsView(Ue),Hn.length>0&&function MS(ee,Ce,Ue){const Pe=li.isWebGL2;null===dt&&(dt=new cs(1,1,{generateMipmaps:!0,type:null!==$e.convert(re)?re:Ka,minFilter:Ya,samples:Pe&&!0===m?4:0})),P.getDrawingBufferSize(mt),Pe?dt.setSize(mt.x,mt.y):dt.setSize(np(mt.x),np(mt.y));const it=P.getRenderTarget();P.setRenderTarget(dt),P.clear();const Hn=P.toneMapping;P.toneMapping=0,gm(ee,Ce,Ue),P.toneMapping=Hn,rt.updateMultisampleRenderTarget(dt),rt.updateRenderTargetMipmap(dt),P.setRenderTarget(it)}(it,Ce,Ue),Pe&&Pt.viewport(le.copy(Pe)),it.length>0&&gm(it,Ce,Ue),Hn.length>0&&gm(Hn,Ce,Ue),ii.length>0&&gm(ii,Ce,Ue),Pt.buffers.depth.setTest(!0),Pt.buffers.depth.setMask(!0),Pt.buffers.color.setMask(!0),Pt.setPolygonOffset(!1)}function gm(ee,Ce,Ue){const Pe=!0===Ce.isScene?Ce.overrideMaterial:null;for(let it=0,Hn=ee.length;it<Hn;it++){const ii=ee[it],vi=ii.object,Jn=ii.geometry,Hi=null===Pe?ii.material:Pe,Gi=ii.group;vi.layers.test(Ue.layers)&&SS(vi,Ce,Ue,Jn,Hi,Gi)}}function SS(ee,Ce,Ue,Pe,it,Hn){ee.onBeforeRender(P,Ce,Ue,Pe,it,Hn),ee.modelViewMatrix.multiplyMatrices(Ue.matrixWorldInverse,ee.matrixWorld),ee.normalMatrix.getNormalMatrix(ee.modelViewMatrix),it.onBeforeRender(P,Ce,Ue,Pe,ee,Hn),!0===it.transparent&&2===it.side?(it.side=1,it.needsUpdate=!0,P.renderBufferDirect(Ue,Ce,Pe,it,ee,Hn),it.side=0,it.needsUpdate=!0,P.renderBufferDirect(Ue,Ce,Pe,it,ee,Hn),it.side=2):P.renderBufferDirect(Ue,Ce,Pe,it,ee,Hn),ee.onAfterRender(P,Ce,Ue,Pe,it,Hn)}function Dy(ee,Ce,Ue){!0!==Ce.isScene&&(Ce=yi);const Pe=Je.get(ee),it=D.state.lights,ii=it.state.version,vi=En.getParameters(ee,it.state,D.state.shadowsArray,Ce,Ue),Jn=En.getProgramCacheKey(vi);let Hi=Pe.programs;Pe.environment=ee.isMeshStandardMaterial?Ce.environment:null,Pe.fog=Ce.fog,Pe.envMap=(ee.isMeshStandardMaterial?un:xt).get(ee.envMap||Pe.environment),void 0===Hi&&(ee.addEventListener("dispose",Lt),Hi=new Map,Pe.programs=Hi);let Gi=Hi.get(Jn);if(void 0!==Gi){if(Pe.currentProgram===Gi&&Pe.lightsStateVersion===ii)return ES(ee,vi),Gi}else vi.uniforms=En.getUniforms(ee),ee.onBuild(Ue,vi,P),ee.onBeforeCompile(vi,P),Gi=En.acquireProgram(vi,Jn),Hi.set(Jn,Gi),Pe.uniforms=vi.uniforms;const $i=Pe.uniforms;(!ee.isShaderMaterial&&!ee.isRawShaderMaterial||!0===ee.clipping)&&($i.clippingPlanes=K.uniform),ES(ee,vi),Pe.needsLights=function ym(ee){return ee.isMeshLambertMaterial||ee.isMeshToonMaterial||ee.isMeshPhongMaterial||ee.isMeshStandardMaterial||ee.isShadowMaterial||ee.isShaderMaterial&&!0===ee.lights}(ee),Pe.lightsStateVersion=ii,Pe.needsLights&&($i.ambientLightColor.value=it.state.ambient,$i.lightProbe.value=it.state.probe,$i.directionalLights.value=it.state.directional,$i.directionalLightShadows.value=it.state.directionalShadow,$i.spotLights.value=it.state.spot,$i.spotLightShadows.value=it.state.spotShadow,$i.rectAreaLights.value=it.state.rectArea,$i.ltc_1.value=it.state.rectAreaLTC1,$i.ltc_2.value=it.state.rectAreaLTC2,$i.pointLights.value=it.state.point,$i.pointLightShadows.value=it.state.pointShadow,$i.hemisphereLights.value=it.state.hemi,$i.directionalShadowMap.value=it.state.directionalShadowMap,$i.directionalShadowMatrix.value=it.state.directionalShadowMatrix,$i.spotShadowMap.value=it.state.spotShadowMap,$i.spotShadowMatrix.value=it.state.spotShadowMatrix,$i.pointShadowMap.value=it.state.pointShadowMap,$i.pointShadowMatrix.value=it.state.pointShadowMatrix);const jr=Gi.getUniforms(),ou=$c.seqWithValue(jr.seq,$i);return Pe.currentProgram=Gi,Pe.uniformsList=ou,Gi}function ES(ee,Ce){const Ue=Je.get(ee);Ue.outputEncoding=Ce.outputEncoding,Ue.instancing=Ce.instancing,Ue.skinning=Ce.skinning,Ue.morphTargets=Ce.morphTargets,Ue.morphNormals=Ce.morphNormals,Ue.morphColors=Ce.morphColors,Ue.morphTargetsCount=Ce.morphTargetsCount,Ue.numClippingPlanes=Ce.numClippingPlanes,Ue.numIntersection=Ce.numClipIntersection,Ue.vertexAlphas=Ce.vertexAlphas,Ue.vertexTangents=Ce.vertexTangents,Ue.toneMapping=Ce.toneMapping}Pi.setAnimationLoop(function St(ee){Nn&&Nn(ee)}),"undefined"!=typeof self&&Pi.setContext(self),this.setAnimationLoop=function(ee){Nn=ee,ke.setAnimationLoop(ee),null===ee?Pi.stop():Pi.start()},ke.addEventListener("sessionstart",rn),ke.addEventListener("sessionend",Pr),this.render=function(ee,Ce){if(void 0===Ce||!0===Ce.isCamera){if(!0!==I){if(!0===ee.autoUpdate&&ee.updateMatrixWorld(),null===Ce.parent&&Ce.updateMatrixWorld(),!0===ke.enabled&&!0===ke.isPresenting&&(!0===ke.cameraAutoUpdate&&ke.updateCamera(Ce),Ce=ke.getCamera()),!0===ee.isScene&&ee.onBeforeRender(P,ee,Ce,j),D=ne.get(ee,L.length),D.init(),L.push(D),wt.multiplyMatrices(Ce.projectionMatrix,Ce.matrixWorldInverse),je.setFromProjectionMatrix(wt),lt=this.localClippingEnabled,Me=K.init(this.clippingPlanes,lt,Ce),A=hr.get(ee,R.length),A.init(),R.push(A),Ol(ee,Ce,0,P.sortObjects),A.finish(),!0===P.sortObjects&&A.sort(he,ft),!0===Me&&K.beginShadows(),Ge.render(D.state.shadowsArray,ee,Ce),!0===Me&&K.endShadows(),!0===this.info.autoReset&&this.info.reset(),pt.render(A,ee),D.setupLights(P.physicallyCorrectLights),Ce.isArrayCamera){const Pe=Ce.cameras;for(let it=0,Hn=Pe.length;it<Hn;it++){const ii=Pe[it];kl(A,ee,ii,ii.viewport)}}else kl(A,ee,Ce);null!==j&&(rt.updateMultisampleRenderTarget(j),rt.updateRenderTargetMipmap(j)),!0===ee.isScene&&ee.onAfterRender(P,ee,Ce),ri.resetDefaultState(),G=-1,Y=null,L.pop(),D=L.length>0?L[L.length-1]:null,R.pop(),A=R.length>0?R[R.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return z},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return j},this.setRenderTargetTextures=function(ee,Ce,Ue){Je.get(ee.texture).__webglTexture=Ce,Je.get(ee.depthTexture).__webglTexture=Ue;const Pe=Je.get(ee);Pe.__hasExternalTextures=!0,Pe.__hasExternalTextures&&(Pe.__autoAllocateDepthBuffer=void 0===Ue,Pe.__autoAllocateDepthBuffer||!0===ai.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Pe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ee,Ce){const Ue=Je.get(ee);Ue.__webglFramebuffer=Ce,Ue.__useDefaultFramebuffer=void 0===Ce},this.setRenderTarget=function(ee,Ce=0,Ue=0){j=ee,z=Ce,B=Ue;let Pe=!0;if(ee){const Jn=Je.get(ee);void 0!==Jn.__useDefaultFramebuffer?(Pt.bindFramebuffer(Se.FRAMEBUFFER,null),Pe=!1):void 0===Jn.__webglFramebuffer?rt.setupRenderTarget(ee):Jn.__hasExternalTextures&&rt.rebindTextures(ee,Je.get(ee.texture).__webglTexture,Je.get(ee.depthTexture).__webglTexture)}let it=null,Hn=!1,ii=!1;if(ee){const Jn=ee.texture;(Jn.isData3DTexture||Jn.isDataArrayTexture)&&(ii=!0);const Hi=Je.get(ee).__webglFramebuffer;ee.isWebGLCubeRenderTarget?(it=Hi[Ce],Hn=!0):it=li.isWebGL2&&ee.samples>0&&!1===rt.useMultisampledRTT(ee)?Je.get(ee).__webglMultisampledFramebuffer:Hi,le.copy(ee.viewport),fe.copy(ee.scissor),ye=ee.scissorTest}else le.copy(Ee).multiplyScalar(X).floor(),fe.copy(Be).multiplyScalar(X).floor(),ye=Ie;if(Pt.bindFramebuffer(Se.FRAMEBUFFER,it)&&li.drawBuffers&&Pe&&Pt.drawBuffers(ee,it),Pt.viewport(le),Pt.scissor(fe),Pt.setScissorTest(ye),Hn){const Jn=Je.get(ee.texture);Se.framebufferTexture2D(Se.FRAMEBUFFER,Se.COLOR_ATTACHMENT0,Se.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,Jn.__webglTexture,Ue)}else if(ii){const Jn=Je.get(ee.texture);Se.framebufferTextureLayer(Se.FRAMEBUFFER,Se.COLOR_ATTACHMENT0,Jn.__webglTexture,Ue||0,Ce||0)}G=-1},this.readRenderTargetPixels=function(ee,Ce,Ue,Pe,it,Hn,ii){if(!ee||!ee.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let vi=Je.get(ee).__webglFramebuffer;if(ee.isWebGLCubeRenderTarget&&void 0!==ii&&(vi=vi[ii]),vi){Pt.bindFramebuffer(Se.FRAMEBUFFER,vi);try{const Jn=ee.texture,Hi=Jn.format,Gi=Jn.type;if(Hi!==At&&$e.convert(Hi)!==Se.getParameter(Se.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const $i=Gi===re&&(ai.has("EXT_color_buffer_half_float")||li.isWebGL2&&ai.has("EXT_color_buffer_float"));if(!(Gi===Ka||$e.convert(Gi)===Se.getParameter(Se.IMPLEMENTATION_COLOR_READ_TYPE)||Gi===W&&(li.isWebGL2||ai.has("OES_texture_float")||ai.has("WEBGL_color_buffer_float"))||$i))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ce>=0&&Ce<=ee.width-Pe&&Ue>=0&&Ue<=ee.height-it&&Se.readPixels(Ce,Ue,Pe,it,$e.convert(Hi),$e.convert(Gi),Hn)}finally{const Jn=null!==j?Je.get(j).__webglFramebuffer:null;Pt.bindFramebuffer(Se.FRAMEBUFFER,Jn)}}},this.copyFramebufferToTexture=function(ee,Ce,Ue=0){if(!0!==Ce.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Pe=Math.pow(2,-Ue),it=Math.floor(Ce.image.width*Pe),Hn=Math.floor(Ce.image.height*Pe);rt.setTexture2D(Ce,0),Se.copyTexSubImage2D(Se.TEXTURE_2D,Ue,0,0,ee.x,ee.y,it,Hn),Pt.unbindTexture()},this.copyTextureToTexture=function(ee,Ce,Ue,Pe=0){const it=Ce.image.width,Hn=Ce.image.height,ii=$e.convert(Ue.format),vi=$e.convert(Ue.type);rt.setTexture2D(Ue,0),Se.pixelStorei(Se.UNPACK_FLIP_Y_WEBGL,Ue.flipY),Se.pixelStorei(Se.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),Se.pixelStorei(Se.UNPACK_ALIGNMENT,Ue.unpackAlignment),Ce.isDataTexture?Se.texSubImage2D(Se.TEXTURE_2D,Pe,ee.x,ee.y,it,Hn,ii,vi,Ce.image.data):Ce.isCompressedTexture?Se.compressedTexSubImage2D(Se.TEXTURE_2D,Pe,ee.x,ee.y,Ce.mipmaps[0].width,Ce.mipmaps[0].height,ii,Ce.mipmaps[0].data):Se.texSubImage2D(Se.TEXTURE_2D,Pe,ee.x,ee.y,ii,vi,Ce.image),0===Pe&&Ue.generateMipmaps&&Se.generateMipmap(Se.TEXTURE_2D),Pt.unbindTexture()},this.copyTextureToTexture3D=function(ee,Ce,Ue,Pe,it=0){if(P.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Hn=ee.max.x-ee.min.x+1,ii=ee.max.y-ee.min.y+1,vi=ee.max.z-ee.min.z+1,Jn=$e.convert(Pe.format),Hi=$e.convert(Pe.type);let Gi;if(Pe.isData3DTexture)rt.setTexture3D(Pe,0),Gi=Se.TEXTURE_3D;else{if(!Pe.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");rt.setTexture2DArray(Pe,0),Gi=Se.TEXTURE_2D_ARRAY}Se.pixelStorei(Se.UNPACK_FLIP_Y_WEBGL,Pe.flipY),Se.pixelStorei(Se.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),Se.pixelStorei(Se.UNPACK_ALIGNMENT,Pe.unpackAlignment);const $i=Se.getParameter(Se.UNPACK_ROW_LENGTH),jr=Se.getParameter(Se.UNPACK_IMAGE_HEIGHT),ou=Se.getParameter(Se.UNPACK_SKIP_PIXELS),Th=Se.getParameter(Se.UNPACK_SKIP_ROWS),Ah=Se.getParameter(Se.UNPACK_SKIP_IMAGES),Bl=Ue.isCompressedTexture?Ue.mipmaps[0]:Ue.image;Se.pixelStorei(Se.UNPACK_ROW_LENGTH,Bl.width),Se.pixelStorei(Se.UNPACK_IMAGE_HEIGHT,Bl.height),Se.pixelStorei(Se.UNPACK_SKIP_PIXELS,ee.min.x),Se.pixelStorei(Se.UNPACK_SKIP_ROWS,ee.min.y),Se.pixelStorei(Se.UNPACK_SKIP_IMAGES,ee.min.z),Ue.isDataTexture||Ue.isData3DTexture?Se.texSubImage3D(Gi,it,Ce.x,Ce.y,Ce.z,Hn,ii,vi,Jn,Hi,Bl.data):Ue.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Se.compressedTexSubImage3D(Gi,it,Ce.x,Ce.y,Ce.z,Hn,ii,vi,Jn,Bl.data)):Se.texSubImage3D(Gi,it,Ce.x,Ce.y,Ce.z,Hn,ii,vi,Jn,Hi,Bl),Se.pixelStorei(Se.UNPACK_ROW_LENGTH,$i),Se.pixelStorei(Se.UNPACK_IMAGE_HEIGHT,jr),Se.pixelStorei(Se.UNPACK_SKIP_PIXELS,ou),Se.pixelStorei(Se.UNPACK_SKIP_ROWS,Th),Se.pixelStorei(Se.UNPACK_SKIP_IMAGES,Ah),0===it&&Pe.generateMipmaps&&Se.generateMipmap(Gi),Pt.unbindTexture()},this.initTexture=function(ee){rt.setTexture2D(ee,0),Pt.unbindTexture()},this.resetState=function(){z=0,B=0,j=null,Pt.reset(),ri.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}lr.prototype.isWebGLRenderer=!0;class cM extends lr{}cM.prototype.isWebGL1Renderer=!0;class Vd{constructor(s,a=25e-5){this.name="",this.color=new Dt(s),this.density=a}clone(){return new Vd(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Vd.prototype.isFogExp2=!0;class rh{constructor(s,a=1,u=1e3){this.name="",this.color=new Dt(s),this.near=a,this.far=u}clone(){return new rh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}rh.prototype.isFog=!0;class Bp extends Ci{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(s,a){return super.copy(s,a),null!==s.background&&(this.background=s.background.clone()),null!==s.environment&&(this.environment=s.environment.clone()),null!==s.fog&&(this.fog=s.fog.clone()),null!==s.overrideMaterial&&(this.overrideMaterial=s.overrideMaterial.clone()),this.autoUpdate=s.autoUpdate,this.matrixAutoUpdate=s.matrixAutoUpdate,this}toJSON(s){const a=super.toJSON(s);return null!==this.fog&&(a.object.fog=this.fog.toJSON()),a}}Bp.prototype.isScene=!0;class zd{constructor(s,a){this.array=s,this.stride=a,this.count=void 0!==s?s.length/a:0,this.usage=hd,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=wa()}onUploadCallback(){}set needsUpdate(s){!0===s&&this.version++}setUsage(s){return this.usage=s,this}copy(s){return this.array=new s.array.constructor(s.array),this.count=s.count,this.stride=s.stride,this.usage=s.usage,this}copyAt(s,a,u){s*=this.stride,u*=a.stride;for(let h=0,m=this.stride;h<m;h++)this.array[s+h]=a.array[u+h];return this}set(s,a=0){return this.array.set(s,a),this}clone(s){void 0===s.arrayBuffers&&(s.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wa()),void 0===s.arrayBuffers[this.array.buffer._uuid]&&(s.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const a=new this.array.constructor(s.arrayBuffers[this.array.buffer._uuid]),u=new this.constructor(a,this.stride);return u.setUsage(this.usage),u}onUpload(s){return this.onUploadCallback=s,this}toJSON(s){return void 0===s.arrayBuffers&&(s.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wa()),void 0===s.arrayBuffers[this.array.buffer._uuid]&&(s.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}zd.prototype.isInterleavedBuffer=!0;const _o=new J;class Kc{constructor(s,a,u,h=!1){this.name="",this.data=s,this.itemSize=a,this.offset=u,this.normalized=!0===h}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(s){this.data.needsUpdate=s}applyMatrix4(s){for(let a=0,u=this.data.count;a<u;a++)_o.fromBufferAttribute(this,a),_o.applyMatrix4(s),this.setXYZ(a,_o.x,_o.y,_o.z);return this}applyNormalMatrix(s){for(let a=0,u=this.count;a<u;a++)_o.fromBufferAttribute(this,a),_o.applyNormalMatrix(s),this.setXYZ(a,_o.x,_o.y,_o.z);return this}transformDirection(s){for(let a=0,u=this.count;a<u;a++)_o.fromBufferAttribute(this,a),_o.transformDirection(s),this.setXYZ(a,_o.x,_o.y,_o.z);return this}setX(s,a){return this.data.array[s*this.data.stride+this.offset]=a,this}setY(s,a){return this.data.array[s*this.data.stride+this.offset+1]=a,this}setZ(s,a){return this.data.array[s*this.data.stride+this.offset+2]=a,this}setW(s,a){return this.data.array[s*this.data.stride+this.offset+3]=a,this}getX(s){return this.data.array[s*this.data.stride+this.offset]}getY(s){return this.data.array[s*this.data.stride+this.offset+1]}getZ(s){return this.data.array[s*this.data.stride+this.offset+2]}getW(s){return this.data.array[s*this.data.stride+this.offset+3]}setXY(s,a,u){return this.data.array[(s=s*this.data.stride+this.offset)+0]=a,this.data.array[s+1]=u,this}setXYZ(s,a,u,h){return this.data.array[(s=s*this.data.stride+this.offset)+0]=a,this.data.array[s+1]=u,this.data.array[s+2]=h,this}setXYZW(s,a,u,h,m){return this.data.array[(s=s*this.data.stride+this.offset)+0]=a,this.data.array[s+1]=u,this.data.array[s+2]=h,this.data.array[s+3]=m,this}clone(s){if(void 0===s){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const a=[];for(let u=0;u<this.count;u++){const h=u*this.data.stride+this.offset;for(let m=0;m<this.itemSize;m++)a.push(this.data.array[h+m])}return new Ni(new this.array.constructor(a),this.itemSize,this.normalized)}return void 0===s.interleavedBuffers&&(s.interleavedBuffers={}),void 0===s.interleavedBuffers[this.data.uuid]&&(s.interleavedBuffers[this.data.uuid]=this.data.clone(s)),new Kc(s.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(s){if(void 0===s){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const a=[];for(let u=0;u<this.count;u++){const h=u*this.data.stride+this.offset;for(let m=0;m<this.itemSize;m++)a.push(this.data.array[h+m])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}return void 0===s.interleavedBuffers&&(s.interleavedBuffers={}),void 0===s.interleavedBuffers[this.data.uuid]&&(s.interleavedBuffers[this.data.uuid]=this.data.toJSON(s)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Kc.prototype.isInterleavedBufferAttribute=!0;class Up extends Qt{constructor(s){super(),this.type="SpriteMaterial",this.color=new Dt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.alphaMap=s.alphaMap,this.rotation=s.rotation,this.sizeAttenuation=s.sizeAttenuation,this}}let Hd;Up.prototype.isSpriteMaterial=!0;const Vp=new J,vo=new J,Gd=new J,sh=new Qe,zp=new Qe,uM=new cn,ey=new J,Hp=new J,Gp=new J,hM=new Qe,s0=new Qe,dM=new Qe;class kn extends Ci{constructor(s){if(super(),this.type="Sprite",void 0===Hd){Hd=new en;const a=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),u=new zd(a,5);Hd.setIndex([0,1,2,0,2,3]),Hd.setAttribute("position",new Kc(u,3,0,!1)),Hd.setAttribute("uv",new Kc(u,2,3,!1))}this.geometry=Hd,this.material=void 0!==s?s:new Up,this.center=new Qe(.5,.5)}raycast(s,a){null===s.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vo.setFromMatrixScale(this.matrixWorld),uM.copy(s.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(s.camera.matrixWorldInverse,this.matrixWorld),Gd.setFromMatrixPosition(this.modelViewMatrix),s.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&vo.multiplyScalar(-Gd.z);const u=this.material.rotation;let h,m;0!==u&&(m=Math.cos(u),h=Math.sin(u));const g=this.center;at(ey.set(-.5,-.5,0),Gd,g,vo,h,m),at(Hp.set(.5,-.5,0),Gd,g,vo,h,m),at(Gp.set(.5,.5,0),Gd,g,vo,h,m),hM.set(0,0),s0.set(1,0),dM.set(1,1);let _=s.ray.intersectTriangle(ey,Hp,Gp,!1,Vp);if(null===_&&(at(Hp.set(-.5,.5,0),Gd,g,vo,h,m),s0.set(0,1),_=s.ray.intersectTriangle(ey,Gp,Hp,!1,Vp),null===_))return;const w=s.ray.origin.distanceTo(Vp);w<s.near||w>s.far||a.push({distance:w,point:Vp.clone(),uv:Gr.getUV(Vp,ey,Hp,Gp,hM,s0,dM,new Qe),face:null,object:this})}copy(s){return super.copy(s),void 0!==s.center&&this.center.copy(s.center),this.material=s.material,this}}function at(f,s,a,u,h,m){sh.subVectors(f,a).addScalar(.5).multiply(u),void 0!==h?(zp.x=m*sh.x-h*sh.y,zp.y=h*sh.x+m*sh.y):zp.copy(sh),f.copy(s),f.x+=zp.x,f.y+=zp.y,f.applyMatrix4(uM)}kn.prototype.isSprite=!0;const Wp=new J,o0=new J;class qp extends Ci{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(s){super.copy(s,!1);const a=s.levels;for(let u=0,h=a.length;u<h;u++){const m=a[u];this.addLevel(m.object.clone(),m.distance)}return this.autoUpdate=s.autoUpdate,this}addLevel(s,a=0){a=Math.abs(a);const u=this.levels;let h;for(h=0;h<u.length&&!(a<u[h].distance);h++);return u.splice(h,0,{distance:a,object:s}),this.add(s),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(s){const a=this.levels;if(a.length>0){let u,h;for(u=1,h=a.length;u<h&&!(s<a[u].distance);u++);return a[u-1].object}return null}raycast(s,a){if(this.levels.length>0){Wp.setFromMatrixPosition(this.matrixWorld);const h=s.ray.origin.distanceTo(Wp);this.getObjectForDistance(h).raycast(s,a)}}update(s){const a=this.levels;if(a.length>1){Wp.setFromMatrixPosition(s.matrixWorld),o0.setFromMatrixPosition(this.matrixWorld);const u=Wp.distanceTo(o0)/s.zoom;let h,m;for(a[0].object.visible=!0,h=1,m=a.length;h<m&&u>=a[h].distance;h++)a[h-1].object.visible=!1,a[h].object.visible=!0;for(this._currentLevel=h-1;h<m;h++)a[h].object.visible=!1}}toJSON(s){const a=super.toJSON(s);!1===this.autoUpdate&&(a.object.autoUpdate=!1),a.object.levels=[];const u=this.levels;for(let h=0,m=u.length;h<m;h++){const g=u[h];a.object.levels.push({object:g.object.uuid,distance:g.distance})}return a}}const La=new J,a0=new Xi,fM=new Xi,l0=new J,Tl=new cn;class Wd extends Jr{constructor(s,a){super(s,a),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new cn,this.bindMatrixInverse=new cn}copy(s){return super.copy(s),this.bindMode=s.bindMode,this.bindMatrix.copy(s.bindMatrix),this.bindMatrixInverse.copy(s.bindMatrixInverse),this.skeleton=s.skeleton,this}bind(s,a){this.skeleton=s,void 0===a&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),a=this.matrixWorld),this.bindMatrix.copy(a),this.bindMatrixInverse.copy(a).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const s=new Xi,a=this.geometry.attributes.skinWeight;for(let u=0,h=a.count;u<h;u++){s.fromBufferAttribute(a,u);const m=1/s.manhattanLength();m!==1/0?s.multiplyScalar(m):s.set(1,0,0,0),a.setXYZW(u,s.x,s.y,s.z,s.w)}}updateMatrixWorld(s){super.updateMatrixWorld(s),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(s,a){const u=this.skeleton,h=this.geometry;a0.fromBufferAttribute(h.attributes.skinIndex,s),fM.fromBufferAttribute(h.attributes.skinWeight,s),La.copy(a).applyMatrix4(this.bindMatrix),a.set(0,0,0);for(let m=0;m<4;m++){const g=fM.getComponent(m);if(0!==g){const _=a0.getComponent(m);Tl.multiplyMatrices(u.bones[_].matrixWorld,u.boneInverses[_]),a.addScaledVector(l0.copy(La).applyMatrix4(Tl),g)}}return a.applyMatrix4(this.bindMatrixInverse)}}Wd.prototype.isSkinnedMesh=!0;class jp extends Ci{constructor(){super(),this.type="Bone"}}jp.prototype.isBone=!0;class uc extends ls{constructor(s=null,a=1,u=1,h,m,g,_,w,M=zr,C=zr,A,D){super(null,g,_,w,M,C,h,m,A,D),this.image={data:s,width:a,height:u},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}uc.prototype.isDataTexture=!0;const g1=new cn,pM=new cn;class c0{constructor(s=[],a=[]){this.uuid=wa(),this.bones=s.slice(0),this.boneInverses=a,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const s=this.bones,a=this.boneInverses;if(this.boneMatrices=new Float32Array(16*s.length),0===a.length)this.calculateInverses();else if(s.length!==a.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let u=0,h=this.bones.length;u<h;u++)this.boneInverses.push(new cn)}}calculateInverses(){this.boneInverses.length=0;for(let s=0,a=this.bones.length;s<a;s++){const u=new cn;this.bones[s]&&u.copy(this.bones[s].matrixWorld).invert(),this.boneInverses.push(u)}}pose(){for(let s=0,a=this.bones.length;s<a;s++){const u=this.bones[s];u&&u.matrixWorld.copy(this.boneInverses[s]).invert()}for(let s=0,a=this.bones.length;s<a;s++){const u=this.bones[s];u&&(u.parent&&u.parent.isBone?(u.matrix.copy(u.parent.matrixWorld).invert(),u.matrix.multiply(u.matrixWorld)):u.matrix.copy(u.matrixWorld),u.matrix.decompose(u.position,u.quaternion,u.scale))}}update(){const s=this.bones,a=this.boneInverses,u=this.boneMatrices,h=this.boneTexture;for(let m=0,g=s.length;m<g;m++)g1.multiplyMatrices(s[m]?s[m].matrixWorld:pM,a[m]),g1.toArray(u,16*m);null!==h&&(h.needsUpdate=!0)}clone(){return new c0(this.bones,this.boneInverses)}computeBoneTexture(){let s=Math.sqrt(4*this.bones.length);s=Hb(s),s=Math.max(s,4);const a=new Float32Array(s*s*4);a.set(this.boneMatrices);const u=new uc(a,s,s,At,W);return u.needsUpdate=!0,this.boneMatrices=a,this.boneTexture=u,this.boneTextureSize=s,this}getBoneByName(s){for(let a=0,u=this.bones.length;a<u;a++){const h=this.bones[a];if(h.name===s)return h}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(s,a){this.uuid=s.uuid;for(let u=0,h=s.bones.length;u<h;u++){const m=s.bones[u];let g=a[m];void 0===g&&(console.warn("THREE.Skeleton: No bone found with UUID:",m),g=new jp),this.bones.push(g),this.boneInverses.push((new cn).fromArray(s.boneInverses[u]))}return this.init(),this}toJSON(){const s={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};s.uuid=this.uuid;const a=this.bones,u=this.boneInverses;for(let h=0,m=a.length;h<m;h++)s.bones.push(a[h].uuid),s.boneInverses.push(u[h].toArray());return s}}class Al extends Ni{constructor(s,a,u,h=1){"number"==typeof u&&(h=u,u=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(s,a,u),this.meshPerAttribute=h}copy(s){return super.copy(s),this.meshPerAttribute=s.meshPerAttribute,this}toJSON(){const s=super.toJSON();return s.meshPerAttribute=this.meshPerAttribute,s.isInstancedBufferAttribute=!0,s}}Al.prototype.isInstancedBufferAttribute=!0;const Xp=new cn,ty=new cn,qd=[],oh=new Jr;class mM extends Jr{constructor(s,a,u){super(s,a),this.instanceMatrix=new Al(new Float32Array(16*u),16),this.instanceColor=null,this.count=u,this.frustumCulled=!1}copy(s){return super.copy(s),this.instanceMatrix.copy(s.instanceMatrix),null!==s.instanceColor&&(this.instanceColor=s.instanceColor.clone()),this.count=s.count,this}getColorAt(s,a){a.fromArray(this.instanceColor.array,3*s)}getMatrixAt(s,a){a.fromArray(this.instanceMatrix.array,16*s)}raycast(s,a){const u=this.matrixWorld,h=this.count;if(oh.geometry=this.geometry,oh.material=this.material,void 0!==oh.material)for(let m=0;m<h;m++){this.getMatrixAt(m,Xp),ty.multiplyMatrices(u,Xp),oh.matrixWorld=ty,oh.raycast(s,qd);for(let g=0,_=qd.length;g<_;g++){const w=qd[g];w.instanceId=m,w.object=this,a.push(w)}qd.length=0}}setColorAt(s,a){null===this.instanceColor&&(this.instanceColor=new Al(new Float32Array(3*this.instanceMatrix.count),3)),a.toArray(this.instanceColor.array,3*s)}setMatrixAt(s,a){a.toArray(this.instanceMatrix.array,16*s)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}mM.prototype.isInstancedMesh=!0;class Bs extends Qt{constructor(s){super(),this.type="LineBasicMaterial",this.color=new Dt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.linewidth=s.linewidth,this.linecap=s.linecap,this.linejoin=s.linejoin,this}}Bs.prototype.isLineBasicMaterial=!0;const gM=new J,yM=new J,_M=new cn,ny=new Wo,u0=new Wu;class hc extends Ci{constructor(s=new en,a=new Bs){super(),this.type="Line",this.geometry=s,this.material=a,this.updateMorphTargets()}copy(s){return super.copy(s),this.material=s.material,this.geometry=s.geometry,this}computeLineDistances(){const s=this.geometry;if(s.isBufferGeometry)if(null===s.index){const a=s.attributes.position,u=[0];for(let h=1,m=a.count;h<m;h++)gM.fromBufferAttribute(a,h-1),yM.fromBufferAttribute(a,h),u[h]=u[h-1],u[h]+=gM.distanceTo(yM);s.setAttribute("lineDistance",new nn(u,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else s.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(s,a){const u=this.geometry,h=this.matrixWorld,m=s.params.Line.threshold,g=u.drawRange;if(null===u.boundingSphere&&u.computeBoundingSphere(),u0.copy(u.boundingSphere),u0.applyMatrix4(h),u0.radius+=m,!1===s.ray.intersectsSphere(u0))return;_M.copy(h).invert(),ny.copy(s.ray).applyMatrix4(_M);const _=m/((this.scale.x+this.scale.y+this.scale.z)/3),w=_*_,M=new J,C=new J,A=new J,D=new J,R=this.isLineSegments?2:1;if(u.isBufferGeometry){const L=u.index,I=u.attributes.position;if(null!==L)for(let j=Math.max(0,g.start),G=Math.min(L.count,g.start+g.count)-1;j<G;j+=R){const Y=L.getX(j),le=L.getX(j+1);if(M.fromBufferAttribute(I,Y),C.fromBufferAttribute(I,le),ny.distanceSqToSegment(M,C,D,A)>w)continue;D.applyMatrix4(this.matrixWorld);const ye=s.ray.origin.distanceTo(D);ye<s.near||ye>s.far||a.push({distance:ye,point:A.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this})}else for(let j=Math.max(0,g.start),G=Math.min(I.count,g.start+g.count)-1;j<G;j+=R){if(M.fromBufferAttribute(I,j),C.fromBufferAttribute(I,j+1),ny.distanceSqToSegment(M,C,D,A)>w)continue;D.applyMatrix4(this.matrixWorld);const le=s.ray.origin.distanceTo(D);le<s.near||le>s.far||a.push({distance:le,point:A.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this})}}else u.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const s=this.geometry;if(s.isBufferGeometry){const a=s.morphAttributes,u=Object.keys(a);if(u.length>0){const h=a[u[0]];if(void 0!==h){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,g=h.length;m<g;m++){const _=h[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=m}}}}else{const a=s.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}hc.prototype.isLine=!0;const y1=new J,h0=new J;class Io extends hc{constructor(s,a){super(s,a),this.type="LineSegments"}computeLineDistances(){const s=this.geometry;if(s.isBufferGeometry)if(null===s.index){const a=s.attributes.position,u=[];for(let h=0,m=a.count;h<m;h+=2)y1.fromBufferAttribute(a,h),h0.fromBufferAttribute(a,h+1),u[h]=0===h?0:u[h-1],u[h+1]=u[h]+y1.distanceTo(h0);s.setAttribute("lineDistance",new nn(u,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else s.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Io.prototype.isLineSegments=!0;class d0 extends hc{constructor(s,a){super(s,a),this.type="LineLoop"}}d0.prototype.isLineLoop=!0;class dc extends Qt{constructor(s){super(),this.type="PointsMaterial",this.color=new Dt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.alphaMap=s.alphaMap,this.size=s.size,this.sizeAttenuation=s.sizeAttenuation,this}}dc.prototype.isPointsMaterial=!0;const _1=new cn,vM=new Wo,f0=new Wu,p0=new J;class iy extends Ci{constructor(s=new en,a=new dc){super(),this.type="Points",this.geometry=s,this.material=a,this.updateMorphTargets()}copy(s){return super.copy(s),this.material=s.material,this.geometry=s.geometry,this}raycast(s,a){const u=this.geometry,h=this.matrixWorld,m=s.params.Points.threshold,g=u.drawRange;if(null===u.boundingSphere&&u.computeBoundingSphere(),f0.copy(u.boundingSphere),f0.applyMatrix4(h),f0.radius+=m,!1===s.ray.intersectsSphere(f0))return;_1.copy(h).invert(),vM.copy(s.ray).applyMatrix4(_1);const _=m/((this.scale.x+this.scale.y+this.scale.z)/3),w=_*_;if(u.isBufferGeometry){const M=u.index,A=u.attributes.position;if(null!==M)for(let L=Math.max(0,g.start),P=Math.min(M.count,g.start+g.count);L<P;L++){const I=M.getX(L);p0.fromBufferAttribute(A,I),v1(p0,I,w,h,s,a,this)}else for(let L=Math.max(0,g.start),P=Math.min(A.count,g.start+g.count);L<P;L++)p0.fromBufferAttribute(A,L),v1(p0,L,w,h,s,a,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const s=this.geometry;if(s.isBufferGeometry){const a=s.morphAttributes,u=Object.keys(a);if(u.length>0){const h=a[u[0]];if(void 0!==h){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let m=0,g=h.length;m<g;m++){const _=h[m].name||String(m);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=m}}}}else{const a=s.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function v1(f,s,a,u,h,m,g){const _=vM.distanceSqToPoint(f);if(_<a){const w=new J;vM.closestPointToPoint(f,w),w.applyMatrix4(u);const M=h.ray.origin.distanceTo(w);if(M<h.near||M>h.far)return;m.push({distance:M,distanceToRay:Math.sqrt(_),point:w,index:s,face:null,object:g})}}iy.prototype.isPoints=!0;class x1 extends ls{constructor(s,a,u,h,m,g,_,w,M){super(s,a,u,h,m,g,_,w,M),this.minFilter=void 0!==g?g:Hr,this.magFilter=void 0!==m?m:Hr,this.generateMipmaps=!1;const C=this;"requestVideoFrameCallback"in s&&s.requestVideoFrameCallback(function A(){C.needsUpdate=!0,s.requestVideoFrameCallback(A)})}clone(){return new this.constructor(this.image).copy(this)}update(){const s=this.image;"requestVideoFrameCallback"in s==0&&s.readyState>=s.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}x1.prototype.isVideoTexture=!0;class b1 extends ls{constructor(s,a,u){super({width:s,height:a}),this.format=u,this.magFilter=zr,this.minFilter=zr,this.generateMipmaps=!1,this.needsUpdate=!0}}b1.prototype.isFramebufferTexture=!0;class xM extends ls{constructor(s,a,u,h,m,g,_,w,M,C,A,D){super(null,g,_,w,M,C,h,m,A,D),this.image={width:a,height:u},this.mipmaps=s,this.flipY=!1,this.generateMipmaps=!1}}xM.prototype.isCompressedTexture=!0;class w1 extends ls{constructor(s,a,u,h,m,g,_,w,M){super(s,a,u,h,m,g,_,w,M),this.needsUpdate=!0}}w1.prototype.isCanvasTexture=!0;class ps{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(s,a){const u=this.getUtoTmapping(s);return this.getPoint(u,a)}getPoints(s=5){const a=[];for(let u=0;u<=s;u++)a.push(this.getPoint(u/s));return a}getSpacedPoints(s=5){const a=[];for(let u=0;u<=s;u++)a.push(this.getPointAt(u/s));return a}getLength(){const s=this.getLengths();return s[s.length-1]}getLengths(s=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===s+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const a=[];let u,h=this.getPoint(0),m=0;a.push(0);for(let g=1;g<=s;g++)u=this.getPoint(g/s),m+=u.distanceTo(h),a.push(m),h=u;return this.cacheArcLengths=a,a}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(s,a){const u=this.getLengths();let h=0;const m=u.length;let g;g=a||s*u[m-1];let M,_=0,w=m-1;for(;_<=w;)if(h=Math.floor(_+(w-_)/2),M=u[h]-g,M<0)_=h+1;else{if(!(M>0)){w=h;break}w=h-1}if(h=w,u[h]===g)return h/(m-1);const C=u[h];return(h+(g-C)/(u[h+1]-C))/(m-1)}getTangent(s,a){let h=s-1e-4,m=s+1e-4;h<0&&(h=0),m>1&&(m=1);const g=this.getPoint(h),_=this.getPoint(m),w=a||(g.isVector2?new Qe:new J);return w.copy(_).sub(g).normalize(),w}getTangentAt(s,a){const u=this.getUtoTmapping(s);return this.getTangent(u,a)}computeFrenetFrames(s,a){const u=new J,h=[],m=[],g=[],_=new J,w=new cn;for(let R=0;R<=s;R++)h[R]=this.getTangentAt(R/s,new J);m[0]=new J,g[0]=new J;let M=Number.MAX_VALUE;const C=Math.abs(h[0].x),A=Math.abs(h[0].y),D=Math.abs(h[0].z);C<=M&&(M=C,u.set(1,0,0)),A<=M&&(M=A,u.set(0,1,0)),D<=M&&u.set(0,0,1),_.crossVectors(h[0],u).normalize(),m[0].crossVectors(h[0],_),g[0].crossVectors(h[0],m[0]);for(let R=1;R<=s;R++){if(m[R]=m[R-1].clone(),g[R]=g[R-1].clone(),_.crossVectors(h[R-1],h[R]),_.length()>Number.EPSILON){_.normalize();const L=Math.acos(as(h[R-1].dot(h[R]),-1,1));m[R].applyMatrix4(w.makeRotationAxis(_,L))}g[R].crossVectors(h[R],m[R])}if(!0===a){let R=Math.acos(as(m[0].dot(m[s]),-1,1));R/=s,h[0].dot(_.crossVectors(m[0],m[s]))>0&&(R=-R);for(let L=1;L<=s;L++)m[L].applyMatrix4(w.makeRotationAxis(h[L],R*L)),g[L].crossVectors(h[L],m[L])}return{tangents:h,normals:m,binormals:g}}clone(){return(new this.constructor).copy(this)}copy(s){return this.arcLengthDivisions=s.arcLengthDivisions,this}toJSON(){const s={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return s.arcLengthDivisions=this.arcLengthDivisions,s.type=this.type,s}fromJSON(s){return this.arcLengthDivisions=s.arcLengthDivisions,this}}class ah extends ps{constructor(s=0,a=0,u=1,h=1,m=0,g=2*Math.PI,_=!1,w=0){super(),this.type="EllipseCurve",this.aX=s,this.aY=a,this.xRadius=u,this.yRadius=h,this.aStartAngle=m,this.aEndAngle=g,this.aClockwise=_,this.aRotation=w}getPoint(s,a){const u=a||new Qe,h=2*Math.PI;let m=this.aEndAngle-this.aStartAngle;const g=Math.abs(m)<Number.EPSILON;for(;m<0;)m+=h;for(;m>h;)m-=h;m<Number.EPSILON&&(m=g?0:h),!0===this.aClockwise&&!g&&(m===h?m=-h:m-=h);const _=this.aStartAngle+s*m;let w=this.aX+this.xRadius*Math.cos(_),M=this.aY+this.yRadius*Math.sin(_);if(0!==this.aRotation){const C=Math.cos(this.aRotation),A=Math.sin(this.aRotation),D=w-this.aX,R=M-this.aY;w=D*C-R*A+this.aX,M=D*A+R*C+this.aY}return u.set(w,M)}copy(s){return super.copy(s),this.aX=s.aX,this.aY=s.aY,this.xRadius=s.xRadius,this.yRadius=s.yRadius,this.aStartAngle=s.aStartAngle,this.aEndAngle=s.aEndAngle,this.aClockwise=s.aClockwise,this.aRotation=s.aRotation,this}toJSON(){const s=super.toJSON();return s.aX=this.aX,s.aY=this.aY,s.xRadius=this.xRadius,s.yRadius=this.yRadius,s.aStartAngle=this.aStartAngle,s.aEndAngle=this.aEndAngle,s.aClockwise=this.aClockwise,s.aRotation=this.aRotation,s}fromJSON(s){return super.fromJSON(s),this.aX=s.aX,this.aY=s.aY,this.xRadius=s.xRadius,this.yRadius=s.yRadius,this.aStartAngle=s.aStartAngle,this.aEndAngle=s.aEndAngle,this.aClockwise=s.aClockwise,this.aRotation=s.aRotation,this}}ah.prototype.isEllipseCurve=!0;class m0 extends ah{constructor(s,a,u,h,m,g){super(s,a,u,u,h,m,g),this.type="ArcCurve"}}function ry(){let f=0,s=0,a=0,u=0;function h(m,g,_,w){f=m,s=_,a=-3*m+3*g-2*_-w,u=2*m-2*g+_+w}return{initCatmullRom:function(m,g,_,w,M){h(g,_,M*(_-m),M*(w-g))},initNonuniformCatmullRom:function(m,g,_,w,M,C,A){let D=(g-m)/M-(_-m)/(M+C)+(_-g)/C,R=(_-g)/C-(w-g)/(C+A)+(w-_)/A;D*=C,R*=C,h(g,_,D,R)},calc:function(m){const g=m*m;return f+s*m+a*g+u*(g*m)}}}m0.prototype.isArcCurve=!0;const jd=new J,sy=new ry,$p=new ry,g0=new ry;class Dl extends ps{constructor(s=[],a=!1,u="centripetal",h=.5){super(),this.type="CatmullRomCurve3",this.points=s,this.closed=a,this.curveType=u,this.tension=h}getPoint(s,a=new J){const u=a,h=this.points,m=h.length,g=(m-(this.closed?0:1))*s;let M,C,_=Math.floor(g),w=g-_;this.closed?_+=_>0?0:(Math.floor(Math.abs(_)/m)+1)*m:0===w&&_===m-1&&(_=m-2,w=1),this.closed||_>0?M=h[(_-1)%m]:(jd.subVectors(h[0],h[1]).add(h[0]),M=jd);const A=h[_%m],D=h[(_+1)%m];if(this.closed||_+2<m?C=h[(_+2)%m]:(jd.subVectors(h[m-1],h[m-2]).add(h[m-1]),C=jd),"centripetal"===this.curveType||"chordal"===this.curveType){const R="chordal"===this.curveType?.5:.25;let L=Math.pow(M.distanceToSquared(A),R),P=Math.pow(A.distanceToSquared(D),R),I=Math.pow(D.distanceToSquared(C),R);P<1e-4&&(P=1),L<1e-4&&(L=P),I<1e-4&&(I=P),sy.initNonuniformCatmullRom(M.x,A.x,D.x,C.x,L,P,I),$p.initNonuniformCatmullRom(M.y,A.y,D.y,C.y,L,P,I),g0.initNonuniformCatmullRom(M.z,A.z,D.z,C.z,L,P,I)}else"catmullrom"===this.curveType&&(sy.initCatmullRom(M.x,A.x,D.x,C.x,this.tension),$p.initCatmullRom(M.y,A.y,D.y,C.y,this.tension),g0.initCatmullRom(M.z,A.z,D.z,C.z,this.tension));return u.set(sy.calc(w),$p.calc(w),g0.calc(w)),u}copy(s){super.copy(s),this.points=[];for(let a=0,u=s.points.length;a<u;a++)this.points.push(s.points[a].clone());return this.closed=s.closed,this.curveType=s.curveType,this.tension=s.tension,this}toJSON(){const s=super.toJSON();s.points=[];for(let a=0,u=this.points.length;a<u;a++)s.points.push(this.points[a].toArray());return s.closed=this.closed,s.curveType=this.curveType,s.tension=this.tension,s}fromJSON(s){super.fromJSON(s),this.points=[];for(let a=0,u=s.points.length;a<u;a++){const h=s.points[a];this.points.push((new J).fromArray(h))}return this.closed=s.closed,this.curveType=s.curveType,this.tension=s.tension,this}}function y0(f,s,a,u,h){const m=.5*(u-s),g=.5*(h-a),_=f*f;return(2*a-2*u+m+g)*(f*_)+(-3*a+3*u-2*m-g)*_+m*f+a}function Xd(f,s,a,u){return function M1(f,s){const a=1-f;return a*a*s}(f,s)+function _0(f,s){return 2*(1-f)*f*s}(f,a)+function S1(f,s){return f*f*s}(f,u)}function lh(f,s,a,u,h){return function E1(f,s){const a=1-f;return a*a*a*s}(f,s)+function C1(f,s){const a=1-f;return 3*a*a*f*s}(f,a)+function Yp(f,s){return 3*(1-f)*f*f*s}(f,u)+function $d(f,s){return f*f*f*s}(f,h)}Dl.prototype.isCatmullRomCurve3=!0;class fc extends ps{constructor(s=new Qe,a=new Qe,u=new Qe,h=new Qe){super(),this.type="CubicBezierCurve",this.v0=s,this.v1=a,this.v2=u,this.v3=h}getPoint(s,a=new Qe){const u=a,h=this.v0,m=this.v1,g=this.v2,_=this.v3;return u.set(lh(s,h.x,m.x,g.x,_.x),lh(s,h.y,m.y,g.y,_.y)),u}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this.v3.copy(s.v3),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s.v3=this.v3.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this.v3.fromArray(s.v3),this}}fc.prototype.isCubicBezierCurve=!0;class ch extends ps{constructor(s=new J,a=new J,u=new J,h=new J){super(),this.type="CubicBezierCurve3",this.v0=s,this.v1=a,this.v2=u,this.v3=h}getPoint(s,a=new J){const u=a,h=this.v0,m=this.v1,g=this.v2,_=this.v3;return u.set(lh(s,h.x,m.x,g.x,_.x),lh(s,h.y,m.y,g.y,_.y),lh(s,h.z,m.z,g.z,_.z)),u}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this.v3.copy(s.v3),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s.v3=this.v3.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this.v3.fromArray(s.v3),this}}ch.prototype.isCubicBezierCurve3=!0;class Rl extends ps{constructor(s=new Qe,a=new Qe){super(),this.type="LineCurve",this.v1=s,this.v2=a}getPoint(s,a=new Qe){const u=a;return 1===s?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(s).add(this.v1)),u}getPointAt(s,a){return this.getPoint(s,a)}getTangent(s,a){const u=a||new Qe;return u.copy(this.v2).sub(this.v1).normalize(),u}copy(s){return super.copy(s),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}Rl.prototype.isLineCurve=!0;class bM extends ps{constructor(s=new J,a=new J){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=s,this.v2=a}getPoint(s,a=new J){const u=a;return 1===s?u.copy(this.v2):(u.copy(this.v2).sub(this.v1),u.multiplyScalar(s).add(this.v1)),u}getPointAt(s,a){return this.getPoint(s,a)}copy(s){return super.copy(s),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}class Kp extends ps{constructor(s=new Qe,a=new Qe,u=new Qe){super(),this.type="QuadraticBezierCurve",this.v0=s,this.v1=a,this.v2=u}getPoint(s,a=new Qe){const u=a,h=this.v0,m=this.v1,g=this.v2;return u.set(Xd(s,h.x,m.x,g.x),Xd(s,h.y,m.y,g.y)),u}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}Kp.prototype.isQuadraticBezierCurve=!0;class Zp extends ps{constructor(s=new J,a=new J,u=new J){super(),this.type="QuadraticBezierCurve3",this.v0=s,this.v1=a,this.v2=u}getPoint(s,a=new J){const u=a,h=this.v0,m=this.v1,g=this.v2;return u.set(Xd(s,h.x,m.x,g.x),Xd(s,h.y,m.y,g.y),Xd(s,h.z,m.z,g.z)),u}copy(s){return super.copy(s),this.v0.copy(s.v0),this.v1.copy(s.v1),this.v2.copy(s.v2),this}toJSON(){const s=super.toJSON();return s.v0=this.v0.toArray(),s.v1=this.v1.toArray(),s.v2=this.v2.toArray(),s}fromJSON(s){return super.fromJSON(s),this.v0.fromArray(s.v0),this.v1.fromArray(s.v1),this.v2.fromArray(s.v2),this}}Zp.prototype.isQuadraticBezierCurve3=!0;class Yd extends ps{constructor(s=[]){super(),this.type="SplineCurve",this.points=s}getPoint(s,a=new Qe){const u=a,h=this.points,m=(h.length-1)*s,g=Math.floor(m),_=m-g,w=h[0===g?g:g-1],M=h[g],C=h[g>h.length-2?h.length-1:g+1],A=h[g>h.length-3?h.length-1:g+2];return u.set(y0(_,w.x,M.x,C.x,A.x),y0(_,w.y,M.y,C.y,A.y)),u}copy(s){super.copy(s),this.points=[];for(let a=0,u=s.points.length;a<u;a++)this.points.push(s.points[a].clone());return this}toJSON(){const s=super.toJSON();s.points=[];for(let a=0,u=this.points.length;a<u;a++)s.points.push(this.points[a].toArray());return s}fromJSON(s){super.fromJSON(s),this.points=[];for(let a=0,u=s.points.length;a<u;a++){const h=s.points[a];this.points.push((new Qe).fromArray(h))}return this}}Yd.prototype.isSplineCurve=!0;var Jp=Object.freeze({__proto__:null,ArcCurve:m0,CatmullRomCurve3:Dl,CubicBezierCurve:fc,CubicBezierCurve3:ch,EllipseCurve:ah,LineCurve:Rl,LineCurve3:bM,QuadraticBezierCurve:Kp,QuadraticBezierCurve3:Zp,SplineCurve:Yd});class v0 extends ps{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(s){this.curves.push(s)}closePath(){const s=this.curves[0].getPoint(0),a=this.curves[this.curves.length-1].getPoint(1);s.equals(a)||this.curves.push(new Rl(a,s))}getPoint(s,a){const u=s*this.getLength(),h=this.getCurveLengths();let m=0;for(;m<h.length;){if(h[m]>=u){const g=h[m]-u,_=this.curves[m],w=_.getLength();return _.getPointAt(0===w?0:1-g/w,a)}m++}return null}getLength(){const s=this.getCurveLengths();return s[s.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const s=[];let a=0;for(let u=0,h=this.curves.length;u<h;u++)a+=this.curves[u].getLength(),s.push(a);return this.cacheLengths=s,s}getSpacedPoints(s=40){const a=[];for(let u=0;u<=s;u++)a.push(this.getPoint(u/s));return this.autoClose&&a.push(a[0]),a}getPoints(s=12){const a=[];let u;for(let h=0,m=this.curves;h<m.length;h++){const g=m[h],w=g.getPoints(g.isEllipseCurve?2*s:g.isLineCurve||g.isLineCurve3?1:g.isSplineCurve?s*g.points.length:s);for(let M=0;M<w.length;M++){const C=w[M];u&&u.equals(C)||(a.push(C),u=C)}}return this.autoClose&&a.length>1&&!a[a.length-1].equals(a[0])&&a.push(a[0]),a}copy(s){super.copy(s),this.curves=[];for(let a=0,u=s.curves.length;a<u;a++)this.curves.push(s.curves[a].clone());return this.autoClose=s.autoClose,this}toJSON(){const s=super.toJSON();s.autoClose=this.autoClose,s.curves=[];for(let a=0,u=this.curves.length;a<u;a++)s.curves.push(this.curves[a].toJSON());return s}fromJSON(s){super.fromJSON(s),this.autoClose=s.autoClose,this.curves=[];for(let a=0,u=s.curves.length;a<u;a++){const h=s.curves[a];this.curves.push((new Jp[h.type]).fromJSON(h))}return this}}class pc extends v0{constructor(s){super(),this.type="Path",this.currentPoint=new Qe,s&&this.setFromPoints(s)}setFromPoints(s){this.moveTo(s[0].x,s[0].y);for(let a=1,u=s.length;a<u;a++)this.lineTo(s[a].x,s[a].y);return this}moveTo(s,a){return this.currentPoint.set(s,a),this}lineTo(s,a){const u=new Rl(this.currentPoint.clone(),new Qe(s,a));return this.curves.push(u),this.currentPoint.set(s,a),this}quadraticCurveTo(s,a,u,h){const m=new Kp(this.currentPoint.clone(),new Qe(s,a),new Qe(u,h));return this.curves.push(m),this.currentPoint.set(u,h),this}bezierCurveTo(s,a,u,h,m,g){const _=new fc(this.currentPoint.clone(),new Qe(s,a),new Qe(u,h),new Qe(m,g));return this.curves.push(_),this.currentPoint.set(m,g),this}splineThru(s){const a=[this.currentPoint.clone()].concat(s),u=new Yd(a);return this.curves.push(u),this.currentPoint.copy(s[s.length-1]),this}arc(s,a,u,h,m,g){return this.absarc(s+this.currentPoint.x,a+this.currentPoint.y,u,h,m,g),this}absarc(s,a,u,h,m,g){return this.absellipse(s,a,u,u,h,m,g),this}ellipse(s,a,u,h,m,g,_,w){return this.absellipse(s+this.currentPoint.x,a+this.currentPoint.y,u,h,m,g,_,w),this}absellipse(s,a,u,h,m,g,_,w){const M=new ah(s,a,u,h,m,g,_,w);if(this.curves.length>0){const A=M.getPoint(0);A.equals(this.currentPoint)||this.lineTo(A.x,A.y)}this.curves.push(M);const C=M.getPoint(1);return this.currentPoint.copy(C),this}copy(s){return super.copy(s),this.currentPoint.copy(s.currentPoint),this}toJSON(){const s=super.toJSON();return s.currentPoint=this.currentPoint.toArray(),s}fromJSON(s){return super.fromJSON(s),this.currentPoint.fromArray(s.currentPoint),this}}class uh extends en{constructor(s=[new Qe(0,.5),new Qe(.5,0),new Qe(0,-.5)],a=12,u=0,h=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:s,segments:a,phiStart:u,phiLength:h},a=Math.floor(a),h=as(h,0,2*Math.PI);const m=[],g=[],_=[],w=[],M=[],C=1/a,A=new J,D=new Qe,R=new J,L=new J,P=new J;let I=0,z=0;for(let B=0;B<=s.length-1;B++)switch(B){case 0:I=s[B+1].x-s[B].x,z=s[B+1].y-s[B].y,R.x=1*z,R.y=-I,R.z=0*z,P.copy(R),R.normalize(),w.push(R.x,R.y,R.z);break;case s.length-1:w.push(P.x,P.y,P.z);break;default:I=s[B+1].x-s[B].x,z=s[B+1].y-s[B].y,R.x=1*z,R.y=-I,R.z=0*z,L.copy(R),R.x+=P.x,R.y+=P.y,R.z+=P.z,R.normalize(),w.push(R.x,R.y,R.z),P.copy(L)}for(let B=0;B<=a;B++){const j=u+B*C*h,G=Math.sin(j),Y=Math.cos(j);for(let le=0;le<=s.length-1;le++)A.x=s[le].x*G,A.y=s[le].y,A.z=s[le].x*Y,g.push(A.x,A.y,A.z),D.x=B/a,D.y=le/(s.length-1),_.push(D.x,D.y),M.push(w[3*le+0]*G,w[3*le+1],w[3*le+0]*Y)}for(let B=0;B<a;B++)for(let j=0;j<s.length-1;j++){const G=j+B*s.length,le=G+s.length,fe=G+s.length+1,ye=G+1;m.push(G,le,ye),m.push(fe,ye,le)}this.setIndex(m),this.setAttribute("position",new nn(g,3)),this.setAttribute("uv",new nn(_,2)),this.setAttribute("normal",new nn(M,3))}static fromJSON(s){return new uh(s.points,s.segments,s.phiStart,s.phiLength)}}class hh extends uh{constructor(s=1,a=1,u=4,h=8){const m=new pc;m.absarc(0,-a/2,s,1.5*Math.PI,0),m.absarc(0,a/2,s,0,.5*Math.PI),super(m.getPoints(u),h),this.type="CapsuleGeometry",this.parameters={radius:s,height:a,capSegments:u,radialSegments:h}}static fromJSON(s){return new hh(s.radius,s.length,s.capSegments,s.radialSegments)}}class Qp extends en{constructor(s=1,a=8,u=0,h=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:s,segments:a,thetaStart:u,thetaLength:h},a=Math.max(3,a);const m=[],g=[],_=[],w=[],M=new J,C=new Qe;g.push(0,0,0),_.push(0,0,1),w.push(.5,.5);for(let A=0,D=3;A<=a;A++,D+=3){const R=u+A/a*h;M.x=s*Math.cos(R),M.y=s*Math.sin(R),g.push(M.x,M.y,M.z),_.push(0,0,1),C.x=(g[D]/s+1)/2,C.y=(g[D+1]/s+1)/2,w.push(C.x,C.y)}for(let A=1;A<=a;A++)m.push(A,A+1,0);this.setIndex(m),this.setAttribute("position",new nn(g,3)),this.setAttribute("normal",new nn(_,3)),this.setAttribute("uv",new nn(w,2))}static fromJSON(s){return new Qp(s.radius,s.segments,s.thetaStart,s.thetaLength)}}class mc extends en{constructor(s=1,a=1,u=1,h=8,m=1,g=!1,_=0,w=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:s,radiusBottom:a,height:u,radialSegments:h,heightSegments:m,openEnded:g,thetaStart:_,thetaLength:w};const M=this;h=Math.floor(h),m=Math.floor(m);const C=[],A=[],D=[],R=[];let L=0;const P=[],I=u/2;let z=0;function j(G){const Y=L,le=new Qe,fe=new J;let ye=0;const Ve=!0===G?s:a,we=!0===G?1:-1;for(let he=1;he<=h;he++)A.push(0,I*we,0),D.push(0,we,0),R.push(.5,.5),L++;const X=L;for(let he=0;he<=h;he++){const Ee=he/h*w+_,Be=Math.cos(Ee),Ie=Math.sin(Ee);fe.x=Ve*Ie,fe.y=I*we,fe.z=Ve*Be,A.push(fe.x,fe.y,fe.z),D.push(0,we,0),le.x=.5*Be+.5,le.y=.5*Ie*we+.5,R.push(le.x,le.y),L++}for(let he=0;he<h;he++){const ft=Y+he,Ee=X+he;!0===G?C.push(Ee,Ee+1,ft):C.push(Ee+1,Ee,ft),ye+=3}M.addGroup(z,ye,!0===G?1:2),z+=ye}(function B(){const G=new J,Y=new J;let le=0;const fe=(a-s)/u;for(let ye=0;ye<=m;ye++){const Ve=[],we=ye/m,X=we*(a-s)+s;for(let he=0;he<=h;he++){const ft=he/h,Ee=ft*w+_,Be=Math.sin(Ee),Ie=Math.cos(Ee);Y.x=X*Be,Y.y=-we*u+I,Y.z=X*Ie,A.push(Y.x,Y.y,Y.z),G.set(Be,fe,Ie).normalize(),D.push(G.x,G.y,G.z),R.push(ft,1-we),Ve.push(L++)}P.push(Ve)}for(let ye=0;ye<h;ye++)for(let Ve=0;Ve<m;Ve++){const X=P[Ve+1][ye],he=P[Ve+1][ye+1],ft=P[Ve][ye+1];C.push(P[Ve][ye],X,ft),C.push(X,he,ft),le+=6}M.addGroup(z,le,0),z+=le})(),!1===g&&(s>0&&j(!0),a>0&&j(!1)),this.setIndex(C),this.setAttribute("position",new nn(A,3)),this.setAttribute("normal",new nn(D,3)),this.setAttribute("uv",new nn(R,2))}static fromJSON(s){return new mc(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength)}}class dh extends mc{constructor(s=1,a=1,u=8,h=1,m=!1,g=0,_=2*Math.PI){super(0,s,a,u,h,m,g,_),this.type="ConeGeometry",this.parameters={radius:s,height:a,radialSegments:u,heightSegments:h,openEnded:m,thetaStart:g,thetaLength:_}}static fromJSON(s){return new dh(s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength)}}class Pl extends en{constructor(s=[],a=[],u=1,h=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:s,indices:a,radius:u,detail:h};const m=[],g=[];function w(B,j,G,Y){const le=Y+1,fe=[];for(let ye=0;ye<=le;ye++){fe[ye]=[];const Ve=B.clone().lerp(G,ye/le),we=j.clone().lerp(G,ye/le),X=le-ye;for(let he=0;he<=X;he++)fe[ye][he]=0===he&&ye===le?Ve:Ve.clone().lerp(we,he/X)}for(let ye=0;ye<le;ye++)for(let Ve=0;Ve<2*(le-ye)-1;Ve++){const we=Math.floor(Ve/2);Ve%2==0?(D(fe[ye][we+1]),D(fe[ye+1][we]),D(fe[ye][we])):(D(fe[ye][we+1]),D(fe[ye+1][we+1]),D(fe[ye+1][we]))}}function D(B){m.push(B.x,B.y,B.z)}function R(B,j){const G=3*B;j.x=s[G+0],j.y=s[G+1],j.z=s[G+2]}function P(B,j,G,Y){Y<0&&1===B.x&&(g[j]=B.x-1),0===G.x&&0===G.z&&(g[j]=Y/2/Math.PI+.5)}function I(B){return Math.atan2(B.z,-B.x)}function z(B){return Math.atan2(-B.y,Math.sqrt(B.x*B.x+B.z*B.z))}(function _(B){const j=new J,G=new J,Y=new J;for(let le=0;le<a.length;le+=3)R(a[le+0],j),R(a[le+1],G),R(a[le+2],Y),w(j,G,Y,B)})(h),function M(B){const j=new J;for(let G=0;G<m.length;G+=3)j.x=m[G+0],j.y=m[G+1],j.z=m[G+2],j.normalize().multiplyScalar(B),m[G+0]=j.x,m[G+1]=j.y,m[G+2]=j.z}(u),function C(){const B=new J;for(let j=0;j<m.length;j+=3){B.x=m[j+0],B.y=m[j+1],B.z=m[j+2];const G=I(B)/2/Math.PI+.5,Y=z(B)/Math.PI+.5;g.push(G,1-Y)}(function L(){const B=new J,j=new J,G=new J,Y=new J,le=new Qe,fe=new Qe,ye=new Qe;for(let Ve=0,we=0;Ve<m.length;Ve+=9,we+=6){B.set(m[Ve+0],m[Ve+1],m[Ve+2]),j.set(m[Ve+3],m[Ve+4],m[Ve+5]),G.set(m[Ve+6],m[Ve+7],m[Ve+8]),le.set(g[we+0],g[we+1]),fe.set(g[we+2],g[we+3]),ye.set(g[we+4],g[we+5]),Y.copy(B).add(j).add(G).divideScalar(3);const X=I(Y);P(le,we+0,B,X),P(fe,we+2,j,X),P(ye,we+4,G,X)}})(),function A(){for(let B=0;B<g.length;B+=6){const j=g[B+0],G=g[B+2],Y=g[B+4],le=Math.max(j,G,Y),fe=Math.min(j,G,Y);le>.9&&fe<.1&&(j<.2&&(g[B+0]+=1),G<.2&&(g[B+2]+=1),Y<.2&&(g[B+4]+=1))}}()}(),this.setAttribute("position",new nn(m,3)),this.setAttribute("normal",new nn(m.slice(),3)),this.setAttribute("uv",new nn(g,2)),0===h?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(s){return new Pl(s.vertices,s.indices,s.radius,s.details)}}class fh extends Pl{constructor(s=1,a=0){const u=(1+Math.sqrt(5))/2,h=1/u;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-h,-u,0,-h,u,0,h,-u,0,h,u,-h,-u,0,-h,u,0,h,-u,0,h,u,0,-u,0,-h,u,0,-h,-u,0,h,u,0,h],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],s,a),this.type="DodecahedronGeometry",this.parameters={radius:s,detail:a}}static fromJSON(s){return new fh(s.radius,s.detail)}}const oy=new J,ay=new J,Lo=new J,ly=new Gr;class x0 extends en{constructor(s=null,a=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:s,thresholdAngle:a},null!==s){const h=Math.pow(10,4),m=Math.cos(dd*a),g=s.getIndex(),_=s.getAttribute("position"),w=g?g.count:_.count,M=[0,0,0],C=["a","b","c"],A=new Array(3),D={},R=[];for(let L=0;L<w;L+=3){g?(M[0]=g.getX(L),M[1]=g.getX(L+1),M[2]=g.getX(L+2)):(M[0]=L,M[1]=L+1,M[2]=L+2);const{a:P,b:I,c:z}=ly;if(P.fromBufferAttribute(_,M[0]),I.fromBufferAttribute(_,M[1]),z.fromBufferAttribute(_,M[2]),ly.getNormal(Lo),A[0]=`${Math.round(P.x*h)},${Math.round(P.y*h)},${Math.round(P.z*h)}`,A[1]=`${Math.round(I.x*h)},${Math.round(I.y*h)},${Math.round(I.z*h)}`,A[2]=`${Math.round(z.x*h)},${Math.round(z.y*h)},${Math.round(z.z*h)}`,A[0]!==A[1]&&A[1]!==A[2]&&A[2]!==A[0])for(let B=0;B<3;B++){const j=(B+1)%3,G=A[B],Y=A[j],le=ly[C[B]],fe=ly[C[j]],ye=`${G}_${Y}`,Ve=`${Y}_${G}`;Ve in D&&D[Ve]?(Lo.dot(D[Ve].normal)<=m&&(R.push(le.x,le.y,le.z),R.push(fe.x,fe.y,fe.z)),D[Ve]=null):ye in D||(D[ye]={index0:M[B],index1:M[j],normal:Lo.clone()})}}for(const L in D)if(D[L]){const{index0:P,index1:I}=D[L];oy.fromBufferAttribute(_,P),ay.fromBufferAttribute(_,I),R.push(oy.x,oy.y,oy.z),R.push(ay.x,ay.y,ay.z)}this.setAttribute("position",new nn(R,3))}}}class gc extends pc{constructor(s){super(s),this.uuid=wa(),this.type="Shape",this.holes=[]}getPointsHoles(s){const a=[];for(let u=0,h=this.holes.length;u<h;u++)a[u]=this.holes[u].getPoints(s);return a}extractPoints(s){return{shape:this.getPoints(s),holes:this.getPointsHoles(s)}}copy(s){super.copy(s),this.holes=[];for(let a=0,u=s.holes.length;a<u;a++)this.holes.push(s.holes[a].clone());return this}toJSON(){const s=super.toJSON();s.uuid=this.uuid,s.holes=[];for(let a=0,u=this.holes.length;a<u;a++)s.holes.push(this.holes[a].toJSON());return s}fromJSON(s){super.fromJSON(s),this.uuid=s.uuid,this.holes=[];for(let a=0,u=s.holes.length;a<u;a++){const h=s.holes[a];this.holes.push((new pc).fromJSON(h))}return this}}function b0(f,s,a,u,h){let m,g;if(h===function O1(f,s,a,u){let h=0;for(let m=s,g=a-u;m<a;m+=u)h+=(f[g]-f[m])*(f[m+1]+f[g+1]),g=m;return h}(f,s,a,u)>0)for(m=s;m<a;m+=u)g=TM(m,f[m],f[m+1],g);else for(m=a-u;m>=s;m-=u)g=TM(m,f[m],f[m+1],g);return g&&uy(g,g.next)&&(Zc(g),g=g.next),g}function ph(f,s){if(!f)return f;s||(s=f);let u,a=f;do{if(u=!1,a.steiner||!uy(a,a.next)&&0!==Br(a.prev,a,a.next))a=a.next;else{if(Zc(a),a=s=a.prev,a===a.next)break;u=!0}}while(u||a!==s);return s}function em(f,s,a,u,h,m,g){if(!f)return;!g&&m&&function I1(f,s,a,u){let h=f;do{null===h.z&&(h.z=cy(h.x,h.y,s,a,u)),h.prevZ=h.prev,h.nextZ=h.next,h=h.next}while(h!==f);h.prevZ.nextZ=null,h.prevZ=null,function EM(f){let s,a,u,h,m,g,_,w,M=1;do{for(a=f,f=null,m=null,g=0;a;){for(g++,u=a,_=0,s=0;s<M&&(_++,u=u.nextZ,u);s++);for(w=M;_>0||w>0&&u;)0!==_&&(0===w||!u||a.z<=u.z)?(h=a,a=a.nextZ,_--):(h=u,u=u.nextZ,w--),m?m.nextZ=h:f=h,h.prevZ=m,m=h;a=u}m.nextZ=null,M*=2}while(g>1)}(h)}(f,u,h,m);let w,M,_=f;for(;f.prev!==f.next;)if(w=f.prev,M=f.next,m?wM(f,u,h,m):w0(f))s.push(w.i/a),s.push(f.i/a),s.push(M.i/a),Zc(f),f=M.next,_=M.next;else if((f=M)===_){g?1===g?em(f=T1(ph(f),s,a),s,a,u,h,m,2):2===g&&A1(f,s,a,u,h,m):em(ph(f),s,a,u,h,m,1);break}}function w0(f){const s=f.prev,a=f,u=f.next;if(Br(s,a,u)>=0)return!1;let h=f.next.next;for(;h!==f.prev;){if(Fo(s.x,s.y,a.x,a.y,u.x,u.y,h.x,h.y)&&Br(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function wM(f,s,a,u){const h=f.prev,m=f,g=f.next;if(Br(h,m,g)>=0)return!1;const M=h.x>m.x?h.x>g.x?h.x:g.x:m.x>g.x?m.x:g.x,C=h.y>m.y?h.y>g.y?h.y:g.y:m.y>g.y?m.y:g.y,A=cy(h.x<m.x?h.x<g.x?h.x:g.x:m.x<g.x?m.x:g.x,h.y<m.y?h.y<g.y?h.y:g.y:m.y<g.y?m.y:g.y,s,a,u),D=cy(M,C,s,a,u);let R=f.prevZ,L=f.nextZ;for(;R&&R.z>=A&&L&&L.z<=D;){if(R!==f.prev&&R!==f.next&&Fo(h.x,h.y,m.x,m.y,g.x,g.y,R.x,R.y)&&Br(R.prev,R,R.next)>=0||(R=R.prevZ,L!==f.prev&&L!==f.next&&Fo(h.x,h.y,m.x,m.y,g.x,g.y,L.x,L.y)&&Br(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;R&&R.z>=A;){if(R!==f.prev&&R!==f.next&&Fo(h.x,h.y,m.x,m.y,g.x,g.y,R.x,R.y)&&Br(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;L&&L.z<=D;){if(L!==f.prev&&L!==f.next&&Fo(h.x,h.y,m.x,m.y,g.x,g.y,L.x,L.y)&&Br(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function T1(f,s,a){let u=f;do{const h=u.prev,m=u.next.next;!uy(h,m)&&F1(h,u,u.next,m)&&nm(h,m)&&nm(m,h)&&(s.push(h.i/a),s.push(u.i/a),s.push(m.i/a),Zc(u),Zc(u.next),u=f=m),u=u.next}while(u!==f);return ph(u)}function A1(f,s,a,u,h,m){let g=f;do{let _=g.next.next;for(;_!==g.prev;){if(g.i!==_.i&&M0(g,_)){let w=CM(g,_);return g=ph(g,g.next),w=ph(w,w.next),em(g,s,a,u,h,m),void em(w,s,a,u,h,m)}_=_.next}g=g.next}while(g!==f)}function MM(f,s){return f.x-s.x}function R1(f,s){if(s=function SM(f,s){let a=s;const u=f.x,h=f.y;let g,m=-1/0;do{if(h<=a.y&&h>=a.next.y&&a.next.y!==a.y){const D=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(D<=u&&D>m){if(m=D,D===u){if(h===a.y)return a;if(h===a.next.y)return a.next}g=a.x<a.next.x?a:a.next}}a=a.next}while(a!==s);if(!g)return null;if(u===m)return g;const _=g,w=g.x,M=g.y;let A,C=1/0;a=g;do{u>=a.x&&a.x>=w&&u!==a.x&&Fo(h<M?u:m,h,w,M,h<M?m:u,h,a.x,a.y)&&(A=Math.abs(h-a.y)/(u-a.x),nm(a,f)&&(A<C||A===C&&(a.x>g.x||a.x===g.x&&P1(g,a)))&&(g=a,C=A)),a=a.next}while(a!==_);return g}(f,s),s){const a=CM(s,f);ph(s,s.next),ph(a,a.next)}}function P1(f,s){return Br(f.prev,f,s.prev)<0&&Br(s.next,f,f.next)<0}function cy(f,s,a,u,h){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=32767*(f-a)*h)|f<<8))|f<<4))|f<<2))|f<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-u)*h)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function L1(f){let s=f,a=f;do{(s.x<a.x||s.x===a.x&&s.y<a.y)&&(a=s),s=s.next}while(s!==f);return a}function Fo(f,s,a,u,h,m,g,_){return(h-g)*(s-_)-(f-g)*(m-_)>=0&&(f-g)*(u-_)-(a-g)*(s-_)>=0&&(a-g)*(m-_)-(h-g)*(u-_)>=0}function M0(f,s){return f.next.i!==s.i&&f.prev.i!==s.i&&!function N1(f,s){let a=f;do{if(a.i!==f.i&&a.next.i!==f.i&&a.i!==s.i&&a.next.i!==s.i&&F1(a,a.next,f,s))return!0;a=a.next}while(a!==f);return!1}(f,s)&&(nm(f,s)&&nm(s,f)&&function S0(f,s){let a=f,u=!1;const h=(f.x+s.x)/2,m=(f.y+s.y)/2;do{a.y>m!=a.next.y>m&&a.next.y!==a.y&&h<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next}while(a!==f);return u}(f,s)&&(Br(f.prev,f,s.prev)||Br(f,s.prev,s))||uy(f,s)&&Br(f.prev,f,f.next)>0&&Br(s.prev,s,s.next)>0)}function Br(f,s,a){return(s.y-f.y)*(a.x-s.x)-(s.x-f.x)*(a.y-s.y)}function uy(f,s){return f.x===s.x&&f.y===s.y}function F1(f,s,a,u){const h=hy(Br(f,s,a)),m=hy(Br(f,s,u)),g=hy(Br(a,u,f)),_=hy(Br(a,u,s));return!!(h!==m&&g!==_||0===h&&tm(f,a,s)||0===m&&tm(f,u,s)||0===g&&tm(a,f,u)||0===_&&tm(a,s,u))}function tm(f,s,a){return s.x<=Math.max(f.x,a.x)&&s.x>=Math.min(f.x,a.x)&&s.y<=Math.max(f.y,a.y)&&s.y>=Math.min(f.y,a.y)}function hy(f){return f>0?1:f<0?-1:0}function nm(f,s){return Br(f.prev,f,f.next)<0?Br(f,s,f.next)>=0&&Br(f,f.prev,s)>=0:Br(f,s,f.prev)<0||Br(f,f.next,s)<0}function CM(f,s){const a=new im(f.i,f.x,f.y),u=new im(s.i,s.x,s.y),h=f.next,m=s.prev;return f.next=s,s.prev=f,a.next=h,h.prev=a,u.next=a,a.prev=u,m.next=u,u.prev=m,u}function TM(f,s,a,u){const h=new im(f,s,a);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Zc(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function im(f,s,a){this.i=f,this.x=s,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Fa{static area(s){const a=s.length;let u=0;for(let h=a-1,m=0;m<a;h=m++)u+=s[h].x*s[m].y-s[m].x*s[h].y;return.5*u}static isClockWise(s){return Fa.area(s)<0}static triangulateShape(s,a){const u=[],h=[],m=[];dy(s),E0(u,s);let g=s.length;a.forEach(dy);for(let w=0;w<a.length;w++)h.push(g),g+=a[w].length,E0(u,a[w]);const _=function(f,s,a=2){const u=s&&s.length,h=u?s[0]*a:f.length;let m=b0(f,0,h,a,!0);const g=[];if(!m||m.next===m.prev)return g;let _,w,M,C,A,D,R;if(u&&(m=function D1(f,s,a,u){const h=[];let m,g,_,w,M;for(m=0,g=s.length;m<g;m++)_=s[m]*u,w=m<g-1?s[m+1]*u:f.length,M=b0(f,_,w,u,!1),M===M.next&&(M.steiner=!0),h.push(L1(M));for(h.sort(MM),m=0;m<h.length;m++)R1(h[m],a),a=ph(a,a.next);return a}(f,s,m,a)),f.length>80*a){_=M=f[0],w=C=f[1];for(let L=a;L<h;L+=a)A=f[L],D=f[L+1],A<_&&(_=A),D<w&&(w=D),A>M&&(M=A),D>C&&(C=D);R=Math.max(M-_,C-w),R=0!==R?1/R:0}return em(m,g,a,_,w,R),g}(u,h);for(let w=0;w<_.length;w+=3)m.push(_.slice(w,w+3));return m}}function dy(f){const s=f.length;s>2&&f[s-1].equals(f[0])&&f.pop()}function E0(f,s){for(let a=0;a<s.length;a++)f.push(s[a].x),f.push(s[a].y)}class yc extends en{constructor(s=new gc([new Qe(.5,.5),new Qe(-.5,.5),new Qe(-.5,-.5),new Qe(.5,-.5)]),a={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:s,options:a},s=Array.isArray(s)?s:[s];const u=this,h=[],m=[];for(let _=0,w=s.length;_<w;_++)g(s[_]);function g(_){const w=[],M=void 0!==a.curveSegments?a.curveSegments:12,C=void 0!==a.steps?a.steps:1;let A=void 0!==a.depth?a.depth:1,D=void 0===a.bevelEnabled||a.bevelEnabled,R=void 0!==a.bevelThickness?a.bevelThickness:.2,L=void 0!==a.bevelSize?a.bevelSize:R-.1,P=void 0!==a.bevelOffset?a.bevelOffset:0,I=void 0!==a.bevelSegments?a.bevelSegments:3;const z=a.extrudePath,B=void 0!==a.UVGenerator?a.UVGenerator:F2;void 0!==a.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),A=a.amount);let j,Y,le,fe,ye,G=!1;z&&(j=z.getSpacedPoints(C),G=!0,D=!1,Y=z.computeFrenetFrames(C,!1),le=new J,fe=new J,ye=new J),D||(I=0,R=0,L=0,P=0);const Ve=_.extractPoints(M);let we=Ve.shape;const X=Ve.holes;if(!Fa.isClockWise(we)){we=we.reverse();for(let Je=0,rt=X.length;Je<rt;Je++){const xt=X[Je];Fa.isClockWise(xt)&&(X[Je]=xt.reverse())}}const ft=Fa.triangulateShape(we,X),Ee=we;for(let Je=0,rt=X.length;Je<rt;Je++)we=we.concat(X[Je]);function Be(Je,rt,xt){return rt||console.error("THREE.ExtrudeGeometry: vec does not exist"),rt.clone().multiplyScalar(xt).add(Je)}const Ie=we.length,je=ft.length;function Me(Je,rt,xt){let un,Wt,ni;const Ln=Je.x-rt.x,En=Je.y-rt.y,Rr=xt.x-Je.x,hr=xt.y-Je.y,ne=Ln*Ln+En*En;if(Math.abs(Ln*hr-En*Rr)>Number.EPSILON){const Ge=Math.sqrt(ne),pt=Math.sqrt(Rr*Rr+hr*hr),qt=rt.x-En/Ge,Ct=rt.y+Ln/Ge,ri=((xt.x-hr/pt-qt)*hr-(xt.y+Rr/pt-Ct)*Rr)/(Ln*hr-En*Rr);un=qt+Ln*ri-Je.x,Wt=Ct+En*ri-Je.y;const bi=un*un+Wt*Wt;if(bi<=2)return new Qe(un,Wt);ni=Math.sqrt(bi/2)}else{let Ge=!1;Ln>Number.EPSILON?Rr>Number.EPSILON&&(Ge=!0):Ln<-Number.EPSILON?Rr<-Number.EPSILON&&(Ge=!0):Math.sign(En)===Math.sign(hr)&&(Ge=!0),Ge?(un=-En,Wt=Ln,ni=Math.sqrt(ne)):(un=Ln,Wt=En,ni=Math.sqrt(ne/2))}return new Qe(un/ni,Wt/ni)}const lt=[];for(let Je=0,rt=Ee.length,xt=rt-1,un=Je+1;Je<rt;Je++,xt++,un++)xt===rt&&(xt=0),un===rt&&(un=0),lt[Je]=Me(Ee[Je],Ee[xt],Ee[un]);const dt=[];let wt,mt=lt.concat();for(let Je=0,rt=X.length;Je<rt;Je++){const xt=X[Je];wt=[];for(let un=0,Wt=xt.length,ni=Wt-1,Ln=un+1;un<Wt;un++,ni++,Ln++)ni===Wt&&(ni=0),Ln===Wt&&(Ln=0),wt[un]=Me(xt[un],xt[ni],xt[Ln]);dt.push(wt),mt=mt.concat(wt)}for(let Je=0;Je<I;Je++){const rt=Je/I,xt=R*Math.cos(rt*Math.PI/2),un=L*Math.sin(rt*Math.PI/2)+P;for(let Wt=0,ni=Ee.length;Wt<ni;Wt++){const Ln=Be(Ee[Wt],lt[Wt],un);sr(Ln.x,Ln.y,-xt)}for(let Wt=0,ni=X.length;Wt<ni;Wt++){const Ln=X[Wt];wt=dt[Wt];for(let En=0,Rr=Ln.length;En<Rr;En++){const hr=Be(Ln[En],wt[En],un);sr(hr.x,hr.y,-xt)}}}const bn=L+P;for(let Je=0;Je<Ie;Je++){const rt=D?Be(we[Je],mt[Je],bn):we[Je];G?(fe.copy(Y.normals[0]).multiplyScalar(rt.x),le.copy(Y.binormals[0]).multiplyScalar(rt.y),ye.copy(j[0]).add(fe).add(le),sr(ye.x,ye.y,ye.z)):sr(rt.x,rt.y,0)}for(let Je=1;Je<=C;Je++)for(let rt=0;rt<Ie;rt++){const xt=D?Be(we[rt],mt[rt],bn):we[rt];G?(fe.copy(Y.normals[Je]).multiplyScalar(xt.x),le.copy(Y.binormals[Je]).multiplyScalar(xt.y),ye.copy(j[Je]).add(fe).add(le),sr(ye.x,ye.y,ye.z)):sr(xt.x,xt.y,A/C*Je)}for(let Je=I-1;Je>=0;Je--){const rt=Je/I,xt=R*Math.cos(rt*Math.PI/2),un=L*Math.sin(rt*Math.PI/2)+P;for(let Wt=0,ni=Ee.length;Wt<ni;Wt++){const Ln=Be(Ee[Wt],lt[Wt],un);sr(Ln.x,Ln.y,A+xt)}for(let Wt=0,ni=X.length;Wt<ni;Wt++){const Ln=X[Wt];wt=dt[Wt];for(let En=0,Rr=Ln.length;En<Rr;En++){const hr=Be(Ln[En],wt[En],un);G?sr(hr.x,hr.y+j[C-1].y,j[C-1].x+xt):sr(hr.x,hr.y,A+xt)}}}function Se(Je,rt){let xt=Je.length;for(;--xt>=0;){const un=xt;let Wt=xt-1;Wt<0&&(Wt=Je.length-1);for(let ni=0,Ln=C+2*I;ni<Ln;ni++){const En=Ie*ni,Rr=Ie*(ni+1);li(rt+un+En,rt+Wt+En,rt+Wt+Rr,rt+un+Rr)}}}function sr(Je,rt,xt){w.push(Je),w.push(rt),w.push(xt)}function ai(Je,rt,xt){Pt(Je),Pt(rt),Pt(xt);const un=h.length/3,Wt=B.generateTopUV(u,h,un-3,un-2,un-1);_i(Wt[0]),_i(Wt[1]),_i(Wt[2])}function li(Je,rt,xt,un){Pt(Je),Pt(rt),Pt(un),Pt(rt),Pt(xt),Pt(un);const Wt=h.length/3,ni=B.generateSideWallUV(u,h,Wt-6,Wt-3,Wt-2,Wt-1);_i(ni[0]),_i(ni[1]),_i(ni[3]),_i(ni[1]),_i(ni[2]),_i(ni[3])}function Pt(Je){h.push(w[3*Je+0]),h.push(w[3*Je+1]),h.push(w[3*Je+2])}function _i(Je){m.push(Je.x),m.push(Je.y)}(function yi(){const Je=h.length/3;if(D){let rt=0,xt=Ie*rt;for(let un=0;un<je;un++){const Wt=ft[un];ai(Wt[2]+xt,Wt[1]+xt,Wt[0]+xt)}rt=C+2*I,xt=Ie*rt;for(let un=0;un<je;un++){const Wt=ft[un];ai(Wt[0]+xt,Wt[1]+xt,Wt[2]+xt)}}else{for(let rt=0;rt<je;rt++){const xt=ft[rt];ai(xt[2],xt[1],xt[0])}for(let rt=0;rt<je;rt++){const xt=ft[rt];ai(xt[0]+Ie*C,xt[1]+Ie*C,xt[2]+Ie*C)}}u.addGroup(Je,h.length/3-Je,0)})(),function $n(){const Je=h.length/3;let rt=0;Se(Ee,rt),rt+=Ee.length;for(let xt=0,un=X.length;xt<un;xt++){const Wt=X[xt];Se(Wt,rt),rt+=Wt.length}u.addGroup(Je,h.length/3-Je,1)}()}this.setAttribute("position",new nn(h,3)),this.setAttribute("uv",new nn(m,2)),this.computeVertexNormals()}toJSON(){const s=super.toJSON();return function C0(f,s,a){if(a.shapes=[],Array.isArray(f))for(let u=0,h=f.length;u<h;u++)a.shapes.push(f[u].uuid);else a.shapes.push(f.uuid);return void 0!==s.extrudePath&&(a.options.extrudePath=s.extrudePath.toJSON()),a}(this.parameters.shapes,this.parameters.options,s)}static fromJSON(s,a){const u=[];for(let m=0,g=s.shapes.length;m<g;m++)u.push(a[s.shapes[m]]);const h=s.options.extrudePath;return void 0!==h&&(s.options.extrudePath=(new Jp[h.type]).fromJSON(h)),new yc(u,s.options)}}const F2={generateTopUV:function(f,s,a,u,h){const _=s[3*u],w=s[3*u+1],M=s[3*h],C=s[3*h+1];return[new Qe(s[3*a],s[3*a+1]),new Qe(_,w),new Qe(M,C)]},generateSideWallUV:function(f,s,a,u,h,m){const g=s[3*a],_=s[3*a+1],w=s[3*a+2],M=s[3*u],C=s[3*u+1],A=s[3*u+2],D=s[3*h],R=s[3*h+1],L=s[3*h+2],P=s[3*m],I=s[3*m+1],z=s[3*m+2];return Math.abs(_-C)<Math.abs(g-M)?[new Qe(g,1-w),new Qe(M,1-A),new Qe(D,1-L),new Qe(P,1-z)]:[new Qe(_,1-w),new Qe(C,1-A),new Qe(R,1-L),new Qe(I,1-z)]}};class rm extends Pl{constructor(s=1,a=0){const u=(1+Math.sqrt(5))/2;super([-1,u,0,1,u,0,-1,-u,0,1,-u,0,0,-1,u,0,1,u,0,-1,-u,0,1,-u,u,0,-1,u,0,1,-u,0,-1,-u,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],s,a),this.type="IcosahedronGeometry",this.parameters={radius:s,detail:a}}static fromJSON(s){return new rm(s.radius,s.detail)}}class mh extends Pl{constructor(s=1,a=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],s,a),this.type="OctahedronGeometry",this.parameters={radius:s,detail:a}}static fromJSON(s){return new mh(s.radius,s.detail)}}class gh extends en{constructor(s=.5,a=1,u=8,h=1,m=0,g=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:s,outerRadius:a,thetaSegments:u,phiSegments:h,thetaStart:m,thetaLength:g},u=Math.max(3,u);const _=[],w=[],M=[],C=[];let A=s;const D=(a-s)/(h=Math.max(1,h)),R=new J,L=new Qe;for(let P=0;P<=h;P++){for(let I=0;I<=u;I++){const z=m+I/u*g;R.x=A*Math.cos(z),R.y=A*Math.sin(z),w.push(R.x,R.y,R.z),M.push(0,0,1),L.x=(R.x/a+1)/2,L.y=(R.y/a+1)/2,C.push(L.x,L.y)}A+=D}for(let P=0;P<h;P++){const I=P*(u+1);for(let z=0;z<u;z++){const B=z+I,G=B+u+1,Y=B+u+2,le=B+1;_.push(B,G,le),_.push(G,Y,le)}}this.setIndex(_),this.setAttribute("position",new nn(w,3)),this.setAttribute("normal",new nn(M,3)),this.setAttribute("uv",new nn(C,2))}static fromJSON(s){return new gh(s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength)}}class Jc extends en{constructor(s=new gc([new Qe(0,.5),new Qe(-.5,-.5),new Qe(.5,-.5)]),a=12){super(),this.type="ShapeGeometry",this.parameters={shapes:s,curveSegments:a};const u=[],h=[],m=[],g=[];let _=0,w=0;if(!1===Array.isArray(s))M(s);else for(let C=0;C<s.length;C++)M(s[C]),this.addGroup(_,w,C),_+=w,w=0;function M(C){const A=h.length/3,D=C.extractPoints(a);let R=D.shape;const L=D.holes;!1===Fa.isClockWise(R)&&(R=R.reverse());for(let I=0,z=L.length;I<z;I++){const B=L[I];!0===Fa.isClockWise(B)&&(L[I]=B.reverse())}const P=Fa.triangulateShape(R,L);for(let I=0,z=L.length;I<z;I++)R=R.concat(L[I]);for(let I=0,z=R.length;I<z;I++){const B=R[I];h.push(B.x,B.y,0),m.push(0,0,1),g.push(B.x,B.y)}for(let I=0,z=P.length;I<z;I++){const B=P[I];u.push(B[0]+A,B[1]+A,B[2]+A),w+=3}}this.setIndex(u),this.setAttribute("position",new nn(h,3)),this.setAttribute("normal",new nn(m,3)),this.setAttribute("uv",new nn(g,2))}toJSON(){const s=super.toJSON();return function AM(f,s){if(s.shapes=[],Array.isArray(f))for(let a=0,u=f.length;a<u;a++)s.shapes.push(f[a].uuid);else s.shapes.push(f.uuid);return s}(this.parameters.shapes,s)}static fromJSON(s,a){const u=[];for(let h=0,m=s.shapes.length;h<m;h++)u.push(a[s.shapes[h]]);return new Jc(u,s.curveSegments)}}class Qc extends en{constructor(s=1,a=32,u=16,h=0,m=2*Math.PI,g=0,_=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:s,widthSegments:a,heightSegments:u,phiStart:h,phiLength:m,thetaStart:g,thetaLength:_},a=Math.max(3,Math.floor(a)),u=Math.max(2,Math.floor(u));const w=Math.min(g+_,Math.PI);let M=0;const C=[],A=new J,D=new J,R=[],L=[],P=[],I=[];for(let z=0;z<=u;z++){const B=[],j=z/u;let G=0;0==z&&0==g?G=.5/a:z==u&&w==Math.PI&&(G=-.5/a);for(let Y=0;Y<=a;Y++){const le=Y/a;A.x=-s*Math.cos(h+le*m)*Math.sin(g+j*_),A.y=s*Math.cos(g+j*_),A.z=s*Math.sin(h+le*m)*Math.sin(g+j*_),L.push(A.x,A.y,A.z),D.copy(A).normalize(),P.push(D.x,D.y,D.z),I.push(le+G,1-j),B.push(M++)}C.push(B)}for(let z=0;z<u;z++)for(let B=0;B<a;B++){const j=C[z][B+1],G=C[z][B],Y=C[z+1][B],le=C[z+1][B+1];(0!==z||g>0)&&R.push(j,G,le),(z!==u-1||w<Math.PI)&&R.push(G,Y,le)}this.setIndex(R),this.setAttribute("position",new nn(L,3)),this.setAttribute("normal",new nn(P,3)),this.setAttribute("uv",new nn(I,2))}static fromJSON(s){return new Qc(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength)}}class yh extends Pl{constructor(s=1,a=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],s,a),this.type="TetrahedronGeometry",this.parameters={radius:s,detail:a}}static fromJSON(s){return new yh(s.radius,s.detail)}}class Xo extends en{constructor(s=1,a=.4,u=8,h=6,m=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:s,tube:a,radialSegments:u,tubularSegments:h,arc:m},u=Math.floor(u),h=Math.floor(h);const g=[],_=[],w=[],M=[],C=new J,A=new J,D=new J;for(let R=0;R<=u;R++)for(let L=0;L<=h;L++){const P=L/h*m,I=R/u*Math.PI*2;A.x=(s+a*Math.cos(I))*Math.cos(P),A.y=(s+a*Math.cos(I))*Math.sin(P),A.z=a*Math.sin(I),_.push(A.x,A.y,A.z),C.x=s*Math.cos(P),C.y=s*Math.sin(P),D.subVectors(A,C).normalize(),w.push(D.x,D.y,D.z),M.push(L/h),M.push(R/u)}for(let R=1;R<=u;R++)for(let L=1;L<=h;L++){const I=(h+1)*(R-1)+L-1,z=(h+1)*(R-1)+L,B=(h+1)*R+L;g.push((h+1)*R+L-1,I,B),g.push(I,z,B)}this.setIndex(g),this.setAttribute("position",new nn(_,3)),this.setAttribute("normal",new nn(w,3)),this.setAttribute("uv",new nn(M,2))}static fromJSON(s){return new Xo(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc)}}class _c extends en{constructor(s=1,a=.4,u=64,h=8,m=2,g=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:s,tube:a,tubularSegments:u,radialSegments:h,p:m,q:g},u=Math.floor(u),h=Math.floor(h);const _=[],w=[],M=[],C=[],A=new J,D=new J,R=new J,L=new J,P=new J,I=new J,z=new J;for(let j=0;j<=u;++j){const G=j/u*m*Math.PI*2;B(G,m,g,s,R),B(G+.01,m,g,s,L),I.subVectors(L,R),z.addVectors(L,R),P.crossVectors(I,z),z.crossVectors(P,I),P.normalize(),z.normalize();for(let Y=0;Y<=h;++Y){const le=Y/h*Math.PI*2,fe=-a*Math.cos(le),ye=a*Math.sin(le);A.x=R.x+(fe*z.x+ye*P.x),A.y=R.y+(fe*z.y+ye*P.y),A.z=R.z+(fe*z.z+ye*P.z),w.push(A.x,A.y,A.z),D.subVectors(A,R).normalize(),M.push(D.x,D.y,D.z),C.push(j/u),C.push(Y/h)}}for(let j=1;j<=u;j++)for(let G=1;G<=h;G++){const le=(h+1)*j+(G-1),fe=(h+1)*j+G,ye=(h+1)*(j-1)+G;_.push((h+1)*(j-1)+(G-1),le,ye),_.push(le,fe,ye)}function B(j,G,Y,le,fe){const ye=Math.cos(j),Ve=Math.sin(j),we=Y/G*j,X=Math.cos(we);fe.x=le*(2+X)*.5*ye,fe.y=le*(2+X)*Ve*.5,fe.z=le*Math.sin(we)*.5}this.setIndex(_),this.setAttribute("position",new nn(w,3)),this.setAttribute("normal",new nn(M,3)),this.setAttribute("uv",new nn(C,2))}static fromJSON(s){return new _c(s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q)}}class Kd extends en{constructor(s=new Zp(new J(-1,-1,0),new J(-1,1,0),new J(1,1,0)),a=64,u=1,h=8,m=!1){super(),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:a,radius:u,radialSegments:h,closed:m};const g=s.computeFrenetFrames(a,m);this.tangents=g.tangents,this.normals=g.normals,this.binormals=g.binormals;const _=new J,w=new J,M=new Qe;let C=new J;const A=[],D=[],R=[],L=[];function I(j){C=s.getPointAt(j/a,C);const G=g.normals[j],Y=g.binormals[j];for(let le=0;le<=h;le++){const fe=le/h*Math.PI*2,ye=Math.sin(fe),Ve=-Math.cos(fe);w.x=Ve*G.x+ye*Y.x,w.y=Ve*G.y+ye*Y.y,w.z=Ve*G.z+ye*Y.z,w.normalize(),D.push(w.x,w.y,w.z),_.x=C.x+u*w.x,_.y=C.y+u*w.y,_.z=C.z+u*w.z,A.push(_.x,_.y,_.z)}}(function P(){for(let j=0;j<a;j++)I(j);I(!1===m?a:0),function B(){for(let j=0;j<=a;j++)for(let G=0;G<=h;G++)M.x=j/a,M.y=G/h,R.push(M.x,M.y)}(),function z(){for(let j=1;j<=a;j++)for(let G=1;G<=h;G++){const le=(h+1)*j+(G-1),fe=(h+1)*j+G,ye=(h+1)*(j-1)+G;L.push((h+1)*(j-1)+(G-1),le,ye),L.push(le,fe,ye)}}()})(),this.setIndex(L),this.setAttribute("position",new nn(A,3)),this.setAttribute("normal",new nn(D,3)),this.setAttribute("uv",new nn(R,2))}toJSON(){const s=super.toJSON();return s.path=this.parameters.path.toJSON(),s}static fromJSON(s){return new Kd((new Jp[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed)}}class T0 extends en{constructor(s=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:s},null!==s){const a=[],u=new Set,h=new J,m=new J;if(null!==s.index){const g=s.attributes.position,_=s.index;let w=s.groups;0===w.length&&(w=[{start:0,count:_.count,materialIndex:0}]);for(let M=0,C=w.length;M<C;++M){const A=w[M],D=A.start;for(let L=D,P=D+A.count;L<P;L+=3)for(let I=0;I<3;I++){const z=_.getX(L+I),B=_.getX(L+(I+1)%3);h.fromBufferAttribute(g,z),m.fromBufferAttribute(g,B),!0===k1(h,m,u)&&(a.push(h.x,h.y,h.z),a.push(m.x,m.y,m.z))}}}else{const g=s.attributes.position;for(let _=0,w=g.count/3;_<w;_++)for(let M=0;M<3;M++){const A=3*_+(M+1)%3;h.fromBufferAttribute(g,3*_+M),m.fromBufferAttribute(g,A),!0===k1(h,m,u)&&(a.push(h.x,h.y,h.z),a.push(m.x,m.y,m.z))}}this.setAttribute("position",new nn(a,3))}}}function k1(f,s,a){const u=`${f.x},${f.y},${f.z}-${s.x},${s.y},${s.z}`,h=`${s.x},${s.y},${s.z}-${f.x},${f.y},${f.z}`;return!0!==a.has(u)&&!0!==a.has(h)&&(a.add(u),a.add(h),!0)}var fy=Object.freeze({__proto__:null,BoxGeometry:oc,BoxBufferGeometry:oc,CapsuleGeometry:hh,CapsuleBufferGeometry:hh,CircleGeometry:Qp,CircleBufferGeometry:Qp,ConeGeometry:dh,ConeBufferGeometry:dh,CylinderGeometry:mc,CylinderBufferGeometry:mc,DodecahedronGeometry:fh,DodecahedronBufferGeometry:fh,EdgesGeometry:x0,ExtrudeGeometry:yc,ExtrudeBufferGeometry:yc,IcosahedronGeometry:rm,IcosahedronBufferGeometry:rm,LatheGeometry:uh,LatheBufferGeometry:uh,OctahedronGeometry:mh,OctahedronBufferGeometry:mh,PlaneGeometry:Ku,PlaneBufferGeometry:Ku,PolyhedronGeometry:Pl,PolyhedronBufferGeometry:Pl,RingGeometry:gh,RingBufferGeometry:gh,ShapeGeometry:Jc,ShapeBufferGeometry:Jc,SphereGeometry:Qc,SphereBufferGeometry:Qc,TetrahedronGeometry:yh,TetrahedronBufferGeometry:yh,TorusGeometry:Xo,TorusBufferGeometry:Xo,TorusKnotGeometry:_c,TorusKnotBufferGeometry:_c,TubeGeometry:Kd,TubeBufferGeometry:Kd,WireframeGeometry:T0});class py extends Qt{constructor(s){super(),this.type="ShadowMaterial",this.color=new Dt(0),this.transparent=!0,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this}}py.prototype.isShadowMaterial=!0;class sm extends Ra{constructor(s){super(s),this.type="RawShaderMaterial"}}sm.prototype.isRawShaderMaterial=!0;class eu extends Qt{constructor(s){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Dt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(s)}copy(s){return super.copy(s),this.defines={STANDARD:""},this.color.copy(s.color),this.roughness=s.roughness,this.metalness=s.metalness,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.roughnessMap=s.roughnessMap,this.metalnessMap=s.metalnessMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.envMapIntensity=s.envMapIntensity,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this}}eu.prototype.isMeshStandardMaterial=!0;class A0 extends eu{constructor(s){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return as(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(a){this.ior=(1+.4*a)/(1-.4*a)}}),this.sheenColor=new Dt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Dt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Dt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(s)}get sheen(){return this._sheen}set sheen(s){this._sheen>0!=s>0&&this.version++,this._sheen=s}get clearcoat(){return this._clearcoat}set clearcoat(s){this._clearcoat>0!=s>0&&this.version++,this._clearcoat=s}get transmission(){return this._transmission}set transmission(s){this._transmission>0!=s>0&&this.version++,this._transmission=s}copy(s){return super.copy(s),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=s.clearcoat,this.clearcoatMap=s.clearcoatMap,this.clearcoatRoughness=s.clearcoatRoughness,this.clearcoatRoughnessMap=s.clearcoatRoughnessMap,this.clearcoatNormalMap=s.clearcoatNormalMap,this.clearcoatNormalScale.copy(s.clearcoatNormalScale),this.ior=s.ior,this.sheen=s.sheen,this.sheenColor.copy(s.sheenColor),this.sheenColorMap=s.sheenColorMap,this.sheenRoughness=s.sheenRoughness,this.sheenRoughnessMap=s.sheenRoughnessMap,this.transmission=s.transmission,this.transmissionMap=s.transmissionMap,this.thickness=s.thickness,this.thicknessMap=s.thicknessMap,this.attenuationDistance=s.attenuationDistance,this.attenuationColor.copy(s.attenuationColor),this.specularIntensity=s.specularIntensity,this.specularIntensityMap=s.specularIntensityMap,this.specularColor.copy(s.specularColor),this.specularColorMap=s.specularColorMap,this}}A0.prototype.isMeshPhysicalMaterial=!0;class om extends Qt{constructor(s){super(),this.type="MeshPhongMaterial",this.color=new Dt(16777215),this.specular=new Dt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.specular.copy(s.specular),this.shininess=s.shininess,this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this.flatShading=s.flatShading,this}}om.prototype.isMeshPhongMaterial=!0;class my extends Qt{constructor(s){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Dt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.gradientMap=s.gradientMap,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.alphaMap=s.alphaMap,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this}}my.prototype.isMeshToonMaterial=!0;class gy extends Qt{constructor(s){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(s)}copy(s){return super.copy(s),this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.flatShading=s.flatShading,this}}gy.prototype.isMeshNormalMaterial=!0;class yy extends Qt{constructor(s){super(),this.type="MeshLambertMaterial",this.color=new Dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(s)}copy(s){return super.copy(s),this.color.copy(s.color),this.map=s.map,this.lightMap=s.lightMap,this.lightMapIntensity=s.lightMapIntensity,this.aoMap=s.aoMap,this.aoMapIntensity=s.aoMapIntensity,this.emissive.copy(s.emissive),this.emissiveMap=s.emissiveMap,this.emissiveIntensity=s.emissiveIntensity,this.specularMap=s.specularMap,this.alphaMap=s.alphaMap,this.envMap=s.envMap,this.combine=s.combine,this.reflectivity=s.reflectivity,this.refractionRatio=s.refractionRatio,this.wireframe=s.wireframe,this.wireframeLinewidth=s.wireframeLinewidth,this.wireframeLinecap=s.wireframeLinecap,this.wireframeLinejoin=s.wireframeLinejoin,this}}yy.prototype.isMeshLambertMaterial=!0;class D0 extends Qt{constructor(s){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Dt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(s)}copy(s){return super.copy(s),this.defines={MATCAP:""},this.color.copy(s.color),this.matcap=s.matcap,this.map=s.map,this.bumpMap=s.bumpMap,this.bumpScale=s.bumpScale,this.normalMap=s.normalMap,this.normalMapType=s.normalMapType,this.normalScale.copy(s.normalScale),this.displacementMap=s.displacementMap,this.displacementScale=s.displacementScale,this.displacementBias=s.displacementBias,this.alphaMap=s.alphaMap,this.flatShading=s.flatShading,this}}D0.prototype.isMeshMatcapMaterial=!0;class am extends Bs{constructor(s){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(s)}copy(s){return super.copy(s),this.scale=s.scale,this.dashSize=s.dashSize,this.gapSize=s.gapSize,this}}am.prototype.isLineDashedMaterial=!0;const B1={ShadowMaterial:py,SpriteMaterial:Up,RawShaderMaterial:sm,ShaderMaterial:Ra,PointsMaterial:dc,MeshPhysicalMaterial:A0,MeshStandardMaterial:eu,MeshPhongMaterial:om,MeshToonMaterial:my,MeshNormalMaterial:gy,MeshLambertMaterial:yy,MeshDepthMaterial:ih,MeshDistanceMaterial:Jg,MeshBasicMaterial:bl,MeshMatcapMaterial:D0,LineDashedMaterial:am,LineBasicMaterial:Bs,Material:Qt};Qt.fromType=function(f){return new B1[f]};const Er={arraySlice:function(f,s,a){return Er.isTypedArray(f)?new f.constructor(f.subarray(s,void 0!==a?a:f.length)):f.slice(s,a)},convertArray:function(f,s,a){return!f||!a&&f.constructor===s?f:"number"==typeof s.BYTES_PER_ELEMENT?new s(f):Array.prototype.slice.call(f)},isTypedArray:function(f){return ArrayBuffer.isView(f)&&!(f instanceof DataView)},getKeyframeOrder:function(f){const a=f.length,u=new Array(a);for(let h=0;h!==a;++h)u[h]=h;return u.sort(function s(h,m){return f[h]-f[m]}),u},sortedArray:function(f,s,a){const u=f.length,h=new f.constructor(u);for(let m=0,g=0;g!==u;++m){const _=a[m]*s;for(let w=0;w!==s;++w)h[g++]=f[_+w]}return h},flattenJSON:function(f,s,a,u){let h=1,m=f[0];for(;void 0!==m&&void 0===m[u];)m=f[h++];if(void 0===m)return;let g=m[u];if(void 0!==g)if(Array.isArray(g))do{g=m[u],void 0!==g&&(s.push(m.time),a.push.apply(a,g)),m=f[h++]}while(void 0!==m);else if(void 0!==g.toArray)do{g=m[u],void 0!==g&&(s.push(m.time),g.toArray(a,a.length)),m=f[h++]}while(void 0!==m);else do{g=m[u],void 0!==g&&(s.push(m.time),a.push(g)),m=f[h++]}while(void 0!==m)},subclip:function(f,s,a,u,h=30){const m=f.clone();m.name=s;const g=[];for(let w=0;w<m.tracks.length;++w){const M=m.tracks[w],C=M.getValueSize(),A=[],D=[];for(let R=0;R<M.times.length;++R){const L=M.times[R]*h;if(!(L<a||L>=u)){A.push(M.times[R]);for(let P=0;P<C;++P)D.push(M.values[R*C+P])}}0!==A.length&&(M.times=Er.convertArray(A,M.times.constructor),M.values=Er.convertArray(D,M.values.constructor),g.push(M))}m.tracks=g;let _=1/0;for(let w=0;w<m.tracks.length;++w)_>m.tracks[w].times[0]&&(_=m.tracks[w].times[0]);for(let w=0;w<m.tracks.length;++w)m.tracks[w].shift(-1*_);return m.resetDuration(),m},makeClipAdditive:function(f,s=0,a=f,u=30){u<=0&&(u=30);const h=a.tracks.length,m=s/u;for(let g=0;g<h;++g){const _=a.tracks[g],w=_.ValueTypeName;if("bool"===w||"string"===w)continue;const M=f.tracks.find(function(z){return z.name===_.name&&z.ValueTypeName===w});if(void 0===M)continue;let C=0;const A=_.getValueSize();_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(C=A/3);let D=0;const R=M.getValueSize();M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(D=R/3);const L=_.times.length-1;let P;if(m<=_.times[0])P=Er.arraySlice(_.values,C,A-C);else if(m>=_.times[L]){const z=L*A+C;P=Er.arraySlice(_.values,z,z+A-C)}else{const z=_.createInterpolant(),B=C,j=A-C;z.evaluate(m),P=Er.arraySlice(z.resultBuffer,B,j)}"quaternion"===w&&(new no).fromArray(P).normalize().conjugate().toArray(P);const I=M.times.length;for(let z=0;z<I;++z){const B=z*R+D;if("quaternion"===w)no.multiplyQuaternionsFlat(M.values,B,P,0,M.values,B);else{const j=R-2*D;for(let G=0;G<j;++G)M.values[B+G]-=P[G]}}}return f.blendMode=2501,f}};class Il{constructor(s,a,u,h){this.parameterPositions=s,this._cachedIndex=0,this.resultBuffer=void 0!==h?h:new a.constructor(u),this.sampleValues=a,this.valueSize=u,this.settings=null,this.DefaultSettings_={}}evaluate(s){const a=this.parameterPositions;let u=this._cachedIndex,h=a[u],m=a[u-1];e:{t:{let g;n:{i:if(!(s<h)){for(let _=u+2;;){if(void 0===h){if(s<m)break i;return u=a.length,this._cachedIndex=u,this.afterEnd_(u-1,s,m)}if(u===_)break;if(m=h,h=a[++u],s<h)break t}g=a.length;break n}if(s>=m)break e;{const _=a[1];s<_&&(u=2,m=_);for(let w=u-2;;){if(void 0===m)return this._cachedIndex=0,this.beforeStart_(0,s,h);if(u===w)break;if(h=m,m=a[--u-1],s>=m)break t}g=u,u=0}}for(;u<g;){const _=u+g>>>1;s<a[_]?g=_:u=_+1}if(h=a[u],m=a[u-1],void 0===m)return this._cachedIndex=0,this.beforeStart_(0,s,h);if(void 0===h)return u=a.length,this._cachedIndex=u,this.afterEnd_(u-1,m,s)}this._cachedIndex=u,this.intervalChanged_(u,m,h)}return this.interpolate_(u,m,s,h)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(s){const a=this.resultBuffer,u=this.sampleValues,h=this.valueSize,m=s*h;for(let g=0;g!==h;++g)a[g]=u[m+g];return a}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Il.prototype.beforeStart_=Il.prototype.copySampleValue_,Il.prototype.afterEnd_=Il.prototype.copySampleValue_;class _h extends Il{constructor(s,a,u,h){super(s,a,u,h),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Uu,endingEnd:Uu}}intervalChanged_(s,a,u){const h=this.parameterPositions;let m=s-2,g=s+1,_=h[m],w=h[g];if(void 0===_)switch(this.getSettings_().endingStart){case cd:m=s,_=2*a-u;break;case bg:m=h.length-2,_=a+h[m]-h[m+1];break;default:m=s,_=u}if(void 0===w)switch(this.getSettings_().endingEnd){case cd:g=s,w=2*u-a;break;case bg:g=1,w=u+h[1]-h[0];break;default:g=s-1,w=a}const M=.5*(u-a),C=this.valueSize;this._weightPrev=M/(a-_),this._weightNext=M/(w-u),this._offsetPrev=m*C,this._offsetNext=g*C}interpolate_(s,a,u,h){const m=this.resultBuffer,g=this.sampleValues,_=this.valueSize,w=s*_,M=w-_,C=this._offsetPrev,A=this._offsetNext,D=this._weightPrev,R=this._weightNext,L=(u-a)/(h-a),P=L*L,I=P*L,z=-D*I+2*D*P-D*L,B=(1+D)*I+(-1.5-2*D)*P+(-.5+D)*L+1,j=(-1-R)*I+(1.5+R)*P+.5*L,G=R*I-R*P;for(let Y=0;Y!==_;++Y)m[Y]=z*g[C+Y]+B*g[M+Y]+j*g[w+Y]+G*g[A+Y];return m}}class _y extends Il{constructor(s,a,u,h){super(s,a,u,h)}interpolate_(s,a,u,h){const m=this.resultBuffer,g=this.sampleValues,_=this.valueSize,w=s*_,M=w-_,C=(u-a)/(h-a),A=1-C;for(let D=0;D!==_;++D)m[D]=g[M+D]*A+g[w+D]*C;return m}}class DM extends Il{constructor(s,a,u,h){super(s,a,u,h)}interpolate_(s){return this.copySampleValue_(s-1)}}class nl{constructor(s,a,u,h){if(void 0===s)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===a||0===a.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+s);this.name=s,this.times=Er.convertArray(a,this.TimeBufferType),this.values=Er.convertArray(u,this.ValueBufferType),this.setInterpolation(h||this.DefaultInterpolation)}static toJSON(s){const a=s.constructor;let u;if(a.toJSON!==this.toJSON)u=a.toJSON(s);else{u={name:s.name,times:Er.convertArray(s.times,Array),values:Er.convertArray(s.values,Array)};const h=s.getInterpolation();h!==s.DefaultInterpolation&&(u.interpolation=h)}return u.type=s.ValueTypeName,u}InterpolantFactoryMethodDiscrete(s){return new DM(this.times,this.values,this.getValueSize(),s)}InterpolantFactoryMethodLinear(s){return new _y(this.times,this.values,this.getValueSize(),s)}InterpolantFactoryMethodSmooth(s){return new _h(this.times,this.values,this.getValueSize(),s)}setInterpolation(s){let a;switch(s){case Bu:a=this.InterpolantFactoryMethodDiscrete;break;case In:a=this.InterpolantFactoryMethodLinear;break;case 2302:a=this.InterpolantFactoryMethodSmooth}if(void 0===a){const u="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(s===this.DefaultInterpolation)throw new Error(u);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",u),this}return this.createInterpolant=a,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bu;case this.InterpolantFactoryMethodLinear:return In;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(s){if(0!==s){const a=this.times;for(let u=0,h=a.length;u!==h;++u)a[u]+=s}return this}scale(s){if(1!==s){const a=this.times;for(let u=0,h=a.length;u!==h;++u)a[u]*=s}return this}trim(s,a){const u=this.times,h=u.length;let m=0,g=h-1;for(;m!==h&&u[m]<s;)++m;for(;-1!==g&&u[g]>a;)--g;if(++g,0!==m||g!==h){m>=g&&(g=Math.max(g,1),m=g-1);const _=this.getValueSize();this.times=Er.arraySlice(u,m,g),this.values=Er.arraySlice(this.values,m*_,g*_)}return this}validate(){let s=!0;const a=this.getValueSize();a-Math.floor(a)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),s=!1);const u=this.times,h=this.values,m=u.length;0===m&&(console.error("THREE.KeyframeTrack: Track is empty.",this),s=!1);let g=null;for(let _=0;_!==m;_++){const w=u[_];if("number"==typeof w&&isNaN(w)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,_,w),s=!1;break}if(null!==g&&g>w){console.error("THREE.KeyframeTrack: Out of order keys.",this,_,w,g),s=!1;break}g=w}if(void 0!==h&&Er.isTypedArray(h))for(let _=0,w=h.length;_!==w;++_){const M=h[_];if(isNaN(M)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,_,M),s=!1;break}}return s}optimize(){const s=Er.arraySlice(this.times),a=Er.arraySlice(this.values),u=this.getValueSize(),h=2302===this.getInterpolation(),m=s.length-1;let g=1;for(let _=1;_<m;++_){let w=!1;const M=s[_];if(M!==s[_+1]&&(1!==_||M!==s[0]))if(h)w=!0;else{const A=_*u,D=A-u,R=A+u;for(let L=0;L!==u;++L){const P=a[A+L];if(P!==a[D+L]||P!==a[R+L]){w=!0;break}}}if(w){if(_!==g){s[g]=s[_];const A=_*u,D=g*u;for(let R=0;R!==u;++R)a[D+R]=a[A+R]}++g}}if(m>0){s[g]=s[m];for(let _=m*u,w=g*u,M=0;M!==u;++M)a[w+M]=a[_+M];++g}return g!==s.length?(this.times=Er.arraySlice(s,0,g),this.values=Er.arraySlice(a,0,g*u)):(this.times=s,this.values=a),this}clone(){const s=Er.arraySlice(this.times,0),a=Er.arraySlice(this.values,0),h=new(0,this.constructor)(this.name,s,a);return h.createInterpolant=this.createInterpolant,h}}nl.prototype.TimeBufferType=Float32Array,nl.prototype.ValueBufferType=Float32Array,nl.prototype.DefaultInterpolation=In;class Na extends nl{}Na.prototype.ValueTypeName="bool",Na.prototype.ValueBufferType=Array,Na.prototype.DefaultInterpolation=Bu,Na.prototype.InterpolantFactoryMethodLinear=void 0,Na.prototype.InterpolantFactoryMethodSmooth=void 0;class R0 extends nl{}R0.prototype.ValueTypeName="color";class lm extends nl{}lm.prototype.ValueTypeName="number";class RM extends Il{constructor(s,a,u,h){super(s,a,u,h)}interpolate_(s,a,u,h){const m=this.resultBuffer,g=this.sampleValues,_=this.valueSize,w=(u-a)/(h-a);let M=s*_;for(let C=M+_;M!==C;M+=4)no.slerpFlat(m,0,g,M-_,g,M,w);return m}}class Zd extends nl{InterpolantFactoryMethodLinear(s){return new RM(this.times,this.values,this.getValueSize(),s)}}Zd.prototype.ValueTypeName="quaternion",Zd.prototype.DefaultInterpolation=In,Zd.prototype.InterpolantFactoryMethodSmooth=void 0;class Cr extends nl{}Cr.prototype.ValueTypeName="string",Cr.prototype.ValueBufferType=Array,Cr.prototype.DefaultInterpolation=Bu,Cr.prototype.InterpolantFactoryMethodLinear=void 0,Cr.prototype.InterpolantFactoryMethodSmooth=void 0;class vh extends nl{}vh.prototype.ValueTypeName="vector";class Jd{constructor(s,a=-1,u,h=2500){this.name=s,this.tracks=u,this.duration=a,this.blendMode=h,this.uuid=wa(),this.duration<0&&this.resetDuration()}static parse(s){const a=[],u=s.tracks,h=1/(s.fps||1);for(let g=0,_=u.length;g!==_;++g)a.push(IM(u[g]).scale(h));const m=new this(s.name,s.duration,a,s.blendMode);return m.uuid=s.uuid,m}static toJSON(s){const a=[],u=s.tracks,h={name:s.name,duration:s.duration,tracks:a,uuid:s.uuid,blendMode:s.blendMode};for(let m=0,g=u.length;m!==g;++m)a.push(nl.toJSON(u[m]));return h}static CreateFromMorphTargetSequence(s,a,u,h){const m=a.length,g=[];for(let _=0;_<m;_++){let w=[],M=[];w.push((_+m-1)%m,_,(_+1)%m),M.push(0,1,0);const C=Er.getKeyframeOrder(w);w=Er.sortedArray(w,1,C),M=Er.sortedArray(M,1,C),!h&&0===w[0]&&(w.push(m),M.push(M[0])),g.push(new lm(".morphTargetInfluences["+a[_].name+"]",w,M).scale(1/u))}return new this(s,-1,g)}static findByName(s,a){let u=s;if(!Array.isArray(s)){const h=s;u=h.geometry&&h.geometry.animations||h.animations}for(let h=0;h<u.length;h++)if(u[h].name===a)return u[h];return null}static CreateClipsFromMorphTargetSequences(s,a,u){const h={},m=/^([\w-]*?)([\d]+)$/;for(let _=0,w=s.length;_<w;_++){const M=s[_],C=M.name.match(m);if(C&&C.length>1){const A=C[1];let D=h[A];D||(h[A]=D=[]),D.push(M)}}const g=[];for(const _ in h)g.push(this.CreateFromMorphTargetSequence(_,h[_],a,u));return g}static parseAnimation(s,a){if(!s)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const u=function(A,D,R,L,P){if(0!==R.length){const I=[],z=[];Er.flattenJSON(R,I,z,L),0!==I.length&&P.push(new A(D,I,z))}},h=[],m=s.name||"default",g=s.fps||30,_=s.blendMode;let w=s.length||-1;const M=s.hierarchy||[];for(let A=0;A<M.length;A++){const D=M[A].keys;if(D&&0!==D.length)if(D[0].morphTargets){const R={};let L;for(L=0;L<D.length;L++)if(D[L].morphTargets)for(let P=0;P<D[L].morphTargets.length;P++)R[D[L].morphTargets[P]]=-1;for(const P in R){const I=[],z=[];for(let B=0;B!==D[L].morphTargets.length;++B){const j=D[L];I.push(j.time),z.push(j.morphTarget===P?1:0)}h.push(new lm(".morphTargetInfluence["+P+"]",I,z))}w=R.length*g}else{const R=".bones["+a[A].name+"]";u(vh,R+".position",D,"pos",h),u(Zd,R+".quaternion",D,"rot",h),u(vh,R+".scale",D,"scl",h)}}return 0===h.length?null:new this(m,w,h,_)}resetDuration(){let a=0;for(let u=0,h=this.tracks.length;u!==h;++u){const m=this.tracks[u];a=Math.max(a,m.times[m.times.length-1])}return this.duration=a,this}trim(){for(let s=0;s<this.tracks.length;s++)this.tracks[s].trim(0,this.duration);return this}validate(){let s=!0;for(let a=0;a<this.tracks.length;a++)s=s&&this.tracks[a].validate();return s}optimize(){for(let s=0;s<this.tracks.length;s++)this.tracks[s].optimize();return this}clone(){const s=[];for(let a=0;a<this.tracks.length;a++)s.push(this.tracks[a].clone());return new this.constructor(this.name,this.duration,s,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function IM(f){if(void 0===f.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const s=function PM(f){switch(f.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return lm;case"vector":case"vector2":case"vector3":case"vector4":return vh;case"color":return R0;case"quaternion":return Zd;case"bool":case"boolean":return Na;case"string":return Cr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+f)}(f.type);if(void 0===f.times){const a=[],u=[];Er.flattenJSON(f.keys,a,u,"value"),f.times=a,f.values=u}return void 0!==s.parse?s.parse(f):new s(f.name,f.times,f.values,f.interpolation)}const tu={enabled:!1,files:{},add:function(f,s){!1!==this.enabled&&(this.files[f]=s)},get:function(f){if(!1!==this.enabled)return this.files[f]},remove:function(f){delete this.files[f]},clear:function(){this.files={}}};class P0{constructor(s,a,u){const h=this;let w,m=!1,g=0,_=0;const M=[];this.onStart=void 0,this.onLoad=s,this.onProgress=a,this.onError=u,this.itemStart=function(C){_++,!1===m&&void 0!==h.onStart&&h.onStart(C,g,_),m=!0},this.itemEnd=function(C){g++,void 0!==h.onProgress&&h.onProgress(C,g,_),g===_&&(m=!1,void 0!==h.onLoad&&h.onLoad())},this.itemError=function(C){void 0!==h.onError&&h.onError(C)},this.resolveURL=function(C){return w?w(C):C},this.setURLModifier=function(C){return w=C,this},this.addHandler=function(C,A){return M.push(C,A),this},this.removeHandler=function(C){const A=M.indexOf(C);return-1!==A&&M.splice(A,2),this},this.getHandler=function(C){for(let A=0,D=M.length;A<D;A+=2){const R=M[A],L=M[A+1];if(R.global&&(R.lastIndex=0),R.test(C))return L}return null}}}const LM=new P0;class No{constructor(s){this.manager=void 0!==s?s:LM,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(s,a){const u=this;return new Promise(function(h,m){u.load(s,h,a,m)})}parse(){}setCrossOrigin(s){return this.crossOrigin=s,this}setWithCredentials(s){return this.withCredentials=s,this}setPath(s){return this.path=s,this}setResourcePath(s){return this.resourcePath=s,this}setRequestHeader(s){return this.requestHeader=s,this}}const vc={};class il extends No{constructor(s){super(s)}load(s,a,u,h){void 0===s&&(s=""),void 0!==this.path&&(s=this.path+s),s=this.manager.resolveURL(s);const m=tu.get(s);if(void 0!==m)return this.manager.itemStart(s),setTimeout(()=>{a&&a(m),this.manager.itemEnd(s)},0),m;if(void 0!==vc[s])return void vc[s].push({onLoad:a,onProgress:u,onError:h});vc[s]=[],vc[s].push({onLoad:a,onProgress:u,onError:h});const g=new Request(s,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),_=this.mimeType,w=this.responseType;fetch(g).then(M=>{if(200===M.status||0===M.status){if(0===M.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===M.body||void 0===M.body.getReader)return M;const C=vc[s],A=M.body.getReader(),D=M.headers.get("Content-Length"),R=D?parseInt(D):0,L=0!==R;let P=0;const I=new ReadableStream({start(z){!function B(){A.read().then(({done:j,value:G})=>{if(j)z.close();else{P+=G.byteLength;const Y=new ProgressEvent("progress",{lengthComputable:L,loaded:P,total:R});for(let le=0,fe=C.length;le<fe;le++){const ye=C[le];ye.onProgress&&ye.onProgress(Y)}z.enqueue(G),B()}})}()}});return new Response(I)}throw Error(`fetch for "${M.url}" responded with ${M.status}: ${M.statusText}`)}).then(M=>{switch(w){case"arraybuffer":return M.arrayBuffer();case"blob":return M.blob();case"document":return M.text().then(C=>(new DOMParser).parseFromString(C,_));case"json":return M.json();default:if(void 0===_)return M.text();{const A=/charset="?([^;"\s]*)"?/i.exec(_),D=A&&A[1]?A[1].toLowerCase():void 0,R=new TextDecoder(D);return M.arrayBuffer().then(L=>R.decode(L))}}}).then(M=>{tu.add(s,M);const C=vc[s];delete vc[s];for(let A=0,D=C.length;A<D;A++){const R=C[A];R.onLoad&&R.onLoad(M)}}).catch(M=>{const C=vc[s];if(void 0===C)throw this.manager.itemError(s),M;delete vc[s];for(let A=0,D=C.length;A<D;A++){const R=C[A];R.onError&&R.onError(M)}this.manager.itemError(s)}).finally(()=>{this.manager.itemEnd(s)}),this.manager.itemStart(s)}setResponseType(s){return this.responseType=s,this}setMimeType(s){return this.mimeType=s,this}}class cm extends No{constructor(s){super(s)}load(s,a,u,h){void 0!==this.path&&(s=this.path+s),s=this.manager.resolveURL(s);const m=this,g=tu.get(s);if(void 0!==g)return m.manager.itemStart(s),setTimeout(function(){a&&a(g),m.manager.itemEnd(s)},0),g;const _=Gc("img");function w(){C(),tu.add(s,this),a&&a(this),m.manager.itemEnd(s)}function M(A){C(),h&&h(A),m.manager.itemError(s),m.manager.itemEnd(s)}function C(){_.removeEventListener("load",w,!1),_.removeEventListener("error",M,!1)}return _.addEventListener("load",w,!1),_.addEventListener("error",M,!1),"data:"!==s.slice(0,5)&&void 0!==this.crossOrigin&&(_.crossOrigin=this.crossOrigin),m.manager.itemStart(s),_.src=s,_}}class NM extends No{constructor(s){super(s)}load(s,a,u,h){const m=new lc,g=new cm(this.manager);g.setCrossOrigin(this.crossOrigin),g.setPath(this.path);let _=0;function w(M){g.load(s[M],function(C){m.images[M]=C,_++,6===_&&(m.needsUpdate=!0,a&&a(m))},void 0,h)}for(let M=0;M<s.length;++M)w(M);return m}}class U1 extends No{constructor(s){super(s)}load(s,a,u,h){const m=this,g=new uc,_=new il(this.manager);return _.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(m.withCredentials),_.load(s,function(w){const M=m.parse(w);!M||(void 0!==M.image?g.image=M.image:void 0!==M.data&&(g.image.width=M.width,g.image.height=M.height,g.image.data=M.data),g.wrapS=void 0!==M.wrapS?M.wrapS:_s,g.wrapT=void 0!==M.wrapT?M.wrapT:_s,g.magFilter=void 0!==M.magFilter?M.magFilter:Hr,g.minFilter=void 0!==M.minFilter?M.minFilter:Hr,g.anisotropy=void 0!==M.anisotropy?M.anisotropy:1,void 0!==M.encoding&&(g.encoding=M.encoding),void 0!==M.flipY&&(g.flipY=M.flipY),void 0!==M.format&&(g.format=M.format),void 0!==M.type&&(g.type=M.type),void 0!==M.mipmaps&&(g.mipmaps=M.mipmaps,g.minFilter=Ya),1===M.mipmapCount&&(g.minFilter=Hr),void 0!==M.generateMipmaps&&(g.generateMipmaps=M.generateMipmaps),g.needsUpdate=!0,a&&a(g,M))},u,h),g}}class V1 extends No{constructor(s){super(s)}load(s,a,u,h){const m=new ls,g=new cm(this.manager);return g.setCrossOrigin(this.crossOrigin),g.setPath(this.path),g.load(s,function(_){m.image=_,m.needsUpdate=!0,void 0!==a&&a(m)},u,h),m}}class ha extends Ci{constructor(s,a=1){super(),this.type="Light",this.color=new Dt(s),this.intensity=a}dispose(){}copy(s){return super.copy(s),this.color.copy(s.color),this.intensity=s.intensity,this}toJSON(s){const a=super.toJSON(s);return a.object.color=this.color.getHex(),a.object.intensity=this.intensity,void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(a.object.distance=this.distance),void 0!==this.angle&&(a.object.angle=this.angle),void 0!==this.decay&&(a.object.decay=this.decay),void 0!==this.penumbra&&(a.object.penumbra=this.penumbra),void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON()),a}}ha.prototype.isLight=!0;class I0 extends ha{constructor(s,a,u){super(s,u),this.type="HemisphereLight",this.position.copy(Ci.DefaultUp),this.updateMatrix(),this.groundColor=new Dt(a)}copy(s){return ha.prototype.copy.call(this,s),this.groundColor.copy(s.groundColor),this}}I0.prototype.isHemisphereLight=!0;const L0=new cn,F0=new J,z1=new J;class da{constructor(s){this.camera=s,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Qe(512,512),this.map=null,this.mapPass=null,this.matrix=new cn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new yp,this._frameExtents=new Qe(1,1),this._viewportCount=1,this._viewports=[new Xi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(s){const a=this.camera,u=this.matrix;F0.setFromMatrixPosition(s.matrixWorld),a.position.copy(F0),z1.setFromMatrixPosition(s.target.matrixWorld),a.lookAt(z1),a.updateMatrixWorld(),L0.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this._frustum.setFromProjectionMatrix(L0),u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(a.projectionMatrix),u.multiply(a.matrixWorldInverse)}getViewport(s){return this._viewports[s]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(s){return this.camera=s.camera.clone(),this.bias=s.bias,this.radius=s.radius,this.mapSize.copy(s.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const s={};return 0!==this.bias&&(s.bias=this.bias),0!==this.normalBias&&(s.normalBias=this.normalBias),1!==this.radius&&(s.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(s.mapSize=this.mapSize.toArray()),s.camera=this.camera.toJSON(!1).object,delete s.camera.matrix,s}}class H1 extends da{constructor(){super(new Os(50,1,.5,500)),this.focus=1}updateMatrices(s){const a=this.camera,u=2*ji*s.angle*this.focus,h=this.mapSize.width/this.mapSize.height,m=s.distance||a.far;(u!==a.fov||h!==a.aspect||m!==a.far)&&(a.fov=u,a.aspect=h,a.far=m,a.updateProjectionMatrix()),super.updateMatrices(s)}copy(s){return super.copy(s),this.focus=s.focus,this}}H1.prototype.isSpotLightShadow=!0;class OM extends ha{constructor(s,a,u=0,h=Math.PI/3,m=0,g=1){super(s,a),this.type="SpotLight",this.position.copy(Ci.DefaultUp),this.updateMatrix(),this.target=new Ci,this.distance=u,this.angle=h,this.penumbra=m,this.decay=g,this.shadow=new H1}get power(){return this.intensity*Math.PI}set power(s){this.intensity=s/Math.PI}dispose(){this.shadow.dispose()}copy(s){return super.copy(s),this.distance=s.distance,this.angle=s.angle,this.penumbra=s.penumbra,this.decay=s.decay,this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}OM.prototype.isSpotLight=!0;const N0=new cn,Qd=new J,vy=new J;class kM extends da{constructor(){super(new Os(90,1,.5,500)),this._frameExtents=new Qe(4,2),this._viewportCount=6,this._viewports=[new Xi(2,1,1,1),new Xi(0,1,1,1),new Xi(3,1,1,1),new Xi(1,1,1,1),new Xi(3,0,1,1),new Xi(1,0,1,1)],this._cubeDirections=[new J(1,0,0),new J(-1,0,0),new J(0,0,1),new J(0,0,-1),new J(0,1,0),new J(0,-1,0)],this._cubeUps=[new J(0,1,0),new J(0,1,0),new J(0,1,0),new J(0,1,0),new J(0,0,1),new J(0,0,-1)]}updateMatrices(s,a=0){const u=this.camera,h=this.matrix,m=s.distance||u.far;m!==u.far&&(u.far=m,u.updateProjectionMatrix()),Qd.setFromMatrixPosition(s.matrixWorld),u.position.copy(Qd),vy.copy(u.position),vy.add(this._cubeDirections[a]),u.up.copy(this._cubeUps[a]),u.lookAt(vy),u.updateMatrixWorld(),h.makeTranslation(-Qd.x,-Qd.y,-Qd.z),N0.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),this._frustum.setFromProjectionMatrix(N0)}}kM.prototype.isPointLightShadow=!0;class BM extends ha{constructor(s,a,u=0,h=1){super(s,a),this.type="PointLight",this.distance=u,this.decay=h,this.shadow=new kM}get power(){return 4*this.intensity*Math.PI}set power(s){this.intensity=s/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(s){return super.copy(s),this.distance=s.distance,this.decay=s.decay,this.shadow=s.shadow.clone(),this}}BM.prototype.isPointLight=!0;class O0 extends da{constructor(){super(new Ap(-5,5,5,-5,.5,500))}}O0.prototype.isDirectionalLightShadow=!0;class Vi extends ha{constructor(s,a){super(s,a),this.type="DirectionalLight",this.position.copy(Ci.DefaultUp),this.updateMatrix(),this.target=new Ci,this.shadow=new O0}dispose(){this.shadow.dispose()}copy(s){return super.copy(s),this.target=s.target.clone(),this.shadow=s.shadow.clone(),this}}Vi.prototype.isDirectionalLight=!0;class k0 extends ha{constructor(s,a){super(s,a),this.type="AmbientLight"}}k0.prototype.isAmbientLight=!0;class um extends ha{constructor(s,a,u=10,h=10){super(s,a),this.type="RectAreaLight",this.width=u,this.height=h}get power(){return this.intensity*this.width*this.height*Math.PI}set power(s){this.intensity=s/(this.width*this.height*Math.PI)}copy(s){return super.copy(s),this.width=s.width,this.height=s.height,this}toJSON(s){const a=super.toJSON(s);return a.object.width=this.width,a.object.height=this.height,a}}um.prototype.isRectAreaLight=!0;class B0{constructor(){this.coefficients=[];for(let s=0;s<9;s++)this.coefficients.push(new J)}set(s){for(let a=0;a<9;a++)this.coefficients[a].copy(s[a]);return this}zero(){for(let s=0;s<9;s++)this.coefficients[s].set(0,0,0);return this}getAt(s,a){const u=s.x,h=s.y,m=s.z,g=this.coefficients;return a.copy(g[0]).multiplyScalar(.282095),a.addScaledVector(g[1],.488603*h),a.addScaledVector(g[2],.488603*m),a.addScaledVector(g[3],.488603*u),a.addScaledVector(g[4],u*h*1.092548),a.addScaledVector(g[5],h*m*1.092548),a.addScaledVector(g[6],.315392*(3*m*m-1)),a.addScaledVector(g[7],u*m*1.092548),a.addScaledVector(g[8],.546274*(u*u-h*h)),a}getIrradianceAt(s,a){const u=s.x,h=s.y,m=s.z,g=this.coefficients;return a.copy(g[0]).multiplyScalar(.886227),a.addScaledVector(g[1],1.023328*h),a.addScaledVector(g[2],1.023328*m),a.addScaledVector(g[3],1.023328*u),a.addScaledVector(g[4],.858086*u*h),a.addScaledVector(g[5],.858086*h*m),a.addScaledVector(g[6],.743125*m*m-.247708),a.addScaledVector(g[7],.858086*u*m),a.addScaledVector(g[8],.429043*(u*u-h*h)),a}add(s){for(let a=0;a<9;a++)this.coefficients[a].add(s.coefficients[a]);return this}addScaledSH(s,a){for(let u=0;u<9;u++)this.coefficients[u].addScaledVector(s.coefficients[u],a);return this}scale(s){for(let a=0;a<9;a++)this.coefficients[a].multiplyScalar(s);return this}lerp(s,a){for(let u=0;u<9;u++)this.coefficients[u].lerp(s.coefficients[u],a);return this}equals(s){for(let a=0;a<9;a++)if(!this.coefficients[a].equals(s.coefficients[a]))return!1;return!0}copy(s){return this.set(s.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(s,a=0){const u=this.coefficients;for(let h=0;h<9;h++)u[h].fromArray(s,a+3*h);return this}toArray(s=[],a=0){const u=this.coefficients;for(let h=0;h<9;h++)u[h].toArray(s,a+3*h);return s}static getBasisAt(s,a){const u=s.x,h=s.y,m=s.z;a[0]=.282095,a[1]=.488603*h,a[2]=.488603*m,a[3]=.488603*u,a[4]=1.092548*u*h,a[5]=1.092548*h*m,a[6]=.315392*(3*m*m-1),a[7]=1.092548*u*m,a[8]=.546274*(u*u-h*h)}}B0.prototype.isSphericalHarmonics3=!0;class hm extends ha{constructor(s=new B0,a=1){super(void 0,a),this.sh=s}copy(s){return super.copy(s),this.sh.copy(s.sh),this}fromJSON(s){return this.intensity=s.intensity,this.sh.fromArray(s.sh),this}toJSON(s){const a=super.toJSON(s);return a.object.sh=this.sh.toArray(),a}}hm.prototype.isLightProbe=!0;class UM extends No{constructor(s){super(s),this.textures={}}load(s,a,u,h){const m=this,g=new il(m.manager);g.setPath(m.path),g.setRequestHeader(m.requestHeader),g.setWithCredentials(m.withCredentials),g.load(s,function(_){try{a(m.parse(JSON.parse(_)))}catch(w){h?h(w):console.error(w),m.manager.itemError(s)}},u,h)}parse(s){const a=this.textures;function u(m){return void 0===a[m]&&console.warn("THREE.MaterialLoader: Undefined texture",m),a[m]}const h=Qt.fromType(s.type);if(void 0!==s.uuid&&(h.uuid=s.uuid),void 0!==s.name&&(h.name=s.name),void 0!==s.color&&void 0!==h.color&&h.color.setHex(s.color),void 0!==s.roughness&&(h.roughness=s.roughness),void 0!==s.metalness&&(h.metalness=s.metalness),void 0!==s.sheen&&(h.sheen=s.sheen),void 0!==s.sheenColor&&(h.sheenColor=(new Dt).setHex(s.sheenColor)),void 0!==s.sheenRoughness&&(h.sheenRoughness=s.sheenRoughness),void 0!==s.emissive&&void 0!==h.emissive&&h.emissive.setHex(s.emissive),void 0!==s.specular&&void 0!==h.specular&&h.specular.setHex(s.specular),void 0!==s.specularIntensity&&(h.specularIntensity=s.specularIntensity),void 0!==s.specularColor&&void 0!==h.specularColor&&h.specularColor.setHex(s.specularColor),void 0!==s.shininess&&(h.shininess=s.shininess),void 0!==s.clearcoat&&(h.clearcoat=s.clearcoat),void 0!==s.clearcoatRoughness&&(h.clearcoatRoughness=s.clearcoatRoughness),void 0!==s.transmission&&(h.transmission=s.transmission),void 0!==s.thickness&&(h.thickness=s.thickness),void 0!==s.attenuationDistance&&(h.attenuationDistance=s.attenuationDistance),void 0!==s.attenuationColor&&void 0!==h.attenuationColor&&h.attenuationColor.setHex(s.attenuationColor),void 0!==s.fog&&(h.fog=s.fog),void 0!==s.flatShading&&(h.flatShading=s.flatShading),void 0!==s.blending&&(h.blending=s.blending),void 0!==s.combine&&(h.combine=s.combine),void 0!==s.side&&(h.side=s.side),void 0!==s.shadowSide&&(h.shadowSide=s.shadowSide),void 0!==s.opacity&&(h.opacity=s.opacity),void 0!==s.transparent&&(h.transparent=s.transparent),void 0!==s.alphaTest&&(h.alphaTest=s.alphaTest),void 0!==s.depthTest&&(h.depthTest=s.depthTest),void 0!==s.depthWrite&&(h.depthWrite=s.depthWrite),void 0!==s.colorWrite&&(h.colorWrite=s.colorWrite),void 0!==s.stencilWrite&&(h.stencilWrite=s.stencilWrite),void 0!==s.stencilWriteMask&&(h.stencilWriteMask=s.stencilWriteMask),void 0!==s.stencilFunc&&(h.stencilFunc=s.stencilFunc),void 0!==s.stencilRef&&(h.stencilRef=s.stencilRef),void 0!==s.stencilFuncMask&&(h.stencilFuncMask=s.stencilFuncMask),void 0!==s.stencilFail&&(h.stencilFail=s.stencilFail),void 0!==s.stencilZFail&&(h.stencilZFail=s.stencilZFail),void 0!==s.stencilZPass&&(h.stencilZPass=s.stencilZPass),void 0!==s.wireframe&&(h.wireframe=s.wireframe),void 0!==s.wireframeLinewidth&&(h.wireframeLinewidth=s.wireframeLinewidth),void 0!==s.wireframeLinecap&&(h.wireframeLinecap=s.wireframeLinecap),void 0!==s.wireframeLinejoin&&(h.wireframeLinejoin=s.wireframeLinejoin),void 0!==s.rotation&&(h.rotation=s.rotation),1!==s.linewidth&&(h.linewidth=s.linewidth),void 0!==s.dashSize&&(h.dashSize=s.dashSize),void 0!==s.gapSize&&(h.gapSize=s.gapSize),void 0!==s.scale&&(h.scale=s.scale),void 0!==s.polygonOffset&&(h.polygonOffset=s.polygonOffset),void 0!==s.polygonOffsetFactor&&(h.polygonOffsetFactor=s.polygonOffsetFactor),void 0!==s.polygonOffsetUnits&&(h.polygonOffsetUnits=s.polygonOffsetUnits),void 0!==s.dithering&&(h.dithering=s.dithering),void 0!==s.alphaToCoverage&&(h.alphaToCoverage=s.alphaToCoverage),void 0!==s.premultipliedAlpha&&(h.premultipliedAlpha=s.premultipliedAlpha),void 0!==s.visible&&(h.visible=s.visible),void 0!==s.toneMapped&&(h.toneMapped=s.toneMapped),void 0!==s.userData&&(h.userData=s.userData),void 0!==s.vertexColors&&(h.vertexColors="number"==typeof s.vertexColors?s.vertexColors>0:s.vertexColors),void 0!==s.uniforms)for(const m in s.uniforms){const g=s.uniforms[m];switch(h.uniforms[m]={},g.type){case"t":h.uniforms[m].value=u(g.value);break;case"c":h.uniforms[m].value=(new Dt).setHex(g.value);break;case"v2":h.uniforms[m].value=(new Qe).fromArray(g.value);break;case"v3":h.uniforms[m].value=(new J).fromArray(g.value);break;case"v4":h.uniforms[m].value=(new Xi).fromArray(g.value);break;case"m3":h.uniforms[m].value=(new ir).fromArray(g.value);break;case"m4":h.uniforms[m].value=(new cn).fromArray(g.value);break;default:h.uniforms[m].value=g.value}}if(void 0!==s.defines&&(h.defines=s.defines),void 0!==s.vertexShader&&(h.vertexShader=s.vertexShader),void 0!==s.fragmentShader&&(h.fragmentShader=s.fragmentShader),void 0!==s.extensions)for(const m in s.extensions)h.extensions[m]=s.extensions[m];if(void 0!==s.shading&&(h.flatShading=1===s.shading),void 0!==s.size&&(h.size=s.size),void 0!==s.sizeAttenuation&&(h.sizeAttenuation=s.sizeAttenuation),void 0!==s.map&&(h.map=u(s.map)),void 0!==s.matcap&&(h.matcap=u(s.matcap)),void 0!==s.alphaMap&&(h.alphaMap=u(s.alphaMap)),void 0!==s.bumpMap&&(h.bumpMap=u(s.bumpMap)),void 0!==s.bumpScale&&(h.bumpScale=s.bumpScale),void 0!==s.normalMap&&(h.normalMap=u(s.normalMap)),void 0!==s.normalMapType&&(h.normalMapType=s.normalMapType),void 0!==s.normalScale){let m=s.normalScale;!1===Array.isArray(m)&&(m=[m,m]),h.normalScale=(new Qe).fromArray(m)}return void 0!==s.displacementMap&&(h.displacementMap=u(s.displacementMap)),void 0!==s.displacementScale&&(h.displacementScale=s.displacementScale),void 0!==s.displacementBias&&(h.displacementBias=s.displacementBias),void 0!==s.roughnessMap&&(h.roughnessMap=u(s.roughnessMap)),void 0!==s.metalnessMap&&(h.metalnessMap=u(s.metalnessMap)),void 0!==s.emissiveMap&&(h.emissiveMap=u(s.emissiveMap)),void 0!==s.emissiveIntensity&&(h.emissiveIntensity=s.emissiveIntensity),void 0!==s.specularMap&&(h.specularMap=u(s.specularMap)),void 0!==s.specularIntensityMap&&(h.specularIntensityMap=u(s.specularIntensityMap)),void 0!==s.specularColorMap&&(h.specularColorMap=u(s.specularColorMap)),void 0!==s.envMap&&(h.envMap=u(s.envMap)),void 0!==s.envMapIntensity&&(h.envMapIntensity=s.envMapIntensity),void 0!==s.reflectivity&&(h.reflectivity=s.reflectivity),void 0!==s.refractionRatio&&(h.refractionRatio=s.refractionRatio),void 0!==s.lightMap&&(h.lightMap=u(s.lightMap)),void 0!==s.lightMapIntensity&&(h.lightMapIntensity=s.lightMapIntensity),void 0!==s.aoMap&&(h.aoMap=u(s.aoMap)),void 0!==s.aoMapIntensity&&(h.aoMapIntensity=s.aoMapIntensity),void 0!==s.gradientMap&&(h.gradientMap=u(s.gradientMap)),void 0!==s.clearcoatMap&&(h.clearcoatMap=u(s.clearcoatMap)),void 0!==s.clearcoatRoughnessMap&&(h.clearcoatRoughnessMap=u(s.clearcoatRoughnessMap)),void 0!==s.clearcoatNormalMap&&(h.clearcoatNormalMap=u(s.clearcoatNormalMap)),void 0!==s.clearcoatNormalScale&&(h.clearcoatNormalScale=(new Qe).fromArray(s.clearcoatNormalScale)),void 0!==s.transmissionMap&&(h.transmissionMap=u(s.transmissionMap)),void 0!==s.thicknessMap&&(h.thicknessMap=u(s.thicknessMap)),void 0!==s.sheenColorMap&&(h.sheenColorMap=u(s.sheenColorMap)),void 0!==s.sheenRoughnessMap&&(h.sheenRoughnessMap=u(s.sheenRoughnessMap)),h}setTextures(s){return this.textures=s,this}}class xy{static decodeText(s){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(s);let a="";for(let u=0,h=s.length;u<h;u++)a+=String.fromCharCode(s[u]);try{return decodeURIComponent(escape(a))}catch(u){return a}}static extractUrlBase(s){const a=s.lastIndexOf("/");return-1===a?"./":s.slice(0,a+1)}static resolveURL(s,a){return"string"!=typeof s||""===s?"":(/^https?:\/\//i.test(a)&&/^\//.test(s)&&(a=a.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(s)||/^data:.*,.*$/i.test(s)||/^blob:.*$/i.test(s)?s:a+s)}}class U0 extends en{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(s){return super.copy(s),this.instanceCount=s.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const s=super.toJSON(this);return s.instanceCount=this.instanceCount,s.isInstancedBufferGeometry=!0,s}}U0.prototype.isInstancedBufferGeometry=!0;class VM extends No{constructor(s){super(s)}load(s,a,u,h){const m=this,g=new il(m.manager);g.setPath(m.path),g.setRequestHeader(m.requestHeader),g.setWithCredentials(m.withCredentials),g.load(s,function(_){try{a(m.parse(JSON.parse(_)))}catch(w){h?h(w):console.error(w),m.manager.itemError(s)}},u,h)}parse(s){const a={},u={};function h(R,L){if(void 0!==a[L])return a[L];const I=R.interleavedBuffers[L],z=function m(R,L){if(void 0!==u[L])return u[L];const z=new Uint32Array(R.arrayBuffers[L]).buffer;return u[L]=z,z}(R,I.buffer),B=gl(I.type,z),j=new zd(B,I.stride);return j.uuid=I.uuid,a[L]=j,j}const g=s.isInstancedBufferGeometry?new U0:new en,_=s.data.index;if(void 0!==_){const R=gl(_.type,_.array);g.setIndex(new Ni(R,1))}const w=s.data.attributes;for(const R in w){const L=w[R];let P;if(L.isInterleavedBufferAttribute){const I=h(s.data,L.data);P=new Kc(I,L.itemSize,L.offset,L.normalized)}else{const I=gl(L.type,L.array);P=new(L.isInstancedBufferAttribute?Al:Ni)(I,L.itemSize,L.normalized)}void 0!==L.name&&(P.name=L.name),void 0!==L.usage&&P.setUsage(L.usage),void 0!==L.updateRange&&(P.updateRange.offset=L.updateRange.offset,P.updateRange.count=L.updateRange.count),g.setAttribute(R,P)}const M=s.data.morphAttributes;if(M)for(const R in M){const L=M[R],P=[];for(let I=0,z=L.length;I<z;I++){const B=L[I];let j;if(B.isInterleavedBufferAttribute){const G=h(s.data,B.data);j=new Kc(G,B.itemSize,B.offset,B.normalized)}else{const G=gl(B.type,B.array);j=new Ni(G,B.itemSize,B.normalized)}void 0!==B.name&&(j.name=B.name),P.push(j)}g.morphAttributes[R]=P}s.data.morphTargetsRelative&&(g.morphTargetsRelative=!0);const A=s.data.groups||s.data.drawcalls||s.data.offsets;if(void 0!==A)for(let R=0,L=A.length;R!==L;++R){const P=A[R];g.addGroup(P.start,P.count,P.materialIndex)}const D=s.data.boundingSphere;if(void 0!==D){const R=new J;void 0!==D.center&&R.fromArray(D.center),g.boundingSphere=new Wu(R,D.radius)}return s.name&&(g.name=s.name),s.userData&&(g.userData=s.userData),g}}const ef={UVMapping:300,CubeReflectionMapping:Bi,CubeRefractionMapping:$a,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306},zM={RepeatWrapping:ho,ClampToEdgeWrapping:_s,MirroredRepeatWrapping:ad},tf={NearestFilter:zr,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:Hr,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:Ya};class HM extends No{constructor(s){super(s),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(s){return this.options=s,this}load(s,a,u,h){void 0===s&&(s=""),void 0!==this.path&&(s=this.path+s),s=this.manager.resolveURL(s);const m=this,g=tu.get(s);if(void 0!==g)return m.manager.itemStart(s),setTimeout(function(){a&&a(g),m.manager.itemEnd(s)},0),g;const _={};_.credentials="anonymous"===this.crossOrigin?"same-origin":"include",_.headers=this.requestHeader,fetch(s,_).then(function(w){return w.blob()}).then(function(w){return createImageBitmap(w,Object.assign(m.options,{colorSpaceConversion:"none"}))}).then(function(w){tu.add(s,w),a&&a(w),m.manager.itemEnd(s)}).catch(function(w){h&&h(w),m.manager.itemError(s),m.manager.itemEnd(s)}),m.manager.itemStart(s)}}let wy;HM.prototype.isImageBitmapLoader=!0;const dm={getContext:function(){return void 0===wy&&(wy=new(window.AudioContext||window.webkitAudioContext)),wy},setContext:function(f){wy=f}};class rl extends No{constructor(s){super(s)}load(s,a,u,h){const m=this,g=new il(this.manager);g.setResponseType("arraybuffer"),g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(s,function(_){try{const w=_.slice(0);dm.getContext().decodeAudioData(w,function(C){a(C)})}catch(w){h?h(w):console.error(w),m.manager.itemError(s)}},u,h)}}class nf extends hm{constructor(s,a,u=1){super(void 0,u);const h=(new Dt).set(s),m=(new Dt).set(a),g=new J(h.r,h.g,h.b),_=new J(m.r,m.g,m.b),w=Math.sqrt(Math.PI),M=w*Math.sqrt(.75);this.sh.coefficients[0].copy(g).add(_).multiplyScalar(w),this.sh.coefficients[1].copy(g).sub(_).multiplyScalar(M)}}nf.prototype.isHemisphereLightProbe=!0;class ro extends hm{constructor(s,a=1){super(void 0,a);const u=(new Dt).set(s);this.sh.coefficients[0].set(u.r,u.g,u.b).multiplyScalar(2*Math.sqrt(Math.PI))}}ro.prototype.isAmbientLightProbe=!0;const nu=new cn,fm=new cn,Us=new cn;class xh{constructor(s=!0){this.autoStart=s,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=bh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let s=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const a=bh();s=(a-this.oldTime)/1e3,this.oldTime=a,this.elapsedTime+=s}return s}}function bh(){return("undefined"==typeof performance?Date:performance).now()}const Oa=new J,wh=new no,rf=new J,ka=new J;class iu extends Ci{constructor(s){super(),this.type="Audio",this.listener=s,this.context=s.context,this.gain=this.context.createGain(),this.gain.connect(s.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(s){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=s,this.connect(),this}setMediaElementSource(s){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(s),this.connect(),this}setMediaStreamSource(s){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(s),this.connect(),this}setBuffer(s){return this.buffer=s,this.sourceType="buffer",this.autoplay&&this.play(),this}play(s=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+s;const a=this.context.createBufferSource();return a.buffer=this.buffer,a.loop=this.loop,a.loopStart=this.loopStart,a.loopEnd=this.loopEnd,a.onended=this.onEnded.bind(this),a.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=a,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let s=1,a=this.filters.length;s<a;s++)this.filters[s-1].connect(this.filters[s]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let s=1,a=this.filters.length;s<a;s++)this.filters[s-1].disconnect(this.filters[s]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(s){return s||(s=[]),!0===this._connected?(this.disconnect(),this.filters=s.slice(),this.connect()):this.filters=s.slice(),this}setDetune(s){if(this.detune=s,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(s){return this.setFilters(s?[s]:[])}setPlaybackRate(s){if(!1!==this.hasPlaybackControl)return this.playbackRate=s,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(s){if(!1!==this.hasPlaybackControl)return this.loop=s,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(s){return this.loopStart=s,this}setLoopEnd(s){return this.loopEnd=s,this}getVolume(){return this.gain.gain.value}setVolume(s){return this.gain.gain.setTargetAtTime(s,this.context.currentTime,.01),this}}const Ba=new J,V0=new no,GM=new J,ru=new J;class z0{constructor(s,a=2048){this.analyser=s.context.createAnalyser(),this.analyser.fftSize=a,this.data=new Uint8Array(this.analyser.frequencyBinCount),s.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let s=0;const a=this.getFrequencyData();for(let u=0;u<a.length;u++)s+=a[u];return s/a.length}}class H0{constructor(s,a,u){let h,m,g;switch(this.binding=s,this.valueSize=u,a){case"quaternion":h=this._slerp,m=this._slerpAdditive,g=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*u),this._workIndex=5;break;case"string":case"bool":h=this._select,m=this._select,g=this._setAdditiveIdentityOther,this.buffer=new Array(5*u);break;default:h=this._lerp,m=this._lerpAdditive,g=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*u)}this._mixBufferRegion=h,this._mixBufferRegionAdditive=m,this._setIdentity=g,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(s,a){const u=this.buffer,h=this.valueSize,m=s*h+h;let g=this.cumulativeWeight;if(0===g){for(let _=0;_!==h;++_)u[m+_]=u[_];g=a}else g+=a,this._mixBufferRegion(u,m,0,a/g,h);this.cumulativeWeight=g}accumulateAdditive(s){const a=this.buffer,u=this.valueSize,h=u*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(a,h,0,s,u),this.cumulativeWeightAdditive+=s}apply(s){const a=this.valueSize,u=this.buffer,h=s*a+a,m=this.cumulativeWeight,g=this.cumulativeWeightAdditive,_=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,m<1&&this._mixBufferRegion(u,h,a*this._origIndex,1-m,a),g>0&&this._mixBufferRegionAdditive(u,h,this._addIndex*a,1,a);for(let w=a,M=a+a;w!==M;++w)if(u[w]!==u[w+a]){_.setValue(u,h);break}}saveOriginalState(){const a=this.buffer,u=this.valueSize,h=u*this._origIndex;this.binding.getValue(a,h);for(let m=u,g=h;m!==g;++m)a[m]=a[h+m%u];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const s=this._addIndex*this.valueSize,a=s+this.valueSize;for(let u=s;u<a;u++)this.buffer[u]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const s=this._origIndex*this.valueSize,a=this._addIndex*this.valueSize;for(let u=0;u<this.valueSize;u++)this.buffer[a+u]=this.buffer[s+u]}_select(s,a,u,h,m){if(h>=.5)for(let g=0;g!==m;++g)s[a+g]=s[u+g]}_slerp(s,a,u,h){no.slerpFlat(s,a,s,a,s,u,h)}_slerpAdditive(s,a,u,h,m){const g=this._workIndex*m;no.multiplyQuaternionsFlat(s,g,s,a,s,u),no.slerpFlat(s,a,s,a,s,g,h)}_lerp(s,a,u,h,m){const g=1-h;for(let _=0;_!==m;++_){const w=a+_;s[w]=s[w]*g+s[u+_]*h}}_lerpAdditive(s,a,u,h,m){for(let g=0;g!==m;++g){const _=a+g;s[_]=s[_]+s[u+g]*h}}}const My="\\[\\]\\.:\\/",qM=new RegExp("["+My+"]","g"),Sy="[^"+My+"]",G1="[^"+My.replace("\\.","")+"]",xn=/((?:WC+[\/:])*)/.source.replace("WC",Sy),W1=/(WCOD+)?/.source.replace("WCOD",G1),q1=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Sy),jM=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Sy),j1=new RegExp("^"+xn+W1+q1+jM+"$"),X1=["material","materials","bones"];class XM{constructor(s,a,u){const h=u||wr.parseTrackName(a);this._targetGroup=s,this._bindings=s.subscribe_(a,h)}getValue(s,a){this.bind();const h=this._bindings[this._targetGroup.nCachedObjects_];void 0!==h&&h.getValue(s,a)}setValue(s,a){const u=this._bindings;for(let h=this._targetGroup.nCachedObjects_,m=u.length;h!==m;++h)u[h].setValue(s,a)}bind(){const s=this._bindings;for(let a=this._targetGroup.nCachedObjects_,u=s.length;a!==u;++a)s[a].bind()}unbind(){const s=this._bindings;for(let a=this._targetGroup.nCachedObjects_,u=s.length;a!==u;++a)s[a].unbind()}}let wr=(()=>{class f{constructor(a,u,h){this.path=u,this.parsedPath=h||f.parseTrackName(u),this.node=f.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,u,h){return a&&a.isAnimationObjectGroup?new f.Composite(a,u,h):new f(a,u,h)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(qM,"")}static parseTrackName(a){const u=j1.exec(a);if(null===u)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const h={nodeName:u[2],objectName:u[3],objectIndex:u[4],propertyName:u[5],propertyIndex:u[6]},m=h.nodeName&&h.nodeName.lastIndexOf(".");if(void 0!==m&&-1!==m){const g=h.nodeName.substring(m+1);-1!==X1.indexOf(g)&&(h.nodeName=h.nodeName.substring(0,m),h.objectName=g)}if(null===h.propertyName||0===h.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return h}static findNode(a,u){if(void 0===u||""===u||"."===u||-1===u||u===a.name||u===a.uuid)return a;if(a.skeleton){const h=a.skeleton.getBoneByName(u);if(void 0!==h)return h}if(a.children){const h=function(g){for(let _=0;_<g.length;_++){const w=g[_];if(w.name===u||w.uuid===u)return w;const M=h(w.children);if(M)return M}return null},m=h(a.children);if(m)return m}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,u){a[u]=this.targetObject[this.propertyName]}_getValue_array(a,u){const h=this.resolvedProperty;for(let m=0,g=h.length;m!==g;++m)a[u++]=h[m]}_getValue_arrayElement(a,u){a[u]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,u){this.resolvedProperty.toArray(a,u)}_setValue_direct(a,u){this.targetObject[this.propertyName]=a[u]}_setValue_direct_setNeedsUpdate(a,u){this.targetObject[this.propertyName]=a[u],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,u){this.targetObject[this.propertyName]=a[u],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,u){const h=this.resolvedProperty;for(let m=0,g=h.length;m!==g;++m)h[m]=a[u++]}_setValue_array_setNeedsUpdate(a,u){const h=this.resolvedProperty;for(let m=0,g=h.length;m!==g;++m)h[m]=a[u++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,u){const h=this.resolvedProperty;for(let m=0,g=h.length;m!==g;++m)h[m]=a[u++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,u){this.resolvedProperty[this.propertyIndex]=a[u]}_setValue_arrayElement_setNeedsUpdate(a,u){this.resolvedProperty[this.propertyIndex]=a[u],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,u){this.resolvedProperty[this.propertyIndex]=a[u],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,u){this.resolvedProperty.fromArray(a,u)}_setValue_fromArray_setNeedsUpdate(a,u){this.resolvedProperty.fromArray(a,u),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,u){this.resolvedProperty.fromArray(a,u),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,u){this.bind(),this.getValue(a,u)}_setValue_unbound(a,u){this.bind(),this.setValue(a,u)}bind(){let a=this.node;const u=this.parsedPath,h=u.objectName,m=u.propertyName;let g=u.propertyIndex;if(a||(a=f.findNode(this.rootNode,u.nodeName)||this.rootNode,this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(h){let C=u.objectIndex;switch(h){case"materials":if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);a=a.skeleton.bones;for(let A=0;A<a.length;A++)if(a[A].name===C){C=A;break}break;default:if(void 0===a[h])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);a=a[h]}if(void 0!==C){if(void 0===a[C])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);a=a[C]}}const _=a[m];if(void 0===_)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+u.nodeName+"."+m+" but it wasn't found.",a);let w=this.Versioning.None;this.targetObject=a,void 0!==a.needsUpdate?w=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(w=this.Versioning.MatrixWorldNeedsUpdate);let M=this.BindingType.Direct;if(void 0!==g){if("morphTargetInfluences"===m){if(!a.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!a.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!a.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==a.morphTargetDictionary[g]&&(g=a.morphTargetDictionary[g])}M=this.BindingType.ArrayElement,this.resolvedProperty=_,this.propertyIndex=g}else void 0!==_.fromArray&&void 0!==_.toArray?(M=this.BindingType.HasFromToArray,this.resolvedProperty=_):Array.isArray(_)?(M=this.BindingType.EntireArray,this.resolvedProperty=_):this.propertyName=m;this.getValue=this.GetterByBindingType[M],this.setValue=this.SetterByBindingTypeAndVersioning[M][w]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return f.Composite=XM,f})();wr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},wr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},wr.prototype.GetterByBindingType=[wr.prototype._getValue_direct,wr.prototype._getValue_array,wr.prototype._getValue_arrayElement,wr.prototype._getValue_toArray],wr.prototype.SetterByBindingTypeAndVersioning=[[wr.prototype._setValue_direct,wr.prototype._setValue_direct_setNeedsUpdate,wr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[wr.prototype._setValue_array,wr.prototype._setValue_array_setNeedsUpdate,wr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[wr.prototype._setValue_arrayElement,wr.prototype._setValue_arrayElement_setNeedsUpdate,wr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[wr.prototype._setValue_fromArray,wr.prototype._setValue_fromArray_setNeedsUpdate,wr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class G0{constructor(){this.uuid=wa(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const s={};this._indicesByUUID=s;for(let u=0,h=arguments.length;u!==h;++u)s[arguments[u].uuid]=u;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}add(){const s=this._objects,a=this._indicesByUUID,u=this._paths,h=this._parsedPaths,m=this._bindings,g=m.length;let _,w=s.length,M=this.nCachedObjects_;for(let C=0,A=arguments.length;C!==A;++C){const D=arguments[C],R=D.uuid;let L=a[R];if(void 0===L){L=w++,a[R]=L,s.push(D);for(let P=0,I=g;P!==I;++P)m[P].push(new wr(D,u[P],h[P]))}else if(L<M){_=s[L];const P=--M,I=s[P];a[I.uuid]=L,s[L]=I,a[R]=P,s[P]=D;for(let z=0,B=g;z!==B;++z){const j=m[z];let Y=j[L];j[L]=j[P],void 0===Y&&(Y=new wr(D,u[z],h[z])),j[P]=Y}}else s[L]!==_&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=M}remove(){const s=this._objects,a=this._indicesByUUID,u=this._bindings,h=u.length;let m=this.nCachedObjects_;for(let g=0,_=arguments.length;g!==_;++g){const w=arguments[g],M=w.uuid,C=a[M];if(void 0!==C&&C>=m){const A=m++,D=s[A];a[D.uuid]=C,s[C]=D,a[M]=A,s[A]=w;for(let R=0,L=h;R!==L;++R){const P=u[R],z=P[C];P[C]=P[A],P[A]=z}}}this.nCachedObjects_=m}uncache(){const s=this._objects,a=this._indicesByUUID,u=this._bindings,h=u.length;let m=this.nCachedObjects_,g=s.length;for(let _=0,w=arguments.length;_!==w;++_){const C=arguments[_].uuid,A=a[C];if(void 0!==A)if(delete a[C],A<m){const D=--m,R=s[D],L=--g,P=s[L];a[R.uuid]=A,s[A]=R,a[P.uuid]=D,s[D]=P,s.pop();for(let I=0,z=h;I!==z;++I){const B=u[I],G=B[L];B[A]=B[D],B[D]=G,B.pop()}}else{const D=--g,R=s[D];D>0&&(a[R.uuid]=A),s[A]=R,s.pop();for(let L=0,P=h;L!==P;++L){const I=u[L];I[A]=I[D],I.pop()}}}this.nCachedObjects_=m}subscribe_(s,a){const u=this._bindingsIndicesByPath;let h=u[s];const m=this._bindings;if(void 0!==h)return m[h];const g=this._paths,_=this._parsedPaths,w=this._objects,C=this.nCachedObjects_,A=new Array(w.length);h=m.length,u[s]=h,g.push(s),_.push(a),m.push(A);for(let D=C,R=w.length;D!==R;++D)A[D]=new wr(w[D],s,a);return A}unsubscribe_(s){const a=this._bindingsIndicesByPath,u=a[s];if(void 0!==u){const h=this._paths,m=this._parsedPaths,g=this._bindings,_=g.length-1,w=g[_];a[s[_]]=u,g[u]=w,g.pop(),m[u]=m[_],m.pop(),h[u]=h[_],h.pop()}}}G0.prototype.isAnimationObjectGroup=!0;class $1{constructor(s,a,u=null,h=a.blendMode){this._mixer=s,this._clip=a,this._localRoot=u,this.blendMode=h;const m=a.tracks,g=m.length,_=new Array(g),w={endingStart:Uu,endingEnd:Uu};for(let M=0;M!==g;++M){const C=m[M].createInterpolant(null);_[M]=C,C.settings=w}this._interpolantSettings=w,this._interpolants=_,this._propertyBindings=new Array(g),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(s){return this._startTime=s,this}setLoop(s,a){return this.loop=s,this.repetitions=a,this}setEffectiveWeight(s){return this.weight=s,this._effectiveWeight=this.enabled?s:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(s){return this._scheduleFading(s,0,1)}fadeOut(s){return this._scheduleFading(s,1,0)}crossFadeFrom(s,a,u){if(s.fadeOut(a),this.fadeIn(a),u){const h=this._clip.duration,m=s._clip.duration,_=h/m;s.warp(1,m/h,a),this.warp(_,1,a)}return this}crossFadeTo(s,a,u){return s.crossFadeFrom(this,a,u)}stopFading(){const s=this._weightInterpolant;return null!==s&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this}setEffectiveTimeScale(s){return this.timeScale=s,this._effectiveTimeScale=this.paused?0:s,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(s){return this.timeScale=this._clip.duration/s,this.stopWarping()}syncWith(s){return this.time=s.time,this.timeScale=s.timeScale,this.stopWarping()}halt(s){return this.warp(this._effectiveTimeScale,0,s)}warp(s,a,u){const h=this._mixer,m=h.time,g=this.timeScale;let _=this._timeScaleInterpolant;null===_&&(_=h._lendControlInterpolant(),this._timeScaleInterpolant=_);const w=_.parameterPositions,M=_.sampleValues;return w[0]=m,w[1]=m+u,M[0]=s/g,M[1]=a/g,this}stopWarping(){const s=this._timeScaleInterpolant;return null!==s&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(s)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(s,a,u,h){if(!this.enabled)return void this._updateWeight(s);const m=this._startTime;if(null!==m){const w=(s-m)*u;if(w<0||0===u)return;this._startTime=null,a=u*w}a*=this._updateTimeScale(s);const g=this._updateTime(a),_=this._updateWeight(s);if(_>0){const w=this._interpolants,M=this._propertyBindings;if(2501===this.blendMode)for(let C=0,A=w.length;C!==A;++C)w[C].evaluate(g),M[C].accumulateAdditive(_);else for(let C=0,A=w.length;C!==A;++C)w[C].evaluate(g),M[C].accumulate(h,_)}}_updateWeight(s){let a=0;if(this.enabled){a=this.weight;const u=this._weightInterpolant;if(null!==u){const h=u.evaluate(s)[0];a*=h,s>u.parameterPositions[1]&&(this.stopFading(),0===h&&(this.enabled=!1))}}return this._effectiveWeight=a,a}_updateTimeScale(s){let a=0;if(!this.paused){a=this.timeScale;const u=this._timeScaleInterpolant;null!==u&&(a*=u.evaluate(s)[0],s>u.parameterPositions[1]&&(this.stopWarping(),0===a?this.paused=!0:this.timeScale=a))}return this._effectiveTimeScale=a,a}_updateTime(s){const a=this._clip.duration,u=this.loop;let h=this.time+s,m=this._loopCount;const g=2202===u;if(0===s)return-1===m?h:g&&1==(1&m)?a-h:h;if(2200===u){-1===m&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(h>=a)h=a;else{if(!(h<0)){this.time=h;break e}h=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:s<0?-1:1})}}else{if(-1===m&&(s>=0?(m=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g)),h>=a||h<0){const _=Math.floor(h/a);h-=a*_,m+=Math.abs(_);const w=this.repetitions-m;if(w<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,h=s>0?a:0,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:s>0?1:-1});else{if(1===w){const M=s<0;this._setEndings(M,!M,g)}else this._setEndings(!1,!1,g);this._loopCount=m,this.time=h,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:_})}}else this.time=h;if(g&&1==(1&m))return a-h}return h}_setEndings(s,a,u){const h=this._interpolantSettings;u?(h.endingStart=cd,h.endingEnd=cd):(h.endingStart=s?this.zeroSlopeAtStart?cd:Uu:bg,h.endingEnd=a?this.zeroSlopeAtEnd?cd:Uu:bg)}_scheduleFading(s,a,u){const h=this._mixer,m=h.time;let g=this._weightInterpolant;null===g&&(g=h._lendControlInterpolant(),this._weightInterpolant=g);const _=g.parameterPositions,w=g.sampleValues;return _[0]=m,w[0]=a,_[1]=m+s,w[1]=u,this}}class $M extends zc{constructor(s){super(),this._root=s,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(s,a){const u=s._localRoot||this._root,h=s._clip.tracks,m=h.length,g=s._propertyBindings,_=s._interpolants,w=u.uuid,M=this._bindingsByRootAndName;let C=M[w];void 0===C&&(C={},M[w]=C);for(let A=0;A!==m;++A){const D=h[A],R=D.name;let L=C[R];if(void 0!==L)++L.referenceCount,g[A]=L;else{if(L=g[A],void 0!==L){null===L._cacheIndex&&(++L.referenceCount,this._addInactiveBinding(L,w,R));continue}L=new H0(wr.create(u,R,a&&a._propertyBindings[A].binding.parsedPath),D.ValueTypeName,D.getValueSize()),++L.referenceCount,this._addInactiveBinding(L,w,R),g[A]=L}_[A].resultBuffer=L.buffer}}_activateAction(s){if(!this._isActiveAction(s)){if(null===s._cacheIndex){const u=(s._localRoot||this._root).uuid,h=s._clip.uuid,m=this._actionsByClip[h];this._bindAction(s,m&&m.knownActions[0]),this._addInactiveAction(s,h,u)}const a=s._propertyBindings;for(let u=0,h=a.length;u!==h;++u){const m=a[u];0==m.useCount++&&(this._lendBinding(m),m.saveOriginalState())}this._lendAction(s)}}_deactivateAction(s){if(this._isActiveAction(s)){const a=s._propertyBindings;for(let u=0,h=a.length;u!==h;++u){const m=a[u];0==--m.useCount&&(m.restoreOriginalState(),this._takeBackBinding(m))}this._takeBackAction(s)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const s=this;this.stats={actions:{get total(){return s._actions.length},get inUse(){return s._nActiveActions}},bindings:{get total(){return s._bindings.length},get inUse(){return s._nActiveBindings}},controlInterpolants:{get total(){return s._controlInterpolants.length},get inUse(){return s._nActiveControlInterpolants}}}}_isActiveAction(s){const a=s._cacheIndex;return null!==a&&a<this._nActiveActions}_addInactiveAction(s,a,u){const h=this._actions,m=this._actionsByClip;let g=m[a];if(void 0===g)g={knownActions:[s],actionByRoot:{}},s._byClipCacheIndex=0,m[a]=g;else{const _=g.knownActions;s._byClipCacheIndex=_.length,_.push(s)}s._cacheIndex=h.length,h.push(s),g.actionByRoot[u]=s}_removeInactiveAction(s){const a=this._actions,u=a[a.length-1],h=s._cacheIndex;u._cacheIndex=h,a[h]=u,a.pop(),s._cacheIndex=null;const m=s._clip.uuid,g=this._actionsByClip,_=g[m],w=_.knownActions,M=w[w.length-1],C=s._byClipCacheIndex;M._byClipCacheIndex=C,w[C]=M,w.pop(),s._byClipCacheIndex=null,delete _.actionByRoot[(s._localRoot||this._root).uuid],0===w.length&&delete g[m],this._removeInactiveBindingsForAction(s)}_removeInactiveBindingsForAction(s){const a=s._propertyBindings;for(let u=0,h=a.length;u!==h;++u){const m=a[u];0==--m.referenceCount&&this._removeInactiveBinding(m)}}_lendAction(s){const a=this._actions,u=s._cacheIndex,h=this._nActiveActions++,m=a[h];s._cacheIndex=h,a[h]=s,m._cacheIndex=u,a[u]=m}_takeBackAction(s){const a=this._actions,u=s._cacheIndex,h=--this._nActiveActions,m=a[h];s._cacheIndex=h,a[h]=s,m._cacheIndex=u,a[u]=m}_addInactiveBinding(s,a,u){const h=this._bindingsByRootAndName,m=this._bindings;let g=h[a];void 0===g&&(g={},h[a]=g),g[u]=s,s._cacheIndex=m.length,m.push(s)}_removeInactiveBinding(s){const a=this._bindings,u=s.binding,h=u.rootNode.uuid,m=u.path,g=this._bindingsByRootAndName,_=g[h],w=a[a.length-1],M=s._cacheIndex;w._cacheIndex=M,a[M]=w,a.pop(),delete _[m],0===Object.keys(_).length&&delete g[h]}_lendBinding(s){const a=this._bindings,u=s._cacheIndex,h=this._nActiveBindings++,m=a[h];s._cacheIndex=h,a[h]=s,m._cacheIndex=u,a[u]=m}_takeBackBinding(s){const a=this._bindings,u=s._cacheIndex,h=--this._nActiveBindings,m=a[h];s._cacheIndex=h,a[h]=s,m._cacheIndex=u,a[u]=m}_lendControlInterpolant(){const s=this._controlInterpolants,a=this._nActiveControlInterpolants++;let u=s[a];return void 0===u&&(u=new _y(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),u.__cacheIndex=a,s[a]=u),u}_takeBackControlInterpolant(s){const a=this._controlInterpolants,u=s.__cacheIndex,h=--this._nActiveControlInterpolants,m=a[h];s.__cacheIndex=h,a[h]=s,m.__cacheIndex=u,a[u]=m}clipAction(s,a,u){const h=a||this._root,m=h.uuid;let g="string"==typeof s?Jd.findByName(h,s):s;const _=null!==g?g.uuid:s,w=this._actionsByClip[_];let M=null;if(void 0===u&&(u=null!==g?g.blendMode:2500),void 0!==w){const A=w.actionByRoot[m];if(void 0!==A&&A.blendMode===u)return A;M=w.knownActions[0],null===g&&(g=M._clip)}if(null===g)return null;const C=new $1(this,g,a,u);return this._bindAction(C,M),this._addInactiveAction(C,_,m),C}existingAction(s,a){const u=a||this._root,h=u.uuid,m="string"==typeof s?Jd.findByName(u,s):s,_=this._actionsByClip[m?m.uuid:s];return void 0!==_&&_.actionByRoot[h]||null}stopAllAction(){const s=this._actions;for(let u=this._nActiveActions-1;u>=0;--u)s[u].stop();return this}update(s){const a=this._actions,u=this._nActiveActions,h=this.time+=s*=this.timeScale,m=Math.sign(s),g=this._accuIndex^=1;for(let M=0;M!==u;++M)a[M]._update(h,s,m,g);const _=this._bindings,w=this._nActiveBindings;for(let M=0;M!==w;++M)_[M].apply(g);return this}setTime(s){this.time=0;for(let a=0;a<this._actions.length;a++)this._actions[a].time=0;return this.update(s)}getRoot(){return this._root}uncacheClip(s){const a=this._actions,u=s.uuid,h=this._actionsByClip,m=h[u];if(void 0!==m){const g=m.knownActions;for(let _=0,w=g.length;_!==w;++_){const M=g[_];this._deactivateAction(M);const C=M._cacheIndex,A=a[a.length-1];M._cacheIndex=null,M._byClipCacheIndex=null,A._cacheIndex=C,a[C]=A,a.pop(),this._removeInactiveBindingsForAction(M)}delete h[u]}}uncacheRoot(s){const a=s.uuid,u=this._actionsByClip;for(const g in u){const w=u[g].actionByRoot[a];void 0!==w&&(this._deactivateAction(w),this._removeInactiveAction(w))}const m=this._bindingsByRootAndName[a];if(void 0!==m)for(const g in m){const _=m[g];_.restoreOriginalState(),this._removeInactiveBinding(_)}}uncacheAction(s,a){const u=this.existingAction(s,a);null!==u&&(this._deactivateAction(u),this._removeInactiveAction(u))}}$M.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class W0{constructor(s){"string"==typeof s&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),s=arguments[1]),this.value=s}clone(){return new W0(void 0===this.value.clone?this.value:this.value.clone())}}class YM extends zd{constructor(s,a,u=1){super(s,a),this.meshPerAttribute=u}copy(s){return super.copy(s),this.meshPerAttribute=s.meshPerAttribute,this}clone(s){const a=super.clone(s);return a.meshPerAttribute=this.meshPerAttribute,a}toJSON(s){const a=super.toJSON(s);return a.isInstancedInterleavedBuffer=!0,a.meshPerAttribute=this.meshPerAttribute,a}}YM.prototype.isInstancedInterleavedBuffer=!0;class Ey{constructor(s,a,u,h,m){this.buffer=s,this.type=a,this.itemSize=u,this.elementSize=h,this.count=m,this.version=0}set needsUpdate(s){!0===s&&this.version++}setBuffer(s){return this.buffer=s,this}setType(s,a){return this.type=s,this.elementSize=a,this}setItemSize(s){return this.itemSize=s,this}setCount(s){return this.count=s,this}}function KM(f,s){return f.distance-s.distance}function ZM(f,s,a,u){if(f.layers.test(s.layers)&&f.raycast(s,a),!0===u){const h=f.children;for(let m=0,g=h.length;m<g;m++)ZM(h[m],s,a,!0)}}Ey.prototype.isGLBufferAttribute=!0;const JM=new Qe;class Mh{constructor(s=new Qe(1/0,1/0),a=new Qe(-1/0,-1/0)){this.min=s,this.max=a}set(s,a){return this.min.copy(s),this.max.copy(a),this}setFromPoints(s){this.makeEmpty();for(let a=0,u=s.length;a<u;a++)this.expandByPoint(s[a]);return this}setFromCenterAndSize(s,a){const u=JM.copy(a).multiplyScalar(.5);return this.min.copy(s).sub(u),this.max.copy(s).add(u),this}clone(){return(new this.constructor).copy(this)}copy(s){return this.min.copy(s.min),this.max.copy(s.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(s){return this.isEmpty()?s.set(0,0):s.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(s){return this.isEmpty()?s.set(0,0):s.subVectors(this.max,this.min)}expandByPoint(s){return this.min.min(s),this.max.max(s),this}expandByVector(s){return this.min.sub(s),this.max.add(s),this}expandByScalar(s){return this.min.addScalar(-s),this.max.addScalar(s),this}containsPoint(s){return!(s.x<this.min.x||s.x>this.max.x||s.y<this.min.y||s.y>this.max.y)}containsBox(s){return this.min.x<=s.min.x&&s.max.x<=this.max.x&&this.min.y<=s.min.y&&s.max.y<=this.max.y}getParameter(s,a){return a.set((s.x-this.min.x)/(this.max.x-this.min.x),(s.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(s){return!(s.max.x<this.min.x||s.min.x>this.max.x||s.max.y<this.min.y||s.min.y>this.max.y)}clampPoint(s,a){return a.copy(s).clamp(this.min,this.max)}distanceToPoint(s){return JM.copy(s).clamp(this.min,this.max).sub(s).length()}intersect(s){return this.min.max(s.min),this.max.min(s.max),this}union(s){return this.min.min(s.min),this.max.max(s.max),this}translate(s){return this.min.add(s),this.max.add(s),this}equals(s){return s.min.equals(this.min)&&s.max.equals(this.max)}}Mh.prototype.isBox2=!0;const Y1=new J,Cy=new J;class Sh{constructor(s=new J,a=new J){this.start=s,this.end=a}set(s,a){return this.start.copy(s),this.end.copy(a),this}copy(s){return this.start.copy(s.start),this.end.copy(s.end),this}getCenter(s){return s.addVectors(this.start,this.end).multiplyScalar(.5)}delta(s){return s.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(s,a){return this.delta(a).multiplyScalar(s).add(this.start)}closestPointToPointParameter(s,a){Y1.subVectors(s,this.start),Cy.subVectors(this.end,this.start);const u=Cy.dot(Cy);let m=Cy.dot(Y1)/u;return a&&(m=as(m,0,1)),m}closestPointToPoint(s,a,u){const h=this.closestPointToPointParameter(s,a);return this.delta(u).multiplyScalar(h).add(this.start)}applyMatrix4(s){return this.start.applyMatrix4(s),this.end.applyMatrix4(s),this}equals(s){return s.start.equals(this.start)&&s.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const QM=new J,su=new J,pm=new cn,of=new cn;class tS extends Io{constructor(s){const a=j0(s),u=new en,h=[],m=[],g=new Dt(0,0,1),_=new Dt(0,1,0);for(let M=0;M<a.length;M++){const C=a[M];C.parent&&C.parent.isBone&&(h.push(0,0,0),h.push(0,0,0),m.push(g.r,g.g,g.b),m.push(_.r,_.g,_.b))}u.setAttribute("position",new nn(h,3)),u.setAttribute("color",new nn(m,3)),super(u,new Bs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=s,this.bones=a,this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(s){const a=this.bones,u=this.geometry,h=u.getAttribute("position");of.copy(this.root.matrixWorld).invert();for(let m=0,g=0;m<a.length;m++){const _=a[m];_.parent&&_.parent.isBone&&(pm.multiplyMatrices(of,_.matrixWorld),su.setFromMatrixPosition(pm),h.setXYZ(g,su.x,su.y,su.z),pm.multiplyMatrices(of,_.parent.matrixWorld),su.setFromMatrixPosition(pm),h.setXYZ(g+1,su.x,su.y,su.z),g+=2)}u.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(s)}}function j0(f){const s=[];!0===f.isBone&&s.push(f);for(let a=0;a<f.children.length;a++)s.push.apply(s,j0(f.children[a]));return s}const Z1=new J,nS=new Dt,iS=new Dt;class X0 extends Io{constructor(s=10,a=10,u=4473924,h=8947848){u=new Dt(u),h=new Dt(h);const m=a/2,g=s/a,_=s/2,w=[],M=[];for(let D=0,R=0,L=-_;D<=a;D++,L+=g){w.push(-_,0,L,_,0,L),w.push(L,0,-_,L,0,_);const P=D===m?u:h;P.toArray(M,R),R+=3,P.toArray(M,R),R+=3,P.toArray(M,R),R+=3,P.toArray(M,R),R+=3}const C=new en;C.setAttribute("position",new nn(w,3)),C.setAttribute("color",new nn(M,3)),super(C,new Bs({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const $0=new J,mm=new J,Ty=new J,af=new J,qr=new mp;function Te(f,s,a,u,h,m,g){af.set(h,m,g).unproject(u);const _=s[f];if(void 0!==_){const w=a.getAttribute("position");for(let M=0,C=_.length;M<C;M++)w.setXYZ(_[M],af.x,af.y,af.z)}}const lf=new Do;class nt extends Io{constructor(s,a=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),h=new Float32Array(24),m=new en;m.setIndex(new Ni(u,1)),m.setAttribute("position",new Ni(h,3)),super(m,new Bs({color:a,toneMapped:!1})),this.object=s,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(s){if(void 0!==s&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&lf.setFromObject(this.object),lf.isEmpty())return;const a=lf.min,u=lf.max,h=this.geometry.attributes.position,m=h.array;m[0]=u.x,m[1]=u.y,m[2]=u.z,m[3]=a.x,m[4]=u.y,m[5]=u.z,m[6]=a.x,m[7]=a.y,m[8]=u.z,m[9]=u.x,m[10]=a.y,m[11]=u.z,m[12]=u.x,m[13]=u.y,m[14]=a.z,m[15]=a.x,m[16]=u.y,m[17]=a.z,m[18]=a.x,m[19]=a.y,m[20]=a.z,m[21]=u.x,m[22]=a.y,m[23]=a.z,h.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(s){return this.object=s,this.update(),this}copy(s){return Io.prototype.copy.call(this,s),this.object=s.object,this}}const We=new J;let Ne,ur;class rS extends Io{constructor(s=1){const a=[0,0,0,s,0,0,0,0,0,0,s,0,0,0,0,0,0,s],h=new en;h.setAttribute("position",new nn(a,3)),h.setAttribute("color",new nn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(h,new Bs({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(s,a,u){const h=new Dt,m=this.geometry.attributes.color.array;return h.set(s),h.toArray(m,0),h.toArray(m,3),h.set(a),h.toArray(m,6),h.toArray(m,9),h.set(u),h.toArray(m,12),h.toArray(m,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Ay=new ArrayBuffer(4),zi=new Float32Array(Ay),cf=new Uint32Array(Ay),Ua=new Uint32Array(512),fa=new Uint32Array(512);for(let f=0;f<256;++f){const s=f-127;s<-27?(Ua[f]=0,Ua[256|f]=32768,fa[f]=24,fa[256|f]=24):s<-14?(Ua[f]=1024>>-s-14,Ua[256|f]=1024>>-s-14|32768,fa[f]=-s-1,fa[256|f]=-s-1):s<=15?(Ua[f]=s+15<<10,Ua[256|f]=s+15<<10|32768,fa[f]=13,fa[256|f]=13):s<128?(Ua[f]=31744,Ua[256|f]=64512,fa[f]=24,fa[256|f]=24):(Ua[f]=31744,Ua[256|f]=64512,fa[f]=13,fa[256|f]=13)}const Ft=new Uint32Array(2048),Eh=new Uint32Array(64),sS=new Uint32Array(64);for(let f=1;f<1024;++f){let s=f<<13,a=0;for(;0==(8388608&s);)s<<=1,a-=8388608;s&=-8388609,a+=947912704,Ft[f]=s|a}for(let f=1024;f<2048;++f)Ft[f]=939524096+(f-1024<<13);for(let f=1;f<31;++f)Eh[f]=f<<23;Eh[31]=1199570944,Eh[32]=2147483648;for(let f=33;f<63;++f)Eh[f]=2147483648+(f-32<<23);Eh[63]=3347054592;for(let f=1;f<64;++f)32!==f&&(sS[f]=1024);ps.create=function(f,s){return console.log("THREE.Curve.create() has been deprecated"),f.prototype=Object.create(ps.prototype),f.prototype.constructor=f,f.prototype.getPoint=s,f},pc.prototype.fromPoints=function(f){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(f)},X0.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},tS.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},No.prototype.extractUrlBase=function(f){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),xy.extractUrlBase(f)},No.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Mh.prototype.center=function(f){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(f)},Mh.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Mh.prototype.isIntersectionBox=function(f){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(f)},Mh.prototype.size=function(f){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(f)},Do.prototype.center=function(f){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(f)},Do.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Do.prototype.isIntersectionBox=function(f){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(f)},Do.prototype.isIntersectionSphere=function(f){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(f)},Do.prototype.size=function(f){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(f)},Ss.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Wu.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},yp.prototype.setFromMatrix=function(f){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(f)},Sh.prototype.center=function(f){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(f)},ir.prototype.flattenToArrayOffset=function(f,s){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(f,s)},ir.prototype.multiplyVector3=function(f){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),f.applyMatrix3(this)},ir.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},ir.prototype.applyToBufferAttribute=function(f){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),f.applyMatrix3(this)},ir.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},ir.prototype.getInverse=function(f){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(f).invert()},cn.prototype.extractPosition=function(f){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(f)},cn.prototype.flattenToArrayOffset=function(f,s){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(f,s)},cn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new J).setFromMatrixColumn(this,3)},cn.prototype.setRotationFromQuaternion=function(f){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(f)},cn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},cn.prototype.multiplyVector3=function(f){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),f.applyMatrix4(this)},cn.prototype.multiplyVector4=function(f){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),f.applyMatrix4(this)},cn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},cn.prototype.rotateAxis=function(f){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),f.transformDirection(this)},cn.prototype.crossVector=function(f){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),f.applyMatrix4(this)},cn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},cn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},cn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},cn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},cn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},cn.prototype.applyToBufferAttribute=function(f){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),f.applyMatrix4(this)},cn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},cn.prototype.makeFrustum=function(f,s,a,u,h,m){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(f,s,u,a,h,m)},cn.prototype.getInverse=function(f){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(f).invert()},io.prototype.isIntersectionLine=function(f){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(f)},no.prototype.multiplyVector3=function(f){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),f.applyQuaternion(this)},no.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Wo.prototype.isIntersectionBox=function(f){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(f)},Wo.prototype.isIntersectionPlane=function(f){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(f)},Wo.prototype.isIntersectionSphere=function(f){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(f)},Gr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Gr.prototype.barycoordFromPoint=function(f,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(f,s)},Gr.prototype.midpoint=function(f){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(f)},Gr.prototypenormal=function(f){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(f)},Gr.prototype.plane=function(f){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(f)},Gr.barycoordFromPoint=function(f,s,a,u,h){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Gr.getBarycoord(f,s,a,u,h)},Gr.normal=function(f,s,a,u){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Gr.getNormal(f,s,a,u)},gc.prototype.extractAllPoints=function(f){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(f)},gc.prototype.extrude=function(f){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new yc(this,f)},gc.prototype.makeGeometry=function(f){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jc(this,f)},Qe.prototype.fromAttribute=function(f,s,a){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(f,s,a)},Qe.prototype.distanceToManhattan=function(f){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(f)},Qe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},J.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},J.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},J.prototype.getPositionFromMatrix=function(f){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(f)},J.prototype.getScaleFromMatrix=function(f){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(f)},J.prototype.getColumnFromMatrix=function(f,s){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(s,f)},J.prototype.applyProjection=function(f){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(f)},J.prototype.fromAttribute=function(f,s,a){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(f,s,a)},J.prototype.distanceToManhattan=function(f){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(f)},J.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Xi.prototype.fromAttribute=function(f,s,a){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(f,s,a)},Xi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ci.prototype.getChildByName=function(f){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(f)},Ci.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ci.prototype.translate=function(f,s){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(s,f)},Ci.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ci.prototype.applyMatrix=function(f){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(f)},Object.defineProperties(Ci.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(f){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=f}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Jr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Jr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Wd.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Os.prototype.setLens=function(f,s){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==s&&(this.filmGauge=s),this.setFocalLength(f)},Object.defineProperties(ha.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(f){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=f}},shadowCameraLeft:{set:function(f){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=f}},shadowCameraRight:{set:function(f){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=f}},shadowCameraTop:{set:function(f){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=f}},shadowCameraBottom:{set:function(f){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=f}},shadowCameraNear:{set:function(f){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=f}},shadowCameraFar:{set:function(f){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=f}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(f){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=f}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(f){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=f}},shadowMapHeight:{set:function(f){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=f}}}),Object.defineProperties(Ni.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Cn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Cn)}}}),Ni.prototype.setDynamic=function(f){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===f?Cn:hd),this},Ni.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ni.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},en.prototype.addIndex=function(f){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(f)},en.prototype.addAttribute=function(f,s){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),s&&s.isBufferAttribute||s&&s.isInterleavedBufferAttribute?"index"===f?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(s),this):this.setAttribute(f,s):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(f,new Ni(arguments[1],arguments[2])))},en.prototype.addDrawCall=function(f,s,a){void 0!==a&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(f,s)},en.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},en.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},en.prototype.removeAttribute=function(f){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(f)},en.prototype.applyMatrix=function(f){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(f)},Object.defineProperties(en.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),zd.prototype.setDynamic=function(f){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===f?Cn:hd),this},zd.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},yc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},yc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},yc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Bp.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},W0.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Qt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Dt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(f){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===f}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(f){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=f}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ra.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(f){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=f}}}),lr.prototype.clearTarget=function(f,s,a,u){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(f),this.clear(s,a,u)},lr.prototype.animate=function(f){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(f)},lr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},lr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},lr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},lr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},lr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},lr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},lr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},lr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},lr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},lr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},lr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},lr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},lr.prototype.enableScissorTest=function(f){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(f)},lr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},lr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},lr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},lr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},lr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},lr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},lr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},lr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},lr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},lr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(lr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(f){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=f}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(f){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=f}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(f){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===f?Dr:Ls}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(t0.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(cs.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(f){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=f}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(f){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=f}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(f){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=f}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(f){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=f}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(f){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=f}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(f){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=f}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(f){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=f}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(f){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=f}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(f){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=f}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(f){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=f}}}),iu.prototype.load=function(f){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const s=this;return(new rl).load(f,function(u){s.setBuffer(u)}),this},z0.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$u.prototype.updateCubeMap=function(f,s){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(f,s)},$u.prototype.clear=function(f,s,a,u){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(f,s,a,u)},Ma.crossOrigin=void 0,Ma.loadTexture=function(f,s,a,u){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const h=new V1;h.setCrossOrigin(this.crossOrigin);const m=h.load(f,a,void 0,u);return s&&(m.mapping=s),m},Ma.loadTextureCube=function(f,s,a,u){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const h=new NM;h.setCrossOrigin(this.crossOrigin);const m=h.load(f,a,void 0,u);return s&&(m.mapping=s),m},Ma.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ma.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const bS={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139"),O.ACESFilmicToneMapping=4,O.AddEquation=100,O.AddOperation=2,O.AdditiveAnimationBlendMode=2501,O.AdditiveBlending=2,O.AlphaFormat=1021,O.AlwaysDepth=1,O.AlwaysStencilFunc=519,O.AmbientLight=k0,O.AmbientLightProbe=ro,O.AnimationClip=Jd,O.AnimationLoader=class N2 extends No{constructor(s){super(s)}load(s,a,u,h){const m=this,g=new il(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(s,function(_){try{a(m.parse(JSON.parse(_)))}catch(w){h?h(w):console.error(w),m.manager.itemError(s)}},u,h)}parse(s){const a=[];for(let u=0;u<s.length;u++){const h=Jd.parse(s[u]);a.push(h)}return a}},O.AnimationMixer=$M,O.AnimationObjectGroup=G0,O.AnimationUtils=Er,O.ArcCurve=m0,O.ArrayCamera=Ud,O.ArrowHelper=class V2 extends Ci{constructor(s=new J(0,0,1),a=new J(0,0,0),u=1,h=16776960,m=.2*u,g=.2*m){super(),this.type="ArrowHelper",void 0===Ne&&(Ne=new en,Ne.setAttribute("position",new nn([0,0,0,0,1,0],3)),ur=new mc(0,.5,1,5,1),ur.translate(0,-.5,0)),this.position.copy(a),this.line=new hc(Ne,new Bs({color:h,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Jr(ur,new bl({color:h,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(s),this.setLength(u,m,g)}setDirection(s){if(s.y>.99999)this.quaternion.set(0,0,0,1);else if(s.y<-.99999)this.quaternion.set(1,0,0,0);else{We.set(s.z,0,-s.x).normalize();const a=Math.acos(s.y);this.quaternion.setFromAxisAngle(We,a)}}setLength(s,a=.2*s,u=.2*a){this.line.scale.set(1,Math.max(1e-4,s-a),1),this.line.updateMatrix(),this.cone.scale.set(u,a,u),this.cone.position.y=s,this.cone.updateMatrix()}setColor(s){this.line.material.color.set(s),this.cone.material.color.set(s)}copy(s){return super.copy(s,!1),this.line.copy(s.line),this.cone.copy(s.cone),this}},O.Audio=iu,O.AudioAnalyser=z0,O.AudioContext=dm,O.AudioListener=class sf extends Ci{constructor(){super(),this.type="AudioListener",this.context=dm.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new xh}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(s){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=s,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(s){return this.gain.gain.setTargetAtTime(s,this.context.currentTime,.01),this}updateMatrixWorld(s){super.updateMatrixWorld(s);const a=this.context.listener,u=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Oa,wh,rf),ka.set(0,0,-1).applyQuaternion(wh),a.positionX){const h=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(Oa.x,h),a.positionY.linearRampToValueAtTime(Oa.y,h),a.positionZ.linearRampToValueAtTime(Oa.z,h),a.forwardX.linearRampToValueAtTime(ka.x,h),a.forwardY.linearRampToValueAtTime(ka.y,h),a.forwardZ.linearRampToValueAtTime(ka.z,h),a.upX.linearRampToValueAtTime(u.x,h),a.upY.linearRampToValueAtTime(u.y,h),a.upZ.linearRampToValueAtTime(u.z,h)}else a.setPosition(Oa.x,Oa.y,Oa.z),a.setOrientation(ka.x,ka.y,ka.z,u.x,u.y,u.z)}},O.AudioLoader=rl,O.AxesHelper=rS,O.AxisHelper=class aD extends rS{constructor(s){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),super(s)}},O.BackSide=1,O.BasicDepthPacking=3200,O.BasicShadowMap=0,O.BinaryTextureLoader=class xS extends U1{constructor(s){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),super(s)}},O.Bone=jp,O.BooleanKeyframeTrack=Na,O.BoundingBoxHelper=class lD extends nt{constructor(s,a){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),super(s,a)}},O.Box2=Mh,O.Box3=Do,O.Box3Helper=class Y0 extends Io{constructor(s,a=16776960){const u=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),m=new en;m.setIndex(new Ni(u,1)),m.setAttribute("position",new nn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(m,new Bs({color:a,toneMapped:!1})),this.box=s,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(s){const a=this.box;a.isEmpty()||(a.getCenter(this.position),a.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(s))}},O.BoxBufferGeometry=oc,O.BoxGeometry=oc,O.BoxHelper=nt,O.BufferAttribute=Ni,O.BufferGeometry=en,O.BufferGeometryLoader=VM,O.ByteType=1010,O.Cache=tu,O.Camera=mp,O.CameraHelper=class U2 extends Io{constructor(s){const a=new en,u=new Bs({color:16777215,vertexColors:!0,toneMapped:!1}),h=[],m=[],g={},_=new Dt(16755200),w=new Dt(16711680),M=new Dt(43775),C=new Dt(16777215),A=new Dt(3355443);function D(L,P,I){R(L,I),R(P,I)}function R(L,P){h.push(0,0,0),m.push(P.r,P.g,P.b),void 0===g[L]&&(g[L]=[]),g[L].push(h.length/3-1)}D("n1","n2",_),D("n2","n4",_),D("n4","n3",_),D("n3","n1",_),D("f1","f2",_),D("f2","f4",_),D("f4","f3",_),D("f3","f1",_),D("n1","f1",_),D("n2","f2",_),D("n3","f3",_),D("n4","f4",_),D("p","n1",w),D("p","n2",w),D("p","n3",w),D("p","n4",w),D("u1","u2",M),D("u2","u3",M),D("u3","u1",M),D("c","t",C),D("p","c",A),D("cn1","cn2",A),D("cn3","cn4",A),D("cf1","cf2",A),D("cf3","cf4",A),a.setAttribute("position",new nn(h,3)),a.setAttribute("color",new nn(m,3)),super(a,u),this.type="CameraHelper",this.camera=s,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=g,this.update()}update(){const s=this.geometry,a=this.pointMap;qr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Te("c",a,s,qr,0,0,-1),Te("t",a,s,qr,0,0,1),Te("n1",a,s,qr,-1,-1,-1),Te("n2",a,s,qr,1,-1,-1),Te("n3",a,s,qr,-1,1,-1),Te("n4",a,s,qr,1,1,-1),Te("f1",a,s,qr,-1,-1,1),Te("f2",a,s,qr,1,-1,1),Te("f3",a,s,qr,-1,1,1),Te("f4",a,s,qr,1,1,1),Te("u1",a,s,qr,.7,1.1,-1),Te("u2",a,s,qr,-.7,1.1,-1),Te("u3",a,s,qr,0,2,-1),Te("cf1",a,s,qr,-1,0,1),Te("cf2",a,s,qr,1,0,1),Te("cf3",a,s,qr,0,-1,1),Te("cf4",a,s,qr,0,1,1),Te("cn1",a,s,qr,-1,0,-1),Te("cn2",a,s,qr,1,0,-1),Te("cn3",a,s,qr,0,-1,-1),Te("cn4",a,s,qr,0,1,-1),s.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},O.CanvasRenderer=function uD(){console.error("THREE.CanvasRenderer has been removed")},O.CanvasTexture=w1,O.CapsuleBufferGeometry=hh,O.CapsuleGeometry=hh,O.CatmullRomCurve3=Dl,O.CineonToneMapping=3,O.CircleBufferGeometry=Qp,O.CircleGeometry=Qp,O.ClampToEdgeWrapping=_s,O.Clock=xh,O.Color=Dt,O.ColorKeyframeTrack=R0,O.ColorManagement=Or,O.CompressedTexture=xM,O.CompressedTextureLoader=class FM extends No{constructor(s){super(s)}load(s,a,u,h){const m=this,g=[],_=new xM,w=new il(this.manager);w.setPath(this.path),w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setWithCredentials(m.withCredentials);let M=0;function C(A){w.load(s[A],function(D){const R=m.parse(D,!0);g[A]={width:R.width,height:R.height,format:R.format,mipmaps:R.mipmaps},M+=1,6===M&&(1===R.mipmapCount&&(_.minFilter=Hr),_.image=g,_.format=R.format,_.needsUpdate=!0,a&&a(_))},u,h)}if(Array.isArray(s))for(let A=0,D=s.length;A<D;++A)C(A);else w.load(s,function(A){const D=m.parse(A,!0);if(D.isCubemap){const R=D.mipmaps.length/D.mipmapCount;for(let L=0;L<R;L++){g[L]={mipmaps:[]};for(let P=0;P<D.mipmapCount;P++)g[L].mipmaps.push(D.mipmaps[L*D.mipmapCount+P]),g[L].format=D.format,g[L].width=D.width,g[L].height=D.height}_.image=g}else _.image.width=D.width,_.image.height=D.height,_.mipmaps=D.mipmaps;1===D.mipmapCount&&(_.minFilter=Hr),_.format=D.format,_.needsUpdate=!0,a&&a(_)},u,h);return _}},O.ConeBufferGeometry=dh,O.ConeGeometry=dh,O.CubeCamera=$u,O.CubeReflectionMapping=Bi,O.CubeRefractionMapping=$a,O.CubeTexture=lc,O.CubeTextureLoader=NM,O.CubeUVReflectionMapping=306,O.CubicBezierCurve=fc,O.CubicBezierCurve3=ch,O.CubicInterpolant=_h,O.CullFaceBack=1,O.CullFaceFront=2,O.CullFaceFrontBack=3,O.CullFaceNone=0,O.Curve=ps,O.CurvePath=v0,O.CustomBlending=5,O.CustomToneMapping=5,O.CylinderBufferGeometry=mc,O.CylinderGeometry=mc,O.Cylindrical=class k2{constructor(s=1,a=0,u=0){return this.radius=s,this.theta=a,this.y=u,this}set(s,a,u){return this.radius=s,this.theta=a,this.y=u,this}copy(s){return this.radius=s.radius,this.theta=s.theta,this.y=s.y,this}setFromVector3(s){return this.setFromCartesianCoords(s.x,s.y,s.z)}setFromCartesianCoords(s,a,u){return this.radius=Math.sqrt(s*s+u*u),this.theta=Math.atan2(s,u),this.y=a,this}clone(){return(new this.constructor).copy(this)}},O.Data3DTexture=yl,O.DataArrayTexture=ws,O.DataTexture=uc,O.DataTexture2DArray=class Ch extends ws{constructor(s,a,u,h){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(s,a,u,h)}},O.DataTexture3D=class Nl extends yl{constructor(s,a,u,h){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(s,a,u,h)}},O.DataTextureLoader=U1,O.DataUtils=class Z0{static toHalfFloat(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=as(s,-65504,65504),zi[0]=s;const a=cf[0],u=a>>23&511;return Ua[u]+((8388607&a)>>fa[u])}static fromHalfFloat(s){const a=s>>10;return cf[0]=Ft[sS[a]+(1023&s)]+Eh[a],zi[0]}},O.DecrementStencilOp=7683,O.DecrementWrapStencilOp=34056,O.DefaultLoadingManager=LM,O.DepthFormat=vn,O.DepthStencilFormat=mr,O.DepthTexture=Op,O.DirectionalLight=Vi,O.DirectionalLightHelper=class B2 extends Ci{constructor(s,a,u){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=u,void 0===a&&(a=1);let h=new en;h.setAttribute("position",new nn([-a,a,0,a,a,0,a,-a,0,-a,-a,0,-a,a,0],3));const m=new Bs({fog:!1,toneMapped:!1});this.lightPlane=new hc(h,m),this.add(this.lightPlane),h=new en,h.setAttribute("position",new nn([0,0,0,0,0,1],3)),this.targetLine=new hc(h,m),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){$0.setFromMatrixPosition(this.light.matrixWorld),mm.setFromMatrixPosition(this.light.target.matrixWorld),Ty.subVectors(mm,$0),this.lightPlane.lookAt(mm),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(mm),this.targetLine.scale.z=Ty.length()}},O.DiscreteInterpolant=DM,O.DodecahedronBufferGeometry=fh,O.DodecahedronGeometry=fh,O.DoubleSide=2,O.DstAlphaFactor=206,O.DstColorFactor=208,O.DynamicBufferAttribute=class fS extends Ni{constructor(s,a){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),super(s,a),this.setUsage(Cn)}},O.DynamicCopyUsage=35050,O.DynamicDrawUsage=Cn,O.DynamicReadUsage=35049,O.EdgesGeometry=x0,O.EdgesHelper=class _S extends Io{constructor(s,a){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),super(new x0(s.geometry),new Bs({color:void 0!==a?a:16777215}))}},O.EllipseCurve=ah,O.EqualDepth=4,O.EqualStencilFunc=514,O.EquirectangularReflectionMapping=303,O.EquirectangularRefractionMapping=304,O.Euler=Ss,O.EventDispatcher=zc,O.ExtrudeBufferGeometry=yc,O.ExtrudeGeometry=yc,O.FaceColors=1,O.FileLoader=il,O.FlatShading=1,O.Float16BufferAttribute=ds,O.Float32Attribute=class Ts extends nn{constructor(s,a){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),super(s,a)}},O.Float32BufferAttribute=nn,O.Float64Attribute=class yS extends bd{constructor(s,a){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),super(s,a)}},O.Float64BufferAttribute=bd,O.FloatType=W,O.Fog=rh,O.FogExp2=Vd,O.Font=function hf(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},O.FontLoader=function Qr(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},O.FramebufferTexture=b1,O.FrontSide=0,O.Frustum=yp,O.GLBufferAttribute=Ey,O.GLSL1="100",O.GLSL3=Ob,O.GreaterDepth=6,O.GreaterEqualDepth=5,O.GreaterEqualStencilFunc=518,O.GreaterStencilFunc=516,O.GridHelper=X0,O.Group=Yc,O.HalfFloatType=re,O.HemisphereLight=I0,O.HemisphereLightHelper=class J1 extends Ci{constructor(s,a,u){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=u;const h=new mh(a);h.rotateY(.5*Math.PI),this.material=new bl({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const m=h.getAttribute("position"),g=new Float32Array(3*m.count);h.setAttribute("color",new Ni(g,3)),this.add(new Jr(h,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const s=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const a=s.geometry.getAttribute("color");nS.copy(this.light.color),iS.copy(this.light.groundColor);for(let u=0,h=a.count;u<h;u++){const m=u<h/2?nS:iS;a.setXYZ(u,m.r,m.g,m.b)}a.needsUpdate=!0}s.lookAt(Z1.setFromMatrixPosition(this.light.matrixWorld).negate())}},O.HemisphereLightProbe=nf,O.IcosahedronBufferGeometry=rm,O.IcosahedronGeometry=rm,O.ImageBitmapLoader=HM,O.ImageLoader=cm,O.ImageUtils=Ma,O.ImmediateRenderObject=function Fl(){console.error("THREE.ImmediateRenderObject has been removed.")},O.IncrementStencilOp=7682,O.IncrementWrapStencilOp=34055,O.InstancedBufferAttribute=Al,O.InstancedBufferGeometry=U0,O.InstancedInterleavedBuffer=YM,O.InstancedMesh=mM,O.Int16Attribute=class rD extends Qb{constructor(s,a){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),super(s,a)}},O.Int16BufferAttribute=Qb,O.Int32Attribute=class gS extends Ri{constructor(s,a){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),super(s,a)}},O.Int32BufferAttribute=Ri,O.Int8Attribute=class pS extends Zb{constructor(s,a){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),super(s,a)}},O.Int8BufferAttribute=Zb,O.IntType=1013,O.InterleavedBuffer=zd,O.InterleavedBufferAttribute=Kc,O.Interpolant=Il,O.InterpolateDiscrete=Bu,O.InterpolateLinear=In,O.InterpolateSmooth=2302,O.InvertStencilOp=5386,O.JSONLoader=function hD(){console.error("THREE.JSONLoader has been removed.")},O.KeepStencilOp=7680,O.KeyframeTrack=nl,O.LOD=qp,O.LatheBufferGeometry=uh,O.LatheGeometry=uh,O.Layers=_d,O.LensFlare=function dD(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},O.LessDepth=2,O.LessEqualDepth=3,O.LessEqualStencilFunc=515,O.LessStencilFunc=513,O.Light=ha,O.LightProbe=hm,O.Line=hc,O.Line3=Sh,O.LineBasicMaterial=Bs,O.LineCurve=Rl,O.LineCurve3=bM,O.LineDashedMaterial=am,O.LineLoop=d0,O.LinePieces=1,O.LineSegments=Io,O.LineStrip=0,O.LinearEncoding=Ls,O.LinearFilter=Hr,O.LinearInterpolant=_y,O.LinearMipMapLinearFilter=1008,O.LinearMipMapNearestFilter=1007,O.LinearMipmapLinearFilter=Ya,O.LinearMipmapNearestFilter=1007,O.LinearSRGBColorSpace=zu,O.LinearToneMapping=1,O.Loader=No,O.LoaderUtils=xy,O.LoadingManager=P0,O.LoopOnce=2200,O.LoopPingPong=2202,O.LoopRepeat=2201,O.LuminanceAlphaFormat=1025,O.LuminanceFormat=1024,O.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},O.Material=Qt,O.MaterialLoader=UM,O.Math=tc,O.MathUtils=tc,O.Matrix3=ir,O.Matrix4=cn,O.MaxEquation=104,O.Mesh=Jr,O.MeshBasicMaterial=bl,O.MeshDepthMaterial=ih,O.MeshDistanceMaterial=Jg,O.MeshFaceMaterial=function nD(f){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),f},O.MeshLambertMaterial=yy,O.MeshMatcapMaterial=D0,O.MeshNormalMaterial=gy,O.MeshPhongMaterial=om,O.MeshPhysicalMaterial=A0,O.MeshStandardMaterial=eu,O.MeshToonMaterial=my,O.MinEquation=103,O.MirroredRepeatWrapping=ad,O.MixOperation=1,O.MultiMaterial=function iD(f=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),f.isMultiMaterial=!0,f.materials=f,f.clone=function(){return f.slice()},f},O.MultiplyBlending=4,O.MultiplyOperation=0,O.NearestFilter=zr,O.NearestMipMapLinearFilter=1005,O.NearestMipMapNearestFilter=1004,O.NearestMipmapLinearFilter=1005,O.NearestMipmapNearestFilter=1004,O.NeverDepth=0,O.NeverStencilFunc=512,O.NoBlending=0,O.NoColorSpace="",O.NoColors=0,O.NoToneMapping=0,O.NormalAnimationBlendMode=2500,O.NormalBlending=1,O.NotEqualDepth=7,O.NotEqualStencilFunc=517,O.NumberKeyframeTrack=lm,O.Object3D=Ci,O.ObjectLoader=class by extends No{constructor(s){super(s)}load(s,a,u,h){const m=this,g=""===this.path?xy.extractUrlBase(s):this.path;this.resourcePath=this.resourcePath||g;const _=new il(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(s,function(w){let M=null;try{M=JSON.parse(w)}catch(A){return void 0!==h&&h(A),void console.error("THREE:ObjectLoader: Can't parse "+s+".",A.message)}const C=M.metadata;void 0!==C&&void 0!==C.type&&"geometry"!==C.type.toLowerCase()?m.parse(M,a):console.error("THREE.ObjectLoader: Can't load "+s)},u,h)}loadAsync(s,a){var u=this;return uo(function*(){const h=u,m=""===u.path?xy.extractUrlBase(s):u.path;u.resourcePath=u.resourcePath||m;const g=new il(u.manager);g.setPath(u.path),g.setRequestHeader(u.requestHeader),g.setWithCredentials(u.withCredentials);const _=yield g.loadAsync(s,a),w=JSON.parse(_),M=w.metadata;if(void 0===M||void 0===M.type||"geometry"===M.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+s);return yield h.parseAsync(w)})()}parse(s,a){const u=this.parseAnimations(s.animations),h=this.parseShapes(s.shapes),m=this.parseGeometries(s.geometries,h),g=this.parseImages(s.images,function(){void 0!==a&&a(M)}),_=this.parseTextures(s.textures,g),w=this.parseMaterials(s.materials,_),M=this.parseObject(s.object,m,w,_,u),C=this.parseSkeletons(s.skeletons,M);if(this.bindSkeletons(M,C),void 0!==a){let A=!1;for(const D in g)if(g[D]instanceof HTMLImageElement){A=!0;break}!1===A&&a(M)}return M}parseAsync(s){var a=this;return uo(function*(){const u=a.parseAnimations(s.animations),h=a.parseShapes(s.shapes),m=a.parseGeometries(s.geometries,h),g=yield a.parseImagesAsync(s.images),_=a.parseTextures(s.textures,g),w=a.parseMaterials(s.materials,_),M=a.parseObject(s.object,m,w,_,u),C=a.parseSkeletons(s.skeletons,M);return a.bindSkeletons(M,C),M})()}parseShapes(s){const a={};if(void 0!==s)for(let u=0,h=s.length;u<h;u++){const m=(new gc).fromJSON(s[u]);a[m.uuid]=m}return a}parseSkeletons(s,a){const u={},h={};if(a.traverse(function(m){m.isBone&&(h[m.uuid]=m)}),void 0!==s)for(let m=0,g=s.length;m<g;m++){const _=(new c0).fromJSON(s[m],h);u[_.uuid]=_}return u}parseGeometries(s,a){const u={};if(void 0!==s){const h=new VM;for(let m=0,g=s.length;m<g;m++){let _;const w=s[m];switch(w.type){case"BufferGeometry":case"InstancedBufferGeometry":_=h.parse(w);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:w.type in fy?_=fy[w.type].fromJSON(w,a):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${w.type}"`)}_.uuid=w.uuid,void 0!==w.name&&(_.name=w.name),!0===_.isBufferGeometry&&void 0!==w.userData&&(_.userData=w.userData),u[w.uuid]=_}}return u}parseMaterials(s,a){const u={},h={};if(void 0!==s){const m=new UM;m.setTextures(a);for(let g=0,_=s.length;g<_;g++){const w=s[g];if("MultiMaterial"===w.type){const M=[];for(let C=0;C<w.materials.length;C++){const A=w.materials[C];void 0===u[A.uuid]&&(u[A.uuid]=m.parse(A)),M.push(u[A.uuid])}h[w.uuid]=M}else void 0===u[w.uuid]&&(u[w.uuid]=m.parse(w)),h[w.uuid]=u[w.uuid]}}return h}parseAnimations(s){const a={};if(void 0!==s)for(let u=0;u<s.length;u++){const m=Jd.parse(s[u]);a[m.uuid]=m}return a}parseImages(s,a){const u=this,h={};let m;function _(w){if("string"==typeof w){const M=w;return function g(w){return u.manager.itemStart(w),m.load(w,function(){u.manager.itemEnd(w)},void 0,function(){u.manager.itemError(w),u.manager.itemEnd(w)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(M)?M:u.resourcePath+M)}return w.data?{data:gl(w.type,w.data),width:w.width,height:w.height}:null}if(void 0!==s&&s.length>0){const w=new P0(a);m=new cm(w),m.setCrossOrigin(this.crossOrigin);for(let M=0,C=s.length;M<C;M++){const A=s[M],D=A.url;if(Array.isArray(D)){const R=[];for(let L=0,P=D.length;L<P;L++){const z=_(D[L]);null!==z&&(z instanceof HTMLImageElement?R.push(z):R.push(new uc(z.data,z.width,z.height)))}h[A.uuid]=new Sa(R)}else{const R=_(A.url);h[A.uuid]=new Sa(R)}}}return h}parseImagesAsync(s){var a=this;return uo(function*(){const u=a,h={};let m;function g(w){return _.apply(this,arguments)}function _(){return(_=uo(function*(w){if("string"==typeof w){const M=w,C=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(M)?M:u.resourcePath+M;return yield m.loadAsync(C)}return w.data?{data:gl(w.type,w.data),width:w.width,height:w.height}:null})).apply(this,arguments)}if(void 0!==s&&s.length>0){m=new cm(a.manager),m.setCrossOrigin(a.crossOrigin);for(let w=0,M=s.length;w<M;w++){const C=s[w],A=C.url;if(Array.isArray(A)){const D=[];for(let R=0,L=A.length;R<L;R++){const P=A[R],I=yield g(P);null!==I&&(I instanceof HTMLImageElement?D.push(I):D.push(new uc(I.data,I.width,I.height)))}h[C.uuid]=new Sa(D)}else{const D=yield g(C.url);h[C.uuid]=new Sa(D)}}}return h})()}parseTextures(s,a){function u(m,g){return"number"==typeof m?m:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",m),g[m])}const h={};if(void 0!==s)for(let m=0,g=s.length;m<g;m++){const _=s[m];void 0===_.image&&console.warn('THREE.ObjectLoader: No "image" specified for',_.uuid),void 0===a[_.image]&&console.warn("THREE.ObjectLoader: Undefined image",_.image);const w=a[_.image],M=w.data;let C;Array.isArray(M)?(C=new lc,6===M.length&&(C.needsUpdate=!0)):(C=M&&M.data?new uc:new ls,M&&(C.needsUpdate=!0)),C.source=w,C.uuid=_.uuid,void 0!==_.name&&(C.name=_.name),void 0!==_.mapping&&(C.mapping=u(_.mapping,ef)),void 0!==_.offset&&C.offset.fromArray(_.offset),void 0!==_.repeat&&C.repeat.fromArray(_.repeat),void 0!==_.center&&C.center.fromArray(_.center),void 0!==_.rotation&&(C.rotation=_.rotation),void 0!==_.wrap&&(C.wrapS=u(_.wrap[0],zM),C.wrapT=u(_.wrap[1],zM)),void 0!==_.format&&(C.format=_.format),void 0!==_.type&&(C.type=_.type),void 0!==_.encoding&&(C.encoding=_.encoding),void 0!==_.minFilter&&(C.minFilter=u(_.minFilter,tf)),void 0!==_.magFilter&&(C.magFilter=u(_.magFilter,tf)),void 0!==_.anisotropy&&(C.anisotropy=_.anisotropy),void 0!==_.flipY&&(C.flipY=_.flipY),void 0!==_.premultiplyAlpha&&(C.premultiplyAlpha=_.premultiplyAlpha),void 0!==_.unpackAlignment&&(C.unpackAlignment=_.unpackAlignment),void 0!==_.userData&&(C.userData=_.userData),h[_.uuid]=C}return h}parseObject(s,a,u,h,m){let g,C,A;function _(D){return void 0===a[D]&&console.warn("THREE.ObjectLoader: Undefined geometry",D),a[D]}function w(D){if(void 0!==D){if(Array.isArray(D)){const R=[];for(let L=0,P=D.length;L<P;L++){const I=D[L];void 0===u[I]&&console.warn("THREE.ObjectLoader: Undefined material",I),R.push(u[I])}return R}return void 0===u[D]&&console.warn("THREE.ObjectLoader: Undefined material",D),u[D]}}function M(D){return void 0===h[D]&&console.warn("THREE.ObjectLoader: Undefined texture",D),h[D]}switch(s.type){case"Scene":g=new Bp,void 0!==s.background&&(g.background=Number.isInteger(s.background)?new Dt(s.background):M(s.background)),void 0!==s.environment&&(g.environment=M(s.environment)),void 0!==s.fog&&("Fog"===s.fog.type?g.fog=new rh(s.fog.color,s.fog.near,s.fog.far):"FogExp2"===s.fog.type&&(g.fog=new Vd(s.fog.color,s.fog.density)));break;case"PerspectiveCamera":g=new Os(s.fov,s.aspect,s.near,s.far),void 0!==s.focus&&(g.focus=s.focus),void 0!==s.zoom&&(g.zoom=s.zoom),void 0!==s.filmGauge&&(g.filmGauge=s.filmGauge),void 0!==s.filmOffset&&(g.filmOffset=s.filmOffset),void 0!==s.view&&(g.view=Object.assign({},s.view));break;case"OrthographicCamera":g=new Ap(s.left,s.right,s.top,s.bottom,s.near,s.far),void 0!==s.zoom&&(g.zoom=s.zoom),void 0!==s.view&&(g.view=Object.assign({},s.view));break;case"AmbientLight":g=new k0(s.color,s.intensity);break;case"DirectionalLight":g=new Vi(s.color,s.intensity);break;case"PointLight":g=new BM(s.color,s.intensity,s.distance,s.decay);break;case"RectAreaLight":g=new um(s.color,s.intensity,s.width,s.height);break;case"SpotLight":g=new OM(s.color,s.intensity,s.distance,s.angle,s.penumbra,s.decay);break;case"HemisphereLight":g=new I0(s.color,s.groundColor,s.intensity);break;case"LightProbe":g=(new hm).fromJSON(s);break;case"SkinnedMesh":C=_(s.geometry),A=w(s.material),g=new Wd(C,A),void 0!==s.bindMode&&(g.bindMode=s.bindMode),void 0!==s.bindMatrix&&g.bindMatrix.fromArray(s.bindMatrix),void 0!==s.skeleton&&(g.skeleton=s.skeleton);break;case"Mesh":C=_(s.geometry),A=w(s.material),g=new Jr(C,A);break;case"InstancedMesh":C=_(s.geometry),A=w(s.material);const R=s.instanceMatrix,L=s.instanceColor;g=new mM(C,A,s.count),g.instanceMatrix=new Al(new Float32Array(R.array),16),void 0!==L&&(g.instanceColor=new Al(new Float32Array(L.array),L.itemSize));break;case"LOD":g=new qp;break;case"Line":g=new hc(_(s.geometry),w(s.material));break;case"LineLoop":g=new d0(_(s.geometry),w(s.material));break;case"LineSegments":g=new Io(_(s.geometry),w(s.material));break;case"PointCloud":case"Points":g=new iy(_(s.geometry),w(s.material));break;case"Sprite":g=new kn(w(s.material));break;case"Group":g=new Yc;break;case"Bone":g=new jp;break;default:g=new Ci}if(g.uuid=s.uuid,void 0!==s.name&&(g.name=s.name),void 0!==s.matrix?(g.matrix.fromArray(s.matrix),void 0!==s.matrixAutoUpdate&&(g.matrixAutoUpdate=s.matrixAutoUpdate),g.matrixAutoUpdate&&g.matrix.decompose(g.position,g.quaternion,g.scale)):(void 0!==s.position&&g.position.fromArray(s.position),void 0!==s.rotation&&g.rotation.fromArray(s.rotation),void 0!==s.quaternion&&g.quaternion.fromArray(s.quaternion),void 0!==s.scale&&g.scale.fromArray(s.scale)),void 0!==s.castShadow&&(g.castShadow=s.castShadow),void 0!==s.receiveShadow&&(g.receiveShadow=s.receiveShadow),s.shadow&&(void 0!==s.shadow.bias&&(g.shadow.bias=s.shadow.bias),void 0!==s.shadow.normalBias&&(g.shadow.normalBias=s.shadow.normalBias),void 0!==s.shadow.radius&&(g.shadow.radius=s.shadow.radius),void 0!==s.shadow.mapSize&&g.shadow.mapSize.fromArray(s.shadow.mapSize),void 0!==s.shadow.camera&&(g.shadow.camera=this.parseObject(s.shadow.camera))),void 0!==s.visible&&(g.visible=s.visible),void 0!==s.frustumCulled&&(g.frustumCulled=s.frustumCulled),void 0!==s.renderOrder&&(g.renderOrder=s.renderOrder),void 0!==s.userData&&(g.userData=s.userData),void 0!==s.layers&&(g.layers.mask=s.layers),void 0!==s.children){const D=s.children;for(let R=0;R<D.length;R++)g.add(this.parseObject(D[R],a,u,h,m))}if(void 0!==s.animations){const D=s.animations;for(let R=0;R<D.length;R++)g.animations.push(m[D[R]])}if("LOD"===s.type){void 0!==s.autoUpdate&&(g.autoUpdate=s.autoUpdate);const D=s.levels;for(let R=0;R<D.length;R++){const L=D[R],P=g.getObjectByProperty("uuid",L.object);void 0!==P&&g.addLevel(P,L.distance)}}return g}bindSkeletons(s,a){0!==Object.keys(a).length&&s.traverse(function(u){if(!0===u.isSkinnedMesh&&void 0!==u.skeleton){const h=a[u.skeleton];void 0===h?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",u.skeleton):u.bind(h,u.bindMatrix)}})}setTexturePath(s){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(s)}},O.ObjectSpaceNormalMap=1,O.OctahedronBufferGeometry=mh,O.OctahedronGeometry=mh,O.OneFactor=201,O.OneMinusDstAlphaFactor=207,O.OneMinusDstColorFactor=209,O.OneMinusSrcAlphaFactor=205,O.OneMinusSrcColorFactor=203,O.OrthographicCamera=Ap,O.PCFShadowMap=1,O.PCFSoftShadowMap=2,O.PMREMGenerator=Ov,O.ParametricGeometry=class wS extends en{constructor(){console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),super()}},O.Particle=class Q0 extends kn{constructor(s){console.warn("THREE.Particle has been renamed to THREE.Sprite."),super(s)}},O.ParticleBasicMaterial=class uS extends dc{constructor(s){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),super(s)}},O.ParticleSystem=class lS extends iy{constructor(s,a){console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),super(s,a)}},O.ParticleSystemMaterial=class hS extends dc{constructor(s){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),super(s)}},O.Path=pc,O.PerspectiveCamera=Os,O.Plane=io,O.PlaneBufferGeometry=Ku,O.PlaneGeometry=Ku,O.PlaneHelper=class eD extends hc{constructor(s,a=1,u=16776960){const h=u,g=new en;g.setAttribute("position",new nn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),g.computeBoundingSphere(),super(g,new Bs({color:h,toneMapped:!1})),this.type="PlaneHelper",this.plane=s,this.size=a;const w=new en;w.setAttribute("position",new nn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),w.computeBoundingSphere(),this.add(new Jr(w,new bl({color:h,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(s){let a=-this.plane.constant;Math.abs(a)<1e-8&&(a=1e-8),this.scale.set(.5*this.size,.5*this.size,a),this.children[0].material.side=a<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(s)}},O.PointCloud=class $o extends iy{constructor(s,a){console.warn("THREE.PointCloud has been renamed to THREE.Points."),super(s,a)}},O.PointCloudMaterial=class cS extends dc{constructor(s){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),super(s)}},O.PointLight=BM,O.PointLightHelper=class K1 extends Jr{constructor(s,a,u){super(new Qc(a,4,2),new bl({wireframe:!0,fog:!1,toneMapped:!1})),this.light=s,this.light.updateMatrixWorld(),this.color=u,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},O.Points=iy,O.PointsMaterial=dc,O.PolarGridHelper=class Q1 extends Io{constructor(s=10,a=16,u=8,h=64,m=4473924,g=8947848){m=new Dt(m),g=new Dt(g);const _=[],w=[];for(let A=0;A<=a;A++){const D=A/a*(2*Math.PI),R=Math.sin(D)*s,L=Math.cos(D)*s;_.push(0,0,0),_.push(R,0,L);const P=1&A?m:g;w.push(P.r,P.g,P.b),w.push(P.r,P.g,P.b)}for(let A=0;A<=u;A++){const D=1&A?m:g,R=s-s/u*A;for(let L=0;L<h;L++){let P=L/h*(2*Math.PI),I=Math.sin(P)*R,z=Math.cos(P)*R;_.push(I,0,z),w.push(D.r,D.g,D.b),P=(L+1)/h*(2*Math.PI),I=Math.sin(P)*R,z=Math.cos(P)*R,_.push(I,0,z),w.push(D.r,D.g,D.b)}}const M=new en;M.setAttribute("position",new nn(_,3)),M.setAttribute("color",new nn(w,3)),super(M,new Bs({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},O.PolyhedronBufferGeometry=Pl,O.PolyhedronGeometry=Pl,O.PositionalAudio=class WM extends iu{constructor(s){super(s),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(s){return this.panner.refDistance=s,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(s){return this.panner.rolloffFactor=s,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(s){return this.panner.distanceModel=s,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(s){return this.panner.maxDistance=s,this}setDirectionalCone(s,a,u){return this.panner.coneInnerAngle=s,this.panner.coneOuterAngle=a,this.panner.coneOuterGain=u,this}updateMatrixWorld(s){if(super.updateMatrixWorld(s),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ba,V0,GM),ru.set(0,0,1).applyQuaternion(V0);const a=this.panner;if(a.positionX){const u=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(Ba.x,u),a.positionY.linearRampToValueAtTime(Ba.y,u),a.positionZ.linearRampToValueAtTime(Ba.z,u),a.orientationX.linearRampToValueAtTime(ru.x,u),a.orientationY.linearRampToValueAtTime(ru.y,u),a.orientationZ.linearRampToValueAtTime(ru.z,u)}else a.setPosition(Ba.x,Ba.y,Ba.z),a.setOrientation(ru.x,ru.y,ru.z)}},O.PropertyBinding=wr,O.PropertyMixer=H0,O.QuadraticBezierCurve=Kp,O.QuadraticBezierCurve3=Zp,O.Quaternion=no,O.QuaternionKeyframeTrack=Zd,O.QuaternionLinearInterpolant=RM,O.REVISION="139",O.RGBADepthPacking=3201,O.RGBAFormat=At,O.RGBAIntegerFormat=1033,O.RGBA_ASTC_10x10_Format=37819,O.RGBA_ASTC_10x5_Format=37816,O.RGBA_ASTC_10x6_Format=37817,O.RGBA_ASTC_10x8_Format=37818,O.RGBA_ASTC_12x10_Format=37820,O.RGBA_ASTC_12x12_Format=37821,O.RGBA_ASTC_4x4_Format=37808,O.RGBA_ASTC_5x4_Format=37809,O.RGBA_ASTC_5x5_Format=37810,O.RGBA_ASTC_6x5_Format=37811,O.RGBA_ASTC_6x6_Format=37812,O.RGBA_ASTC_8x5_Format=37813,O.RGBA_ASTC_8x6_Format=37814,O.RGBA_ASTC_8x8_Format=37815,O.RGBA_BPTC_Format=36492,O.RGBA_ETC2_EAC_Format=37496,O.RGBA_PVRTC_2BPPV1_Format=35843,O.RGBA_PVRTC_4BPPV1_Format=35842,O.RGBA_S3TC_DXT1_Format=Is,O.RGBA_S3TC_DXT3_Format=Za,O.RGBA_S3TC_DXT5_Format=xa,O.RGBFormat=1022,O.RGB_ETC1_Format=36196,O.RGB_ETC2_Format=37492,O.RGB_PVRTC_2BPPV1_Format=35841,O.RGB_PVRTC_4BPPV1_Format=35840,O.RGB_S3TC_DXT1_Format=Ar,O.RGFormat=1030,O.RGIntegerFormat=1031,O.RawShaderMaterial=sm,O.Ray=Wo,O.Raycaster=class q0{constructor(s,a,u=0,h=1/0){this.ray=new Wo(s,a),this.near=u,this.far=h,this.camera=null,this.layers=new _d,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(s,a){this.ray.set(s,a)}setFromCamera(s,a){a.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(s.x,s.y,.5).unproject(a).sub(this.ray.origin).normalize(),this.camera=a):a.isOrthographicCamera?(this.ray.origin.set(s.x,s.y,(a.near+a.far)/(a.near-a.far)).unproject(a),this.ray.direction.set(0,0,-1).transformDirection(a.matrixWorld),this.camera=a):console.error("THREE.Raycaster: Unsupported camera type: "+a.type)}intersectObject(s,a=!0,u=[]){return ZM(s,this,u,a),u.sort(KM),u}intersectObjects(s,a=!0,u=[]){for(let h=0,m=s.length;h<m;h++)ZM(s[h],this,u,a);return u.sort(KM),u}},O.RectAreaLight=um,O.RedFormat=1028,O.RedIntegerFormat=1029,O.ReinhardToneMapping=2,O.RepeatWrapping=ho,O.ReplaceStencilOp=7681,O.ReverseSubtractEquation=102,O.RingBufferGeometry=gh,O.RingGeometry=gh,O.SRGBColorSpace=ml,O.Scene=Bp,O.SceneUtils=bS,O.ShaderChunk=oi,O.ShaderLib=Ia,O.ShaderMaterial=Ra,O.ShadowMaterial=py,O.Shape=gc,O.ShapeBufferGeometry=Jc,O.ShapeGeometry=Jc,O.ShapePath=class K0{constructor(){this.type="ShapePath",this.color=new Dt,this.subPaths=[],this.currentPath=null}moveTo(s,a){return this.currentPath=new pc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(s,a),this}lineTo(s,a){return this.currentPath.lineTo(s,a),this}quadraticCurveTo(s,a,u,h){return this.currentPath.quadraticCurveTo(s,a,u,h),this}bezierCurveTo(s,a,u,h,m,g){return this.currentPath.bezierCurveTo(s,a,u,h,m,g),this}splineThru(s){return this.currentPath.splineThru(s),this}toShapes(s,a){function u(B){const j=[];for(let G=0,Y=B.length;G<Y;G++){const le=B[G],fe=new gc;fe.curves=le.curves,j.push(fe)}return j}function h(B,j){const G=j.length;let Y=!1;for(let le=G-1,fe=0;fe<G;le=fe++){let ye=j[le],Ve=j[fe],we=Ve.x-ye.x,X=Ve.y-ye.y;if(Math.abs(X)>Number.EPSILON){if(X<0&&(ye=j[fe],we=-we,Ve=j[le],X=-X),B.y<ye.y||B.y>Ve.y)continue;if(B.y===ye.y){if(B.x===ye.x)return!0}else{const he=X*(B.x-ye.x)-we*(B.y-ye.y);if(0===he)return!0;if(he<0)continue;Y=!Y}}else{if(B.y!==ye.y)continue;if(Ve.x<=B.x&&B.x<=ye.x||ye.x<=B.x&&B.x<=Ve.x)return!0}}return Y}const m=Fa.isClockWise,g=this.subPaths;if(0===g.length)return[];if(!0===a)return u(g);let _,w,M;const C=[];if(1===g.length)return w=g[0],M=new gc,M.curves=w.curves,C.push(M),C;let A=!m(g[0].getPoints());A=s?!A:A;const D=[],R=[];let I,z,L=[],P=0;R[P]=void 0,L[P]=[];for(let B=0,j=g.length;B<j;B++)w=g[B],I=w.getPoints(),_=m(I),_=s?!_:_,_?(!A&&R[P]&&P++,R[P]={s:new gc,p:I},R[P].s.curves=w.curves,A&&P++,L[P]=[]):L[P].push({h:w,p:I[0]});if(!R[0])return u(g);if(R.length>1){let B=!1,j=0;for(let G=0,Y=R.length;G<Y;G++)D[G]=[];for(let G=0,Y=R.length;G<Y;G++){const le=L[G];for(let fe=0;fe<le.length;fe++){const ye=le[fe];let Ve=!0;for(let we=0;we<R.length;we++)h(ye.p,R[we].p)&&(G!==we&&j++,Ve?(Ve=!1,D[we].push(ye)):B=!0);Ve&&D[G].push(ye)}}j>0&&!1===B&&(L=D)}for(let B=0,j=R.length;B<j;B++){M=R[B].s,C.push(M),z=L[B];for(let G=0,Y=z.length;G<Y;G++)M.holes.push(z[G].h)}return C}},O.ShapeUtils=Fa,O.ShortType=1011,O.Skeleton=c0,O.SkeletonHelper=tS,O.SkinnedMesh=Wd,O.SmoothShading=2,O.Source=Sa,O.Sphere=Wu,O.SphereBufferGeometry=Qc,O.SphereGeometry=Qc,O.Spherical=class O2{constructor(s=1,a=0,u=0){return this.radius=s,this.phi=a,this.theta=u,this}set(s,a,u){return this.radius=s,this.phi=a,this.theta=u,this}copy(s){return this.radius=s.radius,this.phi=s.phi,this.theta=s.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(s){return this.setFromCartesianCoords(s.x,s.y,s.z)}setFromCartesianCoords(s,a,u){return this.radius=Math.sqrt(s*s+a*a+u*u),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(s,u),this.phi=Math.acos(as(a/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},O.SphericalHarmonics3=B0,O.SplineCurve=Yd,O.SpotLight=OM,O.SpotLightHelper=class eS extends Ci{constructor(s,a){super(),this.light=s,this.light.updateMatrixWorld(),this.matrix=s.matrixWorld,this.matrixAutoUpdate=!1,this.color=a;const u=new en,h=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let g=0,_=1,w=32;g<w;g++,_++){const M=g/w*Math.PI*2,C=_/w*Math.PI*2;h.push(Math.cos(M),Math.sin(M),1,Math.cos(C),Math.sin(C),1)}u.setAttribute("position",new nn(h,3));const m=new Bs({fog:!1,toneMapped:!1});this.cone=new Io(u,m),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const s=this.light.distance?this.light.distance:1e3,a=s*Math.tan(this.light.angle);this.cone.scale.set(a,a,s),QM.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(QM),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},O.Sprite=kn,O.SpriteMaterial=Up,O.SrcAlphaFactor=204,O.SrcAlphaSaturateFactor=210,O.SrcColorFactor=202,O.StaticCopyUsage=35046,O.StaticDrawUsage=hd,O.StaticReadUsage=35045,O.StereoCamera=class Ll{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Os,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Os,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(s){const a=this._cache;if(a.focus!==s.focus||a.fov!==s.fov||a.aspect!==s.aspect*this.aspect||a.near!==s.near||a.far!==s.far||a.zoom!==s.zoom||a.eyeSep!==this.eyeSep){a.focus=s.focus,a.fov=s.fov,a.aspect=s.aspect*this.aspect,a.near=s.near,a.far=s.far,a.zoom=s.zoom,a.eyeSep=this.eyeSep,Us.copy(s.projectionMatrix);const h=a.eyeSep/2,m=h*a.near/a.focus,g=a.near*Math.tan(dd*a.fov*.5)/a.zoom;let _,w;fm.elements[12]=-h,nu.elements[12]=h,_=-g*a.aspect+m,w=g*a.aspect+m,Us.elements[0]=2*a.near/(w-_),Us.elements[8]=(w+_)/(w-_),this.cameraL.projectionMatrix.copy(Us),_=-g*a.aspect-m,w=g*a.aspect-m,Us.elements[0]=2*a.near/(w-_),Us.elements[8]=(w+_)/(w-_),this.cameraR.projectionMatrix.copy(Us)}this.cameraL.matrixWorld.copy(s.matrixWorld).multiply(fm),this.cameraR.matrixWorld.copy(s.matrixWorld).multiply(nu)}},O.StreamCopyUsage=35042,O.StreamDrawUsage=35040,O.StreamReadUsage=35041,O.StringKeyframeTrack=Cr,O.SubtractEquation=101,O.SubtractiveBlending=3,O.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},O.TangentSpaceNormalMap=0,O.TetrahedronBufferGeometry=yh,O.TetrahedronGeometry=yh,O.TextGeometry=class H2 extends en{constructor(){console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),super()}},O.Texture=ls,O.TextureLoader=V1,O.TorusBufferGeometry=Xo,O.TorusGeometry=Xo,O.TorusKnotBufferGeometry=_c,O.TorusKnotGeometry=_c,O.Triangle=Gr,O.TriangleFanDrawMode=2,O.TriangleStripDrawMode=1,O.TrianglesDrawMode=0,O.TubeBufferGeometry=Kd,O.TubeGeometry=Kd,O.UVMapping=300,O.Uint16Attribute=class sD extends ot{constructor(s,a){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),super(s,a)}},O.Uint16BufferAttribute=ot,O.Uint32Attribute=class oD extends vt{constructor(s,a){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),super(s,a)}},O.Uint32BufferAttribute=vt,O.Uint8Attribute=class mS extends gv{constructor(s,a){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),super(s,a)}},O.Uint8BufferAttribute=gv,O.Uint8ClampedAttribute=class z2 extends Jb{constructor(s,a){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),super(s,a)}},O.Uint8ClampedBufferAttribute=Jb,O.Uniform=W0,O.UniformsLib=Rt,O.UniformsUtils=ac,O.UnsignedByteType=Ka,O.UnsignedInt248Type=Ze,O.UnsignedIntType=V,O.UnsignedShort4444Type=1017,O.UnsignedShort5551Type=1018,O.UnsignedShortType=va,O.VSMShadowMap=3,O.Vector2=Qe,O.Vector3=J,O.Vector4=Xi,O.VectorKeyframeTrack=vh,O.Vertex=class dS extends J{constructor(s,a,u){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),super(s,a,u)}},O.VertexColors=2,O.VideoTexture=x1,O.WebGL1Renderer=cM,O.WebGL3DRenderTarget=Ea,O.WebGLArrayRenderTarget=fd,O.WebGLCubeRenderTarget=Yu,O.WebGLMultipleRenderTargets=yr,O.WebGLMultisampleRenderTarget=class fD extends cs{constructor(s,a,u){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(s,a,u),this.samples=4}},O.WebGLRenderTarget=cs,O.WebGLRenderTargetCube=class uf extends Yu{constructor(s,a,u){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),super(s,u)}},O.WebGLRenderer=lr,O.WebGLUtils=Np,O.WireframeGeometry=T0,O.WireframeHelper=class cD extends Io{constructor(s,a){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),super(new T0(s.geometry),new Bs({color:void 0!==a?a:16777215}))}},O.WrapAroundEnding=bg,O.XHRLoader=class vS extends il{constructor(s){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),super(s)}},O.ZeroCurvatureEnding=Uu,O.ZeroFactor=200,O.ZeroSlopeEnding=cd,O.ZeroStencilOp=0,O._SRGBAFormat=1035,O.sRGBEncoding=Dr}},Co=>{Co(Co.s=209)}]);