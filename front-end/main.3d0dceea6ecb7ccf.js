var HX=Object.defineProperty,GX=(xo,O,ro)=>O in xo?HX(xo,O,{enumerable:!0,configurable:!0,writable:!0,value:ro}):xo[O]=ro,rn=(xo,O,ro)=>(GX(xo,"symbol"!=typeof O?O+"":O,ro),ro);(self.webpackChunkts_potree=self.webpackChunkts_potree||[]).push([[179],{316:(xo,O,ro)=>{"use strict";var so={};ro.r(so),ro.d(so,{Decoder:()=>vR,Encoder:()=>uj,PacketType:()=>Oi,protocol:()=>tO});var ar={};function gt(n){return"function"==typeof n}function Et(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}ro.r(ar),ro.d(ar,{Manager:()=>TS,Socket:()=>xR,connect:()=>uf,default:()=>uf,io:()=>uf,protocol:()=>tO});const cn=Et(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,s)=>`${s+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Qt(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Dn{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const o of t)o.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(gt(i))try{i()}catch(o){e=o instanceof cn?o.errors:[o]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const o of s)try{gi(o)}catch(l){e=null!=e?e:[],l instanceof cn?e=[...e,...l.errors]:e.push(l)}}if(e)throw new cn(e)}}add(e){var t;if(e&&e!==this)if(this.closed)gi(e);else{if(e instanceof Dn){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Qt(t,e)}remove(e){const{_finalizers:t}=this;t&&Qt(t,e),e instanceof Dn&&e._removeParent(this)}}Dn.EMPTY=(()=>{const n=new Dn;return n.closed=!0,n})();const ai=Dn.EMPTY;function ji(n){return n instanceof Dn||n&&"closed"in n&&gt(n.remove)&&gt(n.add)&&gt(n.unsubscribe)}function gi(n){gt(n)?n():n.unsubscribe()}const Xs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},gr={setTimeout(n,e,...t){const{delegate:i}=gr;return(null==i?void 0:i.setTimeout)?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=gr;return((null==e?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function ge(n){gr.setTimeout(()=>{const{onUnhandledError:e}=Xs;if(!e)throw n;e(n)})}function es(){}const Oa=jo("C",void 0,void 0);function jo(n,e,t){return{kind:n,value:e,error:t}}let Ys=null;function Nl(n){if(Xs.useDeprecatedSynchronousErrorHandling){const e=!Ys;if(e&&(Ys={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=Ys;if(Ys=null,t)throw i}}else n()}class hu extends Dn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,ji(e)&&e.add(this)):this.destination=Ph}static create(e,t,i){return new vc(e,t,i)}next(e){this.isStopped?du(function vf(n){return jo("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?du(function _f(n){return jo("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?du(Oa,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Em=Function.prototype.bind;function Ba(n,e){return Em.call(n,e)}class Sm{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){xc(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){xc(i)}else xc(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){xc(t)}}}class vc extends hu{constructor(e,t,i){let s;if(super(),gt(e)||!e)s={next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=i?i:void 0};else{let o;this&&Xs.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),s={next:e.next&&Ba(e.next,o),error:e.error&&Ba(e.error,o),complete:e.complete&&Ba(e.complete,o)}):s=e}this.destination=new Sm(s)}}function xc(n){Xs.useDeprecatedSynchronousErrorHandling?function Rh(n){Xs.useDeprecatedSynchronousErrorHandling&&Ys&&(Ys.errorThrown=!0,Ys.error=n)}(n):ge(n)}function du(n,e){const{onStoppedNotification:t}=Xs;t&&gr.setTimeout(()=>t(n,e))}const Ph={closed:!0,next:es,error:function xf(n){throw n},complete:es},bc="function"==typeof Symbol&&Symbol.observable||"@@observable";function $t(n){return n}let Ar=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,s){const o=function Am(n){return n&&n instanceof hu||function Tm(n){return n&&gt(n.next)&&gt(n.error)&&gt(n.complete)}(n)&&ji(n)}(t)?t:new vc(t,i,s);return Nl(()=>{const{operator:l,source:u}=this;o.add(l?l.call(o,u):u?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=bf(i))((s,o)=>{const l=new vc({next:u=>{try{t(u)}catch(f){o(f),l.unsubscribe()}},error:o,complete:s});this.subscribe(l)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[bc](){return this}pipe(...t){return function Ih(n){return 0===n.length?$t:1===n.length?n[0]:function(t){return n.reduce((i,s)=>s(i),t)}}(t)(this)}toPromise(t){return new(t=bf(t))((i,s)=>{let o;this.subscribe(l=>o=l,l=>s(l),()=>i(o))})}}return n.create=e=>new n(e),n})();function bf(n){var e;return null!==(e=null!=n?n:Xs.Promise)&&void 0!==e?e:Promise}const kt=Et(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Xt=(()=>{class n extends Ar{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new wc(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new kt}next(t){Nl(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Nl(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Nl(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:s,observers:o}=this;return i||s?ai:(this.currentObservers=null,o.push(t),new Dn(()=>{this.currentObservers=null,Qt(o,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:s,isStopped:o}=this;i?t.error(s):o&&t.complete()}asObservable(){const t=new Ar;return t.source=this,t}}return n.create=(e,t)=>new wc(e,t),n})();class wc extends Xt{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:ai}}function Di(n){return e=>{if(function Rn(n){return gt(null==n?void 0:n.lift)}(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function wn(n,e,t,i,s){return new Fo(n,e,t,i,s)}class Fo extends hu{constructor(e,t,i,s,o,l){super(e),this.onFinalize=o,this.shouldUnsubscribe=l,this._next=t?function(u){try{t(u)}catch(f){e.error(f)}}:super._next,this._error=s?function(u){try{s(u)}catch(f){e.error(f)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function yr(n,e){return Di((t,i)=>{let s=0;t.subscribe(wn(i,o=>{i.next(n.call(e,o,s++))}))})}function oo(n){return this instanceof oo?(this.v=n,this):new oo(n)}function fs(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,i=t.apply(n,e||[]),o=[];return s={},l("next"),l("throw"),l("return"),s[Symbol.asyncIterator]=function(){return this},s;function l(x){i[x]&&(s[x]=function(b){return new Promise(function(E,C){o.push([x,b,E,C])>1||u(x,b)})})}function u(x,b){try{!function f(x){x.value instanceof oo?Promise.resolve(x.value.v).then(m,y):v(o[0][2],x)}(i[x](b))}catch(E){v(o[0][3],E)}}function m(x){u("next",x)}function y(x){u("throw",x)}function v(x,b){x(b),o.shift(),o.length&&u(o[0][0],o[0][1])}}function Br(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Ii(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(l){return new Promise(function(u,f){!function s(o,l,u,f){Promise.resolve(f).then(function(m){o({value:m,done:u})},l)}(u,f,(l=n[o](l)).done,l.value)})}}}const Ua=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Fm(n){return gt(null==n?void 0:n.then)}function za(n){return gt(n[bc])}function Mf(n){return Symbol.asyncIterator&&gt(null==n?void 0:n[Symbol.asyncIterator])}function _u(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const se=function ca(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function U(n){return gt(null==n?void 0:n[se])}function W(n){return fs(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:s}=yield oo(t.read());if(s)return yield oo(void 0);yield yield oo(i)}}finally{t.releaseLock()}})}function ie(n){return gt(null==n?void 0:n.getReader)}function de(n){if(n instanceof Ar)return n;if(null!=n){if(za(n))return function Ue(n){return new Ar(e=>{const t=n[bc]();if(gt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Ua(n))return function Ke(n){return new Ar(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Fm(n))return function Wt(n){return new Ar(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,ge)})}(n);if(Mf(n))return Ct(n);if(U(n))return function dn(n){return new Ar(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(ie(n))return function Yt(n){return Ct(W(n))}(n)}throw _u(n)}function Ct(n){return new Ar(e=>{(function yi(n,e){var t,i,s,o;return function Lh(n,e,t,i){return new(t||(t=Promise))(function(o,l){function u(y){try{m(i.next(y))}catch(v){l(v)}}function f(y){try{m(i.throw(y))}catch(v){l(v)}}function m(y){y.done?o(y.value):function s(o){return o instanceof t?o:new t(function(l){l(o)})}(y.value).then(u,f)}m((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Br(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(l){s={error:l}}finally{try{i&&!i.done&&(o=t.return)&&(yield o.call(t))}finally{if(s)throw s.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function mn(n,e,t,i=0,s=!1){const o=e.schedule(function(){t(),s?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!s)return o}function Es(n,e,t=1/0){return gt(e)?Es((i,s)=>yr((o,l)=>e(i,o,s,l))(de(n(i,s))),t):("number"==typeof e&&(t=e),Di((i,s)=>function lr(n,e,t,i,s,o,l,u){const f=[];let m=0,y=0,v=!1;const x=()=>{v&&!f.length&&!m&&e.complete()},b=C=>m<i?E(C):f.push(C),E=C=>{o&&e.next(C),m++;let A=!1;de(t(C,y++)).subscribe(wn(e,N=>{null==s||s(N),o?b(N):e.next(N)},()=>{A=!0},void 0,()=>{if(A)try{for(m--;f.length&&m<i;){const N=f.shift();l?mn(e,l,()=>E(N)):E(N)}x()}catch(N){e.error(N)}}))};return n.subscribe(wn(e,b,()=>{v=!0,x()})),()=>{null==u||u()}}(i,s,n,t)))}const $n=new Ar(n=>n.complete());function br(n){return n&&gt(n.schedule)}function Ss(n){return n[n.length-1]}function Ol(n){return br(Ss(n))?n.pop():void 0}function Bl(n,e=0){return Di((t,i)=>{t.subscribe(wn(i,s=>mn(i,n,()=>i.next(s),e),()=>mn(i,n,()=>i.complete(),e),s=>mn(i,n,()=>i.error(s),e)))})}function Ec(n,e=0){return Di((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function Nm(n,e){if(!n)throw new Error("Iterable cannot be null");return new Ar(t=>{mn(t,e,()=>{const i=n[Symbol.asyncIterator]();mn(t,e,()=>{i.next().then(s=>{s.done?t.complete():t.next(s.value)})},0,!0)})})}function Bh(n,e){return e?function s_(n,e){if(null!=n){if(za(n))return function ua(n,e){return de(n).pipe(Ec(e),Bl(e))}(n,e);if(Ua(n))return function n_(n,e){return new Ar(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(Fm(n))return function Sx(n,e){return de(n).pipe(Ec(e),Bl(e))}(n,e);if(Mf(n))return Nm(n,e);if(U(n))return function i_(n,e){return new Ar(t=>{let i;return mn(t,e,()=>{i=n[se](),mn(t,e,()=>{let s,o;try{({value:s,done:o}=i.next())}catch(l){return void t.error(l)}o?t.complete():t.next(s)},0,!0)}),()=>gt(null==i?void 0:i.return)&&i.return()})}(n,e);if(ie(n))return function r_(n,e){return Nm(W(n),e)}(n,e)}throw _u(n)}(n,e):de(n)}function Om(n){return n<=0?()=>$n:Di((e,t)=>{let i=0;e.subscribe(wn(t,s=>{++i<=n&&(t.next(s),n<=i&&t.complete())}))})}function Bm(n={}){const{connector:e=(()=>new Xt),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:s=!0}=n;return o=>{let l=null,u=null,f=null,m=0,y=!1,v=!1;const x=()=>{null==u||u.unsubscribe(),u=null},b=()=>{x(),l=f=null,y=v=!1},E=()=>{const C=l;b(),null==C||C.unsubscribe()};return Di((C,A)=>{m++,!v&&!y&&x();const N=f=null!=f?f:e();A.add(()=>{m--,0===m&&!v&&!y&&(u=Ef(E,s))}),N.subscribe(A),l||(l=new vc({next:F=>N.next(F),error:F=>{v=!0,x(),u=Ef(b,t,F),N.error(F)},complete:()=>{y=!0,x(),u=Ef(b,i),N.complete()}}),Bh(C).subscribe(l))})(o)}}function Ef(n,e,...t){return!0===e?(n(),null):!1===e?null:e(...t).pipe(Om(1)).subscribe(()=>n())}function er(n){for(let e in n)if(n[e]===er)return e;throw Error("Could not find renamed property on target object.")}function Sf(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function Hi(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Hi).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Cf(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const a_=er({__forward_ref__:er});function nr(n){return n.__forward_ref__=nr,n.toString=function(){return Hi(this())},n}function Un(n){return l_(n)?n():n}function l_(n){return"function"==typeof n&&n.hasOwnProperty(a_)&&n.__forward_ref__===nr}class wi extends Error{constructor(e,t){super(function xu(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function Mn(n){return"string"==typeof n?n:null==n?"":String(n)}function ts(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Mn(n)}function wu(n,e){const t=e?` in ${e}`:"";throw new wi(-201,`No provider for ${ts(n)} found${t}`)}function Xo(n,e){null==n&&function Xi(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Zn(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function ao(n){return{providers:n.providers||[],imports:n.imports||[]}}function c_(n){return Tx(n,Vm)||Tx(n,h_)}function Tx(n,e){return n.hasOwnProperty(e)?n[e]:null}function Ax(n){return n&&(n.hasOwnProperty(u_)||n.hasOwnProperty(Uh))?n[u_]:null}const Vm=er({\u0275prov:er}),u_=er({\u0275inj:er}),h_=er({ngInjectableDef:er}),Uh=er({ngInjectorDef:er});var En=(()=>((En=En||{})[En.Default=0]="Default",En[En.Host=1]="Host",En[En.Self=2]="Self",En[En.SkipSelf=4]="SkipSelf",En[En.Optional=8]="Optional",En))();let d_;function Sc(n){const e=d_;return d_=n,e}function Dx(n,e,t){const i=c_(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&En.Optional?null:void 0!==e?e:void wu(Hi(n),"Injector")}function Cc(n){return{toString:n}.toString()}var Ha=(()=>((Ha=Ha||{})[Ha.OnPush=0]="OnPush",Ha[Ha.Default=1]="Default",Ha))(),Yo=(()=>{return(n=Yo||(Yo={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Yo;var n})();const Tc="undefined"!=typeof globalThis&&globalThis,Ks="undefined"!=typeof window&&window,Px="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Bi=Tc||"undefined"!=typeof global&&global||Ks||Px,Ac={},cr=[],Um=er({\u0275cmp:er}),Eu=er({\u0275dir:er}),f_=er({\u0275pipe:er}),Ix=er({\u0275mod:er}),kl=er({\u0275fac:er}),Tf=er({__NG_ELEMENT_ID__:er});let iC=0;function Ts(n){return Cc(()=>{const t={},i={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Ha.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||cr,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Yo.Emulated,id:"c",styles:n.styles||cr,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.directives,o=n.features,l=n.pipes;return i.id+=iC++,i.inputs=Df(n.inputs,t),i.outputs=Df(n.outputs),o&&o.forEach(u=>u(i)),i.directiveDefs=s?()=>("function"==typeof s?s():s).map(Lx):null,i.pipeDefs=l?()=>("function"==typeof l?l():l).map(Fx):null,i})}function Af(n,e,t){const i=n.\u0275cmp;i.directiveDefs=()=>e.map(Lx),i.pipeDefs=()=>t.map(Fx)}function Lx(n){return lo(n)||function Vl(n){return n[Eu]||null}(n)}function Fx(n){return function Qe(n){return n[f_]||null}(n)}const Nx={};function $s(n){return Cc(()=>{const e={type:n.type,bootstrap:n.bootstrap||cr,declarations:n.declarations||cr,imports:n.imports||cr,exports:n.exports||cr,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(Nx[n.id]=n.type),e})}function Df(n,e){if(null==n)return Ac;const t={};for(const i in n)if(n.hasOwnProperty(i)){let s=n[i],o=s;Array.isArray(s)&&(o=s[1],s=s[0]),t[s]=i,e&&(e[s]=o)}return t}const Pn=Ts;function wo(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function lo(n){return n[Um]||null}function Yi(n,e){const t=n[Ix]||null;if(!t&&!0===e)throw new Error(`Type ${Hi(n)} does not have '\u0275mod' property.`);return t}function ma(n){return Array.isArray(n)&&"object"==typeof n[1]}function ga(n){return Array.isArray(n)&&!0===n[1]}function Mo(n){return 0!=(8&n.flags)}function ya(n){return 2==(2&n.flags)}function al(n){return 1==(1&n.flags)}function $o(n){return null!==n.template}function Gh(n){return 0!=(512&n[2])}function No(n,e){return n.hasOwnProperty(kl)?n[kl]:null}class on{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function uo(){return _a}function _a(n){return n.type.prototype.ngOnChanges&&(n.setInput=oC),sC}function sC(){const n=Lf(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===Ac)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function oC(n,e,t,i){const s=Lf(n)||function Zo(n,e){return n[zl]=e}(n,{previous:Ac,current:null}),o=s.current||(s.current={}),l=s.previous,u=this.declaredInputs[t],f=l[u];o[u]=new on(f&&f.currentValue,e,l===Ac),n[i]=e}uo.ngInherit=!0;const zl="__ngSimpleChanges__";function Lf(n){return n[zl]||null}let Kh;function Pr(n){return!!n.listen}const b_={createRenderer:(n,e)=>function x_(){return void 0!==Kh?Kh:"undefined"!=typeof document?document:void 0}()};function ss(n){for(;Array.isArray(n);)n=n[0];return n}function Oo(n,e){return ss(e[n])}function os(n,e){return ss(e[n.index])}function Ga(n,e){return n.data[e]}function Wa(n,e){return n[e]}function As(n,e){const t=e[n];return ma(t)?t:t[0]}function M_(n){return 4==(4&n[2])}function Nf(n){return 128==(128&n[2])}function cl(n,e){return null==e?null:n[e]}function Vr(n){n[18]=0}function S_(n,e){n[5]+=e;let t=n,i=n[3];for(;null!==i&&(1===e&&1===t[5]||-1===e&&0===t[5]);)i[5]+=e,t=i,i=i[3]}const Zt={lFrame:zf(null),bindingsEnabled:!0};function C_(){return Zt.bindingsEnabled}function rt(){return Zt.lFrame.lView}function Mi(){return Zt.lFrame.tView}function _t(n){return Zt.lFrame.contextLView=n,n[8]}function as(){let n=en();for(;null!==n&&64===n.type;)n=n.parent;return n}function en(){return Zt.lFrame.currentTNode}function hl(n,e){const t=Zt.lFrame;t.currentTNode=n,t.isParent=e}function Bo(){return Zt.lFrame.isParent}function Of(){Zt.lFrame.isParent=!1}function Jt(){const n=Zt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Ic(){return Zt.lFrame.bindingIndex++}function ho(n){const e=Zt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function T_(n,e){const t=Zt.lFrame;t.bindingIndex=t.bindingRootIndex=n,kf(e)}function kf(n){Zt.lFrame.currentDirectiveIndex=n}function Vf(){return Zt.lFrame.currentQueryIndex}function Jh(n){Zt.lFrame.currentQueryIndex=n}function Xm(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Uf(n,e,t){if(t&En.SkipSelf){let s=e,o=n;for(;!(s=s.parent,null!==s||t&En.Host||(s=Xm(o),null===s||(o=o[15],10&s.type))););if(null===s)return!1;e=s,n=o}const i=Zt.lFrame=Ym();return i.currentTNode=e,i.lView=n,!0}function Au(n){const e=Ym(),t=n[1];Zt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function Ym(){const n=Zt.lFrame,e=null===n?null:n.child;return null===e?zf(n):e}function zf(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function Kr(){const n=Zt.lFrame;return Zt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Yx=Kr;function Du(){const n=Kr();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Ki(){return Zt.lFrame.selectedIndex}function ql(n){Zt.lFrame.selectedIndex=n}function Ur(){const n=Zt.lFrame;return Ga(n.tView,n.selectedIndex)}function Ru(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const o=n.data[t].type.prototype,{ngAfterContentInit:l,ngAfterContentChecked:u,ngAfterViewInit:f,ngAfterViewChecked:m,ngOnDestroy:y}=o;l&&(n.contentHooks||(n.contentHooks=[])).push(-t,l),u&&((n.contentHooks||(n.contentHooks=[])).push(t,u),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,u)),f&&(n.viewHooks||(n.viewHooks=[])).push(-t,f),m&&((n.viewHooks||(n.viewHooks=[])).push(t,m),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,m)),null!=y&&(n.destroyHooks||(n.destroyHooks=[])).push(t,y)}}function jl(n,e,t){$x(n,e,3,t)}function Pu(n,e,t,i){(3&n[2])===t&&$x(n,e,t,i)}function Gf(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function $x(n,e,t,i){const o=null!=i?i:-1,l=e.length-1;let u=0;for(let f=void 0!==i?65535&n[18]:0;f<l;f++)if("number"==typeof e[f+1]){if(u=e[f],null!=i&&u>=i)break}else e[f]<0&&(n[18]+=65536),(u<o||-1==o)&&(lC(n,t,e,f),n[18]=(4294901760&n[18])+f+2),f++}function lC(n,e,t,i){const s=t[i]<0,o=t[i+1],u=n[s?-t[i]:t[i]];if(s){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{o.call(u)}finally{}}}else try{o.call(u)}finally{}}class fl{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function $m(n,e,t){const i=Pr(n);let s=0;for(;s<t.length;){const o=t[s];if("number"==typeof o){if(0!==o)break;s++;const l=t[s++],u=t[s++],f=t[s++];i?n.setAttribute(e,u,f,l):e.setAttributeNS(l,u,f)}else{const l=o,u=t[++s];R_(l)?i&&n.setProperty(e,l,u):i?n.setAttribute(e,l,u):e.setAttribute(l,u),s++}}return s}function Zx(n){return 3===n||4===n||6===n}function R_(n){return 64===n.charCodeAt(0)}function Zm(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const s=e[i];"number"==typeof s?t=s:0===t||Jx(n,t,s,null,-1===t||2===t?e[++i]:null)}}return n}function Jx(n,e,t,i,s){let o=0,l=n.length;if(-1===e)l=-1;else for(;o<n.length;){const u=n[o++];if("number"==typeof u){if(u===e){l=-1;break}if(u>e){l=o-1;break}}}for(;o<n.length;){const u=n[o];if("number"==typeof u)break;if(u===t){if(null===i)return void(null!==s&&(n[o+1]=s));if(i===n[o+1])return void(n[o+2]=s)}o++,null!==i&&o++,null!==s&&o++}-1!==l&&(n.splice(l,0,e),o=l+1),n.splice(o++,0,t),null!==i&&n.splice(o++,0,i),null!==s&&n.splice(o++,0,s)}function Qx(n){return-1!==n}function id(n){return 32767&n}function rd(n,e){let t=function uC(n){return n>>16}(n),i=e;for(;t>0;)i=i[15],t--;return i}let P_=!0;function Jm(n){const e=P_;return P_=n,e}let hC=0;function qf(n,e){const t=L_(n,e);if(-1!==t)return t;const i=e[1];i.firstCreatePass&&(n.injectorIndex=e.length,I_(i.data,n),I_(e,null),I_(i.blueprint,null));const s=Qm(n,e),o=n.injectorIndex;if(Qx(s)){const l=id(s),u=rd(s,e),f=u[1].data;for(let m=0;m<8;m++)e[o+m]=u[l+m]|f[l+m]}return e[o+8]=s,o}function I_(n,e){n.push(0,0,0,0,0,0,0,0,e)}function L_(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Qm(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,s=e;for(;null!==s;){const o=s[1],l=o.type;if(i=2===l?o.declTNode:1===l?s[6]:null,null===i)return-1;if(t++,s=s[15],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return-1}function eg(n,e,t){!function dC(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(Tf)&&(i=t[Tf]),null==i&&(i=t[Tf]=hC++);const s=255&i;e.data[n+(s>>5)]|=1<<s}(n,e,t)}function nb(n,e,t){if(t&En.Optional)return n;wu(e,"NodeInjector")}function ib(n,e,t,i){if(t&En.Optional&&void 0===i&&(i=null),0==(t&(En.Self|En.Host))){const s=n[9],o=Sc(void 0);try{return s?s.get(e,i,t&En.Optional):Dx(e,i,t&En.Optional)}finally{Sc(o)}}return nb(i,e,t)}function rb(n,e,t,i=En.Default,s){if(null!==n){const o=function gC(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Tf)?n[Tf]:void 0;return"number"==typeof e?e>=0?255&e:pC:e}(t);if("function"==typeof o){if(!Uf(e,n,i))return i&En.Host?nb(s,t,i):ib(e,t,i,s);try{const l=o(i);if(null!=l||i&En.Optional)return l;wu(t)}finally{Yx()}}else if("number"==typeof o){let l=null,u=L_(n,e),f=-1,m=i&En.Host?e[16][6]:null;for((-1===u||i&En.SkipSelf)&&(f=-1===u?Qm(n,e):e[u+8],-1!==f&&ab(i,!1)?(l=e[1],u=id(f),e=rd(f,e)):u=-1);-1!==u;){const y=e[1];if(ob(o,u,y.data)){const v=mC(u,e,t,l,i,m);if(v!==sb)return v}f=e[u+8],-1!==f&&ab(i,e[1].data[u+8]===m)&&ob(o,u,e)?(l=y,u=id(f),e=rd(f,e)):u=-1}}}return ib(e,t,i,s)}const sb={};function pC(){return new sd(as(),rt())}function mC(n,e,t,i,s,o){const l=e[1],u=l.data[n+8],y=tg(u,l,t,null==i?ya(u)&&P_:i!=l&&0!=(3&u.type),s&En.Host&&o===u);return null!==y?jf(e,l,y,u):sb}function tg(n,e,t,i,s){const o=n.providerIndexes,l=e.data,u=1048575&o,f=n.directiveStart,y=o>>20,x=s?u+y:n.directiveEnd;for(let b=i?u:u+y;b<x;b++){const E=l[b];if(b<f&&t===E||b>=f&&E.type===t)return b}if(s){const b=l[f];if(b&&$o(b)&&b.type===t)return f}return null}function jf(n,e,t,i){let s=n[t];const o=e.data;if(function Km(n){return n instanceof fl}(s)){const l=s;l.resolving&&function bu(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new wi(-200,`Circular dependency in DI detected for ${n}${t}`)}(ts(o[t]));const u=Jm(l.canSeeViewProviders);l.resolving=!0;const f=l.injectImpl?Sc(l.injectImpl):null;Uf(n,i,En.Default);try{s=n[t]=l.factory(void 0,o,n,i),e.firstCreatePass&&t>=i.directiveStart&&function td(n,e,t){const{ngOnChanges:i,ngOnInit:s,ngDoCheck:o}=e.type.prototype;if(i){const l=_a(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,l),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,l)}s&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,s),o&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o))}(t,o[t],e)}finally{null!==f&&Sc(f),Jm(u),l.resolving=!1,Yx()}}return s}function ob(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function ab(n,e){return!(n&En.Self||n&En.Host&&e)}class sd{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return rb(this._tNode,this._lView,e,i,t)}}function fo(n){return Cc(()=>{const e=n.prototype.constructor,t=e[kl]||F_(e),i=Object.prototype;let s=Object.getPrototypeOf(n.prototype).constructor;for(;s&&s!==i;){const o=s[kl]||F_(s);if(o&&o!==t)return o;s=Object.getPrototypeOf(s)}return o=>new o})}function F_(n){return l_(n)?()=>{const e=F_(Un(n));return e&&e()}:No(n)}const ad="__parameters__";function cd(n,e,t){return Cc(()=>{const i=function O_(n){return function(...t){if(n){const i=n(...t);for(const s in i)this[s]=i[s]}}}(e);function s(...o){if(this instanceof s)return i.apply(this,o),this;const l=new s(...o);return u.annotation=l,u;function u(f,m,y){const v=f.hasOwnProperty(ad)?f[ad]:Object.defineProperty(f,ad,{value:[]})[ad];for(;v.length<=y;)v.push(null);return(v[y]=v[y]||[]).push(l),f}}return t&&(s.prototype=Object.create(t.prototype)),s.prototype.ngMetadataName=n,s.annotationCls=s,s})}class ii{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Zn({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}function xa(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)?(e===n&&(e=n.slice(0,t)),xa(i,e)):e!==n&&e.push(i)}return e}function pl(n,e){n.forEach(t=>Array.isArray(t)?pl(t,e):e(t))}function cb(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function ng(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Qo(n,e,t){let i=ud(n,e);return i>=0?n[1|i]=t:(i=~i,function xC(n,e,t,i){let s=n.length;if(s==e)n.push(t,i);else if(1===s)n.push(i,n[0]),n[0]=t;else{for(s--,n.push(n[s-1],n[s]);s>e;)n[s]=n[s-2],s--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function k_(n,e){const t=ud(n,e);if(t>=0)return n[1|t]}function ud(n,e){return function db(n,e,t){let i=0,s=n.length>>t;for(;s!==i;){const o=i+(s-i>>1),l=n[o<<t];if(e===l)return o<<t;l>e?s=o:i=o+1}return~(s<<t)}(n,e,1)}const $f={},U_="__NG_DI_FLAG__",rg="ngTempTokenPath",TC=/\n/gm,pb="__source",DC=er({provide:String,useValue:er});let Zf;function mb(n){const e=Zf;return Zf=n,e}function RC(n,e=En.Default){if(void 0===Zf)throw new wi(203,"");return null===Zf?Dx(n,void 0,e):Zf.get(n,e&En.Optional?null:void 0,e)}function Bn(n,e=En.Default){return(function nC(){return d_}()||RC)(Un(n),e)}const PC=Bn;function z_(n){const e=[];for(let t=0;t<n.length;t++){const i=Un(n[t]);if(Array.isArray(i)){if(0===i.length)throw new wi(900,"");let s,o=En.Default;for(let l=0;l<i.length;l++){const u=i[l],f=LP(u);"number"==typeof f?-1===f?s=u.token:o|=f:s=u}e.push(Bn(s,o))}else e.push(Bn(i))}return e}function sg(n,e){return n[U_]=e,n.prototype[U_]=e,n}function LP(n){return n[U_]}const H_=sg(cd("Optional"),8),G_=sg(cd("SkipSelf"),4);function ea(n){return n instanceof class bb{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?n.changingThisBreaksApplicationSecurity:n}const Bb="__ngContext__";function po(n,e){n[Bb]=e}function ev(n){const e=function sp(n){return n[Bb]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function nv(n){return n.ngOriginalError}function oT(n,...e){n.error(...e)}class op{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),i=function sT(n){return n&&n.ngErrorLogger||oT}(e);i(this._console,"ERROR",e),t&&i(this._console,"ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&nv(e);for(;t&&nv(t);)t=nv(t);return t||null}}const Fc=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Bi))();function sv(n){return n.ownerDocument}function qa(n){return n instanceof Function?n():n}var ta=(()=>((ta=ta||{})[ta.Important=1]="Important",ta[ta.DashCase=2]="DashCase",ta))();function hg(n,e){return undefined(n,e)}function Nu(n){const e=n[3];return ga(e)?e[3]:e}function ov(n){return Kb(n[13])}function dg(n){return Kb(n[4])}function Kb(n){for(;null!==n&&!ga(n);)n=n[4];return n}function Ou(n,e,t,i,s){if(null!=i){let o,l=!1;ga(i)?o=i:ma(i)&&(l=!0,i=i[0]);const u=ss(i);0===n&&null!==t?null==s?ew(e,t,u):Bu(e,t,u,s||null,!0):1===n&&null!==t?Bu(e,t,u,s||null,!0):2===n?function mg(n,e,t){const i=ku(n,e);i&&function ET(n,e,t,i){Pr(n)?n.removeChild(e,t,i):e.removeChild(t)}(n,i,e,t)}(e,u,l):3===n&&e.destroyNode(u),null!=o&&function tr(n,e,t,i,s){const o=t[7];o!==ss(t)&&Ou(e,n,i,o,s);for(let u=10;u<t.length;u++){const f=t[u];cp(f[1],f,n,e,i,o)}}(e,n,o,t,s)}}function lv(n,e,t){if(Pr(n))return n.createElement(e,t);{const i=null!==t?function Hl(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(t):null;return null===i?n.createElement(e):n.createElementNS(i,e)}}function Zb(n,e){const t=n[9],i=t.indexOf(e),s=e[3];1024&e[2]&&(e[2]&=-1025,S_(s,-1)),t.splice(i,1)}function cv(n,e){if(n.length<=10)return;const t=10+e,i=n[t];if(i){const s=i[17];null!==s&&s!==n&&Zb(s,i),e>0&&(n[t-1][4]=i[4]);const o=ng(n,10+e);!function gT(n,e){cp(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const l=o[19];null!==l&&l.detachView(o[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function uv(n,e){if(!(256&e[2])){const t=e[11];Pr(t)&&t.destroyNode&&cp(n,e,t,3,null,null),function vT(n){let e=n[13];if(!e)return fg(n[1],n);for(;e;){let t=null;if(ma(e))t=e[13];else{const i=e[10];i&&(t=i)}if(!t){for(;e&&!e[4]&&e!==n;)ma(e)&&fg(e[1],e),e=e[3];null===e&&(e=n),ma(e)&&fg(e[1],e),t=e&&e[4]}e=t}}(e)}}function fg(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function MT(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const s=e[t[i]];if(!(s instanceof fl)){const o=t[i+1];if(Array.isArray(o))for(let l=0;l<o.length;l+=2){const u=s[o[l]],f=o[l+1];try{f.call(u)}finally{}}else try{o.call(s)}finally{}}}}(n,e),function wT(n,e){const t=n.cleanup,i=e[7];let s=-1;if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const l=t[o+1],u="function"==typeof l?l(e):ss(e[l]),f=i[s=t[o+2]],m=t[o+3];"boolean"==typeof m?u.removeEventListener(t[o],f,m):m>=0?i[s=m]():i[s=-m].unsubscribe(),o+=2}else{const l=i[s=t[o+1]];t[o].call(l)}if(null!==i){for(let o=s+1;o<i.length;o++)i[o]();e[7]=null}}(n,e),1===e[1].type&&Pr(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&ga(e[3])){t!==e[3]&&Zb(t,e);const i=e[19];null!==i&&i.detachView(n)}}}function Jb(n,e,t){return function Qb(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[0];if(2&i.flags){const s=n.data[i.directiveStart].encapsulation;if(s===Yo.None||s===Yo.Emulated)return null}return os(i,t)}(n,e.parent,t)}function Bu(n,e,t,i,s){Pr(n)?n.insertBefore(e,t,i,s):e.insertBefore(t,i,s)}function ew(n,e,t){Pr(n)?n.appendChild(e,t):e.appendChild(t)}function hv(n,e,t,i,s){null!==i?Bu(n,e,t,i,s):ew(n,e,t)}function ku(n,e){return Pr(n)?n.parentNode(e):e.parentNode}let dv=function nw(n,e,t){return 40&n.type?os(n,t):null};function ap(n,e,t,i){const s=Jb(n,i,e),o=e[11],u=function tw(n,e,t){return dv(n,e,t)}(i.parent||e[6],i,e);if(null!=s)if(Array.isArray(t))for(let f=0;f<t.length;f++)hv(o,s,t[f],u,!1);else hv(o,s,t,u,!1)}function pd(n,e){if(null!==e){const t=e.type;if(3&t)return os(e,n);if(4&t)return pv(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return pd(n,i);{const s=n[e.index];return ga(s)?pv(-1,s):ss(s)}}if(32&t)return hg(e,n)()||ss(n[e.index]);{const i=Nc(n,e);return null!==i?Array.isArray(i)?i[0]:pd(Nu(n[16]),i):pd(n,e.next)}}return null}function Nc(n,e){return null!==e?n[16][6].projection[e.projection]:null}function pv(n,e){const t=10+n+1;if(t<e.length){const i=e[t],s=i[1].firstChild;if(null!==s)return pd(i,s)}return e[7]}function lp(n,e,t,i,s,o,l){for(;null!=t;){const u=i[t.index],f=t.type;if(l&&0===e&&(u&&po(ss(u),i),t.flags|=4),64!=(64&t.flags))if(8&f)lp(n,e,t.child,i,s,o,!1),Ou(e,n,s,u,o);else if(32&f){const m=hg(t,i);let y;for(;y=m();)Ou(e,n,s,y,o);Ou(e,n,s,u,o)}else 16&f?rw(n,e,i,t,s,o):Ou(e,n,s,u,o);t=l?t.projectionNext:t.next}}function cp(n,e,t,i,s,o){lp(t,i,n.firstChild,e,s,o,!1)}function rw(n,e,t,i,s,o){const l=t[16],f=l[6].projection[i.projection];if(Array.isArray(f))for(let m=0;m<f.length;m++)Ou(e,n,s,f[m],o);else lp(n,e,f,l[3],s,o,!0)}function md(n,e,t){Pr(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function Vu(n,e,t){Pr(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function up(n,e,t){let i=n.length;for(;;){const s=n.indexOf(e,t);if(-1===s)return s;if(0===s||n.charCodeAt(s-1)<=32){const o=e.length;if(s+o===i||n.charCodeAt(s+o)<=32)return s}t=s+1}}const mo="ng-template";function Oc(n,e,t){let i=0;for(;i<n.length;){let s=n[i++];if(t&&"class"===s){if(s=n[i],-1!==up(s.toLowerCase(),e,0))return!0}else if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===e)return!0;return!1}}return!1}function hp(n){return 4===n.type&&n.value!==mo}function yd(n,e,t){return e===(4!==n.type||t?n.value:mo)}function dp(n,e,t){let i=4;const s=n.attrs||[],o=function ow(n){for(let e=0;e<n.length;e++)if(Zx(n[e]))return e;return n.length}(s);let l=!1;for(let u=0;u<e.length;u++){const f=e[u];if("number"!=typeof f){if(!l)if(4&i){if(i=2|1&i,""!==f&&!yd(n,f,t)||""===f&&1===e.length){if(go(i))return!1;l=!0}}else{const m=8&i?f:e[++u];if(8&i&&null!==n.attrs){if(!Oc(n.attrs,m,t)){if(go(i))return!1;l=!0}continue}const v=_d(8&i?"class":f,s,hp(n),t);if(-1===v){if(go(i))return!1;l=!0;continue}if(""!==m){let x;x=v>o?"":s[v+1].toLowerCase();const b=8&i?x:null;if(b&&-1!==up(b,m,0)||2&i&&m!==x){if(go(i))return!1;l=!0}}}}else{if(!l&&!go(i)&&!go(f))return!1;if(l&&go(f))continue;l=!1,i=f|1&i}}return go(i)||l}function go(n){return 0==(1&n)}function _d(n,e,t,i){if(null===e)return-1;let s=0;if(i||!t){let o=!1;for(;s<e.length;){const l=e[s];if(l===n)return s;if(3===l||6===l)o=!0;else{if(1===l||2===l){let u=e[++s];for(;"string"==typeof u;)u=e[++s];continue}if(4===l)break;if(0===l){s+=4;continue}}s+=o?1:2}return-1}return function gg(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function Uu(n,e,t=!1){for(let i=0;i<e.length;i++)if(dp(n,e[i],t))return!0;return!1}function mp(n,e){return n?":not("+e.trim()+")":e}function aw(n){let e=n[0],t=1,i=2,s="",o=!1;for(;t<n.length;){let l=n[t];if("string"==typeof l)if(2&i){const u=n[++t];s+="["+l+(u.length>0?'="'+u+'"':"")+"]"}else 8&i?s+="."+l:4&i&&(s+=" "+l);else""!==s&&!go(l)&&(e+=mp(o,s),s=""),i=l,o=o||!go(i);t++}return""!==s&&(e+=mp(o,s)),e}const In={};function Je(n){gp(Mi(),rt(),Ki()+n,!1)}function gp(n,e,t,i){if(!i)if(3==(3&e[2])){const o=n.preOrderCheckHooks;null!==o&&jl(e,o,t)}else{const o=n.preOrderHooks;null!==o&&Pu(e,o,0,t)}ql(t)}function yp(n,e){return n<<17|e<<2}function wa(n){return n>>17&32767}function _v(n){return 2|n}function gl(n){return(131068&n)>>2}function vd(n,e){return-131069&n|e<<2}function Yl(n){return 1|n}function wd(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const s=t[i],o=t[i+1];if(-1!==o){const l=n.data[o];Jh(s),l.contentQueries(2,e[o],o)}}}function bp(n,e,t,i,s,o,l,u,f,m){const y=e.blueprint.slice();return y[0]=s,y[2]=140|i,Vr(y),y[3]=y[15]=n,y[8]=t,y[10]=l||n&&n[10],y[11]=u||n&&n[11],y[12]=f||n&&n[12]||null,y[9]=m||n&&n[9]||null,y[6]=o,y[16]=2==e.type?n[16]:y,y}function Md(n,e,t,i,s){let o=n.data[e];if(null===o)o=function Gu(n,e,t,i,s){const o=en(),l=Bo(),f=n.data[e]=function xl(n,e,t,i,s,o){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,l?o:o&&o.parent,t,e,i,s);return null===n.firstChild&&(n.firstChild=f),null!==o&&(l?null==o.child&&null!==f.parent&&(o.child=f):null===o.next&&(o.next=f)),f}(n,e,t,i,s),function Lc(){return Zt.lFrame.inI18n}()&&(o.flags|=64);else if(64&o.type){o.type=t,o.value=i,o.attrs=s;const l=function $h(){const n=Zt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();o.injectorIndex=null===l?-1:l.injectorIndex}return hl(o,!0),o}function Zl(n,e,t,i){if(0===t)return-1;const s=e.length;for(let o=0;o<t;o++)e.push(i),n.blueprint.push(i),n.data.push(null);return s}function Wu(n,e,t){Au(e);try{const i=n.viewQuery;null!==i&&Ov(1,i,t);const s=n.template;null!==s&&wp(n,e,s,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&wd(n,e),n.staticViewQueries&&Ov(2,n.viewQuery,t);const o=n.components;null!==o&&function OT(n,e){for(let t=0;t<e.length;t++)ww(n,e[t])}(e,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[2]&=-5,Du()}}function vl(n,e,t,i){const s=e[2];if(256!=(256&s)){Au(e);try{Vr(e),function Tu(n){return Zt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&wp(n,e,t,2,i);const l=3==(3&s);if(l){const m=n.preOrderCheckHooks;null!==m&&jl(e,m,null)}else{const m=n.preOrderHooks;null!==m&&Pu(e,m,0,null),Gf(e,0)}if(function qT(n){for(let e=ov(n);null!==e;e=dg(e)){if(!e[2])continue;const t=e[9];for(let i=0;i<t.length;i++){const s=t[i],o=s[3];0==(1024&s[2])&&S_(o,1),s[2]|=1024}}}(e),function Tg(n){for(let e=ov(n);null!==e;e=dg(e))for(let t=10;t<e.length;t++){const i=e[t],s=i[1];Nf(i)&&vl(s,i,s.template,i[8])}}(e),null!==n.contentQueries&&wd(n,e),l){const m=n.contentCheckHooks;null!==m&&jl(e,m)}else{const m=n.contentHooks;null!==m&&Pu(e,m,1),Gf(e,1)}!function FT(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const s=t[i];if(s<0)ql(~s);else{const o=s,l=t[++i],u=t[++i];T_(l,o),u(2,e[o])}}}finally{ql(-1)}}(n,e);const u=n.components;null!==u&&function NT(n,e){for(let t=0;t<e.length;t++)Ap(n,e[t])}(e,u);const f=n.viewQuery;if(null!==f&&Ov(2,f,i),l){const m=n.viewCheckHooks;null!==m&&jl(e,m)}else{const m=n.viewHooks;null!==m&&Pu(e,m,2),Gf(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[2]&=-73,1024&e[2]&&(e[2]&=-1025,S_(e[3],-1))}finally{Du()}}}function yw(n,e,t,i){const s=e[10],l=M_(e);try{!l&&s.begin&&s.begin(),l&&Wu(n,e,i),vl(n,e,t,i)}finally{!l&&s.end&&s.end()}}function wp(n,e,t,i,s){const o=Ki(),l=2&i;try{ql(-1),l&&e.length>20&&gp(n,e,20,!1),t(i,s)}finally{ql(o)}}function Mp(n,e,t){if(Mo(e)){const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const l=n.data[o];l.contentQueries&&l.contentQueries(1,t[o],o)}}}function Ed(n,e,t){!C_()||(function kT(n,e,t,i){const s=t.directiveStart,o=t.directiveEnd;n.firstCreatePass||qf(t,e),po(i,e);const l=t.initialInputs;for(let u=s;u<o;u++){const f=n.data[u],m=$o(f);m&&GT(e,t,f);const y=jf(e,n,u,t);po(y,e),null!==l&&Ir(0,u-s,y,f,0,l),m&&(As(t.index,e)[8]=y)}}(n,e,t,os(t,e)),128==(128&t.flags)&&function VT(n,e,t){const i=t.directiveStart,s=t.directiveEnd,l=t.index,u=function A_(){return Zt.lFrame.currentDirectiveIndex}();try{ql(l);for(let f=i;f<s;f++){const m=n.data[f],y=e[f];kf(f),(null!==m.hostBindings||0!==m.hostVars||null!==m.hostAttrs)&&vw(m,y)}}finally{ql(-1),kf(u)}}(n,e,t))}function Ep(n,e,t=os){const i=e.localNames;if(null!==i){let s=e.index+1;for(let o=0;o<i.length;o+=2){const l=i[o+1],u=-1===l?t(e,n):n[l];n[s++]=u}}}function Dv(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Jl(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function Jl(n,e,t,i,s,o,l,u,f,m){const y=20+i,v=y+s,x=function qu(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:In);return t}(y,v),b="function"==typeof m?m():m;return x[1]={type:n,blueprint:x,template:t,queries:null,viewQuery:u,declTNode:e,data:x.slice().fill(null,y),bindingStartIndex:y,expandoStartIndex:v,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof l?l():l,firstChild:null,schemas:f,consts:b,incompleteFirstPass:!1}}function Xu(n,e,t,i){const s=Zu(e);null===t?s.push(i):(s.push(t),n.firstCreatePass&&kc(n).push(i,s.length-1))}function Yu(n,e,t){for(let i in n)if(n.hasOwnProperty(i)){const s=n[i];(t=null===t?{}:t).hasOwnProperty(i)?t[i].push(e,s):t[i]=[e,s]}return t}function To(n,e,t,i,s,o,l,u){const f=os(e,t);let y,m=e.inputs;!u&&null!=m&&(y=m[i])?(Ju(n,t,y,i,s),ya(e)&&function Eg(n,e){const t=As(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(i=function Mg(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),s=null!=l?l(s,e.value||"",i):s,Pr(o)?o.setProperty(f,i,s):R_(i)||(f.setProperty?f.setProperty(i,s):f[i]=s))}function Iv(n,e,t,i){let s=!1;if(C_()){const o=function UT(n,e,t){const i=n.directiveRegistry;let s=null;if(i)for(let o=0;o<i.length;o++){const l=i[o];Uu(t,l.selectors,!1)&&(s||(s=[]),eg(qf(t,e),n,l.type),$o(l)?(xw(n,t),s.unshift(l)):s.push(l))}return s}(n,e,t),l=null===i?null:{"":-1};if(null!==o){s=!0,bw(t,n.data.length,o.length);for(let y=0;y<o.length;y++){const v=o[y];v.providersResolver&&v.providersResolver(v)}let u=!1,f=!1,m=Zl(n,e,o.length,null);for(let y=0;y<o.length;y++){const v=o[y];t.mergedAttrs=Zm(t.mergedAttrs,v.hostAttrs),Sg(n,t,e,m,v),HT(m,v,l),null!==v.contentQueries&&(t.flags|=8),(null!==v.hostBindings||null!==v.hostAttrs||0!==v.hostVars)&&(t.flags|=128);const x=v.type.prototype;!u&&(x.ngOnChanges||x.ngOnInit||x.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),u=!0),!f&&(x.ngOnChanges||x.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),f=!0),m++}!function wg(n,e){const i=e.directiveEnd,s=n.data,o=e.attrs,l=[];let u=null,f=null;for(let m=e.directiveStart;m<i;m++){const y=s[m],v=y.inputs,x=null===o||hp(e)?null:Cg(v,o);l.push(x),u=Yu(v,m,u),f=Yu(y.outputs,m,f)}null!==u&&(u.hasOwnProperty("class")&&(e.flags|=16),u.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=l,e.inputs=u,e.outputs=f}(n,t)}l&&function zT(n,e,t){if(e){const i=n.localNames=[];for(let s=0;s<e.length;s+=2){const o=t[e[s+1]];if(null==o)throw new wi(-301,!1);i.push(e[s],o)}}}(t,i,l)}return t.mergedAttrs=Zm(t.mergedAttrs,t.attrs),s}function _w(n,e,t,i,s,o){const l=o.hostBindings;if(l){let u=n.hostBindingOpCodes;null===u&&(u=n.hostBindingOpCodes=[]);const f=~e.index;(function BT(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(u)!=f&&u.push(f),u.push(i,s,l)}}function vw(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function xw(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function HT(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;$o(e)&&(t[""]=n)}}function bw(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function Sg(n,e,t,i,s){n.data[i]=s;const o=s.factory||(s.factory=No(s.type)),l=new fl(o,$o(s),null);n.blueprint[i]=l,t[i]=l,_w(n,e,0,i,Zl(n,t,s.hostVars,In),s)}function GT(n,e,t){const i=os(e,n),s=Dv(t),o=n[10],l=Bc(n,bp(n,s,null,t.onPush?64:16,i,e,o,o.createRenderer(i,t),null,null));n[e.index]=l}function Ir(n,e,t,i,s,o){const l=o[e];if(null!==l){const u=i.setInput;for(let f=0;f<l.length;){const m=l[f++],y=l[f++],v=l[f++];null!==u?i.setInput(t,v,m,y):t[y]=v}}}function Cg(n,e){let t=null,i=0;for(;i<e.length;){const s=e[i];if(0!==s)if(5!==s){if("number"==typeof s)break;n.hasOwnProperty(s)&&(null===t&&(t=[]),t.push(s,n[s],e[i+1])),i+=2}else i+=2;else i+=4}return t}function Tp(n,e,t,i){return new Array(n,!0,!1,e,null,0,i,t,null,null)}function Ap(n,e){const t=As(e,n);if(Nf(t)){const i=t[1];80&t[2]?vl(i,t,i.template,t[8]):t[5]>0&&Fv(t)}}function Fv(n){for(let i=ov(n);null!==i;i=dg(i))for(let s=10;s<i.length;s++){const o=i[s];if(1024&o[2]){const l=o[1];vl(l,o,l.template,o[8])}else o[5]>0&&Fv(o)}const t=n[1].components;if(null!==t)for(let i=0;i<t.length;i++){const s=As(t[i],n);Nf(s)&&s[5]>0&&Fv(s)}}function ww(n,e){const t=As(e,n),i=t[1];(function Mw(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),Wu(i,t,t[8])}function Bc(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function Dp(n){for(;n;){n[2]|=64;const e=Nu(n);if(Gh(n)&&!e)return n;n=e}return null}function Nv(n){!function Ma(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],i=ev(t),s=i[1];yw(s,i,s.template,t)}}(n[8])}function Ov(n,e,t){Jh(0),e(n,t)}const $u=(()=>Promise.resolve(null))();function Zu(n){return n[7]||(n[7]=[])}function kc(n){return n.cleanup||(n.cleanup=[])}function Vc(n,e){const t=n[9],i=t?t.get(op,null):null;i&&i.handleError(e)}function Ju(n,e,t,i,s){for(let o=0;o<t.length;){const l=t[o++],u=t[o++],f=e[l],m=n.data[l];null!==m.setInput?m.setInput(f,s,i,u):f[u]=s}}function ko(n,e,t){const i=Oo(e,n);!function $b(n,e,t){Pr(n)?n.setValue(e,t):e.textContent=t}(n[11],i,t)}function nc(n,e,t){let i=t?n.styles:null,s=t?n.classes:null,o=0;if(null!==e)for(let l=0;l<e.length;l++){const u=e[l];"number"==typeof u?o=u:1==o?s=Cf(s,u):2==o&&(i=Cf(i,u+": "+e[++l]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=s:n.classesWithoutHost=s}const Dg=new ii("INJECTOR",-1);class Rg{get(e,t=$f){if(t===$f){const i=new Error(`NullInjectorError: No provider for ${Hi(e)}!`);throw i.name="NullInjectorError",i}return t}}const Pp=new ii("Set Injector scope."),Uc={},kv={};let Ip;function Pg(){return void 0===Ip&&(Ip=new Rg),Ip}function Ig(n,e=null,t=null,i){const s=Lg(n,e,t,i);return s._resolveInjectorDefTypes(),s}function Lg(n,e=null,t=null,i){return new Vv(n,t,e||Pg(),i)}class Vv{constructor(e,t,i,s=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const o=[];t&&pl(t,u=>this.processProvider(u,e,t)),pl([e],u=>this.processInjectorType(u,[],o)),this.records.set(Dg,Qu(void 0,this));const l=this.records.get(Pp);this.scope=null!=l?l.value:null,this.source=s||("object"==typeof e?null:Hi(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=$f,i=En.Default){this.assertNotDestroyed();const s=mb(this),o=Sc(void 0);try{if(!(i&En.SkipSelf)){let u=this.records.get(e);if(void 0===u){const f=function Cd(n){return"function"==typeof n||"object"==typeof n&&n instanceof ii}(e)&&c_(e);u=f&&this.injectableDefInScope(f)?Qu(Lp(e),Uc):null,this.records.set(e,u)}if(null!=u)return this.hydrate(e,u)}return(i&En.Self?Pg():this.parent).get(e,t=i&En.Optional&&t===$f?null:t)}catch(l){if("NullInjectorError"===l.name){if((l[rg]=l[rg]||[]).unshift(Hi(e)),s)throw l;return function FP(n,e,t,i){const s=n[rg];throw e[pb]&&s.unshift(e[pb]),n.message=function NP(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let s=Hi(e);if(Array.isArray(e))s=e.map(Hi).join(" -> ");else if("object"==typeof e){let o=[];for(let l in e)if(e.hasOwnProperty(l)){let u=e[l];o.push(l+":"+("string"==typeof u?JSON.stringify(u):Hi(u)))}s=`{${o.join(", ")}}`}return`${t}${i?"("+i+")":""}[${s}]: ${n.replace(TC,"\n  ")}`}("\n"+n.message,s,t,i),n.ngTokenPath=s,n[rg]=null,n}(l,e,"R3InjectorError",this.source)}throw l}finally{Sc(o),mb(s)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((i,s)=>e.push(Hi(s))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new wi(205,!1)}processInjectorType(e,t,i){if(!(e=Un(e)))return!1;let s=Ax(e);const o=null==s&&e.ngModule||void 0,l=void 0===o?e:o,u=-1!==i.indexOf(l);if(void 0!==o&&(s=Ax(o)),null==s)return!1;if(null!=s.imports&&!u){let y;i.push(l);try{pl(s.imports,v=>{this.processInjectorType(v,t,i)&&(void 0===y&&(y=[]),y.push(v))})}finally{}if(void 0!==y)for(let v=0;v<y.length;v++){const{ngModule:x,providers:b}=y[v];pl(b,E=>this.processProvider(E,x,b||cr))}}this.injectorDefTypes.add(l);const f=No(l)||(()=>new l);this.records.set(l,Qu(f,Uc));const m=s.providers;if(null!=m&&!u){const y=e;pl(m,v=>this.processProvider(v,y,m))}return void 0!==o&&void 0!==e.providers}processProvider(e,t,i){let s=Ea(e=Un(e))?e:Un(e&&e.provide);const o=function vr(n,e,t){return Fg(n)?Qu(void 0,n.useValue):Qu(bl(n),Uc)}(e);if(Ea(e)||!0!==e.multi)this.records.get(s);else{let l=this.records.get(s);l||(l=Qu(void 0,Uc,!0),l.factory=()=>z_(l.multi),this.records.set(s,l)),s=e,l.multi.push(e)}this.records.set(s,o)}hydrate(e,t){return t.value===Uc&&(t.value=kv,t.value=t.factory()),"object"==typeof t.value&&t.value&&function Cw(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Un(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Lp(n){const e=c_(n),t=null!==e?e.factory:No(n);if(null!==t)return t;if(n instanceof ii)throw new wi(204,!1);if(n instanceof Function)return function YT(n){const e=n.length;if(e>0)throw function Kf(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new wi(204,!1);const t=function eC(n){const e=n&&(n[Vm]||n[h_]);if(e){const t=function tC(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new wi(204,!1)}function bl(n,e,t){let i;if(Ea(n)){const s=Un(n);return No(s)||Lp(s)}if(Fg(n))i=()=>Un(n.useValue);else if(function ja(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...z_(n.deps||[]));else if(function Sw(n){return!(!n||!n.useExisting)}(n))i=()=>Bn(Un(n.useExisting));else{const s=Un(n&&(n.useClass||n.provide));if(!function Fp(n){return!!n.deps}(n))return No(s)||Lp(s);i=()=>new s(...z_(n.deps))}return i}function Qu(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Fg(n){return null!==n&&"object"==typeof n&&DC in n}function Ea(n){return"function"==typeof n}let zr=(()=>{class n{static create(t,i){var s;if(Array.isArray(t))return Ig({name:""},i,t,"");{const o=null!==(s=t.name)&&void 0!==s?s:"";return Ig({name:o},t.parent,t.providers,o)}}}return n.THROW_IF_NOT_FOUND=$f,n.NULL=new Rg,n.\u0275prov=Zn({token:n,providedIn:"any",factory:()=>Bn(Dg)}),n.__NG_ELEMENT_ID__=-1,n})();function Lw(n,e){Ru(ev(n)[1],as())}function Li(n){let e=function jv(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const i=[n];for(;e;){let s;if($o(n))s=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new wi(903,"");s=e.\u0275dir}if(s){if(t){i.push(s);const l=n;l.inputs=Op(n.inputs),l.declaredInputs=Op(n.declaredInputs),l.outputs=Op(n.outputs);const u=s.hostBindings;u&&Nw(n,u);const f=s.viewQuery,m=s.contentQueries;if(f&&Yv(n,f),m&&Bp(n,m),Sf(n.inputs,s.inputs),Sf(n.declaredInputs,s.declaredInputs),Sf(n.outputs,s.outputs),$o(s)&&s.data.animation){const y=n.data;y.animation=(y.animation||[]).concat(s.data.animation)}}const o=s.features;if(o)for(let l=0;l<o.length;l++){const u=o[l];u&&u.ngInherit&&u(n),u===Li&&(t=!1)}}e=Object.getPrototypeOf(e)}!function Xv(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){const s=n[i];s.hostVars=e+=s.hostVars,s.hostAttrs=Zm(s.hostAttrs,t=Zm(t,s.hostAttrs))}}(i)}function Op(n){return n===Ac?{}:n===cr?[]:n}function Yv(n,e){const t=n.viewQuery;n.viewQuery=t?(i,s)=>{e(i,s),t(i,s)}:e}function Bp(n,e){const t=n.contentQueries;n.contentQueries=t?(i,s,o)=>{e(i,s,o),t(i,s,o)}:e}function Nw(n,e){const t=n.hostBindings;n.hostBindings=t?(i,s)=>{e(i,s),t(i,s)}:e}let Bg=null;function Dd(){if(!Bg){const n=Bi.Symbol;if(n&&n.iterator)Bg=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const i=e[t];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Bg=i)}}}return Bg}function Rd(n){return!!kp(n)&&(Array.isArray(n)||!(n instanceof Map)&&Dd()in n)}function kp(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Ya(n,e,t){return n[e]=t}function Qs(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Vp(n,e,t,i,s){const o=function Hc(n,e,t,i){const s=Qs(n,e,t);return Qs(n,e+1,i)||s}(n,e,t,i);return Qs(n,e+2,s)||o}function nh(n,e,t,i){return Qs(n,Ic(),t)?e+Mn(t)+i:In}function pn(n,e,t,i,s,o,l,u){const f=rt(),m=Mi(),y=n+20,v=m.firstCreatePass?function QT(n,e,t,i,s,o,l,u,f){const m=e.consts,y=Md(e,n,4,l||null,cl(m,u));Iv(e,t,y,cl(m,f)),Ru(e,y);const v=y.tViews=Jl(2,y,i,s,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,m);return null!==e.queries&&(e.queries.template(e,y),v.queries=e.queries.embeddedTView(y)),y}(y,m,f,e,t,i,s,o,l):m.data[y];hl(v,!1);const x=f[11].createComment("");ap(m,f,x,v),po(x,f),Bc(f,f[y]=Tp(x,f,x,v)),al(v)&&Ed(m,f,v),null!=l&&Ep(f,v,u)}function He(n,e=En.Default){const t=rt();return null===t?Bn(n,e):rb(as(),t,Un(n),e)}function Xe(n,e,t){const i=rt();return Qs(i,Ic(),e)&&To(Mi(),Ur(),i,n,e,i[11],t,!1),Xe}function o0(n,e,t,i,s){const l=s?"class":"style";Ju(n,t,e.inputs[l],l,i)}function De(n,e,t,i){const s=rt(),o=Mi(),l=20+n,u=s[11],f=s[l]=lv(u,e,function ed(){return Zt.lFrame.currentNamespace}()),m=o.firstCreatePass?function h1(n,e,t,i,s,o,l){const u=e.consts,m=Md(e,n,2,s,cl(u,o));return Iv(e,t,m,cl(u,l)),null!==m.attrs&&nc(m,m.attrs,!1),null!==m.mergedAttrs&&nc(m,m.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,m),m}(l,o,s,0,e,t,i):o.data[l];hl(m,!0);const y=m.mergedAttrs;null!==y&&$m(u,f,y);const v=m.classes;null!==v&&Vu(u,f,v);const x=m.styles;return null!==x&&md(u,f,x),64!=(64&m.flags)&&ap(o,s,f,m),0===function qm(){return Zt.lFrame.elementDepthCount}()&&po(f,s),function Pi(){Zt.lFrame.elementDepthCount++}(),al(m)&&(Ed(o,s,m),Mp(o,m,s)),null!==i&&Ep(s,m),De}function Se(){let n=as();Bo()?Of():(n=n.parent,hl(n,!1));const e=n;!function qx(){Zt.lFrame.elementDepthCount--}();const t=Mi();return t.firstCreatePass&&(Ru(t,n),Mo(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function Iu(n){return 0!=(16&n.flags)}(e)&&o0(t,e,rt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function cC(n){return 0!=(32&n.flags)}(e)&&o0(t,e,rt(),e.stylesWithoutHost,!1),Se}function Ei(n,e,t,i){return De(n,e,t,i),Se(),Ei}function a0(n,e,t){const i=rt(),s=Mi(),o=n+20,l=s.firstCreatePass?function eM(n,e,t,i,s){const o=e.consts,l=cl(o,i),u=Md(e,n,8,"ng-container",l);return null!==l&&nc(u,l,!0),Iv(e,t,u,cl(o,s)),null!==e.queries&&e.queries.elementStart(e,u),u}(o,s,i,e,t):s.data[o];hl(l,!0);const u=i[o]=i[11].createComment("");return ap(s,i,u,l),po(u,i),al(l)&&(Ed(s,i,l),Mp(s,l,i)),null!=t&&Ep(i,l),a0}function l0(){let n=as();const e=Mi();return Bo()?Of():(n=n.parent,hl(n,!1)),e.firstCreatePass&&(Ru(e,n),Mo(n)&&e.queries.elementEnd(n)),l0}function qg(n,e,t){return a0(n,e,t),l0(),qg}function ir(){return rt()}function Hp(n){return!!n&&"function"==typeof n.then}const Da=function Aa(n){return!!n&&"function"==typeof n.subscribe};function Vt(n,e,t,i){const s=rt(),o=Mi(),l=as();return function nM(n,e,t,i,s,o,l,u){const f=al(i),y=n.firstCreatePass&&kc(n),v=e[8],x=Zu(e);let b=!0;if(3&i.type||u){const A=os(i,e),N=u?u(A):A,F=x.length,V=u?k=>u(ss(k[i.index])):i.index;if(Pr(t)){let k=null;if(!u&&f&&(k=function tM(n,e,t,i){const s=n.cleanup;if(null!=s)for(let o=0;o<s.length-1;o+=2){const l=s[o];if(l===t&&s[o+1]===i){const u=e[7],f=s[o+2];return u.length>f?u[f]:null}"string"==typeof l&&(o+=2)}return null}(n,e,s,i.index)),null!==k)(k.__ngLastListenerFn__||k).__ngNextListenerFn__=o,k.__ngLastListenerFn__=o,b=!1;else{o=c0(i,e,v,o,!1);const G=t.listen(N,s,o);x.push(o,G),y&&y.push(s,V,F,F+1)}}else o=c0(i,e,v,o,!0),N.addEventListener(s,o,l),x.push(o),y&&y.push(s,V,F,l)}else o=c0(i,e,v,o,!1);const E=i.outputs;let C;if(b&&null!==E&&(C=E[s])){const A=C.length;if(A)for(let N=0;N<A;N+=2){const ee=e[C[N]][C[N+1]].subscribe(o),oe=x.length;x.push(o,ee),y&&y.push(s,i.index,oe,-(oe+1))}}}(o,s,s[11],l,n,e,!!t,i),Vt}function iM(n,e,t,i){try{return!1!==t(i)}catch(s){return Vc(n,s),!1}}function c0(n,e,t,i,s){return function o(l){if(l===Function)return i;const u=2&n.flags?As(n.index,e):e;0==(32&e[2])&&Dp(u);let f=iM(e,0,i,l),m=o.__ngNextListenerFn__;for(;m;)f=iM(e,0,m,l)&&f,m=m.__ngNextListenerFn__;return s&&!1===f&&(l.preventDefault(),l.returnValue=!1),f}}function Fe(n=1){return function Wl(n){return(Zt.lFrame.contextLView=function Qh(n,e){for(;n>0;)e=e[15],n--;return e}(n,Zt.lFrame.contextLView))[8]}(n)}function Ls(n,e,t){return u0(n,"",e,"",t),Ls}function u0(n,e,t,i,s){const o=rt(),l=nh(o,e,t,i);return l!==In&&To(Mi(),Ur(),o,n,l,o[11],s,!1),u0}function dM(n,e,t,i,s){const o=n[t+1],l=null===e;let u=i?wa(o):gl(o),f=!1;for(;0!==u&&(!1===f||l);){const y=n[u+1];y1(n[u],e)&&(f=!0,n[u+1]=i?Yl(y):_v(y)),u=i?wa(y):gl(y)}f&&(n[t+1]=i?_v(o):Yl(o))}function y1(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&ud(n,e)>=0}const xs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function fM(n){return n.substring(xs.key,xs.keyEnd)}function pM(n,e){const t=xs.textEnd;return t===e?-1:(e=xs.keyEnd=function b1(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}(n,xs.key=e,t),Od(n,e,t))}function Od(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function Lr(n,e,t){return d(n,e,t,!1),Lr}function Bd(n,e){return d(n,e,null,!0),Bd}function ah(n){r(Qo,Ml,n,!0)}function Ml(n,e){for(let t=function v1(n){return function gM(n){xs.key=0,xs.keyEnd=0,xs.value=0,xs.valueEnd=0,xs.textEnd=n.length}(n),pM(n,Od(n,0,xs.textEnd))}(e);t>=0;t=pM(e,t))Qo(n,fM(e),!0)}function d(n,e,t,i){const s=rt(),o=Mi(),l=ho(2);o.firstUpdatePass&&c(o,n,l,i),e!==In&&Qs(s,l,e)&&R(o,o.data[Ki()],s,s[11],n,s[l+1]=function I(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=Hi(ea(n)))),n}(e,t),i,l)}function r(n,e,t,i){const s=Mi(),o=ho(2);s.firstUpdatePass&&c(s,null,o,i);const l=rt();if(t!==In&&Qs(l,o,t)){const u=s.data[Ki()];if(z(u,i)&&!a(s,o)){let f=i?u.classesWithoutHost:u.stylesWithoutHost;null!==f&&(t=Cf(f,t||"")),o0(s,u,l,t,i)}else!function D(n,e,t,i,s,o,l,u){s===In&&(s=cr);let f=0,m=0,y=0<s.length?s[0]:null,v=0<o.length?o[0]:null;for(;null!==y||null!==v;){const x=f<s.length?s[f+1]:void 0,b=m<o.length?o[m+1]:void 0;let C,E=null;y===v?(f+=2,m+=2,x!==b&&(E=v,C=b)):null===v||null!==y&&y<v?(f+=2,E=y):(m+=2,E=v,C=b),null!==E&&R(n,e,t,i,E,C,l,u),y=f<s.length?s[f]:null,v=m<o.length?o[m]:null}}(s,u,l,l[11],l[o+1],l[o+1]=function S(n,e,t){if(null==t||""===t)return cr;const i=[],s=ea(t);if(Array.isArray(s))for(let o=0;o<s.length;o++)n(i,s[o],!0);else if("object"==typeof s)for(const o in s)s.hasOwnProperty(o)&&n(i,o,s[o]);else"string"==typeof s&&e(i,s);return i}(n,e,t),i,o)}}function a(n,e){return e>=n.expandoStartIndex}function c(n,e,t,i){const s=n.data;if(null===s[t+1]){const o=s[Ki()],l=a(n,t);z(o,i)&&null===e&&!l&&(e=!1),e=function h(n,e,t,i){const s=function Zh(n){const e=Zt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let o=i?e.residualClasses:e.residualStyles;if(null===s)0===(i?e.classBindings:e.styleBindings)&&(t=M(t=w(null,n,e,t,i),e.attrs,i),o=null);else{const l=e.directiveStylingLast;if(-1===l||n[l]!==s)if(t=w(s,n,e,t,i),null===o){let f=function p(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==gl(i))return n[wa(i)]}(n,e,i);void 0!==f&&Array.isArray(f)&&(f=w(null,n,e,f[1],i),f=M(f,e.attrs,i),function g(n,e,t,i){n[wa(t?e.classBindings:e.styleBindings)]=i}(n,e,i,f))}else o=function _(n,e,t){let i;const s=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<s;o++)i=M(i,n[o].hostAttrs,t);return M(i,e.attrs,t)}(n,e,i)}return void 0!==o&&(i?e.residualClasses=o:e.residualStyles=o),t}(s,o,e,i),function m1(n,e,t,i,s,o){let l=o?e.classBindings:e.styleBindings,u=wa(l),f=gl(l);n[i]=t;let y,m=!1;if(Array.isArray(t)){const v=t;y=v[1],(null===y||ud(v,y)>0)&&(m=!0)}else y=t;if(s)if(0!==f){const x=wa(n[u+1]);n[i+1]=yp(x,u),0!==x&&(n[x+1]=vd(n[x+1],i)),n[u+1]=function cw(n,e){return 131071&n|e<<17}(n[u+1],i)}else n[i+1]=yp(u,0),0!==u&&(n[u+1]=vd(n[u+1],i)),u=i;else n[i+1]=yp(f,0),0===u?u=i:n[f+1]=vd(n[f+1],i),f=i;m&&(n[i+1]=_v(n[i+1])),dM(n,y,i,!0),dM(n,y,i,!1),function g1(n,e,t,i,s){const o=s?n.residualClasses:n.residualStyles;null!=o&&"string"==typeof e&&ud(o,e)>=0&&(t[i+1]=Yl(t[i+1]))}(e,y,n,i,o),l=yp(u,f),o?e.classBindings=l:e.styleBindings=l}(s,o,e,t,l,i)}}function w(n,e,t,i,s){let o=null;const l=t.directiveEnd;let u=t.directiveStylingLast;for(-1===u?u=t.directiveStart:u++;u<l&&(o=e[u],i=M(i,o.hostAttrs,s),o!==n);)u++;return null!==n&&(t.directiveStylingLast=u),i}function M(n,e,t){const i=t?1:2;let s=-1;if(null!==e)for(let o=0;o<e.length;o++){const l=e[o];"number"==typeof l?s=l:s===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),Qo(n,l,!!t||e[++o]))}return void 0===n?null:n}function R(n,e,t,i,s,o,l,u){if(!(3&e.type))return;const f=n.data,m=f[u+1];P(function _p(n){return 1==(1&n)}(m)?L(f,e,t,s,gl(m),l):void 0)||(P(o)||function yv(n){return 2==(2&n)}(m)&&(o=L(f,null,t,s,u,l)),function sw(n,e,t,i,s){const o=Pr(n);if(e)s?o?n.addClass(t,i):t.classList.add(i):o?n.removeClass(t,i):t.classList.remove(i);else{let l=-1===i.indexOf("-")?void 0:ta.DashCase;if(null==s)o?n.removeStyle(t,i,l):t.style.removeProperty(i);else{const u="string"==typeof s&&s.endsWith("!important");u&&(s=s.slice(0,-10),l|=ta.Important),o?n.setStyle(t,i,s,l):t.style.setProperty(i,s,u?"important":"")}}}(i,l,Oo(Ki(),t),s,o))}function L(n,e,t,i,s,o){const l=null===e;let u;for(;s>0;){const f=n[s],m=Array.isArray(f),y=m?f[1]:f,v=null===y;let x=t[s+1];x===In&&(x=v?cr:void 0);let b=v?k_(x,i):y===i?x:void 0;if(m&&!P(b)&&(b=k_(f,i)),P(b)&&(u=b,l))return u;const E=n[s+1];s=l?wa(E):gl(E)}if(null!==e){let f=o?e.residualClasses:e.residualStyles;null!=f&&(u=k_(f,i))}return u}function P(n){return void 0!==n}function z(n,e){return 0!=(n.flags&(e?16:32))}function B(n,e=""){const t=rt(),i=Mi(),s=n+20,o=i.firstCreatePass?Md(i,s,1,e,null):i.data[s],l=t[s]=function av(n,e){return Pr(n)?n.createText(e):n.createTextNode(e)}(t[11],e);ap(i,t,l,o),hl(o,!1)}function j(n){return H("",n,""),j}function H(n,e,t){const i=rt(),s=nh(i,n,e,t);return s!==In&&ko(i,Ki(),s),H}function dt(n,e,t){r(Qo,Ml,nh(rt(),n,e,t),!0)}const ne=void 0;var ze=["en",[["a","p"],["AM","PM"],ne],[["AM","PM"],ne,ne],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ne,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ne,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ne,"{1} 'at' {0}",ne],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function $(n){const t=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===i?1:5}];let ft={};function St(n){const e=function fe(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=Kn(e);if(t)return t;const i=e.split("-")[0];if(t=Kn(i),t)return t;if("en"===i)return ze;throw new Error(`Missing locale data for the locale "${n}".`)}function Kn(n){return n in ft||(ft[n]=Bi.ng&&Bi.ng.common&&Bi.ng.common.locales&&Bi.ng.common.locales[n]),ft[n]}var Ne=(()=>((Ne=Ne||{})[Ne.LocaleId=0]="LocaleId",Ne[Ne.DayPeriodsFormat=1]="DayPeriodsFormat",Ne[Ne.DayPeriodsStandalone=2]="DayPeriodsStandalone",Ne[Ne.DaysFormat=3]="DaysFormat",Ne[Ne.DaysStandalone=4]="DaysStandalone",Ne[Ne.MonthsFormat=5]="MonthsFormat",Ne[Ne.MonthsStandalone=6]="MonthsStandalone",Ne[Ne.Eras=7]="Eras",Ne[Ne.FirstDayOfWeek=8]="FirstDayOfWeek",Ne[Ne.WeekendRange=9]="WeekendRange",Ne[Ne.DateFormat=10]="DateFormat",Ne[Ne.TimeFormat=11]="TimeFormat",Ne[Ne.DateTimeFormat=12]="DateTimeFormat",Ne[Ne.NumberSymbols=13]="NumberSymbols",Ne[Ne.NumberFormats=14]="NumberFormats",Ne[Ne.CurrencyCode=15]="CurrencyCode",Ne[Ne.CurrencySymbol=16]="CurrencySymbol",Ne[Ne.CurrencyName=17]="CurrencyName",Ne[Ne.Currencies=18]="Currencies",Ne[Ne.Directionality=19]="Directionality",Ne[Ne.PluralCase=20]="PluralCase",Ne[Ne.ExtraData=21]="ExtraData",Ne))();const Cn="en-US";let Si=Cn;function D1(n,e,t,i,s){if(n=Un(n),Array.isArray(n))for(let o=0;o<n.length;o++)D1(n[o],e,t,i,s);else{const o=Mi(),l=rt();let u=Ea(n)?n:Un(n.provide),f=bl(n);const m=as(),y=1048575&m.providerIndexes,v=m.directiveStart,x=m.providerIndexes>>20;if(Ea(n)||!n.multi){const b=new fl(f,s,He),E=P1(u,e,s?y:y+x,v);-1===E?(eg(qf(m,l),o,u),R1(o,n,e.length),e.push(u),m.directiveStart++,m.directiveEnd++,s&&(m.providerIndexes+=1048576),t.push(b),l.push(b)):(t[E]=b,l[E]=b)}else{const b=P1(u,e,y+x,v),E=P1(u,e,y,y+x),C=b>=0&&t[b],A=E>=0&&t[E];if(s&&!A||!s&&!C){eg(qf(m,l),o,u);const N=function pk(n,e,t,i,s){const o=new fl(n,t,He);return o.multi=[],o.index=e,o.componentProviders=0,bI(o,s,i&&!t),o}(s?fk:dk,t.length,s,i,f);!s&&A&&(t[E].providerFactory=N),R1(o,n,e.length,0),e.push(u),m.directiveStart++,m.directiveEnd++,s&&(m.providerIndexes+=1048576),t.push(N),l.push(N)}else R1(o,n,b>-1?b:E,bI(t[s?E:b],f,!s&&i));!s&&i&&A&&t[E].componentProviders++}}}function R1(n,e,t,i){const s=Ea(e),o=function Uv(n){return!!n.useClass}(e);if(s||o){const f=(o?Un(e.useClass):e).prototype.ngOnDestroy;if(f){const m=n.destroyHooks||(n.destroyHooks=[]);if(!s&&e.multi){const y=m.indexOf(t);-1===y?m.push(t,[i,f]):m[y+1].push(i,f)}else m.push(t,f)}}}function bI(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function P1(n,e,t,i){for(let s=t;s<i;s++)if(e[s]===n)return s;return-1}function dk(n,e,t,i){return I1(this.multi,[])}function fk(n,e,t,i){const s=this.multi;let o;if(this.providerFactory){const l=this.providerFactory.componentProviders,u=jf(t,t[1],this.providerFactory.index,i);o=u.slice(0,l),I1(s,o);for(let f=l;f<u.length;f++)o.push(u[f])}else o=[],I1(s,o);return o}function I1(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function Wr(n,e=[]){return t=>{t.providersResolver=(i,s)=>function hk(n,e,t){const i=Mi();if(i.firstCreatePass){const s=$o(n);D1(t,i.data,i.blueprint,s,!0),D1(e,i.data,i.blueprint,s,!1)}}(i,s?s(n):n,e)}}class wI{}class yk{resolveComponentFactory(e){throw function gk(n){const e=Error(`No component factory found for ${Hi(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let f0=(()=>{class n{}return n.NULL=new yk,n})();function _k(){return Kg(as(),rt())}function Kg(n,e){return new Ra(os(n,e))}let Ra=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=_k,n})();function vk(n){return n instanceof Ra?n.nativeElement:n}class EI{}let qp=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function bk(){const n=rt(),t=As(as().index,n);return function xk(n){return n[11]}(ma(t)?t:n)}(),n})(),wk=(()=>{class n{}return n.\u0275prov=Zn({token:n,providedIn:"root",factory:()=>null}),n})();class MM{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const Mk=new MM("13.3.11"),L1={};function EM(n,e,t,i,s=!1){for(;null!==t;){const o=e[t.index];if(null!==o&&i.push(ss(o)),ga(o))for(let u=10;u<o.length;u++){const f=o[u],m=f[1].firstChild;null!==m&&EM(f[1],f,m,i)}const l=t.type;if(8&l)EM(n,e,t.child,i);else if(32&l){const u=hg(t,e);let f;for(;f=u();)i.push(f)}else if(16&l){const u=Nc(e,t);if(Array.isArray(u))i.push(...u);else{const f=Nu(e[16]);EM(f[1],f,u,i,!0)}}t=s?t.projectionNext:t.next}return i}class p0{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return EM(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ga(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(cv(e,i),ng(t,i))}this._attachedToViewContainer=!1}uv(this._lView[1],this._lView)}onDestroy(e){Xu(this._lView[1],this._lView,null,e)}markForCheck(){Dp(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function Ag(n,e,t){const i=e[10];i.begin&&i.begin();try{vl(n,e,n.template,t)}catch(s){throw Vc(e,s),s}finally{i.end&&i.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new wi(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function _T(n,e){cp(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new wi(902,"");this._appRef=e}}class Ek extends p0{constructor(e){super(e),this._view=e}detectChanges(){Nv(this._view)}checkNoChanges(){}get context(){return null}}class SI extends f0{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=lo(e);return new F1(t,this.ngModule)}}function CI(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class F1 extends wI{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function mv(n){return n.map(aw).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return CI(this.componentDef.inputs)}get outputs(){return CI(this.componentDef.outputs)}create(e,t,i,s){const o=(s=s||this.ngModule)?function Ck(n,e){return{get:(t,i,s)=>{const o=n.get(t,L1,s);return o!==L1||i===L1?o:e.get(t,i,s)}}}(e,s.injector):e,l=o.get(EI,b_),u=o.get(wk,null),f=l.createRenderer(null,this.componentDef),m=this.componentDef.selectors[0][0]||"div",y=i?function Ql(n,e,t){if(Pr(n))return n.selectRootElement(e,t===Yo.ShadowDom);let i="string"==typeof e?n.querySelector(e):e;return i.textContent="",i}(f,i,this.componentDef.encapsulation):lv(l.createRenderer(null,this.componentDef),m,function Sk(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(m)),v=this.componentDef.onPush?576:528,x=function Ng(n,e){return{components:[],scheduler:n||Fc,clean:$u,playerHandler:e||null,flags:0}}(),b=Jl(0,null,null,1,0,null,null,null,null,null),E=bp(null,b,x,v,null,null,l,f,u,o);let C,A;Au(E);try{const N=function qv(n,e,t,i,s,o){const l=t[1];t[20]=n;const f=Md(l,20,2,"#host",null),m=f.mergedAttrs=e.hostAttrs;null!==m&&(nc(f,m,!0),null!==n&&($m(s,n,m),null!==f.classes&&Vu(s,n,f.classes),null!==f.styles&&md(s,n,f.styles)));const y=i.createRenderer(n,e),v=bp(t,Dv(e),null,e.onPush?64:16,t[20],f,i,y,o||null,null);return l.firstCreatePass&&(eg(qf(f,t),l,e.type),xw(l,f),bw(f,t.length,1)),Bc(t,v),t[20]=v}(y,this.componentDef,E,l,f);if(y)if(i)$m(f,y,["ng-version",Mk.full]);else{const{attrs:F,classes:V}=function lw(n){const e=[],t=[];let i=1,s=2;for(;i<n.length;){let o=n[i];if("string"==typeof o)2===s?""!==o&&e.push(o,n[++i]):8===s&&t.push(o);else{if(!go(s))break;s=o}i++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);F&&$m(f,y,F),V&&V.length>0&&Vu(f,y,V.join(" "))}if(A=Ga(b,20),void 0!==t){const F=A.projection=[];for(let V=0;V<this.ngContentSelectors.length;V++){const k=t[V];F.push(null!=k?Array.from(k):null)}}C=function Ad(n,e,t,i,s){const o=t[1],l=function Cp(n,e,t){const i=as();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),Sg(n,i,e,Zl(n,e,1,null),t));const s=jf(e,n,i.directiveStart,i);po(s,e);const o=os(i,e);return o&&po(o,e),s}(o,t,e);if(i.components.push(l),n[8]=l,s&&s.forEach(f=>f(l,e)),e.contentQueries){const f=as();e.contentQueries(1,l,f.directiveStart)}const u=as();return!o.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(ql(u.index),_w(t[1],u,0,u.directiveStart,u.directiveEnd,e),vw(e,l)),l}(N,this.componentDef,E,x,[Lw]),Wu(b,E,null)}finally{Du()}return new Ak(this.componentType,C,Kg(A,E),E,A)}}class Ak extends class mk{}{constructor(e,t,i,s,o){super(),this.location=i,this._rootLView=s,this._tNode=o,this.instance=t,this.hostView=this.changeDetectorRef=new Ek(s),this.componentType=e}get injector(){return new sd(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class $g{}const Zg=new Map;class DI extends $g{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new SI(this);const i=Yi(e);this._bootstrapComponents=qa(i.bootstrap),this._r3Injector=Lg(e,t,[{provide:$g,useValue:this},{provide:f0,useValue:this.componentFactoryResolver}],Hi(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=zr.THROW_IF_NOT_FOUND,i=En.Default){return e===zr||e===$g||e===Dg?this:this._r3Injector.get(e,t,i)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class N1 extends class Rk{}{constructor(e){super(),this.moduleType=e,null!==Yi(e)&&function Pk(n){const e=new Set;!function t(i){const s=Yi(i,!0),o=s.id;null!==o&&(function TI(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${Hi(e)} vs ${Hi(e.name)}`)}(o,Zg.get(o),i),Zg.set(o,i));const l=qa(s.imports);for(const u of l)e.has(u)||(e.add(u),t(u))}(n)}(e)}create(e){return new DI(this.moduleType,e)}}function m0(n,e){const t=n[e];return t===In?void 0:t}function SM(n,e){const t=Mi();let i;const s=n+20;t.firstCreatePass?(i=function Hk(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[s]=i,i.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(s,i.onDestroy)):i=t.data[s];const o=i.factory||(i.factory=No(i.type)),l=Sc(He);try{const u=Jm(!1),f=o();return Jm(u),function e1(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,rt(),s,f),f}finally{Sc(l)}}function O1(n,e,t){const i=n+20,s=rt(),o=Wa(s,i);return g0(s,i)?function RI(n,e,t,i,s,o){const l=e+t;return Qs(n,l,s)?Ya(n,l+1,o?i.call(o,s):i(s)):m0(n,l+1)}(s,Jt(),e,o.transform,t,o):o.transform(t)}function NI(n,e,t,i,s){const o=n+20,l=rt(),u=Wa(l,o);return g0(l,o)?function II(n,e,t,i,s,o,l,u){const f=e+t;return Vp(n,f,s,o,l)?Ya(n,f+3,u?i.call(u,s,o,l):i(s,o,l)):m0(n,f+3)}(l,Jt(),e,u.transform,t,i,s,u):u.transform(t,i,s)}function g0(n,e){return n[1].data[e].pure}function B1(n){return e=>{setTimeout(n,void 0,e)}}const Ui=class jk extends Xt{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){var s,o,l;let u=e,f=t||(()=>null),m=i;if(e&&"object"==typeof e){const v=e;u=null===(s=v.next)||void 0===s?void 0:s.bind(v),f=null===(o=v.error)||void 0===o?void 0:o.bind(v),m=null===(l=v.complete)||void 0===l?void 0:l.bind(v)}this.__isAsync&&(f=B1(f),u&&(u=B1(u)),m&&(m=B1(m)));const y=super.subscribe({next:u,error:f,complete:m});return e instanceof Dn&&e.add(y),y}};function Xk(){return this._results[Dd()]()}class k1{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Dd(),i=k1.prototype;i[t]||(i[t]=Xk)}get changes(){return this._changes||(this._changes=new Ui)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const s=xa(e);(this._changesDetected=!function _C(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let s=n[i],o=e[i];if(t&&(s=t(s),o=t(o)),o!==s)return!1}return!0}(i._results,s,t))&&(i._results=s,i.length=s.length,i.last=s[this.length-1],i.first=s[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let hh=(()=>{class n{}return n.__NG_ELEMENT_ID__=$k,n})();const Yk=hh,Kk=class extends Yk{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e){const t=this._declarationTContainer.tViews,i=bp(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(i[19]=o.createEmbeddedView(t)),Wu(t,i,e),new p0(i)}};function $k(){return CM(as(),rt())}function CM(n,e){return 4&n.type?new Kk(e,n,Kg(n,e)):null}let oc=(()=>{class n{}return n.__NG_ELEMENT_ID__=Zk,n})();function Zk(){return kI(as(),rt())}const Jk=oc,OI=class extends Jk{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Kg(this._hostTNode,this._hostLView)}get injector(){return new sd(this._hostTNode,this._hostLView)}get parentInjector(){const e=Qm(this._hostTNode,this._hostLView);if(Qx(e)){const t=rd(e,this._hostLView),i=id(e);return new sd(t[1].data[i+8],t)}return new sd(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=BI(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,i){const s=e.createEmbeddedView(t||{});return this.insert(s,i),s}createComponent(e,t,i,s,o){const l=e&&!function Yf(n){return"function"==typeof n}(e);let u;if(l)u=t;else{const v=t||{};u=v.index,i=v.injector,s=v.projectableNodes,o=v.ngModuleRef}const f=l?e:new F1(lo(e)),m=i||this.parentInjector;if(!o&&null==f.ngModule){const x=(l?m:this.parentInjector).get($g,null);x&&(o=x)}const y=f.create(m,s,void 0,o);return this.insert(y.hostView,u),y}insert(e,t){const i=e._lView,s=i[1];if(function E_(n){return ga(n[3])}(i)){const y=this.indexOf(e);if(-1!==y)this.detach(y);else{const v=i[3],x=new OI(v,v[6],v[3]);x.detach(x.indexOf(e))}}const o=this._adjustIndex(t),l=this._lContainer;!function xT(n,e,t,i){const s=10+i,o=t.length;i>0&&(t[s-1][4]=e),i<o-10?(e[4]=t[s],cb(t,10+i,e)):(t.push(e),e[4]=null),e[3]=t;const l=e[17];null!==l&&t!==l&&function bT(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(l,e);const u=e[19];null!==u&&u.insertView(n),e[2]|=128}(s,i,l,o);const u=pv(o,l),f=i[11],m=ku(f,l[7]);return null!==m&&function yT(n,e,t,i,s,o){i[0]=s,i[6]=e,cp(n,i,t,1,s,o)}(s,l[6],f,i,m,u),e.attachToViewContainerRef(),cb(V1(l),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=BI(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=cv(this._lContainer,t);i&&(ng(V1(this._lContainer),t),uv(i[1],i))}detach(e){const t=this._adjustIndex(e,-1),i=cv(this._lContainer,t);return i&&null!=ng(V1(this._lContainer),t)?new p0(i):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function BI(n){return n[8]}function V1(n){return n[8]||(n[8]=[])}function kI(n,e){let t;const i=e[n.index];if(ga(i))t=i;else{let s;if(8&n.type)s=ss(i);else{const o=e[11];s=o.createComment("");const l=os(n,e);Bu(o,ku(o,l),s,function pg(n,e){return Pr(n)?n.nextSibling(e):e.nextSibling}(o,l),!1)}e[n.index]=t=Tp(i,e,s,n),Bc(e,t)}return new OI(t,n,e)}class U1{constructor(e){this.queryList=e,this.matches=null}clone(){return new U1(this.queryList)}setDirty(){this.queryList.setDirty()}}class z1{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,s=[];for(let o=0;o<i;o++){const l=t.getByIndex(o);s.push(this.queries[l.indexInDeclarationView].clone())}return new z1(s)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==GI(e,t).matches&&this.queries[t].setDirty()}}class VI{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class H1{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const s=null!==t?t.length:0,o=this.getByIndex(i).embeddedTView(e,s);o&&(o.indexInDeclarationView=i,null!==t?t.push(o):t=[o])}return null!==t?new H1(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class G1{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new G1(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let s=0;s<i.length;s++){const o=i[s];this.matchTNodeWithReadOption(e,t,tV(t,o)),this.matchTNodeWithReadOption(e,t,tg(t,e,o,!1,!1))}else i===hh?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,tg(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const s=this.metadata.read;if(null!==s)if(s===Ra||s===oc||s===hh&&4&t.type)this.addMatch(t.index,-2);else{const o=tg(t,e,s,!1,!1);null!==o&&this.addMatch(t.index,o)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function tV(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function iV(n,e,t,i){return-1===t?function nV(n,e){return 11&n.type?Kg(n,e):4&n.type?CM(n,e):null}(e,n):-2===t?function rV(n,e,t){return t===Ra?Kg(e,n):t===hh?CM(e,n):t===oc?kI(e,n):void 0}(n,e,i):jf(n,n[1],t,e)}function UI(n,e,t,i){const s=e[19].queries[i];if(null===s.matches){const o=n.data,l=t.matches,u=[];for(let f=0;f<l.length;f+=2){const m=l[f];u.push(m<0?null:iV(e,o[m],l[f+1],t.metadata.read))}s.matches=u}return s.matches}function W1(n,e,t,i){const s=n.queries.getByIndex(t),o=s.matches;if(null!==o){const l=UI(n,e,s,t);for(let u=0;u<o.length;u+=2){const f=o[u];if(f>0)i.push(l[u/2]);else{const m=o[u+1],y=e[-f];for(let v=10;v<y.length;v++){const x=y[v];x[17]===x[3]&&W1(x[1],x,m,i)}if(null!==y[9]){const v=y[9];for(let x=0;x<v.length;x++){const b=v[x];W1(b[1],b,m,i)}}}}}return i}function y0(n){const e=rt(),t=Mi(),i=Vf();Jh(i+1);const s=GI(t,i);if(n.dirty&&M_(e)===(2==(2&s.metadata.flags))){if(null===s.matches)n.reset([]);else{const o=s.crossesNgTemplate?W1(t,e,i,[]):UI(t,e,s,i);n.reset(o,vk),n.notifyOnChanges()}return!0}return!1}function _0(n,e,t){const i=Mi();i.firstCreatePass&&(function HI(n,e,t){null===n.queries&&(n.queries=new H1),n.queries.track(new G1(e,t))}(i,new VI(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),function zI(n,e,t){const i=new k1(4==(4&t));Xu(n,e,i,i.destroy),null===e[19]&&(e[19]=new z1),e[19].queries.push(new U1(i))}(i,rt(),e)}function v0(){return function oV(n,e){return n[19].queries[e].queryList}(rt(),Vf())}function GI(n,e){return n.queries.getByIndex(e)}function DM(...n){}const oL=new ii("Application Initializer");let $1=(()=>{class n{constructor(t){this.appInits=t,this.resolve=DM,this.reject=DM,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,s)=>{this.resolve=i,this.reject=s})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let s=0;s<this.appInits.length;s++){const o=this.appInits[s]();if(Hp(o))t.push(o);else if(Da(o)){const l=new Promise((u,f)=>{o.subscribe({complete:u,error:f})});t.push(l)}}Promise.all(t).then(()=>{i()}).catch(s=>{this.reject(s)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(Bn(oL,8))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const b0=new ii("AppId",{providedIn:"root",factory:function aL(){return`${Z1()}${Z1()}${Z1()}`}});function Z1(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const lL=new ii("Platform Initializer"),w0=new ii("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),SV=new ii("appBootstrapListener"),Vd=new ii("LocaleId",{providedIn:"root",factory:()=>PC(Vd,En.Optional|En.SkipSelf)||function CV(){return"undefined"!=typeof $localize&&$localize.locale||Cn}()}),RV=(()=>Promise.resolve(0))();function J1(n){"undefined"==typeof Zone?RV.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Vo{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ui(!1),this.onMicrotaskEmpty=new Ui(!1),this.onStable=new Ui(!1),this.onError=new Ui(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!i&&t,s.shouldCoalesceRunChangeDetection=i,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function PV(){let n=Bi.requestAnimationFrame,e=Bi.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function FV(n){const e=()=>{!function LV(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Bi,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,eA(n),n.isCheckStableRunning=!0,Q1(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),eA(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,s,o,l,u)=>{try{return cL(n),t.invokeTask(s,o,l,u)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&e(),uL(n)}},onInvoke:(t,i,s,o,l,u,f)=>{try{return cL(n),t.invoke(s,o,l,u,f)}finally{n.shouldCoalesceRunChangeDetection&&e(),uL(n)}},onHasTask:(t,i,s,o)=>{t.hasTask(s,o),i===s&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,eA(n),Q1(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(t,i,s,o)=>(t.handleError(s,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(s)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Vo.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Vo.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,s){const o=this._inner,l=o.scheduleEventTask("NgZoneEvent: "+s,e,IV,DM,DM);try{return o.runTask(l,t,i)}finally{o.cancelTask(l)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const IV={};function Q1(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function eA(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function cL(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function uL(n){n._nesting--,Q1(n)}class NV{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ui,this.onMicrotaskEmpty=new Ui,this.onStable=new Ui,this.onError=new Ui}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,s){return e.apply(t,i)}}let tA=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Vo.assertNotInAngularZone(),J1(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())J1(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,s){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(l=>l.timeoutId!==o),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:o,updateCb:s})}whenStable(t,i,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,i,s){return[]}}return n.\u0275fac=function(t){return new(t||n)(Bn(Vo))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})(),OV=(()=>{class n{constructor(){this._applications=new Map,nA.addToWindow(this)}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return nA.findTestabilityInTree(this,t,i)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();class BV{addToWindow(e){}findTestabilityInTree(e,t,i){return null}}let nA=new BV,jp=null;const hL=new ii("AllowMultipleToken"),dL=new ii("PlatformOnDestroy");function fL(n,e,t=[]){const i=`Platform: ${e}`,s=new ii(i);return(o=[])=>{let l=iA();if(!l||l.injector.get(hL,!1)){const u=[...t,...o,{provide:s,useValue:!0}];n?n(u):function zV(n){if(jp&&!jp.get(hL,!1))throw new wi(400,"");jp=n;const e=n.get(pL),t=n.get(lL,null);t&&t.forEach(i=>i())}(function GV(n=[],e){return zr.create({name:e,providers:[{provide:Pp,useValue:"platform"},{provide:dL,useValue:()=>jp=null},...n]})}(u,i))}return function HV(n){const e=iA();if(!e)throw new wi(401,"");return e}()}}function iA(){var n;return null!==(n=null==jp?void 0:jp.get(pL))&&void 0!==n?n:null}let pL=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const u=function WV(n,e){let t;return t="noop"===n?new NV:("zone.js"===n?void 0:n)||new Vo({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),f=[{provide:Vo,useValue:u}];return u.run(()=>{const m=zr.create({providers:f,parent:this.injector,name:t.moduleType.name}),y=t.create(m),v=y.injector.get(op,null);if(!v)throw new wi(402,"");return u.runOutsideAngular(()=>{const x=u.onError.subscribe({next:b=>{v.handleError(b)}});y.onDestroy(()=>{sA(this._modules,y),x.unsubscribe()})}),function qV(n,e,t){try{const i=t();return Hp(i)?i.catch(s=>{throw e.runOutsideAngular(()=>n.handleError(s)),s}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(v,u,()=>{const x=y.injector.get($1);return x.runInitializers(),x.donePromise.then(()=>(function El(n){Xo(n,"Expected localeId to be defined"),"string"==typeof n&&(Si=n.toLowerCase().replace(/_/g,"-"))}(y.injector.get(Vd,Cn)||Cn),this._moduleDoBootstrap(y),y))})})}bootstrapModule(t,i=[]){const s=mL({},i);return function VV(n,e,t){const i=new N1(t);return Promise.resolve(i)}(0,0,t).then(o=>this.bootstrapModuleFactory(o,s))}_moduleDoBootstrap(t){const i=t.injector.get(rA);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(s=>i.bootstrap(s));else{if(!t.instance.ngDoBootstrap)throw new wi(403,"");t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new wi(404,"");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(dL,null);null==t||t(),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Bn(zr))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function mL(n,e){return Array.isArray(e)?e.reduce(mL,n):Object.assign(Object.assign({},n),e)}let rA=(()=>{class n{constructor(t,i,s,o){this._zone=t,this._injector=i,this._exceptionHandler=s,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const l=new Ar(f=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{f.next(this._stable),f.complete()})}),u=new Ar(f=>{let m;this._zone.runOutsideAngular(()=>{m=this._zone.onStable.subscribe(()=>{Vo.assertNotInAngularZone(),J1(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,f.next(!0))})})});const y=this._zone.onUnstable.subscribe(()=>{Vo.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{f.next(!1)}))});return()=>{m.unsubscribe(),y.unsubscribe()}});this.isStable=function o_(...n){const e=Ol(n),t=function vu(n,e){return"number"==typeof Ss(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?de(i[0]):function Qi(n=1/0){return Es($t,n)}(t)(Bh(i,e)):$n}(l,u.pipe(Bm()))}bootstrap(t,i){if(!this._initStatus.done)throw new wi(405,"");let s;s=t instanceof wI?t:this._injector.get(f0).resolveComponentFactory(t),this.componentTypes.push(s.componentType);const o=function UV(n){return n.isBoundToModule}(s)?void 0:this._injector.get($g),u=s.create(zr.NULL,[],i||s.selector,o),f=u.location.nativeElement,m=u.injector.get(tA,null),y=m&&u.injector.get(OV);return m&&y&&y.registerApplication(f,m),u.onDestroy(()=>{this.detachView(u.hostView),sA(this.components,u),y&&y.unregisterApplication(f)}),this._loadComponent(u),u}tick(){if(this._runningTick)throw new wi(101,"");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;sA(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(SV,[]).concat(this._bootstrapListeners).forEach(s=>s(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(Bn(Vo),Bn(zr),Bn(op),Bn($1))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function sA(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let yL=!0,oA=(()=>{class n{}return n.__NG_ELEMENT_ID__=YV,n})();function YV(n){return function KV(n,e,t){if(ya(n)&&!t){const i=As(n.index,e);return new p0(i,i)}return 47&n.type?new p0(e[16],e):null}(as(),rt(),16==(16&n))}class wL{constructor(){}supports(e){return Rd(e)}create(e){return new tU(e)}}const eU=(n,e)=>e;class tU{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||eU}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,s=0,o=null;for(;t||i;){const l=!i||t&&t.currentIndex<EL(i,s,o)?t:i,u=EL(l,s,o),f=l.currentIndex;if(l===i)s--,i=i._nextRemoved;else if(t=t._next,null==l.previousIndex)s++;else{o||(o=[]);const m=u-s,y=f-s;if(m!=y){for(let x=0;x<m;x++){const b=x<o.length?o[x]:o[x]=0,E=b+x;y<=E&&E<m&&(o[x]=b+1)}o[l.previousIndex]=y-m}}u!==f&&e(l,u,f)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Rd(e))throw new wi(900,"");return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let s,o,l,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let u=0;u<this.length;u++)o=e[u],l=this._trackByFn(u,o),null!==t&&Object.is(t.trackById,l)?(i&&(t=this._verifyReinsertion(t,o,l,u)),Object.is(t.item,o)||this._addIdentityChange(t,o)):(t=this._mismatch(t,o,l,u),i=!0),t=t._next}else s=0,function kg(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[Dd()]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,u=>{l=this._trackByFn(s,u),null!==t&&Object.is(t.trackById,l)?(i&&(t=this._verifyReinsertion(t,u,l,s)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,l,s),i=!0),t=t._next,s++}),this.length=s;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,s){let o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,s)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,s))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,s)):e=this._addAfter(new nU(t,i),o,s),e}_verifyReinsertion(e,t,i,s){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==o?e=this._reinsertAfter(o,e._prev,s):e.currentIndex!=s&&(e.currentIndex=s,this._addToMoves(e,s)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const s=e._prevRemoved,o=e._nextRemoved;return null===s?this._removalsHead=o:s._nextRemoved=o,null===o?this._removalsTail=s:o._prevRemoved=s,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const s=null===t?this._itHead:t._next;return e._next=s,e._prev=t,null===s?this._itTail=e:s._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new ML),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ML),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class nU{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class iU{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class ML{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new iU,this.map.set(t,i)),i.add(e)}get(e,t){const s=this.map.get(e);return s?s.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function EL(n,e,t){const i=n.previousIndex;if(null===i)return i;let s=0;return t&&i<t.length&&(s=t[i]),i+e+s}class SL{constructor(){}supports(e){return e instanceof Map||kp(e)}create(){return new rU}}class rU{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||kp(e)))throw new wi(900,"")}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(i,s)=>{if(t&&t.key===s)this._maybeAddToChanges(t,i),this._appendAfter=t,t=t._next;else{const o=this._getOrCreateRecordForKey(s,i);t=this._insertBeforeOrAppend(t,o)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let i=t;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const i=e._prev;return t._next=e,t._prev=i,e._prev=t,i&&(i._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const s=this._records.get(e);this._maybeAddToChanges(s,t);const o=s._prev,l=s._next;return o&&(o._next=l),l&&(l._prev=o),s._next=null,s._prev=null,s}const i=new sU(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(i=>t(e[i],i))}}class sU{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function CL(){return new IM([new wL])}let IM=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(null!=i){const s=i.factories.slice();t=t.concat(s)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||CL()),deps:[[n,new G_,new H_]]}}find(t){const i=this.factories.find(s=>s.supports(t));if(null!=i)return i;throw new wi(901,"")}}return n.\u0275prov=Zn({token:n,providedIn:"root",factory:CL}),n})();function TL(){return new M0([new SL])}let M0=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(i){const s=i.factories.slice();t=t.concat(s)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||TL()),deps:[[n,new G_,new H_]]}}find(t){const i=this.factories.find(o=>o.supports(t));if(i)return i;throw new wi(901,"")}}return n.\u0275prov=Zn({token:n,providedIn:"root",factory:TL}),n})();const lU=fL(null,"core",[]);let cU=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Bn(rA))},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({}),n})(),LM=null;function Yp(){return LM}const Pa=new ii("DocumentToken");var Ia=(()=>((Ia=Ia||{})[Ia.Decimal=0]="Decimal",Ia[Ia.Percent=1]="Percent",Ia[Ia.Currency=2]="Currency",Ia[Ia.Scientific=3]="Scientific",Ia))(),bn=(()=>((bn=bn||{})[bn.Decimal=0]="Decimal",bn[bn.Group=1]="Group",bn[bn.List=2]="List",bn[bn.PercentSign=3]="PercentSign",bn[bn.PlusSign=4]="PlusSign",bn[bn.MinusSign=5]="MinusSign",bn[bn.Exponential=6]="Exponential",bn[bn.SuperscriptingExponent=7]="SuperscriptingExponent",bn[bn.PerMille=8]="PerMille",bn[bn.Infinity=9]="Infinity",bn[bn.NaN=10]="NaN",bn[bn.TimeSeparator=11]="TimeSeparator",bn[bn.CurrencyDecimal=12]="CurrencyDecimal",bn[bn.CurrencyGroup=13]="CurrencyGroup",bn))();function Tl(n,e){const t=St(n),i=t[Ne.NumberSymbols][e];if(void 0===i){if(e===bn.CurrencyDecimal)return t[Ne.NumberSymbols][bn.Decimal];if(e===bn.CurrencyGroup)return t[Ne.NumberSymbols][bn.Group]}return i}const zU=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function _A(n){const e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}function kL(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[s,o]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(s.trim()===e)return decodeURIComponent(o)}return null}class ez{constructor(e,t,i,s){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let C0=(()=>{class n{constructor(t,i,s){this._viewContainer=t,this._template=i,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((s,o,l)=>{if(null==s.previousIndex)i.createEmbeddedView(this._template,new ez(s.item,this._ngForOf,-1,-1),null===l?void 0:l);else if(null==l)i.remove(null===o?void 0:o);else if(null!==o){const u=i.get(o);i.move(u,l),VL(u,s)}});for(let s=0,o=i.length;s<o;s++){const u=i.get(s).context;u.index=s,u.count=o,u.ngForOf=this._ngForOf}t.forEachIdentityChange(s=>{VL(i.get(s.currentIndex),s)})}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(He(oc),He(hh),He(IM))},n.\u0275dir=Pn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),n})();function VL(n,e){n.context.$implicit=e.item}let Yc=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new tz,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){UL("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){UL("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(He(oc),He(hh))},n.\u0275dir=Pn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class tz{constructor(){this.$implicit=null,this.ngIf=null}}function UL(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Hi(e)}'.`)}class xA{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let T0=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const i=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(t)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Pn({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),n})(),bA=(()=>{class n{constructor(t,i,s){this.ngSwitch=s,s._addCase(),this._view=new xA(t,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(t){return new(t||n)(He(oc),He(hh),He(T0,9))},n.\u0275dir=Pn({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),n})(),zL=(()=>{class n{constructor(t,i,s){s._addDefault(new xA(t,i))}}return n.\u0275fac=function(t){return new(t||n)(He(oc),He(hh),He(T0,9))},n.\u0275dir=Pn({type:n,selectors:[["","ngSwitchDefault",""]]}),n})(),GL=(()=>{class n{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(t){if(t.ngTemplateOutlet){const i=this._viewContainerRef;this._viewRef&&i.remove(i.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?i.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(t){return new(t||n)(He(oc))},n.\u0275dir=Pn({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[uo]}),n})();let WL=(()=>{class n{constructor(t){this.differs=t,this.keyValues=[],this.compareFn=qL}transform(t,i=qL){if(!t||!(t instanceof Map)&&"object"!=typeof t)return null;this.differ||(this.differ=this.differs.find(t).create());const s=this.differ.diff(t),o=i!==this.compareFn;return s&&(this.keyValues=[],s.forEachItem(l=>{this.keyValues.push(function vz(n,e){return{key:n,value:e}}(l.key,l.currentValue))})),(s||o)&&(this.keyValues.sort(i),this.compareFn=i),this.keyValues}}return n.\u0275fac=function(t){return new(t||n)(He(M0,16))},n.\u0275pipe=wo({name:"keyvalue",type:n,pure:!1}),n})();function qL(n,e){const t=n.key,i=e.key;if(t===i)return 0;if(void 0===t)return 1;if(void 0===i)return-1;if(null===t)return 1;if(null===i)return-1;if("string"==typeof t&&"string"==typeof i)return t<i?-1:1;if("number"==typeof t&&"number"==typeof i)return t-i;if("boolean"==typeof t&&"boolean"==typeof i)return t<i?-1:1;const s=String(t),o=String(i);return s==o?0:s<o?-1:1}let jL=(()=>{class n{constructor(t){this._locale=t}transform(t,i,s){if(!function wA(n){return!(null==n||""===n||n!=n)}(t))return null;s=s||this._locale;try{return function XU(n,e,t){return function gA(n,e,t,i,s,o,l=!1){let u="",f=!1;if(isFinite(n)){let m=function KU(n){let i,s,o,l,u,e=Math.abs(n)+"",t=0;for((s=e.indexOf("."))>-1&&(e=e.replace(".","")),(o=e.search(/e/i))>0?(s<0&&(s=o),s+=+e.slice(o+1),e=e.substring(0,o)):s<0&&(s=e.length),o=0;"0"===e.charAt(o);o++);if(o===(u=e.length))i=[0],s=1;else{for(u--;"0"===e.charAt(u);)u--;for(s-=o,i=[],l=0;o<=u;o++,l++)i[l]=Number(e.charAt(o))}return s>22&&(i=i.splice(0,21),t=s-1,s=1),{digits:i,exponent:t,integerLen:s}}(n);l&&(m=function YU(n){if(0===n.digits[0])return n;const e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(0===e?n.digits.push(0,0):1===e&&n.digits.push(0),n.integerLen+=2),n}(m));let y=e.minInt,v=e.minFrac,x=e.maxFrac;if(o){const F=o.match(zU);if(null===F)throw new Error(`${o} is not a valid digit info`);const V=F[1],k=F[3],G=F[5];null!=V&&(y=_A(V)),null!=k&&(v=_A(k)),null!=G?x=_A(G):null!=k&&v>x&&(x=v)}!function $U(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let i=n.digits,s=i.length-n.integerLen;const o=Math.min(Math.max(e,s),t);let l=o+n.integerLen,u=i[l];if(l>0){i.splice(Math.max(n.integerLen,l));for(let v=l;v<i.length;v++)i[v]=0}else{s=Math.max(0,s),n.integerLen=1,i.length=Math.max(1,l=o+1),i[0]=0;for(let v=1;v<l;v++)i[v]=0}if(u>=5)if(l-1<0){for(let v=0;v>l;v--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[l-1]++;for(;s<Math.max(0,o);s++)i.push(0);let f=0!==o;const m=e+n.integerLen,y=i.reduceRight(function(v,x,b,E){return E[b]=(x+=v)<10?x:x-10,f&&(0===E[b]&&b>=m?E.pop():f=!1),x>=10?1:0},0);y&&(i.unshift(y),n.integerLen++)}(m,v,x);let b=m.digits,E=m.integerLen;const C=m.exponent;let A=[];for(f=b.every(F=>!F);E<y;E++)b.unshift(0);for(;E<0;E++)b.unshift(0);E>0?A=b.splice(E,b.length):(A=b,b=[0]);const N=[];for(b.length>=e.lgSize&&N.unshift(b.splice(-e.lgSize,b.length).join(""));b.length>e.gSize;)N.unshift(b.splice(-e.gSize,b.length).join(""));b.length&&N.unshift(b.join("")),u=N.join(Tl(t,i)),A.length&&(u+=Tl(t,s)+A.join("")),C&&(u+=Tl(t,bn.Exponential)+"+"+C)}else u=Tl(t,bn.Infinity);return u=n<0&&!f?e.negPre+u+e.negSuf:e.posPre+u+e.posSuf,u}(n,function yA(n,e="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(";"),s=i[0],o=i[1],l=-1!==s.indexOf(".")?s.split("."):[s.substring(0,s.lastIndexOf("0")+1),s.substring(s.lastIndexOf("0")+1)],u=l[0],f=l[1]||"";t.posPre=u.substr(0,u.indexOf("#"));for(let y=0;y<f.length;y++){const v=f.charAt(y);"0"===v?t.minFrac=t.maxFrac=y+1:"#"===v?t.maxFrac=y+1:t.posSuf+=v}const m=u.split(",");if(t.gSize=m[1]?m[1].length:0,t.lgSize=m[2]||m[1]?(m[2]||m[1]).length:0,o){const y=s.length-t.posPre.length-t.posSuf.length,v=o.indexOf("#");t.negPre=o.substr(0,v).replace(/'/g,""),t.negSuf=o.substr(v+y).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}(function hA(n,e){return St(n)[Ne.NumberFormats][e]}(e,Ia.Decimal),Tl(e,bn.MinusSign)),e,bn.Group,bn.Decimal,t)}(function MA(n){if("string"==typeof n&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if("number"!=typeof n)throw new Error(`${n} is not a number`);return n}(t),s,i)}catch(o){throw function lc(n,e){return new wi(2100,"")}()}}}return n.\u0275fac=function(t){return new(t||n)(He(Vd,16))},n.\u0275pipe=wo({name:"number",type:n,pure:!0}),n})();let EA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({}),n})();const XL="browser";function YL(n){return n===XL}class $L{}class SA extends class Tz extends class dU{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function hU(n){LM||(LM=n)}(new SA)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function Az(){return A0=A0||document.querySelector("base"),A0?A0.getAttribute("href"):null}();return null==t?null:function Dz(n){GM=GM||document.createElement("a"),GM.setAttribute("href",n);const e=GM.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){A0=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return kL(document.cookie,e)}}let GM,A0=null;const ZL=new ii("TRANSITION_ID"),Pz=[{provide:oL,useFactory:function Rz(n,e,t){return()=>{t.get($1).donePromise.then(()=>{const i=Yp(),s=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let o=0;o<s.length;o++)i.remove(s[o])})}},deps:[ZL,Pa,zr],multi:!0}];class CA{static init(){!function kV(n){nA=n}(new CA)}addToWindow(e){Bi.getAngularTestability=(i,s=!0)=>{const o=e.findTestabilityInTree(i,s);if(null==o)throw new Error("Could not find testability for element.");return o},Bi.getAllAngularTestabilities=()=>e.getAllTestabilities(),Bi.getAllAngularRootElements=()=>e.getAllRootElements(),Bi.frameworkStabilizers||(Bi.frameworkStabilizers=[]),Bi.frameworkStabilizers.push(i=>{const s=Bi.getAllAngularTestabilities();let o=s.length,l=!1;const u=function(f){l=l||f,o--,0==o&&i(l)};s.forEach(function(f){f.whenStable(u)})})}findTestabilityInTree(e,t,i){if(null==t)return null;const s=e.getTestability(t);return null!=s?s:i?Yp().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let Iz=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();const D0=new ii("EventManagerPlugins");let WM=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(s=>s.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,i,s){return this._findPluginFor(i).addEventListener(t,i,s)}addGlobalEventListener(t,i,s){return this._findPluginFor(i).addGlobalEventListener(t,i,s)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const s=this._plugins;for(let o=0;o<s.length;o++){const l=s[o];if(l.supports(t))return this._eventNameToPlugin.set(t,l),l}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(Bn(D0),Bn(Vo))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();class JL{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const s=Yp().getGlobalEventTarget(this._doc,e);if(!s)throw new Error(`Unsupported event target ${s} for event ${t}`);return this.addEventListener(s,t,i)}}let QL=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const i=new Set;t.forEach(s=>{this._stylesSet.has(s)||(this._stylesSet.add(s),i.add(s))}),this.onStylesAdded(i)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})(),R0=(()=>{class n extends QL{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,i,s){t.forEach(o=>{const l=this._doc.createElement("style");l.textContent=o,s.push(i.appendChild(l))})}addHost(t){const i=[];this._addStylesToHost(this._stylesSet,t,i),this._hostNodes.set(t,i)}removeHost(t){const i=this._hostNodes.get(t);i&&i.forEach(e2),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((i,s)=>{this._addStylesToHost(t,s,i)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(e2))}}return n.\u0275fac=function(t){return new(t||n)(Bn(Pa))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();function e2(n){Yp().remove(n)}const TA={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},AA=/%COMP%/g;function qM(n,e,t){for(let i=0;i<e.length;i++){let s=e[i];Array.isArray(s)?qM(n,s,t):(s=s.replace(AA,n),t.push(s))}return t}function i2(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let DA=(()=>{class n{constructor(t,i,s){this.eventManager=t,this.sharedStylesHost=i,this.appId=s,this.rendererByCompId=new Map,this.defaultRenderer=new RA(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;switch(i.encapsulation){case Yo.Emulated:{let s=this.rendererByCompId.get(i.id);return s||(s=new kz(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,s)),s.applyToHost(t),s}case 1:case Yo.ShadowDom:return new Vz(this.eventManager,this.sharedStylesHost,t,i);default:if(!this.rendererByCompId.has(i.id)){const s=qM(i.id,i.styles,[]);this.sharedStylesHost.addStyles(s),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(Bn(WM),Bn(R0),Bn(b0))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();class RA{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(TA[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,i){e&&e.insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,s){if(s){t=s+":"+t;const o=TA[s];o?e.setAttributeNS(o,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const s=TA[i];s?e.removeAttributeNS(s,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,s){s&(ta.DashCase|ta.Important)?e.style.setProperty(t,i,s&ta.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&ta.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,i2(i)):this.eventManager.addEventListener(e,t,i2(i))}}class kz extends RA{constructor(e,t,i,s){super(e),this.component=i;const o=qM(s+"-"+i.id,i.styles,[]);t.addStyles(o),this.contentAttr=function Nz(n){return"_ngcontent-%COMP%".replace(AA,n)}(s+"-"+i.id),this.hostAttr=function Oz(n){return"_nghost-%COMP%".replace(AA,n)}(s+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}class Vz extends RA{constructor(e,t,i,s){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=qM(s.id,s.styles,[]);for(let l=0;l<o.length;l++){const u=document.createElement("style");u.textContent=o[l],this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Uz=(()=>{class n extends JL{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,s){return t.addEventListener(i,s,!1),()=>this.removeEventListener(t,i,s)}removeEventListener(t,i,s){return t.removeEventListener(i,s)}}return n.\u0275fac=function(t){return new(t||n)(Bn(Pa))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();const s2=["alt","control","meta","shift"],Hz={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},o2={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Gz={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Wz=(()=>{class n extends JL{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,s){const o=n.parseEventName(i),l=n.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Yp().onAndCancel(t,o.domEventName,l))}static parseEventName(t){const i=t.toLowerCase().split("."),s=i.shift();if(0===i.length||"keydown"!==s&&"keyup"!==s)return null;const o=n._normalizeKey(i.pop());let l="";if(s2.forEach(f=>{const m=i.indexOf(f);m>-1&&(i.splice(m,1),l+=f+".")}),l+=o,0!=i.length||0===o.length)return null;const u={};return u.domEventName=s,u.fullKey=l,u}static getEventFullKey(t){let i="",s=function qz(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&o2.hasOwnProperty(e)&&(e=o2[e]))}return Hz[e]||e}(t);return s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),s2.forEach(o=>{o!=s&&Gz[o](t)&&(i+=o+".")}),i+=s,i}static eventCallback(t,i,s){return o=>{n.getEventFullKey(o)===t&&s.runGuarded(()=>i(o))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(Bn(Pa))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();const Kz=fL(lU,"browser",[{provide:w0,useValue:XL},{provide:lL,useValue:function jz(){SA.makeCurrent(),CA.init()},multi:!0},{provide:Pa,useFactory:function Yz(){return function Ff(n){Kh=n}(document),document},deps:[]}]),$z=[{provide:Pp,useValue:"root"},{provide:op,useFactory:function Xz(){return new op},deps:[]},{provide:D0,useClass:Uz,multi:!0,deps:[Pa,Vo,w0]},{provide:D0,useClass:Wz,multi:!0,deps:[Pa]},{provide:DA,useClass:DA,deps:[WM,R0,b0]},{provide:EI,useExisting:DA},{provide:QL,useExisting:R0},{provide:R0,useClass:R0,deps:[Pa]},{provide:tA,useClass:tA,deps:[Vo]},{provide:WM,useClass:WM,deps:[D0,Vo]},{provide:$L,useClass:Iz,deps:[]}];let Zz=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:b0,useValue:t.appId},{provide:ZL,useExisting:b0},Pz]}}}return n.\u0275fac=function(t){return new(t||n)(Bn(n,12))},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({providers:$z,imports:[EA,cU]}),n})();"undefined"!=typeof window&&window;class lH extends Dn{constructor(e,t){super()}schedule(e,t=0){return this}}const jM={setInterval(n,e,...t){const{delegate:i}=jM;return(null==i?void 0:i.setInterval)?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=jM;return((null==e?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0},c2={now:()=>(c2.delegate||Date).now(),delegate:void 0};class P0{constructor(e,t=P0.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}P0.now=c2.now;const hH=new class uH extends P0{constructor(e,t=P0.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}(class cH extends lH{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return jM.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;jM.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let s,i=!1;try{this.work(e)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Qt(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}});function Qg(n=0,e,t=hH){let i=-1;return null!=e&&(br(e)?t=e:i=e),new Ar(s=>{let o=function dH(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;o<0&&(o=0);let l=0;return t.schedule(function(){s.closed||(s.next(l++),0<=i?this.schedule(void 0,i):s.complete())},o)})}function IA(n){return Di((e,t)=>{let o,i=null,s=!1;i=e.subscribe(wn(t,void 0,void 0,l=>{o=de(n(l,IA(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):s=!0})),s&&(i.unsubscribe(),i=null,o.subscribe(t))})}function u2(n,e){const t=gt(n)?n:()=>n,i=s=>s.error(t());return new Ar(e?s=>e.schedule(i,0,s):i)}const I0_port=window.port||5e3;let pH=(()=>{class n{constructor(){this.baseUrl=`http://127.0.0.1:${I0_port}/`}handleError(t){return 0===t.status?console.error("An error occurred:",t.error):(console.error(`Backend returned code ${t.status}, body was: `,t.error),console.error(t)),u2(()=>new Error("Something bad happened; please try again later."))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function h2(...n){return Bh(n,Ol(n))}function $a(n,e){return Di((t,i)=>{let s=0;t.subscribe(wn(i,o=>n.call(e,o,s++)&&i.next(o)))})}class d2{}class f2{}class fh{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const s=t.slice(0,i),o=s.toLowerCase(),l=t.slice(i+1).trim();this.maybeSetNormalizedName(s,o),this.headers.has(o)?this.headers.get(o).push(l):this.headers.set(o,[l])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let i=e[t];const s=t.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(s,i),this.maybeSetNormalizedName(t,s))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof fh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new fh;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof fh?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,t);const s=("a"===e.op?this.headers.get(t):void 0)||[];s.push(...i),this.headers.set(t,s);break;case"d":const o=e.value;if(o){let l=this.headers.get(t);if(!l)return;l=l.filter(u=>-1===o.indexOf(u)),0===l.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,l)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class gH{encodeKey(e){return p2(e)}encodeValue(e){return p2(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const _H=/%(\d[a-f0-9])/gi,vH={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function p2(n){return encodeURIComponent(n).replace(_H,(e,t)=>{var i;return null!==(i=vH[t])&&void 0!==i?i:e})}function m2(n){return`${n}`}class zd{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new gH,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function yH(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(s=>{const o=s.indexOf("="),[l,u]=-1==o?[e.decodeKey(s),""]:[e.decodeKey(s.slice(0,o)),e.decodeValue(s.slice(o+1))],f=t.get(l)||[];f.push(u),t.set(l,f)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const i=e.fromObject[t];this.map.set(t,Array.isArray(i)?i:[i])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(i=>{const s=e[i];Array.isArray(s)?s.forEach(o=>{t.push({param:i,value:o,op:"a"})}):t.push({param:i,value:s,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new zd({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(m2(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const s=i.indexOf(m2(e.value));-1!==s&&i.splice(s,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class xH{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function g2(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function y2(n){return"undefined"!=typeof Blob&&n instanceof Blob}function _2(n){return"undefined"!=typeof FormData&&n instanceof FormData}class L0{constructor(e,t,i,s){let o;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function bH(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==i?i:null,o=s):o=i,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params)),this.headers||(this.headers=new fh),this.context||(this.context=new xH),this.params){const l=this.params.toString();if(0===l.length)this.urlWithParams=t;else{const u=t.indexOf("?");this.urlWithParams=t+(-1===u?"?":u<t.length-1?"&":"")+l}}else this.params=new zd,this.urlWithParams=t}serializeBody(){return null===this.body?null:g2(this.body)||y2(this.body)||_2(this.body)||function wH(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof zd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||_2(this.body)?null:y2(this.body)?this.body.type||null:g2(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof zd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const i=e.method||this.method,s=e.url||this.url,o=e.responseType||this.responseType,l=void 0!==e.body?e.body:this.body,u=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,f=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let m=e.headers||this.headers,y=e.params||this.params;const v=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(m=Object.keys(e.setHeaders).reduce((x,b)=>x.set(b,e.setHeaders[b]),m)),e.setParams&&(y=Object.keys(e.setParams).reduce((x,b)=>x.set(b,e.setParams[b]),y)),new L0(i,s,l,{params:y,headers:m,context:v,reportProgress:f,responseType:o,withCredentials:u})}}var Os=(()=>((Os=Os||{})[Os.Sent=0]="Sent",Os[Os.UploadProgress=1]="UploadProgress",Os[Os.ResponseHeader=2]="ResponseHeader",Os[Os.DownloadProgress=3]="DownloadProgress",Os[Os.Response=4]="Response",Os[Os.User=5]="User",Os))();class LA{constructor(e,t=200,i="OK"){this.headers=e.headers||new fh,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class FA extends LA{constructor(e={}){super(e),this.type=Os.ResponseHeader}clone(e={}){return new FA({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class XM extends LA{constructor(e={}){super(e),this.type=Os.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new XM({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class v2 extends LA{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function NA(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let OA=(()=>{class n{constructor(t){this.handler=t}request(t,i,s={}){let o;if(t instanceof L0)o=t;else{let f,m;f=s.headers instanceof fh?s.headers:new fh(s.headers),s.params&&(m=s.params instanceof zd?s.params:new zd({fromObject:s.params})),o=new L0(t,i,void 0!==s.body?s.body:null,{headers:f,context:s.context,params:m,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const l=h2(o).pipe(function mH(n,e){return gt(e)?Es(n,e,1):Es(n,1)}(f=>this.handler.handle(f)));if(t instanceof L0||"events"===s.observe)return l;const u=l.pipe($a(f=>f instanceof XM));switch(s.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return u.pipe(yr(f=>{if(null!==f.body&&!(f.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return f.body}));case"blob":return u.pipe(yr(f=>{if(null!==f.body&&!(f.body instanceof Blob))throw new Error("Response is not a Blob.");return f.body}));case"text":return u.pipe(yr(f=>{if(null!==f.body&&"string"!=typeof f.body)throw new Error("Response is not a string.");return f.body}));default:return u.pipe(yr(f=>f.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new zd).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,s={}){return this.request("PATCH",t,NA(s,i))}post(t,i,s={}){return this.request("POST",t,NA(s,i))}put(t,i,s={}){return this.request("PUT",t,NA(s,i))}}return n.\u0275fac=function(t){return new(t||n)(Bn(d2))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();class x2{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const b2=new ii("HTTP_INTERCEPTORS");let MH=(()=>{class n{intercept(t,i){return i.handle(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();const EH=/^\)\]\}',?\n/;let w2=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Ar(i=>{const s=this.xhrFactory.build();if(s.open(t.method,t.urlWithParams),t.withCredentials&&(s.withCredentials=!0),t.headers.forEach((b,E)=>s.setRequestHeader(b,E.join(","))),t.headers.has("Accept")||s.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const b=t.detectContentTypeHeader();null!==b&&s.setRequestHeader("Content-Type",b)}if(t.responseType){const b=t.responseType.toLowerCase();s.responseType="json"!==b?b:"text"}const o=t.serializeBody();let l=null;const u=()=>{if(null!==l)return l;const b=s.statusText||"OK",E=new fh(s.getAllResponseHeaders()),C=function SH(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(s)||t.url;return l=new FA({headers:E,status:s.status,statusText:b,url:C}),l},f=()=>{let{headers:b,status:E,statusText:C,url:A}=u(),N=null;204!==E&&(N=void 0===s.response?s.responseText:s.response),0===E&&(E=N?200:0);let F=E>=200&&E<300;if("json"===t.responseType&&"string"==typeof N){const V=N;N=N.replace(EH,"");try{N=""!==N?JSON.parse(N):null}catch(k){N=V,F&&(F=!1,N={error:k,text:N})}}F?(i.next(new XM({body:N,headers:b,status:E,statusText:C,url:A||void 0})),i.complete()):i.error(new v2({error:N,headers:b,status:E,statusText:C,url:A||void 0}))},m=b=>{const{url:E}=u(),C=new v2({error:b,status:s.status||0,statusText:s.statusText||"Unknown Error",url:E||void 0});i.error(C)};let y=!1;const v=b=>{y||(i.next(u()),y=!0);let E={type:Os.DownloadProgress,loaded:b.loaded};b.lengthComputable&&(E.total=b.total),"text"===t.responseType&&!!s.responseText&&(E.partialText=s.responseText),i.next(E)},x=b=>{let E={type:Os.UploadProgress,loaded:b.loaded};b.lengthComputable&&(E.total=b.total),i.next(E)};return s.addEventListener("load",f),s.addEventListener("error",m),s.addEventListener("timeout",m),s.addEventListener("abort",m),t.reportProgress&&(s.addEventListener("progress",v),null!==o&&s.upload&&s.upload.addEventListener("progress",x)),s.send(o),i.next({type:Os.Sent}),()=>{s.removeEventListener("error",m),s.removeEventListener("abort",m),s.removeEventListener("load",f),s.removeEventListener("timeout",m),t.reportProgress&&(s.removeEventListener("progress",v),null!==o&&s.upload&&s.upload.removeEventListener("progress",x)),s.readyState!==s.DONE&&s.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(Bn($L))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();const BA=new ii("XSRF_COOKIE_NAME"),kA=new ii("XSRF_HEADER_NAME");class M2{}let CH=(()=>{class n{constructor(t,i,s){this.doc=t,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=kL(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(Bn(Pa),Bn(w0),Bn(BA))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})(),VA=(()=>{class n{constructor(t,i){this.tokenService=t,this.headerName=i}intercept(t,i){const s=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||s.startsWith("http://")||s.startsWith("https://"))return i.handle(t);const o=this.tokenService.getToken();return null!==o&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,o)})),i.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(Bn(M2),Bn(kA))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})(),TH=(()=>{class n{constructor(t,i){this.backend=t,this.injector=i,this.chain=null}handle(t){if(null===this.chain){const i=this.injector.get(b2,[]);this.chain=i.reduceRight((s,o)=>new x2(s,o),this.backend)}return this.chain.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(Bn(f2),Bn(zr))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})(),AH=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:VA,useClass:MH}]}}static withOptions(t={}){return{ngModule:n,providers:[t.cookieName?{provide:BA,useValue:t.cookieName}:[],t.headerName?{provide:kA,useValue:t.headerName}:[]]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({providers:[VA,{provide:b2,useExisting:VA,multi:!0},{provide:M2,useClass:CH},{provide:BA,useValue:"XSRF-TOKEN"},{provide:kA,useValue:"X-XSRF-TOKEN"}]}),n})(),DH=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({providers:[OA,{provide:d2,useClass:TH},w2,{provide:f2,useExisting:w2}],imports:[[AH.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})(),YM=(()=>{class n extends pH{constructor(t){super(),this.http=t,this.viewerData=new Map,this.componentTree=[],this.viewerDataSubject=new Xt}addViewerData(t){this.viewerData.set(t.sceneId,t),this.viewerDataSubject.next(this.viewerData)}getViewerData(){return this.viewerDataSubject}addSceneElement(t,i,s){var o;let l=null===(o=this.viewerData.get(t))||void 0===o?void 0:o.elements;!l||i<l.length&&void 0!==l[i]&&(l[i].element=s)}getComponentTree(t){let i=this.http.get(this.baseUrl+"component_tree/"+t).pipe(function fH(n=1/0){let e;e=n&&"object"==typeof n?n:{count:n};const{count:t=1/0,delay:i,resetOnSuccess:s=!1}=e;return t<=0?$t:Di((o,l)=>{let f,u=0;const m=()=>{let y=!1;f=o.subscribe(wn(l,v=>{s&&(u=0),l.next(v)},void 0,v=>{if(u++<t){const x=()=>{f?(f.unsubscribe(),f=null,m()):y=!0};if(null!=i){const b="number"==typeof i?Qg(i):de(i(v,u)),E=wn(l,()=>{E.unsubscribe(),x()},()=>{l.complete()});b.subscribe(E)}else x()}else l.error(v)})),y&&(f.unsubscribe(),f=null,m())};m()})}(3),IA(this.handleError));return i.subscribe(s=>{this.componentTree=s}),i}}return n.\u0275fac=function(t){return new(t||n)(Bn(OA))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function E2(n,e,t,i,s,o,l){try{var u=n[o](l),f=u.value}catch(m){return void t(m)}u.done?e(f):Promise.resolve(f).then(i,s)}const La=1001,no=1003,Bs=1006,Jp=1009,O0=1012,Gd=1015,ry=1016,sy=1020,Rl=1023,Qp=1026,oy=1027,ay=2400,ly=2401,mh=3e3,qr=3001,gh="srgb",em="srgb-linear",B0=35044,k0=35048;class Wd{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const s=this._listeners[e];if(void 0!==s){const o=s.indexOf(t);-1!==o&&s.splice(o,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const s=i.slice(0);for(let o=0,l=s.length;o<l;o++)s[o].call(this,e);e.target=null}}}const Ro=[];for(let n=0;n<256;n++)Ro[n]=(n<16?"0":"")+n.toString(16);let sF=1234567;const tm=Math.PI/180,V0=180/Math.PI;function Za(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Ro[255&n]+Ro[n>>8&255]+Ro[n>>16&255]+Ro[n>>24&255]+"-"+Ro[255&e]+Ro[e>>8&255]+"-"+Ro[e>>16&15|64]+Ro[e>>24&255]+"-"+Ro[63&t|128]+Ro[t>>8&255]+"-"+Ro[t>>16&255]+Ro[t>>24&255]+Ro[255&i]+Ro[i>>8&255]+Ro[i>>16&255]+Ro[i>>24&255]).toLowerCase()}function ws(n,e,t){return Math.max(e,Math.min(t,n))}function QA(n,e){return(n%e+e)%e}function U0(n,e,t){return(1-t)*n+t*e}function eD(n){return 0==(n&n-1)&&0!==n}function rE(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}var Zr=Object.freeze({__proto__:null,DEG2RAD:tm,RAD2DEG:V0,generateUUID:Za,clamp:ws,euclideanModulo:QA,mapLinear:function DG(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)},inverseLerp:function RG(n,e,t){return n!==e?(t-n)/(e-n):0},lerp:U0,damp:function PG(n,e,t,i){return U0(n,e,1-Math.exp(-t*i))},pingpong:function IG(n,e=1){return e-Math.abs(QA(n,2*e)-e)},smoothstep:function LG(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)},smootherstep:function FG(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*n*(n*(6*n-15)+10)},randInt:function NG(n,e){return n+Math.floor(Math.random()*(e-n+1))},randFloat:function OG(n,e){return n+Math.random()*(e-n)},randFloatSpread:function BG(n){return n*(.5-Math.random())},seededRandom:function kG(n){void 0!==n&&(sF=n);let e=sF+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function VG(n){return n*tm},radToDeg:function UG(n){return n*V0},isPowerOfTwo:eD,ceilPowerOfTwo:function oF(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},floorPowerOfTwo:rE,setQuaternionFromProperEuler:function zG(n,e,t,i,s){const o=Math.cos,l=Math.sin,u=o(t/2),f=l(t/2),m=o((e+i)/2),y=l((e+i)/2),v=o((e-i)/2),x=l((e-i)/2),b=o((i-e)/2),E=l((i-e)/2);switch(s){case"XYX":n.set(u*y,f*v,f*x,u*m);break;case"YZY":n.set(f*x,u*y,f*v,u*m);break;case"ZXZ":n.set(f*v,f*x,u*y,u*m);break;case"XZX":n.set(u*y,f*E,f*b,u*m);break;case"YXY":n.set(f*b,u*y,f*E,u*m);break;case"ZYZ":n.set(f*E,f*b,u*y,u*m);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:function GG(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}},denormalize:function HG(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}});class at{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),o=this.x-e.x,l=this.y-e.y;return this.x=o*i-l*s+e.x,this.y=o*s+l*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}at.prototype.isVector2=!0;class yo{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,s,o,l,u,f,m){const y=this.elements;return y[0]=e,y[1]=s,y[2]=u,y[3]=t,y[4]=o,y[5]=f,y[6]=i,y[7]=l,y[8]=m,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,o=this.elements,l=i[0],u=i[3],f=i[6],m=i[1],y=i[4],v=i[7],x=i[2],b=i[5],E=i[8],C=s[0],A=s[3],N=s[6],F=s[1],V=s[4],k=s[7],G=s[2],ee=s[5],oe=s[8];return o[0]=l*C+u*F+f*G,o[3]=l*A+u*V+f*ee,o[6]=l*N+u*k+f*oe,o[1]=m*C+y*F+v*G,o[4]=m*A+y*V+v*ee,o[7]=m*N+y*k+v*oe,o[2]=x*C+b*F+E*G,o[5]=x*A+b*V+E*ee,o[8]=x*N+b*k+E*oe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],f=e[6],m=e[7],y=e[8];return t*l*y-t*u*m-i*o*y+i*u*f+s*o*m-s*l*f}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],f=e[6],m=e[7],y=e[8],v=y*l-u*m,x=u*f-y*o,b=m*o-l*f,E=t*v+i*x+s*b;if(0===E)return this.set(0,0,0,0,0,0,0,0,0);const C=1/E;return e[0]=v*C,e[1]=(s*m-y*i)*C,e[2]=(u*i-s*l)*C,e[3]=x*C,e[4]=(y*t-s*f)*C,e[5]=(s*o-u*t)*C,e[6]=b*C,e[7]=(i*f-m*t)*C,e[8]=(l*t-i*o)*C,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,o,l,u){const f=Math.cos(o),m=Math.sin(o);return this.set(i*f,i*m,-i*(f*l+m*u)+l+e,-s*m,s*f,-s*(-m*l+f*u)+u+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.elements,o=s[0],l=s[3],u=s[6],f=s[1],m=s[4],y=s[7];return s[0]=t*o+i*f,s[3]=t*l+i*m,s[6]=t*u+i*y,s[1]=-i*o+t*f,s[4]=-i*l+t*m,s[7]=-i*u+t*y,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function aF(n){for(let e=n.length-1;e>=0;--e)if(n[e]>65535)return!0;return!1}function z0(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function nm(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function sE(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}yo.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const tD={[gh]:{[em]:nm},[em]:{[gh]:sE}},cc={legacyMode:!0,get workingColorSpace(){return em},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(tD[e]&&void 0!==tD[e][t]){const i=tD[e][t];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},lF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},io={r:0,g:0,b:0},uc={h:0,s:0,l:0},oE={h:0,s:0,l:0};function nD(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}function aE(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}let hy,Ut=(()=>{class n{constructor(t,i,s){return void 0===i&&void 0===s?this.set(t):this.setRGB(t,i,s)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=gh){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,cc.toWorkingColorSpace(this,i),this}setRGB(t,i,s,o=em){return this.r=t,this.g=i,this.b=s,cc.toWorkingColorSpace(this,o),this}setHSL(t,i,s,o=em){if(t=QA(t,1),i=ws(i,0,1),s=ws(s,0,1),0===i)this.r=this.g=this.b=s;else{const l=s<=.5?s*(1+i):s+i-s*i,u=2*s-l;this.r=nD(u,l,t+1/3),this.g=nD(u,l,t),this.b=nD(u,l,t-1/3)}return cc.toWorkingColorSpace(this,o),this}setStyle(t,i=gh){function s(l){void 0!==l&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let o;if(o=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let l;const f=o[2];switch(o[1]){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,cc.toWorkingColorSpace(this,i),s(l[4]),this;if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,cc.toWorkingColorSpace(this,i),s(l[4]),this;break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f)){const m=parseFloat(l[1])/360,y=parseInt(l[2],10)/100,v=parseInt(l[3],10)/100;return s(l[4]),this.setHSL(m,y,v,i)}}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){const l=o[1],u=l.length;if(3===u)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,cc.toWorkingColorSpace(this,i),this;if(6===u)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,cc.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t,i=gh){const s=lF[t.toLowerCase()];return void 0!==s?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=nm(t.r),this.g=nm(t.g),this.b=nm(t.b),this}copyLinearToSRGB(t){return this.r=sE(t.r),this.g=sE(t.g),this.b=sE(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=gh){return cc.fromWorkingColorSpace(aE(this,io),t),ws(255*io.r,0,255)<<16^ws(255*io.g,0,255)<<8^ws(255*io.b,0,255)<<0}getHexString(t=gh){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=em){cc.fromWorkingColorSpace(aE(this,io),i);const s=io.r,o=io.g,l=io.b,u=Math.max(s,o,l),f=Math.min(s,o,l);let m,y;const v=(f+u)/2;if(f===u)m=0,y=0;else{const x=u-f;switch(y=v<=.5?x/(u+f):x/(2-u-f),u){case s:m=(o-l)/x+(o<l?6:0);break;case o:m=(l-s)/x+2;break;case l:m=(s-o)/x+4}m/=6}return t.h=m,t.s=y,t.l=v,t}getRGB(t,i=em){return cc.fromWorkingColorSpace(aE(this,io),i),t.r=io.r,t.g=io.g,t.b=io.b,t}getStyle(t=gh){return cc.fromWorkingColorSpace(aE(this,io),t),t!==gh?`color(${t} ${io.r} ${io.g} ${io.b})`:`rgb(${255*io.r|0},${255*io.g|0},${255*io.b|0})`}offsetHSL(t,i,s){return this.getHSL(uc),uc.h+=t,uc.s+=i,uc.l+=s,this.setHSL(uc.h,uc.s,uc.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,s){return this.r=t.r+(i.r-t.r)*s,this.g=t.g+(i.g-t.g)*s,this.b=t.b+(i.b-t.b)*s,this}lerpHSL(t,i){this.getHSL(uc),t.getHSL(oE);const s=U0(uc.h,oE.h,i),o=U0(uc.s,oE.s,i),l=U0(uc.l,oE.l,i);return this.setHSL(s,o,l),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return n.NAMES=lF,n})();Ut.prototype.isColor=!0,Ut.prototype.r=1,Ut.prototype.g=1,Ut.prototype.b=1;class im{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===hy&&(hy=z0("canvas")),hy.width=e.width,hy.height=e.height;const i=hy.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=hy}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=z0("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let l=0;l<o.length;l++)o[l]=255*nm(o[l]/255);return i.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*nm(t[i]/255)):nm(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class dy{constructor(e=null){this.uuid=Za(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(null!==s){let o;if(Array.isArray(s)){o=[];for(let l=0,u=s.length;l<u;l++)o.push(iD(s[l].isDataTexture?s[l].image:s[l]))}else o=iD(s);i.url=o}return t||(e.images[this.uuid]=i),i}}function iD(n){return"undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&n instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap?im.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}dy.prototype.isSource=!0;let qG=0,Fa=(()=>{class n extends Wd{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,s=La,o=La,l=Bs,u=1008,f=Rl,m=Jp,y=1,v=mh){super(),Object.defineProperty(this,"id",{value:qG++}),this.uuid=Za(),this.name="",this.source=new dy(t),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=o,this.magFilter=l,this.minFilter=u,this.anisotropy=y,this.format=f,this.internalFormat=null,this.type=m,this.offset=new at(0,0),this.repeat=new at(1,1),this.center=new at(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new yo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=v,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),i||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case La:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case La:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n})();Fa.prototype.isTexture=!0;class Wi{constructor(e=0,t=0,i=0,s=1){this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,o=this.w,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*s+l[12]*o,this.y=l[1]*t+l[5]*i+l[9]*s+l[13]*o,this.z=l[2]*t+l[6]*i+l[10]*s+l[14]*o,this.w=l[3]*t+l[7]*i+l[11]*s+l[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,o;const f=e.elements,m=f[0],y=f[4],v=f[8],x=f[1],b=f[5],E=f[9],C=f[2],A=f[6],N=f[10];if(Math.abs(y-x)<.01&&Math.abs(v-C)<.01&&Math.abs(E-A)<.01){if(Math.abs(y+x)<.1&&Math.abs(v+C)<.1&&Math.abs(E+A)<.1&&Math.abs(m+b+N-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const V=(m+1)/2,k=(b+1)/2,G=(N+1)/2,ee=(y+x)/4,oe=(v+C)/4,ue=(E+A)/4;return V>k&&V>G?V<.01?(i=0,s=.707106781,o=.707106781):(i=Math.sqrt(V),s=ee/i,o=oe/i):k>G?k<.01?(i=.707106781,s=0,o=.707106781):(s=Math.sqrt(k),i=ee/s,o=ue/s):G<.01?(i=.707106781,s=.707106781,o=0):(o=Math.sqrt(G),i=oe/o,s=ue/o),this.set(i,s,o,t),this}let F=Math.sqrt((A-E)*(A-E)+(v-C)*(v-C)+(x-y)*(x-y));return Math.abs(F)<.001&&(F=1),this.x=(A-E)/F,this.y=(v-C)/F,this.z=(x-y)/F,this.w=Math.acos((m+b+N-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Wi.prototype.isVector4=!0;class Ja extends Wd{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Wi(0,0,e,t),this.scissorTest=!1,this.viewport=new Wi(0,0,e,t),this.texture=new Fa({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Bs,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ja.prototype.isWebGLRenderTarget=!0;class lE extends Fa{constructor(e=null,t=1,i=1,s=1){super(null),this.image={data:e,width:t,height:i,depth:s},this.magFilter=no,this.minFilter=no,this.wrapR=La,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}lE.prototype.isDataArrayTexture=!0,class jG extends Ja{constructor(e,t,i){super(e,t),this.depth=i,this.texture=new lE(null,e,t,i),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class rD extends Fa{constructor(e=null,t=1,i=1,s=1){super(null),this.image={data:e,width:t,height:i,depth:s},this.magFilter=no,this.minFilter=no,this.wrapR=La,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}rD.prototype.isData3DTexture=!0,class XG extends Ja{constructor(e,t,i){super(e,t),this.depth=i,this.texture=new rD(null,e,t,i),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class YG extends Ja{constructor(e,t,i,s={}){super(e,t,s);const o=this.texture;this.texture=[];for(let l=0;l<i;l++)this.texture[l]=o.clone(),this.texture[l].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,o=this.texture.length;s<o;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}.prototype.isWebGLMultipleRenderTargets=!0;class ks{constructor(e=0,t=0,i=0,s=1){this._x=e,this._y=t,this._z=i,this._w=s}static slerp(e,t,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,s)}static slerpFlat(e,t,i,s,o,l,u){let f=i[s+0],m=i[s+1],y=i[s+2],v=i[s+3];const x=o[l+0],b=o[l+1],E=o[l+2],C=o[l+3];if(0===u)return e[t+0]=f,e[t+1]=m,e[t+2]=y,void(e[t+3]=v);if(1===u)return e[t+0]=x,e[t+1]=b,e[t+2]=E,void(e[t+3]=C);if(v!==C||f!==x||m!==b||y!==E){let A=1-u;const N=f*x+m*b+y*E+v*C,F=N>=0?1:-1,V=1-N*N;if(V>Number.EPSILON){const G=Math.sqrt(V),ee=Math.atan2(G,N*F);A=Math.sin(A*ee)/G,u=Math.sin(u*ee)/G}const k=u*F;if(f=f*A+x*k,m=m*A+b*k,y=y*A+E*k,v=v*A+C*k,A===1-u){const G=1/Math.sqrt(f*f+m*m+y*y+v*v);f*=G,m*=G,y*=G,v*=G}}e[t]=f,e[t+1]=m,e[t+2]=y,e[t+3]=v}static multiplyQuaternionsFlat(e,t,i,s,o,l){const u=i[s],f=i[s+1],m=i[s+2],y=i[s+3],v=o[l],x=o[l+1],b=o[l+2],E=o[l+3];return e[t]=u*E+y*v+f*b-m*x,e[t+1]=f*E+y*x+m*v-u*b,e[t+2]=m*E+y*b+u*x-f*v,e[t+3]=y*E-u*v-f*x-m*b,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,s=e._y,o=e._z,l=e._order,u=Math.cos,f=Math.sin,m=u(i/2),y=u(s/2),v=u(o/2),x=f(i/2),b=f(s/2),E=f(o/2);switch(l){case"XYZ":this._x=x*y*v+m*b*E,this._y=m*b*v-x*y*E,this._z=m*y*E+x*b*v,this._w=m*y*v-x*b*E;break;case"YXZ":this._x=x*y*v+m*b*E,this._y=m*b*v-x*y*E,this._z=m*y*E-x*b*v,this._w=m*y*v+x*b*E;break;case"ZXY":this._x=x*y*v-m*b*E,this._y=m*b*v+x*y*E,this._z=m*y*E+x*b*v,this._w=m*y*v-x*b*E;break;case"ZYX":this._x=x*y*v-m*b*E,this._y=m*b*v+x*y*E,this._z=m*y*E-x*b*v,this._w=m*y*v+x*b*E;break;case"YZX":this._x=x*y*v+m*b*E,this._y=m*b*v+x*y*E,this._z=m*y*E-x*b*v,this._w=m*y*v-x*b*E;break;case"XZY":this._x=x*y*v-m*b*E,this._y=m*b*v-x*y*E,this._z=m*y*E+x*b*v,this._w=m*y*v+x*b*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],o=t[8],l=t[1],u=t[5],f=t[9],m=t[2],y=t[6],v=t[10],x=i+u+v;if(x>0){const b=.5/Math.sqrt(x+1);this._w=.25/b,this._x=(y-f)*b,this._y=(o-m)*b,this._z=(l-s)*b}else if(i>u&&i>v){const b=2*Math.sqrt(1+i-u-v);this._w=(y-f)/b,this._x=.25*b,this._y=(s+l)/b,this._z=(o+m)/b}else if(u>v){const b=2*Math.sqrt(1+u-i-v);this._w=(o-m)/b,this._x=(s+l)/b,this._y=.25*b,this._z=(f+y)/b}else{const b=2*Math.sqrt(1+v-i-u);this._w=(l-s)/b,this._x=(o+m)/b,this._y=(f+y)/b,this._z=.25*b}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ws(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,o=e._z,l=e._w,u=t._x,f=t._y,m=t._z,y=t._w;return this._x=i*y+l*u+s*m-o*f,this._y=s*y+l*f+o*u-i*m,this._z=o*y+l*m+i*f-s*u,this._w=l*y-i*u-s*f-o*m,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,s=this._y,o=this._z,l=this._w;let u=l*e._w+i*e._x+s*e._y+o*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=l,this._x=i,this._y=s,this._z=o,this;const f=1-u*u;if(f<=Number.EPSILON){const b=1-t;return this._w=b*l+t*this._w,this._x=b*i+t*this._x,this._y=b*s+t*this._y,this._z=b*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const m=Math.sqrt(f),y=Math.atan2(m,u),v=Math.sin((1-t)*y)/m,x=Math.sin(t*y)/m;return this._w=l*v+this._w*x,this._x=i*v+this._x*x,this._y=s*v+this._y*x,this._z=o*v+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(o),i*Math.cos(o),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}ks.prototype.isQuaternion=!0;class Y{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(cF.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(cF.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*s,this.y=o[1]*t+o[4]*i+o[7]*s,this.z=o[2]*t+o[5]*i+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,o=e.elements,l=1/(o[3]*t+o[7]*i+o[11]*s+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*s+o[12])*l,this.y=(o[1]*t+o[5]*i+o[9]*s+o[13])*l,this.z=(o[2]*t+o[6]*i+o[10]*s+o[14])*l,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,o=e.x,l=e.y,u=e.z,f=e.w,m=f*t+l*s-u*i,y=f*i+u*t-o*s,v=f*s+o*i-l*t,x=-o*t-l*i-u*s;return this.x=m*f+x*-o+y*-u-v*-l,this.y=y*f+x*-l+v*-o-m*-u,this.z=v*f+x*-u+m*-l-y*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s,this.y=o[1]*t+o[5]*i+o[9]*s,this.z=o[2]*t+o[6]*i+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,o=e.z,l=t.x,u=t.y,f=t.z;return this.x=s*f-o*u,this.y=o*l-i*f,this.z=i*u-s*l,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return sD.copy(this).projectOnVector(e),this.sub(sD)}reflect(e){return this.sub(sD.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ws(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Y.prototype.isVector3=!0;const sD=new Y,cF=new ks;class Uo{constructor(e=new Y(1/0,1/0,1/0),t=new Y(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,s=1/0,o=-1/0,l=-1/0,u=-1/0;for(let f=0,m=e.length;f<m;f+=3){const y=e[f],v=e[f+1],x=e[f+2];y<t&&(t=y),v<i&&(i=v),x<s&&(s=x),y>o&&(o=y),v>l&&(l=v),x>u&&(u=x)}return this.min.set(t,i,s),this.max.set(o,l,u),this}setFromBufferAttribute(e){let t=1/0,i=1/0,s=1/0,o=-1/0,l=-1/0,u=-1/0;for(let f=0,m=e.count;f<m;f++){const y=e.getX(f),v=e.getY(f),x=e.getZ(f);y<t&&(t=y),v<i&&(i=v),x<s&&(s=x),y>o&&(o=y),v>l&&(l=v),x>u&&(u=x)}return this.min.set(t,i,s),this.max.set(o,l,u),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=rm.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const o=i.attributes.position;for(let l=0,u=o.count;l<u;l++)rm.fromBufferAttribute(o,l).applyMatrix4(e.matrixWorld),this.expandByPoint(rm)}else null===i.boundingBox&&i.computeBoundingBox(),oD.copy(i.boundingBox),oD.applyMatrix4(e.matrixWorld),this.union(oD);const s=e.children;for(let o=0,l=s.length;o<l;o++)this.expandByObject(s[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,rm),rm.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(H0),cE.subVectors(this.max,H0),fy.subVectors(e.a,H0),py.subVectors(e.b,H0),my.subVectors(e.c,H0),qd.subVectors(py,fy),jd.subVectors(my,py),sm.subVectors(fy,my);let t=[0,-qd.z,qd.y,0,-jd.z,jd.y,0,-sm.z,sm.y,qd.z,0,-qd.x,jd.z,0,-jd.x,sm.z,0,-sm.x,-qd.y,qd.x,0,-jd.y,jd.x,0,-sm.y,sm.x,0];return!(!aD(t,fy,py,my,cE)||(t=[1,0,0,0,1,0,0,0,1],!aD(t,fy,py,my,cE)))&&(uE.crossVectors(qd,jd),t=[uE.x,uE.y,uE.z],aD(t,fy,py,my,cE))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return rm.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(rm).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(yh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),yh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),yh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),yh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),yh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),yh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),yh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),yh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(yh)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Uo.prototype.isBox3=!0;const yh=[new Y,new Y,new Y,new Y,new Y,new Y,new Y,new Y],rm=new Y,oD=new Uo,fy=new Y,py=new Y,my=new Y,qd=new Y,jd=new Y,sm=new Y,H0=new Y,cE=new Y,uE=new Y,om=new Y;function aD(n,e,t,i,s){for(let o=0,l=n.length-3;o<=l;o+=3){om.fromArray(n,o);const u=s.x*Math.abs(om.x)+s.y*Math.abs(om.y)+s.z*Math.abs(om.z),f=e.dot(om),m=t.dot(om),y=i.dot(om);if(Math.max(-Math.max(f,m,y),Math.min(f,m,y))>u)return!1}return!0}const KG=new Uo,uF=new Y,hE=new Y,lD=new Y;class Kc{constructor(e=new Y,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):KG.setFromPoints(e).getCenter(i);let s=0;for(let o=0,l=e.length;o<l;o++)s=Math.max(s,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){lD.subVectors(e,this.center);const t=lD.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=.5*(i-this.radius);this.center.add(lD.multiplyScalar(s/i)),this.radius+=s}return this}union(e){return!0===this.center.equals(e.center)?hE.set(0,0,1).multiplyScalar(e.radius):hE.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(uF.copy(e.center).add(hE)),this.expandByPoint(uF.copy(e.center).sub(hE)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _h=new Y,cD=new Y,dE=new Y,Xd=new Y,uD=new Y,fE=new Y,hD=new Y;class Yd{constructor(e=new Y,t=new Y(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_h)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_h.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_h.copy(this.direction).multiplyScalar(t).add(this.origin),_h.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){cD.copy(e).add(t).multiplyScalar(.5),dE.copy(t).sub(e).normalize(),Xd.copy(this.origin).sub(cD);const o=.5*e.distanceTo(t),l=-this.direction.dot(dE),u=Xd.dot(this.direction),f=-Xd.dot(dE),m=Xd.lengthSq(),y=Math.abs(1-l*l);let v,x,b,E;if(y>0)if(v=l*f-u,x=l*u-f,E=o*y,v>=0)if(x>=-E)if(x<=E){const C=1/y;v*=C,x*=C,b=v*(v+l*x+2*u)+x*(l*v+x+2*f)+m}else x=o,v=Math.max(0,-(l*x+u)),b=-v*v+x*(x+2*f)+m;else x=-o,v=Math.max(0,-(l*x+u)),b=-v*v+x*(x+2*f)+m;else x<=-E?(v=Math.max(0,-(-l*o+u)),x=v>0?-o:Math.min(Math.max(-o,-f),o),b=-v*v+x*(x+2*f)+m):x<=E?(v=0,x=Math.min(Math.max(-o,-f),o),b=x*(x+2*f)+m):(v=Math.max(0,-(l*o+u)),x=v>0?o:Math.min(Math.max(-o,-f),o),b=-v*v+x*(x+2*f)+m);else x=l>0?-o:o,v=Math.max(0,-(l*x+u)),b=-v*v+x*(x+2*f)+m;return i&&i.copy(this.direction).multiplyScalar(v).add(this.origin),s&&s.copy(dE).multiplyScalar(x).add(cD),b}intersectSphere(e,t){_h.subVectors(e.center,this.origin);const i=_h.dot(this.direction),s=_h.dot(_h)-i*i,o=e.radius*e.radius;if(s>o)return null;const l=Math.sqrt(o-s),u=i-l,f=i+l;return u<0&&f<0?null:this.at(u<0?f:u,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,o,l,u,f;const m=1/this.direction.x,y=1/this.direction.y,v=1/this.direction.z,x=this.origin;return m>=0?(i=(e.min.x-x.x)*m,s=(e.max.x-x.x)*m):(i=(e.max.x-x.x)*m,s=(e.min.x-x.x)*m),y>=0?(o=(e.min.y-x.y)*y,l=(e.max.y-x.y)*y):(o=(e.max.y-x.y)*y,l=(e.min.y-x.y)*y),i>l||o>s||((o>i||i!=i)&&(i=o),(l<s||s!=s)&&(s=l),v>=0?(u=(e.min.z-x.z)*v,f=(e.max.z-x.z)*v):(u=(e.max.z-x.z)*v,f=(e.min.z-x.z)*v),i>f||u>s)||((u>i||i!=i)&&(i=u),(f<s||s!=s)&&(s=f),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return null!==this.intersectBox(e,_h)}intersectTriangle(e,t,i,s,o){uD.subVectors(t,e),fE.subVectors(i,e),hD.crossVectors(uD,fE);let u,l=this.direction.dot(hD);if(l>0){if(s)return null;u=1}else{if(!(l<0))return null;u=-1,l=-l}Xd.subVectors(this.origin,e);const f=u*this.direction.dot(fE.crossVectors(Xd,fE));if(f<0)return null;const m=u*this.direction.dot(uD.cross(Xd));if(m<0||f+m>l)return null;const y=-u*Xd.dot(hD);return y<0?null:this.at(y/l,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ft{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,s,o,l,u,f,m,y,v,x,b,E,C,A){const N=this.elements;return N[0]=e,N[4]=t,N[8]=i,N[12]=s,N[1]=o,N[5]=l,N[9]=u,N[13]=f,N[2]=m,N[6]=y,N[10]=v,N[14]=x,N[3]=b,N[7]=E,N[11]=C,N[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ft).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/gy.setFromMatrixColumn(e,0).length(),o=1/gy.setFromMatrixColumn(e,1).length(),l=1/gy.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*l,t[9]=i[9]*l,t[10]=i[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,s=e.y,o=e.z,l=Math.cos(i),u=Math.sin(i),f=Math.cos(s),m=Math.sin(s),y=Math.cos(o),v=Math.sin(o);if("XYZ"===e.order){const x=l*y,b=l*v,E=u*y,C=u*v;t[0]=f*y,t[4]=-f*v,t[8]=m,t[1]=b+E*m,t[5]=x-C*m,t[9]=-u*f,t[2]=C-x*m,t[6]=E+b*m,t[10]=l*f}else if("YXZ"===e.order){const x=f*y,b=f*v,E=m*y,C=m*v;t[0]=x+C*u,t[4]=E*u-b,t[8]=l*m,t[1]=l*v,t[5]=l*y,t[9]=-u,t[2]=b*u-E,t[6]=C+x*u,t[10]=l*f}else if("ZXY"===e.order){const x=f*y,b=f*v,E=m*y,C=m*v;t[0]=x-C*u,t[4]=-l*v,t[8]=E+b*u,t[1]=b+E*u,t[5]=l*y,t[9]=C-x*u,t[2]=-l*m,t[6]=u,t[10]=l*f}else if("ZYX"===e.order){const x=l*y,b=l*v,E=u*y,C=u*v;t[0]=f*y,t[4]=E*m-b,t[8]=x*m+C,t[1]=f*v,t[5]=C*m+x,t[9]=b*m-E,t[2]=-m,t[6]=u*f,t[10]=l*f}else if("YZX"===e.order){const x=l*f,b=l*m,E=u*f,C=u*m;t[0]=f*y,t[4]=C-x*v,t[8]=E*v+b,t[1]=v,t[5]=l*y,t[9]=-u*y,t[2]=-m*y,t[6]=b*v+E,t[10]=x-C*v}else if("XZY"===e.order){const x=l*f,b=l*m,E=u*f,C=u*m;t[0]=f*y,t[4]=-v,t[8]=m*y,t[1]=x*v+C,t[5]=l*y,t[9]=b*v-E,t[2]=E*v-b,t[6]=u*y,t[10]=C*v+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($G,e,ZG)}lookAt(e,t,i){const s=this.elements;return Qa.subVectors(e,t),0===Qa.lengthSq()&&(Qa.z=1),Qa.normalize(),Kd.crossVectors(i,Qa),0===Kd.lengthSq()&&(1===Math.abs(i.z)?Qa.x+=1e-4:Qa.z+=1e-4,Qa.normalize(),Kd.crossVectors(i,Qa)),Kd.normalize(),pE.crossVectors(Qa,Kd),s[0]=Kd.x,s[4]=pE.x,s[8]=Qa.x,s[1]=Kd.y,s[5]=pE.y,s[9]=Qa.y,s[2]=Kd.z,s[6]=pE.z,s[10]=Qa.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,o=this.elements,l=i[0],u=i[4],f=i[8],m=i[12],y=i[1],v=i[5],x=i[9],b=i[13],E=i[2],C=i[6],A=i[10],N=i[14],F=i[3],V=i[7],k=i[11],G=i[15],ee=s[0],oe=s[4],ue=s[8],Pe=s[12],ye=s[1],q=s[5],le=s[9],Ze=s[13],_e=s[2],Le=s[6],Te=s[10],We=s[14],be=s[3],ot=s[7],ht=s[11],bt=s[15];return o[0]=l*ee+u*ye+f*_e+m*be,o[4]=l*oe+u*q+f*Le+m*ot,o[8]=l*ue+u*le+f*Te+m*ht,o[12]=l*Pe+u*Ze+f*We+m*bt,o[1]=y*ee+v*ye+x*_e+b*be,o[5]=y*oe+v*q+x*Le+b*ot,o[9]=y*ue+v*le+x*Te+b*ht,o[13]=y*Pe+v*Ze+x*We+b*bt,o[2]=E*ee+C*ye+A*_e+N*be,o[6]=E*oe+C*q+A*Le+N*ot,o[10]=E*ue+C*le+A*Te+N*ht,o[14]=E*Pe+C*Ze+A*We+N*bt,o[3]=F*ee+V*ye+k*_e+G*be,o[7]=F*oe+V*q+k*Le+G*ot,o[11]=F*ue+V*le+k*Te+G*ht,o[15]=F*Pe+V*Ze+k*We+G*bt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],o=e[12],l=e[1],u=e[5],f=e[9],m=e[13],y=e[2],v=e[6],x=e[10],b=e[14];return e[3]*(+o*f*v-s*m*v-o*u*x+i*m*x+s*u*b-i*f*b)+e[7]*(+t*f*b-t*m*x+o*l*x-s*l*b+s*m*y-o*f*y)+e[11]*(+t*m*v-t*u*b-o*l*v+i*l*b+o*u*y-i*m*y)+e[15]*(-s*u*y-t*f*v+t*u*x+s*l*v-i*l*x+i*f*y)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],o=e[3],l=e[4],u=e[5],f=e[6],m=e[7],y=e[8],v=e[9],x=e[10],b=e[11],E=e[12],C=e[13],A=e[14],N=e[15],F=v*A*m-C*x*m+C*f*b-u*A*b-v*f*N+u*x*N,V=E*x*m-y*A*m-E*f*b+l*A*b+y*f*N-l*x*N,k=y*C*m-E*v*m+E*u*b-l*C*b-y*u*N+l*v*N,G=E*v*f-y*C*f-E*u*x+l*C*x+y*u*A-l*v*A,ee=t*F+i*V+s*k+o*G;if(0===ee)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const oe=1/ee;return e[0]=F*oe,e[1]=(C*x*o-v*A*o-C*s*b+i*A*b+v*s*N-i*x*N)*oe,e[2]=(u*A*o-C*f*o+C*s*m-i*A*m-u*s*N+i*f*N)*oe,e[3]=(v*f*o-u*x*o-v*s*m+i*x*m+u*s*b-i*f*b)*oe,e[4]=V*oe,e[5]=(y*A*o-E*x*o+E*s*b-t*A*b-y*s*N+t*x*N)*oe,e[6]=(E*f*o-l*A*o-E*s*m+t*A*m+l*s*N-t*f*N)*oe,e[7]=(l*x*o-y*f*o+y*s*m-t*x*m-l*s*b+t*f*b)*oe,e[8]=k*oe,e[9]=(E*v*o-y*C*o-E*i*b+t*C*b+y*i*N-t*v*N)*oe,e[10]=(l*C*o-E*u*o+E*i*m-t*C*m-l*i*N+t*u*N)*oe,e[11]=(y*u*o-l*v*o-y*i*m+t*v*m+l*i*b-t*u*b)*oe,e[12]=G*oe,e[13]=(y*C*s-E*v*s+E*i*x-t*C*x-y*i*A+t*v*A)*oe,e[14]=(E*u*s-l*C*s-E*i*f+t*C*f+l*i*A-t*u*A)*oe,e[15]=(l*v*s-y*u*s+y*i*f-t*v*f-l*i*x+t*u*x)*oe,this}scale(e){const t=this.elements,i=e.x,s=e.y,o=e.z;return t[0]*=i,t[4]*=s,t[8]*=o,t[1]*=i,t[5]*=s,t[9]*=o,t[2]*=i,t[6]*=s,t[10]*=o,t[3]*=i,t[7]*=s,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),o=1-i,l=e.x,u=e.y,f=e.z,m=o*l,y=o*u;return this.set(m*l+i,m*u-s*f,m*f+s*u,0,m*u+s*f,y*u+i,y*f-s*l,0,m*f-s*u,y*f+s*l,o*f*f+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,o,l){return this.set(1,i,o,0,e,1,l,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,o=t._x,l=t._y,u=t._z,f=t._w,m=o+o,y=l+l,v=u+u,x=o*m,b=o*y,E=o*v,C=l*y,A=l*v,N=u*v,F=f*m,V=f*y,k=f*v,G=i.x,ee=i.y,oe=i.z;return s[0]=(1-(C+N))*G,s[1]=(b+k)*G,s[2]=(E-V)*G,s[3]=0,s[4]=(b-k)*ee,s[5]=(1-(x+N))*ee,s[6]=(A+F)*ee,s[7]=0,s[8]=(E+V)*oe,s[9]=(A-F)*oe,s[10]=(1-(x+C))*oe,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let o=gy.set(s[0],s[1],s[2]).length();const l=gy.set(s[4],s[5],s[6]).length(),u=gy.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],hc.copy(this);const m=1/o,y=1/l,v=1/u;return hc.elements[0]*=m,hc.elements[1]*=m,hc.elements[2]*=m,hc.elements[4]*=y,hc.elements[5]*=y,hc.elements[6]*=y,hc.elements[8]*=v,hc.elements[9]*=v,hc.elements[10]*=v,t.setFromRotationMatrix(hc),i.x=o,i.y=l,i.z=u,this}makePerspective(e,t,i,s,o,l){void 0===l&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const u=this.elements,m=2*o/(i-s),y=(t+e)/(t-e),v=(i+s)/(i-s),x=-(l+o)/(l-o),b=-2*l*o/(l-o);return u[0]=2*o/(t-e),u[4]=0,u[8]=y,u[12]=0,u[1]=0,u[5]=m,u[9]=v,u[13]=0,u[2]=0,u[6]=0,u[10]=x,u[14]=b,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,i,s,o,l){const u=this.elements,f=1/(t-e),m=1/(i-s),y=1/(l-o),v=(t+e)*f,x=(i+s)*m,b=(l+o)*y;return u[0]=2*f,u[4]=0,u[8]=0,u[12]=-v,u[1]=0,u[5]=2*m,u[9]=0,u[13]=-x,u[2]=0,u[6]=0,u[10]=-2*y,u[14]=-b,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Ft.prototype.isMatrix4=!0;const gy=new Y,hc=new Ft,$G=new Y(0,0,0),ZG=new Y(1,1,1),Kd=new Y,pE=new Y,Qa=new Y,hF=new Ft,dF=new ks;class $d{constructor(e=0,t=0,i=0,s=$d.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,o=s[0],l=s[4],u=s[8],f=s[1],m=s[5],y=s[9],v=s[2],x=s[6],b=s[10];switch(t){case"XYZ":this._y=Math.asin(ws(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-y,b),this._z=Math.atan2(-l,o)):(this._x=Math.atan2(x,m),this._z=0);break;case"YXZ":this._x=Math.asin(-ws(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(u,b),this._z=Math.atan2(f,m)):(this._y=Math.atan2(-v,o),this._z=0);break;case"ZXY":this._x=Math.asin(ws(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-v,b),this._z=Math.atan2(-l,m)):(this._y=0,this._z=Math.atan2(f,o));break;case"ZYX":this._y=Math.asin(-ws(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(x,b),this._z=Math.atan2(f,o)):(this._x=0,this._z=Math.atan2(-l,m));break;case"YZX":this._z=Math.asin(ws(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-y,m),this._y=Math.atan2(-v,o)):(this._x=0,this._y=Math.atan2(u,b));break;case"XZY":this._z=Math.asin(-ws(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(x,m),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-y,b),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return hF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(hF,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return dF.setFromEuler(this),this.setFromQuaternion(dF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}$d.prototype.isEuler=!0,$d.DefaultOrder="XYZ",$d.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class dD{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let JG=0;const fF=new Y,yy=new ks,vh=new Ft,mE=new Y,G0=new Y,QG=new Y,e4=new ks,pF=new Y(1,0,0),mF=new Y(0,1,0),gF=new Y(0,0,1),t4={type:"added"},yF={type:"removed"};class Zi extends Wd{constructor(){super(),Object.defineProperty(this,"id",{value:JG++}),this.uuid=Za(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zi.DefaultUp.clone();const e=new Y,t=new $d,i=new ks,s=new Y(1,1,1);t._onChange(function o(){i.setFromEuler(t,!1)}),i._onChange(function l(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ft},normalMatrix:{value:new yo}}),this.matrix=new Ft,this.matrixWorld=new Ft,this.matrixAutoUpdate=Zi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new dD,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return yy.setFromAxisAngle(e,t),this.quaternion.multiply(yy),this}rotateOnWorldAxis(e,t){return yy.setFromAxisAngle(e,t),this.quaternion.premultiply(yy),this}rotateX(e){return this.rotateOnAxis(pF,e)}rotateY(e){return this.rotateOnAxis(mF,e)}rotateZ(e){return this.rotateOnAxis(gF,e)}translateOnAxis(e,t){return fF.copy(e).applyQuaternion(this.quaternion),this.position.add(fF.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(pF,e)}translateY(e){return this.translateOnAxis(mF,e)}translateZ(e){return this.translateOnAxis(gF,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(vh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?mE.copy(e):mE.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),G0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vh.lookAt(G0,mE,this.up):vh.lookAt(mE,G0,this.up),this.quaternion.setFromRotationMatrix(vh),s&&(vh.extractRotation(s.matrixWorld),yy.setFromRotationMatrix(vh),this.quaternion.premultiply(yy.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(t4)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(yF)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(yF)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),vh.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),vh.multiply(e.parent.matrixWorld)),e.applyMatrix4(vh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const l=this.children[i].getObjectByProperty(e,t);if(void 0!==l)return l}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(G0,e,QG),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(G0,e4,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const s=this.children;for(let o=0,l=s.length;o<l;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function o(u,f){return void 0===u[f.uuid]&&(u[f.uuid]=f.toJSON(e)),f.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const u=this.geometry.parameters;if(void 0!==u&&void 0!==u.shapes){const f=u.shapes;if(Array.isArray(f))for(let m=0,y=f.length;m<y;m++)o(e.shapes,f[m]);else o(e.shapes,f)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const u=[];for(let f=0,m=this.material.length;f<m;f++)u.push(o(e.materials,this.material[f]));s.material=u}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++)s.animations.push(o(e.animations,this.animations[u]))}if(t){const u=l(e.geometries),f=l(e.materials),m=l(e.textures),y=l(e.images),v=l(e.shapes),x=l(e.skeletons),b=l(e.animations),E=l(e.nodes);u.length>0&&(i.geometries=u),f.length>0&&(i.materials=f),m.length>0&&(i.textures=m),y.length>0&&(i.images=y),v.length>0&&(i.shapes=v),x.length>0&&(i.skeletons=x),b.length>0&&(i.animations=b),E.length>0&&(i.nodes=E)}return i.object=s,i;function l(u){const f=[];for(const m in u){const y=u[m];delete y.metadata,f.push(y)}return f}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++)this.add(e.children[i].clone());return this}}Zi.DefaultUp=new Y(0,1,0),Zi.DefaultMatrixAutoUpdate=!0,Zi.prototype.isObject3D=!0;const dc=new Y,xh=new Y,fD=new Y,bh=new Y,_y=new Y,vy=new Y,_F=new Y,pD=new Y,mD=new Y,gD=new Y;class Vs{constructor(e=new Y,t=new Y,i=new Y){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),dc.subVectors(e,t),s.cross(dc);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,t,i,s,o){dc.subVectors(s,t),xh.subVectors(i,t),fD.subVectors(e,t);const l=dc.dot(dc),u=dc.dot(xh),f=dc.dot(fD),m=xh.dot(xh),y=xh.dot(fD),v=l*m-u*u;if(0===v)return o.set(-2,-1,-1);const x=1/v,b=(m*f-u*y)*x,E=(l*y-u*f)*x;return o.set(1-b-E,E,b)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,bh),bh.x>=0&&bh.y>=0&&bh.x+bh.y<=1}static getUV(e,t,i,s,o,l,u,f){return this.getBarycoord(e,t,i,s,bh),f.set(0,0),f.addScaledVector(o,bh.x),f.addScaledVector(l,bh.y),f.addScaledVector(u,bh.z),f}static isFrontFacing(e,t,i,s){return dc.subVectors(i,t),xh.subVectors(e,t),dc.cross(xh).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return dc.subVectors(this.c,this.b),xh.subVectors(this.a,this.b),.5*dc.cross(xh).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Vs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Vs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,o){return Vs.getUV(e,this.a,this.b,this.c,t,i,s,o)}containsPoint(e){return Vs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Vs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,o=this.c;let l,u;_y.subVectors(s,i),vy.subVectors(o,i),pD.subVectors(e,i);const f=_y.dot(pD),m=vy.dot(pD);if(f<=0&&m<=0)return t.copy(i);mD.subVectors(e,s);const y=_y.dot(mD),v=vy.dot(mD);if(y>=0&&v<=y)return t.copy(s);const x=f*v-y*m;if(x<=0&&f>=0&&y<=0)return l=f/(f-y),t.copy(i).addScaledVector(_y,l);gD.subVectors(e,o);const b=_y.dot(gD),E=vy.dot(gD);if(E>=0&&b<=E)return t.copy(o);const C=b*m-f*E;if(C<=0&&m>=0&&E<=0)return u=m/(m-E),t.copy(i).addScaledVector(vy,u);const A=y*E-b*v;if(A<=0&&v-y>=0&&b-E>=0)return _F.subVectors(o,s),u=(v-y)/(v-y+(b-E)),t.copy(s).addScaledVector(_F,u);const N=1/(A+C+x);return l=C*N,u=x*N,t.copy(i).addScaledVector(_y,l).addScaledVector(vy,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let n4=0;class Us extends Wd{constructor(){super(),Object.defineProperty(this,"id",{value:n4++}),this.uuid=Za(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const s=this[t];void 0!==s?s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function s(o){const l=[];for(const u in o){const f=o[u];delete f.metadata,l.push(f)}return l}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const o=s(e.textures),l=s(e.images);o.length>0&&(i.textures=o),l.length>0&&(i.images=l)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const s=t.length;i=new Array(s);for(let o=0;o!==s;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Us.prototype.isMaterial=!0,Us.fromType=function(){return null};class $c extends Us{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}$c.prototype.isMeshBasicMaterial=!0;const zs=new Y,gE=new at;class Cr{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=B0,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let s=0,o=e.length;s<o;s++){let l=e[s];void 0===l&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),l=new Ut),t[i++]=l.r,t[i++]=l.g,t[i++]=l.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let s=0,o=e.length;s<o;s++){let l=e[s];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),l=new at),t[i++]=l.x,t[i++]=l.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let s=0,o=e.length;s<o;s++){let l=e[s];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),l=new Y),t[i++]=l.x,t[i++]=l.y,t[i++]=l.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let s=0,o=e.length;s<o;s++){let l=e[s];void 0===l&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),l=new Wi),t[i++]=l.x,t[i++]=l.y,t[i++]=l.z,t[i++]=l.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)gE.fromBufferAttribute(this,t),gE.applyMatrix3(e),this.setXY(t,gE.x,gE.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)zs.fromBufferAttribute(this,t),zs.applyMatrix3(e),this.setXYZ(t,zs.x,zs.y,zs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)zs.fromBufferAttribute(this,t),zs.applyMatrix4(e),this.setXYZ(t,zs.x,zs.y,zs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)zs.fromBufferAttribute(this,t),zs.applyNormalMatrix(e),this.setXYZ(t,zs.x,zs.y,zs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)zs.fromBufferAttribute(this,t),zs.transformDirection(e),this.setXYZ(t,zs.x,zs.y,zs.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,o){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==B0&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}Cr.prototype.isBufferAttribute=!0;class vF extends Cr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class xF extends Cr{constructor(e,t,i){super(new Uint32Array(e),t,i)}}(class i4 extends Cr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}).prototype.isFloat16BufferAttribute=!0;class Kt extends Cr{constructor(e,t,i){super(new Float32Array(e),t,i)}}let r4=0;const Pl=new Ft,yD=new Zi,xy=new Y,el=new Uo,W0=new Uo,_o=new Y;class xn extends Wd{constructor(){super(),Object.defineProperty(this,"id",{value:r4++}),this.uuid=Za(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(aF(e)?xF:vF)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const o=(new yo).getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(e),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Pl.makeRotationFromQuaternion(e),this.applyMatrix4(Pl),this}rotateX(e){return Pl.makeRotationX(e),this.applyMatrix4(Pl),this}rotateY(e){return Pl.makeRotationY(e),this.applyMatrix4(Pl),this}rotateZ(e){return Pl.makeRotationZ(e),this.applyMatrix4(Pl),this}translate(e,t,i){return Pl.makeTranslation(e,t,i),this.applyMatrix4(Pl),this}scale(e,t,i){return Pl.makeScale(e,t,i),this.applyMatrix4(Pl),this}lookAt(e){return yD.lookAt(e),yD.updateMatrix(),this.applyMatrix4(yD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xy).negate(),this.translate(xy.x,xy.y,xy.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Kt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Uo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Y(-1/0,-1/0,-1/0),new Y(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++)el.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(_o.addVectors(this.boundingBox.min,el.min),this.boundingBox.expandByPoint(_o),_o.addVectors(this.boundingBox.max,el.max),this.boundingBox.expandByPoint(_o)):(this.boundingBox.expandByPoint(el.min),this.boundingBox.expandByPoint(el.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Kc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Y,1/0);if(e){const i=this.boundingSphere.center;if(el.setFromBufferAttribute(e),t)for(let o=0,l=t.length;o<l;o++)W0.setFromBufferAttribute(t[o]),this.morphTargetsRelative?(_o.addVectors(el.min,W0.min),el.expandByPoint(_o),_o.addVectors(el.max,W0.max),el.expandByPoint(_o)):(el.expandByPoint(W0.min),el.expandByPoint(W0.max));el.getCenter(i);let s=0;for(let o=0,l=e.count;o<l;o++)_o.fromBufferAttribute(e,o),s=Math.max(s,i.distanceToSquared(_o));if(t)for(let o=0,l=t.length;o<l;o++){const u=t[o],f=this.morphTargetsRelative;for(let m=0,y=u.count;m<y;m++)_o.fromBufferAttribute(u,m),f&&(xy.fromBufferAttribute(e,m),_o.add(xy)),s=Math.max(s,i.distanceToSquared(_o))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,s=t.position.array,o=t.normal.array,l=t.uv.array,u=s.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Cr(new Float32Array(4*u),4));const f=this.getAttribute("tangent").array,m=[],y=[];for(let ye=0;ye<u;ye++)m[ye]=new Y,y[ye]=new Y;const v=new Y,x=new Y,b=new Y,E=new at,C=new at,A=new at,N=new Y,F=new Y;function V(ye,q,le){v.fromArray(s,3*ye),x.fromArray(s,3*q),b.fromArray(s,3*le),E.fromArray(l,2*ye),C.fromArray(l,2*q),A.fromArray(l,2*le),x.sub(v),b.sub(v),C.sub(E),A.sub(E);const Ze=1/(C.x*A.y-A.x*C.y);!isFinite(Ze)||(N.copy(x).multiplyScalar(A.y).addScaledVector(b,-C.y).multiplyScalar(Ze),F.copy(b).multiplyScalar(C.x).addScaledVector(x,-A.x).multiplyScalar(Ze),m[ye].add(N),m[q].add(N),m[le].add(N),y[ye].add(F),y[q].add(F),y[le].add(F))}let k=this.groups;0===k.length&&(k=[{start:0,count:i.length}]);for(let ye=0,q=k.length;ye<q;++ye){const le=k[ye],Ze=le.start;for(let Le=Ze,Te=Ze+le.count;Le<Te;Le+=3)V(i[Le+0],i[Le+1],i[Le+2])}const G=new Y,ee=new Y,oe=new Y,ue=new Y;function Pe(ye){oe.fromArray(o,3*ye),ue.copy(oe);const q=m[ye];G.copy(q),G.sub(oe.multiplyScalar(oe.dot(q))).normalize(),ee.crossVectors(ue,q);const Ze=ee.dot(y[ye])<0?-1:1;f[4*ye]=G.x,f[4*ye+1]=G.y,f[4*ye+2]=G.z,f[4*ye+3]=Ze}for(let ye=0,q=k.length;ye<q;++ye){const le=k[ye],Ze=le.start;for(let Le=Ze,Te=Ze+le.count;Le<Te;Le+=3)Pe(i[Le+0]),Pe(i[Le+1]),Pe(i[Le+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new Cr(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let x=0,b=i.count;x<b;x++)i.setXYZ(x,0,0,0);const s=new Y,o=new Y,l=new Y,u=new Y,f=new Y,m=new Y,y=new Y,v=new Y;if(e)for(let x=0,b=e.count;x<b;x+=3){const E=e.getX(x+0),C=e.getX(x+1),A=e.getX(x+2);s.fromBufferAttribute(t,E),o.fromBufferAttribute(t,C),l.fromBufferAttribute(t,A),y.subVectors(l,o),v.subVectors(s,o),y.cross(v),u.fromBufferAttribute(i,E),f.fromBufferAttribute(i,C),m.fromBufferAttribute(i,A),u.add(y),f.add(y),m.add(y),i.setXYZ(E,u.x,u.y,u.z),i.setXYZ(C,f.x,f.y,f.z),i.setXYZ(A,m.x,m.y,m.z)}else for(let x=0,b=t.count;x<b;x+=3)s.fromBufferAttribute(t,x+0),o.fromBufferAttribute(t,x+1),l.fromBufferAttribute(t,x+2),y.subVectors(l,o),v.subVectors(s,o),y.cross(v),i.setXYZ(x+0,y.x,y.y,y.z),i.setXYZ(x+1,y.x,y.y,y.z),i.setXYZ(x+2,y.x,y.y,y.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const s in i){if(void 0===e.attributes[s])continue;const l=i[s].array,u=e.attributes[s],f=u.array,m=u.itemSize*t,y=Math.min(f.length,l.length-m);for(let v=0,x=m;v<y;v++,x++)l[x]=f[v]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)_o.fromBufferAttribute(e,t),_o.normalize(),e.setXYZ(t,_o.x,_o.y,_o.z)}toNonIndexed(){function e(u,f){const m=u.array,y=u.itemSize,v=u.normalized,x=new m.constructor(f.length*y);let b=0,E=0;for(let C=0,A=f.length;C<A;C++){b=u.isInterleavedBufferAttribute?f[C]*u.data.stride+u.offset:f[C]*y;for(let N=0;N<y;N++)x[E++]=m[b++]}return new Cr(x,y,v)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new xn,i=this.index.array,s=this.attributes;for(const u in s){const m=e(s[u],i);t.setAttribute(u,m)}const o=this.morphAttributes;for(const u in o){const f=[],m=o[u];for(let y=0,v=m.length;y<v;y++){const b=e(m[y],i);f.push(b)}t.morphAttributes[u]=f}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,f=l.length;u<f;u++){const m=l[u];t.addGroup(m.start,m.count,m.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const f=this.parameters;for(const m in f)void 0!==f[m]&&(e[m]=f[m]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const f in i)e.data.attributes[f]=i[f].toJSON(e.data);const s={};let o=!1;for(const f in this.morphAttributes){const m=this.morphAttributes[f],y=[];for(let v=0,x=m.length;v<x;v++)y.push(m[v].toJSON(e.data));y.length>0&&(s[f]=y,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return null!==u&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const s=e.attributes;for(const m in s)this.setAttribute(m,s[m].clone(t));const o=e.morphAttributes;for(const m in o){const y=[],v=o[m];for(let x=0,b=v.length;x<b;x++)y.push(v[x].clone(t));this.morphAttributes[m]=y}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let m=0,y=l.length;m<y;m++){const v=l[m];this.addGroup(v.start,v.count,v.materialIndex)}const u=e.boundingBox;null!==u&&(this.boundingBox=u.clone());const f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}xn.prototype.isBufferGeometry=!0;const bF=new Ft,by=new Yd,_D=new Kc,Zd=new Y,Jd=new Y,Qd=new Y,vD=new Y,xD=new Y,bD=new Y,yE=new Y,_E=new Y,vE=new Y,xE=new at,bE=new at,wE=new at,wD=new Y,ME=new Y;class Hs extends Zi{constructor(e=new xn,t=new $c){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=s.length;o<l;o++){const u=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,s=this.material,o=this.matrixWorld;if(void 0===s||(null===i.boundingSphere&&i.computeBoundingSphere(),_D.copy(i.boundingSphere),_D.applyMatrix4(o),!1===e.ray.intersectsSphere(_D))||(bF.copy(o).invert(),by.copy(e.ray).applyMatrix4(bF),null!==i.boundingBox&&!1===by.intersectsBox(i.boundingBox)))return;let l;if(i.isBufferGeometry){const u=i.index,f=i.attributes.position,m=i.morphAttributes.position,y=i.morphTargetsRelative,v=i.attributes.uv,x=i.attributes.uv2,b=i.groups,E=i.drawRange;if(null!==u)if(Array.isArray(s))for(let C=0,A=b.length;C<A;C++){const N=b[C],F=s[N.materialIndex];for(let G=Math.max(N.start,E.start),ee=Math.min(u.count,Math.min(N.start+N.count,E.start+E.count));G<ee;G+=3){const oe=u.getX(G),ue=u.getX(G+1),Pe=u.getX(G+2);l=EE(this,F,e,by,f,m,y,v,x,oe,ue,Pe),l&&(l.faceIndex=Math.floor(G/3),l.face.materialIndex=N.materialIndex,t.push(l))}}else for(let N=Math.max(0,E.start),F=Math.min(u.count,E.start+E.count);N<F;N+=3){const V=u.getX(N),k=u.getX(N+1),G=u.getX(N+2);l=EE(this,s,e,by,f,m,y,v,x,V,k,G),l&&(l.faceIndex=Math.floor(N/3),t.push(l))}else if(void 0!==f)if(Array.isArray(s))for(let C=0,A=b.length;C<A;C++){const N=b[C],F=s[N.materialIndex];for(let G=Math.max(N.start,E.start),ee=Math.min(f.count,Math.min(N.start+N.count,E.start+E.count));G<ee;G+=3)l=EE(this,F,e,by,f,m,y,v,x,G,G+1,G+2),l&&(l.faceIndex=Math.floor(G/3),l.face.materialIndex=N.materialIndex,t.push(l))}else for(let N=Math.max(0,E.start),F=Math.min(f.count,E.start+E.count);N<F;N+=3)l=EE(this,s,e,by,f,m,y,v,x,N,N+1,N+2),l&&(l.faceIndex=Math.floor(N/3),t.push(l))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function EE(n,e,t,i,s,o,l,u,f,m,y,v){Zd.fromBufferAttribute(s,m),Jd.fromBufferAttribute(s,y),Qd.fromBufferAttribute(s,v);const x=n.morphTargetInfluences;if(o&&x){yE.set(0,0,0),_E.set(0,0,0),vE.set(0,0,0);for(let E=0,C=o.length;E<C;E++){const A=x[E],N=o[E];0!==A&&(vD.fromBufferAttribute(N,m),xD.fromBufferAttribute(N,y),bD.fromBufferAttribute(N,v),l?(yE.addScaledVector(vD,A),_E.addScaledVector(xD,A),vE.addScaledVector(bD,A)):(yE.addScaledVector(vD.sub(Zd),A),_E.addScaledVector(xD.sub(Jd),A),vE.addScaledVector(bD.sub(Qd),A)))}Zd.add(yE),Jd.add(_E),Qd.add(vE)}n.isSkinnedMesh&&(n.boneTransform(m,Zd),n.boneTransform(y,Jd),n.boneTransform(v,Qd));const b=function s4(n,e,t,i,s,o,l,u){let f;if(f=1===e.side?i.intersectTriangle(l,o,s,!0,u):i.intersectTriangle(s,o,l,2!==e.side,u),null===f)return null;ME.copy(u),ME.applyMatrix4(n.matrixWorld);const m=t.ray.origin.distanceTo(ME);return m<t.near||m>t.far?null:{distance:m,point:ME.clone(),object:n}}(n,e,t,i,Zd,Jd,Qd,wD);if(b){u&&(xE.fromBufferAttribute(u,m),bE.fromBufferAttribute(u,y),wE.fromBufferAttribute(u,v),b.uv=Vs.getUV(wD,Zd,Jd,Qd,xE,bE,wE,new at)),f&&(xE.fromBufferAttribute(f,m),bE.fromBufferAttribute(f,y),wE.fromBufferAttribute(f,v),b.uv2=Vs.getUV(wD,Zd,Jd,Qd,xE,bE,wE,new at));const E={a:m,b:y,c:v,normal:new Y,materialIndex:0};Vs.getNormal(Zd,Jd,Qd,E.normal),b.face=E}return b}Hs.prototype.isMesh=!0;class am extends xn{constructor(e=1,t=1,i=1,s=1,o=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:o,depthSegments:l};const u=this;s=Math.floor(s),o=Math.floor(o),l=Math.floor(l);const f=[],m=[],y=[],v=[];let x=0,b=0;function E(C,A,N,F,V,k,G,ee,oe,ue,Pe){const ye=k/oe,q=G/ue,le=k/2,Ze=G/2,_e=ee/2,Le=oe+1,Te=ue+1;let We=0,be=0;const ot=new Y;for(let ht=0;ht<Te;ht++){const bt=ht*q-Ze;for(let mt=0;mt<Le;mt++)ot[C]=(mt*ye-le)*F,ot[A]=bt*V,ot[N]=_e,m.push(ot.x,ot.y,ot.z),ot[C]=0,ot[A]=0,ot[N]=ee>0?1:-1,y.push(ot.x,ot.y,ot.z),v.push(mt/oe),v.push(1-ht/ue),We+=1}for(let ht=0;ht<ue;ht++)for(let bt=0;bt<oe;bt++){const _n=x+bt+Le*(ht+1),vi=x+(bt+1)+Le*(ht+1),Yn=x+(bt+1)+Le*ht;f.push(x+bt+Le*ht,_n,Yn),f.push(_n,vi,Yn),be+=6}u.addGroup(b,be,Pe),b+=be,x+=We}E("z","y","x",-1,-1,i,t,e,l,o,0),E("z","y","x",1,-1,i,t,-e,l,o,1),E("x","z","y",1,1,e,i,t,s,l,2),E("x","z","y",1,-1,e,i,-t,s,l,3),E("x","y","z",1,-1,e,t,i,s,o,4),E("x","y","z",-1,-1,e,t,-i,s,o,5),this.setIndex(f),this.setAttribute("position",new Kt(m,3)),this.setAttribute("normal",new Kt(y,3)),this.setAttribute("uv",new Kt(v,2))}static fromJSON(e){return new am(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function wy(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];e[t][i]=s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.clone():Array.isArray(s)?s.slice():s}}return e}function zo(n){const e={};for(let t=0;t<n.length;t++){const i=wy(n[t]);for(const s in i)e[s]=i[s]}return e}const MD={clone:wy,merge:zo};class Il extends Us{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=wy(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const l=this.uniforms[s].value;t.uniforms[s]=l&&l.isTexture?{type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?{type:"c",value:l.getHex()}:l&&l.isVector2?{type:"v2",value:l.toArray()}:l&&l.isVector3?{type:"v3",value:l.toArray()}:l&&l.isVector4?{type:"v4",value:l.toArray()}:l&&l.isMatrix3?{type:"m3",value:l.toArray()}:l&&l.isMatrix4?{type:"m4",value:l.toArray()}:{value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const s in this.extensions)!0===this.extensions[s]&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Il.prototype.isShaderMaterial=!0;class SE extends Zi{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Ft,this.projectionMatrix=new Ft,this.projectionMatrixInverse=new Ft}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}SE.prototype.isCamera=!0;class vo extends SE{constructor(e=50,t=1,i=.1,s=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*V0*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*tm*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*V0*Math.atan(Math.tan(.5*tm*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,o,l){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*tm*this.fov)/this.zoom,i=2*t,s=this.aspect*i,o=-.5*s;const l=this.view;if(null!==this.view&&this.view.enabled){const f=l.fullWidth,m=l.fullHeight;o+=l.offsetX*s/f,t-=l.offsetY*i/m,s*=l.width/f,i*=l.height/m}const u=this.filmOffset;0!==u&&(o+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}vo.prototype.isPerspectiveCamera=!0;class ED extends Zi{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const s=new vo(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Y(1,0,0)),this.add(s);const o=new vo(90,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Y(-1,0,0)),this.add(o);const l=new vo(90,1,e,t);l.layers=this.layers,l.up.set(0,0,1),l.lookAt(new Y(0,1,0)),this.add(l);const u=new vo(90,1,e,t);u.layers=this.layers,u.up.set(0,0,-1),u.lookAt(new Y(0,-1,0)),this.add(u);const f=new vo(90,1,e,t);f.layers=this.layers,f.up.set(0,-1,0),f.lookAt(new Y(0,0,1)),this.add(f);const m=new vo(90,1,e,t);m.layers=this.layers,m.up.set(0,-1,0),m.lookAt(new Y(0,0,-1)),this.add(m)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[s,o,l,u,f,m]=this.children,y=e.getRenderTarget(),v=e.outputEncoding,x=e.toneMapping,b=e.xr.enabled;e.outputEncoding=mh,e.toneMapping=0,e.xr.enabled=!1;const E=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,o),e.setRenderTarget(i,2),e.render(t,l),e.setRenderTarget(i,3),e.render(t,u),e.setRenderTarget(i,4),e.render(t,f),i.texture.generateMipmaps=E,e.setRenderTarget(i,5),e.render(t,m),e.setRenderTarget(y),e.outputEncoding=v,e.toneMapping=x,e.xr.enabled=b,i.texture.needsPMREMUpdate=!0}}class q0 extends Fa{constructor(e,t,i,s,o,l,u,f,m,y){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,s,o,l,u,f,m,y),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}q0.prototype.isCubeTexture=!0;class wF extends Ja{constructor(e,t={}){super(e,e,t);const i={width:e,height:e,depth:1};this.texture=new q0([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Bs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new am(5,5,5),o=new Il({name:"CubemapFromEquirect",uniforms:wy(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=t;const l=new Hs(s,o),u=t.minFilter;return 1008===t.minFilter&&(t.minFilter=Bs),new ED(1,10,this).update(e,l),t.minFilter=u,l.geometry.dispose(),l.material.dispose(),this}clear(e,t,i,s){const o=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,i,s);e.setRenderTarget(o)}}wF.prototype.isWebGLCubeRenderTarget=!0;const SD=new Y,l4=new Y,c4=new yo;class wh{constructor(e=new Y(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=SD.subVectors(i,t).cross(l4.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(SD),s=this.normal.dot(i);if(0===s)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:t.copy(i).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||c4.getNormalMatrix(e),s=this.coplanarPoint(SD).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}wh.prototype.isPlane=!0;const Sy=new Kc,CE=new Y;class TE{constructor(e=new wh,t=new wh,i=new wh,s=new wh,o=new wh,l=new wh){this.planes=[e,t,i,s,o,l]}set(e,t,i,s,o,l){const u=this.planes;return u[0].copy(e),u[1].copy(t),u[2].copy(i),u[3].copy(s),u[4].copy(o),u[5].copy(l),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,s=i[0],o=i[1],l=i[2],u=i[3],f=i[4],m=i[5],y=i[6],v=i[7],x=i[8],b=i[9],E=i[10],C=i[11],A=i[12],N=i[13],F=i[14],V=i[15];return t[0].setComponents(u-s,v-f,C-x,V-A).normalize(),t[1].setComponents(u+s,v+f,C+x,V+A).normalize(),t[2].setComponents(u+o,v+m,C+b,V+N).normalize(),t[3].setComponents(u-o,v-m,C-b,V-N).normalize(),t[4].setComponents(u-l,v-y,C-E,V-F).normalize(),t[5].setComponents(u+l,v+y,C+E,V+F).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Sy.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Sy)}intersectsSprite(e){return Sy.center.set(0,0,0),Sy.radius=.7071067811865476,Sy.applyMatrix4(e.matrixWorld),this.intersectsSphere(Sy)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(CE.x=s.normal.x>0?e.max.x:e.min.x,CE.y=s.normal.y>0?e.max.y:e.min.y,CE.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(CE)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function MF(){let n=null,e=!1,t=null,i=null;function s(o,l){t(o,l),i=n.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function u4(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function l(m){return m.isInterleavedBufferAttribute&&(m=m.data),i.get(m)},remove:function u(m){m.isInterleavedBufferAttribute&&(m=m.data);const y=i.get(m);y&&(n.deleteBuffer(y.buffer),i.delete(m))},update:function f(m,y){if(m.isGLBufferAttribute){const x=i.get(m);return void((!x||x.version<m.version)&&i.set(m,{buffer:m.buffer,type:m.type,bytesPerElement:m.elementSize,version:m.version}))}m.isInterleavedBufferAttribute&&(m=m.data);const v=i.get(m);void 0===v?i.set(m,function s(m,y){const v=m.array,x=m.usage,b=n.createBuffer();let E;if(n.bindBuffer(y,b),n.bufferData(y,v,x),m.onUploadCallback(),v instanceof Float32Array)E=5126;else if(v instanceof Uint16Array)if(m.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");E=5131}else E=5123;else if(v instanceof Int16Array)E=5122;else if(v instanceof Uint32Array)E=5125;else if(v instanceof Int32Array)E=5124;else if(v instanceof Int8Array)E=5120;else if(v instanceof Uint8Array)E=5121;else{if(!(v instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+v);E=5121}return{buffer:b,type:E,bytesPerElement:v.BYTES_PER_ELEMENT,version:m.version}}(m,y)):v.version<m.version&&(function o(m,y,v){const x=y.array,b=y.updateRange;n.bindBuffer(v,m),-1===b.count?n.bufferSubData(v,0,x):(t?n.bufferSubData(v,b.offset*x.BYTES_PER_ELEMENT,x,b.offset,b.count):n.bufferSubData(v,b.offset*x.BYTES_PER_ELEMENT,x.subarray(b.offset,b.offset+b.count)),b.count=-1)}(v.buffer,m,y),v.version=m.version)}}}class Cy extends xn{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const o=e/2,l=t/2,u=Math.floor(i),f=Math.floor(s),m=u+1,y=f+1,v=e/u,x=t/f,b=[],E=[],C=[],A=[];for(let N=0;N<y;N++){const F=N*x-l;for(let V=0;V<m;V++)E.push(V*v-o,-F,0),C.push(0,0,1),A.push(V/u),A.push(1-N/f)}for(let N=0;N<f;N++)for(let F=0;F<u;F++){const k=F+m*(N+1),G=F+1+m*(N+1),ee=F+1+m*N;b.push(F+m*N,k,ee),b.push(k,G,ee)}this.setIndex(b),this.setAttribute("position",new Kt(E,3)),this.setAttribute("normal",new Kt(C,3)),this.setAttribute("uv",new Kt(A,2))}static fromJSON(e){return new Cy(e.width,e.height,e.widthSegments,e.heightSegments)}}const Ti={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Rt={common:{diffuse:{value:new Ut(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new yo},uv2Transform:{value:new yo},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new at(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ut(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ut(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new yo}},sprite:{diffuse:{value:new Ut(16777215)},opacity:{value:1},center:{value:new at(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new yo}}},Na={basic:{uniforms:zo([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.fog]),vertexShader:Ti.meshbasic_vert,fragmentShader:Ti.meshbasic_frag},lambert:{uniforms:zo([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.fog,Rt.lights,{emissive:{value:new Ut(0)}}]),vertexShader:Ti.meshlambert_vert,fragmentShader:Ti.meshlambert_frag},phong:{uniforms:zo([Rt.common,Rt.specularmap,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,Rt.lights,{emissive:{value:new Ut(0)},specular:{value:new Ut(1118481)},shininess:{value:30}}]),vertexShader:Ti.meshphong_vert,fragmentShader:Ti.meshphong_frag},standard:{uniforms:zo([Rt.common,Rt.envmap,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.roughnessmap,Rt.metalnessmap,Rt.fog,Rt.lights,{emissive:{value:new Ut(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ti.meshphysical_vert,fragmentShader:Ti.meshphysical_frag},toon:{uniforms:zo([Rt.common,Rt.aomap,Rt.lightmap,Rt.emissivemap,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.gradientmap,Rt.fog,Rt.lights,{emissive:{value:new Ut(0)}}]),vertexShader:Ti.meshtoon_vert,fragmentShader:Ti.meshtoon_frag},matcap:{uniforms:zo([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,Rt.fog,{matcap:{value:null}}]),vertexShader:Ti.meshmatcap_vert,fragmentShader:Ti.meshmatcap_frag},points:{uniforms:zo([Rt.points,Rt.fog]),vertexShader:Ti.points_vert,fragmentShader:Ti.points_frag},dashed:{uniforms:zo([Rt.common,Rt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ti.linedashed_vert,fragmentShader:Ti.linedashed_frag},depth:{uniforms:zo([Rt.common,Rt.displacementmap]),vertexShader:Ti.depth_vert,fragmentShader:Ti.depth_frag},normal:{uniforms:zo([Rt.common,Rt.bumpmap,Rt.normalmap,Rt.displacementmap,{opacity:{value:1}}]),vertexShader:Ti.meshnormal_vert,fragmentShader:Ti.meshnormal_frag},sprite:{uniforms:zo([Rt.sprite,Rt.fog]),vertexShader:Ti.sprite_vert,fragmentShader:Ti.sprite_frag},background:{uniforms:{uvTransform:{value:new yo},t2D:{value:null}},vertexShader:Ti.background_vert,fragmentShader:Ti.background_frag},cube:{uniforms:zo([Rt.envmap,{opacity:{value:1}}]),vertexShader:Ti.cube_vert,fragmentShader:Ti.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ti.equirect_vert,fragmentShader:Ti.equirect_frag},distanceRGBA:{uniforms:zo([Rt.common,Rt.displacementmap,{referencePosition:{value:new Y},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ti.distanceRGBA_vert,fragmentShader:Ti.distanceRGBA_frag},shadow:{uniforms:zo([Rt.lights,Rt.fog,{color:{value:new Ut(0)},opacity:{value:1}}]),vertexShader:Ti.shadow_vert,fragmentShader:Ti.shadow_frag}};function oW(n,e,t,i,s,o){const l=new Ut(0);let f,m,u=!0===s?0:1,y=null,v=0,x=null;function E(C,A){t.buffers.color.setClear(C.r,C.g,C.b,A,o)}return{getClearColor:function(){return l},setClearColor:function(C,A=1){l.set(C),u=A,E(l,u)},getClearAlpha:function(){return u},setClearAlpha:function(C){u=C,E(l,u)},render:function b(C,A){let N=!1,F=!0===A.isScene?A.background:null;F&&F.isTexture&&(F=e.get(F));const V=n.xr,k=V.getSession&&V.getSession();k&&"additive"===k.environmentBlendMode&&(F=null),null===F?E(l,u):F&&F.isColor&&(E(F,1),N=!0),(n.autoClear||N)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),F&&(F.isCubeTexture||306===F.mapping)?(void 0===m&&(m=new Hs(new am(1,1,1),new Il({name:"BackgroundCubeMaterial",uniforms:wy(Na.cube.uniforms),vertexShader:Na.cube.vertexShader,fragmentShader:Na.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),m.geometry.deleteAttribute("normal"),m.geometry.deleteAttribute("uv"),m.onBeforeRender=function(G,ee,oe){this.matrixWorld.copyPosition(oe.matrixWorld)},Object.defineProperty(m.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(m)),m.material.uniforms.envMap.value=F,m.material.uniforms.flipEnvMap.value=F.isCubeTexture&&!1===F.isRenderTargetTexture?-1:1,(y!==F||v!==F.version||x!==n.toneMapping)&&(m.material.needsUpdate=!0,y=F,v=F.version,x=n.toneMapping),C.unshift(m,m.geometry,m.material,0,0,null)):F&&F.isTexture&&(void 0===f&&(f=new Hs(new Cy(2,2),new Il({name:"BackgroundMaterial",uniforms:wy(Na.background.uniforms),vertexShader:Na.background.vertexShader,fragmentShader:Na.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(f)),f.material.uniforms.t2D.value=F,!0===F.matrixAutoUpdate&&F.updateMatrix(),f.material.uniforms.uvTransform.value.copy(F.matrix),(y!==F||v!==F.version||x!==n.toneMapping)&&(f.material.needsUpdate=!0,y=F,v=F.version,x=n.toneMapping),C.unshift(f,f.geometry,f.material,0,0,null))}}}function aW(n,e,t,i){const s=n.getParameter(34921),o=i.isWebGL2?null:e.get("OES_vertex_array_object"),l=i.isWebGL2||null!==o,u={},f=A(null);let m=f,y=!1;function b(_e){return i.isWebGL2?n.bindVertexArray(_e):o.bindVertexArrayOES(_e)}function E(_e){return i.isWebGL2?n.deleteVertexArray(_e):o.deleteVertexArrayOES(_e)}function A(_e){const Le=[],Te=[],We=[];for(let be=0;be<s;be++)Le[be]=0,Te[be]=0,We[be]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Le,enabledAttributes:Te,attributeDivisors:We,object:_e,attributes:{},index:null}}function V(){const _e=m.newAttributes;for(let Le=0,Te=_e.length;Le<Te;Le++)_e[Le]=0}function k(_e){G(_e,0)}function G(_e,Le){const We=m.enabledAttributes,be=m.attributeDivisors;m.newAttributes[_e]=1,0===We[_e]&&(n.enableVertexAttribArray(_e),We[_e]=1),be[_e]!==Le&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](_e,Le),be[_e]=Le)}function ee(){const _e=m.newAttributes,Le=m.enabledAttributes;for(let Te=0,We=Le.length;Te<We;Te++)Le[Te]!==_e[Te]&&(n.disableVertexAttribArray(Te),Le[Te]=0)}function oe(_e,Le,Te,We,be,ot){!0!==i.isWebGL2||5124!==Te&&5125!==Te?n.vertexAttribPointer(_e,Le,Te,We,be,ot):n.vertexAttribIPointer(_e,Le,Te,be,ot)}function le(){Ze(),y=!0,m!==f&&(m=f,b(m.object))}function Ze(){f.geometry=null,f.program=null,f.wireframe=!1}return{setup:function v(_e,Le,Te,We,be){let ot=!1;if(l){const ht=function C(_e,Le,Te){const We=!0===Te.wireframe;let be=u[_e.id];void 0===be&&(be={},u[_e.id]=be);let ot=be[Le.id];void 0===ot&&(ot={},be[Le.id]=ot);let ht=ot[We];return void 0===ht&&(ht=A(function x(){return i.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}()),ot[We]=ht),ht}(We,Te,Le);m!==ht&&(m=ht,b(m.object)),ot=function N(_e,Le){const Te=m.attributes,We=_e.attributes;let be=0;for(const ot in We){const ht=Te[ot],bt=We[ot];if(void 0===ht||ht.attribute!==bt||ht.data!==bt.data)return!0;be++}return m.attributesNum!==be||m.index!==Le}(We,be),ot&&function F(_e,Le){const Te={},We=_e.attributes;let be=0;for(const ot in We){const ht=We[ot],bt={};bt.attribute=ht,ht.data&&(bt.data=ht.data),Te[ot]=bt,be++}m.attributes=Te,m.attributesNum=be,m.index=Le}(We,be)}else{const ht=!0===Le.wireframe;(m.geometry!==We.id||m.program!==Te.id||m.wireframe!==ht)&&(m.geometry=We.id,m.program=Te.id,m.wireframe=ht,ot=!0)}!0===_e.isInstancedMesh&&(ot=!0),null!==be&&t.update(be,34963),(ot||y)&&(y=!1,function ue(_e,Le,Te,We){if(!1===i.isWebGL2&&(_e.isInstancedMesh||We.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;V();const be=We.attributes,ot=Te.getAttributes(),ht=Le.defaultAttributeValues;for(const bt in ot){const mt=ot[bt];if(mt.location>=0){let _n=be[bt];if(void 0===_n&&("instanceMatrix"===bt&&_e.instanceMatrix&&(_n=_e.instanceMatrix),"instanceColor"===bt&&_e.instanceColor&&(_n=_e.instanceColor)),void 0!==_n){const vi=_n.normalized,Yn=_n.itemSize,nt=t.get(_n);if(void 0===nt)continue;const sr=nt.buffer,hi=nt.type,di=nt.bytesPerElement;if(_n.isInterleavedBufferAttribute){const It=_n.data,Ai=It.stride,et=_n.offset;if(It.isInstancedInterleavedBuffer){for(let ct=0;ct<mt.locationSize;ct++)G(mt.location+ct,It.meshPerAttribute);!0!==_e.isInstancedMesh&&void 0===We._maxInstanceCount&&(We._maxInstanceCount=It.meshPerAttribute*It.count)}else for(let ct=0;ct<mt.locationSize;ct++)k(mt.location+ct);n.bindBuffer(34962,sr);for(let ct=0;ct<mt.locationSize;ct++)oe(mt.location+ct,Yn/mt.locationSize,hi,vi,Ai*di,(et+Yn/mt.locationSize*ct)*di)}else{if(_n.isInstancedBufferAttribute){for(let It=0;It<mt.locationSize;It++)G(mt.location+It,_n.meshPerAttribute);!0!==_e.isInstancedMesh&&void 0===We._maxInstanceCount&&(We._maxInstanceCount=_n.meshPerAttribute*_n.count)}else for(let It=0;It<mt.locationSize;It++)k(mt.location+It);n.bindBuffer(34962,sr);for(let It=0;It<mt.locationSize;It++)oe(mt.location+It,Yn/mt.locationSize,hi,vi,Yn*di,Yn/mt.locationSize*It*di)}}else if(void 0!==ht){const vi=ht[bt];if(void 0!==vi)switch(vi.length){case 2:n.vertexAttrib2fv(mt.location,vi);break;case 3:n.vertexAttrib3fv(mt.location,vi);break;case 4:n.vertexAttrib4fv(mt.location,vi);break;default:n.vertexAttrib1fv(mt.location,vi)}}}}ee()}(_e,Le,Te,We),null!==be&&n.bindBuffer(34963,t.get(be).buffer))},reset:le,resetDefaultState:Ze,dispose:function Pe(){le();for(const _e in u){const Le=u[_e];for(const Te in Le){const We=Le[Te];for(const be in We)E(We[be].object),delete We[be];delete Le[Te]}delete u[_e]}},releaseStatesOfGeometry:function ye(_e){if(void 0===u[_e.id])return;const Le=u[_e.id];for(const Te in Le){const We=Le[Te];for(const be in We)E(We[be].object),delete We[be];delete Le[Te]}delete u[_e.id]},releaseStatesOfProgram:function q(_e){for(const Le in u){const Te=u[Le];if(void 0===Te[_e.id])continue;const We=Te[_e.id];for(const be in We)E(We[be].object),delete We[be];delete Te[_e.id]}},initAttributes:V,enableAttribute:k,disableUnusedAttributes:ee}}function lW(n,e,t,i){const s=i.isWebGL2;let o;this.setMode=function l(m){o=m},this.render=function u(m,y){n.drawArrays(o,m,y),t.update(y,o,1)},this.renderInstances=function f(m,y,v){if(0===v)return;let x,b;if(s)x=n,b="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),b="drawArraysInstancedANGLE",null===x)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");x[b](o,m,y,v),t.update(y,o,v)}}function cW(n,e,t){let i;function o(oe){if("highp"===oe){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";oe="mediump"}return"mediump"===oe&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const l="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&n instanceof WebGL2ComputeRenderingContext;let u=void 0!==t.precision?t.precision:"highp";const f=o(u);f!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",f,"instead."),u=f);const m=l||e.has("WEBGL_draw_buffers"),y=!0===t.logarithmicDepthBuffer,v=n.getParameter(34930),x=n.getParameter(35660),b=n.getParameter(3379),E=n.getParameter(34076),C=n.getParameter(34921),A=n.getParameter(36347),N=n.getParameter(36348),F=n.getParameter(36349),V=x>0,k=l||e.has("OES_texture_float");return{isWebGL2:l,drawBuffers:m,getMaxAnisotropy:function s(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const oe=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(oe.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,precision:u,logarithmicDepthBuffer:y,maxTextures:v,maxVertexTextures:x,maxTextureSize:b,maxCubemapSize:E,maxAttributes:C,maxVertexUniforms:A,maxVaryings:N,maxFragmentUniforms:F,vertexTextures:V,floatFragmentTextures:k,floatVertexTextures:V&&k,maxSamples:l?n.getParameter(36183):0}}function uW(n){const e=this;let t=null,i=0,s=!1,o=!1;const l=new wh,u=new yo,f={value:null,needsUpdate:!1};function m(){f.value!==t&&(f.value=t,f.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function y(v,x,b,E){const C=null!==v?v.length:0;let A=null;if(0!==C){if(A=f.value,!0!==E||null===A){const N=b+4*C,F=x.matrixWorldInverse;u.getNormalMatrix(F),(null===A||A.length<N)&&(A=new Float32Array(N));for(let V=0,k=b;V!==C;++V,k+=4)l.copy(v[V]).applyMatrix4(F,u),l.normal.toArray(A,k),A[k+3]=l.constant}f.value=A,f.needsUpdate=!0}return e.numPlanes=C,e.numIntersection=0,A}this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(v,x,b){const E=0!==v.length||x||0!==i||s;return s=x,t=y(v,b,0),i=v.length,E},this.beginShadows=function(){o=!0,y(null)},this.endShadows=function(){o=!1,m()},this.setState=function(v,x,b){const E=v.clippingPlanes,C=v.clipIntersection,A=v.clipShadows,N=n.get(v);if(!s||null===E||0===E.length||o&&!A)o?y(null):m();else{const F=o?0:i,V=4*F;let k=N.clippingState||null;f.value=k,k=y(E,x,V,b);for(let G=0;G!==V;++G)k[G]=t[G];N.clippingState=k,this.numIntersection=C?this.numPlanes:0,this.numPlanes+=F}}}function hW(n){let e=new WeakMap;function t(l,u){return 303===u?l.mapping=301:304===u&&(l.mapping=302),l}function s(l){const u=l.target;u.removeEventListener("dispose",s);const f=e.get(u);void 0!==f&&(e.delete(u),f.dispose())}return{get:function i(l){if(l&&l.isTexture&&!1===l.isRenderTargetTexture){const u=l.mapping;if(303===u||304===u){if(e.has(l))return t(e.get(l).texture,l.mapping);{const f=l.image;if(f&&f.height>0){const m=new wF(f.height/2);return m.fromEquirectangularTexture(n,l),e.set(l,m),l.addEventListener("dispose",s),t(m.texture,l.mapping)}return null}}}return l},dispose:function o(){e=new WeakMap}}}Na.physical={uniforms:zo([Na.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new at(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Ut(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new at},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ut(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ut(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ti.meshphysical_vert,fragmentShader:Ti.meshphysical_frag};class AE extends SE{constructor(e=-1,t=1,i=1,s=-1,o=.1,l=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=o,this.far=l,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,o,l){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=o,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=i-e,l=i+e,u=s+t,f=s-t;if(null!==this.view&&this.view.enabled){const m=(this.right-this.left)/this.view.fullWidth/this.zoom,y=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=m*this.view.offsetX,l=o+m*this.view.width,u-=y*this.view.offsetY,f=u-y*this.view.height}this.projectionMatrix.makeOrthographic(o,l,u,f,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}AE.prototype.isOrthographicCamera=!0;const EF=[.125,.215,.35,.446,.526,.582],CD=new AE,SF=new Ut;let TD=null;const cm=(1+Math.sqrt(5))/2,Ay=1/cm,CF=[new Y(1,1,1),new Y(-1,1,1),new Y(1,1,-1),new Y(-1,1,-1),new Y(0,cm,Ay),new Y(0,cm,-Ay),new Y(Ay,0,cm),new Y(-Ay,0,cm),new Y(cm,Ay,0),new Y(-cm,Ay,0)];class TF{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){TD=this._renderer.getRenderTarget(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,s,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=RF(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=DF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(TD),e.scissorTest=!1,DE(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),TD=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,i={magFilter:Bs,minFilter:Bs,generateMipmaps:!1,type:ry,format:Rl,encoding:mh,depthBuffer:!1},s=AF(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=AF(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function dW(n){const e=[],t=[],i=[];let s=n;const o=n-4+1+EF.length;for(let l=0;l<o;l++){const u=Math.pow(2,s);t.push(u);let f=1/u;l>n-4?f=EF[l-n+4-1]:0===l&&(f=0),i.push(f);const m=1/(u-1),y=-m/2,v=1+m/2,x=[y,y,v,y,v,v,y,y,v,v,y,v],b=6,E=6,C=3,A=2,N=1,F=new Float32Array(C*E*b),V=new Float32Array(A*E*b),k=new Float32Array(N*E*b);for(let ee=0;ee<b;ee++){const oe=ee%3*2/3-1,ue=ee>2?0:-1;F.set([oe,ue,0,oe+2/3,ue,0,oe+2/3,ue+1,0,oe,ue,0,oe+2/3,ue+1,0,oe,ue+1,0],C*E*ee),V.set(x,A*E*ee),k.set([ee,ee,ee,ee,ee,ee],N*E*ee)}const G=new xn;G.setAttribute("position",new Cr(F,C)),G.setAttribute("uv",new Cr(V,A)),G.setAttribute("faceIndex",new Cr(k,N)),e.push(G),s>4&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(o)),this._blurMaterial=function fW(n,e,t){const i=new Float32Array(20),s=new Y(0,1,0);return new Il({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(o,e,t)}return s}_compileMaterial(e){const t=new Hs(this._lodPlanes[0],e);this._renderer.compile(t,CD)}_sceneToCubeUV(e,t,i,s){const u=new vo(90,1,t,i),f=[1,-1,1,1,1,1],m=[1,1,1,-1,-1,-1],y=this._renderer,v=y.autoClear,x=y.toneMapping;y.getClearColor(SF),y.toneMapping=0,y.autoClear=!1;const b=new $c({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),E=new Hs(new am,b);let C=!1;const A=e.background;A?A.isColor&&(b.color.copy(A),e.background=null,C=!0):(b.color.copy(SF),C=!0);for(let N=0;N<6;N++){const F=N%3;0===F?(u.up.set(0,f[N],0),u.lookAt(m[N],0,0)):1===F?(u.up.set(0,0,f[N]),u.lookAt(0,m[N],0)):(u.up.set(0,f[N],0),u.lookAt(0,0,m[N]));const V=this._cubeSize;DE(s,F*V,N>2?V:0,V,V),y.setRenderTarget(s),C&&y.render(E,u),y.render(e,u)}E.geometry.dispose(),E.material.dispose(),y.toneMapping=x,y.autoClear=v,e.background=A}_textureToCubeUV(e,t){const i=this._renderer,s=301===e.mapping||302===e.mapping;s?(null===this._cubemapMaterial&&(this._cubemapMaterial=RF()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=DF());const o=s?this._cubemapMaterial:this._equirectMaterial,l=new Hs(this._lodPlanes[0],o);o.uniforms.envMap.value=e;const f=this._cubeSize;DE(t,0,0,3*f,2*f),i.setRenderTarget(t),i.render(l,CD)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]);this._blur(e,s-1,s,o,CF[(s-1)%CF.length])}t.autoClear=i}_blur(e,t,i,s,o){const l=this._pingPongRenderTarget;this._halfBlur(e,l,t,i,s,"latitudinal",o),this._halfBlur(l,e,i,i,s,"longitudinal",o)}_halfBlur(e,t,i,s,o,l,u){const f=this._renderer,m=this._blurMaterial;"latitudinal"!==l&&"longitudinal"!==l&&console.error("blur direction must be either latitudinal or longitudinal!");const v=new Hs(this._lodPlanes[s],m),x=m.uniforms,b=this._sizeLods[i]-1,E=isFinite(o)?Math.PI/(2*b):2*Math.PI/39,C=o/E,A=isFinite(o)?1+Math.floor(3*C):20;A>20&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${A} samples when the maximum is set to 20`);const N=[];let F=0;for(let oe=0;oe<20;++oe){const ue=oe/C,Pe=Math.exp(-ue*ue/2);N.push(Pe),0===oe?F+=Pe:oe<A&&(F+=2*Pe)}for(let oe=0;oe<N.length;oe++)N[oe]=N[oe]/F;x.envMap.value=e.texture,x.samples.value=A,x.weights.value=N,x.latitudinal.value="latitudinal"===l,u&&(x.poleAxis.value=u);const{_lodMax:V}=this;x.dTheta.value=E,x.mipInt.value=V-i;const k=this._sizeLods[s];DE(t,3*k*(s>V-4?s-V+4:0),4*(this._cubeSize-k),3*k,2*k),f.setRenderTarget(t),f.render(v,CD)}}function AF(n,e,t){const i=new Ja(n,e,t);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function DE(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function DF(){return new Il({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function RF(){return new Il({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function pW(n){let e=new WeakMap,t=null;function o(u){const f=u.target;f.removeEventListener("dispose",o);const m=e.get(f);void 0!==m&&(e.delete(f),m.dispose())}return{get:function i(u){if(u&&u.isTexture){const f=u.mapping,m=303===f||304===f,y=301===f||302===f;if(m||y){if(u.isRenderTargetTexture&&!0===u.needsPMREMUpdate){u.needsPMREMUpdate=!1;let v=e.get(u);return null===t&&(t=new TF(n)),v=m?t.fromEquirectangular(u,v):t.fromCubemap(u,v),e.set(u,v),v.texture}if(e.has(u))return e.get(u).texture;{const v=u.image;if(m&&v&&v.height>0||y&&v&&function s(u){let f=0;for(let y=0;y<6;y++)void 0!==u[y]&&f++;return 6===f}(v)){null===t&&(t=new TF(n));const x=m?t.fromEquirectangular(u):t.fromCubemap(u);return e.set(u,x),u.addEventListener("dispose",o),x.texture}return null}}}return u},dispose:function l(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function mW(n){const e={};function t(i){if(void 0!==e[i])return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const s=t(i);return null===s&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function gW(n,e,t,i){const s={},o=new WeakMap;function l(v){const x=v.target;null!==x.index&&e.remove(x.index);for(const E in x.attributes)e.remove(x.attributes[E]);x.removeEventListener("dispose",l),delete s[x.id];const b=o.get(x);b&&(e.remove(b),o.delete(x)),i.releaseStatesOfGeometry(x),!0===x.isInstancedBufferGeometry&&delete x._maxInstanceCount,t.memory.geometries--}function m(v){const x=[],b=v.index,E=v.attributes.position;let C=0;if(null!==b){const F=b.array;C=b.version;for(let V=0,k=F.length;V<k;V+=3){const G=F[V+0],ee=F[V+1],oe=F[V+2];x.push(G,ee,ee,oe,oe,G)}}else{C=E.version;for(let V=0,k=E.array.length/3-1;V<k;V+=3){const G=V+0,ee=V+1,oe=V+2;x.push(G,ee,ee,oe,oe,G)}}const A=new(aF(x)?xF:vF)(x,1);A.version=C;const N=o.get(v);N&&e.remove(N),o.set(v,A)}return{get:function u(v,x){return!0===s[x.id]||(x.addEventListener("dispose",l),s[x.id]=!0,t.memory.geometries++),x},update:function f(v){const x=v.attributes;for(const E in x)e.update(x[E],34962);const b=v.morphAttributes;for(const E in b){const C=b[E];for(let A=0,N=C.length;A<N;A++)e.update(C[A],34962)}},getWireframeAttribute:function y(v){const x=o.get(v);if(x){const b=v.index;null!==b&&x.version<b.version&&m(v)}else m(v);return o.get(v)}}}function yW(n,e,t,i){const s=i.isWebGL2;let o,u,f;this.setMode=function l(x){o=x},this.setIndex=function m(x){u=x.type,f=x.bytesPerElement},this.render=function y(x,b){n.drawElements(o,b,u,x*f),t.update(b,o,1)},this.renderInstances=function v(x,b,E){if(0===E)return;let C,A;if(s)C=n,A="drawElementsInstanced";else if(C=e.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",null===C)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");C[A](o,b,u,x*f,E),t.update(b,o,E)}}function _W(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(o,l,u){switch(t.calls++,l){case 4:t.triangles+=u*(o/3);break;case 1:t.lines+=u*(o/2);break;case 3:t.lines+=u*(o-1);break;case 2:t.lines+=u*o;break;case 0:t.points+=u*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l)}}}}function vW(n,e){return n[0]-e[0]}function xW(n,e){return Math.abs(e[1])-Math.abs(n[1])}function DD(n,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),n.divideScalar(t)}function bW(n,e,t){const i={},s=new Float32Array(8),o=new WeakMap,l=new Wi,u=[];for(let m=0;m<8;m++)u[m]=[m,0];return{update:function f(m,y,v,x){const b=m.morphTargetInfluences;if(!0===e.isWebGL2){const E=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,C=void 0!==E?E.length:0;let A=o.get(y);if(void 0===A||A.count!==C){let Le=function(){Ze.dispose(),o.delete(y),y.removeEventListener("dispose",Le)};void 0!==A&&A.texture.dispose();const V=void 0!==y.morphAttributes.position,k=void 0!==y.morphAttributes.normal,G=void 0!==y.morphAttributes.color,ee=y.morphAttributes.position||[],oe=y.morphAttributes.normal||[],ue=y.morphAttributes.color||[];let Pe=0;!0===V&&(Pe=1),!0===k&&(Pe=2),!0===G&&(Pe=3);let ye=y.attributes.position.count*Pe,q=1;ye>e.maxTextureSize&&(q=Math.ceil(ye/e.maxTextureSize),ye=e.maxTextureSize);const le=new Float32Array(ye*q*4*C),Ze=new lE(le,ye,q,C);Ze.type=Gd,Ze.needsUpdate=!0;const _e=4*Pe;for(let Te=0;Te<C;Te++){const We=ee[Te],be=oe[Te],ot=ue[Te],ht=ye*q*4*Te;for(let bt=0;bt<We.count;bt++){const mt=bt*_e;!0===V&&(l.fromBufferAttribute(We,bt),!0===We.normalized&&DD(l,We),le[ht+mt+0]=l.x,le[ht+mt+1]=l.y,le[ht+mt+2]=l.z,le[ht+mt+3]=0),!0===k&&(l.fromBufferAttribute(be,bt),!0===be.normalized&&DD(l,be),le[ht+mt+4]=l.x,le[ht+mt+5]=l.y,le[ht+mt+6]=l.z,le[ht+mt+7]=0),!0===G&&(l.fromBufferAttribute(ot,bt),!0===ot.normalized&&DD(l,ot),le[ht+mt+8]=l.x,le[ht+mt+9]=l.y,le[ht+mt+10]=l.z,le[ht+mt+11]=4===ot.itemSize?l.w:1)}}A={count:C,texture:Ze,size:new at(ye,q)},o.set(y,A),y.addEventListener("dispose",Le)}let N=0;for(let V=0;V<b.length;V++)N+=b[V];const F=y.morphTargetsRelative?1:1-N;x.getUniforms().setValue(n,"morphTargetBaseInfluence",F),x.getUniforms().setValue(n,"morphTargetInfluences",b),x.getUniforms().setValue(n,"morphTargetsTexture",A.texture,t),x.getUniforms().setValue(n,"morphTargetsTextureSize",A.size)}else{const E=void 0===b?0:b.length;let C=i[y.id];if(void 0===C||C.length!==E){C=[];for(let k=0;k<E;k++)C[k]=[k,0];i[y.id]=C}for(let k=0;k<E;k++){const G=C[k];G[0]=k,G[1]=b[k]}C.sort(xW);for(let k=0;k<8;k++)k<E&&C[k][1]?(u[k][0]=C[k][0],u[k][1]=C[k][1]):(u[k][0]=Number.MAX_SAFE_INTEGER,u[k][1]=0);u.sort(vW);const A=y.morphAttributes.position,N=y.morphAttributes.normal;let F=0;for(let k=0;k<8;k++){const G=u[k],ee=G[0],oe=G[1];ee!==Number.MAX_SAFE_INTEGER&&oe?(A&&y.getAttribute("morphTarget"+k)!==A[ee]&&y.setAttribute("morphTarget"+k,A[ee]),N&&y.getAttribute("morphNormal"+k)!==N[ee]&&y.setAttribute("morphNormal"+k,N[ee]),s[k]=oe,F+=oe):(A&&!0===y.hasAttribute("morphTarget"+k)&&y.deleteAttribute("morphTarget"+k),N&&!0===y.hasAttribute("morphNormal"+k)&&y.deleteAttribute("morphNormal"+k),s[k]=0)}const V=y.morphTargetsRelative?1:1-F;x.getUniforms().setValue(n,"morphTargetBaseInfluence",V),x.getUniforms().setValue(n,"morphTargetInfluences",s)}}}}function wW(n,e,t,i){let s=new WeakMap;function u(f){const m=f.target;m.removeEventListener("dispose",u),t.remove(m.instanceMatrix),null!==m.instanceColor&&t.remove(m.instanceColor)}return{update:function o(f){const m=i.render.frame,v=e.get(f,f.geometry);return s.get(v)!==m&&(e.update(v),s.set(v,m)),f.isInstancedMesh&&(!1===f.hasEventListener("dispose",u)&&f.addEventListener("dispose",u),t.update(f.instanceMatrix,34962),null!==f.instanceColor&&t.update(f.instanceColor,34962)),v},dispose:function l(){s=new WeakMap}}}const PF=new Fa,IF=new lE,LF=new rD,FF=new q0,NF=[],OF=[],BF=new Float32Array(16),kF=new Float32Array(9),VF=new Float32Array(4);function Dy(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let o=NF[s];if(void 0===o&&(o=new Float32Array(s),NF[s]=o),0!==e){i.toArray(o,0);for(let l=1,u=0;l!==e;++l)u+=t,n[l].toArray(o,u)}return o}function sa(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ho(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function RE(n,e){let t=OF[e];void 0===t&&(t=new Int32Array(e),OF[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function MW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function EW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(sa(t,e))return;n.uniform2fv(this.addr,e),Ho(t,e)}}function SW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(sa(t,e))return;n.uniform3fv(this.addr,e),Ho(t,e)}}function CW(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(sa(t,e))return;n.uniform4fv(this.addr,e),Ho(t,e)}}function TW(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(sa(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ho(t,e)}else{if(sa(t,i))return;VF.set(i),n.uniformMatrix2fv(this.addr,!1,VF),Ho(t,i)}}function AW(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(sa(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ho(t,e)}else{if(sa(t,i))return;kF.set(i),n.uniformMatrix3fv(this.addr,!1,kF),Ho(t,i)}}function DW(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(sa(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ho(t,e)}else{if(sa(t,i))return;BF.set(i),n.uniformMatrix4fv(this.addr,!1,BF),Ho(t,i)}}function RW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function PW(n,e){const t=this.cache;sa(t,e)||(n.uniform2iv(this.addr,e),Ho(t,e))}function IW(n,e){const t=this.cache;sa(t,e)||(n.uniform3iv(this.addr,e),Ho(t,e))}function LW(n,e){const t=this.cache;sa(t,e)||(n.uniform4iv(this.addr,e),Ho(t,e))}function FW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function NW(n,e){const t=this.cache;sa(t,e)||(n.uniform2uiv(this.addr,e),Ho(t,e))}function OW(n,e){const t=this.cache;sa(t,e)||(n.uniform3uiv(this.addr,e),Ho(t,e))}function BW(n,e){const t=this.cache;sa(t,e)||(n.uniform4uiv(this.addr,e),Ho(t,e))}function kW(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2D(e||PF,s)}function VW(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||LF,s)}function UW(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||FF,s)}function zW(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||IF,s)}function GW(n,e){n.uniform1fv(this.addr,e)}function WW(n,e){const t=Dy(e,this.size,2);n.uniform2fv(this.addr,t)}function qW(n,e){const t=Dy(e,this.size,3);n.uniform3fv(this.addr,t)}function jW(n,e){const t=Dy(e,this.size,4);n.uniform4fv(this.addr,t)}function XW(n,e){const t=Dy(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function YW(n,e){const t=Dy(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function KW(n,e){const t=Dy(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function $W(n,e){n.uniform1iv(this.addr,e)}function ZW(n,e){n.uniform2iv(this.addr,e)}function JW(n,e){n.uniform3iv(this.addr,e)}function QW(n,e){n.uniform4iv(this.addr,e)}function e8(n,e){n.uniform1uiv(this.addr,e)}function t8(n,e){n.uniform2uiv(this.addr,e)}function n8(n,e){n.uniform3uiv(this.addr,e)}function i8(n,e){n.uniform4uiv(this.addr,e)}function r8(n,e,t){const i=e.length,s=RE(t,i);n.uniform1iv(this.addr,s);for(let o=0;o!==i;++o)t.setTexture2D(e[o]||PF,s[o])}function s8(n,e,t){const i=e.length,s=RE(t,i);n.uniform1iv(this.addr,s);for(let o=0;o!==i;++o)t.setTexture3D(e[o]||LF,s[o])}function o8(n,e,t){const i=e.length,s=RE(t,i);n.uniform1iv(this.addr,s);for(let o=0;o!==i;++o)t.setTextureCube(e[o]||FF,s[o])}function a8(n,e,t){const i=e.length,s=RE(t,i);n.uniform1iv(this.addr,s);for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||IF,s[o])}function c8(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=function HW(n){switch(n){case 5126:return MW;case 35664:return EW;case 35665:return SW;case 35666:return CW;case 35674:return TW;case 35675:return AW;case 35676:return DW;case 5124:case 35670:return RW;case 35667:case 35671:return PW;case 35668:case 35672:return IW;case 35669:case 35673:return LW;case 5125:return FW;case 36294:return NW;case 36295:return OW;case 36296:return BW;case 35678:case 36198:case 36298:case 36306:case 35682:return kW;case 35679:case 36299:case 36307:return VW;case 35680:case 36300:case 36308:case 36293:return UW;case 36289:case 36303:case 36311:case 36292:return zW}}(e.type)}function UF(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function l8(n){switch(n){case 5126:return GW;case 35664:return WW;case 35665:return qW;case 35666:return jW;case 35674:return XW;case 35675:return YW;case 35676:return KW;case 5124:case 35670:return $W;case 35667:case 35671:return ZW;case 35668:case 35672:return JW;case 35669:case 35673:return QW;case 5125:return e8;case 36294:return t8;case 36295:return n8;case 36296:return i8;case 35678:case 36198:case 36298:case 36306:case 35682:return r8;case 35679:case 36299:case 36307:return s8;case 35680:case 36300:case 36308:case 36293:return o8;case 36289:case 36303:case 36311:case 36292:return a8}}(e.type)}function zF(n){this.id=n,this.seq=[],this.map={}}UF.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),Ho(e,n)},zF.prototype.setValue=function(n,e,t){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const l=i[s];l.setValue(n,e[l.id],t)}};const RD=/(\w+)(\])?(\[|\.)?/g;function HF(n,e){n.seq.push(e),n.map[e.id]=e}function u8(n,e,t){const i=n.name,s=i.length;for(RD.lastIndex=0;;){const o=RD.exec(i),l=RD.lastIndex;let u=o[1];const m=o[3];if("]"===o[2]&&(u|=0),void 0===m||"["===m&&l+2===s){HF(t,void 0===m?new c8(u,n,e):new UF(u,n,e));break}{let v=t.map[u];void 0===v&&(v=new zF(u),HF(t,v)),t=v}}}function ef(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){const s=n.getActiveUniform(e,i);u8(s,n.getUniformLocation(e,s.name),this)}}function GF(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}ef.prototype.setValue=function(n,e,t,i){const s=this.map[e];void 0!==s&&s.setValue(n,t,i)},ef.prototype.setOptional=function(n,e,t){const i=e[t];void 0!==i&&this.setValue(n,t,i)},ef.upload=function(n,e,t,i){for(let s=0,o=e.length;s!==o;++s){const l=e[s],u=t[l.id];!1!==u.needsUpdate&&l.setValue(n,u.value,i)}},ef.seqWithValue=function(n,e){const t=[];for(let i=0,s=n.length;i!==s;++i){const o=n[i];o.id in e&&t.push(o)}return t};let h8=0;function WF(n,e,t){const i=n.getShaderParameter(e,35713),s=n.getShaderInfoLog(e).trim();if(i&&""===s)return"";const o=parseInt(/ERROR: 0:(\d+)/.exec(s)[1]);return t.toUpperCase()+"\n\n"+s+"\n\n"+function d8(n,e){const t=n.split("\n"),i=[],s=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let l=s;l<o;l++)i.push(l+1+": "+t[l]);return i.join("\n")}(n.getShaderSource(e),o)}function p8(n,e){const t=function f8(n){switch(n){case mh:return["Linear","( value )"];case qr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function m8(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function j0(n){return""!==n}function qF(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function jF(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const v8=/^[ \t]*#include +<([\w\d./]+)>/gm;function PD(n){return n.replace(v8,x8)}function x8(n,e){const t=Ti[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return PD(t)}const b8=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,w8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function XF(n){return n.replace(w8,YF).replace(b8,M8)}function M8(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),YF(0,e,t,i)}function YF(n,e,t,i){let s="";for(let o=parseInt(e);o<parseInt(t);o++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function KF(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function D8(n,e,t,i){const s=n.getContext(),o=t.defines;let l=t.vertexShader,u=t.fragmentShader;const f=function E8(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),m=function S8(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),y=function C8(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),v=function T8(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),x=function A8(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e/32+1)+3,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),b=t.isWebGL2?"":function g8(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(j0).join("\n")}(t),E=function y8(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(o),C=s.createProgram();let A,N,F=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(A=[E].filter(j0).join("\n"),A.length>0&&(A+="\n"),N=[b,E].filter(j0).join("\n"),N.length>0&&(N+="\n")):(A=[KF(t),"#define SHADER_NAME "+t.shaderName,E,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+y:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+f:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(j0).join("\n"),N=[b,KF(t),"#define SHADER_NAME "+t.shaderName,E,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+m:"",t.envMap?"#define "+y:"",t.envMap?"#define "+v:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+f:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?Ti.tonemapping_pars_fragment:"",0!==t.toneMapping?m8("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ti.encodings_pars_fragment,p8("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(j0).join("\n")),l=PD(l),l=qF(l,t),l=jF(l,t),u=PD(u),u=qF(u,t),u=jF(u,t),l=XF(l),u=XF(u),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(F="#version 300 es\n",A=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+A,N=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+N);const k=F+N+u,G=GF(s,35633,F+A+l),ee=GF(s,35632,k);if(s.attachShader(C,G),s.attachShader(C,ee),void 0!==t.index0AttributeName?s.bindAttribLocation(C,0,t.index0AttributeName):!0===t.morphTargets&&s.bindAttribLocation(C,0,"position"),s.linkProgram(C),n.debug.checkShaderErrors){const Pe=s.getProgramInfoLog(C).trim(),ye=s.getShaderInfoLog(G).trim(),q=s.getShaderInfoLog(ee).trim();let le=!0,Ze=!0;if(!1===s.getProgramParameter(C,35714)){le=!1;const _e=WF(s,G,"vertex"),Le=WF(s,ee,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(C,35715)+"\n\nProgram Info Log: "+Pe+"\n"+_e+"\n"+Le)}else""!==Pe?console.warn("THREE.WebGLProgram: Program Info Log:",Pe):(""===ye||""===q)&&(Ze=!1);Ze&&(this.diagnostics={runnable:le,programLog:Pe,vertexShader:{log:ye,prefix:A},fragmentShader:{log:q,prefix:N}})}let oe,ue;return s.deleteShader(G),s.deleteShader(ee),this.getUniforms=function(){return void 0===oe&&(oe=new ef(s,C)),oe},this.getAttributes=function(){return void 0===ue&&(ue=function _8(n,e){const t={},i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const o=n.getActiveAttrib(e,s),l=o.name;let u=1;35674===o.type&&(u=2),35675===o.type&&(u=3),35676===o.type&&(u=4),t[l]={type:o.type,location:n.getAttribLocation(e,l),locationSize:u}}return t}(s,C)),ue},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(C),this.program=void 0},this.name=t.shaderName,this.id=h8++,this.cacheKey=e,this.usedTimes=1,this.program=C,this.vertexShader=G,this.fragmentShader=ee,this}let R8=0;class P8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,s=this._getShaderStage(e.vertexShader),o=this._getShaderStage(i),l=this._getShaderCacheForMaterial(e);return!1===l.has(s)&&(l.add(s),s.usedTimes++),!1===l.has(o)&&(l.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const i=new I8(e);t.set(e,i)}return t.get(e)}}class I8{constructor(e){this.id=R8++,this.code=e,this.usedTimes=0}}function L8(n,e,t,i,s,o,l){const u=new dD,f=new P8,m=[],y=s.isWebGL2,v=s.logarithmicDepthBuffer,x=s.floatVertexTextures,b=s.maxVertexUniforms,E=s.vertexTextures;let C=s.precision;const A={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function F(q,le,Ze,_e,Le){const Te=_e.fog,We=Le.geometry,ot=(q.isMeshStandardMaterial?t:e).get(q.envMap||(q.isMeshStandardMaterial?_e.environment:null)),ht=ot&&306===ot.mapping?ot.image.height:null,bt=A[q.type],mt=Le.isSkinnedMesh?function N(q){const Ze=q.skeleton.bones;if(x)return 1024;{const Le=Math.floor((b-20)/4),Te=Math.min(Le,Ze.length);return Te<Ze.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Ze.length+" bones. This GPU supports "+Te+"."),0):Te}}(Le):0;null!==q.precision&&(C=s.getMaxPrecision(q.precision),C!==q.precision&&console.warn("THREE.WebGLProgram.getParameters:",q.precision,"not supported, using",C,"instead."));const _n=We.morphAttributes.position||We.morphAttributes.normal||We.morphAttributes.color,vi=void 0!==_n?_n.length:0;let nt,sr,hi,di,Yn=0;if(void 0!==We.morphAttributes.position&&(Yn=1),void 0!==We.morphAttributes.normal&&(Yn=2),void 0!==We.morphAttributes.color&&(Yn=3),bt){const wt=Na[bt];nt=wt.vertexShader,sr=wt.fragmentShader}else nt=q.vertexShader,sr=q.fragmentShader,f.update(q),hi=f.getVertexShaderID(q),di=f.getFragmentShaderID(q);const It=n.getRenderTarget(),et=q.clearcoat>0;return{isWebGL2:y,shaderID:bt,shaderName:q.type,vertexShader:nt,fragmentShader:sr,defines:q.defines,customVertexShaderID:hi,customFragmentShaderID:di,isRawShaderMaterial:!0===q.isRawShaderMaterial,glslVersion:q.glslVersion,precision:C,instancing:!0===Le.isInstancedMesh,instancingColor:!0===Le.isInstancedMesh&&null!==Le.instanceColor,supportsVertexTextures:E,outputEncoding:null===It?n.outputEncoding:!0===It.isXRRenderTarget?It.texture.encoding:mh,map:!!q.map,matcap:!!q.matcap,envMap:!!ot,envMapMode:ot&&ot.mapping,envMapCubeUVHeight:ht,lightMap:!!q.lightMap,aoMap:!!q.aoMap,emissiveMap:!!q.emissiveMap,bumpMap:!!q.bumpMap,normalMap:!!q.normalMap,objectSpaceNormalMap:1===q.normalMapType,tangentSpaceNormalMap:0===q.normalMapType,decodeVideoTexture:!!q.map&&!0===q.map.isVideoTexture&&q.map.encoding===qr,clearcoat:et,clearcoatMap:et&&!!q.clearcoatMap,clearcoatRoughnessMap:et&&!!q.clearcoatRoughnessMap,clearcoatNormalMap:et&&!!q.clearcoatNormalMap,displacementMap:!!q.displacementMap,roughnessMap:!!q.roughnessMap,metalnessMap:!!q.metalnessMap,specularMap:!!q.specularMap,specularIntensityMap:!!q.specularIntensityMap,specularColorMap:!!q.specularColorMap,opaque:!1===q.transparent&&1===q.blending,alphaMap:!!q.alphaMap,alphaTest:q.alphaTest>0,gradientMap:!!q.gradientMap,sheen:q.sheen>0,sheenColorMap:!!q.sheenColorMap,sheenRoughnessMap:!!q.sheenRoughnessMap,transmission:q.transmission>0,transmissionMap:!!q.transmissionMap,thicknessMap:!!q.thicknessMap,combine:q.combine,vertexTangents:!!q.normalMap&&!!We.attributes.tangent,vertexColors:q.vertexColors,vertexAlphas:!0===q.vertexColors&&!!We.attributes.color&&4===We.attributes.color.itemSize,vertexUvs:!!(q.map||q.bumpMap||q.normalMap||q.specularMap||q.alphaMap||q.emissiveMap||q.roughnessMap||q.metalnessMap||q.clearcoatMap||q.clearcoatRoughnessMap||q.clearcoatNormalMap||q.displacementMap||q.transmissionMap||q.thicknessMap||q.specularIntensityMap||q.specularColorMap||q.sheenColorMap||q.sheenRoughnessMap),uvsVertexOnly:!(q.map||q.bumpMap||q.normalMap||q.specularMap||q.alphaMap||q.emissiveMap||q.roughnessMap||q.metalnessMap||q.clearcoatNormalMap||q.transmission>0||q.transmissionMap||q.thicknessMap||q.specularIntensityMap||q.specularColorMap||q.sheen>0||q.sheenColorMap||q.sheenRoughnessMap||!q.displacementMap),fog:!!Te,useFog:q.fog,fogExp2:Te&&Te.isFogExp2,flatShading:!!q.flatShading,sizeAttenuation:q.sizeAttenuation,logarithmicDepthBuffer:v,skinning:!0===Le.isSkinnedMesh&&mt>0,maxBones:mt,useVertexTexture:x,morphTargets:void 0!==We.morphAttributes.position,morphNormals:void 0!==We.morphAttributes.normal,morphColors:void 0!==We.morphAttributes.color,morphTargetsCount:vi,morphTextureStride:Yn,numDirLights:le.directional.length,numPointLights:le.point.length,numSpotLights:le.spot.length,numRectAreaLights:le.rectArea.length,numHemiLights:le.hemi.length,numDirLightShadows:le.directionalShadowMap.length,numPointLightShadows:le.pointShadowMap.length,numSpotLightShadows:le.spotShadowMap.length,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:q.dithering,shadowMapEnabled:n.shadowMap.enabled&&Ze.length>0,shadowMapType:n.shadowMap.type,toneMapping:q.toneMapped?n.toneMapping:0,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:q.premultipliedAlpha,doubleSided:2===q.side,flipSided:1===q.side,depthPacking:void 0!==q.depthPacking&&q.depthPacking,index0AttributeName:q.index0AttributeName,extensionDerivatives:q.extensions&&q.extensions.derivatives,extensionFragDepth:q.extensions&&q.extensions.fragDepth,extensionDrawBuffers:q.extensions&&q.extensions.drawBuffers,extensionShaderTextureLOD:q.extensions&&q.extensions.shaderTextureLOD,rendererExtensionFragDepth:y||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:y||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:y||i.has("EXT_shader_texture_lod"),customProgramCacheKey:q.customProgramCacheKey()}},getProgramCacheKey:function V(q){const le=[];if(q.shaderID?le.push(q.shaderID):(le.push(q.customVertexShaderID),le.push(q.customFragmentShaderID)),void 0!==q.defines)for(const Ze in q.defines)le.push(Ze),le.push(q.defines[Ze]);return!1===q.isRawShaderMaterial&&(function k(q,le){q.push(le.precision),q.push(le.outputEncoding),q.push(le.envMapMode),q.push(le.envMapCubeUVHeight),q.push(le.combine),q.push(le.vertexUvs),q.push(le.fogExp2),q.push(le.sizeAttenuation),q.push(le.maxBones),q.push(le.morphTargetsCount),q.push(le.morphAttributeCount),q.push(le.numDirLights),q.push(le.numPointLights),q.push(le.numSpotLights),q.push(le.numHemiLights),q.push(le.numRectAreaLights),q.push(le.numDirLightShadows),q.push(le.numPointLightShadows),q.push(le.numSpotLightShadows),q.push(le.shadowMapType),q.push(le.toneMapping),q.push(le.numClippingPlanes),q.push(le.numClipIntersection)}(le,q),function G(q,le){u.disableAll(),le.isWebGL2&&u.enable(0),le.supportsVertexTextures&&u.enable(1),le.instancing&&u.enable(2),le.instancingColor&&u.enable(3),le.map&&u.enable(4),le.matcap&&u.enable(5),le.envMap&&u.enable(6),le.lightMap&&u.enable(7),le.aoMap&&u.enable(8),le.emissiveMap&&u.enable(9),le.bumpMap&&u.enable(10),le.normalMap&&u.enable(11),le.objectSpaceNormalMap&&u.enable(12),le.tangentSpaceNormalMap&&u.enable(13),le.clearcoat&&u.enable(14),le.clearcoatMap&&u.enable(15),le.clearcoatRoughnessMap&&u.enable(16),le.clearcoatNormalMap&&u.enable(17),le.displacementMap&&u.enable(18),le.specularMap&&u.enable(19),le.roughnessMap&&u.enable(20),le.metalnessMap&&u.enable(21),le.gradientMap&&u.enable(22),le.alphaMap&&u.enable(23),le.alphaTest&&u.enable(24),le.vertexColors&&u.enable(25),le.vertexAlphas&&u.enable(26),le.vertexUvs&&u.enable(27),le.vertexTangents&&u.enable(28),le.uvsVertexOnly&&u.enable(29),le.fog&&u.enable(30),q.push(u.mask),u.disableAll(),le.useFog&&u.enable(0),le.flatShading&&u.enable(1),le.logarithmicDepthBuffer&&u.enable(2),le.skinning&&u.enable(3),le.useVertexTexture&&u.enable(4),le.morphTargets&&u.enable(5),le.morphNormals&&u.enable(6),le.morphColors&&u.enable(7),le.premultipliedAlpha&&u.enable(8),le.shadowMapEnabled&&u.enable(9),le.physicallyCorrectLights&&u.enable(10),le.doubleSided&&u.enable(11),le.flipSided&&u.enable(12),le.depthPacking&&u.enable(13),le.dithering&&u.enable(14),le.specularIntensityMap&&u.enable(15),le.specularColorMap&&u.enable(16),le.transmission&&u.enable(17),le.transmissionMap&&u.enable(18),le.thicknessMap&&u.enable(19),le.sheen&&u.enable(20),le.sheenColorMap&&u.enable(21),le.sheenRoughnessMap&&u.enable(22),le.decodeVideoTexture&&u.enable(23),le.opaque&&u.enable(24),q.push(u.mask)}(le,q),le.push(n.outputEncoding)),le.push(q.customProgramCacheKey),le.join()},getUniforms:function ee(q){const le=A[q.type];let Ze;return Ze=le?MD.clone(Na[le].uniforms):q.uniforms,Ze},acquireProgram:function oe(q,le){let Ze;for(let _e=0,Le=m.length;_e<Le;_e++){const Te=m[_e];if(Te.cacheKey===le){Ze=Te,++Ze.usedTimes;break}}return void 0===Ze&&(Ze=new D8(n,le,q,o),m.push(Ze)),Ze},releaseProgram:function ue(q){if(0==--q.usedTimes){const le=m.indexOf(q);m[le]=m[m.length-1],m.pop(),q.destroy()}},releaseShaderCache:function Pe(q){f.remove(q)},programs:m,dispose:function ye(){f.dispose()}}}function F8(){let n=new WeakMap;return{get:function e(o){let l=n.get(o);return void 0===l&&(l={},n.set(o,l)),l},remove:function t(o){n.delete(o)},update:function i(o,l,u){n.get(o)[l]=u},dispose:function s(){n=new WeakMap}}}function N8(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function $F(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function ZF(){const n=[];let e=0;const t=[],i=[],s=[];function l(v,x,b,E,C,A){let N=n[e];return void 0===N?(N={id:v.id,object:v,geometry:x,material:b,groupOrder:E,renderOrder:v.renderOrder,z:C,group:A},n[e]=N):(N.id=v.id,N.object=v,N.geometry=x,N.material=b,N.groupOrder=E,N.renderOrder=v.renderOrder,N.z=C,N.group=A),e++,N}return{opaque:t,transmissive:i,transparent:s,init:function o(){e=0,t.length=0,i.length=0,s.length=0},push:function u(v,x,b,E,C,A){const N=l(v,x,b,E,C,A);b.transmission>0?i.push(N):!0===b.transparent?s.push(N):t.push(N)},unshift:function f(v,x,b,E,C,A){const N=l(v,x,b,E,C,A);b.transmission>0?i.unshift(N):!0===b.transparent?s.unshift(N):t.unshift(N)},finish:function y(){for(let v=e,x=n.length;v<x;v++){const b=n[v];if(null===b.id)break;b.id=null,b.object=null,b.geometry=null,b.material=null,b.group=null}},sort:function m(v,x){t.length>1&&t.sort(v||N8),i.length>1&&i.sort(x||$F),s.length>1&&s.sort(x||$F)}}}function O8(){let n=new WeakMap;return{get:function e(i,s){let o;return!1===n.has(i)?(o=new ZF,n.set(i,[o])):s>=n.get(i).length?(o=new ZF,n.get(i).push(o)):o=n.get(i)[s],o},dispose:function t(){n=new WeakMap}}}function B8(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Y,color:new Ut};break;case"SpotLight":t={position:new Y,direction:new Y,color:new Ut,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Y,color:new Ut,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Y,skyColor:new Ut,groundColor:new Ut};break;case"RectAreaLight":t={color:new Ut,position:new Y,halfWidth:new Y,halfHeight:new Y}}return n[e.id]=t,t}}}let V8=0;function U8(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function z8(n,e){const t=new B8,i=function k8(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let y=0;y<9;y++)s.probe.push(new Y);const o=new Y,l=new Ft,u=new Ft;return{setup:function f(y,v){let x=0,b=0,E=0;for(let Pe=0;Pe<9;Pe++)s.probe[Pe].set(0,0,0);let C=0,A=0,N=0,F=0,V=0,k=0,G=0,ee=0;y.sort(U8);const oe=!0!==v?Math.PI:1;for(let Pe=0,ye=y.length;Pe<ye;Pe++){const q=y[Pe],le=q.color,Ze=q.intensity,_e=q.distance,Le=q.shadow&&q.shadow.map?q.shadow.map.texture:null;if(q.isAmbientLight)x+=le.r*Ze*oe,b+=le.g*Ze*oe,E+=le.b*Ze*oe;else if(q.isLightProbe)for(let Te=0;Te<9;Te++)s.probe[Te].addScaledVector(q.sh.coefficients[Te],Ze);else if(q.isDirectionalLight){const Te=t.get(q);if(Te.color.copy(q.color).multiplyScalar(q.intensity*oe),q.castShadow){const We=q.shadow,be=i.get(q);be.shadowBias=We.bias,be.shadowNormalBias=We.normalBias,be.shadowRadius=We.radius,be.shadowMapSize=We.mapSize,s.directionalShadow[C]=be,s.directionalShadowMap[C]=Le,s.directionalShadowMatrix[C]=q.shadow.matrix,k++}s.directional[C]=Te,C++}else if(q.isSpotLight){const Te=t.get(q);if(Te.position.setFromMatrixPosition(q.matrixWorld),Te.color.copy(le).multiplyScalar(Ze*oe),Te.distance=_e,Te.coneCos=Math.cos(q.angle),Te.penumbraCos=Math.cos(q.angle*(1-q.penumbra)),Te.decay=q.decay,q.castShadow){const We=q.shadow,be=i.get(q);be.shadowBias=We.bias,be.shadowNormalBias=We.normalBias,be.shadowRadius=We.radius,be.shadowMapSize=We.mapSize,s.spotShadow[N]=be,s.spotShadowMap[N]=Le,s.spotShadowMatrix[N]=q.shadow.matrix,ee++}s.spot[N]=Te,N++}else if(q.isRectAreaLight){const Te=t.get(q);Te.color.copy(le).multiplyScalar(Ze),Te.halfWidth.set(.5*q.width,0,0),Te.halfHeight.set(0,.5*q.height,0),s.rectArea[F]=Te,F++}else if(q.isPointLight){const Te=t.get(q);if(Te.color.copy(q.color).multiplyScalar(q.intensity*oe),Te.distance=q.distance,Te.decay=q.decay,q.castShadow){const We=q.shadow,be=i.get(q);be.shadowBias=We.bias,be.shadowNormalBias=We.normalBias,be.shadowRadius=We.radius,be.shadowMapSize=We.mapSize,be.shadowCameraNear=We.camera.near,be.shadowCameraFar=We.camera.far,s.pointShadow[A]=be,s.pointShadowMap[A]=Le,s.pointShadowMatrix[A]=q.shadow.matrix,G++}s.point[A]=Te,A++}else if(q.isHemisphereLight){const Te=t.get(q);Te.skyColor.copy(q.color).multiplyScalar(Ze*oe),Te.groundColor.copy(q.groundColor).multiplyScalar(Ze*oe),s.hemi[V]=Te,V++}}F>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(s.rectAreaLTC1=Rt.LTC_FLOAT_1,s.rectAreaLTC2=Rt.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=Rt.LTC_HALF_1,s.rectAreaLTC2=Rt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=x,s.ambient[1]=b,s.ambient[2]=E;const ue=s.hash;(ue.directionalLength!==C||ue.pointLength!==A||ue.spotLength!==N||ue.rectAreaLength!==F||ue.hemiLength!==V||ue.numDirectionalShadows!==k||ue.numPointShadows!==G||ue.numSpotShadows!==ee)&&(s.directional.length=C,s.spot.length=N,s.rectArea.length=F,s.point.length=A,s.hemi.length=V,s.directionalShadow.length=k,s.directionalShadowMap.length=k,s.pointShadow.length=G,s.pointShadowMap.length=G,s.spotShadow.length=ee,s.spotShadowMap.length=ee,s.directionalShadowMatrix.length=k,s.pointShadowMatrix.length=G,s.spotShadowMatrix.length=ee,ue.directionalLength=C,ue.pointLength=A,ue.spotLength=N,ue.rectAreaLength=F,ue.hemiLength=V,ue.numDirectionalShadows=k,ue.numPointShadows=G,ue.numSpotShadows=ee,s.version=V8++)},setupView:function m(y,v){let x=0,b=0,E=0,C=0,A=0;const N=v.matrixWorldInverse;for(let F=0,V=y.length;F<V;F++){const k=y[F];if(k.isDirectionalLight){const G=s.directional[x];G.direction.setFromMatrixPosition(k.matrixWorld),o.setFromMatrixPosition(k.target.matrixWorld),G.direction.sub(o),G.direction.transformDirection(N),x++}else if(k.isSpotLight){const G=s.spot[E];G.position.setFromMatrixPosition(k.matrixWorld),G.position.applyMatrix4(N),G.direction.setFromMatrixPosition(k.matrixWorld),o.setFromMatrixPosition(k.target.matrixWorld),G.direction.sub(o),G.direction.transformDirection(N),E++}else if(k.isRectAreaLight){const G=s.rectArea[C];G.position.setFromMatrixPosition(k.matrixWorld),G.position.applyMatrix4(N),u.identity(),l.copy(k.matrixWorld),l.premultiply(N),u.extractRotation(l),G.halfWidth.set(.5*k.width,0,0),G.halfHeight.set(0,.5*k.height,0),G.halfWidth.applyMatrix4(u),G.halfHeight.applyMatrix4(u),C++}else if(k.isPointLight){const G=s.point[b];G.position.setFromMatrixPosition(k.matrixWorld),G.position.applyMatrix4(N),b++}else if(k.isHemisphereLight){const G=s.hemi[A];G.direction.setFromMatrixPosition(k.matrixWorld),G.direction.transformDirection(N),G.direction.normalize(),A++}}},state:s}}function JF(n,e){const t=new z8(n,e),i=[],s=[];return{init:function o(){i.length=0,s.length=0},state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:function f(v){t.setup(i,v)},setupLightsView:function m(v){t.setupView(i,v)},pushLight:function l(v){i.push(v)},pushShadow:function u(v){s.push(v)}}}function H8(n,e){let t=new WeakMap;return{get:function i(o,l=0){let u;return!1===t.has(o)?(u=new JF(n,e),t.set(o,[u])):l>=t.get(o).length?(u=new JF(n,e),t.get(o).push(u)):u=t.get(o)[l],u},dispose:function s(){t=new WeakMap}}}class ID extends Us{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}ID.prototype.isMeshDepthMaterial=!0;class LD extends Us{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Y,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function QF(n,e,t){let i=new TE;const s=new at,o=new at,l=new Wi,u=new ID({depthPacking:3201}),f=new LD,m={},y=t.maxTextureSize,v={0:1,1:0,2:2},x=new Il({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new at},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),b=x.clone();b.defines.HORIZONTAL_PASS=1;const E=new xn;E.setAttribute("position",new Cr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const C=new Hs(E,x),A=this;function N(k,G){const ee=e.update(C);x.defines.VSM_SAMPLES!==k.blurSamples&&(x.defines.VSM_SAMPLES=k.blurSamples,b.defines.VSM_SAMPLES=k.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0),x.uniforms.shadow_pass.value=k.map.texture,x.uniforms.resolution.value=k.mapSize,x.uniforms.radius.value=k.radius,n.setRenderTarget(k.mapPass),n.clear(),n.renderBufferDirect(G,null,ee,x,C,null),b.uniforms.shadow_pass.value=k.mapPass.texture,b.uniforms.resolution.value=k.mapSize,b.uniforms.radius.value=k.radius,n.setRenderTarget(k.map),n.clear(),n.renderBufferDirect(G,null,ee,b,C,null)}function F(k,G,ee,oe,ue,Pe){let ye=null;const q=!0===ee.isPointLight?k.customDistanceMaterial:k.customDepthMaterial;if(ye=void 0!==q?q:!0===ee.isPointLight?f:u,n.localClippingEnabled&&!0===G.clipShadows&&0!==G.clippingPlanes.length||G.displacementMap&&0!==G.displacementScale||G.alphaMap&&G.alphaTest>0){const le=ye.uuid,Ze=G.uuid;let _e=m[le];void 0===_e&&(_e={},m[le]=_e);let Le=_e[Ze];void 0===Le&&(Le=ye.clone(),_e[Ze]=Le),ye=Le}return ye.visible=G.visible,ye.wireframe=G.wireframe,ye.side=3===Pe?null!==G.shadowSide?G.shadowSide:G.side:null!==G.shadowSide?G.shadowSide:v[G.side],ye.alphaMap=G.alphaMap,ye.alphaTest=G.alphaTest,ye.clipShadows=G.clipShadows,ye.clippingPlanes=G.clippingPlanes,ye.clipIntersection=G.clipIntersection,ye.displacementMap=G.displacementMap,ye.displacementScale=G.displacementScale,ye.displacementBias=G.displacementBias,ye.wireframeLinewidth=G.wireframeLinewidth,ye.linewidth=G.linewidth,!0===ee.isPointLight&&!0===ye.isMeshDistanceMaterial&&(ye.referencePosition.setFromMatrixPosition(ee.matrixWorld),ye.nearDistance=oe,ye.farDistance=ue),ye}function V(k,G,ee,oe,ue){if(!1===k.visible)return;if(k.layers.test(G.layers)&&(k.isMesh||k.isLine||k.isPoints)&&(k.castShadow||k.receiveShadow&&3===ue)&&(!k.frustumCulled||i.intersectsObject(k))){k.modelViewMatrix.multiplyMatrices(ee.matrixWorldInverse,k.matrixWorld);const q=e.update(k),le=k.material;if(Array.isArray(le)){const Ze=q.groups;for(let _e=0,Le=Ze.length;_e<Le;_e++){const Te=Ze[_e],We=le[Te.materialIndex];if(We&&We.visible){const be=F(k,We,oe,ee.near,ee.far,ue);n.renderBufferDirect(ee,null,q,be,k,Te)}}}else if(le.visible){const Ze=F(k,le,oe,ee.near,ee.far,ue);n.renderBufferDirect(ee,null,q,Ze,k,null)}}const ye=k.children;for(let q=0,le=ye.length;q<le;q++)V(ye[q],G,ee,oe,ue)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(k,G,ee){if(!1===A.enabled||!1===A.autoUpdate&&!1===A.needsUpdate||0===k.length)return;const oe=n.getRenderTarget(),ue=n.getActiveCubeFace(),Pe=n.getActiveMipmapLevel(),ye=n.state;ye.setBlending(0),ye.buffers.color.setClear(1,1,1,1),ye.buffers.depth.setTest(!0),ye.setScissorTest(!1);for(let q=0,le=k.length;q<le;q++){const Ze=k[q],_e=Ze.shadow;if(void 0===_e){console.warn("THREE.WebGLShadowMap:",Ze,"has no shadow.");continue}if(!1===_e.autoUpdate&&!1===_e.needsUpdate)continue;s.copy(_e.mapSize);const Le=_e.getFrameExtents();s.multiply(Le),o.copy(_e.mapSize),(s.x>y||s.y>y)&&(s.x>y&&(o.x=Math.floor(y/Le.x),s.x=o.x*Le.x,_e.mapSize.x=o.x),s.y>y&&(o.y=Math.floor(y/Le.y),s.y=o.y*Le.y,_e.mapSize.y=o.y)),null===_e.map&&!_e.isPointLightShadow&&3===this.type&&(_e.map=new Ja(s.x,s.y),_e.map.texture.name=Ze.name+".shadowMap",_e.mapPass=new Ja(s.x,s.y),_e.camera.updateProjectionMatrix()),null===_e.map&&(_e.map=new Ja(s.x,s.y,{minFilter:no,magFilter:no,format:Rl}),_e.map.texture.name=Ze.name+".shadowMap",_e.camera.updateProjectionMatrix()),n.setRenderTarget(_e.map),n.clear();const Te=_e.getViewportCount();for(let We=0;We<Te;We++){const be=_e.getViewport(We);l.set(o.x*be.x,o.y*be.y,o.x*be.z,o.y*be.w),ye.viewport(l),_e.updateMatrices(Ze,We),i=_e.getFrustum(),V(G,ee,_e.camera,Ze,this.type)}!_e.isPointLightShadow&&3===this.type&&N(_e,ee),_e.needsUpdate=!1}A.needsUpdate=!1,n.setRenderTarget(oe,ue,Pe)}}function q8(n,e,t){const i=t.isWebGL2,u=new function s(){let pe=!1;const zt=new Wi;let Nt=null;const Gn=new Wi(0,0,0,0);return{setMask:function(ln){Nt!==ln&&!pe&&(n.colorMask(ln,ln,ln,ln),Nt=ln)},setLocked:function(ln){pe=ln},setClear:function(ln,Wn,Lt,ni,Or){!0===Or&&(ln*=ni,Wn*=ni,Lt*=ni),zt.set(ln,Wn,Lt,ni),!1===Gn.equals(zt)&&(n.clearColor(ln,Wn,Lt,ni),Gn.copy(zt))},reset:function(){pe=!1,Nt=null,Gn.set(-1,0,0,0)}}},f=new function o(){let pe=!1,zt=null,Nt=null,Gn=null;return{setTest:function(ln){ln?Yn(2929):nt(2929)},setMask:function(ln){zt!==ln&&!pe&&(n.depthMask(ln),zt=ln)},setFunc:function(ln){if(Nt!==ln){if(ln)switch(ln){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}else n.depthFunc(515);Nt=ln}},setLocked:function(ln){pe=ln},setClear:function(ln){Gn!==ln&&(n.clearDepth(ln),Gn=ln)},reset:function(){pe=!1,zt=null,Nt=null,Gn=null}}},m=new function l(){let pe=!1,zt=null,Nt=null,Gn=null,ln=null,Wn=null,Lt=null,ni=null,Or=null;return{setTest:function(zi){pe||(zi?Yn(2960):nt(2960))},setMask:function(zi){zt!==zi&&!pe&&(n.stencilMask(zi),zt=zi)},setFunc:function(zi,au,lu){(Nt!==zi||Gn!==au||ln!==lu)&&(n.stencilFunc(zi,au,lu),Nt=zi,Gn=au,ln=lu)},setOp:function(zi,au,lu){(Wn!==zi||Lt!==au||ni!==lu)&&(n.stencilOp(zi,au,lu),Wn=zi,Lt=au,ni=lu)},setLocked:function(zi){pe=zi},setClear:function(zi){Or!==zi&&(n.clearStencil(zi),Or=zi)},reset:function(){pe=!1,zt=null,Nt=null,Gn=null,ln=null,Wn=null,Lt=null,ni=null,Or=null}}};let y={},v={},x=new WeakMap,b=[],E=null,C=!1,A=null,N=null,F=null,V=null,k=null,G=null,ee=null,oe=!1,ue=null,Pe=null,ye=null,q=null,le=null;const Ze=n.getParameter(35661);let _e=!1,Le=0;const Te=n.getParameter(7938);-1!==Te.indexOf("WebGL")?(Le=parseFloat(/^WebGL (\d)/.exec(Te)[1]),_e=Le>=1):-1!==Te.indexOf("OpenGL ES")&&(Le=parseFloat(/^OpenGL ES (\d)/.exec(Te)[1]),_e=Le>=2);let We=null,be={};const ot=n.getParameter(3088),ht=n.getParameter(2978),bt=(new Wi).fromArray(ot),mt=(new Wi).fromArray(ht);function _n(pe,zt,Nt){const Gn=new Uint8Array(4),ln=n.createTexture();n.bindTexture(pe,ln),n.texParameteri(pe,10241,9728),n.texParameteri(pe,10240,9728);for(let Wn=0;Wn<Nt;Wn++)n.texImage2D(zt+Wn,0,6408,1,1,0,6408,5121,Gn);return ln}const vi={};function Yn(pe){!0!==y[pe]&&(n.enable(pe),y[pe]=!0)}function nt(pe){!1!==y[pe]&&(n.disable(pe),y[pe]=!1)}vi[3553]=_n(3553,3553,1),vi[34067]=_n(34067,34069,6),u.setClear(0,0,0,1),f.setClear(1),m.setClear(0),Yn(2929),f.setFunc(3),wt(!1),un(1),Yn(2884),et(0);const It={100:32774,101:32778,102:32779};if(i)It[103]=32775,It[104]=32776;else{const pe=e.get("EXT_blend_minmax");null!==pe&&(It[103]=pe.MIN_EXT,It[104]=pe.MAX_EXT)}const Ai={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function et(pe,zt,Nt,Gn,ln,Wn,Lt,ni){if(0!==pe){if(!1===C&&(Yn(3042),C=!0),5===pe)ln=ln||zt,Wn=Wn||Nt,Lt=Lt||Gn,(zt!==N||ln!==k)&&(n.blendEquationSeparate(It[zt],It[ln]),N=zt,k=ln),(Nt!==F||Gn!==V||Wn!==G||Lt!==ee)&&(n.blendFuncSeparate(Ai[Nt],Ai[Gn],Ai[Wn],Ai[Lt]),F=Nt,V=Gn,G=Wn,ee=Lt),A=pe,oe=null;else if(pe!==A||ni!==oe){if((100!==N||100!==k)&&(n.blendEquation(32774),N=100,k=100),ni)switch(pe){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}else switch(pe){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}F=null,V=null,G=null,ee=null,A=pe,oe=ni}}else!0===C&&(nt(3042),C=!1)}function wt(pe){ue!==pe&&(n.frontFace(pe?2304:2305),ue=pe)}function un(pe){0!==pe?(Yn(2884),pe!==Pe&&n.cullFace(1===pe?1029:2===pe?1028:1032)):nt(2884),Pe=pe}function si(pe,zt,Nt){pe?(Yn(32823),(q!==zt||le!==Nt)&&(n.polygonOffset(zt,Nt),q=zt,le=Nt)):nt(32823)}function An(pe){void 0===pe&&(pe=33984+Ze-1),We!==pe&&(n.activeTexture(pe),We=pe)}return{buffers:{color:u,depth:f,stencil:m},enable:Yn,disable:nt,bindFramebuffer:function sr(pe,zt){return v[pe]!==zt&&(n.bindFramebuffer(pe,zt),v[pe]=zt,i&&(36009===pe&&(v[36160]=zt),36160===pe&&(v[36009]=zt)),!0)},drawBuffers:function hi(pe,zt){let Nt=b,Gn=!1;if(pe)if(Nt=x.get(zt),void 0===Nt&&(Nt=[],x.set(zt,Nt)),pe.isWebGLMultipleRenderTargets){const ln=pe.texture;if(Nt.length!==ln.length||36064!==Nt[0]){for(let Wn=0,Lt=ln.length;Wn<Lt;Wn++)Nt[Wn]=36064+Wn;Nt.length=ln.length,Gn=!0}}else 36064!==Nt[0]&&(Nt[0]=36064,Gn=!0);else 1029!==Nt[0]&&(Nt[0]=1029,Gn=!0);Gn&&(t.isWebGL2?n.drawBuffers(Nt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Nt))},useProgram:function di(pe){return E!==pe&&(n.useProgram(pe),E=pe,!0)},setBlending:et,setMaterial:function ct(pe,zt){2===pe.side?nt(2884):Yn(2884);let Nt=1===pe.side;zt&&(Nt=!Nt),wt(Nt),1===pe.blending&&!1===pe.transparent?et(0):et(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.premultipliedAlpha),f.setFunc(pe.depthFunc),f.setTest(pe.depthTest),f.setMask(pe.depthWrite),u.setMask(pe.colorWrite);const Gn=pe.stencilWrite;m.setTest(Gn),Gn&&(m.setMask(pe.stencilWriteMask),m.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),m.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),si(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),!0===pe.alphaToCoverage?Yn(32926):nt(32926)},setFlipSided:wt,setCullFace:un,setLineWidth:function jt(pe){pe!==ye&&(_e&&n.lineWidth(pe),ye=pe)},setPolygonOffset:si,setScissorTest:function kn(pe){pe?Yn(3089):nt(3089)},activeTexture:An,bindTexture:function Qr(pe,zt){null===We&&An();let Nt=be[We];void 0===Nt&&(Nt={type:void 0,texture:void 0},be[We]=Nt),(Nt.type!==pe||Nt.texture!==zt)&&(n.bindTexture(pe,zt||vi[pe]),Nt.type=pe,Nt.texture=zt)},unbindTexture:function xr(){const pe=be[We];void 0!==pe&&void 0!==pe.type&&(n.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)},compressedTexImage2D:function re(){try{n.compressedTexImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage2D:function On(){try{n.texImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage3D:function Ye(){try{n.texImage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texStorage2D:function qt(){try{n.texStorage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texStorage3D:function nn(){try{n.texStorage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage2D:function Z(){try{n.texSubImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage3D:function qe(){try{n.texSubImage3D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexSubImage2D:function yt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},scissor:function fi(pe){!1===bt.equals(pe)&&(n.scissor(pe.x,pe.y,pe.z,pe.w),bt.copy(pe))},viewport:function xi(pe){!1===mt.equals(pe)&&(n.viewport(pe.x,pe.y,pe.z,pe.w),mt.copy(pe))},reset:function hn(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),y={},We=null,be={},v={},x=new WeakMap,b=[],E=null,C=!1,A=null,N=null,F=null,V=null,k=null,G=null,ee=null,oe=!1,ue=null,Pe=null,ye=null,q=null,le=null,bt.set(0,0,n.canvas.width,n.canvas.height),mt.set(0,0,n.canvas.width,n.canvas.height),u.reset(),f.reset(),m.reset()}}}function j8(n,e,t,i,s,o,l){const u=s.isWebGL2,f=s.maxTextures,m=s.maxCubemapSize,y=s.maxTextureSize,v=s.maxSamples,x=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,b=/OculusBrowser/g.test(navigator.userAgent),E=new WeakMap;let C;const A=new WeakMap;let N=!1;try{N="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(re){}function F(re,Z){return N?new OffscreenCanvas(re,Z):z0("canvas")}function V(re,Z,qe,yt){let qt=1;if((re.width>yt||re.height>yt)&&(qt=yt/Math.max(re.width,re.height)),qt<1||!0===Z){if("undefined"!=typeof HTMLImageElement&&re instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&re instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&re instanceof ImageBitmap){const nn=Z?rE:Math.floor,On=nn(qt*re.width),Ye=nn(qt*re.height);void 0===C&&(C=F(On,Ye));const fi=qe?F(On,Ye):C;return fi.width=On,fi.height=Ye,fi.getContext("2d").drawImage(re,0,0,On,Ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+re.width+"x"+re.height+") to ("+On+"x"+Ye+")."),fi}return"data"in re&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+re.width+"x"+re.height+")."),re}return re}function k(re){return eD(re.width)&&eD(re.height)}function ee(re,Z){return re.generateMipmaps&&Z&&re.minFilter!==no&&re.minFilter!==Bs}function oe(re){n.generateMipmap(re)}function ue(re,Z,qe,yt,qt=!1){if(!1===u)return Z;if(null!==re){if(void 0!==n[re])return n[re];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+re+"'")}let nn=Z;return 6403===Z&&(5126===qe&&(nn=33326),5131===qe&&(nn=33325),5121===qe&&(nn=33321)),33319===Z&&(5126===qe&&(nn=33328),5131===qe&&(nn=33327),5121===qe&&(nn=33323)),6408===Z&&(5126===qe&&(nn=34836),5131===qe&&(nn=34842),5121===qe&&(nn=yt===qr&&!1===qt?35907:32856),32819===qe&&(nn=32854),32820===qe&&(nn=32855)),(33325===nn||33326===nn||33327===nn||33328===nn||34842===nn||34836===nn)&&e.get("EXT_color_buffer_float"),nn}function Pe(re,Z,qe){return!0===ee(re,qe)||re.isFramebufferTexture&&re.minFilter!==no&&re.minFilter!==Bs?Math.log2(Math.max(Z.width,Z.height))+1:void 0!==re.mipmaps&&re.mipmaps.length>0?re.mipmaps.length:re.isCompressedTexture&&Array.isArray(re.image)?Z.mipmaps.length:1}function ye(re){return re===no||1004===re||1005===re?9728:9729}function q(re){const Z=re.target;Z.removeEventListener("dispose",q),function Ze(re){const Z=i.get(re);if(void 0===Z.__webglInit)return;const qe=re.source,yt=A.get(qe);if(yt){const qt=yt[Z.__cacheKey];qt.usedTimes--,0===qt.usedTimes&&_e(re),0===Object.keys(yt).length&&A.delete(qe)}i.remove(re)}(Z),Z.isVideoTexture&&E.delete(Z)}function le(re){const Z=re.target;Z.removeEventListener("dispose",le),function Le(re){const Z=re.texture,qe=i.get(re),yt=i.get(Z);if(void 0!==yt.__webglTexture&&(n.deleteTexture(yt.__webglTexture),l.memory.textures--),re.depthTexture&&re.depthTexture.dispose(),re.isWebGLCubeRenderTarget)for(let qt=0;qt<6;qt++)n.deleteFramebuffer(qe.__webglFramebuffer[qt]),qe.__webglDepthbuffer&&n.deleteRenderbuffer(qe.__webglDepthbuffer[qt]);else n.deleteFramebuffer(qe.__webglFramebuffer),qe.__webglDepthbuffer&&n.deleteRenderbuffer(qe.__webglDepthbuffer),qe.__webglMultisampledFramebuffer&&n.deleteFramebuffer(qe.__webglMultisampledFramebuffer),qe.__webglColorRenderbuffer&&n.deleteRenderbuffer(qe.__webglColorRenderbuffer),qe.__webglDepthRenderbuffer&&n.deleteRenderbuffer(qe.__webglDepthRenderbuffer);if(re.isWebGLMultipleRenderTargets)for(let qt=0,nn=Z.length;qt<nn;qt++){const On=i.get(Z[qt]);On.__webglTexture&&(n.deleteTexture(On.__webglTexture),l.memory.textures--),i.remove(Z[qt])}i.remove(Z),i.remove(re)}(Z)}function _e(re){const Z=i.get(re);n.deleteTexture(Z.__webglTexture),delete A.get(re.source)[Z.__cacheKey],l.memory.textures--}let Te=0;function ht(re,Z){const qe=i.get(re);if(re.isVideoTexture&&function Qr(re){const Z=l.render.frame;E.get(re)!==Z&&(E.set(re,Z),re.update())}(re),!1===re.isRenderTargetTexture&&re.version>0&&qe.__version!==re.version){const yt=re.image;if(null===yt)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==yt.complete)return void hi(qe,re,Z);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+Z),t.bindTexture(3553,qe.__webglTexture)}const vi={1e3:10497,[La]:33071,1002:33648},Yn={[no]:9728,1004:9984,1005:9986,[Bs]:9729,1007:9985,1008:9987};function nt(re,Z,qe){if(qe?(n.texParameteri(re,10242,vi[Z.wrapS]),n.texParameteri(re,10243,vi[Z.wrapT]),(32879===re||35866===re)&&n.texParameteri(re,32882,vi[Z.wrapR]),n.texParameteri(re,10240,Yn[Z.magFilter]),n.texParameteri(re,10241,Yn[Z.minFilter])):(n.texParameteri(re,10242,33071),n.texParameteri(re,10243,33071),(32879===re||35866===re)&&n.texParameteri(re,32882,33071),(Z.wrapS!==La||Z.wrapT!==La)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(re,10240,ye(Z.magFilter)),n.texParameteri(re,10241,ye(Z.minFilter)),Z.minFilter!==no&&Z.minFilter!==Bs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const yt=e.get("EXT_texture_filter_anisotropic");if(Z.type===Gd&&!1===e.has("OES_texture_float_linear")||!1===u&&Z.type===ry&&!1===e.has("OES_texture_half_float_linear"))return;(Z.anisotropy>1||i.get(Z).__currentAnisotropy)&&(n.texParameterf(re,yt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z.anisotropy,s.getMaxAnisotropy())),i.get(Z).__currentAnisotropy=Z.anisotropy)}}function sr(re,Z){let qe=!1;void 0===re.__webglInit&&(re.__webglInit=!0,Z.addEventListener("dispose",q));const yt=Z.source;let qt=A.get(yt);void 0===qt&&(qt={},A.set(yt,qt));const nn=function ot(re){const Z=[];return Z.push(re.wrapS),Z.push(re.wrapT),Z.push(re.magFilter),Z.push(re.minFilter),Z.push(re.anisotropy),Z.push(re.internalFormat),Z.push(re.format),Z.push(re.type),Z.push(re.generateMipmaps),Z.push(re.premultiplyAlpha),Z.push(re.flipY),Z.push(re.unpackAlignment),Z.push(re.encoding),Z.join()}(Z);if(nn!==re.__cacheKey){void 0===qt[nn]&&(qt[nn]={texture:n.createTexture(),usedTimes:0},l.memory.textures++,qe=!0),qt[nn].usedTimes++;const On=qt[re.__cacheKey];void 0!==On&&(qt[re.__cacheKey].usedTimes--,0===On.usedTimes&&_e(Z)),re.__cacheKey=nn,re.__webglTexture=qt[nn].texture}return qe}function hi(re,Z,qe){let yt=3553;Z.isDataArrayTexture&&(yt=35866),Z.isData3DTexture&&(yt=32879);const qt=sr(re,Z),nn=Z.source;if(t.activeTexture(33984+qe),t.bindTexture(yt,re.__webglTexture),nn.version!==nn.__currentVersion||!0===qt){n.pixelStorei(37440,Z.flipY),n.pixelStorei(37441,Z.premultiplyAlpha),n.pixelStorei(3317,Z.unpackAlignment),n.pixelStorei(37443,0);const On=function G(re){return!u&&(re.wrapS!==La||re.wrapT!==La||re.minFilter!==no&&re.minFilter!==Bs)}(Z)&&!1===k(Z.image);let Ye=V(Z.image,On,!1,y);Ye=xr(Z,Ye);const fi=k(Ye)||u,xi=o.convert(Z.format,Z.encoding);let zt,hn=o.convert(Z.type),pe=ue(Z.internalFormat,xi,hn,Z.encoding,Z.isVideoTexture);nt(yt,Z,fi);const Nt=Z.mipmaps,Gn=u&&!0!==Z.isVideoTexture,ln=void 0===re.__version,Wn=Pe(Z,Ye,fi);if(Z.isDepthTexture)pe=6402,u?pe=Z.type===Gd?36012:1014===Z.type?33190:Z.type===sy?35056:33189:Z.type===Gd&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Z.format===Qp&&6402===pe&&Z.type!==O0&&1014!==Z.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Z.type=O0,hn=o.convert(Z.type)),Z.format===oy&&6402===pe&&(pe=34041,Z.type!==sy&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Z.type=sy,hn=o.convert(Z.type))),Gn&&ln?t.texStorage2D(3553,1,pe,Ye.width,Ye.height):t.texImage2D(3553,0,pe,Ye.width,Ye.height,0,xi,hn,null);else if(Z.isDataTexture)if(Nt.length>0&&fi){Gn&&ln&&t.texStorage2D(3553,Wn,pe,Nt[0].width,Nt[0].height);for(let Lt=0,ni=Nt.length;Lt<ni;Lt++)zt=Nt[Lt],Gn?t.texSubImage2D(3553,Lt,0,0,zt.width,zt.height,xi,hn,zt.data):t.texImage2D(3553,Lt,pe,zt.width,zt.height,0,xi,hn,zt.data);Z.generateMipmaps=!1}else Gn?(ln&&t.texStorage2D(3553,Wn,pe,Ye.width,Ye.height),t.texSubImage2D(3553,0,0,0,Ye.width,Ye.height,xi,hn,Ye.data)):t.texImage2D(3553,0,pe,Ye.width,Ye.height,0,xi,hn,Ye.data);else if(Z.isCompressedTexture){Gn&&ln&&t.texStorage2D(3553,Wn,pe,Nt[0].width,Nt[0].height);for(let Lt=0,ni=Nt.length;Lt<ni;Lt++)zt=Nt[Lt],Z.format!==Rl?null!==xi?Gn?t.compressedTexSubImage2D(3553,Lt,0,0,zt.width,zt.height,xi,zt.data):t.compressedTexImage2D(3553,Lt,pe,zt.width,zt.height,0,zt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Gn?t.texSubImage2D(3553,Lt,0,0,zt.width,zt.height,xi,hn,zt.data):t.texImage2D(3553,Lt,pe,zt.width,zt.height,0,xi,hn,zt.data)}else if(Z.isDataArrayTexture)Gn?(ln&&t.texStorage3D(35866,Wn,pe,Ye.width,Ye.height,Ye.depth),t.texSubImage3D(35866,0,0,0,0,Ye.width,Ye.height,Ye.depth,xi,hn,Ye.data)):t.texImage3D(35866,0,pe,Ye.width,Ye.height,Ye.depth,0,xi,hn,Ye.data);else if(Z.isData3DTexture)Gn?(ln&&t.texStorage3D(32879,Wn,pe,Ye.width,Ye.height,Ye.depth),t.texSubImage3D(32879,0,0,0,0,Ye.width,Ye.height,Ye.depth,xi,hn,Ye.data)):t.texImage3D(32879,0,pe,Ye.width,Ye.height,Ye.depth,0,xi,hn,Ye.data);else if(Z.isFramebufferTexture)Gn&&ln?t.texStorage2D(3553,Wn,pe,Ye.width,Ye.height):t.texImage2D(3553,0,pe,Ye.width,Ye.height,0,xi,hn,null);else if(Nt.length>0&&fi){Gn&&ln&&t.texStorage2D(3553,Wn,pe,Nt[0].width,Nt[0].height);for(let Lt=0,ni=Nt.length;Lt<ni;Lt++)zt=Nt[Lt],Gn?t.texSubImage2D(3553,Lt,0,0,xi,hn,zt):t.texImage2D(3553,Lt,pe,xi,hn,zt);Z.generateMipmaps=!1}else Gn?(ln&&t.texStorage2D(3553,Wn,pe,Ye.width,Ye.height),t.texSubImage2D(3553,0,0,0,xi,hn,Ye)):t.texImage2D(3553,0,pe,xi,hn,Ye);ee(Z,fi)&&oe(yt),nn.__currentVersion=nn.version,Z.onUpdate&&Z.onUpdate(Z)}re.__version=Z.version}function It(re,Z,qe,yt,qt){const nn=o.convert(qe.format,qe.encoding),On=o.convert(qe.type),Ye=ue(qe.internalFormat,nn,On,qe.encoding);i.get(Z).__hasExternalTextures||(32879===qt||35866===qt?t.texImage3D(qt,0,Ye,Z.width,Z.height,Z.depth,0,nn,On,null):t.texImage2D(qt,0,Ye,Z.width,Z.height,0,nn,On,null)),t.bindFramebuffer(36160,re),An(Z)?x.framebufferTexture2DMultisampleEXT(36160,yt,qt,i.get(qe).__webglTexture,0,kn(Z)):n.framebufferTexture2D(36160,yt,qt,i.get(qe).__webglTexture,0),t.bindFramebuffer(36160,null)}function Ai(re,Z,qe){if(n.bindRenderbuffer(36161,re),Z.depthBuffer&&!Z.stencilBuffer){let yt=33189;if(qe||An(Z)){const qt=Z.depthTexture;qt&&qt.isDepthTexture&&(qt.type===Gd?yt=36012:1014===qt.type&&(yt=33190));const nn=kn(Z);An(Z)?x.renderbufferStorageMultisampleEXT(36161,nn,yt,Z.width,Z.height):n.renderbufferStorageMultisample(36161,nn,yt,Z.width,Z.height)}else n.renderbufferStorage(36161,yt,Z.width,Z.height);n.framebufferRenderbuffer(36160,36096,36161,re)}else if(Z.depthBuffer&&Z.stencilBuffer){const yt=kn(Z);qe&&!1===An(Z)?n.renderbufferStorageMultisample(36161,yt,35056,Z.width,Z.height):An(Z)?x.renderbufferStorageMultisampleEXT(36161,yt,35056,Z.width,Z.height):n.renderbufferStorage(36161,34041,Z.width,Z.height),n.framebufferRenderbuffer(36160,33306,36161,re)}else{const yt=!0===Z.isWebGLMultipleRenderTargets?Z.texture[0]:Z.texture,qt=o.convert(yt.format,yt.encoding),nn=o.convert(yt.type),On=ue(yt.internalFormat,qt,nn,yt.encoding),Ye=kn(Z);qe&&!1===An(Z)?n.renderbufferStorageMultisample(36161,Ye,On,Z.width,Z.height):An(Z)?x.renderbufferStorageMultisampleEXT(36161,Ye,On,Z.width,Z.height):n.renderbufferStorage(36161,On,Z.width,Z.height)}n.bindRenderbuffer(36161,null)}function ct(re){const Z=i.get(re),qe=!0===re.isWebGLCubeRenderTarget;if(re.depthTexture&&!Z.__autoAllocateDepthBuffer){if(qe)throw new Error("target.depthTexture not supported in Cube render targets");!function et(re,Z){if(Z&&Z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,re),!Z.depthTexture||!Z.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(Z.depthTexture).__webglTexture||Z.depthTexture.image.width!==Z.width||Z.depthTexture.image.height!==Z.height)&&(Z.depthTexture.image.width=Z.width,Z.depthTexture.image.height=Z.height,Z.depthTexture.needsUpdate=!0),ht(Z.depthTexture,0);const yt=i.get(Z.depthTexture).__webglTexture,qt=kn(Z);if(Z.depthTexture.format===Qp)An(Z)?x.framebufferTexture2DMultisampleEXT(36160,36096,3553,yt,0,qt):n.framebufferTexture2D(36160,36096,3553,yt,0);else{if(Z.depthTexture.format!==oy)throw new Error("Unknown depthTexture format");An(Z)?x.framebufferTexture2DMultisampleEXT(36160,33306,3553,yt,0,qt):n.framebufferTexture2D(36160,33306,3553,yt,0)}}(Z.__webglFramebuffer,re)}else if(qe){Z.__webglDepthbuffer=[];for(let yt=0;yt<6;yt++)t.bindFramebuffer(36160,Z.__webglFramebuffer[yt]),Z.__webglDepthbuffer[yt]=n.createRenderbuffer(),Ai(Z.__webglDepthbuffer[yt],re,!1)}else t.bindFramebuffer(36160,Z.__webglFramebuffer),Z.__webglDepthbuffer=n.createRenderbuffer(),Ai(Z.__webglDepthbuffer,re,!1);t.bindFramebuffer(36160,null)}function kn(re){return Math.min(v,re.samples)}function An(re){const Z=i.get(re);return u&&re.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==Z.__useRenderToTexture}function xr(re,Z){const qe=re.encoding,yt=re.format,qt=re.type;return!0===re.isCompressedTexture||!0===re.isVideoTexture||1035===re.format||qe!==mh&&(qe===qr?!1===u?!0===e.has("EXT_sRGB")&&yt===Rl?(re.format=1035,re.minFilter=Bs,re.generateMipmaps=!1):Z=im.sRGBToLinear(Z):(yt!==Rl||qt!==Jp)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",qe)),Z}this.allocateTextureUnit=function be(){const re=Te;return re>=f&&console.warn("THREE.WebGLTextures: Trying to use "+re+" texture units while this GPU supports only "+f),Te+=1,re},this.resetTextureUnits=function We(){Te=0},this.setTexture2D=ht,this.setTexture2DArray=function bt(re,Z){const qe=i.get(re);re.version>0&&qe.__version!==re.version?hi(qe,re,Z):(t.activeTexture(33984+Z),t.bindTexture(35866,qe.__webglTexture))},this.setTexture3D=function mt(re,Z){const qe=i.get(re);re.version>0&&qe.__version!==re.version?hi(qe,re,Z):(t.activeTexture(33984+Z),t.bindTexture(32879,qe.__webglTexture))},this.setTextureCube=function _n(re,Z){const qe=i.get(re);re.version>0&&qe.__version!==re.version?function di(re,Z,qe){if(6!==Z.image.length)return;const yt=sr(re,Z),qt=Z.source;if(t.activeTexture(33984+qe),t.bindTexture(34067,re.__webglTexture),qt.version!==qt.__currentVersion||!0===yt){n.pixelStorei(37440,Z.flipY),n.pixelStorei(37441,Z.premultiplyAlpha),n.pixelStorei(3317,Z.unpackAlignment),n.pixelStorei(37443,0);const nn=Z.isCompressedTexture||Z.image[0].isCompressedTexture,On=Z.image[0]&&Z.image[0].isDataTexture,Ye=[];for(let Lt=0;Lt<6;Lt++)Ye[Lt]=nn||On?On?Z.image[Lt].image:Z.image[Lt]:V(Z.image[Lt],!1,!0,m),Ye[Lt]=xr(Z,Ye[Lt]);const fi=Ye[0],xi=k(fi)||u,hn=o.convert(Z.format,Z.encoding),pe=o.convert(Z.type),zt=ue(Z.internalFormat,hn,pe,Z.encoding),Nt=u&&!0!==Z.isVideoTexture,Gn=void 0===re.__version;let Wn,ln=Pe(Z,fi,xi);if(nt(34067,Z,xi),nn){Nt&&Gn&&t.texStorage2D(34067,ln,zt,fi.width,fi.height);for(let Lt=0;Lt<6;Lt++){Wn=Ye[Lt].mipmaps;for(let ni=0;ni<Wn.length;ni++){const Or=Wn[ni];Z.format!==Rl?null!==hn?Nt?t.compressedTexSubImage2D(34069+Lt,ni,0,0,Or.width,Or.height,hn,Or.data):t.compressedTexImage2D(34069+Lt,ni,zt,Or.width,Or.height,0,Or.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Nt?t.texSubImage2D(34069+Lt,ni,0,0,Or.width,Or.height,hn,pe,Or.data):t.texImage2D(34069+Lt,ni,zt,Or.width,Or.height,0,hn,pe,Or.data)}}}else{Wn=Z.mipmaps,Nt&&Gn&&(Wn.length>0&&ln++,t.texStorage2D(34067,ln,zt,Ye[0].width,Ye[0].height));for(let Lt=0;Lt<6;Lt++)if(On){Nt?t.texSubImage2D(34069+Lt,0,0,0,Ye[Lt].width,Ye[Lt].height,hn,pe,Ye[Lt].data):t.texImage2D(34069+Lt,0,zt,Ye[Lt].width,Ye[Lt].height,0,hn,pe,Ye[Lt].data);for(let ni=0;ni<Wn.length;ni++){const zi=Wn[ni].image[Lt].image;Nt?t.texSubImage2D(34069+Lt,ni+1,0,0,zi.width,zi.height,hn,pe,zi.data):t.texImage2D(34069+Lt,ni+1,zt,zi.width,zi.height,0,hn,pe,zi.data)}}else{Nt?t.texSubImage2D(34069+Lt,0,0,0,hn,pe,Ye[Lt]):t.texImage2D(34069+Lt,0,zt,hn,pe,Ye[Lt]);for(let ni=0;ni<Wn.length;ni++){const Or=Wn[ni];Nt?t.texSubImage2D(34069+Lt,ni+1,0,0,hn,pe,Or.image[Lt]):t.texImage2D(34069+Lt,ni+1,zt,hn,pe,Or.image[Lt])}}}ee(Z,xi)&&oe(34067),qt.__currentVersion=qt.version,Z.onUpdate&&Z.onUpdate(Z)}re.__version=Z.version}(qe,re,Z):(t.activeTexture(33984+Z),t.bindTexture(34067,qe.__webglTexture))},this.rebindTextures=function wt(re,Z,qe){const yt=i.get(re);void 0!==Z&&It(yt.__webglFramebuffer,re,re.texture,36064,3553),void 0!==qe&&ct(re)},this.setupRenderTarget=function un(re){const Z=re.texture,qe=i.get(re),yt=i.get(Z);re.addEventListener("dispose",le),!0!==re.isWebGLMultipleRenderTargets&&(void 0===yt.__webglTexture&&(yt.__webglTexture=n.createTexture()),yt.__version=Z.version,l.memory.textures++);const qt=!0===re.isWebGLCubeRenderTarget,nn=!0===re.isWebGLMultipleRenderTargets,On=k(re)||u;if(qt){qe.__webglFramebuffer=[];for(let Ye=0;Ye<6;Ye++)qe.__webglFramebuffer[Ye]=n.createFramebuffer()}else if(qe.__webglFramebuffer=n.createFramebuffer(),nn)if(s.drawBuffers){const Ye=re.texture;for(let fi=0,xi=Ye.length;fi<xi;fi++){const hn=i.get(Ye[fi]);void 0===hn.__webglTexture&&(hn.__webglTexture=n.createTexture(),l.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(u&&re.samples>0&&!1===An(re)){qe.__webglMultisampledFramebuffer=n.createFramebuffer(),qe.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,qe.__webglColorRenderbuffer);const Ye=o.convert(Z.format,Z.encoding),fi=o.convert(Z.type),xi=ue(Z.internalFormat,Ye,fi,Z.encoding),hn=kn(re);n.renderbufferStorageMultisample(36161,hn,xi,re.width,re.height),t.bindFramebuffer(36160,qe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,qe.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),re.depthBuffer&&(qe.__webglDepthRenderbuffer=n.createRenderbuffer(),Ai(qe.__webglDepthRenderbuffer,re,!0)),t.bindFramebuffer(36160,null)}if(qt){t.bindTexture(34067,yt.__webglTexture),nt(34067,Z,On);for(let Ye=0;Ye<6;Ye++)It(qe.__webglFramebuffer[Ye],re,Z,36064,34069+Ye);ee(Z,On)&&oe(34067),t.unbindTexture()}else if(nn){const Ye=re.texture;for(let fi=0,xi=Ye.length;fi<xi;fi++){const hn=Ye[fi],pe=i.get(hn);t.bindTexture(3553,pe.__webglTexture),nt(3553,hn,On),It(qe.__webglFramebuffer,re,hn,36064+fi,3553),ee(hn,On)&&oe(3553)}t.unbindTexture()}else{let Ye=3553;(re.isWebGL3DRenderTarget||re.isWebGLArrayRenderTarget)&&(u?Ye=re.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ye,yt.__webglTexture),nt(Ye,Z,On),It(qe.__webglFramebuffer,re,Z,36064,Ye),ee(Z,On)&&oe(Ye),t.unbindTexture()}re.depthBuffer&&ct(re)},this.updateRenderTargetMipmap=function jt(re){const Z=k(re)||u,qe=!0===re.isWebGLMultipleRenderTargets?re.texture:[re.texture];for(let yt=0,qt=qe.length;yt<qt;yt++){const nn=qe[yt];if(ee(nn,Z)){const On=re.isWebGLCubeRenderTarget?34067:3553,Ye=i.get(nn).__webglTexture;t.bindTexture(On,Ye),oe(On),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function si(re){if(u&&re.samples>0&&!1===An(re)){const Z=re.width,qe=re.height;let yt=16384;const qt=[36064],nn=re.stencilBuffer?33306:36096;re.depthBuffer&&qt.push(nn);const On=i.get(re),Ye=void 0!==On.__ignoreDepthValues&&On.__ignoreDepthValues;!1===Ye&&(re.depthBuffer&&(yt|=256),re.stencilBuffer&&(yt|=1024)),t.bindFramebuffer(36008,On.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,On.__webglFramebuffer),!0===Ye&&(n.invalidateFramebuffer(36008,[nn]),n.invalidateFramebuffer(36009,[nn])),n.blitFramebuffer(0,0,Z,qe,0,0,Z,qe,yt,9728),b&&n.invalidateFramebuffer(36008,qt),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,On.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ct,this.setupFrameBufferTexture=It,this.useMultisampledRTT=An}function X8(n,e,t){const i=t.isWebGL2;return{convert:function s(o,l=null){let u;if(o===Jp)return 5121;if(1017===o)return 32819;if(1018===o)return 32820;if(1010===o)return 5120;if(1011===o)return 5122;if(o===O0)return 5123;if(1013===o)return 5124;if(1014===o)return 5125;if(o===Gd)return 5126;if(o===ry)return i?5131:(u=e.get("OES_texture_half_float"),null!==u?u.HALF_FLOAT_OES:null);if(1021===o)return 6406;if(o===Rl)return 6408;if(1024===o)return 6409;if(1025===o)return 6410;if(o===Qp)return 6402;if(o===oy)return 34041;if(1028===o)return 6403;if(1022===o)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===o)return u=e.get("EXT_sRGB"),null!==u?u.SRGB_ALPHA_EXT:null;if(1029===o)return 36244;if(1030===o)return 33319;if(1031===o)return 33320;if(1033===o)return 36249;if(33776===o||33777===o||33778===o||33779===o)if(l===qr){if(u=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===u)return null;if(33776===o)return u.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===o)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===o)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===o)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(u=e.get("WEBGL_compressed_texture_s3tc"),null===u)return null;if(33776===o)return u.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===o)return u.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===o)return u.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===o)return u.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===o||35841===o||35842===o||35843===o){if(u=e.get("WEBGL_compressed_texture_pvrtc"),null===u)return null;if(35840===o)return u.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===o)return u.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===o)return u.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===o)return u.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===o)return u=e.get("WEBGL_compressed_texture_etc1"),null!==u?u.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===o||37496===o){if(u=e.get("WEBGL_compressed_texture_etc"),null===u)return null;if(37492===o)return l===qr?u.COMPRESSED_SRGB8_ETC2:u.COMPRESSED_RGB8_ETC2;if(37496===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u.COMPRESSED_RGBA8_ETC2_EAC}if(37808===o||37809===o||37810===o||37811===o||37812===o||37813===o||37814===o||37815===o||37816===o||37817===o||37818===o||37819===o||37820===o||37821===o){if(u=e.get("WEBGL_compressed_texture_astc"),null===u)return null;if(37808===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:u.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:u.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:u.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:u.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:u.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:u.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:u.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:u.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:u.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:u.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:u.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:u.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:u.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===o)return l===qr?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:u.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===o){if(u=e.get("EXT_texture_compression_bptc"),null===u)return null;if(36492===o)return l===qr?u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:u.COMPRESSED_RGBA_BPTC_UNORM_EXT}return o===sy?i?34042:(u=e.get("WEBGL_depth_texture"),null!==u?u.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}LD.prototype.isMeshDistanceMaterial=!0;class e3 extends vo{constructor(e=[]){super(),this.cameras=e}}e3.prototype.isArrayCamera=!0;class um extends Zi{constructor(){super(),this.type="Group"}}um.prototype.isGroup=!0;const Y8={type:"move"};class FD{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new um,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new um,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Y,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Y),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new um,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Y,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Y),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let s=null,o=null,l=null;const u=this._targetRay,f=this._grip,m=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==u&&(s=t.getPose(e.targetRaySpace,i),null!==s&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(Y8))),m&&e.hand){l=!0;for(const C of e.hand.values()){const A=t.getJointPose(C,i);if(void 0===m.joints[C.jointName]){const F=new um;F.matrixAutoUpdate=!1,F.visible=!1,m.joints[C.jointName]=F,m.add(F)}const N=m.joints[C.jointName];null!==A&&(N.matrix.fromArray(A.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),N.jointRadius=A.radius),N.visible=null!==A}const x=m.joints["index-finger-tip"].position.distanceTo(m.joints["thumb-tip"].position),b=.02,E=.005;m.inputState.pinching&&x>b+E?(m.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!m.inputState.pinching&&x<=b-E&&(m.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==f&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),null!==o&&(f.matrix.fromArray(o.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),o.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(o.linearVelocity)):f.hasLinearVelocity=!1,o.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(o.angularVelocity)):f.hasAngularVelocity=!1));return null!==u&&(u.visible=null!==s),null!==f&&(f.visible=null!==o),null!==m&&(m.visible=null!==l),this}}class t3 extends Fa{constructor(e,t,i,s,o,l,u,f,m,y){if((y=void 0!==y?y:Qp)!==Qp&&y!==oy)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&y===Qp&&(i=O0),void 0===i&&y===oy&&(i=sy),super(null,s,o,l,u,f,y,i,m),this.image={width:e,height:t},this.magFilter=void 0!==u?u:no,this.minFilter=void 0!==f?f:no,this.flipY=!1,this.generateMipmaps=!1}}t3.prototype.isDepthTexture=!0;class K8 extends Wd{constructor(e,t){super();const i=this;let s=null,o=1,l=null,u="local-floor",f=null,m=null,y=null,v=null,x=null;const b=t.getContextAttributes();let E=null,C=null;const A=[],N=new Map,F=new vo;F.layers.enable(1),F.viewport=new Wi;const V=new vo;V.layers.enable(2),V.viewport=new Wi;const k=[F,V],G=new e3;G.layers.enable(1),G.layers.enable(2);let ee=null,oe=null;function ue(be){const ot=N.get(be.inputSource);ot&&ot.dispatchEvent({type:be.type,data:be.inputSource})}function Pe(){N.forEach(function(be,ot){be.disconnect(ot)}),N.clear(),ee=null,oe=null,e.setRenderTarget(E),v=null,y=null,m=null,s=null,C=null,We.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function ye(be){const ot=s.inputSources;for(let ht=0;ht<A.length;ht++)N.set(ot[ht],A[ht]);for(let ht=0;ht<be.removed.length;ht++){const bt=be.removed[ht],mt=N.get(bt);mt&&(mt.dispatchEvent({type:"disconnected",data:bt}),N.delete(bt))}for(let ht=0;ht<be.added.length;ht++){const bt=be.added[ht],mt=N.get(bt);mt&&mt.dispatchEvent({type:"connected",data:bt})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(be){let ot=A[be];return void 0===ot&&(ot=new FD,A[be]=ot),ot.getTargetRaySpace()},this.getControllerGrip=function(be){let ot=A[be];return void 0===ot&&(ot=new FD,A[be]=ot),ot.getGripSpace()},this.getHand=function(be){let ot=A[be];return void 0===ot&&(ot=new FD,A[be]=ot),ot.getHandSpace()},this.setFramebufferScaleFactor=function(be){o=be,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(be){u=be,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l},this.getBaseLayer=function(){return null!==y?y:v},this.getBinding=function(){return m},this.getFrame=function(){return x},this.getSession=function(){return s},this.setSession=function(){var be=function RH(n){return function(){var e=this,t=arguments;return new Promise(function(i,s){var o=n.apply(e,t);function l(f){E2(o,i,s,l,u,"next",f)}function u(f){E2(o,i,s,l,u,"throw",f)}l(void 0)})}}(function*(ot){if(s=ot,null!==s){if(E=e.getRenderTarget(),s.addEventListener("select",ue),s.addEventListener("selectstart",ue),s.addEventListener("selectend",ue),s.addEventListener("squeeze",ue),s.addEventListener("squeezestart",ue),s.addEventListener("squeezeend",ue),s.addEventListener("end",Pe),s.addEventListener("inputsourceschange",ye),!0!==b.xrCompatible&&(yield t.makeXRCompatible()),void 0===s.renderState.layers||!1===e.capabilities.isWebGL2)v=new XRWebGLLayer(s,t,{antialias:void 0!==s.renderState.layers||b.antialias,alpha:b.alpha,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:o}),s.updateRenderState({baseLayer:v}),C=new Ja(v.framebufferWidth,v.framebufferHeight,{format:Rl,type:Jp,encoding:e.outputEncoding});else{let ht=null,bt=null,mt=null;b.depth&&(mt=b.stencil?35056:33190,ht=b.stencil?oy:Qp,bt=b.stencil?sy:O0);const _n={colorFormat:e.outputEncoding===qr?35907:32856,depthFormat:mt,scaleFactor:o};m=new XRWebGLBinding(s,t),y=m.createProjectionLayer(_n),s.updateRenderState({layers:[y]}),C=new Ja(y.textureWidth,y.textureHeight,{format:Rl,type:Jp,depthTexture:new t3(y.textureWidth,y.textureHeight,bt,void 0,void 0,void 0,void 0,void 0,void 0,ht),stencilBuffer:b.stencil,encoding:e.outputEncoding,samples:b.antialias?4:0}),e.properties.get(C).__ignoreDepthValues=y.ignoreDepthValues}C.isXRRenderTarget=!0,this.setFoveation(1),l=yield s.requestReferenceSpace(u),We.setContext(s),We.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(ot){return be.apply(this,arguments)}}();const q=new Y,le=new Y;function _e(be,ot){null===ot?be.matrixWorld.copy(be.matrix):be.matrixWorld.multiplyMatrices(ot.matrixWorld,be.matrix),be.matrixWorldInverse.copy(be.matrixWorld).invert()}this.updateCamera=function(be){if(null===s)return;G.near=V.near=F.near=be.near,G.far=V.far=F.far=be.far,(ee!==G.near||oe!==G.far)&&(s.updateRenderState({depthNear:G.near,depthFar:G.far}),ee=G.near,oe=G.far);const ot=be.parent,ht=G.cameras;_e(G,ot);for(let mt=0;mt<ht.length;mt++)_e(ht[mt],ot);G.matrixWorld.decompose(G.position,G.quaternion,G.scale),be.position.copy(G.position),be.quaternion.copy(G.quaternion),be.scale.copy(G.scale),be.matrix.copy(G.matrix),be.matrixWorld.copy(G.matrixWorld);const bt=be.children;for(let mt=0,_n=bt.length;mt<_n;mt++)bt[mt].updateMatrixWorld(!0);2===ht.length?function Ze(be,ot,ht){q.setFromMatrixPosition(ot.matrixWorld),le.setFromMatrixPosition(ht.matrixWorld);const bt=q.distanceTo(le),mt=ot.projectionMatrix.elements,_n=ht.projectionMatrix.elements,vi=mt[14]/(mt[10]-1),Yn=mt[14]/(mt[10]+1),nt=(mt[9]+1)/mt[5],sr=(mt[9]-1)/mt[5],hi=(mt[8]-1)/mt[0],di=(_n[8]+1)/_n[0],It=vi*hi,Ai=vi*di,et=bt/(-hi+di),ct=et*-hi;ot.matrixWorld.decompose(be.position,be.quaternion,be.scale),be.translateX(ct),be.translateZ(et),be.matrixWorld.compose(be.position,be.quaternion,be.scale),be.matrixWorldInverse.copy(be.matrixWorld).invert();const wt=vi+et,un=Yn+et;be.projectionMatrix.makePerspective(It-ct,Ai+(bt-ct),nt*Yn/un*wt,sr*Yn/un*wt,wt,un)}(G,F,V):G.projectionMatrix.copy(F.projectionMatrix)},this.getCamera=function(){return G},this.getFoveation=function(){return null!==y?y.fixedFoveation:null!==v?v.fixedFoveation:void 0},this.setFoveation=function(be){null!==y&&(y.fixedFoveation=be),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=be)};let Le=null;const We=new MF;We.setAnimationLoop(function Te(be,ot){if(f=ot.getViewerPose(l),x=ot,null!==f){const bt=f.views;null!==v&&(e.setRenderTargetFramebuffer(C,v.framebuffer),e.setRenderTarget(C));let mt=!1;bt.length!==G.cameras.length&&(G.cameras.length=0,mt=!0);for(let _n=0;_n<bt.length;_n++){const vi=bt[_n];let Yn=null;if(null!==v)Yn=v.getViewport(vi);else{const sr=m.getViewSubImage(y,vi);Yn=sr.viewport,0===_n&&(e.setRenderTargetTextures(C,sr.colorTexture,y.ignoreDepthValues?void 0:sr.depthStencilTexture),e.setRenderTarget(C))}const nt=k[_n];nt.matrix.fromArray(vi.transform.matrix),nt.projectionMatrix.fromArray(vi.projectionMatrix),nt.viewport.set(Yn.x,Yn.y,Yn.width,Yn.height),0===_n&&G.matrix.copy(nt.matrix),!0===mt&&G.cameras.push(nt)}}const ht=s.inputSources;for(let bt=0;bt<A.length;bt++)A[bt].update(ht[bt],ot,l);Le&&Le(be,ot),x=null}),this.setAnimationLoop=function(be){Le=be},this.dispose=function(){}}}function $8(n,e){function s(C,A){C.opacity.value=A.opacity,A.color&&C.diffuse.value.copy(A.color),A.emissive&&C.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(C.map.value=A.map),A.alphaMap&&(C.alphaMap.value=A.alphaMap),A.bumpMap&&(C.bumpMap.value=A.bumpMap,C.bumpScale.value=A.bumpScale,1===A.side&&(C.bumpScale.value*=-1)),A.displacementMap&&(C.displacementMap.value=A.displacementMap,C.displacementScale.value=A.displacementScale,C.displacementBias.value=A.displacementBias),A.emissiveMap&&(C.emissiveMap.value=A.emissiveMap),A.normalMap&&(C.normalMap.value=A.normalMap,C.normalScale.value.copy(A.normalScale),1===A.side&&C.normalScale.value.negate()),A.specularMap&&(C.specularMap.value=A.specularMap),A.alphaTest>0&&(C.alphaTest.value=A.alphaTest);const N=e.get(A).envMap;if(N&&(C.envMap.value=N,C.flipEnvMap.value=N.isCubeTexture&&!1===N.isRenderTargetTexture?-1:1,C.reflectivity.value=A.reflectivity,C.ior.value=A.ior,C.refractionRatio.value=A.refractionRatio),A.lightMap){C.lightMap.value=A.lightMap;const k=!0!==n.physicallyCorrectLights?Math.PI:1;C.lightMapIntensity.value=A.lightMapIntensity*k}let F,V;A.aoMap&&(C.aoMap.value=A.aoMap,C.aoMapIntensity.value=A.aoMapIntensity),A.map?F=A.map:A.specularMap?F=A.specularMap:A.displacementMap?F=A.displacementMap:A.normalMap?F=A.normalMap:A.bumpMap?F=A.bumpMap:A.roughnessMap?F=A.roughnessMap:A.metalnessMap?F=A.metalnessMap:A.alphaMap?F=A.alphaMap:A.emissiveMap?F=A.emissiveMap:A.clearcoatMap?F=A.clearcoatMap:A.clearcoatNormalMap?F=A.clearcoatNormalMap:A.clearcoatRoughnessMap?F=A.clearcoatRoughnessMap:A.specularIntensityMap?F=A.specularIntensityMap:A.specularColorMap?F=A.specularColorMap:A.transmissionMap?F=A.transmissionMap:A.thicknessMap?F=A.thicknessMap:A.sheenColorMap?F=A.sheenColorMap:A.sheenRoughnessMap&&(F=A.sheenRoughnessMap),void 0!==F&&(F.isWebGLRenderTarget&&(F=F.texture),!0===F.matrixAutoUpdate&&F.updateMatrix(),C.uvTransform.value.copy(F.matrix)),A.aoMap?V=A.aoMap:A.lightMap&&(V=A.lightMap),void 0!==V&&(V.isWebGLRenderTarget&&(V=V.texture),!0===V.matrixAutoUpdate&&V.updateMatrix(),C.uv2Transform.value.copy(V.matrix))}return{refreshFogUniforms:function t(C,A){C.fogColor.value.copy(A.color),A.isFog?(C.fogNear.value=A.near,C.fogFar.value=A.far):A.isFogExp2&&(C.fogDensity.value=A.density)},refreshMaterialUniforms:function i(C,A,N,F,V){A.isMeshBasicMaterial||A.isMeshLambertMaterial?s(C,A):A.isMeshToonMaterial?(s(C,A),function y(C,A){A.gradientMap&&(C.gradientMap.value=A.gradientMap)}(C,A)):A.isMeshPhongMaterial?(s(C,A),function m(C,A){C.specular.value.copy(A.specular),C.shininess.value=Math.max(A.shininess,1e-4)}(C,A)):A.isMeshStandardMaterial?(s(C,A),function v(C,A){C.roughness.value=A.roughness,C.metalness.value=A.metalness,A.roughnessMap&&(C.roughnessMap.value=A.roughnessMap),A.metalnessMap&&(C.metalnessMap.value=A.metalnessMap),e.get(A).envMap&&(C.envMapIntensity.value=A.envMapIntensity)}(C,A),A.isMeshPhysicalMaterial&&function x(C,A,N){C.ior.value=A.ior,A.sheen>0&&(C.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),C.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(C.sheenColorMap.value=A.sheenColorMap),A.sheenRoughnessMap&&(C.sheenRoughnessMap.value=A.sheenRoughnessMap)),A.clearcoat>0&&(C.clearcoat.value=A.clearcoat,C.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(C.clearcoatMap.value=A.clearcoatMap),A.clearcoatRoughnessMap&&(C.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap),A.clearcoatNormalMap&&(C.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),C.clearcoatNormalMap.value=A.clearcoatNormalMap,1===A.side&&C.clearcoatNormalScale.value.negate())),A.transmission>0&&(C.transmission.value=A.transmission,C.transmissionSamplerMap.value=N.texture,C.transmissionSamplerSize.value.set(N.width,N.height),A.transmissionMap&&(C.transmissionMap.value=A.transmissionMap),C.thickness.value=A.thickness,A.thicknessMap&&(C.thicknessMap.value=A.thicknessMap),C.attenuationDistance.value=A.attenuationDistance,C.attenuationColor.value.copy(A.attenuationColor)),C.specularIntensity.value=A.specularIntensity,C.specularColor.value.copy(A.specularColor),A.specularIntensityMap&&(C.specularIntensityMap.value=A.specularIntensityMap),A.specularColorMap&&(C.specularColorMap.value=A.specularColorMap)}(C,A,V)):A.isMeshMatcapMaterial?(s(C,A),function b(C,A){A.matcap&&(C.matcap.value=A.matcap)}(C,A)):A.isMeshDepthMaterial?s(C,A):A.isMeshDistanceMaterial?(s(C,A),function E(C,A){C.referencePosition.value.copy(A.referencePosition),C.nearDistance.value=A.nearDistance,C.farDistance.value=A.farDistance}(C,A)):A.isMeshNormalMaterial?s(C,A):A.isLineBasicMaterial?(function o(C,A){C.diffuse.value.copy(A.color),C.opacity.value=A.opacity}(C,A),A.isLineDashedMaterial&&function l(C,A){C.dashSize.value=A.dashSize,C.totalSize.value=A.dashSize+A.gapSize,C.scale.value=A.scale}(C,A)):A.isPointsMaterial?function u(C,A,N,F){let V;C.diffuse.value.copy(A.color),C.opacity.value=A.opacity,C.size.value=A.size*N,C.scale.value=.5*F,A.map&&(C.map.value=A.map),A.alphaMap&&(C.alphaMap.value=A.alphaMap),A.alphaTest>0&&(C.alphaTest.value=A.alphaTest),A.map?V=A.map:A.alphaMap&&(V=A.alphaMap),void 0!==V&&(!0===V.matrixAutoUpdate&&V.updateMatrix(),C.uvTransform.value.copy(V.matrix))}(C,A,N,F):A.isSpriteMaterial?function f(C,A){let N;C.diffuse.value.copy(A.color),C.opacity.value=A.opacity,C.rotation.value=A.rotation,A.map&&(C.map.value=A.map),A.alphaMap&&(C.alphaMap.value=A.alphaMap),A.alphaTest>0&&(C.alphaTest.value=A.alphaTest),A.map?N=A.map:A.alphaMap&&(N=A.alphaMap),void 0!==N&&(!0===N.matrixAutoUpdate&&N.updateMatrix(),C.uvTransform.value.copy(N.matrix))}(C,A):A.isShadowMaterial?(C.color.value.copy(A.color),C.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}}}function hr(n={}){const e=void 0!==n.canvas?n.canvas:function Z8(){const n=z0("canvas");return n.style.display="block",n}(),t=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,s=void 0===n.stencil||n.stencil,o=void 0!==n.antialias&&n.antialias,l=void 0===n.premultipliedAlpha||n.premultipliedAlpha,u=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,f=void 0!==n.powerPreference?n.powerPreference:"default",m=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let y;y=void 0!==n.context?t.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let v=null,x=null;const b=[],E=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=mh,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const C=this;let A=!1,N=0,F=0,V=null,k=-1,G=null;const ee=new Wi,oe=new Wi;let ue=null,Pe=e.width,ye=e.height,q=1,le=null,Ze=null;const _e=new Wi(0,0,Pe,ye),Le=new Wi(0,0,Pe,ye);let Te=!1;const We=new TE;let be=!1,ot=!1,ht=null;const bt=new Ft,mt=new at,_n=new Y,vi={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Yn(){return null===V?q:1}let hi,di,It,Ai,et,ct,wt,un,jt,si,kn,An,Qr,xr,re,Z,qe,yt,qt,nn,On,Ye,fi,nt=t;function sr(te,Ce){for(let Ve=0;Ve<te.length;Ve++){const lt=e.getContext(te[Ve],Ce);if(null!==lt)return lt}return null}try{const te={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:f,failIfMajorPerformanceCaveat:m};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r139"),e.addEventListener("webglcontextlost",pe,!1),e.addEventListener("webglcontextrestored",zt,!1),null===nt){const Ce=["webgl2","webgl","experimental-webgl"];if(!0===C.isWebGL1Renderer&&Ce.shift(),nt=sr(Ce,te),null===nt)throw sr(Ce)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===nt.getShaderPrecisionFormat&&(nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(te){throw console.error("THREE.WebGLRenderer: "+te.message),te}function xi(){hi=new mW(nt),di=new cW(nt,hi,n),hi.init(di),Ye=new X8(nt,hi,di),It=new q8(nt,hi,di),Ai=new _W(nt),et=new F8,ct=new j8(nt,hi,It,et,di,Ye,Ai),wt=new hW(C),un=new pW(C),jt=new u4(nt,di),fi=new aW(nt,hi,jt,di),si=new gW(nt,jt,Ai,fi),kn=new wW(nt,si,jt,Ai),qt=new bW(nt,di,ct),Z=new uW(et),An=new L8(C,wt,un,hi,di,fi,Z),Qr=new $8(C,et),xr=new O8,re=new H8(hi,di),yt=new oW(C,wt,It,kn,y,l),qe=new QF(C,kn,di),nn=new lW(nt,hi,Ai,di),On=new yW(nt,hi,Ai,di),Ai.programs=An.programs,C.capabilities=di,C.extensions=hi,C.properties=et,C.renderLists=xr,C.shadowMap=qe,C.state=It,C.info=Ai}xi();const hn=new K8(C,nt);function pe(te){te.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function zt(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const te=Ai.autoReset,Ce=qe.enabled,Ve=qe.autoUpdate,Ie=qe.needsUpdate,lt=qe.type;xi(),Ai.autoReset=te,qe.enabled=Ce,qe.autoUpdate=Ve,qe.needsUpdate=Ie,qe.type=lt}function Nt(te){const Ce=te.target;Ce.removeEventListener("dispose",Nt),function Gn(te){(function ln(te){const Ce=et.get(te).programs;void 0!==Ce&&(Ce.forEach(function(Ve){An.releaseProgram(Ve)}),te.isShaderMaterial&&An.releaseShaderCache(te))})(te),et.remove(te)}(Ce)}this.xr=hn,this.getContext=function(){return nt},this.getContextAttributes=function(){return nt.getContextAttributes()},this.forceContextLoss=function(){const te=hi.get("WEBGL_lose_context");te&&te.loseContext()},this.forceContextRestore=function(){const te=hi.get("WEBGL_lose_context");te&&te.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(te){void 0!==te&&(q=te,this.setSize(Pe,ye,!1))},this.getSize=function(te){return te.set(Pe,ye)},this.setSize=function(te,Ce,Ve){hn.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Pe=te,ye=Ce,e.width=Math.floor(te*q),e.height=Math.floor(Ce*q),!1!==Ve&&(e.style.width=te+"px",e.style.height=Ce+"px"),this.setViewport(0,0,te,Ce))},this.getDrawingBufferSize=function(te){return te.set(Pe*q,ye*q).floor()},this.setDrawingBufferSize=function(te,Ce,Ve){Pe=te,ye=Ce,q=Ve,e.width=Math.floor(te*Ve),e.height=Math.floor(Ce*Ve),this.setViewport(0,0,te,Ce)},this.getCurrentViewport=function(te){return te.copy(ee)},this.getViewport=function(te){return te.copy(_e)},this.setViewport=function(te,Ce,Ve,Ie){te.isVector4?_e.set(te.x,te.y,te.z,te.w):_e.set(te,Ce,Ve,Ie),It.viewport(ee.copy(_e).multiplyScalar(q).floor())},this.getScissor=function(te){return te.copy(Le)},this.setScissor=function(te,Ce,Ve,Ie){te.isVector4?Le.set(te.x,te.y,te.z,te.w):Le.set(te,Ce,Ve,Ie),It.scissor(oe.copy(Le).multiplyScalar(q).floor())},this.getScissorTest=function(){return Te},this.setScissorTest=function(te){It.setScissorTest(Te=te)},this.setOpaqueSort=function(te){le=te},this.setTransparentSort=function(te){Ze=te},this.getClearColor=function(te){return te.copy(yt.getClearColor())},this.setClearColor=function(){yt.setClearColor.apply(yt,arguments)},this.getClearAlpha=function(){return yt.getClearAlpha()},this.setClearAlpha=function(){yt.setClearAlpha.apply(yt,arguments)},this.clear=function(te=!0,Ce=!0,Ve=!0){let Ie=0;te&&(Ie|=16384),Ce&&(Ie|=256),Ve&&(Ie|=1024),nt.clear(Ie)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pe,!1),e.removeEventListener("webglcontextrestored",zt,!1),xr.dispose(),re.dispose(),et.dispose(),wt.dispose(),un.dispose(),kn.dispose(),fi.dispose(),An.dispose(),hn.dispose(),hn.removeEventListener("sessionstart",ni),hn.removeEventListener("sessionend",Or),ht&&(ht.dispose(),ht=null),zi.stop()},this.renderBufferDirect=function(te,Ce,Ve,Ie,lt,qn){null===Ce&&(Ce=vi);const oi=lt.isMesh&&lt.matrixWorld.determinant()<0,bi=function VX(te,Ce,Ve,Ie,lt){!0!==Ce.isScene&&(Ce=vi),ct.resetTextureUnits();const qn=Ce.fog,bi=null===V?C.outputEncoding:!0===V.isXRRenderTarget?V.texture.encoding:mh,mi=(Ie.isMeshStandardMaterial?un:wt).get(Ie.envMap||(Ie.isMeshStandardMaterial?Ce.environment:null)),fr=!0===Ie.vertexColors&&!!Ve.attributes.color&&4===Ve.attributes.color.itemSize,qi=!!Ie.normalMap&&!!Ve.attributes.tangent,Ji=!!Ve.morphAttributes.position,ds=!!Ve.morphAttributes.normal,Mm=!!Ve.morphAttributes.color,Jy=Ie.toneMapped?C.toneMapping:0,Qy=Ve.morphAttributes.position||Ve.morphAttributes.normal||Ve.morphAttributes.color,cu=void 0!==Qy?Qy.length:0,or=et.get(Ie),e_=x.state.lights;!0!==be||!0!==ot&&te===G||Z.setState(Ie,te,te===G&&Ie.id===k);let js=!1;Ie.version===or.__version?(or.needsLights&&or.lightsStateVersion!==e_.state.version||or.outputEncoding!==bi||lt.isInstancedMesh&&!1===or.instancing||!lt.isInstancedMesh&&!0===or.instancing||lt.isSkinnedMesh&&!1===or.skinning||!lt.isSkinnedMesh&&!0===or.skinning||or.envMap!==mi||Ie.fog&&or.fog!==qn||void 0!==or.numClippingPlanes&&(or.numClippingPlanes!==Z.numPlanes||or.numIntersection!==Z.numIntersection)||or.vertexAlphas!==fr||or.vertexTangents!==qi||or.morphTargets!==Ji||or.morphNormals!==ds||or.morphColors!==Mm||or.toneMapping!==Jy||!0===di.isWebGL2&&or.morphTargetsCount!==cu)&&(js=!0):(js=!0,or.__version=Ie.version);let uu=or.currentProgram;!0===js&&(uu=iP(Ie,Ce,lt));let yf=!1,wx=!1,rP=!1;const qo=uu.getUniforms(),Mx=or.uniforms;if(It.useProgram(uu.program)&&(yf=!0,wx=!0,rP=!0),Ie.id!==k&&(k=Ie.id,wx=!0),yf||G!==te){if(qo.setValue(nt,"projectionMatrix",te.projectionMatrix),di.logarithmicDepthBuffer&&qo.setValue(nt,"logDepthBufFC",2/(Math.log(te.far+1)/Math.LN2)),G!==te&&(G=te,wx=!0,rP=!0),Ie.isShaderMaterial||Ie.isMeshPhongMaterial||Ie.isMeshToonMaterial||Ie.isMeshStandardMaterial||Ie.envMap){const _c=qo.map.cameraPosition;void 0!==_c&&_c.setValue(nt,_n.setFromMatrixPosition(te.matrixWorld))}(Ie.isMeshPhongMaterial||Ie.isMeshToonMaterial||Ie.isMeshLambertMaterial||Ie.isMeshBasicMaterial||Ie.isMeshStandardMaterial||Ie.isShaderMaterial)&&qo.setValue(nt,"isOrthographic",!0===te.isOrthographicCamera),(Ie.isMeshPhongMaterial||Ie.isMeshToonMaterial||Ie.isMeshLambertMaterial||Ie.isMeshBasicMaterial||Ie.isMeshStandardMaterial||Ie.isShaderMaterial||Ie.isShadowMaterial||lt.isSkinnedMesh)&&qo.setValue(nt,"viewMatrix",te.matrixWorldInverse)}if(lt.isSkinnedMesh){qo.setOptional(nt,lt,"bindMatrix"),qo.setOptional(nt,lt,"bindMatrixInverse");const _c=lt.skeleton;_c&&(di.floatVertexTextures?(null===_c.boneTexture&&_c.computeBoneTexture(),qo.setValue(nt,"boneTexture",_c.boneTexture,ct),qo.setValue(nt,"boneTextureSize",_c.boneTextureSize)):qo.setOptional(nt,_c,"boneMatrices"))}const sP=Ve.morphAttributes;return(void 0!==sP.position||void 0!==sP.normal||void 0!==sP.color&&!0===di.isWebGL2)&&qt.update(lt,Ve,Ie,uu),(wx||or.receiveShadow!==lt.receiveShadow)&&(or.receiveShadow=lt.receiveShadow,qo.setValue(nt,"receiveShadow",lt.receiveShadow)),wx&&(qo.setValue(nt,"toneMappingExposure",C.toneMappingExposure),or.needsLights&&function UX(te,Ce){te.ambientLightColor.needsUpdate=Ce,te.lightProbe.needsUpdate=Ce,te.directionalLights.needsUpdate=Ce,te.directionalLightShadows.needsUpdate=Ce,te.pointLights.needsUpdate=Ce,te.pointLightShadows.needsUpdate=Ce,te.spotLights.needsUpdate=Ce,te.spotLightShadows.needsUpdate=Ce,te.rectAreaLights.needsUpdate=Ce,te.hemisphereLights.needsUpdate=Ce}(Mx,rP),qn&&Ie.fog&&Qr.refreshFogUniforms(Mx,qn),Qr.refreshMaterialUniforms(Mx,Ie,q,ye,ht),ef.upload(nt,or.uniformsList,Mx,ct)),Ie.isShaderMaterial&&!0===Ie.uniformsNeedUpdate&&(ef.upload(nt,or.uniformsList,Mx,ct),Ie.uniformsNeedUpdate=!1),Ie.isSpriteMaterial&&qo.setValue(nt,"center",lt.center),qo.setValue(nt,"modelViewMatrix",lt.modelViewMatrix),qo.setValue(nt,"normalMatrix",lt.normalMatrix),qo.setValue(nt,"modelMatrix",lt.matrixWorld),uu}(te,Ce,Ve,Ie,lt);It.setMaterial(Ie,oi);let mi=Ve.index;const fr=Ve.attributes.position;if(null===mi){if(void 0===fr||0===fr.count)return}else if(0===mi.count)return;let qi=1;!0===Ie.wireframe&&(mi=si.getWireframeAttribute(Ve),qi=2),fi.setup(lt,Ie,bi,Ve,mi);let Ji,ds=nn;null!==mi&&(Ji=jt.get(mi),ds=On,ds.setIndex(Ji));const Mm=null!==mi?mi.count:fr.count,Jy=Ve.drawRange.start*qi,Qy=Ve.drawRange.count*qi,cu=null!==qn?qn.start*qi:0,or=null!==qn?qn.count*qi:1/0,e_=Math.max(Jy,cu),js=Math.min(Mm,Jy+Qy,cu+or)-1,uu=Math.max(0,js-e_+1);if(0!==uu){if(lt.isMesh)!0===Ie.wireframe?(It.setLineWidth(Ie.wireframeLinewidth*Yn()),ds.setMode(1)):ds.setMode(4);else if(lt.isLine){let yf=Ie.linewidth;void 0===yf&&(yf=1),It.setLineWidth(yf*Yn()),ds.setMode(lt.isLineSegments?1:lt.isLineLoop?2:3)}else lt.isPoints?ds.setMode(0):lt.isSprite&&ds.setMode(4);if(lt.isInstancedMesh)ds.renderInstances(e_,uu,lt.count);else if(Ve.isInstancedBufferGeometry){const yf=Math.min(Ve.instanceCount,Ve._maxInstanceCount);ds.renderInstances(e_,uu,yf)}else ds.render(e_,uu)}},this.compile=function(te,Ce){x=re.get(te),x.init(),E.push(x),te.traverseVisible(function(Ve){Ve.isLight&&Ve.layers.test(Ce.layers)&&(x.pushLight(Ve),Ve.castShadow&&x.pushShadow(Ve))}),x.setupLights(C.physicallyCorrectLights),te.traverse(function(Ve){const Ie=Ve.material;if(Ie)if(Array.isArray(Ie))for(let lt=0;lt<Ie.length;lt++)iP(Ie[lt],te,Ve);else iP(Ie,te,Ve)}),E.pop(),x=null};let Wn=null;function ni(){zi.stop()}function Or(){zi.start()}const zi=new MF;function au(te,Ce,Ve,Ie){if(!1===te.visible)return;if(te.layers.test(Ce.layers))if(te.isGroup)Ve=te.renderOrder;else if(te.isLOD)!0===te.autoUpdate&&te.update(Ce);else if(te.isLight)x.pushLight(te),te.castShadow&&x.pushShadow(te);else if(te.isSprite){if(!te.frustumCulled||We.intersectsSprite(te)){Ie&&_n.setFromMatrixPosition(te.matrixWorld).applyMatrix4(bt);const oi=kn.update(te),bi=te.material;bi.visible&&v.push(te,oi,bi,Ve,_n.z,null)}}else if((te.isMesh||te.isLine||te.isPoints)&&(te.isSkinnedMesh&&te.skeleton.frame!==Ai.render.frame&&(te.skeleton.update(),te.skeleton.frame=Ai.render.frame),!te.frustumCulled||We.intersectsObject(te))){Ie&&_n.setFromMatrixPosition(te.matrixWorld).applyMatrix4(bt);const oi=kn.update(te),bi=te.material;if(Array.isArray(bi)){const mi=oi.groups;for(let fr=0,qi=mi.length;fr<qi;fr++){const Ji=mi[fr],ds=bi[Ji.materialIndex];ds&&ds.visible&&v.push(te,oi,ds,Ve,_n.z,Ji)}}else bi.visible&&v.push(te,oi,bi,Ve,_n.z,null)}const qn=te.children;for(let oi=0,bi=qn.length;oi<bi;oi++)au(qn[oi],Ce,Ve,Ie)}function lu(te,Ce,Ve,Ie){const lt=te.opaque,qn=te.transmissive,oi=te.transparent;x.setupLightsView(Ve),qn.length>0&&function BX(te,Ce,Ve){const Ie=di.isWebGL2;null===ht&&(ht=new Ja(1,1,{generateMipmaps:!0,type:null!==Ye.convert(ry)?ry:Jp,minFilter:1008,samples:Ie&&!0===o?4:0})),C.getDrawingBufferSize(mt),Ie?ht.setSize(mt.x,mt.y):ht.setSize(rE(mt.x),rE(mt.y));const lt=C.getRenderTarget();C.setRenderTarget(ht),C.clear();const qn=C.toneMapping;C.toneMapping=0,YS(te,Ce,Ve),C.toneMapping=qn,ct.updateMultisampleRenderTarget(ht),ct.updateRenderTargetMipmap(ht),C.setRenderTarget(lt)}(lt,Ce,Ve),Ie&&It.viewport(ee.copy(Ie)),lt.length>0&&YS(lt,Ce,Ve),qn.length>0&&YS(qn,Ce,Ve),oi.length>0&&YS(oi,Ce,Ve),It.buffers.depth.setTest(!0),It.buffers.depth.setMask(!0),It.buffers.color.setMask(!0),It.setPolygonOffset(!1)}function YS(te,Ce,Ve){const Ie=!0===Ce.isScene?Ce.overrideMaterial:null;for(let lt=0,qn=te.length;lt<qn;lt++){const oi=te[lt],bi=oi.object,mi=oi.geometry,fr=null===Ie?oi.material:Ie,qi=oi.group;bi.layers.test(Ve.layers)&&kX(bi,Ce,Ve,mi,fr,qi)}}function kX(te,Ce,Ve,Ie,lt,qn){te.onBeforeRender(C,Ce,Ve,Ie,lt,qn),te.modelViewMatrix.multiplyMatrices(Ve.matrixWorldInverse,te.matrixWorld),te.normalMatrix.getNormalMatrix(te.modelViewMatrix),lt.onBeforeRender(C,Ce,Ve,Ie,te,qn),!0===lt.transparent&&2===lt.side?(lt.side=1,lt.needsUpdate=!0,C.renderBufferDirect(Ve,Ce,Ie,lt,te,qn),lt.side=0,lt.needsUpdate=!0,C.renderBufferDirect(Ve,Ce,Ie,lt,te,qn),lt.side=2):C.renderBufferDirect(Ve,Ce,Ie,lt,te,qn),te.onAfterRender(C,Ce,Ve,Ie,lt,qn)}function iP(te,Ce,Ve){!0!==Ce.isScene&&(Ce=vi);const Ie=et.get(te),lt=x.state.lights,oi=lt.state.version,bi=An.getParameters(te,lt.state,x.state.shadowsArray,Ce,Ve),mi=An.getProgramCacheKey(bi);let fr=Ie.programs;Ie.environment=te.isMeshStandardMaterial?Ce.environment:null,Ie.fog=Ce.fog,Ie.envMap=(te.isMeshStandardMaterial?un:wt).get(te.envMap||Ie.environment),void 0===fr&&(te.addEventListener("dispose",Nt),fr=new Map,Ie.programs=fr);let qi=fr.get(mi);if(void 0!==qi){if(Ie.currentProgram===qi&&Ie.lightsStateVersion===oi)return LB(te,bi),qi}else bi.uniforms=An.getUniforms(te),te.onBuild(Ve,bi,C),te.onBeforeCompile(bi,C),qi=An.acquireProgram(bi,mi),fr.set(mi,qi),Ie.uniforms=bi.uniforms;const Ji=Ie.uniforms;(!te.isShaderMaterial&&!te.isRawShaderMaterial||!0===te.clipping)&&(Ji.clippingPlanes=Z.uniform),LB(te,bi),Ie.needsLights=function zX(te){return te.isMeshLambertMaterial||te.isMeshToonMaterial||te.isMeshPhongMaterial||te.isMeshStandardMaterial||te.isShadowMaterial||te.isShaderMaterial&&!0===te.lights}(te),Ie.lightsStateVersion=oi,Ie.needsLights&&(Ji.ambientLightColor.value=lt.state.ambient,Ji.lightProbe.value=lt.state.probe,Ji.directionalLights.value=lt.state.directional,Ji.directionalLightShadows.value=lt.state.directionalShadow,Ji.spotLights.value=lt.state.spot,Ji.spotLightShadows.value=lt.state.spotShadow,Ji.rectAreaLights.value=lt.state.rectArea,Ji.ltc_1.value=lt.state.rectAreaLTC1,Ji.ltc_2.value=lt.state.rectAreaLTC2,Ji.pointLights.value=lt.state.point,Ji.pointLightShadows.value=lt.state.pointShadow,Ji.hemisphereLights.value=lt.state.hemi,Ji.directionalShadowMap.value=lt.state.directionalShadowMap,Ji.directionalShadowMatrix.value=lt.state.directionalShadowMatrix,Ji.spotShadowMap.value=lt.state.spotShadowMap,Ji.spotShadowMatrix.value=lt.state.spotShadowMatrix,Ji.pointShadowMap.value=lt.state.pointShadowMap,Ji.pointShadowMatrix.value=lt.state.pointShadowMatrix);const ds=qi.getUniforms(),Mm=ef.seqWithValue(ds.seq,Ji);return Ie.currentProgram=qi,Ie.uniformsList=Mm,qi}function LB(te,Ce){const Ve=et.get(te);Ve.outputEncoding=Ce.outputEncoding,Ve.instancing=Ce.instancing,Ve.skinning=Ce.skinning,Ve.morphTargets=Ce.morphTargets,Ve.morphNormals=Ce.morphNormals,Ve.morphColors=Ce.morphColors,Ve.morphTargetsCount=Ce.morphTargetsCount,Ve.numClippingPlanes=Ce.numClippingPlanes,Ve.numIntersection=Ce.numClipIntersection,Ve.vertexAlphas=Ce.vertexAlphas,Ve.vertexTangents=Ce.vertexTangents,Ve.toneMapping=Ce.toneMapping}zi.setAnimationLoop(function Lt(te){Wn&&Wn(te)}),"undefined"!=typeof self&&zi.setContext(self),this.setAnimationLoop=function(te){Wn=te,hn.setAnimationLoop(te),null===te?zi.stop():zi.start()},hn.addEventListener("sessionstart",ni),hn.addEventListener("sessionend",Or),this.render=function(te,Ce){if(void 0===Ce||!0===Ce.isCamera){if(!0!==A){if(!0===te.autoUpdate&&te.updateMatrixWorld(),null===Ce.parent&&Ce.updateMatrixWorld(),!0===hn.enabled&&!0===hn.isPresenting&&(!0===hn.cameraAutoUpdate&&hn.updateCamera(Ce),Ce=hn.getCamera()),!0===te.isScene&&te.onBeforeRender(C,te,Ce,V),x=re.get(te,E.length),x.init(),E.push(x),bt.multiplyMatrices(Ce.projectionMatrix,Ce.matrixWorldInverse),We.setFromProjectionMatrix(bt),ot=this.localClippingEnabled,be=Z.init(this.clippingPlanes,ot,Ce),v=xr.get(te,b.length),v.init(),b.push(v),au(te,Ce,0,C.sortObjects),v.finish(),!0===C.sortObjects&&v.sort(le,Ze),!0===be&&Z.beginShadows(),qe.render(x.state.shadowsArray,te,Ce),!0===be&&Z.endShadows(),!0===this.info.autoReset&&this.info.reset(),yt.render(v,te),x.setupLights(C.physicallyCorrectLights),Ce.isArrayCamera){const Ie=Ce.cameras;for(let lt=0,qn=Ie.length;lt<qn;lt++){const oi=Ie[lt];lu(v,te,oi,oi.viewport)}}else lu(v,te,Ce);null!==V&&(ct.updateMultisampleRenderTarget(V),ct.updateRenderTargetMipmap(V)),!0===te.isScene&&te.onAfterRender(C,te,Ce),fi.resetDefaultState(),k=-1,G=null,E.pop(),x=E.length>0?E[E.length-1]:null,b.pop(),v=b.length>0?b[b.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return V},this.setRenderTargetTextures=function(te,Ce,Ve){et.get(te.texture).__webglTexture=Ce,et.get(te.depthTexture).__webglTexture=Ve;const Ie=et.get(te);Ie.__hasExternalTextures=!0,Ie.__hasExternalTextures&&(Ie.__autoAllocateDepthBuffer=void 0===Ve,Ie.__autoAllocateDepthBuffer||!0===hi.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ie.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(te,Ce){const Ve=et.get(te);Ve.__webglFramebuffer=Ce,Ve.__useDefaultFramebuffer=void 0===Ce},this.setRenderTarget=function(te,Ce=0,Ve=0){V=te,N=Ce,F=Ve;let Ie=!0;if(te){const mi=et.get(te);void 0!==mi.__useDefaultFramebuffer?(It.bindFramebuffer(36160,null),Ie=!1):void 0===mi.__webglFramebuffer?ct.setupRenderTarget(te):mi.__hasExternalTextures&&ct.rebindTextures(te,et.get(te.texture).__webglTexture,et.get(te.depthTexture).__webglTexture)}let lt=null,qn=!1,oi=!1;if(te){const mi=te.texture;(mi.isData3DTexture||mi.isDataArrayTexture)&&(oi=!0);const fr=et.get(te).__webglFramebuffer;te.isWebGLCubeRenderTarget?(lt=fr[Ce],qn=!0):lt=di.isWebGL2&&te.samples>0&&!1===ct.useMultisampledRTT(te)?et.get(te).__webglMultisampledFramebuffer:fr,ee.copy(te.viewport),oe.copy(te.scissor),ue=te.scissorTest}else ee.copy(_e).multiplyScalar(q).floor(),oe.copy(Le).multiplyScalar(q).floor(),ue=Te;if(It.bindFramebuffer(36160,lt)&&di.drawBuffers&&Ie&&It.drawBuffers(te,lt),It.viewport(ee),It.scissor(oe),It.setScissorTest(ue),qn){const mi=et.get(te.texture);nt.framebufferTexture2D(36160,36064,34069+Ce,mi.__webglTexture,Ve)}else if(oi){const mi=et.get(te.texture);nt.framebufferTextureLayer(36160,36064,mi.__webglTexture,Ve||0,Ce||0)}k=-1},this.readRenderTargetPixels=function(te,Ce,Ve,Ie,lt,qn,oi){if(!te||!te.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let bi=et.get(te).__webglFramebuffer;if(te.isWebGLCubeRenderTarget&&void 0!==oi&&(bi=bi[oi]),bi){It.bindFramebuffer(36160,bi);try{const mi=te.texture,fr=mi.format,qi=mi.type;if(fr!==Rl&&Ye.convert(fr)!==nt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Ji=qi===ry&&(hi.has("EXT_color_buffer_half_float")||di.isWebGL2&&hi.has("EXT_color_buffer_float"));if(!(qi===Jp||Ye.convert(qi)===nt.getParameter(35738)||qi===Gd&&(di.isWebGL2||hi.has("OES_texture_float")||hi.has("WEBGL_color_buffer_float"))||Ji))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ce>=0&&Ce<=te.width-Ie&&Ve>=0&&Ve<=te.height-lt&&nt.readPixels(Ce,Ve,Ie,lt,Ye.convert(fr),Ye.convert(qi),qn)}finally{const mi=null!==V?et.get(V).__webglFramebuffer:null;It.bindFramebuffer(36160,mi)}}},this.copyFramebufferToTexture=function(te,Ce,Ve=0){if(!0!==Ce.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Ie=Math.pow(2,-Ve),lt=Math.floor(Ce.image.width*Ie),qn=Math.floor(Ce.image.height*Ie);ct.setTexture2D(Ce,0),nt.copyTexSubImage2D(3553,Ve,0,0,te.x,te.y,lt,qn),It.unbindTexture()},this.copyTextureToTexture=function(te,Ce,Ve,Ie=0){const lt=Ce.image.width,qn=Ce.image.height,oi=Ye.convert(Ve.format),bi=Ye.convert(Ve.type);ct.setTexture2D(Ve,0),nt.pixelStorei(37440,Ve.flipY),nt.pixelStorei(37441,Ve.premultiplyAlpha),nt.pixelStorei(3317,Ve.unpackAlignment),Ce.isDataTexture?nt.texSubImage2D(3553,Ie,te.x,te.y,lt,qn,oi,bi,Ce.image.data):Ce.isCompressedTexture?nt.compressedTexSubImage2D(3553,Ie,te.x,te.y,Ce.mipmaps[0].width,Ce.mipmaps[0].height,oi,Ce.mipmaps[0].data):nt.texSubImage2D(3553,Ie,te.x,te.y,oi,bi,Ce.image),0===Ie&&Ve.generateMipmaps&&nt.generateMipmap(3553),It.unbindTexture()},this.copyTextureToTexture3D=function(te,Ce,Ve,Ie,lt=0){if(C.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const qn=te.max.x-te.min.x+1,oi=te.max.y-te.min.y+1,bi=te.max.z-te.min.z+1,mi=Ye.convert(Ie.format),fr=Ye.convert(Ie.type);let qi;if(Ie.isData3DTexture)ct.setTexture3D(Ie,0),qi=32879;else{if(!Ie.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ct.setTexture2DArray(Ie,0),qi=35866}nt.pixelStorei(37440,Ie.flipY),nt.pixelStorei(37441,Ie.premultiplyAlpha),nt.pixelStorei(3317,Ie.unpackAlignment);const Ji=nt.getParameter(3314),ds=nt.getParameter(32878),Mm=nt.getParameter(3316),Jy=nt.getParameter(3315),Qy=nt.getParameter(32877),cu=Ve.isCompressedTexture?Ve.mipmaps[0]:Ve.image;nt.pixelStorei(3314,cu.width),nt.pixelStorei(32878,cu.height),nt.pixelStorei(3316,te.min.x),nt.pixelStorei(3315,te.min.y),nt.pixelStorei(32877,te.min.z),Ve.isDataTexture||Ve.isData3DTexture?nt.texSubImage3D(qi,lt,Ce.x,Ce.y,Ce.z,qn,oi,bi,mi,fr,cu.data):Ve.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),nt.compressedTexSubImage3D(qi,lt,Ce.x,Ce.y,Ce.z,qn,oi,bi,mi,cu.data)):nt.texSubImage3D(qi,lt,Ce.x,Ce.y,Ce.z,qn,oi,bi,mi,fr,cu),nt.pixelStorei(3314,Ji),nt.pixelStorei(32878,ds),nt.pixelStorei(3316,Mm),nt.pixelStorei(3315,Jy),nt.pixelStorei(32877,Qy),0===lt&&Ie.generateMipmaps&&nt.generateMipmap(qi),It.unbindTexture()},this.initTexture=function(te){ct.setTexture2D(te,0),It.unbindTexture()},this.resetState=function(){N=0,F=0,V=null,It.reset(),fi.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}hr.prototype.isWebGLRenderer=!0,class J8 extends hr{}.prototype.isWebGL1Renderer=!0;class PE{constructor(e,t=25e-5){this.name="",this.color=new Ut(e),this.density=t}clone(){return new PE(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}PE.prototype.isFogExp2=!0;class IE{constructor(e,t=1,i=1e3){this.name="",this.color=new Ut(e),this.near=t,this.far=i}clone(){return new IE(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}IE.prototype.isFog=!0;class LE extends Zi{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}LE.prototype.isScene=!0;class Ry{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=B0,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Za()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Za()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Za()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Ry.prototype.isInterleavedBuffer=!0;const oa=new Y;class tl{constructor(e,t,i,s=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)oa.fromBufferAttribute(this,t),oa.applyMatrix4(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)oa.fromBufferAttribute(this,t),oa.applyNormalMatrix(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)oa.fromBufferAttribute(this,t),oa.transformDirection(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,o){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[s+o])}return new Cr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new tl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}tl.prototype.isInterleavedBufferAttribute=!0;class ND extends Us{constructor(e){super(),this.type="SpriteMaterial",this.color=new Ut(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Py;ND.prototype.isSpriteMaterial=!0;const X0=new Y,Iy=new Y,Ly=new Y,Fy=new at,Y0=new at,n3=new Ft,FE=new Y,K0=new Y,NE=new Y,i3=new at,OD=new at,r3=new at;function OE(n,e,t,i,s,o){Fy.subVectors(n,t).addScalar(.5).multiply(i),void 0!==s?(Y0.x=o*Fy.x-s*Fy.y,Y0.y=s*Fy.x+o*Fy.y):Y0.copy(Fy),n.copy(e),n.x+=Y0.x,n.y+=Y0.y,n.applyMatrix4(n3)}(class s3 extends Zi{constructor(e){if(super(),this.type="Sprite",void 0===Py){Py=new xn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Ry(t,5);Py.setIndex([0,1,2,0,2,3]),Py.setAttribute("position",new tl(i,3,0,!1)),Py.setAttribute("uv",new tl(i,2,3,!1))}this.geometry=Py,this.material=void 0!==e?e:new ND,this.center=new at(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Iy.setFromMatrixScale(this.matrixWorld),n3.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ly.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Iy.multiplyScalar(-Ly.z);const i=this.material.rotation;let s,o;0!==i&&(o=Math.cos(i),s=Math.sin(i));const l=this.center;OE(FE.set(-.5,-.5,0),Ly,l,Iy,s,o),OE(K0.set(.5,-.5,0),Ly,l,Iy,s,o),OE(NE.set(.5,.5,0),Ly,l,Iy,s,o),i3.set(0,0),OD.set(1,0),r3.set(1,1);let u=e.ray.intersectTriangle(FE,K0,NE,!1,X0);if(null===u&&(OE(K0.set(-.5,.5,0),Ly,l,Iy,s,o),OD.set(0,1),u=e.ray.intersectTriangle(FE,NE,K0,!1,X0),null===u))return;const f=e.ray.origin.distanceTo(X0);f<e.near||f>e.far||t.push({distance:f,point:X0.clone(),uv:Vs.getUV(X0,FE,K0,NE,i3,OD,r3,new at),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const a3=new Y,l3=new Wi,c3=new Wi,e6=new Y,u3=new Ft;class BD extends Hs{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ft,this.bindMatrixInverse=new Ft}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Wi,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,s=this.geometry;l3.fromBufferAttribute(s.attributes.skinIndex,e),c3.fromBufferAttribute(s.attributes.skinWeight,e),a3.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const l=c3.getComponent(o);if(0!==l){const u=l3.getComponent(o);u3.multiplyMatrices(i.bones[u].matrixWorld,i.boneInverses[u]),t.addScaledVector(e6.copy(a3).applyMatrix4(u3),l)}}return t.applyMatrix4(this.bindMatrixInverse)}}BD.prototype.isSkinnedMesh=!0;(class kD extends Zi{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class Ny extends Fa{constructor(e=null,t=1,i=1,s,o,l,u,f,m=no,y=no,v,x){super(null,l,u,f,m,y,s,o,v,x),this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}).prototype.isDataTexture=!0;class Oy extends Cr{constructor(e,t,i,s=1){"number"==typeof i&&(s=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Oy.prototype.isInstancedBufferAttribute=!0;const d3=new Ft,f3=new Ft,kE=[],$0=new Hs;(class p3 extends Hs{constructor(e,t,i){super(e,t),this.instanceMatrix=new Oy(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,s=this.count;if($0.geometry=this.geometry,$0.material=this.material,void 0!==$0.material)for(let o=0;o<s;o++){this.getMatrixAt(o,d3),f3.multiplyMatrices(i,d3),$0.matrixWorld=f3,$0.raycast(e,kE);for(let l=0,u=kE.length;l<u;l++){const f=kE[l];f.instanceId=o,f.object=this,t.push(f)}kE.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Oy(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class Gs extends Us{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ut(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Gs.prototype.isLineBasicMaterial=!0;const m3=new Y,g3=new Y,y3=new Ft,UD=new Yd,VE=new Kc;class Zc extends Zi{constructor(e=new xn,t=new Gs){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let s=1,o=t.count;s<o;s++)m3.fromBufferAttribute(t,s-1),g3.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=m3.distanceTo(g3);e.setAttribute("lineDistance",new Kt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,l=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),VE.copy(i.boundingSphere),VE.applyMatrix4(s),VE.radius+=o,!1===e.ray.intersectsSphere(VE))return;y3.copy(s).invert(),UD.copy(e.ray).applyMatrix4(y3);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),f=u*u,m=new Y,y=new Y,v=new Y,x=new Y,b=this.isLineSegments?2:1;if(i.isBufferGeometry){const E=i.index,A=i.attributes.position;if(null!==E)for(let V=Math.max(0,l.start),k=Math.min(E.count,l.start+l.count)-1;V<k;V+=b){const G=E.getX(V),ee=E.getX(V+1);if(m.fromBufferAttribute(A,G),y.fromBufferAttribute(A,ee),UD.distanceSqToSegment(m,y,x,v)>f)continue;x.applyMatrix4(this.matrixWorld);const ue=e.ray.origin.distanceTo(x);ue<e.near||ue>e.far||t.push({distance:ue,point:v.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}else for(let V=Math.max(0,l.start),k=Math.min(A.count,l.start+l.count)-1;V<k;V+=b){if(m.fromBufferAttribute(A,V),y.fromBufferAttribute(A,V+1),UD.distanceSqToSegment(m,y,x,v)>f)continue;x.applyMatrix4(this.matrixWorld);const ee=e.ray.origin.distanceTo(x);ee<e.near||ee>e.far||t.push({distance:ee,point:v.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=s.length;o<l;o++){const u=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Zc.prototype.isLine=!0;const _3=new Y,v3=new Y;class By extends Zc{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let s=0,o=t.count;s<o;s+=2)_3.fromBufferAttribute(t,s),v3.fromBufferAttribute(t,s+1),i[s]=0===s?0:i[s-1],i[s+1]=i[s]+_3.distanceTo(v3);e.setAttribute("lineDistance",new Kt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}By.prototype.isLineSegments=!0;(class x3 extends Zc{constructor(e,t){super(e,t),this.type="LineLoop"}}).prototype.isLineLoop=!0;class ky extends Us{constructor(e){super(),this.type="PointsMaterial",this.color=new Ut(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}ky.prototype.isPointsMaterial=!0;const b3=new Ft,zD=new Yd,UE=new Kc,zE=new Y;class HD extends Zi{constructor(e=new xn,t=new ky){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,o=e.params.Points.threshold,l=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),UE.copy(i.boundingSphere),UE.applyMatrix4(s),UE.radius+=o,!1===e.ray.intersectsSphere(UE))return;b3.copy(s).invert(),zD.copy(e.ray).applyMatrix4(b3);const u=o/((this.scale.x+this.scale.y+this.scale.z)/3),f=u*u;if(i.isBufferGeometry){const m=i.index,v=i.attributes.position;if(null!==m)for(let E=Math.max(0,l.start),C=Math.min(m.count,l.start+l.count);E<C;E++){const A=m.getX(E);zE.fromBufferAttribute(v,A),w3(zE,A,f,s,e,t,this)}else for(let E=Math.max(0,l.start),C=Math.min(v.count,l.start+l.count);E<C;E++)zE.fromBufferAttribute(v,E),w3(zE,E,f,s,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,l=s.length;o<l;o++){const u=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=o}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function w3(n,e,t,i,s,o,l){const u=zD.distanceSqToPoint(n);if(u<t){const f=new Y;zD.closestPointToPoint(n,f),f.applyMatrix4(i);const m=s.ray.origin.distanceTo(f);if(m<s.near||m>s.far)return;o.push({distance:m,distanceToRay:Math.sqrt(u),point:f,index:e,face:null,object:l})}}HD.prototype.isPoints=!0,class n6 extends Fa{constructor(e,t,i,s,o,l,u,f,m){super(e,t,i,s,o,l,u,f,m),this.minFilter=void 0!==l?l:Bs,this.magFilter=void 0!==o?o:Bs,this.generateMipmaps=!1;const y=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function v(){y.needsUpdate=!0,e.requestVideoFrameCallback(v)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e==0&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class i6 extends Fa{constructor(e,t,i){super({width:e,height:t}),this.format=i,this.magFilter=no,this.minFilter=no,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class M3 extends Fa{constructor(e,t,i,s,o,l,u,f,m,y,v,x){super(null,l,u,f,m,y,s,o,v,x),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class r6 extends Fa{constructor(e,t,i,s,o,l,u,f,m){super(e,t,i,s,o,l,u,f,m),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class Ll{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),o=0;t.push(0);for(let l=1;l<=e;l++)i=this.getPoint(l/e),o+=i.distanceTo(s),t.push(o),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const o=i.length;let l;l=t||e*i[o-1];let m,u=0,f=o-1;for(;u<=f;)if(s=Math.floor(u+(f-u)/2),m=i[s]-l,m<0)u=s+1;else{if(!(m>0)){f=s;break}f=s-1}if(s=f,i[s]===l)return s/(o-1);const y=i[s];return(s+(l-y)/(i[s+1]-y))/(o-1)}getTangent(e,t){let s=e-1e-4,o=e+1e-4;s<0&&(s=0),o>1&&(o=1);const l=this.getPoint(s),u=this.getPoint(o),f=t||(l.isVector2?new at:new Y);return f.copy(u).sub(l).normalize(),f}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Y,s=[],o=[],l=[],u=new Y,f=new Ft;for(let b=0;b<=e;b++)s[b]=this.getTangentAt(b/e,new Y);o[0]=new Y,l[0]=new Y;let m=Number.MAX_VALUE;const y=Math.abs(s[0].x),v=Math.abs(s[0].y),x=Math.abs(s[0].z);y<=m&&(m=y,i.set(1,0,0)),v<=m&&(m=v,i.set(0,1,0)),x<=m&&i.set(0,0,1),u.crossVectors(s[0],i).normalize(),o[0].crossVectors(s[0],u),l[0].crossVectors(s[0],o[0]);for(let b=1;b<=e;b++){if(o[b]=o[b-1].clone(),l[b]=l[b-1].clone(),u.crossVectors(s[b-1],s[b]),u.length()>Number.EPSILON){u.normalize();const E=Math.acos(ws(s[b-1].dot(s[b]),-1,1));o[b].applyMatrix4(f.makeRotationAxis(u,E))}l[b].crossVectors(s[b],o[b])}if(!0===t){let b=Math.acos(ws(o[0].dot(o[e]),-1,1));b/=e,s[0].dot(u.crossVectors(o[0],o[e]))>0&&(b=-b);for(let E=1;E<=e;E++)o[E].applyMatrix4(f.makeRotationAxis(s[E],b*E)),l[E].crossVectors(s[E],o[E])}return{tangents:s,normals:o,binormals:l}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class tf extends Ll{constructor(e=0,t=0,i=1,s=1,o=0,l=2*Math.PI,u=!1,f=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=l,this.aClockwise=u,this.aRotation=f}getPoint(e,t){const i=t||new at,s=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const l=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(o=l?0:s),!0===this.aClockwise&&!l&&(o===s?o=-s:o-=s);const u=this.aStartAngle+e*o;let f=this.aX+this.xRadius*Math.cos(u),m=this.aY+this.yRadius*Math.sin(u);if(0!==this.aRotation){const y=Math.cos(this.aRotation),v=Math.sin(this.aRotation),x=f-this.aX,b=m-this.aY;f=x*y-b*v+this.aX,m=x*v+b*y+this.aY}return i.set(f,m)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}tf.prototype.isEllipseCurve=!0;class E3 extends tf{constructor(e,t,i,s,o,l){super(e,t,i,i,s,o,l),this.type="ArcCurve"}}function GD(){let n=0,e=0,t=0,i=0;function s(o,l,u,f){n=o,e=u,t=-3*o+3*l-2*u-f,i=2*o-2*l+u+f}return{initCatmullRom:function(o,l,u,f,m){s(l,u,m*(u-o),m*(f-l))},initNonuniformCatmullRom:function(o,l,u,f,m,y,v){let x=(l-o)/m-(u-o)/(m+y)+(u-l)/y,b=(u-l)/y-(f-l)/(y+v)+(f-u)/v;x*=y,b*=y,s(l,u,x,b)},calc:function(o){const l=o*o;return n+e*o+t*l+i*(l*o)}}}E3.prototype.isArcCurve=!0;const HE=new Y,WD=new GD,qD=new GD,jD=new GD;class S3 extends Ll{constructor(e=[],t=!1,i="centripetal",s=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new Y){const i=t,s=this.points,o=s.length,l=(o-(this.closed?0:1))*e;let m,y,u=Math.floor(l),f=l-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===f&&u===o-1&&(u=o-2,f=1),this.closed||u>0?m=s[(u-1)%o]:(HE.subVectors(s[0],s[1]).add(s[0]),m=HE);const v=s[u%o],x=s[(u+1)%o];if(this.closed||u+2<o?y=s[(u+2)%o]:(HE.subVectors(s[o-1],s[o-2]).add(s[o-1]),y=HE),"centripetal"===this.curveType||"chordal"===this.curveType){const b="chordal"===this.curveType?.5:.25;let E=Math.pow(m.distanceToSquared(v),b),C=Math.pow(v.distanceToSquared(x),b),A=Math.pow(x.distanceToSquared(y),b);C<1e-4&&(C=1),E<1e-4&&(E=C),A<1e-4&&(A=C),WD.initNonuniformCatmullRom(m.x,v.x,x.x,y.x,E,C,A),qD.initNonuniformCatmullRom(m.y,v.y,x.y,y.y,E,C,A),jD.initNonuniformCatmullRom(m.z,v.z,x.z,y.z,E,C,A)}else"catmullrom"===this.curveType&&(WD.initCatmullRom(m.x,v.x,x.x,y.x,this.tension),qD.initCatmullRom(m.y,v.y,x.y,y.y,this.tension),jD.initCatmullRom(m.z,v.z,x.z,y.z,this.tension));return i.set(WD.calc(f),qD.calc(f),jD.calc(f)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push((new Y).fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function C3(n,e,t,i,s){const o=.5*(i-e),l=.5*(s-t),u=n*n;return(2*t-2*i+o+l)*(n*u)+(-3*t+3*i-2*o-l)*u+o*n+t}function Z0(n,e,t,i){return function s6(n,e){const t=1-n;return t*t*e}(n,e)+function o6(n,e){return 2*(1-n)*n*e}(n,t)+function a6(n,e){return n*n*e}(n,i)}function J0(n,e,t,i,s){return function l6(n,e){const t=1-n;return t*t*t*e}(n,e)+function c6(n,e){const t=1-n;return 3*t*t*n*e}(n,t)+function u6(n,e){return 3*(1-n)*n*n*e}(n,i)+function h6(n,e){return n*n*n*e}(n,s)}S3.prototype.isCatmullRomCurve3=!0;class XD extends Ll{constructor(e=new at,t=new at,i=new at,s=new at){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new at){const i=t,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return i.set(J0(e,s.x,o.x,l.x,u.x),J0(e,s.y,o.y,l.y,u.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}XD.prototype.isCubicBezierCurve=!0;class T3 extends Ll{constructor(e=new Y,t=new Y,i=new Y,s=new Y){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new Y){const i=t,s=this.v0,o=this.v1,l=this.v2,u=this.v3;return i.set(J0(e,s.x,o.x,l.x,u.x),J0(e,s.y,o.y,l.y,u.y),J0(e,s.z,o.z,l.z,u.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}T3.prototype.isCubicBezierCurve3=!0;class GE extends Ll{constructor(e=new at,t=new at){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new at){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new at;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}GE.prototype.isLineCurve=!0;class YD extends Ll{constructor(e=new at,t=new at,i=new at){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new at){const i=t,s=this.v0,o=this.v1,l=this.v2;return i.set(Z0(e,s.x,o.x,l.x),Z0(e,s.y,o.y,l.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}YD.prototype.isQuadraticBezierCurve=!0;class KD extends Ll{constructor(e=new Y,t=new Y,i=new Y){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Y){const i=t,s=this.v0,o=this.v1,l=this.v2;return i.set(Z0(e,s.x,o.x,l.x),Z0(e,s.y,o.y,l.y),Z0(e,s.z,o.z,l.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}KD.prototype.isQuadraticBezierCurve3=!0;class $D extends Ll{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new at){const i=t,s=this.points,o=(s.length-1)*e,l=Math.floor(o),u=o-l,f=s[0===l?l:l-1],m=s[l],y=s[l>s.length-2?s.length-1:l+1],v=s[l>s.length-3?s.length-1:l+2];return i.set(C3(u,f.x,m.x,y.x,v.x),C3(u,f.y,m.y,y.y,v.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push((new at).fromArray(s))}return this}}$D.prototype.isSplineCurve=!0;var ZD=Object.freeze({__proto__:null,ArcCurve:E3,CatmullRomCurve3:S3,CubicBezierCurve:XD,CubicBezierCurve3:T3,EllipseCurve:tf,LineCurve:GE,LineCurve3:class d6 extends Ll{constructor(e=new Y,t=new Y){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Y){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:YD,QuadraticBezierCurve3:KD,SplineCurve:$D});class f6 extends Ll{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new GE(t,e))}getPoint(e,t){const i=e*this.getLength(),s=this.getCurveLengths();let o=0;for(;o<s.length;){if(s[o]>=i){const l=s[o]-i,u=this.curves[o],f=u.getLength();return u.getPointAt(0===f?0:1-l/f,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,o=this.curves;s<o.length;s++){const l=o[s],f=l.getPoints(l.isEllipseCurve?2*e:l.isLineCurve||l.isLineCurve3?1:l.isSplineCurve?e*l.points.length:e);for(let m=0;m<f.length;m++){const y=f[m];i&&i.equals(y)||(t.push(y),i=y)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push((new ZD[s.type]).fromJSON(s))}return this}}class Q0 extends f6{constructor(e){super(),this.type="Path",this.currentPoint=new at,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new GE(this.currentPoint.clone(),new at(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const o=new YD(this.currentPoint.clone(),new at(e,t),new at(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,o,l){const u=new XD(this.currentPoint.clone(),new at(e,t),new at(i,s),new at(o,l));return this.curves.push(u),this.currentPoint.set(o,l),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new $D(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,o,l){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,s,o,l),this}absarc(e,t,i,s,o,l){return this.absellipse(e,t,i,i,s,o,l),this}ellipse(e,t,i,s,o,l,u,f){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,s,o,l,u,f),this}absellipse(e,t,i,s,o,l,u,f){const m=new tf(e,t,i,s,o,l,u,f);if(this.curves.length>0){const v=m.getPoint(0);v.equals(this.currentPoint)||this.lineTo(v.x,v.y)}this.curves.push(m);const y=m.getPoint(1);return this.currentPoint.copy(y),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}new Y,new Y,new Y,new Vs;class Mh extends Q0{constructor(e){super(e),this.uuid=Za(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push((new Q0).fromJSON(s))}return this}}function D3(n,e,t,i,s){let o,l;if(s===function R6(n,e,t,i){let s=0;for(let o=e,l=t-i;o<t;o+=i)s+=(n[l]-n[o])*(n[o+1]+n[l+1]),l=o;return s}(n,e,t,i)>0)for(o=e;o<t;o+=i)l=I3(o,n[o],n[o+1],l);else for(o=t-i;o>=e;o-=i)l=I3(o,n[o],n[o+1],l);return l&&ZE(l,l.next)&&(ix(l),l=l.next),l}function rf(n,e){if(!n)return n;e||(e=n);let i,t=n;do{if(i=!1,t.steiner||!ZE(t,t.next)&&0!==Jr(t.prev,t,t.next))t=t.next;else{if(ix(t),t=e=t.prev,t===t.next)break;i=!0}}while(i||t!==e);return e}function tx(n,e,t,i,s,o,l){if(!n)return;!l&&o&&function E6(n,e,t,i){let s=n;do{null===s.z&&(s.z=QD(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,function S6(n){let e,t,i,s,o,l,u,f,m=1;do{for(t=n,n=null,o=null,l=0;t;){for(l++,i=t,u=0,e=0;e<m&&(u++,i=i.nextZ,i);e++);for(f=m;u>0||f>0&&i;)0!==u&&(0===f||!i||t.z<=i.z)?(s=t,t=t.nextZ,u--):(s=i,i=i.nextZ,f--),o?o.nextZ=s:n=s,s.prevZ=o,o=s;t=i}o.nextZ=null,m*=2}while(l>1)}(s)}(n,i,s,o);let f,m,u=n;for(;n.prev!==n.next;)if(f=n.prev,m=n.next,o?g6(n,i,s,o):m6(n))e.push(f.i/t),e.push(n.i/t),e.push(m.i/t),ix(n),n=m.next,u=m.next;else if((n=m)===u){l?1===l?tx(n=y6(rf(n),e,t),e,t,i,s,o,2):2===l&&_6(n,e,t,i,s,o):tx(rf(n),e,t,i,s,o,1);break}}function m6(n){const e=n.prev,t=n,i=n.next;if(Jr(e,t,i)>=0)return!1;let s=n.next.next;for(;s!==n.prev;){if(Uy(e.x,e.y,t.x,t.y,i.x,i.y,s.x,s.y)&&Jr(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function g6(n,e,t,i){const s=n.prev,o=n,l=n.next;if(Jr(s,o,l)>=0)return!1;const m=s.x>o.x?s.x>l.x?s.x:l.x:o.x>l.x?o.x:l.x,y=s.y>o.y?s.y>l.y?s.y:l.y:o.y>l.y?o.y:l.y,v=QD(s.x<o.x?s.x<l.x?s.x:l.x:o.x<l.x?o.x:l.x,s.y<o.y?s.y<l.y?s.y:l.y:o.y<l.y?o.y:l.y,e,t,i),x=QD(m,y,e,t,i);let b=n.prevZ,E=n.nextZ;for(;b&&b.z>=v&&E&&E.z<=x;){if(b!==n.prev&&b!==n.next&&Uy(s.x,s.y,o.x,o.y,l.x,l.y,b.x,b.y)&&Jr(b.prev,b,b.next)>=0||(b=b.prevZ,E!==n.prev&&E!==n.next&&Uy(s.x,s.y,o.x,o.y,l.x,l.y,E.x,E.y)&&Jr(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;b&&b.z>=v;){if(b!==n.prev&&b!==n.next&&Uy(s.x,s.y,o.x,o.y,l.x,l.y,b.x,b.y)&&Jr(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;E&&E.z<=x;){if(E!==n.prev&&E!==n.next&&Uy(s.x,s.y,o.x,o.y,l.x,l.y,E.x,E.y)&&Jr(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function y6(n,e,t){let i=n;do{const s=i.prev,o=i.next.next;!ZE(s,o)&&R3(s,i,i.next,o)&&nx(s,o)&&nx(o,s)&&(e.push(s.i/t),e.push(i.i/t),e.push(o.i/t),ix(i),ix(i.next),i=n=o),i=i.next}while(i!==n);return rf(i)}function _6(n,e,t,i,s,o){let l=n;do{let u=l.next.next;for(;u!==l.prev;){if(l.i!==u.i&&T6(l,u)){let f=P3(l,u);return l=rf(l,l.next),f=rf(f,f.next),tx(l,e,t,i,s,o),void tx(f,e,t,i,s,o)}u=u.next}l=l.next}while(l!==n)}function x6(n,e){return n.x-e.x}function b6(n,e){if(e=function w6(n,e){let t=e;const i=n.x,s=n.y;let l,o=-1/0;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const x=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(x<=i&&x>o){if(o=x,x===i){if(s===t.y)return t;if(s===t.next.y)return t.next}l=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!l)return null;if(i===o)return l;const u=l,f=l.x,m=l.y;let v,y=1/0;t=l;do{i>=t.x&&t.x>=f&&i!==t.x&&Uy(s<m?i:o,s,f,m,s<m?o:i,s,t.x,t.y)&&(v=Math.abs(s-t.y)/(i-t.x),nx(t,n)&&(v<y||v===y&&(t.x>l.x||t.x===l.x&&M6(l,t)))&&(l=t,y=v)),t=t.next}while(t!==u);return l}(n,e),e){const t=P3(e,n);rf(e,e.next),rf(t,t.next)}}function M6(n,e){return Jr(n.prev,n,e.prev)<0&&Jr(e.next,n,n.next)<0}function QD(n,e,t,i,s){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*s)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function C6(n){let e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function Uy(n,e,t,i,s,o,l,u){return(s-l)*(e-u)-(n-l)*(o-u)>=0&&(n-l)*(i-u)-(t-l)*(e-u)>=0&&(t-l)*(o-u)-(s-l)*(i-u)>=0}function T6(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function A6(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&R3(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(nx(n,e)&&nx(e,n)&&function D6(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,o=(n.y+e.y)/2;do{t.y>o!=t.next.y>o&&t.next.y!==t.y&&s<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next}while(t!==n);return i}(n,e)&&(Jr(n.prev,n,e.prev)||Jr(n,e.prev,e))||ZE(n,e)&&Jr(n.prev,n,n.next)>0&&Jr(e.prev,e,e.next)>0)}function Jr(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function ZE(n,e){return n.x===e.x&&n.y===e.y}function R3(n,e,t,i){const s=QE(Jr(n,e,t)),o=QE(Jr(n,e,i)),l=QE(Jr(t,i,n)),u=QE(Jr(t,i,e));return!!(s!==o&&l!==u||0===s&&JE(n,t,e)||0===o&&JE(n,i,e)||0===l&&JE(t,n,i)||0===u&&JE(t,e,i))}function JE(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function QE(n){return n>0?1:n<0?-1:0}function nx(n,e){return Jr(n.prev,n,n.next)<0?Jr(n,e,n.next)>=0&&Jr(n,n.prev,e)>=0:Jr(n,e,n.prev)<0||Jr(n,n.next,e)<0}function P3(n,e){const t=new eR(n.i,n.x,n.y),i=new eR(e.i,e.x,e.y),s=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function I3(n,e,t,i){const s=new eR(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function ix(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function eR(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Eh{static area(e){const t=e.length;let i=0;for(let s=t-1,o=0;o<t;s=o++)i+=e[s].x*e[o].y-e[o].x*e[s].y;return.5*i}static isClockWise(e){return Eh.area(e)<0}static triangulateShape(e,t){const i=[],s=[],o=[];L3(e),F3(i,e);let l=e.length;t.forEach(L3);for(let f=0;f<t.length;f++)s.push(l),l+=t[f].length,F3(i,t[f]);const u=function(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let o=D3(n,0,s,t,!0);const l=[];if(!o||o.next===o.prev)return l;let u,f,m,y,v,x,b;if(i&&(o=function v6(n,e,t,i){const s=[];let o,l,u,f,m;for(o=0,l=e.length;o<l;o++)u=e[o]*i,f=o<l-1?e[o+1]*i:n.length,m=D3(n,u,f,i,!1),m===m.next&&(m.steiner=!0),s.push(C6(m));for(s.sort(x6),o=0;o<s.length;o++)b6(s[o],t),t=rf(t,t.next);return t}(n,e,o,t)),n.length>80*t){u=m=n[0],f=y=n[1];for(let E=t;E<s;E+=t)v=n[E],x=n[E+1],v<u&&(u=v),x<f&&(f=x),v>m&&(m=v),x>y&&(y=x);b=Math.max(m-u,y-f),b=0!==b?1/b:0}return tx(o,l,t,u,f,b),l}(i,s);for(let f=0;f<u.length;f+=3)o.push(u.slice(f,f+3));return o}}function L3(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function F3(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class sf extends xn{constructor(e=new Mh([new at(.5,.5),new at(-.5,.5),new at(-.5,-.5),new at(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],o=[];for(let u=0,f=e.length;u<f;u++)l(e[u]);function l(u){const f=[],m=void 0!==t.curveSegments?t.curveSegments:12,y=void 0!==t.steps?t.steps:1;let v=void 0!==t.depth?t.depth:1,x=void 0===t.bevelEnabled||t.bevelEnabled,b=void 0!==t.bevelThickness?t.bevelThickness:.2,E=void 0!==t.bevelSize?t.bevelSize:b-.1,C=void 0!==t.bevelOffset?t.bevelOffset:0,A=void 0!==t.bevelSegments?t.bevelSegments:3;const N=t.extrudePath,F=void 0!==t.UVGenerator?t.UVGenerator:P6;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),v=t.amount);let V,G,ee,oe,ue,k=!1;N&&(V=N.getSpacedPoints(y),k=!0,x=!1,G=N.computeFrenetFrames(y,!1),ee=new Y,oe=new Y,ue=new Y),x||(A=0,b=0,E=0,C=0);const Pe=u.extractPoints(m);let ye=Pe.shape;const q=Pe.holes;if(!Eh.isClockWise(ye)){ye=ye.reverse();for(let et=0,ct=q.length;et<ct;et++){const wt=q[et];Eh.isClockWise(wt)&&(q[et]=wt.reverse())}}const Ze=Eh.triangulateShape(ye,q),_e=ye;for(let et=0,ct=q.length;et<ct;et++)ye=ye.concat(q[et]);function Le(et,ct,wt){return ct||console.error("THREE.ExtrudeGeometry: vec does not exist"),ct.clone().multiplyScalar(wt).add(et)}const Te=ye.length,We=Ze.length;function be(et,ct,wt){let un,jt,si;const kn=et.x-ct.x,An=et.y-ct.y,Qr=wt.x-et.x,xr=wt.y-et.y,re=kn*kn+An*An;if(Math.abs(kn*xr-An*Qr)>Number.EPSILON){const qe=Math.sqrt(re),yt=Math.sqrt(Qr*Qr+xr*xr),qt=ct.x-An/qe,nn=ct.y+kn/qe,fi=((wt.x-xr/yt-qt)*xr-(wt.y+Qr/yt-nn)*Qr)/(kn*xr-An*Qr);un=qt+kn*fi-et.x,jt=nn+An*fi-et.y;const xi=un*un+jt*jt;if(xi<=2)return new at(un,jt);si=Math.sqrt(xi/2)}else{let qe=!1;kn>Number.EPSILON?Qr>Number.EPSILON&&(qe=!0):kn<-Number.EPSILON?Qr<-Number.EPSILON&&(qe=!0):Math.sign(An)===Math.sign(xr)&&(qe=!0),qe?(un=-An,jt=kn,si=Math.sqrt(re)):(un=kn,jt=An,si=Math.sqrt(re/2))}return new at(un/si,jt/si)}const ot=[];for(let et=0,ct=_e.length,wt=ct-1,un=et+1;et<ct;et++,wt++,un++)wt===ct&&(wt=0),un===ct&&(un=0),ot[et]=be(_e[et],_e[wt],_e[un]);const ht=[];let bt,mt=ot.concat();for(let et=0,ct=q.length;et<ct;et++){const wt=q[et];bt=[];for(let un=0,jt=wt.length,si=jt-1,kn=un+1;un<jt;un++,si++,kn++)si===jt&&(si=0),kn===jt&&(kn=0),bt[un]=be(wt[un],wt[si],wt[kn]);ht.push(bt),mt=mt.concat(bt)}for(let et=0;et<A;et++){const ct=et/A,wt=b*Math.cos(ct*Math.PI/2),un=E*Math.sin(ct*Math.PI/2)+C;for(let jt=0,si=_e.length;jt<si;jt++){const kn=Le(_e[jt],ot[jt],un);sr(kn.x,kn.y,-wt)}for(let jt=0,si=q.length;jt<si;jt++){const kn=q[jt];bt=ht[jt];for(let An=0,Qr=kn.length;An<Qr;An++){const xr=Le(kn[An],bt[An],un);sr(xr.x,xr.y,-wt)}}}const _n=E+C;for(let et=0;et<Te;et++){const ct=x?Le(ye[et],mt[et],_n):ye[et];k?(oe.copy(G.normals[0]).multiplyScalar(ct.x),ee.copy(G.binormals[0]).multiplyScalar(ct.y),ue.copy(V[0]).add(oe).add(ee),sr(ue.x,ue.y,ue.z)):sr(ct.x,ct.y,0)}for(let et=1;et<=y;et++)for(let ct=0;ct<Te;ct++){const wt=x?Le(ye[ct],mt[ct],_n):ye[ct];k?(oe.copy(G.normals[et]).multiplyScalar(wt.x),ee.copy(G.binormals[et]).multiplyScalar(wt.y),ue.copy(V[et]).add(oe).add(ee),sr(ue.x,ue.y,ue.z)):sr(wt.x,wt.y,v/y*et)}for(let et=A-1;et>=0;et--){const ct=et/A,wt=b*Math.cos(ct*Math.PI/2),un=E*Math.sin(ct*Math.PI/2)+C;for(let jt=0,si=_e.length;jt<si;jt++){const kn=Le(_e[jt],ot[jt],un);sr(kn.x,kn.y,v+wt)}for(let jt=0,si=q.length;jt<si;jt++){const kn=q[jt];bt=ht[jt];for(let An=0,Qr=kn.length;An<Qr;An++){const xr=Le(kn[An],bt[An],un);k?sr(xr.x,xr.y+V[y-1].y,V[y-1].x+wt):sr(xr.x,xr.y,v+wt)}}}function nt(et,ct){let wt=et.length;for(;--wt>=0;){const un=wt;let jt=wt-1;jt<0&&(jt=et.length-1);for(let si=0,kn=y+2*A;si<kn;si++){const An=Te*si,Qr=Te*(si+1);di(ct+un+An,ct+jt+An,ct+jt+Qr,ct+un+Qr)}}}function sr(et,ct,wt){f.push(et),f.push(ct),f.push(wt)}function hi(et,ct,wt){It(et),It(ct),It(wt);const un=s.length/3,jt=F.generateTopUV(i,s,un-3,un-2,un-1);Ai(jt[0]),Ai(jt[1]),Ai(jt[2])}function di(et,ct,wt,un){It(et),It(ct),It(un),It(ct),It(wt),It(un);const jt=s.length/3,si=F.generateSideWallUV(i,s,jt-6,jt-3,jt-2,jt-1);Ai(si[0]),Ai(si[1]),Ai(si[3]),Ai(si[1]),Ai(si[2]),Ai(si[3])}function It(et){s.push(f[3*et+0]),s.push(f[3*et+1]),s.push(f[3*et+2])}function Ai(et){o.push(et.x),o.push(et.y)}(function vi(){const et=s.length/3;if(x){let ct=0,wt=Te*ct;for(let un=0;un<We;un++){const jt=Ze[un];hi(jt[2]+wt,jt[1]+wt,jt[0]+wt)}ct=y+2*A,wt=Te*ct;for(let un=0;un<We;un++){const jt=Ze[un];hi(jt[0]+wt,jt[1]+wt,jt[2]+wt)}}else{for(let ct=0;ct<We;ct++){const wt=Ze[ct];hi(wt[2],wt[1],wt[0])}for(let ct=0;ct<We;ct++){const wt=Ze[ct];hi(wt[0]+Te*y,wt[1]+Te*y,wt[2]+Te*y)}}i.addGroup(et,s.length/3-et,0)})(),function Yn(){const et=s.length/3;let ct=0;nt(_e,ct),ct+=_e.length;for(let wt=0,un=q.length;wt<un;wt++){const jt=q[wt];nt(jt,ct),ct+=jt.length}i.addGroup(et,s.length/3-et,1)}()}this.setAttribute("position",new Kt(s,3)),this.setAttribute("uv",new Kt(o,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function I6(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++)t.shapes.push(n[i].uuid);else t.shapes.push(n.uuid);return void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let o=0,l=e.shapes.length;o<l;o++)i.push(t[e.shapes[o]]);const s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new ZD[s.type]).fromJSON(s)),new sf(i,e.options)}}const P6={generateTopUV:function(n,e,t,i,s){const u=e[3*i],f=e[3*i+1],m=e[3*s],y=e[3*s+1];return[new at(e[3*t],e[3*t+1]),new at(u,f),new at(m,y)]},generateSideWallUV:function(n,e,t,i,s,o){const l=e[3*t],u=e[3*t+1],f=e[3*t+2],m=e[3*i],y=e[3*i+1],v=e[3*i+2],x=e[3*s],b=e[3*s+1],E=e[3*s+2],C=e[3*o],A=e[3*o+1],N=e[3*o+2];return Math.abs(u-y)<Math.abs(l-m)?[new at(l,1-f),new at(m,1-v),new at(x,1-E),new at(C,1-N)]:[new at(u,1-f),new at(y,1-v),new at(b,1-E),new at(A,1-N)]}};class sx extends xn{constructor(e=new Mh([new at(0,.5),new at(-.5,-.5),new at(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],o=[],l=[];let u=0,f=0;if(!1===Array.isArray(e))m(e);else for(let y=0;y<e.length;y++)m(e[y]),this.addGroup(u,f,y),u+=f,f=0;function m(y){const v=s.length/3,x=y.extractPoints(t);let b=x.shape;const E=x.holes;!1===Eh.isClockWise(b)&&(b=b.reverse());for(let A=0,N=E.length;A<N;A++){const F=E[A];!0===Eh.isClockWise(F)&&(E[A]=F.reverse())}const C=Eh.triangulateShape(b,E);for(let A=0,N=E.length;A<N;A++)b=b.concat(E[A]);for(let A=0,N=b.length;A<N;A++){const F=b[A];s.push(F.x,F.y,0),o.push(0,0,1),l.push(F.x,F.y)}for(let A=0,N=C.length;A<N;A++){const F=C[A];i.push(F[0]+v,F[1]+v,F[2]+v),f+=3}}this.setIndex(i),this.setAttribute("position",new Kt(s,3)),this.setAttribute("normal",new Kt(o,3)),this.setAttribute("uv",new Kt(l,2))}toJSON(){const e=super.toJSON();return function L6(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++)e.shapes.push(n[t].uuid);else e.shapes.push(n.uuid);return e}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++)i.push(t[e.shapes[s]]);return new sx(i,e.curveSegments)}}class tR extends xn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,s=new Y,o=new Y;if(null!==e.index){const l=e.attributes.position,u=e.index;let f=e.groups;0===f.length&&(f=[{start:0,count:u.count,materialIndex:0}]);for(let m=0,y=f.length;m<y;++m){const v=f[m],x=v.start;for(let E=x,C=x+v.count;E<C;E+=3)for(let A=0;A<3;A++){const N=u.getX(E+A),F=u.getX(E+(A+1)%3);s.fromBufferAttribute(l,N),o.fromBufferAttribute(l,F),!0===N3(s,o,i)&&(t.push(s.x,s.y,s.z),t.push(o.x,o.y,o.z))}}}else{const l=e.attributes.position;for(let u=0,f=l.count/3;u<f;u++)for(let m=0;m<3;m++){const v=3*u+(m+1)%3;s.fromBufferAttribute(l,3*u+m),o.fromBufferAttribute(l,v),!0===N3(s,o,i)&&(t.push(s.x,s.y,s.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new Kt(t,3))}}}function N3(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return!0!==t.has(i)&&!0!==t.has(s)&&(t.add(i),t.add(s),!0)}class B3 extends Us{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ut(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}B3.prototype.isShadowMaterial=!0;class k3 extends Il{constructor(e){super(e),this.type="RawShaderMaterial"}}k3.prototype.isRawShaderMaterial=!0;class nR extends Us{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ut(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}nR.prototype.isMeshStandardMaterial=!0;class V3 extends nR{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new at(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ws(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Ut(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ut(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ut(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}V3.prototype.isMeshPhysicalMaterial=!0;class U3 extends Us{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ut(16777215),this.specular=new Ut(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}U3.prototype.isMeshPhongMaterial=!0;class z3 extends Us{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ut(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}z3.prototype.isMeshToonMaterial=!0;class H3 extends Us{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}H3.prototype.isMeshNormalMaterial=!0;class G3 extends Us{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}G3.prototype.isMeshLambertMaterial=!0;class W3 extends Us{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ut(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}W3.prototype.isMeshMatcapMaterial=!0;class q3 extends Gs{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}q3.prototype.isLineDashedMaterial=!0;const F6={ShadowMaterial:B3,SpriteMaterial:ND,RawShaderMaterial:k3,ShaderMaterial:Il,PointsMaterial:ky,MeshPhysicalMaterial:V3,MeshStandardMaterial:nR,MeshPhongMaterial:U3,MeshToonMaterial:z3,MeshNormalMaterial:H3,MeshLambertMaterial:G3,MeshDepthMaterial:ID,MeshDistanceMaterial:LD,MeshBasicMaterial:$c,MeshMatcapMaterial:W3,LineDashedMaterial:q3,LineBasicMaterial:Gs,Material:Us};Us.fromType=function(n){return new F6[n]};const jr={arraySlice:function(n,e,t){return jr.isTypedArray(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(function e(s,o){return n[s]-n[o]}),i},sortedArray:function(n,e,t){const i=n.length,s=new n.constructor(i);for(let o=0,l=0;l!==i;++o){const u=t[o]*e;for(let f=0;f!==e;++f)s[l++]=n[u+f]}return s},flattenJSON:function(n,e,t,i){let s=1,o=n[0];for(;void 0!==o&&void 0===o[i];)o=n[s++];if(void 0===o)return;let l=o[i];if(void 0!==l)if(Array.isArray(l))do{l=o[i],void 0!==l&&(e.push(o.time),t.push.apply(t,l)),o=n[s++]}while(void 0!==o);else if(void 0!==l.toArray)do{l=o[i],void 0!==l&&(e.push(o.time),l.toArray(t,t.length)),o=n[s++]}while(void 0!==o);else do{l=o[i],void 0!==l&&(e.push(o.time),t.push(l)),o=n[s++]}while(void 0!==o)},subclip:function(n,e,t,i,s=30){const o=n.clone();o.name=e;const l=[];for(let f=0;f<o.tracks.length;++f){const m=o.tracks[f],y=m.getValueSize(),v=[],x=[];for(let b=0;b<m.times.length;++b){const E=m.times[b]*s;if(!(E<t||E>=i)){v.push(m.times[b]);for(let C=0;C<y;++C)x.push(m.values[b*y+C])}}0!==v.length&&(m.times=jr.convertArray(v,m.times.constructor),m.values=jr.convertArray(x,m.values.constructor),l.push(m))}o.tracks=l;let u=1/0;for(let f=0;f<o.tracks.length;++f)u>o.tracks[f].times[0]&&(u=o.tracks[f].times[0]);for(let f=0;f<o.tracks.length;++f)o.tracks[f].shift(-1*u);return o.resetDuration(),o},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,o=e/i;for(let l=0;l<s;++l){const u=t.tracks[l],f=u.ValueTypeName;if("bool"===f||"string"===f)continue;const m=n.tracks.find(function(N){return N.name===u.name&&N.ValueTypeName===f});if(void 0===m)continue;let y=0;const v=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(y=v/3);let x=0;const b=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=b/3);const E=u.times.length-1;let C;if(o<=u.times[0])C=jr.arraySlice(u.values,y,v-y);else if(o>=u.times[E]){const N=E*v+y;C=jr.arraySlice(u.values,N,N+v-y)}else{const N=u.createInterpolant(),F=y,V=v-y;N.evaluate(o),C=jr.arraySlice(N.resultBuffer,F,V)}"quaternion"===f&&(new ks).fromArray(C).normalize().conjugate().toArray(C);const A=m.times.length;for(let N=0;N<A;++N){const F=N*b+x;if("quaternion"===f)ks.multiplyQuaternionsFlat(m.values,F,C,0,m.values,F);else{const V=b-2*x;for(let k=0;k<V;++k)m.values[F+k]-=C[k]}}}return n.blendMode=2501,n}};class of{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==s?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],o=t[i-1];e:{t:{let l;n:{i:if(!(e<s)){for(let u=i+2;;){if(void 0===s){if(e<o)break i;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,o)}if(i===u)break;if(o=s,s=t[++i],e<s)break t}l=t.length;break n}if(e>=o)break e;{const u=t[1];e<u&&(i=2,o=u);for(let f=i-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(i===f)break;if(s=o,o=t[--i-1],e>=o)break t}l=i,i=0}}for(;i<l;){const u=i+l>>>1;e<t[u]?l=u:i=u+1}if(s=t[i],o=t[i-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(void 0===s)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,o,e)}this._cachedIndex=i,this.intervalChanged_(i,o,s)}return this.interpolate_(i,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=e*s;for(let l=0;l!==s;++l)t[l]=i[o+l];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}of.prototype.beforeStart_=of.prototype.copySampleValue_,of.prototype.afterEnd_=of.prototype.copySampleValue_;class N6 extends of{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ay,endingEnd:ay}}intervalChanged_(e,t,i){const s=this.parameterPositions;let o=e-2,l=e+1,u=s[o],f=s[l];if(void 0===u)switch(this.getSettings_().endingStart){case ly:o=e,u=2*t-i;break;case 2402:o=s.length-2,u=t+s[o]-s[o+1];break;default:o=e,u=i}if(void 0===f)switch(this.getSettings_().endingEnd){case ly:l=e,f=2*i-t;break;case 2402:l=1,f=i+s[1]-s[0];break;default:l=e-1,f=t}const m=.5*(i-t),y=this.valueSize;this._weightPrev=m/(t-u),this._weightNext=m/(f-i),this._offsetPrev=o*y,this._offsetNext=l*y}interpolate_(e,t,i,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,f=e*u,m=f-u,y=this._offsetPrev,v=this._offsetNext,x=this._weightPrev,b=this._weightNext,E=(i-t)/(s-t),C=E*E,A=C*E,N=-x*A+2*x*C-x*E,F=(1+x)*A+(-1.5-2*x)*C+(-.5+x)*E+1,V=(-1-b)*A+(1.5+b)*C+.5*E,k=b*A-b*C;for(let G=0;G!==u;++G)o[G]=N*l[y+G]+F*l[m+G]+V*l[f+G]+k*l[v+G];return o}}class j3 extends of{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,f=e*u,m=f-u,y=(i-t)/(s-t),v=1-y;for(let x=0;x!==u;++x)o[x]=l[m+x]*v+l[f+x]*y;return o}}class O6 extends of{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Jc{constructor(e,t,i,s){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=jr.convertArray(t,this.TimeBufferType),this.values=jr.convertArray(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:jr.convertArray(e.times,Array),values:jr.convertArray(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new O6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new j3(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new N6(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let o=0,l=s-1;for(;o!==s&&i[o]<e;)++o;for(;-1!==l&&i[l]>t;)--l;if(++l,0!==o||l!==s){o>=l&&(l=Math.max(l,1),o=l-1);const u=this.getValueSize();this.times=jr.arraySlice(i,o,l),this.values=jr.arraySlice(this.values,o*u,l*u)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,o=i.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let u=0;u!==o;u++){const f=i[u];if("number"==typeof f&&isNaN(f)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,f),e=!1;break}if(null!==l&&l>f){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,f,l),e=!1;break}l=f}if(void 0!==s&&jr.isTypedArray(s))for(let u=0,f=s.length;u!==f;++u){const m=s[u];if(isNaN(m)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,m),e=!1;break}}return e}optimize(){const e=jr.arraySlice(this.times),t=jr.arraySlice(this.values),i=this.getValueSize(),s=2302===this.getInterpolation(),o=e.length-1;let l=1;for(let u=1;u<o;++u){let f=!1;const m=e[u];if(m!==e[u+1]&&(1!==u||m!==e[0]))if(s)f=!0;else{const v=u*i,x=v-i,b=v+i;for(let E=0;E!==i;++E){const C=t[v+E];if(C!==t[x+E]||C!==t[b+E]){f=!0;break}}}if(f){if(u!==l){e[l]=e[u];const v=u*i,x=l*i;for(let b=0;b!==i;++b)t[x+b]=t[v+b]}++l}}if(o>0){e[l]=e[o];for(let u=o*i,f=l*i,m=0;m!==i;++m)t[f+m]=t[u+m];++l}return l!==e.length?(this.times=jr.arraySlice(e,0,l),this.values=jr.arraySlice(t,0,l*i)):(this.times=e,this.values=t),this}clone(){const e=jr.arraySlice(this.times,0),t=jr.arraySlice(this.values,0),s=new(0,this.constructor)(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Jc.prototype.TimeBufferType=Float32Array,Jc.prototype.ValueBufferType=Float32Array,Jc.prototype.DefaultInterpolation=2301;class zy extends Jc{}zy.prototype.ValueTypeName="bool",zy.prototype.ValueBufferType=Array,zy.prototype.DefaultInterpolation=2300,zy.prototype.InterpolantFactoryMethodLinear=void 0,zy.prototype.InterpolantFactoryMethodSmooth=void 0;class X3 extends Jc{}X3.prototype.ValueTypeName="color";class oS extends Jc{}oS.prototype.ValueTypeName="number";class B6 extends of{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const o=this.resultBuffer,l=this.sampleValues,u=this.valueSize,f=(i-t)/(s-t);let m=e*u;for(let y=m+u;m!==y;m+=4)ks.slerpFlat(o,0,l,m-u,l,m,f);return o}}class ax extends Jc{InterpolantFactoryMethodLinear(e){return new B6(this.times,this.values,this.getValueSize(),e)}}ax.prototype.ValueTypeName="quaternion",ax.prototype.DefaultInterpolation=2301,ax.prototype.InterpolantFactoryMethodSmooth=void 0;class Hy extends Jc{}Hy.prototype.ValueTypeName="string",Hy.prototype.ValueBufferType=Array,Hy.prototype.DefaultInterpolation=2300,Hy.prototype.InterpolantFactoryMethodLinear=void 0,Hy.prototype.InterpolantFactoryMethodSmooth=void 0;class aS extends Jc{}aS.prototype.ValueTypeName="vector";class lS{constructor(e,t=-1,i,s=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Za(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let l=0,u=i.length;l!==u;++l)t.push(V6(i[l]).scale(s));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,l=i.length;o!==l;++o)t.push(Jc.toJSON(i[o]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const o=t.length,l=[];for(let u=0;u<o;u++){let f=[],m=[];f.push((u+o-1)%o,u,(u+1)%o),m.push(0,1,0);const y=jr.getKeyframeOrder(f);f=jr.sortedArray(f,1,y),m=jr.sortedArray(m,1,y),!s&&0===f[0]&&(f.push(o),m.push(m[0])),l.push(new oS(".morphTargetInfluences["+t[u].name+"]",f,m).scale(1/i))}return new this(e,-1,l)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},o=/^([\w-]*?)([\d]+)$/;for(let u=0,f=e.length;u<f;u++){const m=e[u],y=m.name.match(o);if(y&&y.length>1){const v=y[1];let x=s[v];x||(s[v]=x=[]),x.push(m)}}const l=[];for(const u in s)l.push(this.CreateFromMorphTargetSequence(u,s[u],t,i));return l}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(v,x,b,E,C){if(0!==b.length){const A=[],N=[];jr.flattenJSON(b,A,N,E),0!==A.length&&C.push(new v(x,A,N))}},s=[],o=e.name||"default",l=e.fps||30,u=e.blendMode;let f=e.length||-1;const m=e.hierarchy||[];for(let v=0;v<m.length;v++){const x=m[v].keys;if(x&&0!==x.length)if(x[0].morphTargets){const b={};let E;for(E=0;E<x.length;E++)if(x[E].morphTargets)for(let C=0;C<x[E].morphTargets.length;C++)b[x[E].morphTargets[C]]=-1;for(const C in b){const A=[],N=[];for(let F=0;F!==x[E].morphTargets.length;++F){const V=x[E];A.push(V.time),N.push(V.morphTarget===C?1:0)}s.push(new oS(".morphTargetInfluence["+C+"]",A,N))}f=b.length*l}else{const b=".bones["+t[v].name+"]";i(aS,b+".position",x,"pos",s),i(ax,b+".quaternion",x,"rot",s),i(aS,b+".scale",x,"scl",s)}}return 0===s.length?null:new this(o,f,s,u)}resetDuration(){let t=0;for(let i=0,s=this.tracks.length;i!==s;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function V6(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function k6(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return oS;case"vector":case"vector2":case"vector3":case"vector4":return aS;case"color":return X3;case"quaternion":return ax;case"bool":case"boolean":return zy;case"string":return Hy}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],i=[];jr.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Gy={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};const U6=new class Y3{constructor(e,t,i){const s=this;let f,o=!1,l=0,u=0;const m=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(y){u++,!1===o&&void 0!==s.onStart&&s.onStart(y,l,u),o=!0},this.itemEnd=function(y){l++,void 0!==s.onProgress&&s.onProgress(y,l,u),l===u&&(o=!1,void 0!==s.onLoad&&s.onLoad())},this.itemError=function(y){void 0!==s.onError&&s.onError(y)},this.resolveURL=function(y){return f?f(y):y},this.setURLModifier=function(y){return f=y,this},this.addHandler=function(y,v){return m.push(y,v),this},this.removeHandler=function(y){const v=m.indexOf(y);return-1!==v&&m.splice(v,2),this},this.getHandler=function(y){for(let v=0,x=m.length;v<x;v+=2){const b=m[v],E=m[v+1];if(b.global&&(b.lastIndex=0),b.test(y))return E}return null}}};class Sh{constructor(e){this.manager=void 0!==e?e:U6,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,o){i.load(e,s,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ch={};class Th extends Sh{constructor(e){super(e)}load(e,t,i,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Gy.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(void 0!==Ch[e])return void Ch[e].push({onLoad:t,onProgress:i,onError:s});Ch[e]=[],Ch[e].push({onLoad:t,onProgress:i,onError:s});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),u=this.mimeType,f=this.responseType;fetch(l).then(m=>{if(200===m.status||0===m.status){if(0===m.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===m.body||void 0===m.body.getReader)return m;const y=Ch[e],v=m.body.getReader(),x=m.headers.get("Content-Length"),b=x?parseInt(x):0,E=0!==b;let C=0;const A=new ReadableStream({start(N){!function F(){v.read().then(({done:V,value:k})=>{if(V)N.close();else{C+=k.byteLength;const G=new ProgressEvent("progress",{lengthComputable:E,loaded:C,total:b});for(let ee=0,oe=y.length;ee<oe;ee++){const ue=y[ee];ue.onProgress&&ue.onProgress(G)}N.enqueue(k),F()}})}()}});return new Response(A)}throw Error(`fetch for "${m.url}" responded with ${m.status}: ${m.statusText}`)}).then(m=>{switch(f){case"arraybuffer":return m.arrayBuffer();case"blob":return m.blob();case"document":return m.text().then(y=>(new DOMParser).parseFromString(y,u));case"json":return m.json();default:if(void 0===u)return m.text();{const v=/charset="?([^;"\s]*)"?/i.exec(u),x=v&&v[1]?v[1].toLowerCase():void 0,b=new TextDecoder(x);return m.arrayBuffer().then(E=>b.decode(E))}}}).then(m=>{Gy.add(e,m);const y=Ch[e];delete Ch[e];for(let v=0,x=y.length;v<x;v++){const b=y[v];b.onLoad&&b.onLoad(m)}}).catch(m=>{const y=Ch[e];if(void 0===y)throw this.manager.itemError(e),m;delete Ch[e];for(let v=0,x=y.length;v<x;v++){const b=y[v];b.onError&&b.onError(m)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class cS extends Sh{constructor(e){super(e)}load(e,t,i,s){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=Gy.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const u=z0("img");function f(){y(),Gy.add(e,this),t&&t(this),o.manager.itemEnd(e)}function m(v){y(),s&&s(v),o.manager.itemError(e),o.manager.itemEnd(e)}function y(){u.removeEventListener("load",f,!1),u.removeEventListener("error",m,!1)}return u.addEventListener("load",f,!1),u.addEventListener("error",m,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(u.crossOrigin=this.crossOrigin),o.manager.itemStart(e),u.src=e,u}}class z6 extends Sh{constructor(e){super(e)}load(e,t,i,s){const o=new q0,l=new cS(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let u=0;function f(m){l.load(e[m],function(y){o.images[m]=y,u++,6===u&&(o.needsUpdate=!0,t&&t(o))},void 0,s)}for(let m=0;m<e.length;++m)f(m);return o}}class K3 extends Sh{constructor(e){super(e)}load(e,t,i,s){const o=new Fa,l=new cS(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(u){o.image=u,o.needsUpdate=!0,void 0!==t&&t(o)},i,s),o}}class Qc extends Zi{constructor(e,t=1){super(),this.type="Light",this.color=new Ut(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Qc.prototype.isLight=!0;(class $3 extends Qc{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Zi.DefaultUp),this.updateMatrix(),this.groundColor=new Ut(t)}copy(e){return Qc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}).prototype.isHemisphereLight=!0;const Z3=new Ft,J3=new Y,Q3=new Y;class iR{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new at(512,512),this.map=null,this.mapPass=null,this.matrix=new Ft,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new TE,this._frameExtents=new at(1,1),this._viewportCount=1,this._viewports=[new Wi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;J3.setFromMatrixPosition(e.matrixWorld),t.position.copy(J3),Q3.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Q3),t.updateMatrixWorld(),Z3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Z3),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class eN extends iR{constructor(){super(new vo(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*V0*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||s!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=s,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}eN.prototype.isSpotLightShadow=!0;(class tN extends Qc{constructor(e,t,i=0,s=Math.PI/3,o=0,l=1){super(e,t),this.type="SpotLight",this.position.copy(Zi.DefaultUp),this.updateMatrix(),this.target=new Zi,this.distance=i,this.angle=s,this.penumbra=o,this.decay=l,this.shadow=new eN}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isSpotLight=!0;const nN=new Ft,lx=new Y,rR=new Y;class iN extends iR{constructor(){super(new vo(90,1,.5,500)),this._frameExtents=new at(4,2),this._viewportCount=6,this._viewports=[new Wi(2,1,1,1),new Wi(0,1,1,1),new Wi(3,1,1,1),new Wi(1,1,1,1),new Wi(3,0,1,1),new Wi(1,0,1,1)],this._cubeDirections=[new Y(1,0,0),new Y(-1,0,0),new Y(0,0,1),new Y(0,0,-1),new Y(0,1,0),new Y(0,-1,0)],this._cubeUps=[new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,0,1),new Y(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),lx.setFromMatrixPosition(e.matrixWorld),i.position.copy(lx),rR.copy(i.position),rR.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(rR),i.updateMatrixWorld(),s.makeTranslation(-lx.x,-lx.y,-lx.z),nN.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nN)}}iN.prototype.isPointLightShadow=!0;(class rN extends Qc{constructor(e,t,i=0,s=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new iN}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}).prototype.isPointLight=!0;class sN extends iR{constructor(){super(new AE(-5,5,5,-5,.5,500))}}sN.prototype.isDirectionalLightShadow=!0;(class oN extends Qc{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Zi.DefaultUp),this.updateMatrix(),this.target=new Zi,this.shadow=new sN}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class aN extends Qc{constructor(e,t){super(e,t),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class lN extends Qc{constructor(e,t,i=10,s=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}).prototype.isRectAreaLight=!0;class cN{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Y)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.282095),t.addScaledVector(l[1],.488603*s),t.addScaledVector(l[2],.488603*o),t.addScaledVector(l[3],.488603*i),t.addScaledVector(l[4],i*s*1.092548),t.addScaledVector(l[5],s*o*1.092548),t.addScaledVector(l[6],.315392*(3*o*o-1)),t.addScaledVector(l[7],i*o*1.092548),t.addScaledVector(l[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,o=e.z,l=this.coefficients;return t.copy(l[0]).multiplyScalar(.886227),t.addScaledVector(l[1],1.023328*s),t.addScaledVector(l[2],1.023328*o),t.addScaledVector(l[3],1.023328*i),t.addScaledVector(l[4],.858086*i*s),t.addScaledVector(l[5],.858086*s*o),t.addScaledVector(l[6],.743125*o*o-.247708),t.addScaledVector(l[7],.858086*i*o),t.addScaledVector(l[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const i=e.x,s=e.y,o=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*o,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*i*o,t[8]=.546274*(i*i-s*s)}}cN.prototype.isSphericalHarmonics3=!0;class uS extends Qc{constructor(e=new cN,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}uS.prototype.isLightProbe=!0;class hS{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(i){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class sR extends xn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}let dS;sR.prototype.isInstancedBufferGeometry=!0,class q6 extends Sh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,l=Gy.get(e);if(void 0!==l)return o.manager.itemStart(e),setTimeout(function(){t&&t(l),o.manager.itemEnd(e)},0),l;const u={};u.credentials="anonymous"===this.crossOrigin?"same-origin":"include",u.headers=this.requestHeader,fetch(e,u).then(function(f){return f.blob()}).then(function(f){return createImageBitmap(f,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(f){Gy.add(e,f),t&&t(f),o.manager.itemEnd(e)}).catch(function(f){s&&s(f),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}.prototype.isImageBitmapLoader=!0;class j6 extends Sh{constructor(e){super(e)}load(e,t,i,s){const o=this,l=new Th(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{const f=u.slice(0);(void 0===dS&&(dS=new(window.AudioContext||window.webkitAudioContext)),dS).decodeAudioData(f,function(y){t(y)})}catch(f){s?s(f):console.error(f),o.manager.itemError(e)}},i,s)}}(class X6 extends uS{constructor(e,t,i=1){super(void 0,i);const s=(new Ut).set(e),o=(new Ut).set(t),l=new Y(s.r,s.g,s.b),u=new Y(o.r,o.g,o.b),f=Math.sqrt(Math.PI),m=f*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(u).multiplyScalar(f),this.sh.coefficients[1].copy(l).sub(u).multiplyScalar(m)}}).prototype.isHemisphereLightProbe=!0,class Y6 extends uS{constructor(e,t=1){super(void 0,t);const i=(new Ut).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class eq{constructor(e,t,i){let s,o,l;switch(this.binding=e,this.valueSize=i,t){case"quaternion":s=this._slerp,o=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":s=this._select,o=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:s=this._lerp,o=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=o,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,o=e*s+s;let l=this.cumulativeWeight;if(0===l){for(let u=0;u!==s;++u)i[o+u]=i[u];l=t}else l+=t,this._mixBufferRegion(i,o,0,t/l,s);this.cumulativeWeight=l}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,o=this.cumulativeWeight,l=this.cumulativeWeightAdditive,u=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1&&this._mixBufferRegion(i,s,t*this._origIndex,1-o,t),l>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let f=t,m=t+t;f!==m;++f)if(i[f]!==i[f+t]){u.setValue(i,s);break}}saveOriginalState(){const t=this.buffer,i=this.valueSize,s=i*this._origIndex;this.binding.getValue(t,s);for(let o=i,l=s;o!==l;++o)t[o]=t[s+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,o){if(s>=.5)for(let l=0;l!==o;++l)e[t+l]=e[i+l]}_slerp(e,t,i,s){ks.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,o){const l=this._workIndex*o;ks.multiplyQuaternionsFlat(e,l,e,t,e,i),ks.slerpFlat(e,t,e,t,e,l,s)}_lerp(e,t,i,s,o){const l=1-s;for(let u=0;u!==o;++u){const f=t+u;e[f]=e[f]*l+e[i+u]*s}}_lerpAdditive(e,t,i,s,o){for(let l=0;l!==o;++l){const u=t+l;e[u]=e[u]+e[i+l]*s}}}const oR="\\[\\]\\.:\\/",tq=new RegExp("["+oR+"]","g"),aR="[^"+oR+"]",nq="[^"+oR.replace("\\.","")+"]",iq=/((?:WC+[\/:])*)/.source.replace("WC",aR),rq=/(WCOD+)?/.source.replace("WCOD",nq),sq=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",aR),oq=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",aR),aq=new RegExp("^"+iq+rq+sq+oq+"$"),lq=["material","materials","bones"];class cq{constructor(e,t,i){const s=i||Fr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const s=this._bindings[this._targetGroup.nCachedObjects_];void 0!==s&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=i.length;s!==o;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let Fr=(()=>{class n{constructor(t,i,s){this.path=i,this.parsedPath=s||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,s){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,s):new n(t,i,s)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(tq,"")}static parseTrackName(t){const i=aq.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const s={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},o=s.nodeName&&s.nodeName.lastIndexOf(".");if(void 0!==o&&-1!==o){const l=s.nodeName.substring(o+1);-1!==lq.indexOf(l)&&(s.nodeName=s.nodeName.substring(0,o),s.objectName=l)}if(null===s.propertyName||0===s.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return s}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const s=t.skeleton.getBoneByName(i);if(void 0!==s)return s}if(t.children){const s=function(l){for(let u=0;u<l.length;u++){const f=l[u];if(f.name===i||f.uuid===i)return f;const m=s(f.children);if(m)return m}return null},o=s(t.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const s=this.resolvedProperty;for(let o=0,l=s.length;o!==l;++o)t[i++]=s[o]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const s=this.resolvedProperty;for(let o=0,l=s.length;o!==l;++o)s[o]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const s=this.resolvedProperty;for(let o=0,l=s.length;o!==l;++o)s[o]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const s=this.resolvedProperty;for(let o=0,l=s.length;o!==l;++o)s[o]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,s=i.objectName,o=i.propertyName;let l=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(s){let y=i.objectIndex;switch(s){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let v=0;v<t.length;v++)if(t[v].name===y){y=v;break}break;default:if(void 0===t[s])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[s]}if(void 0!==y){if(void 0===t[y])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[y]}}const u=t[o];if(void 0===u)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+o+" but it wasn't found.",t);let f=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?f=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(f=this.Versioning.MatrixWorldNeedsUpdate);let m=this.BindingType.Direct;if(void 0!==l){if("morphTargetInfluences"===o){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[l]&&(l=t.morphTargetDictionary[l])}m=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=l}else void 0!==u.fromArray&&void 0!==u.toArray?(m=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(m=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=o;this.getValue=this.GetterByBindingType[m],this.setValue=this.SetterByBindingTypeAndVersioning[m][f]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=cq,n})();Fr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Fr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Fr.prototype.GetterByBindingType=[Fr.prototype._getValue_direct,Fr.prototype._getValue_array,Fr.prototype._getValue_arrayElement,Fr.prototype._getValue_toArray],Fr.prototype.SetterByBindingTypeAndVersioning=[[Fr.prototype._setValue_direct,Fr.prototype._setValue_direct_setNeedsUpdate,Fr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Fr.prototype._setValue_array,Fr.prototype._setValue_array_setNeedsUpdate,Fr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Fr.prototype._setValue_arrayElement,Fr.prototype._setValue_arrayElement_setNeedsUpdate,Fr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Fr.prototype._setValue_fromArray,Fr.prototype._setValue_fromArray_setNeedsUpdate,Fr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class hq{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const o=t.tracks,l=o.length,u=new Array(l),f={endingStart:ay,endingEnd:ay};for(let m=0;m!==l;++m){const y=o[m].createInterpolant(null);u[m]=y,y.settings=f}this._interpolantSettings=f,this._interpolants=u,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,o=e._clip.duration,u=s/o;e.warp(1,o/s,t),this.warp(u,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,o=s.time,l=this.timeScale;let u=this._timeScaleInterpolant;null===u&&(u=s._lendControlInterpolant(),this._timeScaleInterpolant=u);const f=u.parameterPositions,m=u.sampleValues;return f[0]=o,f[1]=o+i,m[0]=e/l,m[1]=t/l,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled)return void this._updateWeight(e);const o=this._startTime;if(null!==o){const f=(e-o)*i;if(f<0||0===i)return;this._startTime=null,t=i*f}t*=this._updateTimeScale(e);const l=this._updateTime(t),u=this._updateWeight(e);if(u>0){const f=this._interpolants,m=this._propertyBindings;if(2501===this.blendMode)for(let y=0,v=f.length;y!==v;++y)f[y].evaluate(l),m[y].accumulateAdditive(u);else for(let y=0,v=f.length;y!==v;++y)f[y].evaluate(l),m[y].accumulate(s,u)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),0===s&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,o=this._loopCount;const l=2202===i;if(0===e)return-1===o?s:l&&1==(1&o)?t-s:s;if(2200===i){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,l)):this._setEndings(0===this.repetitions,!0,l)),s>=t||s<0){const u=Math.floor(s/t);s-=t*u,o+=Math.abs(u);const f=this.repetitions-o;if(f<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===f){const m=e<0;this._setEndings(m,!m,l)}else this._setEndings(!1,!1,l);this._loopCount=o,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:u})}}else this.time=s;if(l&&1==(1&o))return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=ly,s.endingEnd=ly):(s.endingStart=e?this.zeroSlopeAtStart?ly:ay:2402,s.endingEnd=t?this.zeroSlopeAtEnd?ly:ay:2402)}_scheduleFading(e,t,i){const s=this._mixer,o=s.time;let l=this._weightInterpolant;null===l&&(l=s._lendControlInterpolant(),this._weightInterpolant=l);const u=l.parameterPositions,f=l.sampleValues;return u[0]=o,f[0]=t,u[1]=o+e,f[1]=i,this}}(class dq extends Wd{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,o=s.length,l=e._propertyBindings,u=e._interpolants,f=i.uuid,m=this._bindingsByRootAndName;let y=m[f];void 0===y&&(y={},m[f]=y);for(let v=0;v!==o;++v){const x=s[v],b=x.name;let E=y[b];if(void 0!==E)++E.referenceCount,l[v]=E;else{if(E=l[v],void 0!==E){null===E._cacheIndex&&(++E.referenceCount,this._addInactiveBinding(E,f,b));continue}E=new eq(Fr.create(i,b,t&&t._propertyBindings[v].binding.parsedPath),x.ValueTypeName,x.getValueSize()),++E.referenceCount,this._addInactiveBinding(E,f,b),l[v]=E}u[v].resultBuffer=E.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,o=this._actionsByClip[s];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const o=t[i];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const o=t[i];0==--o.useCount&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,o=this._actionsByClip;let l=o[t];if(void 0===l)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=l;else{const u=l.knownActions;e._byClipCacheIndex=u.length,u.push(e)}e._cacheIndex=s.length,s.push(e),l.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,l=this._actionsByClip,u=l[o],f=u.knownActions,m=f[f.length-1],y=e._byClipCacheIndex;m._byClipCacheIndex=y,f[y]=m,f.pop(),e._byClipCacheIndex=null,delete u.actionByRoot[(e._localRoot||this._root).uuid],0===f.length&&delete l[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const o=t[i];0==--o.referenceCount&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,o=this._bindings;let l=s[t];void 0===l&&(l={},s[t]=l),l[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,o=i.path,l=this._bindingsByRootAndName,u=l[s],f=t[t.length-1],m=e._cacheIndex;f._cacheIndex=m,t[m]=f,t.pop(),delete u[o],0===Object.keys(u).length&&delete l[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new j3(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,o=t[s];e.__cacheIndex=s,t[s]=e,o.__cacheIndex=i,t[i]=o}clipAction(e,t,i){const s=t||this._root,o=s.uuid;let l="string"==typeof e?lS.findByName(s,e):e;const u=null!==l?l.uuid:e,f=this._actionsByClip[u];let m=null;if(void 0===i&&(i=null!==l?l.blendMode:2500),void 0!==f){const v=f.actionByRoot[o];if(void 0!==v&&v.blendMode===i)return v;m=f.knownActions[0],null===l&&(l=m._clip)}if(null===l)return null;const y=new hq(this,l,t,i);return this._bindAction(y,m),this._addInactiveAction(y,u,o),y}existingAction(e,t){const i=t||this._root,s=i.uuid,o="string"==typeof e?lS.findByName(i,e):e,u=this._actionsByClip[o?o.uuid:e];return void 0!==u&&u.actionByRoot[s]||null}stopAllAction(){const e=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)e[i].stop();return this}update(e){const t=this._actions,i=this._nActiveActions,s=this.time+=e*=this.timeScale,o=Math.sign(e),l=this._accuIndex^=1;for(let m=0;m!==i;++m)t[m]._update(s,e,o,l);const u=this._bindings,f=this._nActiveBindings;for(let m=0;m!==f;++m)u[m].apply(l);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,o=s[i];if(void 0!==o){const l=o.knownActions;for(let u=0,f=l.length;u!==f;++u){const m=l[u];this._deactivateAction(m);const y=m._cacheIndex,v=t[t.length-1];m._cacheIndex=null,m._byClipCacheIndex=null,v._cacheIndex=y,t[y]=v,t.pop(),this._removeInactiveBindingsForAction(m)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const l in i){const f=i[l].actionByRoot[t];void 0!==f&&(this._deactivateAction(f),this._removeInactiveAction(f))}const o=this._bindingsByRootAndName[t];if(void 0!==o)for(const l in o){const u=o[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class lR{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new lR(void 0===this.value.clone?this.value:this.value.clone())}}class fS extends Ry{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}function _N(n,e){return n.distance-e.distance}function cR(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===i){const s=n.children;for(let o=0,l=s.length;o<l;o++)cR(s[o],e,t,!0)}}fS.prototype.isInstancedInterleavedBuffer=!0;const vN=new at;class cx{constructor(e=new at(1/0,1/0),t=new at(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=vN.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return vN.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}cx.prototype.isBox2=!0;const xN=new Y,pS=new Y;class bN{constructor(e=new Y,t=new Y){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){xN.subVectors(e,this.start),pS.subVectors(this.end,this.start);const i=pS.dot(pS);let o=pS.dot(xN)/i;return t&&(o=ws(o,0,1)),o}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const af=new Y,mS=new Ft,uR=new Ft;function MN(n){const e=[];!0===n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,MN(n.children[t]));return e}class CN extends By{constructor(e=10,t=10,i=4473924,s=8947848){i=new Ut(i),s=new Ut(s);const o=t/2,l=e/t,u=e/2,f=[],m=[];for(let x=0,b=0,E=-u;x<=t;x++,E+=l){f.push(-u,0,E,u,0,E),f.push(E,0,-u,E,0,u);const C=x===o?i:s;C.toArray(m,b),b+=3,C.toArray(m,b),b+=3,C.toArray(m,b),b+=3,C.toArray(m,b),b+=3}const y=new xn;y.setAttribute("position",new Kt(f,3)),y.setAttribute("color",new Kt(m,3)),super(y,new Gs({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const RN=new ArrayBuffer(4),fc=(new Float32Array(RN),new Uint32Array(RN),new Uint32Array(512)),pc=new Uint32Array(512);for(let n=0;n<256;++n){const e=n-127;e<-27?(fc[n]=0,fc[256|n]=32768,pc[n]=24,pc[256|n]=24):e<-14?(fc[n]=1024>>-e-14,fc[256|n]=1024>>-e-14|32768,pc[n]=-e-1,pc[256|n]=-e-1):e<=15?(fc[n]=e+15<<10,fc[256|n]=e+15<<10|32768,pc[n]=13,pc[256|n]=13):e<128?(fc[n]=31744,fc[256|n]=64512,pc[n]=24,pc[256|n]=24):(fc[n]=31744,fc[256|n]=64512,pc[n]=13,pc[256|n]=13)}const dR=new Uint32Array(2048),Wy=new Uint32Array(64),LN=new Uint32Array(64);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;0==(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,dR[n]=e|t}for(let n=1024;n<2048;++n)dR[n]=939524096+(n-1024<<13);for(let n=1;n<31;++n)Wy[n]=n<<23;Wy[31]=1199570944,Wy[32]=2147483648;for(let n=33;n<63;++n)Wy[n]=2147483648+(n-32<<23);Wy[63]=3347054592;for(let n=1;n<64;++n)32!==n&&(LN[n]=1024);Ll.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(Ll.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n},Q0.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)},CN.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class mq extends By{constructor(e){const t=MN(e),i=new xn,s=[],o=[],l=new Ut(0,0,1),u=new Ut(0,1,0);for(let m=0;m<t.length;m++){const y=t[m];y.parent&&y.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),o.push(l.r,l.g,l.b),o.push(u.r,u.g,u.b))}i.setAttribute("position",new Kt(s,3)),i.setAttribute("color",new Kt(o,3)),super(i,new Gs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");uR.copy(this.root.matrixWorld).invert();for(let o=0,l=0;o<t.length;o++){const u=t[o];u.parent&&u.parent.isBone&&(mS.multiplyMatrices(uR,u.matrixWorld),af.setFromMatrixPosition(mS),s.setXYZ(l,af.x,af.y,af.z),mS.multiplyMatrices(uR,u.parent.matrixWorld),af.setFromMatrixPosition(mS),s.setXYZ(l+1,af.x,af.y,af.z),l+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Sh.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),hS.extractUrlBase(n)},Sh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},cx.prototype.center=function(n){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(n)},cx.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},cx.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},cx.prototype.size=function(n){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(n)},Uo.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)},Uo.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Uo.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},Uo.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},Uo.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)},$d.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Kc.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},TE.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)},bN.prototype.center=function(n){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(n)},yo.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},yo.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},yo.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},yo.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},yo.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},yo.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()},Ft.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)},Ft.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},Ft.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Y).setFromMatrixColumn(this,3)},Ft.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)},Ft.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Ft.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Ft.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Ft.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Ft.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)},Ft.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Ft.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Ft.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Ft.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Ft.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Ft.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Ft.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Ft.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Ft.prototype.makeFrustum=function(n,e,t,i,s,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,s,o)},Ft.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()},wh.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)},ks.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)},ks.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Yd.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},Yd.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)},Yd.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},Vs.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Vs.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)},Vs.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)},Vs.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)},Vs.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)},Vs.barycoordFromPoint=function(n,e,t,i,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Vs.getBarycoord(n,e,t,i,s)},Vs.normal=function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Vs.getNormal(n,e,t,i)},Mh.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)},Mh.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new sf(this,n)},Mh.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new sx(this,n)},at.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},at.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},at.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Y.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Y.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Y.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)},Y.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)},Y.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)},Y.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)},Y.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},Y.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},Y.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wi.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},Wi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Zi.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)},Zi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Zi.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)},Zi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Zi.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)},Object.defineProperties(Zi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Hs.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Hs.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),BD.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},vo.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(n)},Object.defineProperties(Qc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}}),Object.defineProperties(Cr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===k0},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(k0)}}}),Cr.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===n?k0:B0),this},Cr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Cr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},xn.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)},xn.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===n?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Cr(arguments[1],arguments[2])))},xn.prototype.addDrawCall=function(n,e,t){void 0!==t&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)},xn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},xn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},xn.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)},xn.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)},Object.defineProperties(xn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Ry.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===n?k0:B0),this},Ry.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},sf.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},sf.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},sf.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},LE.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},lR.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Us.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ut}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Il.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}}),hr.prototype.clearTarget=function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)},hr.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)},hr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},hr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},hr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},hr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},hr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},hr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},hr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},hr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},hr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},hr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},hr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},hr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},hr.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)},hr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},hr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},hr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},hr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},hr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},hr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},hr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},hr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},hr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},hr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(hr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===n?qr:mh}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(QF.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ja.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}}),class Z6 extends Zi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new j6).load(n,function(i){e.setBuffer(i)}),this},ED.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)},ED.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)},im.crossOrigin=void 0,im.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new K3;s.setCrossOrigin(this.crossOrigin);const o=s.load(n,t,void 0,i);return e&&(o.mapping=e),o},im.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new z6;s.setCrossOrigin(this.crossOrigin);const o=s.load(n,t,void 0,i);return e&&(o.mapping=e),o},im.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},im.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139");class eu{static enumFromStringValue(e,t){return Object.values(e).includes(t)?t:void 0}static minifiedToFullCameraState(e){let t=new Y;t.fromArray(e.position);let i=new ks;return i.fromArray(e.rotation),{position:t,rotation:i,fov:e.fov,near:e.near,far:e.far,lastUpdate:e.lastUpdate}}static fullToMinifiedCameraState(e){return{position:[e.position.x,e.position.y,e.position.z],rotation:[e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w],fov:e.fov,near:e.near,far:e.far,lastUpdate:e.lastUpdate}}static logRange(e,t,i,s,o){let l=Math.log(e),f=(Math.log(t)-l)/(s-i);return Math.exp(l+f*(o-i))}}function yq(n,e){if(1&n&&Ei(0,"app-col",4),2&n){const t=Fe().$implicit,i=Fe();Xe("children",t.children)("data",i.toColData(t.data))}}function _q(n,e){if(1&n&&Ei(0,"app-row",4),2&n){const t=Fe().$implicit,i=Fe();Xe("children",t.children)("data",i.toRowData(t.data))}}function vq(n,e){if(1&n&&Ei(0,"app-pc-viewer",5),2&n){const t=Fe().$implicit;Xe("data",Fe().toViewerData(t.data))}}function xq(n,e){if(1&n&&Ei(0,"app-general-settings",5),2&n){const t=Fe().$implicit;Xe("data",Fe().toGeneralSettingsData(t.data))}}function bq(n,e){if(1&n&&Ei(0,"app-element-tree",5),2&n){const t=Fe().$implicit;Xe("data",Fe().toElementTreeData(t.data))}}function wq(n,e){if(1&n&&(De(0,"div")(1,"div",1),pn(2,yq,1,2,"app-col",2),pn(3,_q,1,2,"app-row",2),pn(4,vq,1,1,"app-pc-viewer",3),pn(5,xq,1,1,"app-general-settings",3),pn(6,bq,1,1,"app-element-tree",3),Se()()),2&n){const t=e.$implicit,i=Fe();Je(1),Xe("ngSwitch",i.parseToEnum(t.component)),Je(1),Xe("ngSwitchCase",i.comp.COL),Je(1),Xe("ngSwitchCase",i.comp.ROW),Je(1),Xe("ngSwitchCase",i.comp.VIEWER),Je(1),Xe("ngSwitchCase",i.comp.GENERAL_SETTINGS),Je(1),Xe("ngSwitchCase",i.comp.ELEMENT_TREE)}}var ux=(()=>{return(n=ux||(ux={})).ROW="row",n.COL="col",n.VIEWER="viewer",n.BUTTON="button",n.GENERAL_SETTINGS="general_settings",n.ELEMENT_TREE="element_tree",ux;var n})();let qy=(()=>{class n{constructor(){this.comp=ux,this.children=[]}ngOnInit(){}toColData(t){return t}toRowData(t){return t}toGeneralSettingsData(t){return t}toViewerData(t){return t}toElementTreeData(t){return t}parseToEnum(t){return eu.enumFromStringValue(ux,t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-base"]],inputs:{children:"children"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"children","data",4,"ngSwitchCase"],[3,"data",4,"ngSwitchCase"],[3,"children","data"],[3,"data"]],template:function(t,i){1&t&&pn(0,wq,7,6,"div",0),2&t&&Xe("ngForOf",i.children)},styles:[""]}),n})(),Mq=(()=>{class n{constructor(t){this.sceneElementsService=t,this.title="Potree Viewer",this.data=[],t.getComponentTree(0).subscribe(i=>{this.data=i})}}return n.\u0275fac=function(t){return new(t||n)(He(YM))},n.\u0275cmp=Ts({type:n,selectors:[["app-root"]],decls:1,vars:1,consts:[[3,"children"]],template:function(t,i){1&t&&Ei(0,"app-base",0),2&t&&Xe("children",i.data)},directives:[qy],styles:[""]}),n})();var fR=ro(765);const xS=new Ut;class Eq extends Sh{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,i,s){const o=this,l=new Th(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{t(o.parse(u))}catch(f){s?s(f):console.error(f),o.manager.itemError(e)}},i,s)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(b){let C="",A=0;const N=/^ply([\s\S]*)end_header\r?\n/.exec(b);null!==N&&(C=N[1],A=new Blob([N[0]]).size);const F={comments:[],elements:[],headerLength:A,objInfo:""},V=C.split("\n");let k;function G(ee,oe){const ue={type:ee[0]};return"list"===ue.type?(ue.name=ee[3],ue.countType=ee[1],ue.itemType=ee[2]):ue.name=ee[1],ue.name in oe&&(ue.name=oe[ue.name]),ue}for(let ee=0;ee<V.length;ee++){let oe=V[ee];if(oe=oe.trim(),""===oe)continue;const ue=oe.split(/\s+/),Pe=ue.shift();switch(oe=ue.join(" "),Pe){case"format":F.format=ue[0],F.version=ue[1];break;case"comment":F.comments.push(oe);break;case"element":void 0!==k&&F.elements.push(k),k={},k.name=ue[0],k.count=parseInt(ue[1]),k.properties=[];break;case"property":k.properties.push(G(ue,x.propertyNameMapping));break;case"obj_info":F.objInfo=oe;break;default:console.log("unhandled",Pe,ue)}}return void 0!==k&&F.elements.push(k),F}function i(b,E){switch(E){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(b);case"float":case"double":case"float32":case"float64":return parseFloat(b)}}function s(b,E){const C=E.split(/\s+/),A={};for(let N=0;N<b.length;N++)if("list"===b[N].type){const F=[],V=i(C.shift(),b[N].countType);for(let k=0;k<V;k++)F.push(i(C.shift(),b[N].itemType));A[b[N].name]=F}else A[b[N].name]=i(C.shift(),b[N].type);return A}function o(b,E){const C={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let A,F="";null!==(A=/end_header\s([\s\S]*)$/.exec(b))&&(F=A[1]);const V=F.split("\n");let k=0,G=0;for(let ee=0;ee<V.length;ee++){let oe=V[ee];if(oe=oe.trim(),""===oe)continue;G>=E.elements[k].count&&(k++,G=0);const ue=s(E.elements[k].properties,oe);u(C,E.elements[k].name,ue),G++}return l(C)}function l(b){let E=new xn;return b.indices.length>0&&E.setIndex(b.indices),E.setAttribute("position",new Kt(b.vertices,3)),b.normals.length>0&&E.setAttribute("normal",new Kt(b.normals,3)),b.uvs.length>0&&E.setAttribute("uv",new Kt(b.uvs,2)),b.colors.length>0&&E.setAttribute("color",new Kt(b.colors,3)),b.faceVertexUvs.length>0&&(E=E.toNonIndexed(),E.setAttribute("uv",new Kt(b.faceVertexUvs,2))),E.computeBoundingSphere(),E}function u(b,E,C){function A(le){for(let Ze=0,_e=le.length;Ze<_e;Ze++){const Le=le[Ze];if(Le in C)return Le}return null}const N=A(["x","px","posx"])||"x",F=A(["y","py","posy"])||"y",V=A(["z","pz","posz"])||"z",k=A(["nx","normalx"]),G=A(["ny","normaly"]),ee=A(["nz","normalz"]),oe=A(["s","u","texture_u","tx"]),ue=A(["t","v","texture_v","ty"]),Pe=A(["red","diffuse_red","r","diffuse_r"]),ye=A(["green","diffuse_green","g","diffuse_g"]),q=A(["blue","diffuse_blue","b","diffuse_b"]);if("vertex"===E)b.vertices.push(C[N],C[F],C[V]),null!==k&&null!==G&&null!==ee&&b.normals.push(C[k],C[G],C[ee]),null!==oe&&null!==ue&&b.uvs.push(C[oe],C[ue]),null!==Pe&&null!==ye&&null!==q&&(xS.setRGB(C[Pe]/255,C[ye]/255,C[q]/255).convertSRGBToLinear(),b.colors.push(xS.r,xS.g,xS.b));else if("face"===E){const le=C.vertex_indices||C.vertex_index,Ze=C.texcoord;3===le.length?(b.indices.push(le[0],le[1],le[2]),Ze&&6===Ze.length&&(b.faceVertexUvs.push(Ze[0],Ze[1]),b.faceVertexUvs.push(Ze[2],Ze[3]),b.faceVertexUvs.push(Ze[4],Ze[5]))):4===le.length&&(b.indices.push(le[0],le[1],le[3]),b.indices.push(le[1],le[2],le[3]))}}function f(b,E,C,A){switch(C){case"int8":case"char":return[b.getInt8(E),1];case"uint8":case"uchar":return[b.getUint8(E),1];case"int16":case"short":return[b.getInt16(E,A),2];case"uint16":case"ushort":return[b.getUint16(E,A),2];case"int32":case"int":return[b.getInt32(E,A),4];case"uint32":case"uint":return[b.getUint32(E,A),4];case"float32":case"float":return[b.getFloat32(E,A),4];case"float64":case"double":return[b.getFloat64(E,A),8]}}function m(b,E,C,A){const N={};let F,V=0;for(let k=0;k<C.length;k++)if("list"===C[k].type){const G=[];F=f(b,E+V,C[k].countType,A);const ee=F[0];V+=F[1];for(let oe=0;oe<ee;oe++)F=f(b,E+V,C[k].itemType,A),G.push(F[0]),V+=F[1];N[C[k].name]=G}else F=f(b,E+V,C[k].type,A),N[C[k].name]=F[0],V+=F[1];return[N,V]}let v;const x=this;if(e instanceof ArrayBuffer){const b=hS.decodeText(new Uint8Array(e)),E=t(b);v="ascii"===E.format?o(b,E):function y(b,E){const C={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},A="binary_little_endian"===E.format,N=new DataView(b,E.headerLength);let F,V=0;for(let k=0;k<E.elements.length;k++)for(let G=0;G<E.elements[k].count;G++)F=m(N,V,E.elements[k].properties,A),V+=F[1],u(C,E.elements[k].name,F[0]);return l(C)}(e,E)}else v=o(e,t(e));return v}}class Sq extends HD{constructor(e,t){super(e,t),this.colorMaterial=new ky,this.defaultMaterial=t||new ky({vertexColors:!0})}setColor(e){this.colorMaterial.color.set(e),this.material=this.colorMaterial}getColor(){return this.colorMaterial.color}setVisibility(e){this.visible=e}resetColor(){this.material=this.defaultMaterial}setPointSize(e){this.colorMaterial.size=e,this.defaultMaterial.size=e}}const tu=Object.create(null);tu.open="0",tu.close="1",tu.ping="2",tu.pong="3",tu.message="4",tu.upgrade="5",tu.noop="6";const bS=Object.create(null);Object.keys(tu).forEach(n=>{bS[tu[n]]=n});const Cq={type:"error",data:"parser error"},Tq="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Aq="function"==typeof ArrayBuffer,FN=(n,e)=>{const t=new FileReader;return t.onload=function(){const i=t.result.split(",")[1];e("b"+i)},t.readAsDataURL(n)},NN=({type:n,data:e},t,i)=>Tq&&e instanceof Blob?t?i(e):FN(e,i):Aq&&(e instanceof ArrayBuffer||(n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer)(e))?t?i(e):FN(new Blob([e]),i):i(tu[n]+(e||"")),jy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hx="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let n=0;n<jy.length;n++)hx[jy.charCodeAt(n)]=n;const Iq="function"==typeof ArrayBuffer,Fq=(n,e)=>{if(Iq){const t=(n=>{let i,o,l,u,f,e=.75*n.length,t=n.length,s=0;"="===n[n.length-1]&&(e--,"="===n[n.length-2]&&e--);const m=new ArrayBuffer(e),y=new Uint8Array(m);for(i=0;i<t;i+=4)o=hx[n.charCodeAt(i)],l=hx[n.charCodeAt(i+1)],u=hx[n.charCodeAt(i+2)],f=hx[n.charCodeAt(i+3)],y[s++]=o<<2|l>>4,y[s++]=(15&l)<<4|u>>2,y[s++]=(3&u)<<6|63&f;return m})(n);return ON(t,e)}return{base64:!0,data:n}},ON=(n,e)=>"blob"===e&&n instanceof ArrayBuffer?new Blob([n]):n,BN=(n,e)=>{if("string"!=typeof n)return{type:"message",data:ON(n,e)};const t=n.charAt(0);return"b"===t?{type:"message",data:Fq(n.substring(1),e)}:bS[t]?n.length>1?{type:bS[t],data:n.substring(1)}:{type:bS[t]}:Cq},kN=String.fromCharCode(30);function Ws(n){if(n)return function Bq(n){for(var e in Ws.prototype)n[e]=Ws.prototype[e];return n}(n)}Ws.prototype.on=Ws.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this},Ws.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this},Ws.prototype.off=Ws.prototype.removeListener=Ws.prototype.removeAllListeners=Ws.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(var i,s=0;s<t.length;s++)if((i=t[s])===e||i.fn===e){t.splice(s,1);break}return 0===t.length&&delete this._callbacks["$"+n],this},Ws.prototype.emitReserved=Ws.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t){i=0;for(var s=(t=t.slice(0)).length;i<s;++i)t[i].apply(this,e)}return this},Ws.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},Ws.prototype.hasListeners=function(n){return!!this.listeners(n).length};const lf="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function UN(n,...e){return e.reduce((t,i)=>(n.hasOwnProperty(i)&&(t[i]=n[i]),t),{})}const kq=setTimeout,Vq=clearTimeout;function wS(n,e){e.useNativeTimers?(n.setTimeoutFn=kq.bind(lf),n.clearTimeoutFn=Vq.bind(lf)):(n.setTimeoutFn=setTimeout.bind(lf),n.clearTimeoutFn=clearTimeout.bind(lf))}function zq(n){return"string"==typeof n?function Hq(n){let e=0,t=0;for(let i=0,s=n.length;i<s;i++)e=n.charCodeAt(i),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(i++,t+=4);return t}(n):Math.ceil(1.33*(n.byteLength||n.size))}class Gq extends Error{constructor(e,t,i){super(e),this.description=t,this.context=i,this.type="TransportError"}}class zN extends Ws{constructor(e){super(),this.writable=!1,wS(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,i){return super.emitReserved("error",new Gq(e,t,i)),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=BN(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const HN="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),GN={};let qN,WN=0,cf=0;function jN(n){let e="";do{e=HN[n%64]+e,n=Math.floor(n/64)}while(n>0);return e}function XN(){const n=jN(+new Date);return n!==qN?(WN=0,qN=n):n+"."+jN(WN++)}for(;cf<64;cf++)GN[HN[cf]]=cf;function YN(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}let KN=!1;try{KN="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){}const qq=KN;function $N(n){const e=n.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||qq))return new XMLHttpRequest}catch(t){}if(!e)try{return new(lf[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function jq(){}const Xq=null!=new $N({xdomain:!1}).responseType;let ES=(()=>{class n extends Ws{constructor(t,i){super(),wS(this,i),this.opts=i,this.method=i.method||"GET",this.uri=t,this.async=!1!==i.async,this.data=void 0!==i.data?i.data:null,this.create()}create(){const t=UN(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const i=this.xhr=new $N(t);try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this.opts.extraHeaders[s])}}catch(s){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{i.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(null!=this.xhr){if(this.xhr.onreadystatechange=jq,t)try{this.xhr.abort()}catch(i){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return n.requestsCount=0,n.requests={},n})();function ZN(){for(let n in ES.requests)ES.requests.hasOwnProperty(n)&&ES.requests[n].abort()}"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ZN):"function"==typeof addEventListener&&addEventListener("onpagehide"in lf?"pagehide":"unload",ZN,!1));const Kq="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),SS=lf.WebSocket||lf.MozWebSocket,JN="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Jq={websocket:class Zq extends zN{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,i=JN?{}:UN(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=JN?new SS(e,t,i):t?new SS(e,t):new SS(e)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=t===e.length-1;NN(e[t],this.supportsBinary,o=>{try{this.ws.send(o)}catch(u){}s&&Kq(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let i="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=XN()),this.supportsBinary||(e.b64=1);const s=YN(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(s.length?"?"+s:"")}check(){return!!SS}},polling:class Yq extends zN{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const i="https:"===location.protocol;let s=location.port;s||(s=i?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==i}this.supportsBinary=Xq&&!(e&&e.forceBase64)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let i=0;this.polling&&(i++,this.once("pollComplete",function(){--i||t()})),this.writable||(i++,this.once("drain",function(){--i||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((n,e)=>{const t=n.split(kN),i=[];for(let s=0;s<t.length;s++){const o=BN(t[s],e);if(i.push(o),"error"===o.type)break}return i})(e,this.socket.binaryType).forEach(i=>{if("opening"===this.readyState&&"open"===i.type&&this.onOpen(),"close"===i.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((n,e)=>{const t=n.length,i=new Array(t);let s=0;n.forEach((o,l)=>{NN(o,!1,u=>{i[l]=u,++s===t&&e(i.join(kN))})})})(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let i="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=XN()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port);const s=YN(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(s.length?"?"+s:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new ES(this.uri(),e)}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,i)=>{this.onError("xhr poll error",t,i)}),this.pollXhr=e}}},Qq=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ej=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function mR(n){const e=n,t=n.indexOf("["),i=n.indexOf("]");-1!=t&&-1!=i&&(n=n.substring(0,t)+n.substring(t,i).replace(/:/g,";")+n.substring(i,n.length));let s=Qq.exec(n||""),o={},l=14;for(;l--;)o[ej[l]]=s[l]||"";return-1!=t&&-1!=i&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function tj(n,e){const i=e.replace(/\/{2,9}/g,"/").split("/");return("/"==e.substr(0,1)||0===e.length)&&i.splice(0,1),"/"==e.substr(e.length-1,1)&&i.splice(i.length-1,1),i}(0,o.path),o.queryKey=function nj(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,s,o){s&&(t[s]=o)}),t}(0,o.query),o}let QN=(()=>{class n extends Ws{constructor(t,i={}){super(),t&&"object"==typeof t&&(i=t,t=null),t?(t=mR(t),i.hostname=t.host,i.secure="https"===t.protocol||"wss"===t.protocol,i.port=t.port,t.query&&(i.query=t.query)):i.host&&(i.hostname=mR(i.host).host),wS(this,i),this.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=i.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function Wq(n){let e={},t=n.split("&");for(let i=0,s=t.length;i<s;i++){let o=t[i].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const i=Object.assign({},this.opts.query);i.EIO=4,i.transport=t,this.id&&(i.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Jq[t](s)}open(){let t;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(i){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(t){let i=this.createTransport(t),s=!1;n.priorWebsocketSuccess=!1;const o=()=>{s||(i.send([{type:"ping",data:"probe"}]),i.once("packet",x=>{if(!s)if("pong"===x.type&&"probe"===x.data){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;n.priorWebsocketSuccess="websocket"===i.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(v(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const b=new Error("probe error");b.transport=i.name,this.emitReserved("upgradeError",b)}}))};function l(){s||(s=!0,v(),i.close(),i=null)}const u=x=>{const b=new Error("probe error: "+x);b.transport=i.name,l(),this.emitReserved("upgradeError",b)};function f(){u("transport closed")}function m(){u("socket closed")}function y(x){i&&x.name!==i.name&&l()}const v=()=>{i.removeListener("open",o),i.removeListener("error",u),i.removeListener("close",f),this.off("close",m),this.off("upgrading",y)};i.once("open",o),i.once("error",u),i.once("close",f),this.once("close",m),this.once("upgrading",y),i.open()}onOpen(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const i=this.upgrades.length;for(;t<i;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=t.data,this.onError(i);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let s=0;s<this.writeBuffer.length;s++){const o=this.writeBuffer[s].data;if(o&&(i+=zq(o)),s>0&&i>this.maxPayload)return this.writeBuffer.slice(0,s);i+=2}return this.writeBuffer}write(t,i,s){return this.sendPacket("message",t,i,s),this}send(t,i,s){return this.sendPacket("message",t,i,s),this}sendPacket(t,i,s,o){if("function"==typeof i&&(o=i,i=void 0),"function"==typeof s&&(o=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const l={type:t,data:i,options:s};this.emitReserved("packetCreate",l),this.writeBuffer.push(l),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),t()},s=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}onError(t){n.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,i){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const i=[];let s=0;const o=t.length;for(;s<o;s++)~this.transports.indexOf(t[s])&&i.push(t[s]);return i}}return n.protocol=4,n})();const rj="function"==typeof ArrayBuffer,eO=Object.prototype.toString,oj="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===eO.call(Blob),aj="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===eO.call(File);function gR(n){return rj&&(n instanceof ArrayBuffer||(n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer)(n))||oj&&n instanceof Blob||aj&&n instanceof File}function CS(n,e){if(!n||"object"!=typeof n)return!1;if(Array.isArray(n)){for(let t=0,i=n.length;t<i;t++)if(CS(n[t]))return!0;return!1}if(gR(n))return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return CS(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&CS(n[t]))return!0;return!1}function lj(n){const e=[],i=n;return i.data=yR(n.data,e),i.attachments=e.length,{packet:i,buffers:e}}function yR(n,e){if(!n)return n;if(gR(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}if(Array.isArray(n)){const t=new Array(n.length);for(let i=0;i<n.length;i++)t[i]=yR(n[i],e);return t}if("object"==typeof n&&!(n instanceof Date)){const t={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=yR(n[i],e));return t}return n}function cj(n,e){return n.data=_R(n.data,e),n.attachments=void 0,n}function _R(n,e){if(!n)return n;if(n&&n._placeholder)return e[n.num];if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=_R(n[t],e);else if("object"==typeof n)for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=_R(n[t],e));return n}const tO=5;var Oi=(()=>{return(n=Oi||(Oi={}))[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK",Oi;var n})();class uj{constructor(e){this.replacer=e}encode(e){return e.type!==Oi.EVENT&&e.type!==Oi.ACK||!CS(e)?[this.encodeAsString(e)]:(e.type=e.type===Oi.EVENT?Oi.BINARY_EVENT:Oi.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return(e.type===Oi.BINARY_EVENT||e.type===Oi.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=lj(e),i=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(i),s}}class vR extends Ws{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===Oi.BINARY_EVENT||t.type===Oi.BINARY_ACK?(this.reconstructor=new hj(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else{if(!gR(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(void 0===Oi[i.type])throw new Error("unknown packet type "+i.type);if(i.type===Oi.BINARY_EVENT||i.type===Oi.BINARY_ACK){const o=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const l=e.substring(o,t);if(l!=Number(l)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(l)}if("/"===e.charAt(t+1)){const o=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);i.nsp=e.substring(o,t)}else i.nsp="/";const s=e.charAt(t+1);if(""!==s&&Number(s)==s){const o=t+1;for(;++t;){const l=e.charAt(t);if(null==l||Number(l)!=l){--t;break}if(t===e.length)break}i.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(!vR.isPayloadValid(i.type,o))throw new Error("invalid payload");i.data=o}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Oi.CONNECT:return"object"==typeof t;case Oi.DISCONNECT:return void 0===t;case Oi.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case Oi.EVENT:case Oi.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case Oi.ACK:case Oi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class hj{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=cj(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function mc(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const dj=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class xR extends Ws{constructor(e,t,i){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,i&&i.auth&&(this.auth=i.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[mc(e,"open",this.onopen.bind(this)),mc(e,"packet",this.onpacket.bind(this)),mc(e,"error",this.onerror.bind(this)),mc(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(dj.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const i={type:Oi.EVENT,data:t,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const l=this.ids++,u=t.pop();this._registerAckCallback(l,u),i.id=l}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){const i=this.flags.timeout;if(void 0===i)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this.packet({type:Oi.CONNECT,data:e})}):this.packet({type:Oi.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Oi.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Oi.EVENT:case Oi.BINARY_EVENT:this.onevent(e);break;case Oi.ACK:case Oi.BINARY_ACK:this.onack(e);break;case Oi.DISCONNECT:this.ondisconnect();break;case Oi.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t)i.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let i=!1;return function(...s){i||(i=!0,t.packet({type:Oi.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Oi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const i of t)i.apply(this,e.data)}}}function Xy(n){this.ms=(n=n||{}).min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Xy.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=0==(1&Math.floor(10*e))?n-t:n+t}return 0|Math.min(n,this.max)},Xy.prototype.reset=function(){this.attempts=0},Xy.prototype.setMin=function(n){this.ms=n},Xy.prototype.setMax=function(n){this.max=n},Xy.prototype.setJitter=function(n){this.jitter=n};class TS extends Ws{constructor(e,t){var i;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,wS(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=t.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new Xy({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||so;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new QN(this.uri,this.opts);const t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const s=mc(t,"open",function(){i.onopen(),e&&e()}),o=mc(t,"error",l=>{i.cleanup(),i._readyState="closed",this.emitReserved("error",l),e?e(l):i.maybeReconnectOnOpen()});if(!1!==this._timeout){const l=this._timeout;0===l&&s();const u=this.setTimeoutFn(()=>{s(),t.close(),t.emit("error",new Error("timeout"))},l);this.opts.autoUnref&&u.unref(),this.subs.push(function(){clearTimeout(u)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(mc(e,"ping",this.onping.bind(this)),mc(e,"data",this.ondata.bind(this)),mc(e,"error",this.onerror.bind(this)),mc(e,"close",this.onclose.bind(this)),mc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i||(i=new xR(this,e,t),this.nsps[e]=i),i}_destroy(e){const t=Object.keys(this.nsps);for(const i of t)if(this.nsps[i].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const dx={};function uf(n,e){"object"==typeof n&&(e=n,n=void 0);const t=function ij(n,e="",t){let i=n;t=t||"undefined"!=typeof location&&location,null==n&&(n=t.protocol+"//"+t.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?t.protocol+n:t.host+n),/^(https?|wss?):\/\//.test(n)||(n=void 0!==t?t.protocol+"//"+n:"https://"+n),i=mR(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const o=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port+e,i.href=i.protocol+"://"+o+(t&&t.port===i.port?"":":"+i.port),i}(n,(e=e||{}).path||"/socket.io"),i=t.source,s=t.id;let f;return e.forceNew||e["force new connection"]||!1===e.multiplex||dx[s]&&t.path in dx[s].nsps?f=new TS(i,e):(dx[s]||(dx[s]=new TS(i,e)),f=dx[s]),t.query&&!e.query&&(e.query=t.queryKey),f.socket(t.path,e)}Object.assign(uf,{Manager:TS,Socket:xR,io:uf,connect:uf});class bR{constructor(e){this.config=e,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===e&&(e=this.emptyConfig),this.ioSocket=(uf||ar)(e.url,e.options)}of(e){this.ioSocket.of(e)}on(e,t){this.ioSocket.on(e,t)}once(e,t){this.ioSocket.once(e,t)}connect(){return this.ioSocket.connect()}disconnect(e){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(e,...t){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(e,t){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(e){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(e){return this.subscribersCounter[e]||(this.subscribersCounter[e]=0),this.subscribersCounter[e]++,this.eventObservables$[e]||(this.eventObservables$[e]=new Ar(t=>{const i=s=>{t.next(s)};return this.ioSocket.on(e,i),()=>{this.subscribersCounter[e]--,0===this.subscribersCounter[e]&&(this.ioSocket.removeListener(e,i),delete this.eventObservables$[e])}}).pipe(Bm())),this.eventObservables$[e]}fromOneTimeEvent(e){return new Promise(t=>this.once(e,t))}}function fj(n){return new bR(n)}const nO=new ii("__SOCKET_IO_CONFIG__");let pj=(()=>{class n{static forRoot(t){return{ngModule:n,providers:[{provide:nO,useValue:t},{provide:bR,useFactory:fj,deps:[nO]}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({}),n})(),wR=(()=>{class n{constructor(t){this.socket=t}sendCameraState(t,i){this.sendMessage(n.cameraSyncEvent,JSON.stringify({sceneId:t,state:i}))}startAnimation(t,i){this.sendMessage(n.startAnimationEvent,JSON.stringify({sceneId:t,animationName:i}))}sendMessage(t,i){this.socket.emit(t,i)}getMessage(t){return this.socket.fromEvent(t).pipe(yr(i=>i))}connect(){this.isConnected()?console.info("[WS]: Socket already connected"):(this.socket.connect(),console.info("[WS]: Connected the socket."))}disconnect(){this.isConnected()?(this.socket.disconnect(),console.info("[WS]: Disconnected the socket.")):console.info("[WS]: Socket already disconnected.")}isConnected(){return this.socket.ioSocket.connected}}return n.cameraSyncEvent="camera_sync",n.startAnimationEvent="start_animation",n.\u0275fac=function(t){return new(t||n)(Bn(bR))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const yn={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},dr={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},ti={x:0,y:0},nl={camera:new Ft,gizmos:new Ft},Tr={type:"change"},gc={type:"start"},Fl={type:"end"},mj=new class pq{constructor(e,t,i=0,s=1/0){this.ray=new Yd(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new dD,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return cR(e,this,i,t),i.sort(_N),i}intersectObjects(e,t=!0,i=[]){for(let s=0,o=e.length;s<o;s++)cR(e[s],this,i,t);return i.sort(_N),i}},qs=new Y,iO=new Ft,rO=new Ft,yc=new Y;class gj extends Wd{constructor(e,t,i=null){super(),rn(this,"onWindowResize",()=>{const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.camera);const t=this._tbRadius/e,s=new tf(0,0,t,t).getPoints(this._curvePts),o=(new xn).setFromPoints(s);for(const l in this._gizmos.children)this._gizmos.children[l].geometry=o;this.dispatchEvent(Tr)}),rn(this,"onContextMenu",e=>{if(this.enabled)for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}),rn(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=dr.NONE}),rn(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e),this._downStart=performance.now()):this._downValid=!1,"touch"==e.pointerType&&this._input!=dr.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case dr.NONE:this._input=dr.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case dr.ONE_FINGER:case dr.ONE_FINGER_SWITCHED:this._input=dr.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case dr.TWO_FINGER:this._input=dr.MULT_FINGER,this.onTriplePanStart(e)}else if("touch"!=e.pointerType&&this._input==dr.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),null!=this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=dr.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),rn(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=dr.CURSOR)switch(this._input){case dr.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,yn.ROTATE);break;case dr.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility){this._input=dr.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE");break}break;case dr.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case dr.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove(e)}else if("touch"!=e.pointerType&&this._input==dr.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const i=this.getOpStateFromAction(this._button,t);null!=i&&this.onSinglePanMove(e,i)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),rn(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=dr.CURSOR){const t=this._touchCurrent.length;for(let i=0;i<t;i++)if(this._touchCurrent[i].pointerId==e.pointerId){this._touchCurrent.splice(i,1),this._touchStart.splice(i,1);break}switch(this._input){case dr.ONE_FINGER:case dr.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=dr.NONE,this.onSinglePanEnd();break;case dr.TWO_FINGER:this.onDoublePanEnd(e),this.onPinchEnd(e),this.onRotateEnd(e),this._input=dr.ONE_FINGER_SWITCHED;break;case dr.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=dr.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==dr.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=dr.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary)if(this._downValid)if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const i=e.timeStamp-this._clickStart,s=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;i<=this._maxInterval&&s<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),rn(this,"onWheel",e=>{if(this.enabled&&this.enableZoom){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");const i=this.getOpFromAction("WHEEL",t);if(null!=i){e.preventDefault(),this.dispatchEvent(gc);const s=125;let o=e.deltaY/s,l=1;switch(o>0?l=1/this.scaleFactor:o<0&&(l=this.scaleFactor),i){case"ZOOM":if(this.updateTbState(yn.SCALE,!0),o>0?l=1/Math.pow(this.scaleFactor,o):o<0&&(l=Math.pow(this.scaleFactor,-o)),this.cursorZoom&&this.enablePan){let u;this.camera.isOrthographicCamera?u=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(u=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(l,u))}else this.applyTransformMatrix(this.scale(l,this._gizmos.position));null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Tr),this.dispatchEvent(Fl);break;case"FOV":if(this.camera.isPerspectiveCamera){this.updateTbState(yn.FOV,!0),0!=e.deltaX&&(o=e.deltaX/s,l=1,o>0?l=1/Math.pow(this.scaleFactor,o):o<0&&(l=Math.pow(this.scaleFactor,-o))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let f=u/l;f=Zr.clamp(f,this.minDistance,this.maxDistance);const m=u*Math.tan(Zr.DEG2RAD*this.camera.fov*.5);let y=Zr.RAD2DEG*(2*Math.atan(m/f));y>this.maxFov?y=this.maxFov:y<this.minFov&&(y=this.minFov),l=u/(m/Math.tan(Zr.DEG2RAD*(y/2))),this.setFov(y),this.applyTransformMatrix(this.scale(l,this._gizmos.position,!1))}null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Tr),this.dispatchEvent(Fl)}}}}),rn(this,"onSinglePanStart",(e,t)=>{if(this.enabled)switch(this.dispatchEvent(gc),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Tr)),this.updateTbState(yn.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(Tr));break;case"ROTATE":if(!this.enableRotate)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(yn.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ti.x,ti.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(Tr);break;case"FOV":if(!this.camera.isPerspectiveCamera||!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Tr)),this.updateTbState(yn.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Tr)),this.updateTbState(yn.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),rn(this,"onSinglePanMove",(e,t)=>{if(this.enabled){const i=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case yn.PAN:this.enablePan&&(i?(this.dispatchEvent(Fl),this.dispatchEvent(gc),this.updateTbState(t,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case yn.ROTATE:if(this.enableRotate)if(i)this.dispatchEvent(Fl),this.dispatchEvent(gc),this.updateTbState(t,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ti.x,ti.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ti.x,ti.y,this.domElement,this._tbRadius));const s=this._startCursorPosition.distanceTo(this._currentCursorPosition),o=this._startCursorPosition.angleTo(this._currentCursorPosition),l=Math.max(s/this._tbRadius,o);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),l)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=l,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case yn.SCALE:if(this.enableZoom)if(i)this.dispatchEvent(Fl),this.dispatchEvent(gc),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;o<0?l=1/Math.pow(this.scaleFactor,8*-o):o>0&&(l=Math.pow(this.scaleFactor,8*o)),this.applyTransformMatrix(this.scale(l,this._gizmos.position))}break;case yn.FOV:if(this.enableZoom&&this.camera.isPerspectiveCamera)if(i)this.dispatchEvent(Fl),this.dispatchEvent(gc),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;o<0?l=1/Math.pow(this.scaleFactor,8*-o):o>0&&(l=Math.pow(this.scaleFactor,8*o)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let f=u/l;f=Zr.clamp(f,this.minDistance,this.maxDistance);const m=u*Math.tan(Zr.DEG2RAD*this._fovState*.5);let y=Zr.RAD2DEG*(2*Math.atan(m/f));y=Zr.clamp(y,this.minFov,this.maxFov);const v=m/Math.tan(Zr.DEG2RAD*(y/2));l=u/v,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(y),this.applyTransformMatrix(this.scale(l,this._v3_2,!1)),qs.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(v/u),this._m4_1.makeTranslation(qs.x,qs.y,qs.z)}}this.dispatchEvent(Tr)}}),rn(this,"onSinglePanEnd",()=>{if(this._state==yn.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const t=Math.abs((this._wPrev+this._wCurr)/2),i=this;this._animationId=window.requestAnimationFrame(function(s){i.updateTbState(yn.ANIMATION_ROTATE,!0);const o=i.calculateRotationAxis(i._cursorPosPrev,i._cursorPosCurr);i.onRotationAnim(s,o,Math.min(t,i.wMax))})}else this.updateTbState(yn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Tr);else this.updateTbState(yn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Tr)}else(this._state==yn.PAN||this._state==yn.IDLE)&&(this.updateTbState(yn.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(Tr));this.dispatchEvent(Fl)}),rn(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&null!=this.scene){this.dispatchEvent(gc),this.setCenter(e.clientX,e.clientY);const t=this.unprojectOnObj(this.getCursorNDC(ti.x,ti.y,this.domElement),this.camera);if(null!=t&&this.enableAnimations){const i=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(s){i.updateTbState(yn.ANIMATION_FOCUS,!0),i.onFocusAnim(s,t,i._cameraMatrixState,i._gizmoMatrixState)})}else null!=t&&!this.enableAnimations&&(this.updateTbState(yn.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Tr))}this.dispatchEvent(Fl)}),rn(this,"onDoublePanStart",()=>{this.enabled&&this.enablePan&&(this.dispatchEvent(gc),this.updateTbState(yn.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))}),rn(this,"onDoublePanMove",()=>{this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=yn.PAN&&(this.updateTbState(yn.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(Tr))}),rn(this,"onDoublePanEnd",()=>{this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Fl)}),rn(this,"onRotateStart",()=>{this.enabled&&this.enableRotate&&(this.dispatchEvent(gc),this.updateTbState(yn.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.camera.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}),rn(this,"onRotateMove",()=>{if(this.enabled&&this.enableRotate){let e;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=yn.ZROTATE&&(this.updateTbState(yn.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),e=this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):e=(new Y).setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.zRotate(e,Zr.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation))),this.dispatchEvent(Tr)}}),rn(this,"onRotateEnd",()=>{this.updateTbState(yn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Fl)}),rn(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(gc),this.updateTbState(yn.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),rn(this,"onPinchMove",()=>{if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const e=12;this._state!=yn.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(yn.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),e*this._devPxRatio);const t=this._currentFingerDistance/this._startFingerDistance;let i;this.enablePan?this.camera.isOrthographicCamera?i=this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(i=this.unprojectOnTbPlane(this.camera,ti.x,ti.y,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):i=this._gizmos.position,this.applyTransformMatrix(this.scale(t,i)),this.dispatchEvent(Tr)}}),rn(this,"onPinchEnd",()=>{this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Fl)}),rn(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom){this.dispatchEvent(gc),this.updateTbState(yn.SCALE,!0);let e=0,t=0;const i=this._touchCurrent.length;for(let s=0;s<i;s++)e+=this._touchCurrent[s].clientX,t+=this._touchCurrent[s].clientY;this.setCenter(e/i,t/i),this._startCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),rn(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom){let e=0,t=0;const i=this._touchCurrent.length;for(let x=0;x<i;x++)e+=this._touchCurrent[x].clientX,t+=this._touchCurrent[x].clientY;this.setCenter(e/i,t/i);const s=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(ti.x,ti.y,this.domElement).y);const o=this._currentCursorPosition.y-this._startCursorPosition.y;let l=1;o<0?l=1/Math.pow(this.scaleFactor,-o*s):o>0&&(l=Math.pow(this.scaleFactor,o*s)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const u=this._v3_1.distanceTo(this._gizmos.position);let f=u/l;f=Zr.clamp(f,this.minDistance,this.maxDistance);const m=u*Math.tan(Zr.DEG2RAD*this._fovState*.5);let y=Zr.RAD2DEG*(2*Math.atan(m/f));y=Zr.clamp(y,this.minFov,this.maxFov);const v=m/Math.tan(Zr.DEG2RAD*(y/2));l=u/v,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(y),this.applyTransformMatrix(this.scale(l,this._v3_2,!1)),qs.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(v/u),this._m4_1.makeTranslation(qs.x,qs.y,qs.z),this.dispatchEvent(Tr)}}),rn(this,"onTriplePanEnd",()=>{this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Fl)}),rn(this,"setCenter",(e,t)=>{ti.x=e,ti.y=t}),rn(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),rn(this,"compareMouseAction",(e,t)=>e.operation==t.operation&&e.mouse==t.mouse&&e.key==t.key),rn(this,"setMouseAction",(e,t,i=null)=>{let u;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(i)||"WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":u=yn.PAN;break;case"ROTATE":u=yn.ROTATE;break;case"ZOOM":u=yn.SCALE;break;case"FOV":u=yn.FOV}const f={operation:e,mouse:t,key:i,state:u};for(let m=0;m<this.mouseActions.length;m++)if(this.mouseActions[m].mouse==f.mouse&&this.mouseActions[m].key==f.key)return this.mouseActions.splice(m,1,f),!0;return this.mouseActions.push(f),!0}),rn(this,"unsetMouseAction",(e,t=null)=>{for(let i=0;i<this.mouseActions.length;i++)if(this.mouseActions[i].mouse==e&&this.mouseActions[i].key==t)return this.mouseActions.splice(i,1),!0;return!1}),rn(this,"getOpFromAction",(e,t)=>{let i;for(let s=0;s<this.mouseActions.length;s++)if(i=this.mouseActions[s],i.mouse==e&&i.key==t)return i.operation;if(null!=t)for(let s=0;s<this.mouseActions.length;s++)if(i=this.mouseActions[s],i.mouse==e&&null==i.key)return i.operation;return null}),rn(this,"getOpStateFromAction",(e,t)=>{let i;for(let s=0;s<this.mouseActions.length;s++)if(i=this.mouseActions[s],i.mouse==e&&i.key==t)return i.state;if(null!=t)for(let s=0;s<this.mouseActions.length;s++)if(i=this.mouseActions[s],i.mouse==e&&null==i.key)return i.state;return null}),rn(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),rn(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),rn(this,"calculateAngularSpeed",(e,t,i,s)=>{const l=(s-i)/1e3;return 0==l?0:(t-e)/l}),rn(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),rn(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),rn(this,"calculateTbRadius",e=>{const t=e.position.distanceTo(this._gizmos.position);if("PerspectiveCamera"==e.type){const i=Zr.DEG2RAD*e.fov*.5,s=Math.atan(e.aspect*Math.tan(i));return Math.tan(Math.min(i,s))*t*this.radiusFactor}if("OrthographicCamera"==e.type)return Math.min(e.top,e.right)*this.radiusFactor}),rn(this,"focus",(e,t,i=1)=>{qs.copy(e).sub(this._gizmos.position).multiplyScalar(i),this._translationMatrix.makeTranslation(qs.x,qs.y,qs.z),iO.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),rO.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(t,this._gizmos.position)),this._gizmoMatrixState.copy(iO),this._cameraMatrixState.copy(rO)}),rn(this,"drawGrid",()=>{if(null!=this.scene){let i,s,o,l;if(this.camera.isOrthographicCamera)o=Math.max(this.camera.right-this.camera.left,this.camera.bottom-this.camera.top),l=o/20,i=o/this.camera.zoom*3,s=i/l*this.camera.zoom;else if(this.camera.isPerspectiveCamera){const u=this.camera.position.distanceTo(this._gizmos.position),f=Zr.DEG2RAD*this.camera.fov*.5,m=Math.atan(this.camera.aspect*Math.tan(f));o=Math.tan(Math.max(f,m))*u*2,l=o/20,i=3*o,s=i/l}null==this._grid&&(this._grid=new CN(i,s,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),rn(this,"dispose",()=>{-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onWheel),this.domElement.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null!==this.scene&&this.scene.remove(this._gizmos),this.disposeGrid()}),rn(this,"disposeGrid",()=>{null!=this._grid&&null!=this.scene&&(this.scene.remove(this._grid),this._grid=null)}),rn(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),rn(this,"activateGizmos",e=>{const t=this._gizmos.children[0],i=this._gizmos.children[1],s=this._gizmos.children[2];e?(t.material.setValues({opacity:1}),i.material.setValues({opacity:1}),s.material.setValues({opacity:1})):(t.material.setValues({opacity:.6}),i.material.setValues({opacity:.6}),s.material.setValues({opacity:.6}))}),rn(this,"getCursorNDC",(e,t,i)=>{const s=i.getBoundingClientRect();return this._v2_1.setX((e-s.left)/s.width*2-1),this._v2_1.setY((s.bottom-t)/s.height*2-1),this._v2_1.clone()}),rn(this,"getCursorPosition",(e,t,i)=>(this._v2_1.copy(this.getCursorNDC(e,t,i)),this._v2_1.x*=.5*(this.camera.right-this.camera.left),this._v2_1.y*=.5*(this.camera.top-this.camera.bottom),this._v2_1.clone())),rn(this,"setCamera",e=>{e.lookAt(this.target),e.updateMatrix(),"PerspectiveCamera"==e.type&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(e),this.makeGizmos(this.target,this._tbRadius)}),rn(this,"makeGizmos",(e,t)=>{const s=new tf(0,0,t,t).getPoints(this._curvePts),o=(new xn).setFromPoints(s),l=new Gs({color:16744576,fog:!1,transparent:!0,opacity:.6}),u=new Gs({color:8454016,fog:!1,transparent:!0,opacity:.6}),f=new Gs({color:8421631,fog:!1,transparent:!0,opacity:.6}),m=new Zc(o,l),y=new Zc(o,u),v=new Zc(o,f),x=.5*Math.PI;if(m.rotation.x=x,y.rotation.y=x,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),1!=this.camera.zoom){const b=1/this.camera.zoom;this._scaleMatrix.makeScale(b,b,b),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(m),this._gizmos.add(y),this._gizmos.add(v)}),rn(this,"onFocusAnim",(e,t,i,s)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==yn.ANIMATION_FOCUS){const l=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(s),l>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(yn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Tr);else{const u=this.easeOutCubic(l),f=1-u+this.scaleFactor*u;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,f,u),this.dispatchEvent(Tr);const m=this;this._animationId=window.requestAnimationFrame(function(y){m.onFocusAnim(y,t,i,s.clone())})}}else this._animationId=-1,this._timeStart=-1}),rn(this,"onRotationAnim",(e,t,i)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==yn.ANIMATION_ROTATE){const s=(e-this._timeStart)/1e3;if(i+-this.dampingFactor*s>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(s,2)+i*s+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(Tr);const l=this;this._animationId=window.requestAnimationFrame(function(u){l.onRotationAnim(u,t,i)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(yn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Tr)}else this._animationId=-1,this._timeStart=-1,this._state!=yn.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(Tr))}),rn(this,"pan",(e,t,i=!1)=>{const s=e.clone().sub(t);if(this.camera.isOrthographicCamera)s.multiplyScalar(1/this.camera.zoom);else if(this.camera.isPerspectiveCamera&&i){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const o=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);s.multiplyScalar(1/o)}return this._v3_1.set(s.x,s.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),nl}),rn(this,"reset",()=>{this.camera.zoom=this._zoom0,this.camera.isPerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Tr)}),rn(this,"rotate",(e,t)=>{const i=this._gizmos.position;return this._translationMatrix.makeTranslation(-i.x,-i.y,-i.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),nl}),rn(this,"copyState",()=>{let e;this.camera.isOrthographicCamera?e=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}):this.camera.isPerspectiveCamera&&(e=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}})),navigator.clipboard.writeText(e)}),rn(this,"pasteState",()=>{const e=this;navigator.clipboard.readText().then(function(i){e.setStateFromJSON(i)})}),rn(this,"saveState",()=>{this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera.isPerspectiveCamera&&(this._fov0=this.camera.fov)}),rn(this,"scale",(e,t,i=!0)=>{yc.copy(t);let s=1/e;if(this.camera.isOrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,s=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,s=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(s,s,s),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),yc.sub(this._v3_1);const o=yc.clone().multiplyScalar(s);return yc.sub(o),this._m4_1.makeTranslation(yc.x,yc.y,yc.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),nl}if(this.camera.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let o=this._v3_1.distanceTo(yc),l=o-o*s;const u=o-l;if(u<this.minDistance?(s=this.minDistance/o,l=o-o*s):u>this.maxDistance&&(s=this.maxDistance/o,l=o-o*s),qs.copy(yc).sub(this._v3_1).normalize().multiplyScalar(l),this._m4_1.makeTranslation(qs.x,qs.y,qs.z),i){const f=this._v3_2;o=f.distanceTo(yc),l=o-o*s,qs.copy(yc).sub(this._v3_2).normalize().multiplyScalar(l),this._translationMatrix.makeTranslation(f.x,f.y,f.z),this._scaleMatrix.makeScale(s,s,s),this._m4_2.makeTranslation(qs.x,qs.y,qs.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-f.x,-f.y,-f.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return nl}}),rn(this,"setFov",e=>{this.camera.isPerspectiveCamera&&(this.camera.fov=Zr.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),rn(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),nl)),rn(this,"unprojectOnObj",(e,t)=>{const i=this.getRaycaster();i.near=t.near,i.far=t.far,i.setFromCamera(e,t);const s=i.intersectObjects(this.scene.children,!0);for(let o=0;o<s.length;o++)if(s[o].object.uuid!=this._gizmos.uuid&&null!=s[o].face)return s[o].point.clone();return null}),rn(this,"unprojectOnTbSurface",(e,t,i,s,o)=>{if("OrthographicCamera"==e.type){this._v2_1.copy(this.getCursorPosition(t,i,s)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const l=Math.pow(this._v2_1.x,2),u=Math.pow(this._v2_1.y,2),f=Math.pow(this._tbRadius,2);return this._v3_1.setZ(l+u<=.5*f?Math.sqrt(f-(l+u)):.5*f/Math.sqrt(l+u)),this._v3_1}if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(t,i,s)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const l=this._v3_1.clone().normalize(),u=e.position.distanceTo(this._gizmos.position),f=Math.pow(o,2),m=this._v3_1.z,y=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==y)return l.set(this._v3_1.x,this._v3_1.y,o),l;const v=m/y,x=u;let b=Math.pow(v,2)+1,E=2*v*x,C=Math.pow(x,2)-f,A=Math.pow(E,2)-4*b*C;if(A>=0&&(this._v2_1.setX((-E-Math.sqrt(A))/(2*b)),this._v2_1.setY(v*this._v2_1.x+x),Zr.RAD2DEG*this._v2_1.angle()>=45)){const V=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return l.multiplyScalar(V),l.z+=u,l}b=v,E=x,C=.5*-f,A=Math.pow(E,2)-4*b*C,this._v2_1.setX((-E-Math.sqrt(A))/(2*b)),this._v2_1.setY(v*this._v2_1.x+x);const N=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(u-this._v2_1.y,2));return l.multiplyScalar(N),l.z+=u,l}}),rn(this,"unprojectOnTbPlane",(e,t,i,s,o=!1)=>{if("OrthographicCamera"==e.type)return this._v2_1.copy(this.getCursorPosition(t,i,s)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(t,i,s)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const l=this._v3_1.clone().normalize(),u=this._v3_1.z,f=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let m;if(m=o?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==f)return l.set(0,0,0),l;const x=-m/(u/f),b=Math.sqrt(Math.pow(m,2)+Math.pow(x,2));return l.multiplyScalar(b),l.z=0,l}}),rn(this,"updateMatrixState",()=>{this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera.isOrthographicCamera?(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom):this.camera.isPerspectiveCamera&&(this._fovState=this.camera.fov)}),rn(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),rn(this,"update",()=>{if(!1===this.target.equals(this._currentTarget)&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.camera.isOrthographicCamera){if(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom){const t=Zr.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(t/this.camera.zoom,this._gizmos.position,!0))}}else if(this.camera.isPerspectiveCamera){const t=this.camera.position.distanceTo(this._gizmos.position);if(t>this.maxDistance+1e-6||t<this.minDistance-1e-6){const s=Zr.clamp(t,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(s/t,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=Zr.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const i=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.camera),i<this._tbRadius-1e-6||i>this._tbRadius+1e-6){const o=this._tbRadius/((this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3),u=new tf(0,0,o,o).getPoints(this._curvePts),f=(new xn).setFromPoints(u);for(const m in this._gizmos.children)this._gizmos.children[m].geometry=f}}this.camera.lookAt(this._gizmos.position)}),rn(this,"setStateFromJSON",e=>{const t=JSON.parse(e);if(null!=t.arcballState){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera.isPerspectiveCamera&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera);const i=(new Ft).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(i),this.camera.lookAt(this._gizmos.position),this.updateTbState(yn.IDLE,!1),this.dispatchEvent(Tr)}}),this.camera=null,this.domElement=t,this.scene=i,this.target=new Y,this._currentTarget=new Y,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new at,this._v3_1=new Y,this._v3_2=new Y,this._m4_1=new Ft,this._m4_2=new Ft,this._quat=new ks,this._translationMatrix=new Ft,this._rotationMatrix=new Ft,this._scaleMatrix=new Ft,this._rotationAxis=new Y,this._cameraMatrixState=new Ft,this._cameraProjectionState=new Ft,this._fovState=1,this._upState=new Y,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Ft,this._up0=new Y,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Ft,this._gizmoMatrixState0=new Ft,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=dr.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new Y,this._startCursorPosition=new Y,this._grid=null,this._gridPosition=new Y,this._gizmos=new um,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new Y,this._cursorPosCurr=new Y,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=yn.IDLE,this.setCamera(e),null!=this.scene&&this.scene.add(this._gizmos),this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("wheel",this.onWheel),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(null!=e.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==yn.ROTATE||this._state==yn.ZROTATE||this._state==yn.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),null!=e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==yn.SCALE||this._state==yn.FOCUS||this._state==yn.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.camera),this.adjustNearFar){const t=this.camera.position.distanceTo(this._gizmos.position),i=new Uo;i.setFromObject(this._gizmos);const s=new Kc;i.getBoundingSphere(s);const o=Math.max(this._nearPos0,s.radius+s.center.length()),u=Math.min(o,t-this._initialNear);this.camera.near=t-u;const f=Math.min(this._farPos0,-s.radius+s.center.length()),y=Math.min(f,t-this._initialFar);this.camera.far=t-y,this.camera.updateProjectionMatrix()}else{let t=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,t=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,t=!0),t&&this.camera.updateProjectionMatrix()}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(Tr)}setTbRadius(e){this.radiusFactor=e,this._tbRadius=this.calculateTbRadius(this.camera);const i=new tf(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),s=(new xn).setFromPoints(i);for(const o in this._gizmos.children)this._gizmos.children[o].geometry=s;this.dispatchEvent(Tr)}setTransformationMatrices(e=null,t=null){null!=e?null!=nl.camera?nl.camera.copy(e):nl.camera=e.clone():nl.camera=null,null!=t?null!=nl.gizmos?nl.gizmos.copy(t):nl.gizmos=t.clone():nl.gizmos=null}getRaycaster(){return mj}}class yj{constructor(e,t){this.sceneElementsService=e,this.socket=t,this.renderer=new hr,this.scene=new LE,this.camera=new vo(45,1,.1,1e3),this.cameraControls=new gj(this.camera,this.renderer.domElement),this.potree=new fR.Potree,this.pointClouds=[],this.loop=i=>{this.reqAnimationFrameHandle=requestAnimationFrame(this.loop),this.update(),this.render()},this.resize=()=>{if(!this.targetEl)return;const{width:i,height:s}=this.targetEl.getBoundingClientRect();this.camera.aspect=i/s,this.camera.updateProjectionMatrix(),this.renderer.setSize(i,s)},this.currentCameraState=this.getCurrentCameraState(this.camera.clone())}initialize(e){this.targetEl||!e||(this.targetEl=e,this.targetEl.appendChild(this.renderer.domElement),this.camera.position.equals(new Y(0,0,0))&&(this.camera.position.z=60,this.camera.position.y=10),this.cameraControls.enableZoom=!0,this.cameraControls.enableRotate=!0,this.cameraControls.dampingFactor=.25,this.resize(),window.addEventListener("resize",this.resize),requestAnimationFrame(this.loop))}destroy(){this.targetEl.removeChild(this.renderer.domElement),this.targetEl=void 0,window.removeEventListener("resize",this.resize),this.pointClouds.map(e=>this.scene.remove(e)),this.pointClouds=[],void 0!==this.reqAnimationFrameHandle&&cancelAnimationFrame(this.reqAnimationFrameHandle)}loadPotreePCO(e,t){return this.potree.loadPointCloud(e,i=>`${t}${i}`).then(i=>(this.scene.add(i),this.pointClouds.push(i),i))}loadCameraTrajectory(e){this.loadLineSet(e.lineSet),this.scene.add(e.mesh)}loadLineSet(e){e.lines.forEach(t=>{this.scene.add(t)})}loadDefaultPC(e){return(new Eq).loadAsync(e).then(i=>{let s=new Sq(i,new ky({vertexColors:!0}));return this.scene.add(s),s})}update(){this.cameraControls.update(),this.potree.updatePointClouds(this.pointClouds,this.camera,this.renderer)}render(){this.renderer.clear(),this.renderer.render(this.scene,this.camera)}changeBackground(e){this.scene.background=new Ut(e)}setPointBudget(e){this.potree.pointBudget=e}setCameraFOV(e){this.camera.fov=e}pickPointTest(){let e;if(!(this.pointClouds.length>0))return;e=this.pointClouds[0];let t=new Yd,i=e.pick(this.renderer,this.camera,t);console.log(i)}setCameraSync(e){if(e){this.socket.connect();let t=()=>{this.currentCameraState=this.getCurrentCameraState(this.camera),this.socket.sendCameraState(0,eu.fullToMinifiedCameraState(this.currentCameraState))};this.cameraControls.addEventListener("change",t),t(),this.socket.getMessage(wR.cameraSyncEvent).subscribe(i=>{this.setCameraState(eu.minifiedToFullCameraState(i))})}else this.socket.disconnect(),this.cameraControls.removeEventListener("change",()=>{})}getCurrentCameraState(e){let t=new ks;return t.setFromEuler(e.rotation),{position:e.position,rotation:t,fov:e.fov,near:e.near,far:e.far,lastUpdate:Date.now()}}setCameraState(e){this.currentCameraState=e,this.camera.position.set(e.position.x,e.position.y,e.position.z);let t=new $d;t.setFromQuaternion(e.rotation),this.camera.rotation.set(t.x,t.y,t.z,"XZY"),this.camera.fov=e.fov,this.camera.near=e.near,this.camera.far=e.far}}var Nr=(()=>{return(n=Nr||(Nr={})).POTREE_POINT_CLOUD="potree_point_cloud",n.DEFAULT_POINT_CLOUD="default_point_cloud",n.LINE_SET="line_set",n.CAMERA_TRAJECTORY="camera_trajectory",n.UNKNOWN="unknown",Nr;var n})();const sO=new Uo,AS=new Y;class MR extends sR{constructor(){super(),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Kt([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Kt([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new fS(t,6,1);return this.setAttribute("instanceStart",new tl(i,3,0)),this.setAttribute("instanceEnd",new tl(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new fS(t,6,1);return this.setAttribute("instanceColorStart",new tl(i,3,0)),this.setAttribute("instanceColorEnd",new tl(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new tR(e.geometry)),this}fromLineSegments(e){const t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Uo);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),sO.setFromBufferAttribute(t),this.boundingBox.union(sO))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Kc),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let o=0,l=e.count;o<l;o++)AS.fromBufferAttribute(e,o),s=Math.max(s,i.distanceToSquared(AS)),AS.fromBufferAttribute(t,o),s=Math.max(s,i.distanceToSquared(AS));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}MR.prototype.isLineSegmentsGeometry=!0,Rt.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new at(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Na.line={uniforms:MD.merge([Rt.common,Rt.fog,Rt.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class DS extends Il{constructor(e){super({type:"LineMaterial",uniforms:MD.clone(Na.line.uniforms),vertexShader:Na.line.vertexShader,fragmentShader:Na.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}DS.prototype.isLineMaterial=!0;const oO=new Y,aO=new Y,Po=new Wi,Io=new Wi,nu=new Wi,ER=new Y,SR=new Ft,Go=new bN,lO=new Y,RS=new Uo,PS=new Kc,iu=new Wi;let ru,CR,cO,gm;function uO(n,e,t){return iu.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),iu.multiplyScalar(1/iu.w),iu.x=gm/t.width,iu.y=gm/t.height,iu.applyMatrix4(n.projectionMatrixInverse),iu.multiplyScalar(1/iu.w),Math.abs(Math.max(iu.x,iu.y))}class hO extends Hs{constructor(e=new MR,t=new DS({color:16777215*Math.random()})){super(e,t),this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let l=0,u=0,f=t.count;l<f;l++,u+=2)oO.fromBufferAttribute(t,l),aO.fromBufferAttribute(i,l),s[u]=0===u?0:s[u-1],s[u+1]=s[u]+oO.distanceTo(aO);const o=new fS(s,2,1);return e.setAttribute("instanceDistanceStart",new tl(o,1,0)),e.setAttribute("instanceDistanceEnd",new tl(o,1,1)),this}raycast(e,t){const i=this.material.worldUnits,s=e.camera;null===s&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.'),ru=e.ray;const l=this.matrixWorld,u=this.geometry,f=this.material;let m,y;gm=f.linewidth+(void 0!==e.params.Line2&&e.params.Line2.threshold||0),CR=u.attributes.instanceStart,cO=u.attributes.instanceEnd,null===u.boundingSphere&&u.computeBoundingSphere(),PS.copy(u.boundingSphere).applyMatrix4(l),m=i?.5*gm:uO(s,Math.max(s.near,PS.distanceToPoint(ru.origin)),f.resolution),PS.radius+=m,!1!==ru.intersectsSphere(PS)&&(null===u.boundingBox&&u.computeBoundingBox(),RS.copy(u.boundingBox).applyMatrix4(l),y=i?.5*gm:uO(s,Math.max(s.near,RS.distanceToPoint(ru.origin)),f.resolution),RS.expandByScalar(y),!1!==ru.intersectsBox(RS)&&(i?function _j(n,e){for(let t=0,i=CR.count;t<i;t++){Go.start.fromBufferAttribute(CR,t),Go.end.fromBufferAttribute(cO,t);const s=new Y,o=new Y;ru.distanceSqToSegment(Go.start,Go.end,o,s),o.distanceTo(s)<.5*gm&&e.push({point:o,pointOnLine:s,distance:ru.origin.distanceTo(o),object:n,face:null,faceIndex:t,uv:null,uv2:null})}}(this,t):function vj(n,e,t){const i=e.projectionMatrix,o=n.material.resolution,l=n.matrixWorld,u=n.geometry,f=u.attributes.instanceStart,m=u.attributes.instanceEnd,y=-e.near;ru.at(1,nu),nu.w=1,nu.applyMatrix4(e.matrixWorldInverse),nu.applyMatrix4(i),nu.multiplyScalar(1/nu.w),nu.x*=o.x/2,nu.y*=o.y/2,nu.z=0,ER.copy(nu),SR.multiplyMatrices(e.matrixWorldInverse,l);for(let v=0,x=f.count;v<x;v++){if(Po.fromBufferAttribute(f,v),Io.fromBufferAttribute(m,v),Po.w=1,Io.w=1,Po.applyMatrix4(SR),Io.applyMatrix4(SR),Po.z>y&&Io.z>y)continue;Po.z>y?Po.lerp(Io,(Po.z-y)/(Po.z-Io.z)):Io.z>y&&Io.lerp(Po,(Io.z-y)/(Io.z-Po.z)),Po.applyMatrix4(i),Io.applyMatrix4(i),Po.multiplyScalar(1/Po.w),Io.multiplyScalar(1/Io.w),Po.x*=o.x/2,Po.y*=o.y/2,Io.x*=o.x/2,Io.y*=o.y/2,Go.start.copy(Po),Go.start.z=0,Go.end.copy(Io),Go.end.z=0;const E=Go.closestPointToPointParameter(ER,!0);Go.at(E,lO);const C=Zr.lerp(Po.z,Io.z,E),A=C>=-1&&C<=1,N=ER.distanceTo(lO)<.5*gm;if(A&&N){Go.start.fromBufferAttribute(f,v),Go.end.fromBufferAttribute(m,v),Go.start.applyMatrix4(l),Go.end.applyMatrix4(l);const F=new Y,V=new Y;ru.distanceSqToSegment(Go.start,Go.end,V,F),t.push({point:V,pointOnLine:F,distance:ru.origin.distanceTo(V),object:n,face:null,faceIndex:v,uv:null,uv2:null})}}}(this,s,t)))}}hO.prototype.isLineSegments2=!0;class TR extends MR{constructor(){super(),this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")}}TR.prototype.isLineGeometry=!0;class dO extends hO{constructor(e=new TR,t=new DS({color:16777215*Math.random()})){super(e,t),this.type="Line2"}}dO.prototype.isLine2=!0;class fO extends Zi{constructor(e){super(),this.material=new DS({linewidth:.002}),this.lines=[],e&&e.forEach(t=>{this.addLine(t)})}addLine(e){let t=new TR;const i=[];e.forEach(o=>i.push(o.x,o.y,o.z)),t.setPositions(i);let s=new dO(t,this.material);this.lines.push(s)}applyMatrix4(e){this.lines.forEach(t=>{t.applyMatrix4(e)})}setVisibility(e){this.visible=e,this.lines.forEach(t=>{t.visible=e})}setColor(e){this.material.color.set(e)}setLineWidth(e){this.material.linewidth=e}}class xj extends Zi{constructor(e,t,i){super(),this.originTrajectory={x:new Y(0,0,0),y1:new Y(-.5,1/3,1),y2:new Y(.5,1/3,1),y3:new Y(.5,-1/3,1),y4:new Y(-.5,-1/3,1)},this.size=1,this.points=this.originTrajectory;let s=new Ft;s.makeRotationFromQuaternion(new ks(t[1],t[2],t[3],t[0])),s.setPosition(e[0],e[1],e[2]),s.invert(),this.lineSet=this.pointsToLineSet(),this.mesh=this.createMesh(),i&&new Promise(o=>{let l=new K3;this.mesh.material=new $c({map:l.load(i),side:2}),o(i)}).then(),this.applyTransform(s)}setColor(e){this.lineSet.setColor(e)}getColor(){return this.lineSet.material.color}setVisibility(e){this.visible=e,this.lineSet.setVisibility(e),this.mesh.visible=e&&this.mesh.visible}setLineWidth(e){this.lineSet.setLineWidth(e)}setSize(e){let t=e/this.size,i=this.lineSet.position.clone(),s=i.x,o=i.y,l=i.z;this.lineSet.lines.forEach(u=>{u.geometry.translate(-s,-o,-l),u.geometry.scale(t,t,t),u.geometry.translate(s,o,l)}),this.size=e,this.mesh.geometry.translate(-s,-o,-l),this.mesh.geometry.scale(t,t,t),this.mesh.geometry.translate(s,o,l)}applyMatrix4(e){this.lineSet.applyMatrix4(e),this.mesh.applyMatrix4(e)}applyTransform(e){this.mesh.quaternion.setFromRotationMatrix(e),this.mesh.position.setFromMatrixPosition(e),this.lineSet.lines.forEach(t=>{t.quaternion.setFromRotationMatrix(e),t.position.setFromMatrixPosition(e)})}createMesh(){let e=this.points.y1.distanceTo(this.points.y2),t=this.points.y1.distanceTo(this.points.y4),i=new Cy(e,t);i.setFromPoints([this.points.y3,this.points.y4,this.points.y2,this.points.y1]);let s=new $c,o=new Hs(i,s);return o.visible=!1,o}pointsToLineSet(){let e=[];return e.push([this.points.x,this.points.y1]),e.push([this.points.x,this.points.y2]),e.push([this.points.x,this.points.y3]),e.push([this.points.x,this.points.y4]),e.push([this.points.y1,this.points.y2]),e.push([this.points.y2,this.points.y3]),e.push([this.points.y3,this.points.y4]),e.push([this.points.y4,this.points.y1]),new fO(e)}}class bj{constructor(e,t){this._document=t;const i=this._textarea=this._document.createElement("textarea"),s=i.style;s.position="fixed",s.top=s.opacity="0",s.left="-999em",i.setAttribute("aria-hidden","true"),i.value=e,this._document.body.appendChild(i)}copy(){const e=this._textarea;let t=!1;try{if(e){const i=this._document.activeElement;e.select(),e.setSelectionRange(0,e.value.length),t=this._document.execCommand("copy"),i&&i.focus()}}catch(i){}return t}destroy(){const e=this._textarea;e&&(e.remove(),this._textarea=void 0)}}let AR,wj=(()=>{class n{constructor(t){this._document=t}copy(t){const i=this.beginCopy(t),s=i.copy();return i.destroy(),s}beginCopy(t){return new bj(t,this._document)}}return n.\u0275fac=function(t){return new(t||n)(Bn(Pa))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Mj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({}),n})();try{AR="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){AR=!1}let Ej=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?YL(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!AR)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(Bn(w0))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Sj=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({}),n})();class Aj extends Xt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}const{isArray:Dj}=Array;function mO(n){return yr(e=>function Rj(n,e){return Dj(e)?n(...e):n(e)}(n,e))}const Pj=["addListener","removeListener"],Ij=["addEventListener","removeEventListener"],Lj=["on","off"];function px(n,e,t,i){if(gt(t)&&(i=t,t=void 0),i)return px(n,e,t).pipe(mO(i));const[s,o]=function Oj(n){return gt(n.addEventListener)&&gt(n.removeEventListener)}(n)?Ij.map(l=>u=>n[l](e,u,t)):function Fj(n){return gt(n.addListener)&&gt(n.removeListener)}(n)?Pj.map(gO(n,e)):function Nj(n){return gt(n.on)&&gt(n.off)}(n)?Lj.map(gO(n,e)):[];if(!s&&Ua(n))return Es(l=>px(l,e,t))(de(n));if(!s)throw new TypeError("Invalid event target");return new Ar(l=>{const u=(...f)=>l.next(1<f.length?f:f[0]);return s(u),()=>o(u)})}function gO(n,e){return t=>i=>n[t](e,i)}function RR(n,e){return Di((t,i)=>{let s=null,o=0,l=!1;const u=()=>l&&!s&&i.complete();t.subscribe(wn(i,f=>{null==s||s.unsubscribe();let m=0;const y=o++;de(n(f,y)).subscribe(s=wn(i,v=>i.next(e?e(f,v,y,m++):v),()=>{s=null,u()}))},()=>{l=!0,u()}))})}const yO=Et(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Bj(n){return Di((e,t)=>{let i=!1;e.subscribe(wn(t,s=>{i=!0,t.next(s)},()=>{i||t.next(n),t.complete()}))})}function kj(n=Vj){return Di((e,t)=>{let i=!1;e.subscribe(wn(t,s=>{i=!0,t.next(s)},()=>i?t.complete():t.error(n())))})}function Vj(){return new yO}function _m(n,e,t){const i=gt(n)||e||t?{next:n,error:e,complete:t}:n;return i?Di((s,o)=>{var l;null===(l=i.subscribe)||void 0===l||l.call(i);let u=!0;s.subscribe(wn(o,f=>{var m;null===(m=i.next)||void 0===m||m.call(i,f),o.next(f)},()=>{var f;u=!1,null===(f=i.complete)||void 0===f||f.call(i),o.complete()},f=>{var m;u=!1,null===(m=i.error)||void 0===m||m.call(i,f),o.error(f)},()=>{var f,m;u&&(null===(f=i.unsubscribe)||void 0===f||f.call(i)),null===(m=i.finalize)||void 0===m||m.call(i)}))}):$t}function PR(n){let t,e=1/0;return null!=n&&("object"==typeof n?({count:e=1/0,delay:t}=n):e=n),e<=0?()=>$n:Di((i,s)=>{let l,o=0;const u=()=>{if(null==l||l.unsubscribe(),l=null,null!=t){const m="number"==typeof t?Qg(t):de(t(o)),y=wn(s,()=>{y.unsubscribe(),f()});m.subscribe(y)}else f()},f=()=>{let m=!1;l=i.subscribe(wn(s,void 0,()=>{++o<e?l?u():m=!0:s.complete()})),m&&u()};f()})}const zj={leading:!0,trailing:!1};function _O(n,e=zj){return Di((t,i)=>{const{leading:s,trailing:o}=e;let l=!1,u=null,f=null,m=!1;const y=()=>{null==f||f.unsubscribe(),f=null,o&&(b(),m&&i.complete())},v=()=>{f=null,m&&i.complete()},x=E=>f=de(n(E)).subscribe(wn(i,y,v)),b=()=>{if(l){l=!1;const E=u;u=null,i.next(E),!m&&x(E)}};t.subscribe(wn(i,E=>{l=!0,u=E,(!f||f.closed)&&(s?b():x(E))},()=>{m=!0,(!(o&&l&&f)||f.closed)&&i.complete()}))})}function IR(n){return Di((e,t)=>{de(n).subscribe(wn(t,()=>t.complete(),es)),!t.closed&&e.subscribe(t)})}function Hj(n,e,t,i,s){return(o,l)=>{let u=t,f=e,m=0;o.subscribe(wn(l,y=>{const v=m++;f=u?n(f,y,v):(u=!0,y),i&&l.next(f)},s&&(()=>{u&&l.next(f),l.complete()})))}}function vO(n){return"function"==typeof n}const Qj=(n,e)=>{let t=0;for(;t<e.length;){if(n(e[t]))return!0;t+=1}return!1},LS=n=>n,e9=n=>null==n,su="undefined"!=typeof navigator&&navigator.userAgent.includes("Mac OS"),FS={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",cmd:su?"metaKey":"ctrlKey",command:su?"metaKey":"ctrlKey",meta:su?"metaKey":"ctrlKey","left command":"metaKey","right command":"MetaRight","\u2318":su?"metaKey":"ctrlKey",option:"altKey",ctl:"ctrlKey",control:"ctrlKey"},NS={plus:"+"},OS={8:"backspace",9:"tab",13:"enter",16:"shift",17:["ctrl","control"],18:"alt",20:"capslock",27:["esc","escape"],32:["space","spc"],33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:["meta","cmd","command"],93:["meta","cmd","command"],224:["meta","cmd","command"]},bO={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},LR={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},r9=function Jj(n){const e={};for(const t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}(LR);for(let n=1;n<20;++n)OS[111+n]="f"+n;for(let n=0;n<=9;++n)OS[n+96]=n.toString();var hf=(()=>{return(n=hf||(hf={})).Textarea="TEXTAREA",n.Input="INPUT",n.Select="SELECT",n.ContentEditable="CONTENT-EDITABLE",hf;var n})();let s9=0,mx=(()=>{class n{constructor(t){this.document=t,this._shortcuts=[],this._sequences=[],this.throttleTime=0,this._pressed=new Xt,this.pressed$=this._pressed.asObservable(),this.disabled=!1,this._shortcutsSub=new Aj([]),this.shortcuts$=this._shortcutsSub.pipe($a(i=>!!i.length)),this._ignored=[hf.Input,hf.Textarea,hf.Select,hf.ContentEditable],this.isAllowed=i=>{const s=i.event.target,o=!!s.getAttribute("contenteditable"),l=o?hf.ContentEditable:s.nodeName;return s===i.target||(i.allowIn.length?!((n,e)=>this._ignored.filter(t=>!e.includes(t)))(0,i.allowIn).includes(l):!o&&!this._ignored.includes(s.nodeName))},this.mapEvent=i=>this._shortcuts.filter(s=>!s.isSequence).map(s=>Object.assign({},s,{predicates:Qj(LS,s.predicates.map(o=>(n=>(...e)=>{let t=0;const i=n.length;for(;t<i;){if(!n[t].apply(void 0,e))return!1;t+=1}return!0})(o)(i))),event:i})).filter(s=>s.predicates).reduce((s,o)=>s.priority>o.priority?s:o,{priority:0}),this.subscriptions=[],this.keydown$=px(this.document,"keydown"),this.ignore$=this.pressed$.pipe($a(i=>i.event.defaultPrevented),RR(()=>this.clicks$.pipe(function Uj(n,e){const t=arguments.length>=2;return i=>i.pipe(n?$a((s,o)=>n(s,o,i)):$t,Om(1),t?Bj(e):kj(()=>new yO))}())),_m(i=>{i.preventDefault(),i.stopPropagation()}),PR()),this.clicks$=px(this.document,"click",{capture:!0}),this.keyup$=px(this.document,"keyup"),this.keydownCombo$=this.keydown$.pipe($a(i=>!this.disabled),yr(this.mapEvent),$a(i=>!i.target||i.event.target===i.target),$a(i=>vO(i.command)),$a(i=>this.isAllowed(i)),_m(i=>{!i.preventDefault||(i.event.preventDefault(),i.event.stopPropagation())}),_O(i=>Qg(i.throttleTime)),_m(i=>i.command({event:i.event,key:i.key})),_m(i=>this._pressed.next({event:i.event,key:i.key})),IR(this.keyup$),PR(),IA(i=>u2(i))),this.timer$=new Xt,this.resetCounter$=this.timer$.asObservable().pipe(RR(()=>Qg(n.TIMEOUT_SEQUENCE))),this.keydownSequence$=this.keydown$.pipe(yr(i=>({event:i,sequences:this._sequences})),function Gj(n,e){return Di(Hj(n,e,arguments.length>=2,!0))}((i,s)=>{const{event:o}=s,l=i.events.length,u=l?i.sequences:s.sequences,[f]=this.characterFromEvent(o),m=Array.isArray(f)?[...f,o.key]:[f,o.key],y=u.map(b=>{const E=b.sequence.filter(A=>m.some(N=>(NS[A[l]]||A[l])===N)),C=E.length>0;return b.fullMatch?b:Object.assign(Object.assign({},b),{sequence:E,partialMatch:C,event:o,fullMatch:C&&this.isFullMatch({command:b,events:i.events})})}).filter(b=>b.partialMatch||b.fullMatch),[v]=y;if(!v||this.modifiersOn(o))return{events:[],sequences:this._sequences};const x=((n,e)=>e.reduce((t,i)=>{const s=(n=>e=>e[n])(n);return s(i)>s(t)?i:t},{[n]:0}))("priority",y);return y.length>1&&x.fullMatch?{events:[],command:x,sequences:this._sequences}:y.length>1?{events:[...i.events,o],command:y,sequences:y}:v.fullMatch?{events:[],command:v,sequences:this._sequences}:{events:[...i.events,o],command:y,sequences:y}},{events:[],sequences:[]}),RR(({command:i})=>Array.isArray(i)?Qg(500).pipe(yr(()=>({command:i.filter(s=>s.fullMatch)[0]}))):h2({command:i})),IR(this.pressed$),$a(({command:i})=>i&&i.fullMatch),yr(({command:i})=>i),$a(i=>vO(i.command)),$a(i=>!i.target||i.event.target===i.target),$a(this.isAllowed),_m(i=>!i.preventDefault||i.event.preventDefault()),_O(i=>Qg(i.throttleTime)),_m(i=>i.command({event:i.event,key:i.key})),_m(i=>this._pressed.next({event:i.event,key:i.key})),IR(this.resetCounter$),PR()),this.getKeys=i=>i.map(s=>s.trim()).filter(s=>"+"!==s).map(s=>FS.hasOwnProperty(s=NS[s]||s)?o=>!!o[FS[s]]:o=>{const l=s===s.toUpperCase(),u=/[^a-zA-Z\d\s:]/.test(s),f=r9[s],[m]=this.characterFromEvent(o),v=Object.keys(FS).map(b=>FS[b]).some(b=>o[b]),x=Array.isArray(m)?[...m,o.key]:[m,o.key];return!(v&&(!l||u)&&!f&&1===i.length)&&x.some(b=>!(b!==s||!l)||s===b)}),this.subscriptions.push(this.keydownSequence$.subscribe(),this.keydownCombo$.subscribe())}isFullMatch({command:t,events:i}){return!!t&&t.sequence.some(s=>s.length===i.length+1)}get shortcuts(){return this._shortcuts}_characterFromEvent(t){return"number"!=typeof t.which&&(t.which=t.keyCode),NS[t.which]?[NS[t.which],t.shiftKey]:OS[t.which]?[OS[t.which],t.shiftKey]:bO[t.which]?[bO[t.which],t.shiftKey]:String.fromCharCode(t.which).toLowerCase()!==t.key?[String.fromCharCode(t.which).toLowerCase(),t.shiftKey]:[t.key,t.shiftKey]}characterFromEvent(t){const[i,s]=this._characterFromEvent(t);return s&&LR[i]?[LR[i],s]:[i,s]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}isSequence(t){return!t.some(i=>i.includes("+")||1===i.length)}add(t){t=Array.isArray(t)?t:[t];const i=this.parseCommand(t);return i.forEach(s=>{s.isSequence?this._sequences.push(s):this._shortcuts.push(s)}),setTimeout(()=>{this._shortcutsSub.next([...this._shortcuts,...this._sequences])}),i.map(s=>s.id)}remove(t){return t=Array.isArray(t)?t:[t],this._shortcuts=this._shortcuts.filter(i=>!t.includes(i.id)),this._sequences=this._sequences.filter(i=>!t.includes(i.id)),setTimeout(()=>{this._shortcutsSub.next([...this._shortcuts,...this._sequences])}),this}select(t){return this.pressed$.pipe($a(({key:s})=>!!(s=Array.isArray(s)?s:[s]).find(o=>o===t)))}modifiersOn(t){return["metaKey","altKey","ctrlKey"].some(i=>t[i])}parseCommand(t){return(Array.isArray(t)?t:[t]).map(s=>{const o=Array.isArray(s.key)?s.key:[s.key],l=Math.max(...o.map(y=>y.split(" ").filter(LS).length)),u=o.map(y=>this.getKeys(y.split(" ").filter(LS))),f=this.isSequence(o),m=f?o.map(y=>y.split(" ").filter(LS).map(v=>v.trim())):[];return Object.assign(Object.assign({},s),{isSequence:f,sequence:f?m:[],allowIn:s.allowIn||[],key:o,id:""+s9++,throttle:e9(s.throttleTime)?this.throttleTime:s.throttleTime,priority:l,predicates:u})})}}return n.TIMEOUT_SEQUENCE=1e3,n.\u0275fac=function(t){return new(t||n)(Bn(Pa))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),o9=(()=>{class n{constructor(t){this.keyboard=t,this.shortcuts=[],this.clearIds=[],this._disabled=!1}set disabled(t){this._disabled=t,this.clearIds&&(this.keyboard.remove(this.clearIds),this.clearIds=[]),!t&&(this.clearIds=this.keyboard.add(this.shortcuts))}select(t){return this.keyboard.select(t)}ngOnChanges(t){!t.shortcuts||!t.shortcuts.currentValue||(this.clearIds&&this.keyboard.remove(this.clearIds),this._disabled||setTimeout(()=>this.clearIds=this.keyboard.add(t.shortcuts.currentValue)))}ngOnDestroy(){this.keyboard.remove(this.clearIds)}}return n.\u0275fac=function(t){return new(t||n)(He(mx))},n.\u0275cmp=Ts({type:n,selectors:[["ng-keyboard-shortcuts"]],inputs:{shortcuts:"shortcuts",disabled:"disabled"},features:[uo],decls:0,vars:0,template:function(t,i){},encapsulation:2}),n})(),a9=(()=>{class n{constructor(t){this.keyboard=t,this.shortcuts$=this.keyboard.shortcuts$.pipe(yr(i=>i.filter(s=>Boolean(s.label)&&Boolean(s.description)).map(({key:s,label:o,description:l})=>({key:s,label:o,description:l}))))}}return n.\u0275fac=function(t){return new(t||n)(Bn(mx))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),l9=(()=>{class n{constructor(t){this.keyboardService=t}select(t){return this.keyboardService.select(t)}}return n.\u0275fac=function(t){return new(t||n)(Bn(mx))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const d9={multi:!0,provide:D0,useClass:(()=>{class n{constructor(t,i){this.ngZone=t,this.keyboard=i}supports(t){return t.split(".").includes("shortcut")}addEventListener(t,i,s){const o=i.split("."),l=o.includes("prevent");if(0===o.length)throw new Error("please provide a shortcut");const[,u,f,m]=o,y=this.keyboard.add({key:u,command(v){s(v)},description:f,preventDefault:l,label:m});return()=>{this.keyboard.remove(y)}}}return n.\u0275fac=function(t){return new(t||n)(Bn(Vo),Bn(mx))},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})()};let f9=(()=>{class n{static forRoot(){return{ngModule:n,providers:[mx,a9,l9,d9]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({imports:[[EA]]}),n})();"undefined"!=typeof Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(n){let e=this;do{if(e.matches(n))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null})),Array.prototype.flat||(Array.prototype.flat=function(n){var e=[];return function t(i,s){for(let o of i)Array.isArray(o)&&s>0?t(o,s-1):e.push(o)}(this,Math.floor(n)||1),e}),Array.prototype.flatMap||(Array.prototype.flatMap=function(){return Array.prototype.map.apply(this,arguments).flat(1)});const p9=["target"];let m9=(()=>{class n{constructor(t,i,s,o){this.sceneElementsService=t,this.socket=i,this.clipboard=s,this.platform=o,this.shortcuts=[],this.viewer=new yj(t,i),this.data={sceneId:-1,elements:[]}}ngOnInit(){}ngAfterViewInit(){this.start(),this.shortcuts.push({key:"ctrl + c",preventDefault:!0,command:()=>{let t=JSON.stringify(this.viewer.getCurrentCameraState(this.viewer.camera));this.clipboard.copy(t),console.log(t)}},{key:"ctrl + v",preventDefault:!0,command:()=>{this.platform.FIREFOX?console.info("Pasting only supported on Chromium Browsers."):navigator.clipboard.readText().then(t=>{this.viewer.setCameraState(JSON.parse(t)),console.log("Pasted camera position")})}})}start(){null!=this.target?(this.viewer.initialize(this.target.nativeElement),console.info("Initialize Viewer with SceneId: "+this.data.sceneId),this.data.viewer=this.viewer,this.sceneElementsService.addViewerData(this.data),this.data.camera&&this.viewer.setCameraState(eu.minifiedToFullCameraState(this.data.camera)),this.data.elements.map(i=>{switch(i.sceneType){case Nr.POTREE_POINT_CLOUD:this.addPotreePointCloud(i.source,i.attributes,i.elementId);break;case Nr.LINE_SET:this.addLineSet(i.source,i.attributes,i.elementId);break;case Nr.CAMERA_TRAJECTORY:this.addCameraTrajectory(i.source,i.attributes,i.elementId);break;case Nr.DEFAULT_POINT_CLOUD:this.addDefaultPointCloud(i.source,i.attributes,i.elementId)}})):console.error("Target element not found")}addDefaultPointCloud(t,i,s){this.viewer.loadDefaultPC(t).then(o=>{i.transformation&&o.applyMatrix4(i.transformation),o.name=i.name,this.sceneElementsService.addSceneElement(this.data.sceneId,s,o)})}addCameraTrajectory(t,i,s){var o;let l=new xj(t.t,t.r,i.imageUrl);l.name=i.name,(null===(o=i.material)||void 0===o?void 0:o.color)?l.setColor(i.material.color):l.setColor("#FF0000"),l.setSize(.5),i.transformation&&l.applyMatrix4(i.transformation),this.viewer.loadCameraTrajectory(l),this.sceneElementsService.addSceneElement(this.data.sceneId,s,l)}addLineSet(t,i,s){var o;let l=[];t.forEach(f=>{let m=new Y;m.fromArray(f[0]);let y=new Y;y.fromArray(f[1]),l.push([m,y])});let u=new fO(l);u.name=i.name,(null===(o=i.material)||void 0===o?void 0:o.color)?u.setColor(i.material.color):u.setColor("#FF0000"),i.transformation&&u.applyMatrix4(i.transformation),this.viewer.loadLineSet(u),this.sceneElementsService.addSceneElement(this.data.sceneId,s,u)}addPotreePointCloud(t,i,s){this.viewer.loadPotreePCO("cloud.js",t).then(o=>{var l;o.name=i.name,(null===(l=i.material)||void 0===l?void 0:l.size)&&(o.material.size=i.material.size),i.transformation&&o.applyMatrix4(i.transformation),this.sceneElementsService.addSceneElement(this.data.sceneId,s,o)})}}return n.\u0275fac=function(t){return new(t||n)(He(YM),He(wR),He(wj),He(Ej))},n.\u0275cmp=Ts({type:n,selectors:[["app-pc-viewer"]],viewQuery:function(t,i){if(1&t&&_0(p9,5),2&t){let s;y0(s=v0())&&(i.target=s.first)}},inputs:{data:"data"},decls:3,vars:1,consts:[[1,"scene-target"],["target",""],[3,"shortcuts"]],template:function(t,i){1&t&&Ei(0,"div",0,1)(2,"ng-keyboard-shortcuts",2),2&t&&(Je(2),Xe("shortcuts",i.shortcuts))},directives:[o9],styles:[".scene-target[_ngcontent-%COMP%]{position:absolute;width:calc(75% - 12px);height:100%}"]}),n})();const g9=["dialogPopup"],y9=["hueSlider"],_9=["alphaSlider"];function v9(n,e){if(1&n&&Ei(0,"div"),2&n){const t=Fe();dt("arrow arrow-",t.cpUsePosition,""),Lr("top",t.arrowTop,"px")}}function x9(n,e){if(1&n){const t=ir();De(0,"div",28),Vt("newValue",function(s){return _t(t),Fe().onColorChange(s)})("dragStart",function(){return _t(t),Fe().onDragStart("saturation-lightness")})("dragEnd",function(){return _t(t),Fe().onDragEnd("saturation-lightness")}),Ei(1,"div",14),Se()}if(2&n){const t=Fe();Lr("background-color",t.hueSliderColor),Xe("rgX",1)("rgY",1),Je(1),Lr("top",null==t.slider?null:t.slider.v,"px")("left",null==t.slider?null:t.slider.s,"px")}}function b9(n,e){1&n&&(function Kx(){Zt.lFrame.currentNamespace="svg"}(),De(0,"svg",29),Ei(1,"path",30)(2,"path",31),Se())}function w9(n,e){if(1&n){const t=ir();De(0,"button",32),Vt("click",function(s){_t(t);const o=Fe();return o.onAddPresetColor(s,o.selectedColor)}),B(1),Se()}if(2&n){const t=Fe();ah(t.cpAddColorButtonClass),Xe("disabled",t.cpPresetColors&&t.cpPresetColors.length>=t.cpMaxPresetColorsLength),Je(1),H(" ",t.cpAddColorButtonText," ")}}function M9(n,e){1&n&&Ei(0,"div",33)}function E9(n,e){if(1&n){const t=ir();De(0,"input",39),Vt("keyup.enter",function(s){return _t(t),Fe(2).onAcceptColor(s)})("newValue",function(s){return _t(t),Fe(2).onAlphaInput(s)}),Se()}if(2&n){const t=Fe(2);Xe("rg",1)("value",null==t.cmykText?null:t.cmykText.a)}}function S9(n,e){1&n&&(De(0,"div"),B(1,"A"),Se())}function C9(n,e){if(1&n){const t=ir();De(0,"div",34)(1,"div",35)(2,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onCyanInput(s)}),Se(),De(3,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onMagentaInput(s)}),Se(),De(4,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onYellowInput(s)}),Se(),De(5,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onBlackInput(s)}),Se(),pn(6,E9,1,2,"input",37),Se(),De(7,"div",35)(8,"div"),B(9,"C"),Se(),De(10,"div"),B(11,"M"),Se(),De(12,"div"),B(13,"Y"),Se(),De(14,"div"),B(15,"K"),Se(),pn(16,S9,2,0,"div",38),Se()()}if(2&n){const t=Fe();Lr("display",3!==t.format?"none":"block"),Je(2),Xe("rg",100)("value",null==t.cmykText?null:t.cmykText.c),Je(1),Xe("rg",100)("value",null==t.cmykText?null:t.cmykText.m),Je(1),Xe("rg",100)("value",null==t.cmykText?null:t.cmykText.y),Je(1),Xe("rg",100)("value",null==t.cmykText?null:t.cmykText.k),Je(1),Xe("ngIf","disabled"!==t.cpAlphaChannel),Je(10),Xe("ngIf","disabled"!==t.cpAlphaChannel)}}function T9(n,e){if(1&n){const t=ir();De(0,"input",39),Vt("keyup.enter",function(s){return _t(t),Fe(2).onAcceptColor(s)})("newValue",function(s){return _t(t),Fe(2).onAlphaInput(s)}),Se()}if(2&n){const t=Fe(2);Xe("rg",1)("value",null==t.hslaText?null:t.hslaText.a)}}function A9(n,e){1&n&&(De(0,"div"),B(1,"A"),Se())}function D9(n,e){if(1&n){const t=ir();De(0,"div",40)(1,"div",35)(2,"input",41),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onHueInput(s)}),Se(),De(3,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onSaturationInput(s)}),Se(),De(4,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onLightnessInput(s)}),Se(),pn(5,T9,1,2,"input",37),Se(),De(6,"div",35)(7,"div"),B(8,"H"),Se(),De(9,"div"),B(10,"S"),Se(),De(11,"div"),B(12,"L"),Se(),pn(13,A9,2,0,"div",38),Se()()}if(2&n){const t=Fe();Lr("display",2!==t.format?"none":"block"),Je(2),Xe("rg",360)("value",null==t.hslaText?null:t.hslaText.h),Je(1),Xe("rg",100)("value",null==t.hslaText?null:t.hslaText.s),Je(1),Xe("rg",100)("value",null==t.hslaText?null:t.hslaText.l),Je(1),Xe("ngIf","disabled"!==t.cpAlphaChannel),Je(8),Xe("ngIf","disabled"!==t.cpAlphaChannel)}}function R9(n,e){if(1&n){const t=ir();De(0,"input",39),Vt("keyup.enter",function(s){return _t(t),Fe(2).onAcceptColor(s)})("newValue",function(s){return _t(t),Fe(2).onAlphaInput(s)}),Se()}if(2&n){const t=Fe(2);Xe("rg",1)("value",null==t.rgbaText?null:t.rgbaText.a)}}function P9(n,e){1&n&&(De(0,"div"),B(1,"A"),Se())}function I9(n,e){if(1&n){const t=ir();De(0,"div",42)(1,"div",35)(2,"input",43),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onRedInput(s)}),Se(),De(3,"input",43),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onGreenInput(s)}),Se(),De(4,"input",43),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onBlueInput(s)}),Se(),pn(5,R9,1,2,"input",37),Se(),De(6,"div",35)(7,"div"),B(8,"R"),Se(),De(9,"div"),B(10,"G"),Se(),De(11,"div"),B(12,"B"),Se(),pn(13,P9,2,0,"div",38),Se()()}if(2&n){const t=Fe();Lr("display",1!==t.format?"none":"block"),Je(2),Xe("rg",255)("value",null==t.rgbaText?null:t.rgbaText.r),Je(1),Xe("rg",255)("value",null==t.rgbaText?null:t.rgbaText.g),Je(1),Xe("rg",255)("value",null==t.rgbaText?null:t.rgbaText.b),Je(1),Xe("ngIf","disabled"!==t.cpAlphaChannel),Je(8),Xe("ngIf","disabled"!==t.cpAlphaChannel)}}function L9(n,e){if(1&n){const t=ir();De(0,"input",39),Vt("keyup.enter",function(s){return _t(t),Fe(2).onAcceptColor(s)})("newValue",function(s){return _t(t),Fe(2).onAlphaInput(s)}),Se()}if(2&n){const t=Fe(2);Xe("rg",1)("value",t.hexAlpha)}}function F9(n,e){1&n&&(De(0,"div"),B(1,"A"),Se())}function N9(n,e){if(1&n){const t=ir();De(0,"div",44)(1,"div",35)(2,"input",45),Vt("blur",function(){return _t(t),Fe().onHexInput(null)})("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onHexInput(s)}),Se(),pn(3,L9,1,2,"input",37),Se(),De(4,"div",35)(5,"div"),B(6,"Hex"),Se(),pn(7,F9,2,0,"div",38),Se()()}if(2&n){const t=Fe();Lr("display",0!==t.format?"none":"block"),Bd("hex-alpha","forced"===t.cpAlphaChannel),Je(2),Xe("value",t.hexText),Je(1),Xe("ngIf","forced"===t.cpAlphaChannel),Je(4),Xe("ngIf","forced"===t.cpAlphaChannel)}}function O9(n,e){if(1&n){const t=ir();De(0,"input",39),Vt("keyup.enter",function(s){return _t(t),Fe(2).onAcceptColor(s)})("newValue",function(s){return _t(t),Fe(2).onAlphaInput(s)}),Se()}if(2&n){const t=Fe(2);Xe("rg",1)("value",null==t.hslaText?null:t.hslaText.a)}}function B9(n,e){if(1&n){const t=ir();De(0,"div",46)(1,"div",35)(2,"input",36),Vt("keyup.enter",function(s){return _t(t),Fe().onAcceptColor(s)})("newValue",function(s){return _t(t),Fe().onValueInput(s)}),Se(),pn(3,O9,1,2,"input",37),Se(),De(4,"div",35)(5,"div"),B(6,"V"),Se(),De(7,"div"),B(8,"A"),Se()()()}if(2&n){const t=Fe();Je(2),Xe("rg",100)("value",null==t.hslaText?null:t.hslaText.l),Je(1),Xe("ngIf","disabled"!==t.cpAlphaChannel)}}function k9(n,e){if(1&n){const t=ir();De(0,"div",47)(1,"span",48),Vt("click",function(){return _t(t),Fe().onFormatToggle(-1)}),Se(),De(2,"span",48),Vt("click",function(){return _t(t),Fe().onFormatToggle(1)}),Se()()}}function V9(n,e){if(1&n){const t=ir();De(0,"span",55),Vt("click",function(s){_t(t);const o=Fe().$implicit;return Fe(3).onRemovePresetColor(s,o)}),Se()}2&n&&ah(Fe(4).cpRemoveColorButtonClass)}function U9(n,e){if(1&n){const t=ir();De(0,"div",53),Vt("click",function(){const o=_t(t).$implicit;return Fe(3).setColorFromString(o)}),pn(1,V9,1,3,"span",54),Se()}if(2&n){const t=e.$implicit,i=Fe(3);Lr("background-color",t),Je(1),Xe("ngIf",i.cpAddColorButton)}}function z9(n,e){if(1&n&&(De(0,"div"),pn(1,U9,2,3,"div",52),Se()),2&n){const t=Fe(2);ah(t.cpPresetColorsClass),Je(1),Xe("ngForOf",t.cpPresetColors)}}function H9(n,e){if(1&n&&(De(0,"div"),B(1),Se()),2&n){const t=Fe(2);ah(t.cpPresetEmptyMessageClass),Je(1),j(t.cpPresetEmptyMessage)}}function G9(n,e){if(1&n&&(De(0,"div",49),Ei(1,"hr"),De(2,"div",50),B(3),Se(),pn(4,z9,2,4,"div",51),pn(5,H9,2,4,"div",51),Se()),2&n){const t=Fe();Je(3),j(t.cpPresetLabel),Je(1),Xe("ngIf",null==t.cpPresetColors?null:t.cpPresetColors.length),Je(1),Xe("ngIf",!(null!=t.cpPresetColors&&t.cpPresetColors.length)&&t.cpAddColorButton)}}function W9(n,e){if(1&n){const t=ir();De(0,"button",58),Vt("click",function(s){return _t(t),Fe(2).onCancelColor(s)}),B(1),Se()}if(2&n){const t=Fe(2);ah(t.cpCancelButtonClass),Je(1),j(t.cpCancelButtonText)}}function q9(n,e){if(1&n){const t=ir();De(0,"button",58),Vt("click",function(s){return _t(t),Fe(2).onAcceptColor(s)}),B(1),Se()}if(2&n){const t=Fe(2);ah(t.cpOKButtonClass),Je(1),j(t.cpOKButtonText)}}function j9(n,e){if(1&n&&(De(0,"div",56),pn(1,W9,2,4,"button",57),pn(2,q9,2,4,"button",57),Se()),2&n){const t=Fe();Je(1),Xe("ngIf",t.cpCancelButton),Je(1),Xe("ngIf",t.cpOKButton)}}function X9(n,e){1&n&&qg(0)}function Y9(n,e){if(1&n&&(De(0,"div",59),pn(1,X9,1,0,"ng-container",60),Se()),2&n){const t=Fe();Je(1),Xe("ngTemplateOutlet",t.cpExtraTemplate)}}var Lo=(()=>{return(n=Lo||(Lo={}))[n.HEX=0]="HEX",n[n.RGBA=1]="RGBA",n[n.HSLA=2]="HSLA",n[n.CMYK=3]="CMYK",Lo;var n})();class Ah{constructor(e,t,i,s){this.r=e,this.g=t,this.b=i,this.a=s}}class kS{constructor(e,t,i,s){this.h=e,this.s=t,this.v=i,this.a=s}}class vm{constructor(e,t,i,s){this.h=e,this.s=t,this.l=i,this.a=s}}class gx{constructor(e,t,i,s,o=1){this.c=e,this.m=t,this.y=i,this.k=s,this.a=o}}let Z9=(()=>{class n{constructor(){this.newValue=new Ui}inputChange(t){const i=t.target.value;if(void 0===this.rg)this.newValue.emit(i);else{const s=parseFloat(i);this.newValue.emit({v:s,rg:this.rg})}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=Pn({type:n,selectors:[["","text",""]],hostBindings:function(t,i){1&t&&Vt("input",function(o){return i.inputChange(o)})},inputs:{rg:"rg",text:"text"},outputs:{newValue:"newValue"}}),n})(),J9=(()=>{class n{constructor(t){this.elRef=t,this.dragEnd=new Ui,this.dragStart=new Ui,this.newValue=new Ui,this.listenerMove=i=>this.move(i),this.listenerStop=()=>this.stop()}mouseDown(t){this.start(t)}touchStart(t){this.start(t)}move(t){t.preventDefault(),this.setCursor(t)}start(t){this.setCursor(t),t.stopPropagation(),document.addEventListener("mouseup",this.listenerStop),document.addEventListener("touchend",this.listenerStop),document.addEventListener("mousemove",this.listenerMove),document.addEventListener("touchmove",this.listenerMove),this.dragStart.emit()}stop(){document.removeEventListener("mouseup",this.listenerStop),document.removeEventListener("touchend",this.listenerStop),document.removeEventListener("mousemove",this.listenerMove),document.removeEventListener("touchmove",this.listenerMove),this.dragEnd.emit()}getX(t){const i=this.elRef.nativeElement.getBoundingClientRect();return(void 0!==t.pageX?t.pageX:t.touches[0].pageX)-i.left-window.pageXOffset}getY(t){const i=this.elRef.nativeElement.getBoundingClientRect();return(void 0!==t.pageY?t.pageY:t.touches[0].pageY)-i.top-window.pageYOffset}setCursor(t){const i=this.elRef.nativeElement.offsetWidth,s=this.elRef.nativeElement.offsetHeight,o=Math.max(0,Math.min(this.getX(t),i)),l=Math.max(0,Math.min(this.getY(t),s));void 0!==this.rgX&&void 0!==this.rgY?this.newValue.emit({s:o/i,v:1-l/s,rgX:this.rgX,rgY:this.rgY}):void 0===this.rgX&&void 0!==this.rgY?this.newValue.emit({v:l/s,rgY:this.rgY}):void 0!==this.rgX&&void 0===this.rgY&&this.newValue.emit({v:o/i,rgX:this.rgX})}}return n.\u0275fac=function(t){return new(t||n)(He(Ra))},n.\u0275dir=Pn({type:n,selectors:[["","slider",""]],hostBindings:function(t,i){1&t&&Vt("mousedown",function(o){return i.mouseDown(o)})("touchstart",function(o){return i.touchStart(o)})},inputs:{rgX:"rgX",rgY:"rgY",slider:"slider"},outputs:{dragEnd:"dragEnd",dragStart:"dragStart",newValue:"newValue"}}),n})();class EO{constructor(e,t,i,s){this.h=e,this.s=t,this.v=i,this.a=s}}class SO{constructor(e,t,i,s){this.h=e,this.s=t,this.v=i,this.a=s}}let FR=(()=>{class n{constructor(){this.active=null}setActive(t){this.active&&this.active!==t&&"inline"!==this.active.cpDialogDisplay&&this.active.closeDialog(),this.active=t}hsva2hsla(t){const i=t.h,s=t.s,o=t.v,l=t.a;if(0===o)return new vm(i,0,0,l);if(0===s&&1===o)return new vm(i,1,1,l);{const u=o*(2-s)/2;return new vm(i,o*s/(1-Math.abs(2*u-1)),u,l)}}hsla2hsva(t){const i=Math.min(t.h,1),s=Math.min(t.s,1),o=Math.min(t.l,1),l=Math.min(t.a,1);if(0===o)return new kS(i,0,0,l);{const u=o+s*(1-Math.abs(2*o-1))/2;return new kS(i,2*(u-o)/u,u,l)}}hsvaToRgba(t){let i,s,o;const l=t.h,u=t.s,f=t.v,m=t.a,y=Math.floor(6*l),v=6*l-y,x=f*(1-u),b=f*(1-v*u),E=f*(1-(1-v)*u);switch(y%6){case 0:i=f,s=E,o=x;break;case 1:i=b,s=f,o=x;break;case 2:i=x,s=f,o=E;break;case 3:i=x,s=b,o=f;break;case 4:i=E,s=x,o=f;break;case 5:i=f,s=x,o=b;break;default:i=0,s=0,o=0}return new Ah(i,s,o,m)}cmykToRgb(t){return new Ah((1-t.c)*(1-t.k),(1-t.m)*(1-t.k),(1-t.y)*(1-t.k),t.a)}rgbaToCmyk(t){const i=1-Math.max(t.r,t.g,t.b);return 1===i?new gx(0,0,0,1,t.a):new gx((1-t.r-i)/(1-i),(1-t.g-i)/(1-i),(1-t.b-i)/(1-i),i,t.a)}rgbaToHsva(t){let i,s;const o=Math.min(t.r,1),l=Math.min(t.g,1),u=Math.min(t.b,1),f=Math.min(t.a,1),m=Math.max(o,l,u),y=Math.min(o,l,u),v=m,x=m-y;if(s=0===m?0:x/m,m===y)i=0;else{switch(m){case o:i=(l-u)/x+(l<u?6:0);break;case l:i=(u-o)/x+2;break;case u:i=(o-l)/x+4;break;default:i=0}i/=6}return new kS(i,s,v,f)}rgbaToHex(t,i){let s="#"+(16777216|t.r<<16|t.g<<8|t.b).toString(16).substr(1);return i&&(s+=(256|Math.round(255*t.a)).toString(16).substr(1)),s}normalizeCMYK(t){return new gx(t.c/100,t.m/100,t.y/100,t.k/100,t.a)}denormalizeCMYK(t){return new gx(Math.floor(100*t.c),Math.floor(100*t.m),Math.floor(100*t.y),Math.floor(100*t.k),t.a)}denormalizeRGBA(t){return new Ah(Math.round(255*t.r),Math.round(255*t.g),Math.round(255*t.b),t.a)}stringToHsva(t="",i=!1){let s=null;t=(t||"").toLowerCase();const o=[{re:/(rgb)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*%?,\s*(\d{1,3})\s*%?(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(l){return new Ah(parseInt(l[2],10)/255,parseInt(l[3],10)/255,parseInt(l[4],10)/255,isNaN(parseFloat(l[5]))?1:parseFloat(l[5]))}},{re:/(hsl)a?\(\s*(\d{1,3})\s*,\s*(\d{1,3})%\s*,\s*(\d{1,3})%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(l){return new vm(parseInt(l[2],10)/360,parseInt(l[3],10)/100,parseInt(l[4],10)/100,isNaN(parseFloat(l[5]))?1:parseFloat(l[5]))}}];o.push(i?{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})?$/,parse:function(l){return new Ah(parseInt(l[1],16)/255,parseInt(l[2],16)/255,parseInt(l[3],16)/255,parseInt(l[4]||"FF",16)/255)}}:{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/,parse:function(l){return new Ah(parseInt(l[1],16)/255,parseInt(l[2],16)/255,parseInt(l[3],16)/255,1)}}),o.push({re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/,parse:function(l){return new Ah(parseInt(l[1]+l[1],16)/255,parseInt(l[2]+l[2],16)/255,parseInt(l[3]+l[3],16)/255,1)}});for(const l in o)if(o.hasOwnProperty(l)){const u=o[l],f=u.re.exec(t),m=f&&u.parse(f);if(m)return m instanceof Ah?s=this.rgbaToHsva(m):m instanceof vm&&(s=this.hsla2hsva(m)),s}return s}outputFormat(t,i,s){switch("auto"===i&&(i=t.a<1?"rgba":"hex"),i){case"hsla":const o=this.hsva2hsla(t),l=new vm(Math.round(360*o.h),Math.round(100*o.s),Math.round(100*o.l),Math.round(100*o.a)/100);return t.a<1||"always"===s?"hsla("+l.h+","+l.s+"%,"+l.l+"%,"+l.a+")":"hsl("+l.h+","+l.s+"%,"+l.l+"%)";case"rgba":const u=this.denormalizeRGBA(this.hsvaToRgba(t));return t.a<1||"always"===s?"rgba("+u.r+","+u.g+","+u.b+","+Math.round(100*u.a)/100+")":"rgb("+u.r+","+u.g+","+u.b+")";default:const f="always"===s||"forced"===s;return this.rgbaToHex(this.denormalizeRGBA(this.hsvaToRgba(t)),f)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Zn({token:n,factory:n.\u0275fac}),n})();const CO="undefined"!=typeof window&&"ontouchstart"in window;let Q9=(()=>{class n{constructor(t,i,s,o,l,u){this.ngZone=t,this.elRef=i,this.cdRef=s,this.document=o,this.platformId=l,this.service=u,this.isIE10=!1,this.dialogArrowSize=10,this.dialogArrowOffset=15,this.dialogInputFields=[Lo.HEX,Lo.RGBA,Lo.HSLA,Lo.CMYK],this.useRootViewContainer=!1,this.eyeDropperSupported=YL(this.platformId)&&"EyeDropper"in this.document.defaultView}handleEsc(t){this.show&&"popup"===this.cpDialogDisplay&&this.onCancelColor(t)}handleEnter(t){this.show&&"popup"===this.cpDialogDisplay&&this.onAcceptColor(t)}ngOnInit(){this.slider=new EO(0,0,0,0),this.sliderDimMax=new SO(this.hueSlider.nativeElement.offsetWidth||140,this.cpWidth,130,this.alphaSlider.nativeElement.offsetWidth||140),this.format=this.cpCmykEnabled?Lo.CMYK:"rgba"===this.cpOutputFormat?Lo.RGBA:"hsla"===this.cpOutputFormat?Lo.HSLA:Lo.HEX,this.listenerMouseDown=s=>{this.onMouseDown(s)},this.listenerResize=()=>{this.onResize()},this.openDialog(this.initialColor,!1)}ngOnDestroy(){this.closeDialog()}ngAfterViewInit(){230===this.cpWidth&&"inline"!==this.cpDialogDisplay||(this.sliderDimMax=new SO(this.hueSlider.nativeElement.offsetWidth||140,this.cpWidth,130,this.alphaSlider.nativeElement.offsetWidth||140),this.updateColorPicker(!1),this.cdRef.detectChanges())}openDialog(t,i=!0){this.service.setActive(this),this.width||(this.cpWidth=this.directiveElementRef.nativeElement.offsetWidth),this.height||(this.height=320),this.setInitialColor(t),this.setColorFromString(t,i),this.openColorPicker()}closeDialog(){this.closeColorPicker()}setupDialog(t,i,s,o,l,u,f,m,y,v,x,b,E,C,A,N,F,V,k,G,ee,oe,ue,Pe,ye,q,le,Ze,_e,Le,Te,We,be,ot,ht,bt,mt,_n){this.setInitialColor(s),this.setColorMode(m),this.isIE10=10===function $9(){let n="";"undefined"!=typeof navigator&&(n=navigator.userAgent.toLowerCase());const e=n.indexOf("msie ");return e>0&&parseInt(n.substring(e+5,n.indexOf(".",e)),10)}(),this.directiveInstance=t,this.directiveElementRef=i,this.cpDisableInput=b,this.cpCmykEnabled=y,this.cpAlphaChannel=v,this.cpOutputFormat=x,this.cpDialogDisplay=u,this.cpIgnoredElements=E,this.cpSaveClickOutside=C,this.cpCloseClickOutside=A,this.useRootViewContainer=N,this.width=this.cpWidth=parseInt(o,10),this.height=this.cpHeight=parseInt(l,10),this.cpPosition=F,this.cpPositionOffset=parseInt(V,10),this.cpOKButton=q,this.cpOKButtonText=Ze,this.cpOKButtonClass=le,this.cpCancelButton=_e,this.cpCancelButtonText=Te,this.cpCancelButtonClass=Le,this.cpEyeDropper=bt,this.fallbackColor=f||"#fff",this.setPresetConfig(G,ee),this.cpPresetColorsClass=oe,this.cpMaxPresetColorsLength=ue,this.cpPresetEmptyMessage=Pe,this.cpPresetEmptyMessageClass=ye,this.cpAddColorButton=We,this.cpAddColorButtonText=ot,this.cpAddColorButtonClass=be,this.cpRemoveColorButtonClass=ht,this.cpTriggerElement=mt,this.cpExtraTemplate=_n,k||(this.dialogArrowOffset=0),"inline"===u&&(this.dialogArrowSize=0,this.dialogArrowOffset=0),"hex"===x&&"always"!==v&&"forced"!==v&&(this.cpAlphaChannel="disabled")}setColorMode(t){switch(t.toString().toUpperCase()){case"1":case"C":case"COLOR":default:this.cpColorMode=1;break;case"2":case"G":case"GRAYSCALE":this.cpColorMode=2;break;case"3":case"P":case"PRESETS":this.cpColorMode=3}}setInitialColor(t){this.initialColor=t}setPresetConfig(t,i){this.cpPresetLabel=t,this.cpPresetColors=i}setColorFromString(t,i=!0,s=!0){let o;"always"===this.cpAlphaChannel||"forced"===this.cpAlphaChannel?(o=this.service.stringToHsva(t,!0),!o&&!this.hsva&&(o=this.service.stringToHsva(t,!1))):o=this.service.stringToHsva(t,!1),!o&&!this.hsva&&(o=this.service.stringToHsva(this.fallbackColor,!1)),o&&(this.hsva=o,this.sliderH=this.hsva.h,"hex"===this.cpOutputFormat&&"disabled"===this.cpAlphaChannel&&(this.hsva.a=1),this.updateColorPicker(i,s))}onResize(){"fixed"===this.position?this.setDialogPosition():"inline"!==this.cpDialogDisplay&&this.closeColorPicker()}onDragEnd(t){this.directiveInstance.sliderDragEnd({slider:t,color:this.outputColor})}onDragStart(t){this.directiveInstance.sliderDragStart({slider:t,color:this.outputColor})}onMouseDown(t){this.show&&!this.isIE10&&"popup"===this.cpDialogDisplay&&t.target!==this.directiveElementRef.nativeElement&&!this.isDescendant(this.elRef.nativeElement,t.target)&&!this.isDescendant(this.directiveElementRef.nativeElement,t.target)&&0===this.cpIgnoredElements.filter(i=>i===t.target).length&&this.ngZone.run(()=>{this.cpSaveClickOutside?this.directiveInstance.colorSelected(this.outputColor):(this.hsva=null,this.setColorFromString(this.initialColor,!1),this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.initialColor),this.directiveInstance.colorCanceled()),this.cpCloseClickOutside&&this.closeColorPicker()})}onAcceptColor(t){t.stopPropagation(),this.outputColor&&this.directiveInstance.colorSelected(this.outputColor),"popup"===this.cpDialogDisplay&&this.closeColorPicker()}onCancelColor(t){this.hsva=null,t.stopPropagation(),this.directiveInstance.colorCanceled(),this.setColorFromString(this.initialColor,!0),"popup"===this.cpDialogDisplay&&(this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.initialColor,!0),this.closeColorPicker())}onEyeDropper(){this.eyeDropperSupported&&(new window.EyeDropper).open().then(i=>{this.setColorFromString(i.sRGBHex,!0)})}onFormatToggle(t){const i=this.dialogInputFields.length-(this.cpCmykEnabled?0:1),s=((this.dialogInputFields.indexOf(this.format)+t)%i+i)%i;this.format=this.dialogInputFields[s]}onColorChange(t){this.hsva.s=t.s/t.rgX,this.hsva.v=t.v/t.rgY,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"lightness",value:this.hsva.v,color:this.outputColor}),this.directiveInstance.sliderChanged({slider:"saturation",value:this.hsva.s,color:this.outputColor})}onHueChange(t){this.hsva.h=t.v/t.rgX,this.sliderH=this.hsva.h,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"hue",value:this.hsva.h,color:this.outputColor})}onValueChange(t){this.hsva.v=t.v/t.rgX,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"value",value:this.hsva.v,color:this.outputColor})}onAlphaChange(t){this.hsva.a=t.v/t.rgX,this.updateColorPicker(),this.directiveInstance.sliderChanged({slider:"alpha",value:this.hsva.a,color:this.outputColor})}onHexInput(t){if(null===t)this.updateColorPicker();else{t&&"#"!==t[0]&&(t="#"+t);let i=/^#([a-f0-9]{3}|[a-f0-9]{6})$/gi;"always"===this.cpAlphaChannel&&(i=/^#([a-f0-9]{3}|[a-f0-9]{6}|[a-f0-9]{8})$/gi);const s=i.test(t);s&&(t.length<5&&(t="#"+t.substring(1).split("").map(o=>o+o).join("")),"forced"===this.cpAlphaChannel&&(t+=Math.round(255*this.hsva.a).toString(16)),this.setColorFromString(t,!0,!1)),this.directiveInstance.inputChanged({input:"hex",valid:s,value:t,color:this.outputColor})}}onRedInput(t){const i=this.service.hsvaToRgba(this.hsva),s=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;s&&(i.r=t.v/t.rg,this.hsva=this.service.rgbaToHsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"red",valid:s,value:i.r,color:this.outputColor})}onBlueInput(t){const i=this.service.hsvaToRgba(this.hsva),s=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;s&&(i.b=t.v/t.rg,this.hsva=this.service.rgbaToHsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"blue",valid:s,value:i.b,color:this.outputColor})}onGreenInput(t){const i=this.service.hsvaToRgba(this.hsva),s=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;s&&(i.g=t.v/t.rg,this.hsva=this.service.rgbaToHsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"green",valid:s,value:i.g,color:this.outputColor})}onHueInput(t){const i=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;i&&(this.hsva.h=t.v/t.rg,this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"hue",valid:i,value:this.hsva.h,color:this.outputColor})}onValueInput(t){const i=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;i&&(this.hsva.v=t.v/t.rg,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"value",valid:i,value:this.hsva.v,color:this.outputColor})}onAlphaInput(t){const i=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;i&&(this.hsva.a=t.v/t.rg,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"alpha",valid:i,value:this.hsva.a,color:this.outputColor})}onLightnessInput(t){const i=this.service.hsva2hsla(this.hsva),s=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;s&&(i.l=t.v/t.rg,this.hsva=this.service.hsla2hsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"lightness",valid:s,value:i.l,color:this.outputColor})}onSaturationInput(t){const i=this.service.hsva2hsla(this.hsva),s=!isNaN(t.v)&&t.v>=0&&t.v<=t.rg;s&&(i.s=t.v/t.rg,this.hsva=this.service.hsla2hsva(i),this.sliderH=this.hsva.h,this.updateColorPicker()),this.directiveInstance.inputChanged({input:"saturation",valid:s,value:i.s,color:this.outputColor})}onCyanInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.c=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"cyan",valid:!0,value:this.cmyk.c,color:this.outputColor})}onMagentaInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.m=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"magenta",valid:!0,value:this.cmyk.m,color:this.outputColor})}onYellowInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.y=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"yellow",valid:!0,value:this.cmyk.y,color:this.outputColor})}onBlackInput(t){!isNaN(t.v)&&t.v>=0&&t.v<=t.rg&&(this.cmyk.k=t.v,this.updateColorPicker(!1,!0,!0)),this.directiveInstance.inputChanged({input:"black",valid:!0,value:this.cmyk.k,color:this.outputColor})}onAddPresetColor(t,i){t.stopPropagation(),this.cpPresetColors.filter(s=>s===i).length||(this.cpPresetColors=this.cpPresetColors.concat(i),this.directiveInstance.presetColorsChanged(this.cpPresetColors))}onRemovePresetColor(t,i){t.stopPropagation(),this.cpPresetColors=this.cpPresetColors.filter(s=>s!==i),this.directiveInstance.presetColorsChanged(this.cpPresetColors)}openColorPicker(){this.show||(this.show=!0,this.hidden=!0,setTimeout(()=>{this.hidden=!1,this.setDialogPosition(),this.cdRef.detectChanges()},0),this.directiveInstance.stateChanged(!0),this.isIE10||this.ngZone.runOutsideAngular(()=>{CO?document.addEventListener("touchstart",this.listenerMouseDown):document.addEventListener("mousedown",this.listenerMouseDown)}),window.addEventListener("resize",this.listenerResize))}closeColorPicker(){this.show&&(this.show=!1,this.directiveInstance.stateChanged(!1),this.isIE10||(CO?document.removeEventListener("touchstart",this.listenerMouseDown):document.removeEventListener("mousedown",this.listenerMouseDown)),window.removeEventListener("resize",this.listenerResize),this.cdRef.destroyed||this.cdRef.detectChanges())}updateColorPicker(t=!0,i=!0,s=!1){if(this.sliderDimMax){let o,l,u;2===this.cpColorMode&&(this.hsva.s=0);const f=this.outputColor;if(l=this.service.hsva2hsla(this.hsva),this.cpCmykEnabled?(s?(u=this.service.cmykToRgb(this.service.normalizeCMYK(this.cmyk)),this.hsva=this.service.rgbaToHsva(u)):(u=this.service.hsvaToRgba(this.hsva),this.cmyk=this.service.denormalizeCMYK(this.service.rgbaToCmyk(u))),u=this.service.denormalizeRGBA(u),this.sliderH=this.hsva.h):u=this.service.denormalizeRGBA(this.service.hsvaToRgba(this.hsva)),o=this.service.denormalizeRGBA(this.service.hsvaToRgba(new kS(this.sliderH||this.hsva.h,1,1,1))),i&&(this.hslaText=new vm(Math.round(360*l.h),Math.round(100*l.s),Math.round(100*l.l),Math.round(100*l.a)/100),this.rgbaText=new Ah(u.r,u.g,u.b,Math.round(100*u.a)/100),this.cpCmykEnabled&&(this.cmykText=new gx(this.cmyk.c,this.cmyk.m,this.cmyk.y,this.cmyk.k,Math.round(100*this.cmyk.a)/100)),this.hexText=this.service.rgbaToHex(u,"always"===this.cpAlphaChannel),this.hexAlpha=this.rgbaText.a),"auto"===this.cpOutputFormat&&this.format!==Lo.RGBA&&this.format!==Lo.CMYK&&this.format!==Lo.HSLA&&this.hsva.a<1&&(this.format=this.hsva.a<1?Lo.RGBA:Lo.HEX),this.hueSliderColor="rgb("+o.r+","+o.g+","+o.b+")",this.alphaSliderColor="rgb("+u.r+","+u.g+","+u.b+")",this.outputColor=this.service.outputFormat(this.hsva,this.cpOutputFormat,this.cpAlphaChannel),this.selectedColor=this.service.outputFormat(this.hsva,"rgba",null),this.format!==Lo.CMYK)this.cmykColor="";else if("always"===this.cpAlphaChannel||"enabled"===this.cpAlphaChannel||"forced"===this.cpAlphaChannel){const m=Math.round(100*this.cmyk.a)/100;this.cmykColor=`cmyka(${this.cmyk.c},${this.cmyk.m},${this.cmyk.y},${this.cmyk.k},${m})`}else this.cmykColor=`cmyk(${this.cmyk.c},${this.cmyk.m},${this.cmyk.y},${this.cmyk.k})`;this.slider=new EO((this.sliderH||this.hsva.h)*this.sliderDimMax.h-8,this.hsva.s*this.sliderDimMax.s-8,(1-this.hsva.v)*this.sliderDimMax.v-8,this.hsva.a*this.sliderDimMax.a-8),t&&f!==this.outputColor&&(this.cpCmykEnabled&&this.directiveInstance.cmykChanged(this.cmykColor),this.directiveInstance.colorChanged(this.outputColor))}}setDialogPosition(){if("inline"===this.cpDialogDisplay)this.position="relative";else{let s,t="static",i="",o=null,l=null,u=this.directiveElementRef.nativeElement.parentNode;const f=this.dialogElement.nativeElement.offsetHeight;for(;null!==u&&"HTML"!==u.tagName;){if(s=window.getComputedStyle(u),t=s.getPropertyValue("position"),i=s.getPropertyValue("transform"),"static"!==t&&null===o&&(o=u),i&&"none"!==i&&null===l&&(l=u),"fixed"===t){o=l;break}u=u.parentNode}const m=this.createDialogBox(this.directiveElementRef.nativeElement,"fixed"!==t);if(this.useRootViewContainer||"fixed"===t&&(!o||o instanceof HTMLUnknownElement))this.top=m.top,this.left=m.left;else{null===o&&(o=u);const v=this.createDialogBox(o,"fixed"!==t);this.top=m.top-v.top,this.left=m.left-v.left}"fixed"===t&&(this.position="fixed");let y=this.cpPosition;"auto"===this.cpPosition&&(y=function K9(n,e){let t="right",i="bottom";const{height:s,width:o}=n,{top:l,left:u}=e,f=l+e.height,m=u+e.width,y=l-s<0,v=f+s>(window.innerHeight||document.documentElement.clientHeight),x=u-o<0,b=m+o>(window.innerWidth||document.documentElement.clientWidth);return v&&(i="top"),y&&(i="bottom"),x&&(t="right"),b&&(t="left"),y&&v&&x&&b?["left","right","top","bottom"].reduce((A,N)=>n[A]>n[N]?A:N):x&&b?y?"bottom":v||l>f?"top":"bottom":y&&v?x?"right":b||u>m?"left":"right":`${i}-${t}`}(this.dialogElement.nativeElement.getBoundingClientRect(),this.cpTriggerElement.nativeElement.getBoundingClientRect())),"top"===y?(this.arrowTop=f-1,this.top-=f+this.dialogArrowSize,this.left+=this.cpPositionOffset/100*m.width-this.dialogArrowOffset):"bottom"===y?(this.top+=m.height+this.dialogArrowSize,this.left+=this.cpPositionOffset/100*m.width-this.dialogArrowOffset):"top-left"===y||"left-top"===y?(this.top-=f-m.height+m.height*this.cpPositionOffset/100,this.left-=this.cpWidth+this.dialogArrowSize-2-this.dialogArrowOffset):"top-right"===y||"right-top"===y?(this.top-=f-m.height+m.height*this.cpPositionOffset/100,this.left+=m.width+this.dialogArrowSize-2-this.dialogArrowOffset):"left"===y||"bottom-left"===y||"left-bottom"===y?(this.top+=m.height*this.cpPositionOffset/100-this.dialogArrowOffset,this.left-=this.cpWidth+this.dialogArrowSize-2):(this.top+=m.height*this.cpPositionOffset/100-this.dialogArrowOffset,this.left+=m.width+this.dialogArrowSize-2),this.cpUsePosition=y}}isDescendant(t,i){let s=i.parentNode;for(;null!==s;){if(s===t)return!0;s=s.parentNode}return!1}createDialogBox(t,i){const{top:s,left:o}=t.getBoundingClientRect();return{top:s+(i?window.pageYOffset:0),left:o+(i?window.pageXOffset:0),width:t.offsetWidth,height:t.offsetHeight}}}return n.\u0275fac=function(t){return new(t||n)(He(Vo),He(Ra),He(oA),He(Pa),He(w0),He(FR))},n.\u0275cmp=Ts({type:n,selectors:[["color-picker"]],viewQuery:function(t,i){if(1&t&&(_0(g9,7),_0(y9,7),_0(_9,7)),2&t){let s;y0(s=v0())&&(i.dialogElement=s.first),y0(s=v0())&&(i.hueSlider=s.first),y0(s=v0())&&(i.alphaSlider=s.first)}},hostBindings:function(t,i){1&t&&Vt("keyup.esc",function(o){return i.handleEsc(o)},!1,sv)("keyup.enter",function(o){return i.handleEnter(o)},!1,sv)},decls:30,vars:51,consts:[[1,"color-picker",3,"click"],["dialogPopup",""],[3,"class","top",4,"ngIf"],["class","saturation-lightness",3,"slider","rgX","rgY","background-color","newValue","dragStart","dragEnd",4,"ngIf"],[1,"hue-alpha","box"],[1,"left"],[1,"selected-color-background"],[1,"selected-color",3,"click"],["class","eyedropper-icon","xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#000000",4,"ngIf"],["type","button",3,"class","disabled","click",4,"ngIf"],[1,"right"],["style","height: 16px;",4,"ngIf"],[1,"hue",3,"slider","rgX","newValue","dragStart","dragEnd"],["hueSlider",""],[1,"cursor"],[1,"value",3,"slider","rgX","newValue","dragStart","dragEnd"],["valueSlider",""],[1,"alpha",3,"slider","rgX","newValue","dragStart","dragEnd"],["alphaSlider",""],["class","cmyk-text",3,"display",4,"ngIf"],["class","hsla-text",3,"display",4,"ngIf"],["class","rgba-text",3,"display",4,"ngIf"],["class","hex-text",3,"hex-alpha","display",4,"ngIf"],["class","value-text",4,"ngIf"],["class","type-policy",4,"ngIf"],["class","preset-area",4,"ngIf"],["class","button-area",4,"ngIf"],["class","extra-template",4,"ngIf"],[1,"saturation-lightness",3,"slider","rgX","rgY","newValue","dragStart","dragEnd"],["xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 0 24 24","width","24px","fill","#000000",1,"eyedropper-icon"],["d","M0 0h24v24H0V0z","fill","none"],["d","M17.66 5.41l.92.92-2.69 2.69-.92-.92 2.69-2.69M17.67 3c-.26 0-.51.1-.71.29l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42l-2.34-2.34c-.2-.19-.45-.29-.7-.29zM6.92 19L5 17.08l8.06-8.06 1.92 1.92L6.92 19z"],["type","button",3,"disabled","click"],[2,"height","16px"],[1,"cmyk-text"],[1,"box"],["type","number","pattern","[0-9]*","min","0","max","100",3,"text","rg","value","keyup.enter","newValue"],["type","number","pattern","[0-9]+([\\.,][0-9]{1,2})?","min","0","max","1","step","0.1",3,"text","rg","value","keyup.enter","newValue",4,"ngIf"],[4,"ngIf"],["type","number","pattern","[0-9]+([\\.,][0-9]{1,2})?","min","0","max","1","step","0.1",3,"text","rg","value","keyup.enter","newValue"],[1,"hsla-text"],["type","number","pattern","[0-9]*","min","0","max","360",3,"text","rg","value","keyup.enter","newValue"],[1,"rgba-text"],["type","number","pattern","[0-9]*","min","0","max","255",3,"text","rg","value","keyup.enter","newValue"],[1,"hex-text"],[3,"text","value","blur","keyup.enter","newValue"],[1,"value-text"],[1,"type-policy"],[1,"type-policy-arrow",3,"click"],[1,"preset-area"],[1,"preset-label"],[3,"class",4,"ngIf"],["class","preset-color",3,"backgroundColor","click",4,"ngFor","ngForOf"],[1,"preset-color",3,"click"],[3,"class","click",4,"ngIf"],[3,"click"],[1,"button-area"],["type","button",3,"class","click",4,"ngIf"],["type","button",3,"click"],[1,"extra-template"],[4,"ngTemplateOutlet"]],template:function(t,i){1&t&&(De(0,"div",0,1),Vt("click",function(o){return o.stopPropagation()}),pn(2,v9,1,5,"div",2),pn(3,x9,2,8,"div",3),De(4,"div",4)(5,"div",5),Ei(6,"div",6),De(7,"div",7),Vt("click",function(){return i.eyeDropperSupported&&i.cpEyeDropper&&i.onEyeDropper()}),pn(8,b9,3,0,"svg",8),Se(),pn(9,w9,2,5,"button",9),Se(),De(10,"div",10),pn(11,M9,1,0,"div",11),De(12,"div",12,13),Vt("newValue",function(o){return i.onHueChange(o)})("dragStart",function(){return i.onDragStart("hue")})("dragEnd",function(){return i.onDragEnd("hue")}),Ei(14,"div",14),Se(),De(15,"div",15,16),Vt("newValue",function(o){return i.onValueChange(o)})("dragStart",function(){return i.onDragStart("value")})("dragEnd",function(){return i.onDragEnd("value")}),Ei(17,"div",14),Se(),De(18,"div",17,18),Vt("newValue",function(o){return i.onAlphaChange(o)})("dragStart",function(){return i.onDragStart("alpha")})("dragEnd",function(){return i.onDragEnd("alpha")}),Ei(20,"div",14),Se()()(),pn(21,C9,17,12,"div",19),pn(22,D9,14,10,"div",20),pn(23,I9,14,10,"div",21),pn(24,N9,8,7,"div",22),pn(25,B9,9,3,"div",23),pn(26,k9,3,0,"div",24),pn(27,G9,6,3,"div",25),pn(28,j9,3,2,"div",26),pn(29,Y9,2,1,"div",27),Se()),2&t&&(Lr("display",i.show?"block":"none")("visibility",i.hidden?"hidden":"visible")("top",i.top,"px")("left",i.left,"px")("position",i.position)("height",i.cpHeight,"px")("width",i.cpWidth,"px"),Bd("open",i.show),Je(2),Xe("ngIf","popup"===i.cpDialogDisplay),Je(1),Xe("ngIf",1===(i.cpColorMode||1)),Je(4),Lr("background-color",i.selectedColor)("cursor",i.eyeDropperSupported&&i.cpEyeDropper?"pointer":null),Je(1),Xe("ngIf",i.eyeDropperSupported&&i.cpEyeDropper),Je(1),Xe("ngIf",i.cpAddColorButton),Je(2),Xe("ngIf","disabled"===i.cpAlphaChannel),Je(1),Lr("display",1===(i.cpColorMode||1)?"block":"none"),Xe("rgX",1),Je(2),Lr("left",null==i.slider?null:i.slider.h,"px"),Je(1),Lr("display",2===(i.cpColorMode||1)?"block":"none"),Xe("rgX",1),Je(2),Lr("right",null==i.slider?null:i.slider.v,"px"),Je(1),Lr("display","disabled"===i.cpAlphaChannel?"none":"block")("background-color",i.alphaSliderColor),Xe("rgX",1),Je(2),Lr("left",null==i.slider?null:i.slider.a,"px"),Je(1),Xe("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),Je(1),Xe("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),Je(1),Xe("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),Je(1),Xe("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),Je(1),Xe("ngIf",!i.cpDisableInput&&2===(i.cpColorMode||1)),Je(1),Xe("ngIf",!i.cpDisableInput&&1===(i.cpColorMode||1)),Je(1),Xe("ngIf",(null==i.cpPresetColors?null:i.cpPresetColors.length)||i.cpAddColorButton),Je(1),Xe("ngIf",i.cpOKButton||i.cpCancelButton),Je(1),Xe("ngIf",i.cpExtraTemplate))},directives:[Yc,J9,Z9,C0,GL],styles:['.color-picker{position:absolute;z-index:1000;width:230px;height:auto;border:#777 solid 1px;cursor:default;-webkit-user-select:none;user-select:none;background-color:#fff}.color-picker *{box-sizing:border-box;margin:0;font-size:11px}.color-picker input{width:0;height:26px;min-width:0;font-size:13px;text-align:center;color:#000}.color-picker input:invalid,.color-picker input:-moz-ui-invalid,.color-picker input:-moz-submit-invalid{box-shadow:none}.color-picker input::-webkit-inner-spin-button,.color-picker input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none}.color-picker .arrow{position:absolute;z-index:999999;width:0;height:0;border-style:solid}.color-picker .arrow.arrow-top{left:8px;border-width:10px 5px;border-color:#777 rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .arrow.arrow-bottom{top:-20px;left:8px;border-width:10px 5px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) #777 rgba(0,0,0,0)}.color-picker .arrow.arrow-top-left,.color-picker .arrow.arrow-left-top{right:-21px;bottom:8px;border-width:5px 10px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #777}.color-picker .arrow.arrow-top-right,.color-picker .arrow.arrow-right-top{bottom:8px;left:-20px;border-width:5px 10px;border-color:rgba(0,0,0,0) #777 rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .arrow.arrow-left,.color-picker .arrow.arrow-left-bottom,.color-picker .arrow.arrow-bottom-left{top:8px;right:-21px;border-width:5px 10px;border-color:rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0) #777}.color-picker .arrow.arrow-right,.color-picker .arrow.arrow-right-bottom,.color-picker .arrow.arrow-bottom-right{top:8px;left:-20px;border-width:5px 10px;border-color:rgba(0,0,0,0) #777 rgba(0,0,0,0) rgba(0,0,0,0)}.color-picker .cursor{position:relative;width:16px;height:16px;border:#222 solid 2px;border-radius:50%;cursor:default}.color-picker .box{display:flex;padding:4px 8px}.color-picker .left{position:relative;padding:16px 8px}.color-picker .right{flex:1 1 auto;padding:12px 8px}.color-picker .button-area{padding:0 16px 16px;text-align:right}.color-picker .button-area button{margin-left:8px}.color-picker .preset-area{padding:4px 15px}.color-picker .preset-area .preset-label{overflow:hidden;width:100%;padding:4px;font-size:11px;white-space:nowrap;text-align:left;text-overflow:ellipsis;color:#555}.color-picker .preset-area .preset-color{position:relative;display:inline-block;width:18px;height:18px;margin:4px 6px 8px;border:#a9a9a9 solid 1px;border-radius:25%;cursor:pointer}.color-picker .preset-area .preset-empty-message{min-height:18px;margin-top:4px;margin-bottom:8px;font-style:italic;text-align:center}.color-picker .hex-text{width:100%;padding:4px 8px;font-size:11px}.color-picker .hex-text .box{padding:0 24px 8px 8px}.color-picker .hex-text .box div{float:left;flex:1 1 auto;text-align:center;color:#555;clear:left}.color-picker .hex-text .box input{flex:1 1 auto;padding:1px;border:#a9a9a9 solid 1px}.color-picker .hex-alpha .box div:first-child,.color-picker .hex-alpha .box input:first-child{flex-grow:3;margin-right:8px}.color-picker .cmyk-text,.color-picker .hsla-text,.color-picker .rgba-text,.color-picker .value-text{width:100%;padding:4px 8px;font-size:11px}.color-picker .cmyk-text .box,.color-picker .hsla-text .box,.color-picker .rgba-text .box{padding:0 24px 8px 8px}.color-picker .value-text .box{padding:0 8px 8px}.color-picker .cmyk-text .box div,.color-picker .hsla-text .box div,.color-picker .rgba-text .box div,.color-picker .value-text .box div{flex:1 1 auto;margin-right:8px;text-align:center;color:#555}.color-picker .cmyk-text .box div:last-child,.color-picker .hsla-text .box div:last-child,.color-picker .rgba-text .box div:last-child,.color-picker .value-text .box div:last-child{margin-right:0}.color-picker .cmyk-text .box input,.color-picker .hsla-text .box input,.color-picker .rgba-text .box input,.color-picker .value-text .box input{float:left;flex:1;padding:1px;margin:0 8px 0 0;border:#a9a9a9 solid 1px}.color-picker .cmyk-text .box input:last-child,.color-picker .hsla-text .box input:last-child,.color-picker .rgba-text .box input:last-child,.color-picker .value-text .box input:last-child{margin-right:0}.color-picker .hue-alpha{align-items:center;margin-bottom:3px}.color-picker .hue{direction:ltr;width:100%;height:16px;margin-bottom:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwkUFWbCCAAAAFxJREFUaN7t0kEKg0AQAME2x83/n2qu5qCgD1iDhCoYdpnbQC9bbY1qVO/jvc6k3ad91s7/7F1/csgPrujuQ17BDYSFsBAWwgJhISyEBcJCWAgLhIWwEBYIi2f7Ar/1TCgFH2X9AAAAAElFTkSuQmCC)}.color-picker .value{direction:rtl;width:100%;height:16px;margin-bottom:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAACTklEQVR42u3SYUcrABhA4U2SkmRJMmWSJklKJiWZZpKUJJskKUmaTFImKZOUzMySpGRmliRNJilJSpKSJEtmSpIpmWmSdO736/6D+x7OP3gUCoWCv1cqlSQlJZGcnExKSgqpqamkpaWRnp5ORkYGmZmZqFQqsrKyyM7OJicnh9zcXNRqNXl5eeTn56PRaCgoKKCwsJCioiK0Wi3FxcWUlJRQWlpKWVkZ5eXlVFRUUFlZiU6no6qqiurqampqaqitraWurg69Xk99fT0GgwGj0UhDQwONjY00NTXR3NxMS0sLra2ttLW10d7ejslkwmw209HRQWdnJ11dXXR3d9PT00Nvby99fX309/czMDDA4OAgFouFoaEhrFYrw8PDjIyMMDo6ytjYGDabjfHxcSYmJpicnGRqagq73c709DQzMzPMzs4yNzfH/Pw8DocDp9OJy+XC7XazsLDA4uIiS0tLLC8vs7KywurqKmtra3g8HrxeLz6fD7/fz/r6OhsbG2xubrK1tcX29jaBQICdnR2CwSC7u7vs7e2xv7/PwcEBh4eHHB0dcXx8zMnJCaenp5ydnXF+fs7FxQWXl5dcXV1xfX3Nzc0Nt7e33N3dEQqFuL+/5+HhgXA4TCQS4fHxkaenJ56fn3l5eeH19ZVoNMrb2xvv7+98fHwQi8WIx+N8fn6SSCT4+vri+/ubn58ffn9/+VcKgSWwBJbAElgCS2AJLIElsASWwBJYAktgCSyBJbAElsASWAJLYAksgSWwBJbAElgCS2AJLIElsP4/WH8AmJ5Z6jHS4h8AAAAASUVORK5CYII=)}.color-picker .alpha{direction:ltr;width:100%;height:16px;border:none;cursor:pointer;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAAQCAYAAAD06IYnAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwYQlZMa3gAAAWVJREFUaN7tmEGO6jAQRCsOArHgBpyAJYGjcGocxAm4A2IHpmoWE0eBH+ezmFlNvU06shJ3W6VEelWMUQAIIF9f6qZpimsA1LYtS2uF51/u27YVAFZVRUkEoGHdPV/sIcbIEIIkUdI/9Xa7neyv61+SWFUVAVCSct00TWn2fv6u3+Ecfd3tXzy/0+nEUu+SPjo/kqzrmiQpScN6v98XewfA8/lMkiLJ2WxGSUopcT6fM6U0NX9/frfbjev1WtfrlZfLhYfDQQHG/AIOlnGwjINlHCxjHCzjYJm/TJWdCwquJXseFFzGwDNNeiKMOJTO8xQdDQaeB29+K9efeLaBo9J7vdvtJj1RjFFjfiv7qv95tjx/7leSQgh93e1ffMeIp6O+YQjho/N791t1XVOSSI7N//K+4/GoxWLBx+PB5/Op5XLJ+/3OlJJWqxU3m83ovv5iGf8KjYNlHCxjHCzjYBkHy5gf5gusvQU7U37jTAAAAABJRU5ErkJggg==)}.color-picker .type-policy{position:absolute;top:218px;right:12px;width:16px;height:24px;background-size:8px 16px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgCAYAAAAffCjxAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAACewAAAnsB01CO3AAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIASURBVEiJ7ZY9axRRFIafsxMStrLQJpAgpBFhi+C9w1YSo00I6RZ/g9vZpBf/QOr4GyRgkSKNSrAadsZqQGwCkuAWyRZJsySwvhZ7N/vhzrgbLH3Ld8597jlzz50zJokyxXH8DqDVar0qi6v8BbItqSGpEcfxdlmsFWXkvX8AfAVWg3UKPEnT9GKujMzsAFgZsVaCN1VTQd77XUnrgE1kv+6935268WRpzrnHZvYRWC7YvC3pRZZl3wozqtVqiyH9IgjAspkd1Gq1xUJQtVrdB9ZKIAOthdg/Qc65LUk7wNIMoCVJO865rYFhkqjX6/d7vV4GPJwBMqofURS5JEk6FYBer/eeYb/Mo9WwFnPOvQbeAvfuAAK4BN4sAJtAG/gJIElmNuiJyba3EGNmZiPeZuEVmVell/Y/6N+CzDn3AXhEOOo7Hv/3BeAz8IzQkMPnJbuPx1wC+yYJ7/0nYIP5S/0FHKdp+rwCEEXRS/rf5Hl1Gtb2M0iSpCOpCZzPATmX1EySpHMLAsiy7MjMDoHrGSDXZnaYZdnRwBh7J91utwmczAA6CbG3GgPleX4jqUH/a1CktqRGnuc3hSCAMB32gKspkCtgb3KCQMmkjeP4WNJThrNNZval1WptTIsv7JtQ4tmIdRa8qSoEpWl6YWZNoAN0zKxZNPehpLSBZv2t+Q0CJ9lLnARQLAAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center}.color-picker .type-policy .type-policy-arrow{display:block;width:100%;height:50%}.color-picker .selected-color{position:absolute;top:16px;left:8px;width:40px;height:40px;border:1px solid #a9a9a9;border-radius:50%}.color-picker .selected-color-background{width:40px;height:40px;border-radius:50%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAh0lEQVRYR+2W0QlAMQgD60zdfwOdqa8TmI/wQMr5K0I5bZLIzLOa2nt37VVVbd+dDx5obgCC3KBLwJ2ff4PnVidkf+ucIhw80HQaCLo3DMH3CRK3iFsmAWVl6hPNDwt8EvNE5q+YuEXcMgkonVM6SdyCoEvAnZ8v1Hjx817MilmxSUB5rdLJDycZgUAZUch/AAAAAElFTkSuQmCC)}.color-picker .saturation-lightness{direction:ltr;width:100%;height:130px;border:none;cursor:pointer;touch-action:manipulation;background-size:100% 100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOYAAACCCAYAAABSD7T3AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIWDwksPWR6lgAAIABJREFUeNrtnVuT47gRrAHN+P//Or/61Y5wONZ7mZ1u3XAeLMjJZGZVgdKsfc5xR3S0RIIUW+CHzCpc2McYo7XGv3ex7UiZd57rjyzzv+v+33X/R/+3r/f7vR386Y+TvKNcf/wdhTLPcv9qU2wZd74uth0t1821jkIZLPcsI/6nWa4XvutquU0Z85mnx80S/ZzgpnLnOtHNt7/ofx1TKXcSNzN/7qbMQ3ju7rNQmMYYd/4s2j9aa+P+gGaMcZrb1M/tdrvf7/d2v99P9/t93O/3cbvdxu12G9frdVwul3E+n8c///nP+2+//Xb66aefxl//+tfx5z//2YK5Al2rgvf4UsbpdGrB52bAvArXpuzjmiqAVSGz5eDmGYXzhbAZmCrnmzddpUU+8Y1dAOYeXCtDUwVwV7YCGH6uAmyMcZ9l5vkUaBPGMUZ7/J5w/792/fvv9Xq93263dr/fTxPECeME8nK5jM/Pz/HTTz/dv337dvrll1/GP/7xj/G3v/1t/OUvfwkVswongjdOp9PzH3U3D3zmWGnZVXn4jCqs7wC2BKP4/8tAzkZsoWx6XrqeHZymvp4ABCBJhTQwKfDT8gzrZCIqi5AhiACjBfEB2rP8/X63MM7f6/V6v9/v7Xa7bYC83W7jcrlsVHIq5ffv30+//fbb+OWXX8ZPP/00/v73v4+ff/75JSvbeu+bL2WMMaFbAlpBNM85QX+ct6qoSqkPAwuQlBVKqGNFSUOAA3Bmu7gC5hNOd15nSwvAOUW7C4giUCV8Sgn5L9hNFIqTsp0GxI0ysioyjAjkY/tGJVEpz+fz+OWXX+7fv38//f777+Pbt2/j119/HT///PP49ddfx8fHRwrmTjV779EXu2px2xhjwtdJZQcAWQIPLPISsMJaSwiD8gzIKrwSyATE5j5nAbR5c1dBUwBlsEWW0h6LqiYsqFPAQxCyRZ3wOSARxmlXMX5k64pQfvv27f75+dk+Pj5OHx8f4/v37+Pbt2/jt99+G9++fRsfHx/jcrmUFLO31gYDWblxRIs/TqfT7ousxJsAxXA2Gc7TA9XdgfdoHbFsj76X2+1WArgI1ageGwA3qupqoHsmcbI6Fu93quggFa9d7LeDtgKfAFHBJ+NEByIkcJ5KervdTmhhGcgJJSZ5vn//fj+fz+18Pp8+Pz/H5+fnmGD+/vvv4/v37+Pj42N8fn6O2+1Ws7JjjP6wraMI5E4RZ8x2vV5TSwkquotV7/d7Tz6HFWsD/qNcdw0CQ3q/321c686TwDVIdbuy73zNldhSHb8I2klZznm+InBS4U6n0302aBFsLhHDAKJVJVglfI9jhvu53W53sLANYNxAiDA6MCeUHx8f9+v12i6XS7tcLqcZW57P5yeY8/fz83Ocz+fnsSmYUyknWEG85WBst9stzSLyMdfr9Qi08iY15UZ0LlDGLhR3o5zK2j7OPUTD0E+nU3tk7Xb/16NFbhloAMuY1zjLUOO3BKeIDe+Z8s3/J4gFo4TM5jPmuRg28foUKKVSwo16TgA5npywcWLHgYl/Pz8/73/605/ab7/91m63W7tcLie0sZj4mao5gTyfz88E0f1+j8EcYzwTPEG2cqjyfHNF0M8fuqEiaOVnRzZZQNh5fwQyHg/HDGfJo89Q1zb/quu5XC6773I2XKfTqd/v9+d3wuqWva/YTdUdEV3fhIv/Viyps6YE3x3r43K5bJQS66zaxVGFsvd+//j4aF+/fm3fv39vt9utff36tf3+++/tdrudvn37ZuNLBaaCMgUzC+rZRiFowxUuJI8YMqcCp9Opq5vagaYU6lGJA1XQqejchw6Cj0Gw5nYBrGw01A2O206n04BGouNNyTfp/FwElhUey6nXrIKw7QQWddxuN2ldL5fL839gSPF8ahu/JvBO48CPSuqMf8Vp9/P53L58+dLu93s7n8/tfr8/39/v9/b5+TkhPJ3P56mQ436/j+/fv+/iSgbzer0+AZx/5+88bv6OMda6S5z6kd21fYC9dxv7cIJJ2d9AOS30fPMzyHiTM8B4DF6XUlYHp4KQW3W+1t77MNB1vGHxWq7Xa7vf78+y5/N5A+H1et29xuP5dbYtyaRu4AksbPq6936fjRzXRxBbPr/b+b18+fKljTHaBBBfn8/n0/1+H1++fBnn8zm0sB8fH5u4cr5GuBhMVk0EEn9RsctgVhM+ixlJtMA23R8B6yysAstBOgFXIKKCMIgToMqNEu2fYMH7ztc732dQKkCj1ytAZtY0Kx8pIr8GGJ+AT3V+2Hirhl++fBmXy2Wz73w+b17P8p+fn8/tUwGVleVkTyUb68DkfayWY4zxNRihU4EpLJPZVrK+u7J4/mgfKqeLW9X2REWlItL1diynbDDb3+jXgYjQqn0rrxWc+NkILP7F7xIbMvx7vV53x40xnlbWJF12ZSag/N0pW6t+ZzmOMzHjajKwDfond78zYTdfq18up97zr2q8v3IioBprRtBl0EZ9og5WBRGOdOHjIjXF7UotFbgOWnXzIJyzYvjG5IYgsmMOxHkz8OsMSrVNWeq5T8DaOcbEv1Od5rbs9aO7YvMet63EkF++fMExq+MRl4/L5bLZN/+ez+fnZ6KazuMqXSQVO5spJXflHAIzes/xJseckRJiDMog9d6VfRrqXMr6KpVV27jRwJacGovOAM1zMdQMnwK1AubK63kdCChvI1C7g0z9nf/D+Xze2Vj8H7Gx4P9duQlsYCrqyN8XqG3Hm/10Oj3jw/n+crlstuM+jPmmxT2dTuPz83Pzt2pn1XsEHX/bnPaVqVmh0xwOt0o6XLLAHePUU203wHfcrspCwmV3TryB5s0Mseeg97x/BwzCjBlbB+pRAPla0BVQuT6V6QHdBlj3d0KG147b+DqxQeUymDO43W4dQar+TIjwmAd0z8/h65vf0/yLv3Pb5XLpru/ydDo9s7ET0I+Pj6dKK9VUEIeKWQWPAOrJ8LKd4vE+t91Y3e7UFlWatg2VwJnb+HPmtvm/sfK59/OaWF3x/eP1UPHvA5DDYDpYXfb0drv1V2DkBkxtw/tEWVVlXWdC9pFYs5/jfh9dS/16vW7s6lTG+TfqsxSJHxkXXq/Xdr1eu4LsfD6P3vsT3N77DkL+zPm5jSdKL4zR3AxQd6rHkLkYlSowsrq7znzu6wSwdsMJOXmA5fBcjxtgMGBYHlr5zokhtsMCTgXLQOW4XC6dEyEMprL8mAQzXRgduix2yZzorxkYsDn3hB1VeMLGsXsVtgl2pW8S3svk0vw7R4hNaHvv4cACl5HFzwIH0Kc6zu4XjDPR/jpAVxWzO1Xk2DDb3vTcxeGU1iWZHkmIDWziWKvirCJ4Dravs6IJ/GG6cTqWdXDy+fArQDVVkLqkVjAoZIITdmmIqXwqa95N3+MGYoZQdRVNO53Y1xRkhO16vY7eu507Ca9lJnbGpxOemQhSw/AQsmmp5zU9BiU8G6wvX76M6/U6Pj4+do0Bz4CpgiknTUeDqwlKBmg3u4OVjrZ1A+rAcgaejWq6eJCvCYFDONSwOgHX4EQRw8lxbzDOdEK6gZ3Hk1b+8g2o1JFtKXyv/fEdTXuWjWXdAZiBp6ADeDrCFiim7B6ZFneeI7Gvm/PMkUDX67W7xI8b0D7/v8dA9qfN5oaCf74WZjH0mf1cmfY1Y0JUFmVrTWu8uzkNcLtEj7u5FXBTkfC6GOA5q8YMxO8KVvF6sAVGdcrUbsKODcQKkLMOMdmlxum642YrPm26AlhZW1YB1R+rrGswE8TaYAWeUMxdf+WjwSvZ2Ef3ytOyfn5+PpVPAaqOn43MtNBqvmjjxbjM4lZjZY4gqNMI5ktaW/sYKNwS+9lFQzGihmMCKPa7+Z0V6Eb0GRmobtpX8JljWu5FMLN5ja6hG9kwQgZqf5+1NH5UxzkFReCdWhJ8XdlGUkxO7HRlYRm4mVO43W7ter12TPJEw/rmEN3L5SKHIWZg9mz+pUoKOYq5bJTJdX2gme1UcxMZQFaEQIlHct32M+Y1BzGkGuzfiyAN9z+ugplZ1symCrDCYYkGxDTpI9RzBy0rHyeDUC1nWaeUaD9n4xkNyYMBDZtzZ3B++fJlY21XFDOcARJlabOyiS3uCpLI9jrZjCDkaVvcCCjwognKShWdzXZWlZMvVTgD8LpqlCLrqgbcB+qYwrgKYpT0ccCqbKyCValkEabn/FynogCrPKfqf51xJ7sGB2ZXcZmxoSOztjx300DZi7a0/2AIR0UlBag9SuDw6KcAzlaB7vHZvWpjK90dyrq6bKyDUZQbR0B05biLQkHIcSUmgIK+SwuqgHCnoio2RQU1yj+BnBy9pphVKLGyC7ZzFK1pxWK+E8IhVCWLN/uLtnUU4ayoYLoaANz8FdtaSvY4pV0BEW2ls61czqllBKpTyKgMAhrZ1cdc1RROtPmvWNkdcKZ7ZKxaWjiPLJMpp7OZKxA+rqG/oJLjxf0pnJlqLoDZo3gyU0mKGys2taKecj/d1C+rJSplBqlTyAqgR+D8KjKlmRL2gtUcAdCtsL+ijCNT1oqqqkH2OHEbG5sDFnUg5Aa+yLou2VU1ptj1S2ZQqv1ORZN9IWzRfgaRBxKoBE8UWyqlJFtrIc0AxNjSjed99CTY/XDfSzCz5M0IZoVEsWnPFNTsl8ooVC1TzbGgqFZNDSgVwKK+1sGDMKqxZCWGVMDysiEr1jVSQJUYwj5iHOlThdHt44SQg9CN+nl8D90NMIgAdgr46JqRiR9I8vRdFvbr17m/yxUMKjNLMiVUADwu2CWGhhi+F55TWM9M9cogzms1dnM4uOF/LAEYWdcqnM7yFmyq3IfwmOROd7Y1iFWtOjoY8To41mTV5IysgFFuRzsbWFGbNIIJCDv1dOo4lZG7jWBwRFtVTKuWyeCByJKOan8oZ3ep9XddNl0tDuaywLz9cXPYeDAA0SpkBO9sbVcTOVWldPv4uyzEkzxHtjvonHoSkFEWNoo1d8DhcQputd2ppNon4BzoAiJ1hBFQg0dVtdbGHHDQWushmNEQukLM2QO1G2Y8bgTXqFhcBJj7EjPgcPts8US8qPpPB/dXznOh5Z438tzH5ec6QgrOKrRRfKmysBmUDB+PhYabMlVPER+GCSITTzr7am2tArH3bgcEzPJm+cr5jJ4NnHNFDVrFXcI5Le9k5Jnw+bedbV+FfRzZIHaOOaOsLY0/7UGs58DjrGwKMIMFIGzOEW1/jGsdAtCN6hEAI4hBe9YXeRROBSVPAVPAqvIM5bx5hVKWAMP6zBRy3iescridVdFBinBxXDnG2GRY2XbCvp1lhvGtO9Bxu5h908XQu42lnSArMFdizMim8uwRCxPGnnOS8lwpnbOiDqTAjsrRN/PcoAScCbaACqVM40ylnjjTBs+bwWlAG23/UKbdkiwKWIQPGzWaczpoSlxPEj822cNWkpS7FyzsDrqpfgpG3jahw2vgbaSQAxuLWZYt7JzyNe8JoZpNAcvDFOdw0wqYT9AK1rZz/DdbSlLPp0ryIxgQJlK9AZlEq7IOXpohg9PIhrCng88JsOxiV4ZWAYfg4sikx/8ky2Z9l862uqwrfscIH8+ugTmVGyiddeVYUgEMn4GZzg14EwIsh9sx2cKKiWXReuOE5gzGOQgdlRKVVdlevqb279Xq0Qnsts2VDaBO0coezsruWtHApu6sKG4IBhN0aGU2kLrMKGRTN3HmbCDwKV14zvkMEDG4QfZVspVlaNU2mhc5TEZ3N1h/zqTheuLpW05ZWTGVjb3dbnNmxKZBnN8JqidaVLKAOyARNLS+MB54Z2+VaqoMLKroVBlngefnTPAcoHNWCSvlfA8CI0HEmBNBnBlXyMrzU7A7WVm94PPqQ2gmqKx+WDGsnvilmcSOBJqOK1nYyAIzuAyesq3UdSK3KfWcYKD95HmfYOU3qser2CtYEUA+FpfqdNvgPBZUBhDrGONRVlQsh8rLcaUCykHG0OOUwTlLBrsh5soEMGezi1E4HRVt1icp5wZEFXdibCkG8Y8vX75sbO4E0iom9z+hjSiOfy3DhpXItpVhE+UGQdvoWjtChmrGHf4YAzKgBNnGtuJxFCeGdhUAfQLLK8kBYAP6gvFJZajMG3Xkycy8KuC0q4Eyymwtwdxdv2M0mIBtK0LKnf640j00Auq4gUkdWGlhs22qJc6dZCsL19oxnlTJG4SYVRIGpD8TPFBuM6OElbS1pldid4mGAyN6ZIupbC5bXJN9fdpbThSxLUaI8IG1XIYBxW3Tjs6KQosKcxfxcQmdnwRGM10GnFcCy2XYunLMyAkdgk4mePiczsLygthcBut6goOqS7YVFXADLjaosB6s6ofcZWAZSIRYqSUkizYwttYab3vUOQ9w2HRxIIg8WwRVeE68xi4UtL3zRphxplzwuZrcqYCq1I3jPI5dnJIygEohMbPqVJSzrwzxBJTs5zN+ReUSgxikPQVF3JVBeNQxbHENrEMNvEdFZVV9lH9+ORGEsNZQpyTNc4C3AG7XF4ngzq+DrO2zbuaaOXgdaFcdkEotoSFBVX2qJ0C8OWZeG4KGlpghA0XfTOPCqV2qqwQ26QWfF2PMLhI2w1lVAa2aPsYd0za25MQRwgcZN6uQDCi+ZxiD4XEM2kZxOT41FnZnaRlcpZouzlRqqdbQVWopQoSB58RV50lBNrHi/AwXS5LrwDVlpY3Fc3ByiYGc52Trist6kOXdwInAQtJpp5QchyaquYOV7Su+fxVMaV3dc0RE2S6mUY0gLt2pMcYqrKIQ9w2l1gpQUMtQYcmmbt5DTNxdhnUCjQqtbK9SUSzvrC0mmhhE1e2FS2+oxypy/ZASutkmtjx3vcBC24PX65nbqkBCRhfjS9kIYPnee8cMagVOhI/3T1fAmdtAWZsCswTJCkQVNa0qWKSKPOpHAUhD9DrbVcyoYkwqhvh17vYAayXLQyKGYdxlUDFp494rBXRjYgO17DDYetNIUj/ezp6S0lnlpEwsWmJMkOwsKXeZKEAjIHn0EQJISaRBcO6UMINz7p/bEjjnw4ft+xmDvksxX4G2rIris7qaeKwAFMP2Oi7n4criuZwtpSUwpfLxSnORSrIqusc5ZFaXysqRWjiZ2DyAWEIL35tVSoQElFACjOeGGSE7AHEQgdo/LSvCOgGBvkxsmDbvlS3Fp5vhaB2TAGqRKrKKMrhLVpaGzEVjZ0OQxDhaCTA+QyRR1d15aQzrJntL3RibsipjG6jlgL4yqbS0sNYg1e84vhbBVrElK64CUcWYXDfKxhpIuxiVJZUxsbMy/uRBKTNRQ4kQ3LdRYLS0rJjRPlTPqY6gdJsEDc+aQXAn+HgsNUCbRuF0Oj0zwnA7bWDkbhO5Ens00qeQhS1laBMl5M/cAaxsLF8rKyql+Tf7ELLEGu/ixiimdCvo0TjfpjKwaggen4eh5v7LokLKbLuyvHhcZG8dhGrEDx7Hg93ZppJF7qBqO3iVveXEDQNInzeoe8Yq6ePaZBZ2JviM3W2UAGotekRCAGq4EkF1X3DOnR11yRsBL1tRa0PVcZiNFXZ2c34FskvomInQQ6lzpJoZbJxk43NwKJFBquJSsrByHydxKOnTxQASBmS3j+JMnsHSla3Ec6K9VWoJVn9zfjwOM7hqYAAqJQwE2a3nA48J2QGegRkpZNivSY+ys3EkKd4oJIwsvIHl3cWgLt5k4NH6OmtLWdpurOkwEMupYc7eMtDRhOcI2ui5JhVIzXzLyto/GAPuZoyo8wkoduVgJglCt7OhGbgID4Mq4si+63zUS1FuFFXFlqyaj2emHlLMcBqYu0FMuR28BbB7lOxRMSiCQXFhCKuwkhZ+pYDiGSgbsKKV8MiSRsuHSIWM9rklRiIlZZuqXjsQK8ooYJMgq3JKWVkhHbhsVxFUzthOWPkYijcbx54IKsSdT+uLr3crGKyoYgFiGR9iBk4kfloUX+JIlQRQqabmpgnhqtpQpb6RVQ1WH5DnrS4hEoGZqaerQ2dhFbz8XePxShmDbo70eISjoorO2vK8SJXI4SUmEU4zWKDzUDtWTYw7xXlbSTEj4FRg7zKnKoGRALv0Gs9Tgc1BpCywGZRQAtqVz2xrBcAMzEpfZwFSa2G5W0QBFjSMapWAEFa3HcGN7CxDzECyIkJ97qwrqWNTWVo876PPsjPkj2wvgroM5lLZKMETKVql/CvnWVFiFa/SzJUQwkoZsr67Y6vlSRV3/2tmNTOY3vnaxYwMuoPKqdzR1w7IqHymlPxaAThfU7Ko2ZXYj4AYJHL+kNdKwRQYESTRa5fsUZ/rVC1TMTyWVyYoqNtuzaHsMyv2tvoarxdfqwYgU1axFo/cnql1FGsqK+uAROV8BX4GU8WcZTATi2q7Qcyi0O0V+GhWBMNRUkn8H1SsWVE5By3Gi0ECqUeJoBfAtDa4amkdXG37AGP5Ggeb84p7UazpoKRzdFzeQ8HkoHGxprKy/Hpm5t12p47J6xTYDEz7uINEXSuxYXvFskYAc+ySxH9sf5ftKzU6IbwVBcUGg5e5FMCEXSErZR0wGayV19woM9guPjTqJdVTqR4uE4nJnLldWVkECCZLd2VLF+xtamex7IpiriSDUpvrpn9lrwGMCHyppMH+ps6LILsuFGUj1XEOXiqbqSHPUKnClpWV68kqtURVNDY4TNaocykoYeTU5ngGEQa/S1DnnE4AeXMcKjHPAmFVjCBENaeyLVNHfr3px8xUstJ94hIpfH4HKE/eDaArK6lSyVVFbdt1gxTIVk3pppVlFXi4pEhVBTObquohU85MLXn1iahvUkHJjSCMc01tLFveVVBx0DodM6jftCu7DOtIzYxrc0qp1JGP2ayYFz2Gb6HvMrO8cnGtV6Gjm3uImSfD2GpWK6uowbZGMxFKQCo1pOMtcMXFpRst+hXGoAomF3sSTBGgTglbBKWwsQ3tZqaYSp0Z1CimRDWFcCJUPYJ00BI5FkKYNoifuQxmN88SWVXWLMaUqqqgC0BmQJR6sk3u9NCf6jYLXxAfqsYEgVLAhRY2AtgtflZNFmFyhxdrLkAdWlk4D88M2ixHyepIdhMHrG/iR1ZGtq0MGpbDbRPYOXeSY1M6Ny4ZstvGSktK+XbFPATj2D371saPEsAMXhXrsZ0km/XStkhhMyBfsa6uXFZe2VCe+YMr1+GKgwrQyNYq1VRrB+EizAow6NsdNKcyVEkYeM73ys6q4kAHp6BiFklTkIrVC5oYV7uzwOGCz4UJ0Stq2lWMJy4wtb+RetL6tZFicnJmBw5UjCvXXMZVJX2MQkbf+XN5EWd78Vz8/JEsMZTBiKNzsm1inLRUQ74H4NidaqI68j5sAFgxcRveC7ieLJXfQYxjZZ2CsiWFewZXJmBIlZ1tdtrX4hSuateKso/RZOtOKW2nmq1oTzeK6dRWAWu2NRVb4hq0SXm1GvtugHrbr5IXqmSktg5CuDE2MSlPwsY5kNE2Wp3AqiZbWVLAxiBF+2iBZbuNj6MB6rsMLC7FyasaYDyo7KkoPyEtw3pEMXfPvxAJi2jAQQgjrz0rLIZSWZlIoNhwd5xK4AR9mYNjWAaLrnuImJeBVN9zBORObVvbr+mTTfFSEJLSRnHo7hEJoIi8MFqjxmvgmF5URZz4zLFgZZ8Ctu2X7ggVccKm9gVxIsOHqxXgNMKnFWZYnf1dBnOhayXq17QwFlWW09eNKyVJFmXqaONGA5aCegMbJ3UUkGY1ic3nKWgjq8qfVYGQG1gRt6rs62a6HiqqUOqdesK5NmX4nGofJoiE1d0dF9lVVkvT1/kEEaaCoYOwFpcVcoLM+7669PxC9rWqktH0sWUYld0VCpuBZ/stVRcGgy9WX2+U1Qthi9SzAqSxzZsy+OiFzBYnySGV6Gku44rD8BCOZBV3BvD5+AKRHNwMEsB6EzHnJpkTAeiUlEGkcECeB6GDZTp5YEJTlvdrknxYjTllMkfNtXwDjM7uVjK5JXUUn43rrqpK2jytaxHW0M5G8DC8rtHMYs7KSgduVQMGTYFqFvVS6rkD3sDJ46afdYFwoq11AOKCBLhvwoUgc8IGANycR6knZrdJPdsuxnyjfd3FovTlRMdEdtOl5CMV5EHsXQBis7TOwvIDZaGj2Vnpbh7cpK63VwYEMLwqbjzyl699sawFFkF1yqjUU31HfC6sW1ZFVFuXVXVgz9keEaw0ys1lWfm+azQAQSWA+hKYVfsZjPncAcUB9oIayy/UZXRNckDGji77GsWbvBo6tPrWPqOyVkBUq+INeqpzNdYs/u0ifh5qmpqIW+33JVSUcwY70KL4U9lYdU6ljtSls7lmfi9g3YzeQfVkaGFaV3ODCnaD2N8wsEDFklE3RzM3ZghdYkWHsszq70FIecnKkVkt8ezMzRq9bkGuKojRLBVSod3Y1yPqKgYW7JRQTPVyy5xIYLjOgxgT52RKJUY1dOrIiRd4futQx/A5AcSmEjz0vFWrkLzvbWAu9HOWbGgxFk1VNTpnBKk6TgwisI/HcxYXP1uAWO72ULFlBTq+aSu2VTUs6hrxM2CF+hEor1VIA9ZmFUaab1lSSgZsVs4sxzHlVLoJHr9H4DhONTkI1XC0/wiY2NoWAG5RlnHFnq6oLccpQddMuJ/O17JVA5OHLi0BqCztq7Y1++ucCd98qLI8MIHBV/cKjxQTme3hFBS3MyCqnDsuym2o80HjvFFTtrURmNaGJsmVahImjTsUXKtQZTAVs7Mvv8/+fzUrZAXcLJ6M4koe6XP0b6SmWWNDzyUpQ8bl+LtWx4tuqZ36cRYV3yuVxPNwvIiqiQCSmu7srgTzR6nkyhpCarXwFy1vGd5iP2cY06lFr5Njhhg1Y6+NB28ftbK83s8rf7kLJbKwDFPbLg25a0AdZJEiqr5phixKMDlRUtcssq1hriLqGoH+zeNgVm9OemjsETV8JdF0NHnkIFxWY1OB4Yrp7rtWJ7NgAAAPXklEQVQ3oNs5nplyVf8u2FoLu1JrHveaZWQjqAkshtFa2gzsSG3Zpkbvg3HafF9slPPlldjFlK80Gysm8Mr4MPhneNWENPGjAIpmilTPATdTRTXlCBYHYAQuPwA36xIpWtGN4q3Y2MhiGsUpuSSnlEJRD8PorC7CFYVw+F51qThgabxsTxWzCGY0ZSsb3lfqAy0OPNjNy8xiQQKsHYFQ2HBZVvVbBuq3m1oWKajqaonsM6uZUr6CjXWNZ0l5E3h3jURma6kP3MJIiy1Lm+kahQq41N2iZja5sjtlLYNZHZrH6qUGm4vMbDp6Rw2CFmvuyFkrBcCyMtFqBaECmsHoK9BZ2LA/lJcRqSaDqnaWbrZdGaz3DLgIvBln4woGztbyJGqslwxkhhHrTjTYFXCtOoKS8uLdofVdAbOylGU6nlYpXWZts4nXBq6WxJitMNokHUJnbnJplQm+aGpY2a5GMV2QD1hRubBPFKdumf5OHkLHz0F9luE5kjBjRa0nFE5CUGqHw32MmjZ6xkgINVnSnZ1VZStK2qKlRaLlQgK7uTq7JFXJwM+3SOEKyhZNI+tJ0I5qMYy9k2qJD7dVWdqKXa0CKNR0Ccjg+B2IYu2fcBZJZkMFgM11r0X92wilghFGgzVnexlqB7xL9mS29SiYUVY2nXOZjNBRsyDsQPRWW5hrZ4XcdC4HVWRbjgJr4sFofK5SzjQ7rhI1UebdPdEbj6sqIvTZQZ5va08rABsAW0UxeWytAk7A2KJ9ZpxzCioB24XFtYAeXYxr6anSqhLgppEqWbGwLunTgrV+IjWlL29ljaAl4EQMGsErp4apeZiquwRXLXAqOCeru32mmydc6oWTSWpFAGdzeTB8RTHVMEtlM90CbbQCYhPjq3egYr1FGdYIQjiuDGZ5zZ/AzobKGOyLxti6c4Rwtv2anyWlLICnlLhxJRXt6A5ebDBWFNONbxWZ2d02mnu4S9YECpeppV1zSWRBWxHYzVIv1CXSouwqqX3jBBBDZdYQbpTQW4ZQlS8r5kH4suSRmg2++3JN10x1PaAmEkmtYlEdeGpJEM6kOuCqCR22oSujj5IV2HdT0zj5prLKTjXFAPjdQlyq7xIBxAQP5yMczG4VxAKw0n6ilZ2QBce2pLulkuxxqnoIzFfgqyqjil9S1VNwBrFmeyeops8yOjZUybZdfS8CuaTIJumzs5tODaNtLpFDQ/PcJGweLhmeL1nB0KqiUDScsiUVD89Di3HtrKtSULw3RLiygZD+7sF8JTObgYsrGvDNUFRGl1iy0Ll1YkUc2aJYMog920I8qW6YDCg1Mqk0JHJFKXkbgbRreI+qpYNOZHrVcDUba7pjsphSJNtK6upgRNAVoOS0mugBeN4bIZgHhuPZ/s1ENaX6KsVr+YNrh1Nb7ipR0PE5zbNRegCbrHRUw6Yf07dLBJl1f8KB9as2V1nNqAsl62LBBhehwalerkHmB1JFIEZKSEusdl5JQj1nJlHXSCF342gJ9CYGrXelknJIXqVP8sD+qtplCR3XH2qfKq0ygMp+KnVkKxNlZ8m2YkIlVMiCnXUwl7qznBKSvQz3m3Pt6oQbXO5b5FixCh/fHxUQW/AEcK6zCNqKQnL9sywqmKuwvqSYzT/aPVNNpVyhvRW21aqciCsjdWvBwILUvh5VyCzbWoC1pJjJ680CWsl+udKB6T5RwG1mlohnlpbg47iz5U9ha0FGtmRLFYBtO99y97Ap0z+ZDTAog6kSLZsMHg/IFkkgp6CpvU2U0cYVSdnmkjwBdOmXbxTWNWzuIbipMioVxEckZEoahSOiy2M3K0jcC1LhVDwaqG0ZvkcWqCnrG4GIxykrqlbWdw6LQyBaZR8HmLRIhQWsHswD42ZXVLNkf9l+FlW0HVQ2lwFsC/Z1FdzlQR0KaPfo+Fdfu+/dwVRICu1CGR7AEIiAhc+AZUF0kOBaPxmUqg4i64vQnU4nFDYJ9Nz+1fVXveH9qmr+kPILx8oKcRV/BFbxbE0JMT0kSD4w6L/lNY8ocsqagVdU3A3MjxhxcGuqzsPH4irpaow1q6OyrVjvp9Npc59E91LldboYVzJWdimWfAW2SNEKcDaX2FmBLLA/uKxlmhh613Is1URQApbKfttwxL02q6Onx5pQxSbPojAg+v5hAnN6LHVRDXIsvKtRjiS0qJUyZTAXVbAK82ElFJWaQdVoqUC1Unt7BVaTQudM6SuqexjQJN4+0icaxv/utbKv83ETbT8H8gjcOKxOJmbUa6OOVXht3dFY6rHv9XoNzFLceEA1o8+pKm0LAHPHZ2rYKjFq0hfZFixsqHJgD3eD5n+U0kb1mFjXkn2lvMSSOsNE/CdIAKF0Sytq6urOHUN5gwg4GZosgbmggM5ucra2qrS2Ig1cbiBBcxYzgzUDNLCvL8GbZXNp6ORy3LmS+Kk83zRIAK6A1ioKa2I9NapIuiUFdfC9766PFZUtqUr6KbWk+zZU1a/ZrIXEztrjTOfz7hwKziCeXIaraHtbZIMz+2pGgazCmw4qWAFvEdhodYp0Xq0pV7G1YWYWbO4qhGq42+Z8BYtrLWvluNPpZAeaFFS1vubPgbgxsqcpnAaszBovKaFoDQ8BGtjfUOl4NAG2nmQV04feJgumvX2fsrQEWZghL0JnVdYkn3DOZIeRN86RqPWCmsvGVqEMRnwxQAxwS8EMYo3IzmY2+BCcLp4MKiuyuhImamlbZFcNoNl7tp+RHd18ZjQIRKyXdFRhN98/hyKqwXWNo7O1wiaXoHN108REZZWEq6grnIfjzeg8jdRf1XEL4kkXa5bBjKxoKaljBjeHlVxQ4GaycpW4lDOAKtnTxHAtOfzOtZwHAM7sqVXkV6yu6kap1nHkXKqWF/4XHqjenNKqBjpR3l1ch3Ejg1+EsgdQhsdG0B4FM9sWAVWpuAyiwTPleZxt9VyZVS2qXfReWqTAilpr9ApoWTjxymit7NwV4JTriZyOA9B0k7HFfULourmKYHVnRQvqGL5HMHdqFcR2qWpmcK6eTwx2dipWrviDilr+fKWq3OWRWdHKwA4eu8wjchbeRzFilqjjZN3ufCpfkJ0/scVpnYk6L0PI77lxdWCZ87WiWm7B/AGquQSnujGKsB8CJmiJq8q1pKIVWyqOiTK66r18BN8r74/AE71fdC3yPS2MxdOpnE1tlVxD9JmVOoggN+r4PjAXVFPa3Eg5jVJGFVUGNolH20GVrUB7BOySWq6WqYQdWR92pcFMYMwckbSgCKCqD67DiiWu1g8MQC9ByfcFqW1L+jL714qNCuznoSxt0da2gtWN1G8F0BK0NN0nuimelUF9dIdAfjO44UT3CjQLoUeLHJFTO3gmpRuIIOvwBQCbqNeo3qtZ9iF6xVK13GRlo4zqimq+CGdTiR1uRY8oqgE02hZBa79kZXPMquxRHKla2saZWN4mRqZUj0vLCKhkjKnqOQHNuSZVJoKvAqS1wpEquvWDC1B2ypwrCPsRMEPVTODMLJMDv6qeKXwi2JYV5Sq4qKyvgGsHCLiuj2jR59V8gMqSJ2FJZRXEHVRHj3sFPrct6OpqlW1GpatQdt0GvwfM6n63InsGVFhJGaBqgqqIV6IsXllZgySPq4R3bnt3wi5cv+cN2yqQLW1T95KYVsWWtKk4cB9W53WQQflQYR6Wl4HaJZjvVE0D5yvq+RKgZCs5qdBEP5sD94cAvQLlSgNaSMAtHx88BuNQ41zdFsX30zKbcs0MLD/ihkpQzl0wiTqKLTfbKmCmyYICnK0IbaieC4CG9iSyLQ7cIMGQwau6TKoq60Apl3WN40LZpca1CKKK9VQyyIEn8w0F8F6CL2h8o3ixGwC7s7EWzCOqmcApYxYD4jsAzVS0sl2t98pA7vrKophCVSonbYpgH6mvSn24pTBV4sdtV3BtMq5k82y+IADvUJ0uAlkCVTxIaPm+UNu/qkV4F1TzHXCGrXIAqItBKypqK99VtAOVs64O4ObX7pHLVCpYHcRmwvLR7TvYAKBBN58LGVzDuFz+hQbWgncQyCZAk+VbsPSouf93261iZgmfCpwRbAvqmSqriU2PwhjaoOyYqtIegVXViTsmyta6bGySpY3gyRrpIyAeaWDDxtpsXwKyalMDKNP7YBXMqEskUsi2uC8FNAPxAKTVfT1o6VzM0E0jF+1rWcUuHvdyg7vgoFplX8HpvHpMCOMRUPHzZkInsqlFKNX/EIO52E0SxSzOwob2VmRLW5D1XIU0rbgM1AzWgyC7fe8G7xUAK/taEBat7luqtyP7EmsaJQOj5F+mrnZfCuYCfBUAWwShyd6pMY/vAHG1UqOYpbI/gy5T0CMKm+UO3gFuC85dgfDVeguPDfITrIBLsLrcgdh3CFgFZjaKJ4Iv3F8ANEqvuxR1tVKOgLoCa1jxboBAkj6v7j/icFbA7f4rfRnQDLRViG13i0vqBQrYVqBbADZT0ZpiHoSzvQpopKIFS3sE1HfBWlHXd0H7LnArqvougMtljHBgZnh3Eoz/BKjLML4Z2Aq0+hEJr9jaVUBbvNzCIUiroC7AWmmFw4o5AK3MtB5VypZMSFgs05JyGVwlwBqsEGAAa2ZU1CjUexXGsE4rKriilBvFzOKKo3AuAroE6QFQU3u8YpNXwS5k+1TZt5UrwouN4KiUEw+k3ZWDp1RXHNRqXb21Ts39945yZSg3VnZFNQ9CF3XeZyr5DgBXKiwCMa2MxeTDYXgP1Fsf9QNKZc0k81RJk3r6EQ3rCmBVyLL75EjZ1pIVDHoFtiOAHoB0BdTVylqBsKKKS+AeBXJVLY+CXASuGvO/Auq7GuEjDfGKg1oKa1z/dmmi9I9SUGNhl0AtfulHAawoYrnSkmNXAVuGEhrEVXvUF+A5Ct2PqNOjDetyna4CmeUolmeXLN4Aq7C5Sj10Q7yjgl+t6CNxSRHmI5X+CpwreYB3Qfdqna4q21KdBuc4GoZsn49ZOOiVinwHqK9WzjvgeweEh2AU5+vtxZ9Cd9Wqkh49V18E5oj6vVyn0RStAyGIO5edXRKd5B0VGVXq2yr3xYp+5Ut+C4QJ4P1N339pQMjRejj4vb/Dcr6rQc3O/0rjmtZpeYCBiCHfCemRbNhbK/pNUPc3wfKy5f2D7OlL3/uPhve/oU4T0F8f+VNM2vyoiv0jK+KHQfdHq+0bncz4oz73/+Y6LbKw1o/5B7eOf1Rl/0du9B9tn/9bvrf/j+v0h6ttn2tp/r/4819y4/zv5391uvzzfwDifz6phT1MPgAAAABJRU5ErkJggg==)}.color-picker .cp-add-color-button-class{position:absolute;display:inline;padding:0;margin:3px -3px;border:0;cursor:pointer;background:transparent}.color-picker .cp-add-color-button-class:hover{text-decoration:underline}.color-picker .cp-add-color-button-class:disabled{cursor:not-allowed;color:#999}.color-picker .cp-add-color-button-class:disabled:hover{text-decoration:none}.color-picker .cp-remove-color-button-class{position:absolute;top:-5px;right:-5px;display:block;width:10px;height:10px;border-radius:50%;cursor:pointer;text-align:center;background:#fff;box-shadow:1px 1px 5px #333}.color-picker .cp-remove-color-button-class:before{content:"x";position:relative;bottom:3.5px;display:inline-block;font-size:10px}.color-picker .eyedropper-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);fill:#fff;mix-blend-mode:exclusion}\n'],encapsulation:2}),n})(),yx=(()=>{class n{constructor(t,i,s,o,l,u){this.injector=t,this.cfr=i,this.appRef=s,this.vcRef=o,this.elRef=l,this._service=u,this.dialogCreated=!1,this.ignoreChanges=!1,this.viewAttachedToAppRef=!1,this.cpWidth="230px",this.cpHeight="auto",this.cpToggle=!1,this.cpDisabled=!1,this.cpIgnoredElements=[],this.cpFallbackColor="",this.cpColorMode="color",this.cpCmykEnabled=!1,this.cpOutputFormat="auto",this.cpAlphaChannel="enabled",this.cpDisableInput=!1,this.cpDialogDisplay="popup",this.cpSaveClickOutside=!0,this.cpCloseClickOutside=!0,this.cpUseRootViewContainer=!1,this.cpPosition="auto",this.cpPositionOffset="0%",this.cpPositionRelativeToArrow=!1,this.cpOKButton=!1,this.cpOKButtonText="OK",this.cpOKButtonClass="cp-ok-button-class",this.cpCancelButton=!1,this.cpCancelButtonText="Cancel",this.cpCancelButtonClass="cp-cancel-button-class",this.cpEyeDropper=!1,this.cpPresetLabel="Preset colors",this.cpPresetColorsClass="cp-preset-colors-class",this.cpMaxPresetColorsLength=6,this.cpPresetEmptyMessage="No colors added",this.cpPresetEmptyMessageClass="preset-empty-message",this.cpAddColorButton=!1,this.cpAddColorButtonText="Add color",this.cpAddColorButtonClass="cp-add-color-button-class",this.cpRemoveColorButtonClass="cp-remove-color-button-class",this.cpInputChange=new Ui(!0),this.cpToggleChange=new Ui(!0),this.cpSliderChange=new Ui(!0),this.cpSliderDragEnd=new Ui(!0),this.cpSliderDragStart=new Ui(!0),this.colorPickerOpen=new Ui(!0),this.colorPickerClose=new Ui(!0),this.colorPickerCancel=new Ui(!0),this.colorPickerSelect=new Ui(!0),this.colorPickerChange=new Ui(!1),this.cpCmykColorChange=new Ui(!0),this.cpPresetColorsChange=new Ui(!0)}handleClick(){this.inputFocus()}handleFocus(){this.inputFocus()}handleInput(t){this.inputChange(t)}ngOnDestroy(){null!=this.cmpRef&&(this.viewAttachedToAppRef&&this.appRef.detachView(this.cmpRef.hostView),this.cmpRef.destroy(),this.cmpRef=null,this.dialog=null)}ngOnChanges(t){t.cpToggle&&!this.cpDisabled&&(t.cpToggle.currentValue?this.openDialog():t.cpToggle.currentValue||this.closeDialog()),t.colorPicker&&(this.dialog&&!this.ignoreChanges&&("inline"===this.cpDialogDisplay&&this.dialog.setInitialColor(t.colorPicker.currentValue),this.dialog.setColorFromString(t.colorPicker.currentValue,!1),this.cpUseRootViewContainer&&"inline"!==this.cpDialogDisplay&&this.cmpRef.changeDetectorRef.detectChanges()),this.ignoreChanges=!1),(t.cpPresetLabel||t.cpPresetColors)&&this.dialog&&this.dialog.setPresetConfig(this.cpPresetLabel,this.cpPresetColors)}openDialog(){if(this.dialogCreated)this.dialog&&this.dialog.openDialog(this.colorPicker);else{let t=this.vcRef;if(this.dialogCreated=!0,this.viewAttachedToAppRef=!1,this.cpUseRootViewContainer&&"inline"!==this.cpDialogDisplay){const o=this.injector.get(this.appRef.componentTypes[0],zr.NULL);o!==zr.NULL?t=o.vcRef||o.viewContainerRef||this.vcRef:this.viewAttachedToAppRef=!0}const i=this.cfr.resolveComponentFactory(Q9);if(this.viewAttachedToAppRef)this.cmpRef=i.create(this.injector),this.appRef.attachView(this.cmpRef.hostView),document.body.appendChild(this.cmpRef.hostView.rootNodes[0]);else{const s=zr.create({providers:[],parent:t.injector});this.cmpRef=t.createComponent(i,0,s,[])}this.cmpRef.instance.setupDialog(this,this.elRef,this.colorPicker,this.cpWidth,this.cpHeight,this.cpDialogDisplay,this.cpFallbackColor,this.cpColorMode,this.cpCmykEnabled,this.cpAlphaChannel,this.cpOutputFormat,this.cpDisableInput,this.cpIgnoredElements,this.cpSaveClickOutside,this.cpCloseClickOutside,this.cpUseRootViewContainer,this.cpPosition,this.cpPositionOffset,this.cpPositionRelativeToArrow,this.cpPresetLabel,this.cpPresetColors,this.cpPresetColorsClass,this.cpMaxPresetColorsLength,this.cpPresetEmptyMessage,this.cpPresetEmptyMessageClass,this.cpOKButton,this.cpOKButtonClass,this.cpOKButtonText,this.cpCancelButton,this.cpCancelButtonClass,this.cpCancelButtonText,this.cpAddColorButton,this.cpAddColorButtonClass,this.cpAddColorButtonText,this.cpRemoveColorButtonClass,this.cpEyeDropper,this.elRef,this.cpExtraTemplate),this.dialog=this.cmpRef.instance,this.vcRef!==t&&this.cmpRef.changeDetectorRef.detectChanges()}}closeDialog(){this.dialog&&"popup"===this.cpDialogDisplay&&this.dialog.closeDialog()}cmykChanged(t){this.cpCmykColorChange.emit(t)}stateChanged(t){this.cpToggleChange.emit(t),t?this.colorPickerOpen.emit(this.colorPicker):this.colorPickerClose.emit(this.colorPicker)}colorChanged(t,i=!0){this.ignoreChanges=i,this.colorPickerChange.emit(t)}colorSelected(t){this.colorPickerSelect.emit(t)}colorCanceled(){this.colorPickerCancel.emit()}inputFocus(){const t=this.elRef.nativeElement,i=this.cpIgnoredElements.filter(s=>s===t);!this.cpDisabled&&!i.length&&("undefined"!=typeof document&&t===document.activeElement?this.openDialog():this.dialog&&this.dialog.show?this.closeDialog():this.openDialog())}inputChange(t){this.dialog?this.dialog.setColorFromString(t.target.value,!0):(this.colorPicker=t.target.value,this.colorPickerChange.emit(this.colorPicker))}inputChanged(t){this.cpInputChange.emit(t)}sliderChanged(t){this.cpSliderChange.emit(t)}sliderDragEnd(t){this.cpSliderDragEnd.emit(t)}sliderDragStart(t){this.cpSliderDragStart.emit(t)}presetColorsChanged(t){this.cpPresetColorsChange.emit(t)}}return n.\u0275fac=function(t){return new(t||n)(He(zr),He(f0),He(rA),He(oc),He(Ra),He(FR))},n.\u0275dir=Pn({type:n,selectors:[["","colorPicker",""]],hostBindings:function(t,i){1&t&&Vt("click",function(){return i.handleClick()})("focus",function(){return i.handleFocus()})("input",function(o){return i.handleInput(o)})},inputs:{colorPicker:"colorPicker",cpWidth:"cpWidth",cpHeight:"cpHeight",cpToggle:"cpToggle",cpDisabled:"cpDisabled",cpIgnoredElements:"cpIgnoredElements",cpFallbackColor:"cpFallbackColor",cpColorMode:"cpColorMode",cpCmykEnabled:"cpCmykEnabled",cpOutputFormat:"cpOutputFormat",cpAlphaChannel:"cpAlphaChannel",cpDisableInput:"cpDisableInput",cpDialogDisplay:"cpDialogDisplay",cpSaveClickOutside:"cpSaveClickOutside",cpCloseClickOutside:"cpCloseClickOutside",cpUseRootViewContainer:"cpUseRootViewContainer",cpPosition:"cpPosition",cpPositionOffset:"cpPositionOffset",cpPositionRelativeToArrow:"cpPositionRelativeToArrow",cpOKButton:"cpOKButton",cpOKButtonText:"cpOKButtonText",cpOKButtonClass:"cpOKButtonClass",cpCancelButton:"cpCancelButton",cpCancelButtonText:"cpCancelButtonText",cpCancelButtonClass:"cpCancelButtonClass",cpEyeDropper:"cpEyeDropper",cpPresetLabel:"cpPresetLabel",cpPresetColors:"cpPresetColors",cpPresetColorsClass:"cpPresetColorsClass",cpMaxPresetColorsLength:"cpMaxPresetColorsLength",cpPresetEmptyMessage:"cpPresetEmptyMessage",cpPresetEmptyMessageClass:"cpPresetEmptyMessageClass",cpAddColorButton:"cpAddColorButton",cpAddColorButtonText:"cpAddColorButtonText",cpAddColorButtonClass:"cpAddColorButtonClass",cpRemoveColorButtonClass:"cpRemoveColorButtonClass",cpExtraTemplate:"cpExtraTemplate"},outputs:{cpInputChange:"cpInputChange",cpToggleChange:"cpToggleChange",cpSliderChange:"cpSliderChange",cpSliderDragEnd:"cpSliderDragEnd",cpSliderDragStart:"cpSliderDragStart",colorPickerOpen:"colorPickerOpen",colorPickerClose:"colorPickerClose",colorPickerCancel:"colorPickerCancel",colorPickerSelect:"colorPickerSelect",colorPickerChange:"colorPickerChange",cpCmykColorChange:"cpCmykColorChange",cpPresetColorsChange:"cpPresetColorsChange"},exportAs:["ngxColorPicker"],features:[uo]}),n})(),t7=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({providers:[FR],imports:[[EA]]}),n})();const{isArray:n7}=Array,{getPrototypeOf:i7,prototype:r7,keys:s7}=Object;function l7(n,e){return n.reduce((t,i,s)=>(t[i]=e[s],t),{})}function c7(...n){const e=function il(n){return gt(Ss(n))?n.pop():void 0}(n),{args:t,keys:i}=function o7(n){if(1===n.length){const e=n[0];if(n7(e))return{args:e,keys:null};if(function a7(n){return n&&"object"==typeof n&&i7(n)===r7}(e)){const t=s7(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}(n),s=new Ar(o=>{const{length:l}=t;if(!l)return void o.complete();const u=new Array(l);let f=l,m=l;for(let y=0;y<l;y++){let v=!1;de(t[y]).subscribe(wn(o,x=>{v||(v=!0,m--),u[y]=x},()=>f--,void 0,()=>{(!f||!v)&&(m||o.next(i?l7(i,u):u),o.complete())}))}});return e?s.pipe(mO(e)):s}let TO=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(He(qp),He(Ra))},n.\u0275dir=Pn({type:n}),n})(),xm=(()=>{class n extends TO{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=fo(n)))(i||n)}}(),n.\u0275dir=Pn({type:n,features:[Li]}),n})();const ou=new ii("NgValueAccessor"),u7={provide:ou,useExisting:nr(()=>Ky),multi:!0};let Ky=(()=>{class n extends xm{writeValue(t){this.setProperty("checked",t)}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=fo(n)))(i||n)}}(),n.\u0275dir=Pn({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(t,i){1&t&&Vt("change",function(o){return i.onChange(o.target.checked)})("blur",function(){return i.onTouched()})},features:[Wr([u7]),Li]}),n})();const h7={provide:ou,useExisting:nr(()=>df),multi:!0},f7=new ii("CompositionEventMode");let df=(()=>{class n extends TO{constructor(t,i,s){super(t,i),this._compositionMode=s,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function d7(){const n=Yp()?Yp().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(He(qp),He(Ra),He(f7,8))},n.\u0275dir=Pn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,i){1&t&&Vt("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[Wr([h7]),Li]}),n})();const Wo=new ii("NgValidators"),pf=new ii("NgAsyncValidators");function BO(n){return null!=n}function kO(n){const e=Hp(n)?Bh(n):n;return Da(e),e}function VO(n){let e={};return n.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function UO(n,e){return e.map(t=>t(n))}function zO(n){return n.map(e=>function m7(n){return!n.validate}(e)?e:t=>e.validate(t))}function NR(n){return null!=n?function HO(n){if(!n)return null;const e=n.filter(BO);return 0==e.length?null:function(t){return VO(UO(t,e))}}(zO(n)):null}function OR(n){return null!=n?function GO(n){if(!n)return null;const e=n.filter(BO);return 0==e.length?null:function(t){return c7(UO(t,e).map(kO)).pipe(yr(VO))}}(zO(n)):null}function WO(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function BR(n){return n?Array.isArray(n)?n:[n]:[]}function US(n,e){return Array.isArray(n)?n.includes(e):n===e}function XO(n,e){const t=BR(e);return BR(n).forEach(s=>{US(t,s)||t.push(s)}),t}function YO(n,e){return BR(e).filter(t=>!US(n,t))}class KO{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=NR(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=OR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class mf extends KO{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class aa extends KO{get formDirective(){return null}get path(){return null}}let gf=(()=>{class n extends class $O{constructor(e){this._cd=e}is(e){var t,i,s;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(s=null===(i=this._cd)||void 0===i?void 0:i.control)||void 0===s?void 0:s[e])}}{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(He(mf,2))},n.\u0275dir=Pn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,i){2&t&&Bd("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))},features:[Li]}),n})();function _x(n,e){(function UR(n,e){const t=function qO(n){return n._rawValidators}(n);null!==e.validator?n.setValidators(WO(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const i=function jO(n){return n._rawAsyncValidators}(n);null!==e.asyncValidator?n.setAsyncValidators(WO(i,e.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const s=()=>n.updateValueAndValidity();WS(e._rawValidators,s),WS(e._rawAsyncValidators,s)})(n,e),e.valueAccessor.writeValue(n.value),function E7(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&JO(n,e)})}(n,e),function C7(n,e){const t=(i,s)=>{e.valueAccessor.writeValue(i),s&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function S7(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&JO(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function M7(n,e){if(e.valueAccessor.setDisabledState){const t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function WS(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function JO(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function GR(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const vx="VALID",jS="INVALID",$y="PENDING",xx="DISABLED";function qR(n){return(XS(n)?n.validators:n)||null}function nB(n){return Array.isArray(n)?NR(n):n||null}function jR(n,e){return(XS(e)?e.asyncValidators:n)||null}function iB(n){return Array.isArray(n)?OR(n):n||null}function XS(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}const XR=n=>n instanceof KR;function sB(n){return(n=>n instanceof lB)(n)?n.value:n.getRawValue()}function oB(n,e){const t=XR(n),i=n.controls;if(!(t?Object.keys(i):i).length)throw new wi(1e3,"");if(!i[e])throw new wi(1001,"")}function aB(n,e){XR(n),n._forEachChild((i,s)=>{if(void 0===e[s])throw new wi(1002,"")})}class YR{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=nB(this._rawValidators),this._composedAsyncValidatorFn=iB(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===vx}get invalid(){return this.status===jS}get pending(){return this.status==$y}get disabled(){return this.status===xx}get enabled(){return this.status!==xx}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=nB(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=iB(e)}addValidators(e){this.setValidators(XO(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(XO(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(YO(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(YO(e,this._rawAsyncValidators))}hasValidator(e){return US(this._rawValidators,e)}hasAsyncValidator(e){return US(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=$y,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=xx,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=vx,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===vx||this.status===$y)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?xx:vx}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=$y,this._hasOwnPendingAsyncValidator=!0;const t=kO(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function R7(n,e,t){if(null==e||(Array.isArray(e)||(e=e.split(t)),Array.isArray(e)&&0===e.length))return null;let i=n;return e.forEach(s=>{i=XR(i)?i.controls.hasOwnProperty(s)?i.controls[s]:null:(n=>n instanceof I7)(i)&&i.at(s)||null}),i}(this,e,".")}getError(e,t){const i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Ui,this.statusChanges=new Ui}_calculateStatus(){return this._allControlsDisabled()?xx:this.errors?jS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus($y)?$y:this._anyControlsHaveStatus(jS)?jS:vx}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){XS(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class lB extends YR{constructor(e=null,t,i){super(qR(t),jR(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),XS(t)&&t.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){GR(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){GR(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class KR extends YR{constructor(e,t,i){super(qR(t),jR(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,i={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){aB(this,e),Object.keys(e).forEach(i=>{oB(this,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((i,s)=>{i.reset(e[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,i)=>(e[i]=sB(t),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,i)=>!!i._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const i=this.controls[t];i&&e(i,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const i=this.controls[t];if(this.contains(t)&&e(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,i)=>((t.enabled||this.disabled)&&(e[i]=t.value),e))}_reduceChildren(e,t){let i=e;return this._forEachChild((s,o)=>{i=t(i,s,o)}),i}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class I7 extends YR{constructor(e,t,i){super(qR(t),jR(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,i={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){aB(this,e),e.forEach((i,s)=>{oB(this,s),this.at(s).setValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((i,s)=>{this.at(s)&&this.at(s).patchValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((i,s)=>{i.reset(e[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>sB(e))}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,i)=>!!i._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,i)=>{e(t,i)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const N7={provide:mf,useExisting:nr(()=>Dh)},hB=(()=>Promise.resolve(null))();let Dh=(()=>{class n extends mf{constructor(t,i,s,o,l){super(),this._changeDetectorRef=l,this.control=new lB,this._registered=!1,this.update=new Ui,this._parent=t,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=function HR(n,e){if(!e)return null;let t,i,s;return Array.isArray(e),e.forEach(o=>{o.constructor===df?t=o:function D7(n){return Object.getPrototypeOf(n.constructor)===xm}(o)?i=o:s=o}),s||i||t||null}(0,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function zR(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){_x(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){hB.then(()=>{var i;this.control.setValue(t,{emitViewToModelChange:!1}),null===(i=this._changeDetectorRef)||void 0===i||i.markForCheck()})}_updateDisabled(t){const i=t.isDisabled.currentValue,s=""===i||i&&"false"!==i;hB.then(()=>{var o;s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),null===(o=this._changeDetectorRef)||void 0===o||o.markForCheck()})}_getPath(t){return this._parent?function HS(n,e){return[...e.path,n]}(t,this._parent):[t]}}return n.\u0275fac=function(t){return new(t||n)(He(aa,9),He(Wo,10),He(pf,10),He(ou,10),He(oA,8))},n.\u0275dir=Pn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Wr([N7]),Li,uo]}),n})(),fB=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({}),n})();const U7={provide:ou,useExisting:nr(()=>bm),multi:!0};let bm=(()=>{class n extends xm{writeValue(t){this.setProperty("value",parseFloat(t))}registerOnChange(t){this.onChange=i=>{t(""==i?null:parseFloat(i))}}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=fo(n)))(i||n)}}(),n.\u0275dir=Pn({type:n,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(t,i){1&t&&Vt("change",function(o){return i.onChange(o.target.value)})("input",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},features:[Wr([U7]),Li]}),n})(),aX=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({imports:[[fB]]}),n})(),lX=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n}),n.\u0275inj=ao({imports:[aX]}),n})();function cX(n,e){1&n&&(De(0,"div",2),Ei(1,"div",3),Se())}let Zy=(()=>{class n{constructor(){this.active=!0}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-loading"]],inputs:{active:"active"},decls:2,vars:1,consts:[[1,"loading-wrapper"],["class","loading-ring",4,"ngIf"],[1,"loading-ring"],[1,"lds-dual-ring"]],template:function(t,i){1&t&&(De(0,"div",0),pn(1,cX,2,0,"div",1),Se()),2&t&&(Je(1),Xe("ngIf",i.active))},directives:[Yc],styles:['.loading-wrapper[_ngcontent-%COMP%]{width:100%}.loading-ring[_ngcontent-%COMP%]{position:relative;bottom:10%;left:90%;transform:translate(-50%,-50%);margin-top:30%}.lds-dual-ring[_ngcontent-%COMP%]{display:inline-block;width:80px;height:80px}.lds-dual-ring[_ngcontent-%COMP%]:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid var(--color-secondary-2-0);border-color:var(--color-secondary-2-1) transparent var(--color-secondary-2-1) transparent;animation:lds-dual-ring 1.2s linear infinite}@keyframes lds-dual-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']}),n})();function uX(n,e){if(1&n){const t=ir();De(0,"div")(1,"div",2)(2,"span"),B(3,"Element Settings"),Se()(),De(4,"div",3)(5,"div",4)(6,"label"),B(7,"Name:"),Se()(),De(8,"div",5),B(9," Potree Point Cloud "),Se()(),De(10,"div",6)(11,"div",4)(12,"label",7),B(13," Select Color:"),Se()(),De(14,"div",5)(15,"input",8),Vt("colorPickerChange",function(s){return _t(t),Fe().settings.color=s})("colorPickerChange",function(){return _t(t),Fe().setColor()}),Se()()(),De(16,"div",3)(17,"div",4)(18,"label"),B(19,"Reset Color:"),Se()(),De(20,"div",5)(21,"button",9),Vt("click",function(){return _t(t),Fe().resetColor()}),B(22,"Reset"),Se()()(),De(23,"div",3)(24,"div",4)(25,"label"),B(26,"Point Size:"),Se()(),De(27,"div",5)(28,"p",10)(29,"input",11),Vt("ngModelChange",function(s){return _t(t),Fe().settings.pointSize=s})("ngModelChange",function(){return _t(t),Fe().setPointSize()}),Se()()()(),De(30,"div",3)(31,"div",4)(32,"label"),B(33,"Bounding Box:"),Se()(),De(34,"div",5)(35,"label")(36,"input",12),Vt("change",function(){return _t(t),Fe().setBoundingBox()})("ngModelChange",function(s){return _t(t),Fe().settings.boundingBox=s}),Se(),De(37,"span"),B(38,"Show/Hide"),Se()()()()()}if(2&n){const t=Fe();Je(15),Lr("background",t.settings.color),Xe("colorPicker",t.settings.color),Je(14),Ls("min",t.options.min),Ls("max",t.options.max),Xe("value",t.settings.pointSize)("ngModel",t.settings.pointSize),Je(7),Xe("ngModel",t.settings.boundingBox)}}let hX=(()=>{class n{constructor(){this.options={min:1,max:20},this.settings={color:"#000000",pointSize:2,boundingBox:!1},this.type=Nr.UNKNOWN}set data(t){this._data=t,this.pcos=[],t.forEach(i=>{var s;let o=i.element;null===(s=this.pcos)||void 0===s||s.push(o),this.type=i.sceneType,this.settings.color="#"+o.material.uniforms.uColor.value.getHexString()})}get data(){return this._data?this._data:[]}ngOnInit(){}setPointSize(){var t;null===(t=this.pcos)||void 0===t||t.forEach(i=>{i.material.size=eu.logRange(.1,10,this.options.min,this.options.max,this.settings.pointSize)})}setColor(){var t;null===(t=this.pcos)||void 0===t||t.forEach(i=>{i.material.pointColorType=fR.PointColorType.COLOR,i.material.uniforms.uColor.value.set(new Ut(this.settings.color))})}resetColor(){var t;null===(t=this.pcos)||void 0===t||t.forEach(i=>{i.material.pointColorType=fR.PointColorType.RGB})}setBoundingBox(){var t;null===(t=this.pcos)||void 0===t||t.forEach(i=>{i.showBoundingBox=this.settings.boundingBox})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-pco-settings"]],inputs:{data:"data"},decls:3,vars:2,consts:[[4,"ngIf"],[3,"active"],[1,"title-divider"],[1,"row"],[1,"col","s4","description"],[1,"col","s8"],[1,"row","pc-color-picker"],["for","pc-color-picker"],["id","pc-color-picker",3,"colorPicker","colorPickerChange"],[1,"waves-effect","btn-small",3,"click"],[1,"range-field"],["type","range",3,"min","max","value","ngModel","ngModelChange"],["type","checkbox",1,"checkbox-blue","filled-in",3,"ngModel","change","ngModelChange"]],template:function(t,i){1&t&&(pn(0,uX,39,8,"div",0),De(1,"div"),Ei(2,"app-loading",1),Se()),2&t&&(Xe("ngIf",i.pcos),Je(2),Xe("active",!i.pcos))},directives:[Yc,yx,bm,df,gf,Dh,Ky,Zy],styles:["",".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.pc-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}"]}),n})(),RB=(()=>{class n extends qy{constructor(){super(),this.data={width:1}}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-col"]],inputs:{data:"data"},features:[Li],decls:3,vars:4,consts:[[1,"col-app-base-wrapper"],[3,"children"]],template:function(t,i){1&t&&(De(0,"div")(1,"div",0),Ei(2,"app-base",1),Se()()),2&t&&(dt("col s",i.data.width,""),Je(2),Xe("children",i.children))},styles:[".col-app-base-wrapper[_ngcontent-%COMP%]{overflow-x:clip;overflow-y:auto;max-height:99vh;padding-right:1rem}"]}),n})(),PB=(()=>{class n extends qy{constructor(){super(),this.data={}}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-row"]],inputs:{data:"data"},features:[Li],decls:2,vars:1,consts:[[1,"row"],[3,"children"]],template:function(t,i){1&t&&(De(0,"div",0),Ei(1,"app-base",1),Se()),2&t&&(Je(1),Xe("children",i.children))},styles:[""]}),n})();function dX(n,e){if(1&n){const t=ir();De(0,"div")(1,"div",3)(2,"div",4)(3,"label",5),B(4,"Scene Id:"),Se()(),De(5,"div",6),B(6),Se()(),De(7,"div",3)(8,"div",4)(9,"label",5),B(10,"Select Background Color:"),Se()(),De(11,"div",6)(12,"input",7),Vt("colorPickerChange",function(s){return _t(t),Fe().backgroundColor=s})("colorPickerChange",function(){return _t(t),Fe().changeBackground()}),Se()()(),De(13,"div",3)(14,"div",4)(15,"label"),B(16),SM(17,"number"),Se()(),De(18,"div",6)(19,"p",8)(20,"input",9),Vt("ngModelChange",function(s){return _t(t),Fe().pointBudget=s})("ngModelChange",function(){return _t(t),Fe().onPointBudgetChange()}),Se()()()(),De(21,"div",3)(22,"div",4)(23,"label"),B(24),Se()(),De(25,"div",6)(26,"p",8)(27,"input",9),Vt("ngModelChange",function(s){return _t(t),Fe().fov=s})("ngModelChange",function(){return _t(t),Fe().onFovChange()}),Se()()()(),De(28,"div",3)(29,"div",4)(30,"label"),B(31,"Activate Camera Sync:"),Se()(),De(32,"div",6),Ei(33,"input",10),De(34,"span",11),Vt("click",function(){return _t(t),Fe().onCameraSync()}),B(35,"Toggle"),Se()()(),De(36,"div",3)(37,"div",4)(38,"label"),B(39,"Start Animation:"),Se()(),De(40,"div",6)(41,"button",12),Vt("click",function(){return _t(t),Fe().onStartAnimation()}),B(42,"Start Animation"),Se()()()()}if(2&n){const t=Fe();Je(6),H(" ",t.data.sceneId," "),Je(6),Lr("background",t.backgroundColor),Xe("colorPicker",t.backgroundColor),Je(4),H("Point Budget (",NI(17,17,t.pointBudget,"1.0-0","en-US"),"):"),Je(4),Ls("min",t.pointBudgetOptions.min),Ls("max",t.pointBudgetOptions.max),Ls("step",t.pointBudgetOptions.step),Xe("value",t.pointBudget)("ngModel",t.pointBudget),Je(4),H("Camera FOV (",t.fov,"):"),Je(3),Ls("min",t.fovOptions.min),Ls("max",t.fovOptions.max),Ls("step",t.fovOptions.step),Xe("value",t.fov)("ngModel",t.fov),Je(6),Xe("checked",t.cameraSync)}}let fX=(()=>{class n{constructor(t,i){this.ws=t,this.sceneElementsService=i,this.pointBudgetOptions={min:1e5,max:2e8,step:25e3},this.fovOptions={min:45,max:120,step:5},this.pointBudget=1e6,this.fov=60,this.backgroundColor="#FFFFFF",this.cameraSync=!1,this._data={sceneId:-1}}set data(t){this._data=t,this.loadViewer()}get data(){return this._data}ngOnInit(){}onPointBudgetChange(){var t;null===(t=this.viewer)||void 0===t||t.setPointBudget(this.pointBudget)}changeBackground(){var t;null===(t=this.viewer)||void 0===t||t.changeBackground(this.backgroundColor)}onFovChange(){var t;null===(t=this.viewer)||void 0===t||t.setCameraFOV(this.fov)}onCameraSync(){var t;this.cameraSync=!this.cameraSync,null===(t=this.viewer)||void 0===t||t.setCameraSync(this.cameraSync)}onStartAnimation(){this.cameraSync||this.onCameraSync(),this.ws.startAnimation(this.data.sceneId,"animation_1")}pickerTest(){var t;null===(t=this.viewer)||void 0===t||t.pickPointTest()}loadViewer(){this.sceneElementsService.getViewerData().subscribe(t=>{t.has(this.data.sceneId)&&setTimeout(()=>{var i;this.viewer=null===(i=t.get(this.data.sceneId))||void 0===i?void 0:i.viewer,this.changeBackground()})})}}return n.\u0275fac=function(t){return new(t||n)(He(wR),He(YM))},n.\u0275cmp=Ts({type:n,selectors:[["app-general-settings"]],inputs:{data:"data"},decls:6,vars:2,consts:[[1,"title-divider"],[4,"ngIf"],[3,"active"],[1,"row"],[1,"col","s4","description"],["for","background-color"],[1,"col","s8"],["id","background-color",3,"colorPicker","colorPickerChange"],[1,"range-field"],["type","range",3,"min","max","step","value","ngModel","ngModelChange"],["type","checkbox",1,"filled-in","checkbox-blue",3,"checked"],[3,"click"],[1,"waves-effect","btn-small",3,"click"]],template:function(t,i){1&t&&(De(0,"div",0)(1,"span"),B(2,"Scene Settings"),Se()(),pn(3,dX,43,21,"div",1),De(4,"div"),Ei(5,"app-loading",2),Se()),2&t&&(Je(3),Xe("ngIf",i.viewer),Je(2),Xe("active",!i.viewer))},directives:[Yc,yx,bm,df,gf,Dh,Zy],pipes:[jL],styles:["",".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.pc-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}"]}),n})();function pX(n,e){if(1&n){const t=ir();De(0,"div")(1,"app-group",8),Vt("selectedElementEvent",function(s){return _t(t),Fe(2).setSelectedElement(s)}),Se()()}if(2&n){const t=e.$implicit,i=Fe(2);Je(1),Xe("sceneId",i.sceneId)("data",t)}}function mX(n,e){if(1&n&&(De(0,"div"),pn(1,pX,2,2,"div",7),Se()),2&n){const t=Fe();Je(1),Xe("ngForOf",t.groups)}}function gX(n,e){1&n&&Ei(0,"app-pco-settings",9),2&n&&Xe("data",Fe().selectedElement[1])}function yX(n,e){1&n&&Ei(0,"app-camera-trajectory-settings",9),2&n&&Xe("data",Fe().selectedElement[1])}function _X(n,e){1&n&&Ei(0,"app-default-pc-settings",9),2&n&&Xe("data",Fe().selectedElement[1])}function vX(n,e){1&n&&Ei(0,"app-line-set-settings",9),2&n&&Xe("data",Fe().selectedElement[1])}function xX(n,e){1&n&&Ei(0,"div")}function bX(n,e){if(1&n&&(De(0,"div",10),B(1),Se()),2&n){const t=Fe();Je(1),H("No settings found for '",t.parseToEnum(t.selectedElement[0]),"'")}}let IB=(()=>{class n{constructor(){this.elem=Nr,this.sceneId=-1,this.selectedElement=[Nr.UNKNOWN,[]],this.groups=[],this._data={sceneId:-1,groups:[]}}set data(t){this.sceneId=t.sceneId,this.groups=t.groups,this._data=t}get data(){return this._data}setSelectedElement(t){this.selectedElement[0]===t[0]&&this.selectedElement[1]===t[1]||(this.selectedElement=t)}ngOnInit(){}parseToEnum(t){return eu.enumFromStringValue(Nr,t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-element-tree"]],inputs:{data:"data"},decls:13,vars:8,consts:[[1,"title-divider"],[4,"ngIf"],[3,"active"],[3,"ngSwitch"],[3,"data",4,"ngSwitchCase"],[4,"ngSwitchCase"],["style","color:red;",4,"ngSwitchDefault"],[4,"ngFor","ngForOf"],[3,"sceneId","data","selectedElementEvent"],[3,"data"],[2,"color","red"]],template:function(t,i){1&t&&(De(0,"div",0)(1,"span"),B(2,"Scene Elements"),Se()(),pn(3,mX,2,1,"div",1),De(4,"div"),Ei(5,"app-loading",2),Se(),De(6,"div",3),pn(7,gX,1,1,"app-pco-settings",4),pn(8,yX,1,1,"app-camera-trajectory-settings",4),pn(9,_X,1,1,"app-default-pc-settings",4),pn(10,vX,1,1,"app-line-set-settings",4),pn(11,xX,1,0,"div",5),pn(12,bX,2,1,"div",6),Se()),2&t&&(Je(3),Xe("ngIf",i.groups),Je(2),Xe("active",!i.groups),Je(1),Xe("ngSwitch",i.parseToEnum(i.selectedElement[0])),Je(1),Xe("ngSwitchCase",i.elem.POTREE_POINT_CLOUD),Je(1),Xe("ngSwitchCase",i.elem.CAMERA_TRAJECTORY),Je(1),Xe("ngSwitchCase",i.elem.DEFAULT_POINT_CLOUD),Je(1),Xe("ngSwitchCase",i.elem.LINE_SET),Je(1),Xe("ngSwitchCase",i.elem.UNKNOWN))},styles:[".element-tree-element[_ngcontent-%COMP%]{margin-bottom:5px}"]}),n})();function wX(n,e){if(1&n){const t=ir();De(0,"div")(1,"div",2)(2,"span"),B(3,"Element Settings"),Se()(),De(4,"div",3)(5,"div",4)(6,"label"),B(7,"Name:"),Se()(),De(8,"div",5),B(9," Camera Trajectory "),Se()(),De(10,"div",6)(11,"div",4)(12,"label",7),B(13," Select Color:"),Se()(),De(14,"div",5)(15,"input",8),Vt("colorPickerChange",function(s){return _t(t),Fe().settings.color=s})("colorPickerChange",function(){return _t(t),Fe().setColor()}),Se()()(),De(16,"div",3)(17,"div",4)(18,"label"),B(19,"Frustum Size:"),Se()(),De(20,"div",5)(21,"p",9)(22,"input",10),Vt("ngModelChange",function(s){return _t(t),Fe().settings.size=s})("ngModelChange",function(){return _t(t),Fe().setFrustumSize()}),Se()()()(),De(23,"div",3)(24,"div",4)(25,"label"),B(26,"Line Width:"),Se()(),De(27,"div",5)(28,"p",9)(29,"input",10),Vt("ngModelChange",function(s){return _t(t),Fe().settings.lineWidth=s})("ngModelChange",function(){return _t(t),Fe().setLineWidth()}),Se()()()(),De(30,"div",3)(31,"div",4)(32,"label"),B(33,"Show Image:"),Se()(),De(34,"div",5)(35,"label")(36,"input",11),Vt("change",function(){return _t(t),Fe().setMeshVisibility()})("ngModelChange",function(s){return _t(t),Fe().settings.meshVisible=s}),Se(),De(37,"span"),B(38,"Show/Hide"),Se()()()()()}if(2&n){const t=Fe();Je(15),Lr("background",t.settings.color),Xe("colorPicker",t.settings.color),Je(7),Ls("min",t.options.min),Ls("max",t.options.max),Xe("value",t.settings.size)("ngModel",t.settings.size),Je(7),Ls("min",t.options.min),Ls("max",t.options.max/2),Xe("value",t.settings.lineWidth)("ngModel",t.settings.lineWidth),Je(7),Xe("ngModel",t.settings.meshVisible)}}let MX=(()=>{class n{constructor(){this.options={min:1,max:20},this.settings={size:1,color:"#000000",meshVisible:!1,lineWidth:.002},this.type=Nr.UNKNOWN}set data(t){var i;this._data=t,this.cameraTrajectories=[],null===(i=this._data)||void 0===i||i.forEach(s=>{var o;let l=s.element;this.settings.color="#"+l.getColor().getHexString(),null===(o=this.cameraTrajectories)||void 0===o||o.push(l),this.type=s.sceneType})}get data(){return this._data?this._data:[]}ngOnInit(){}setColor(){var t;null===(t=this.cameraTrajectories)||void 0===t||t.forEach(i=>{i.setColor(this.settings.color)})}setFrustumSize(){var t;null===(t=this.cameraTrajectories)||void 0===t||t.forEach(i=>{let s=eu.logRange(.1,1.5,this.options.min,this.options.max,this.settings.size);i.setSize(s)})}setMeshVisibility(){var t;null===(t=this.cameraTrajectories)||void 0===t||t.forEach(i=>{i.mesh.visible=this.settings.meshVisible})}setLineWidth(){var t;null===(t=this.cameraTrajectories)||void 0===t||t.forEach(i=>{i.setLineWidth(this.settings.lineWidth/1e3)})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-camera-trajectory-settings"]],inputs:{data:"data"},decls:3,vars:2,consts:[[4,"ngIf"],[3,"active"],[1,"title-divider"],[1,"row"],[1,"col","s4","description"],[1,"col","s8"],[1,"row","pc-color-picker"],["for","pc-color-picker"],["id","pc-color-picker",3,"colorPicker","colorPickerChange"],[1,"range-field"],["type","range",3,"min","max","value","ngModel","ngModelChange"],["type","checkbox",1,"checkbox-blue","filled-in",3,"ngModel","change","ngModelChange"]],template:function(t,i){1&t&&(pn(0,wX,39,12,"div",0),De(1,"div"),Ei(2,"app-loading",1),Se()),2&t&&(Xe("ngIf",i.cameraTrajectories),Je(2),Xe("active",!i.cameraTrajectories))},directives:[Yc,yx,bm,df,gf,Dh,Ky,Zy],styles:["",".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.pc-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}"]}),n})();function EX(n,e){if(1&n){const t=ir();De(0,"div")(1,"div",2)(2,"span"),B(3,"Element Settings"),Se()(),De(4,"div",3)(5,"div",4)(6,"label"),B(7,"Name:"),Se()(),De(8,"div",5),B(9," Default Point Cloud "),Se()(),De(10,"div",6)(11,"div",4)(12,"label",7),B(13," Select Color:"),Se()(),De(14,"div",5)(15,"input",8),Vt("colorPickerChange",function(s){return _t(t),Fe().settings.color=s})("colorPickerChange",function(){return _t(t),Fe().setColor()}),Se()()(),De(16,"div",3)(17,"div",4)(18,"label"),B(19,"Reset Color:"),Se()(),De(20,"div",5)(21,"button",9),Vt("click",function(){return _t(t),Fe().resetColor()}),B(22,"Reset"),Se()()(),De(23,"div",3)(24,"div",4)(25,"label"),B(26),Se()(),De(27,"div",5)(28,"p",10)(29,"input",11),Vt("ngModelChange",function(s){return _t(t),Fe().settings.pointSize=s})("ngModelChange",function(){return _t(t),Fe().setPointSize()}),Se()()()()()}if(2&n){const t=Fe();Je(15),Lr("background",t.settings.color),Xe("colorPicker",t.settings.color),Je(11),H("Point Size (",t.settings.pointSize,"):"),Je(3),Ls("min",t.options.min),Ls("max",t.options.max),Xe("value",t.settings.pointSize)("ngModel",t.settings.pointSize)}}let SX=(()=>{class n{constructor(){this.options={min:1,max:20},this.settings={color:"#000000",pointSize:2,boundingBox:!1},this.type=Nr.UNKNOWN}set data(t){this._data=t,this.pcs=[],t.forEach(i=>{var s;let o=i.element;this.settings.color="#"+o.getColor().getHexString(),null===(s=this.pcs)||void 0===s||s.push(o),this.type=i.sceneType})}get data(){return this._data?this._data:[]}ngOnInit(){}setPointSize(){var t;null===(t=this.pcs)||void 0===t||t.forEach(i=>{let s=eu.logRange(.1,10,this.options.min,this.options.max,this.settings.pointSize);i.setPointSize(s)})}setColor(){var t;null===(t=this.pcs)||void 0===t||t.forEach(i=>{i.setColor(this.settings.color)})}resetColor(){var t;null===(t=this.pcs)||void 0===t||t.forEach(i=>{i.resetColor()})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-default-pc-settings"]],inputs:{data:"data"},decls:3,vars:2,consts:[[4,"ngIf"],[3,"active"],[1,"title-divider"],[1,"row"],[1,"col","s4","description"],[1,"col","s8"],[1,"row","pc-color-picker"],["for","pc-color-picker"],["id","pc-color-picker",3,"colorPicker","colorPickerChange"],[1,"waves-effect","btn-small",3,"click"],[1,"range-field"],["type","range",3,"min","max","value","ngModel","ngModelChange"]],template:function(t,i){1&t&&(pn(0,EX,30,8,"div",0),De(1,"div"),Ei(2,"app-loading",1),Se()),2&t&&(Xe("ngIf",i.pcs),Je(2),Xe("active",!i.pcs))},directives:[Yc,yx,bm,df,gf,Dh,Zy],styles:["",".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.pc-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}"]}),n})();function CX(n,e){if(1&n){const t=ir();De(0,"div")(1,"div",2)(2,"span"),B(3,"Element Settings"),Se()(),De(4,"div",3)(5,"div",4)(6,"label"),B(7,"Name:"),Se()(),De(8,"div",5),B(9," Line Set "),Se()(),De(10,"div",6)(11,"div",4)(12,"label",7),B(13,"Select Color:"),Se()(),De(14,"div",5)(15,"input",8),Vt("colorPickerChange",function(s){return _t(t),Fe().settings.color=s})("colorPickerChange",function(){return _t(t),Fe().setColor()}),Se()()(),De(16,"div",3)(17,"div",4)(18,"label"),B(19,"Line Width:"),Se()(),De(20,"div",5)(21,"p",9)(22,"input",10),Vt("ngModelChange",function(s){return _t(t),Fe().settings.lineWidth=s})("ngModelChange",function(){return _t(t),Fe().setLineWidth()}),Se()()()()()}if(2&n){const t=Fe();Je(15),Lr("background",t.settings.color),Xe("colorPicker",t.settings.color),Je(7),Ls("min",t.options.min),Ls("max",t.options.max),Xe("value",t.settings.lineWidth)("ngModel",t.settings.lineWidth)}}let TX=(()=>{class n{constructor(){this.settings={color:"#000000",lineWidth:.002},this.options={min:1,max:20},this.type=Nr.UNKNOWN}set data(t){this._data=t,this.lineSets=[],t.forEach(i=>{var s;let o=i.element;this.settings.color="#"+o.material.color.getHexString(),null===(s=this.lineSets)||void 0===s||s.push(o),this.type=i.sceneType})}get data(){return this._data?this._data:[]}ngOnInit(){}setColor(){var t;null===(t=this.lineSets)||void 0===t||t.forEach(i=>{i.setColor(this.settings.color)})}setLineWidth(){var t;null===(t=this.lineSets)||void 0===t||t.forEach(i=>{i.setLineWidth(this.settings.lineWidth/1e3)})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-line-set-settings"]],inputs:{data:"data"},decls:3,vars:2,consts:[[4,"ngIf"],[3,"active"],[1,"title-divider"],[1,"row"],[1,"col","s4","description"],[1,"col","s8"],[1,"row","pc-color-picker"],["for","pc-color-picker"],["id","pc-color-picker",3,"colorPicker","colorPickerChange"],[1,"range-field"],["type","range",3,"min","max","value","ngModel","ngModelChange"]],template:function(t,i){1&t&&(pn(0,CX,23,7,"div",0),De(1,"div"),Ei(2,"app-loading",1),Se()),2&t&&(Xe("ngIf",i.lineSets),Je(2),Xe("active",!i.lineSets))},directives:[Yc,yx,bm,df,gf,Dh,Zy],styles:["",".description[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1rem}.pc-color-picker[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:1.5rem;border-bottom:none}.range-field[_ngcontent-%COMP%]{margin:2px}input[type=range][_ngcontent-%COMP%]{border:none;margin:0}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{background-color:var(--color-secondary-1-1)}input[type=range][_ngcontent-%COMP%]::-ms-thumb{background-color:var(--color-secondary-1-1)}.checkbox-blue-grey[type=checkbox].filled-in[_ngcontent-%COMP%]:checked + span[_ngcontent-%COMP%]:not(.lever):after{border:2px solid var(--color-secondary-1-1);background-color:var(--color-secondary-1-1)}"]}),n})(),AX=(()=>{class n{transform(t){let i=t.toString().split("_"),s="";return i.forEach(o=>{s+=o[0].toUpperCase()+o.slice(1)+" "}),s}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=wo({name:"enumToReadableString",type:n,pure:!0}),n})(),DX=(()=>{class n{constructor(){this.selectedElementEvent=new Ui,this.visible=!0,this.elements=[],this.elementType=Nr.UNKNOWN}ngOnInit(){}loadElementSettings(){this.selectedElementEvent.emit([this.elementType,this.elements])}setAllSceneElementsVisibility(t){this.elements.forEach(i=>{this.setSceneElementVisibility(i.elementId,t)})}setSceneElementVisibility(t,i){let s=this.getElement(this.elements,t);if(null!=s)switch(eu.enumFromStringValue(Nr,s.sceneType)){case Nr.POTREE_POINT_CLOUD:case Nr.DEFAULT_POINT_CLOUD:s.element.visible=i;break;case Nr.LINE_SET:case Nr.CAMERA_TRAJECTORY:s.element.setVisibility(i)}}getVisibility(){return this.elements.forEach(t=>{var i;let s=null===(i=t.element)||void 0===i?void 0:i.visible;return void 0!==s&&s}),!1}getElement(t,i){let s;return t.forEach(o=>{o.elementId===i&&(s=o)}),s}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Ts({type:n,selectors:[["app-entry"]],inputs:{elementType:"elementType",elements:"elements",visible:"visible"},outputs:{selectedElementEvent:"selectedElementEvent"},decls:6,vars:5,consts:[[1,"element-group","single-element",3,"click"],["type","checkbox",1,"filled-in","checkbox-blue",3,"ngModel","checked","ngModelChange","change"]],template:function(t,i){1&t&&(De(0,"div",0),Vt("click",function(){return i.loadElementSettings()}),De(1,"label")(2,"input",1),Vt("ngModelChange",function(o){return i.visible=o})("change",function(){return i.setAllSceneElementsVisibility(i.visible)}),Se(),De(3,"span"),B(4),SM(5,"enumToReadableString"),Se()()()),2&t&&(Je(2),Xe("ngModel",i.visible)("checked",i.getVisibility()),Je(2),j(O1(5,3,i.elementType)))},directives:[Ky,gf,Dh],pipes:[AX],styles:[".element-list[_ngcontent-%COMP%]{margin-left:30px}.element-list[_ngcontent-%COMP%] > ul[_ngcontent-%COMP%]{margin:0}.single-element[_ngcontent-%COMP%]{padding:3px}.single-element[_ngcontent-%COMP%]:hover, .highlight[_ngcontent-%COMP%]{background-color:var(--color-black)}"]}),n})();function RX(n,e){if(1&n){const t=ir();De(0,"div",3)(1,"app-group",4),Vt("selectedElementEvent",function(s){return _t(t),Fe(2).setSelectedElement(s)}),Se()()}if(2&n){const t=e.$implicit,i=Fe(2);Je(1),Xe("sceneId",i.sceneId)("data",t)}}function PX(n,e){if(1&n){const t=ir();De(0,"div",3)(1,"app-entry",5),Vt("selectedElementEvent",function(s){return _t(t),Fe(3).setSelectedElement(s)}),Se()()}if(2&n){const t=e.$implicit,i=Fe(3);Je(1),Xe("elementType",t.key)("elements",t.value)("visible",i.data.visible)}}function IX(n,e){if(1&n&&(De(0,"div"),pn(1,PX,2,3,"div",2),SM(2,"keyvalue"),Se()),2&n){const t=Fe(2);Je(1),Xe("ngForOf",O1(2,1,t.groupedTypes))}}function LX(n,e){if(1&n){const t=ir();De(0,"div")(1,"label")(2,"input",1),Vt("ngModelChange",function(s){return _t(t),Fe().data.visible=s})("change",function(){_t(t);const s=Fe();return s.setAllSceneElementsVisibility(s.data.visible)}),Se(),De(3,"span"),B(4),Se()(),pn(5,RX,2,2,"div",2),pn(6,IX,3,3,"div",0),Se()}if(2&n){const t=Fe();Je(2),Xe("ngModel",t.data.visible),Je(2),j(t.data.name),Je(1),Xe("ngForOf",t.data.groups),Je(1),Xe("ngIf",t.groupedTypes.size>0)}}let FX=(()=>{class n{constructor(t){this.sceneElementsService=t,this.groupedTypes=new Map,this.selectedElementEvent=new Ui,this.sceneId=-1,this._data={groupId:-1,name:"Unknown",ids:[],groups:[],visible:!1}}set data(t){this._data=t}get data(){return this._data}ngOnInit(){0!=this._data.ids.length&&this.loadComponents(this._data.ids)}setAllSceneElementsVisibility(t){this.setGroupVisibility([this.data],t)}setGroupVisibility(t,i){t.map(s=>{var o;s.visible=i,null===(o=s.sceneElements)||void 0===o||o.map(l=>{this.setSceneElementVisibility(l,i)}),this.setGroupVisibility(s.groups,i)})}setSceneElementVisibility(t,i){switch(eu.enumFromStringValue(Nr,t.sceneType)){case Nr.POTREE_POINT_CLOUD:case Nr.DEFAULT_POINT_CLOUD:t.element.visible=i;break;case Nr.LINE_SET:case Nr.CAMERA_TRAJECTORY:t.element.setVisibility(i)}}setSelectedElement(t){this.selectedElementEvent.emit(t)}parseToElementTree(t){return t.map(i=>{var s;this.groupedTypes.has(i.sceneType)||this.groupedTypes.set(i.sceneType,[]),null===(s=this.groupedTypes.get(i.sceneType))||void 0===s||s.push(i)}),this.groupedTypes}loadComponents(t){this.sceneElementsService.getViewerData().subscribe(i=>{this._data.sceneElements=[];let s=i.get(this.sceneId);s&&(s.elements.map(o=>{var l;t.includes(o.elementId)&&(null===(l=this._data.sceneElements)||void 0===l||l.push(o))}),setTimeout(()=>{this._data.sceneElements&&this.parseToElementTree(this._data.sceneElements)}))})}}return n.\u0275fac=function(t){return new(t||n)(He(YM))},n.\u0275cmp=Ts({type:n,selectors:[["app-group"]],inputs:{sceneId:"sceneId",data:"data"},outputs:{selectedElementEvent:"selectedElementEvent"},decls:1,vars:1,consts:[[4,"ngIf"],["type","checkbox",1,"filled-in","checkbox-blue",3,"ngModel","ngModelChange","change"],["class","element-group",4,"ngFor","ngForOf"],[1,"element-group"],[3,"sceneId","data","selectedElementEvent"],[3,"elementType","elements","visible","selectedElementEvent"]],template:function(t,i){1&t&&pn(0,LX,7,4,"div",0),2&t&&Xe("ngIf",i.data)},directives:[Yc,Ky,gf,Dh,C0,n,DX],pipes:[WL],styles:[".element-group[_ngcontent-%COMP%]{margin-left:30px;padding:5px}.element-group[_ngcontent-%COMP%] > .element-group[_ngcontent-%COMP%]{margin-left:30px}"]}),n})();const NX={url:`http://127.0.0.1:${I0_port}`,options:{transports:["websocket","polling"]}};let OX=(()=>{class n{constructor(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=$s({type:n,bootstrap:[Mq]}),n.\u0275inj=ao({providers:[OA],imports:[[Zz,t7,lX,DH,pj.forRoot(NX),f9.forRoot(),Mj,Sj]]}),n})();Af(qy,[C0,T0,bA,RB,PB,m9,fX,IB],[]),Af(RB,[qy],[]),Af(PB,[qy],[]),Af(IB,[Yc,C0,FX,Zy,T0,bA,hX,MX,SX,TX,zL],[]),function XV(){yL=!1}(),Kz().bootstrapModule(OX).catch(n=>console.error(n))},765:(xo,O,ro)=>{var so;window,xo.exports=(so=ro(712),function(ar){var gt={};function Et(cn){if(gt[cn])return gt[cn].exports;var Qt=gt[cn]={i:cn,l:!1,exports:{}};return ar[cn].call(Qt.exports,Qt,Qt.exports,Et),Qt.l=!0,Qt.exports}return Et.m=ar,Et.c=gt,Et.d=function(cn,Qt,Dn){Et.o(cn,Qt)||Object.defineProperty(cn,Qt,{enumerable:!0,get:Dn})},Et.r=function(cn){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(cn,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(cn,"__esModule",{value:!0})},Et.t=function(cn,Qt){if(1&Qt&&(cn=Et(cn)),8&Qt||4&Qt&&"object"==typeof cn&&cn&&cn.__esModule)return cn;var Dn=Object.create(null);if(Et.r(Dn),Object.defineProperty(Dn,"default",{enumerable:!0,value:cn}),2&Qt&&"string"!=typeof cn)for(var ai in cn)Et.d(Dn,ai,function(ji){return cn[ji]}.bind(null,ai));return Dn},Et.n=function(cn){var Qt=cn&&cn.__esModule?function(){return cn.default}:function(){return cn};return Et.d(Qt,"a",Qt),Qt},Et.o=function(cn,Qt){return Object.prototype.hasOwnProperty.call(cn,Qt)},Et.p="",Et(Et.s=8)}([function(ar,gt){ar.exports=so},function(ar,gt,Et){"use strict";function cn(Qt){this.content=[],this.scoreFunction=Qt}Object.defineProperty(gt,"__esModule",{value:!0}),gt.BinaryHeap=cn,cn.prototype={push:function(Qt){this.content.push(Qt),this.bubbleUp(this.content.length-1)},pop:function(){var Qt=this.content[0],Dn=this.content.pop();return this.content.length>0&&(this.content[0]=Dn,this.sinkDown(0)),Qt},remove:function(Qt){for(var Dn=this.content.length,ai=0;ai<Dn;ai++)if(this.content[ai]==Qt){var ji=this.content.pop();if(ai==Dn-1)break;this.content[ai]=ji,this.bubbleUp(ai),this.sinkDown(ai);break}},size:function(){return this.content.length},bubbleUp:function(Qt){for(var Dn=this.content[Qt],ai=this.scoreFunction(Dn);Qt>0;){var ji=Math.floor((Qt+1)/2)-1,gi=this.content[ji];if(ai>=this.scoreFunction(gi))break;this.content[ji]=Dn,this.content[Qt]=gi,Qt=ji}},sinkDown:function(Qt){for(var Dn=this.content.length,ai=this.content[Qt],ji=this.scoreFunction(ai);;){var gi=2*(Qt+1),Xs=gi-1,gr=null;if(Xs<Dn){var es=this.scoreFunction(this.content[Xs]);es<ji&&(gr=Xs)}if(gi<Dn&&this.scoreFunction(this.content[gi])<(null==gr?ji:es)&&(gr=gi),null==gr)break;this.content[Qt]=this.content[gr],this.content[gr]=ai,Qt=gr}}}},function(ar,gt,Et){"use strict";Et.r(gt),gt.default="precision highp float;\r\nprecision highp int;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv;\r\n\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n\r\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n}"},function(ar,gt,Et){"use strict";Et.r(gt),gt.default="precision highp float;\r\nprecision highp int;\r\n\r\nuniform mat4 projectionMatrix;\r\n\r\nuniform float screenWidth;\r\nuniform float screenHeight;\r\n\r\nuniform sampler2D map;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tfloat dx = 1.0 / screenWidth;\r\n\tfloat dy = 1.0 / screenHeight;\r\n\r\n\tvec3 color = vec3(0.0, 0.0, 0.0);\r\n\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;\r\n\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;\r\n    \r\n\tcolor = color / 9.0;\r\n\t\r\n\tgl_FragColor = vec4(color, 1.0);\r\n\t\r\n\t\r\n}"},function(ar,gt,Et){"use strict";Et.r(gt),gt.default="precision highp float;\r\nprecision highp int;\r\n\r\n#define max_clip_boxes 30\r\n\r\nattribute vec3 position;\r\nattribute vec3 color;\r\nattribute vec3 normal;\r\nattribute float intensity;\r\nattribute float classification;\r\nattribute float returnNumber;\r\nattribute float numberOfReturns;\r\nattribute float pointSourceID;\r\nattribute vec4 indices;\r\nattribute vec2 uv;\r\n\r\nuniform mat4 modelMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat3 normalMatrix;\r\n\r\nuniform float pcIndex;\r\n\r\nuniform float screenWidth;\r\nuniform float screenHeight;\r\nuniform float fov;\r\nuniform float spacing;\r\n\r\n#if defined use_clip_box\r\n\tuniform mat4 clipBoxes[max_clip_boxes];\r\n#endif\r\n\r\nuniform float heightMin;\r\nuniform float heightMax;\r\nuniform float size; // pixel size factor\r\nuniform float minSize; // minimum pixel size\r\nuniform float maxSize; // maximum pixel size\r\nuniform float octreeSize;\r\nuniform vec3 bbSize;\r\nuniform vec3 uColor;\r\nuniform float opacity;\r\nuniform float clipBoxCount;\r\nuniform float level;\r\nuniform float vnStart;\r\nuniform bool isLeafNode;\r\n\r\nuniform float filterByNormalThreshold;\r\nuniform vec2 intensityRange;\r\nuniform float opacityAttenuation;\r\nuniform float intensityGamma;\r\nuniform float intensityContrast;\r\nuniform float intensityBrightness;\r\nuniform float rgbGamma;\r\nuniform float rgbContrast;\r\nuniform float rgbBrightness;\r\nuniform float transition;\r\nuniform float wRGB;\r\nuniform float wIntensity;\r\nuniform float wElevation;\r\nuniform float wClassification;\r\nuniform float wReturnNumber;\r\nuniform float wSourceID;\r\n\r\nuniform sampler2D visibleNodes;\r\nuniform sampler2D gradient;\r\nuniform sampler2D classificationLUT;\r\nuniform sampler2D depthMap;\r\n\r\n#ifdef use_texture_blending\r\n\tuniform sampler2D backgroundMap;\r\n#endif\r\n\r\n#ifdef use_point_cloud_mixing\r\n\tuniform int pointCloudMixingMode;\r\n\tuniform float pointCloudID;\r\n\r\n\tuniform float pointCloudMixAngle;\r\n\tuniform float stripeDistanceX;\r\n\tuniform float stripeDistanceY;\r\n\r\n\tuniform float stripeDivisorX;\r\n\tuniform float stripeDivisorY;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tuniform vec3 highlightedPointCoordinate;\r\n\tuniform bool enablePointHighlighting;\r\n\tuniform float highlightedPointScale;\r\n#endif\r\n\r\n#ifdef use_filter_by_normal\r\n\tuniform int normalFilteringMode;\r\n#endif\r\n\r\nvarying vec3 vColor;\r\n\r\n#if !defined(color_type_point_index)\r\n\tvarying float vOpacity;\r\n#endif\r\n\r\n#if defined(weighted_splats)\r\n\tvarying float vLinearDepth;\r\n#endif\r\n\r\n#if !defined(paraboloid_point_shape) && defined(use_edl)\r\n\tvarying float vLogDepth;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\r\n\tvarying vec3 vViewPosition;\r\n#endif\r\n\r\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\r\n\tvarying float vRadius;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\r\n\tvarying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tvarying float vHighlight;\r\n#endif\r\n\r\n// ---------------------\r\n// OCTREE\r\n// ---------------------\r\n\r\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)\r\n\r\n/**\r\n * Rounds the specified number to the closest integer.\r\n */\r\nfloat round(float number){\r\n\treturn floor(number + 0.5);\r\n}\r\n\r\n/**\r\n * Gets the number of 1-bits up to inclusive index position.\r\n *\r\n * number is treated as if it were an integer in the range 0-255\r\n */\r\nint numberOfOnes(int number, int index) {\r\n\tint numOnes = 0;\r\n\tint tmp = 128;\r\n\tfor (int i = 7; i >= 0; i--) {\r\n\r\n\t\tif (number >= tmp) {\r\n\t\t\tnumber = number - tmp;\r\n\r\n\t\t\tif (i <= index) {\r\n\t\t\t\tnumOnes++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttmp = tmp / 2;\r\n\t}\r\n\r\n\treturn numOnes;\r\n}\r\n\r\n/**\r\n * Checks whether the bit at index is 1.0\r\n *\r\n * number is treated as if it were an integer in the range 0-255\r\n */\r\nbool isBitSet(int number, int index){\r\n\r\n\t// weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\r\n\tint powi = 1;\r\n\tif (index == 0) {\r\n\t\tpowi = 1;\r\n\t} else if (index == 1) {\r\n\t\tpowi = 2;\r\n\t} else if (index == 2) {\r\n\t\tpowi = 4;\r\n\t} else if (index == 3) {\r\n\t\tpowi = 8;\r\n\t} else if (index == 4) {\r\n\t\tpowi = 16;\r\n\t} else if (index == 5) {\r\n\t\tpowi = 32;\r\n\t} else if (index == 6) {\r\n\t\tpowi = 64;\r\n\t} else if (index == 7) {\r\n\t\tpowi = 128;\r\n\t}\r\n\r\n\tint ndp = number / powi;\r\n\r\n\treturn mod(float(ndp), 2.0) != 0.0;\r\n}\r\n\r\n/**\r\n * Gets the the LOD at the point position.\r\n */\r\nfloat getLOD() {\r\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\r\n\tint iOffset = int(vnStart);\r\n\tfloat depth = level;\r\n\r\n\tfor (float i = 0.0; i <= 30.0; i++) {\r\n\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i + level + 0.0);\r\n\r\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\r\n\t\tindex3d = floor(index3d + 0.5);\r\n\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\r\n\r\n\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\r\n\t\tint mask = int(round(value.r * 255.0));\r\n\r\n\t\tif (isBitSet(mask, index)) {\r\n\t\t\t// there are more visible child nodes at this position\r\n\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\r\n\t\t\tint advanceB = int(round(value.b * 255.0));\r\n\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\r\n\t\t\tint advance = advanceG + advanceB + advanceChild;\r\n\r\n\t\t\tiOffset = iOffset + advance;\r\n\r\n\t\t\tdepth++;\r\n\t\t} else {\r\n\t\t\treturn value.a * 255.0; // no more visible child nodes at this position\r\n\t\t}\r\n\r\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\r\n\t}\r\n\r\n\treturn depth;\r\n}\r\n\r\nfloat getPointSizeAttenuation() {\r\n\treturn 0.5 * pow(2.0, getLOD());\r\n}\r\n\r\n#endif\r\n\r\n// ---------------------\r\n// KD-TREE\r\n// ---------------------\r\n\r\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)\r\n\r\nfloat getLOD() {\r\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\r\n\tfloat intOffset = 0.0;\r\n\tfloat depth = 0.0;\r\n\r\n\tvec3 size = bbSize;\r\n\tvec3 pos = position;\r\n\r\n\tfor (float i = 0.0; i <= 1000.0; i++) {\r\n\r\n\t\tvec4 value = texture2D(visibleNodes, vec2(intOffset / 2048.0, 0.0));\r\n\r\n\t\tint children = int(value.r * 255.0);\r\n\t\tfloat next = value.g * 255.0;\r\n\t\tint split = int(value.b * 255.0);\r\n\r\n\t\tif (next == 0.0) {\r\n\t\t \treturn depth;\r\n\t\t}\r\n\r\n\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\r\n\t\tif (split == 1) {\r\n\t\t\tsplitv.x = 1.0;\r\n\t\t} else if (split == 2) {\r\n\t\t \tsplitv.y = 1.0;\r\n\t\t} else if (split == 4) {\r\n\t\t \tsplitv.z = 1.0;\r\n\t\t}\r\n\r\n\t\tintOffset = intOffset + next;\r\n\r\n\t\tfloat factor = length(pos * splitv / size);\r\n\t\tif (factor < 0.5) {\r\n\t\t \t// left\r\n\t\t\tif (children == 0 || children == 2) {\r\n\t\t\t\treturn depth;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// right\r\n\t\t\tpos = pos - size * splitv * 0.5;\r\n\t\t\tif (children == 0 || children == 1) {\r\n\t\t\t\treturn depth;\r\n\t\t\t}\r\n\t\t\tif (children == 3) {\r\n\t\t\t\tintOffset = intOffset + 1.0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\r\n\r\n\t\tdepth++;\r\n\t}\r\n\r\n\r\n\treturn depth;\r\n}\r\n\r\nfloat getPointSizeAttenuation() {\r\n\treturn 0.5 * pow(1.3, getLOD());\r\n}\r\n\r\n#endif\r\n\r\n// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\r\nfloat getContrastFactor(float contrast) {\r\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\r\n}\r\n\r\nvec3 getRGB() {\r\n\t#if defined(use_rgb_gamma_contrast_brightness)\r\n\t  vec3 rgb = color;\r\n\t\trgb = pow(rgb, vec3(rgbGamma));\r\n\t\trgb = rgb + rgbBrightness;\r\n\t\trgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;\r\n\t\trgb = clamp(rgb, 0.0, 1.0);\r\n\t\treturn rgb;\r\n\t#else\r\n\t\treturn color;\r\n\t#endif\r\n}\r\n\r\nfloat getIntensity() {\r\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\r\n\tw = pow(w, intensityGamma);\r\n\tw = w + intensityBrightness;\r\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\r\n\tw = clamp(w, 0.0, 1.0);\r\n\r\n\treturn w;\r\n}\r\n\r\nvec3 getElevation() {\r\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\r\n\tfloat w = (world.z - heightMin) / (heightMax-heightMin);\r\n\tvec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\r\n\r\n\treturn cElevation;\r\n}\r\n\r\nvec4 getClassification() {\r\n\tvec2 uv = vec2(classification / 255.0, 0.5);\r\n\tvec4 classColor = texture2D(classificationLUT, uv);\r\n\r\n\treturn classColor;\r\n}\r\n\r\nvec3 getReturnNumber() {\r\n\tif (numberOfReturns == 1.0) {\r\n\t\treturn vec3(1.0, 1.0, 0.0);\r\n\t} else {\r\n\t\tif (returnNumber == 1.0) {\r\n\t\t\treturn vec3(1.0, 0.0, 0.0);\r\n\t\t} else if (returnNumber == numberOfReturns) {\r\n\t\t\treturn vec3(0.0, 0.0, 1.0);\r\n\t\t} else {\r\n\t\t\treturn vec3(0.0, 1.0, 0.0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvec3 getSourceID() {\r\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\r\n\treturn texture2D(gradient, vec2(w, 1.0 - w)).rgb;\r\n}\r\n\r\nvec3 getCompositeColor() {\r\n\tvec3 c;\r\n\tfloat w;\r\n\r\n\tc += wRGB * getRGB();\r\n\tw += wRGB;\r\n\r\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\r\n\tw += wIntensity;\r\n\r\n\tc += wElevation * getElevation();\r\n\tw += wElevation;\r\n\r\n\tc += wReturnNumber * getReturnNumber();\r\n\tw += wReturnNumber;\r\n\r\n\tc += wSourceID * getSourceID();\r\n\tw += wSourceID;\r\n\r\n\tvec4 cl = wClassification * getClassification();\r\n\tc += cl.a * cl.rgb;\r\n\tw += wClassification * cl.a;\r\n\r\n\tc = c / w;\r\n\r\n\tif (w == 0.0) {\r\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\r\n\t}\r\n\r\n\treturn c;\r\n}\r\n\r\nvoid main() {\r\n\tvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n\r\n\tgl_Position = projectionMatrix * mvPosition;\r\n\r\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\r\n\t\tvViewPosition = mvPosition.xyz;\r\n\t#endif\r\n\r\n\t#if defined weighted_splats\r\n\t\tvLinearDepth = gl_Position.w;\r\n\t#endif\r\n\r\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\r\n\t\tvNormal = normalize(normalMatrix * normal);\r\n\t#endif\r\n\r\n\t#if !defined(paraboloid_point_shape) && defined(use_edl)\r\n\t\tvLogDepth = log2(-mvPosition.z);\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// POINT SIZE\r\n\t// ---------------------\r\n\r\n\tfloat pointSize = 1.0;\r\n\tfloat slope = tan(fov / 2.0);\r\n\tfloat projFactor =  -0.5 * screenHeight / (slope * mvPosition.z);\r\n\r\n\t#if defined fixed_point_size\r\n\t\tpointSize = size;\r\n\t#elif defined attenuated_point_size\r\n\t\tpointSize = size * spacing * projFactor;\r\n\t#elif defined adaptive_point_size\r\n\t\tfloat worldSpaceSize = 2.0 * size * spacing / getPointSizeAttenuation();\r\n\t\tpointSize = worldSpaceSize * projFactor;\r\n\t#endif\r\n\r\n\tpointSize = max(minSize, pointSize);\r\n\tpointSize = min(maxSize, pointSize);\r\n\r\n\t#if defined(weighted_splats) || defined(paraboloid_point_shape)\r\n\t\tvRadius = pointSize / projFactor;\r\n\t#endif\r\n\r\n\tgl_PointSize = pointSize;\r\n\r\n\t// ---------------------\r\n\t// HIGHLIGHTING\r\n\t// ---------------------\r\n\r\n\t#ifdef highlight_point\r\n\t\tvec4 mPosition = modelMatrix * vec4(position, 1.0);\r\n\t\tif (enablePointHighlighting && abs(mPosition.x - highlightedPointCoordinate.x) < 0.0001 &&\r\n\t\t\tabs(mPosition.y - highlightedPointCoordinate.y) < 0.0001 &&\r\n\t\t\tabs(mPosition.z - highlightedPointCoordinate.z) < 0.0001) {\r\n\t\t\tvHighlight = 1.0;\r\n\t\t\tgl_PointSize = pointSize * highlightedPointScale;\r\n\t\t} else {\r\n\t\t\tvHighlight = 0.0;\r\n\t\t}\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// OPACITY\r\n\t// ---------------------\r\n\r\n\t#ifndef color_type_point_index\r\n\t\t#ifdef attenuated_opacity\r\n\t\t\tvOpacity = opacity * exp(-length(-mvPosition.xyz) / opacityAttenuation);\r\n\t\t#else\r\n\t\t\tvOpacity = opacity;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// FILTERING\r\n\t// ---------------------\r\n\r\n\t#ifdef use_filter_by_normal\r\n\t\tbool discardPoint = false;\r\n\t\t// Absolute normal filtering\r\n\t\tif (normalFilteringMode == 1) {\r\n\t\t\tdiscardPoint = (abs((modelViewMatrix * vec4(normal, 0.0)).z) > filterByNormalThreshold);\r\n\t\t}\r\n\t\t// less than equal to\r\n\t\telse if (normalFilteringMode == 2) {\r\n\t\t\tdiscardPoint = (modelViewMatrix * vec4(normal, 0.0)).z <= filterByNormalThreshold;\r\n\t\t\t}\r\n\t\t// greater than\r\n\t\telse if(normalFilteringMode == 3) {\r\n\t\t\tdiscardPoint = (modelViewMatrix * vec4(normal, 0.0)).z > filterByNormalThreshold;\r\n\t\t\t}\r\n\r\n\t\tif (discardPoint)\r\n\t\t{\r\n\t\t\tgl_Position = vec4(0.0, 0.0, 2.0, 1.0);\r\n\t\t}\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// POINT COLOR\r\n\t// ---------------------\r\n\r\n\t#ifdef color_type_rgb\r\n\t\tvColor = getRGB();\r\n\t#elif defined color_type_height\r\n\t\tvColor = getElevation();\r\n\t#elif defined color_type_rgb_height\r\n\t\tvec3 cHeight = getElevation();\r\n\t\tvColor = (1.0 - transition) * getRGB() + transition * cHeight;\r\n\t#elif defined color_type_depth\r\n\t\tfloat linearDepth = -mvPosition.z ;\r\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\r\n\t\tvColor = vec3(linearDepth, expDepth, 0.0);\r\n\t#elif defined color_type_intensity\r\n\t\tfloat w = getIntensity();\r\n\t\tvColor = vec3(w, w, w);\r\n\t#elif defined color_type_intensity_gradient\r\n\t\tfloat w = getIntensity();\r\n\t\tvColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\r\n\t#elif defined color_type_color\r\n\t\tvColor = uColor;\r\n\t#elif defined color_type_lod\r\n\tfloat w = getLOD() / 10.0;\r\n\tvColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\r\n\t#elif defined color_type_point_index\r\n\t\tvColor = indices.rgb;\r\n\t#elif defined color_type_classification\r\n\t  vec4 cl = getClassification();\r\n\t\tvColor = cl.rgb;\r\n\t#elif defined color_type_return_number\r\n\t\tvColor = getReturnNumber();\r\n\t#elif defined color_type_source\r\n\t\tvColor = getSourceID();\r\n\t#elif defined color_type_normal\r\n\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz;\r\n\t#elif defined color_type_phong\r\n\t\tvColor = color;\r\n\t#elif defined color_type_composite\r\n\t\tvColor = getCompositeColor();\r\n\t#endif\r\n\r\n\t#if !defined color_type_composite && defined color_type_classification\r\n\t\tif (cl.a == 0.0) {\r\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\r\n\t\t\treturn;\r\n\t\t}\r\n\t#endif\r\n\r\n\t// ---------------------\r\n\t// CLIPPING\r\n\t// ---------------------\r\n\r\n\t#if defined use_clip_box\r\n\t\tbool insideAny = false;\r\n\t\tfor (int i = 0; i < max_clip_boxes; i++) {\r\n\t\t\tif (i == int(clipBoxCount)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4(position, 1.0);\r\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\r\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\r\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\r\n\t\t\tinsideAny = insideAny || inside;\r\n\t\t}\r\n\r\n\t\tif (!insideAny) {\r\n\t\t\t#if defined clip_outside\r\n\t\t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\r\n\t\t\t#elif defined clip_highlight_inside && !defined(color_type_depth)\r\n\t\t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;\r\n\t\t\t#endif\r\n\t\t} else {\r\n\t\t\t#if defined clip_highlight_inside\r\n\t\t\t\tvColor.r += 0.5;\r\n\t\t\t#endif\r\n\t\t}\r\n\t#endif\r\n}\r\n"},function(ar,gt,Et){"use strict";Et.r(gt),gt.default="precision highp float;\r\nprecision highp int;\r\n\r\n#if defined paraboloid_point_shape\r\n\t#extension GL_EXT_frag_depth : enable\r\n#endif\r\n\r\nuniform mat4 viewMatrix;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform float opacity;\r\n\r\nuniform float blendHardness;\r\nuniform float blendDepthSupplement;\r\nuniform float fov;\r\nuniform float spacing;\r\nuniform float pcIndex;\r\nuniform float screenWidth;\r\nuniform float screenHeight;\r\n\r\nuniform sampler2D depthMap;\r\n\r\n#if defined (clip_horizontally) || defined (clip_vertically)\r\n\tuniform vec4 clipExtent;\r\n#endif\r\n\r\n#ifdef use_texture_blending\r\n\tuniform sampler2D backgroundMap;\r\n#endif\r\n\r\n\r\n#ifdef use_point_cloud_mixing\r\n\tuniform int pointCloudMixingMode;\r\n\tuniform float pointCloudID;\r\n\tuniform float pointCloudMixAngle;\r\n\tuniform float stripeDistanceX;\r\n\tuniform float stripeDistanceY;\r\n\r\n\tuniform float stripeDivisorX;\r\n\tuniform float stripeDivisorY;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tuniform vec4 highlightedPointColor;\r\n#endif\r\n\r\nvarying vec3 vColor;\r\n\r\n#if !defined(color_type_point_index)\r\n\tvarying float vOpacity;\r\n#endif\r\n\r\n#if defined(weighted_splats)\r\n\tvarying float vLinearDepth;\r\n#endif\r\n\r\n#if !defined(paraboloid_point_shape) && defined(use_edl)\r\n\tvarying float vLogDepth;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\r\n\tvarying vec3 vViewPosition;\r\n#endif\r\n\r\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\r\n\tvarying float vRadius;\r\n#endif\r\n\r\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\r\n\tvarying vec3 vNormal;\r\n#endif\r\n\r\n#ifdef highlight_point\r\n\tvarying float vHighlight;\r\n#endif\r\n\r\nfloat specularStrength = 1.0;\r\n\r\nvoid main() {\r\n\tvec3 color = vColor;\r\n\tfloat depth = gl_FragCoord.z;\r\n\r\n\t#if defined (clip_horizontally) || defined (clip_vertically)\r\n\tvec2 ndc = vec2((gl_FragCoord.x / screenWidth), 1.0 - (gl_FragCoord.y / screenHeight));\r\n\r\n\tif(step(clipExtent.x, ndc.x) * step(ndc.x, clipExtent.z) < 1.0)\r\n\t{\r\n\t\tdiscard;\r\n\t}\r\n\r\n\tif(step(clipExtent.y, ndc.y) * step(ndc.y, clipExtent.w) < 1.0)\r\n\t{\r\n\t\tdiscard;\r\n\t}\r\n\t#endif  \r\n\r\n\t#if defined(circle_point_shape) || defined(paraboloid_point_shape) || defined (weighted_splats)\r\n\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;\r\n\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;\r\n\t#endif\r\n\r\n\t#if defined(circle_point_shape) || defined (weighted_splats)\r\n\t\tfloat cc = u*u + v*v;\r\n\t\tif(cc > 1.0){\r\n\t\t\tdiscard;\r\n\t\t}\r\n\t#endif\r\n\r\n\t#if defined weighted_splats\r\n\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\r\n\t\tfloat sDepth = texture2D(depthMap, uv).r;\r\n\t\tif(vLinearDepth > sDepth + vRadius + blendDepthSupplement){\r\n\t\t\tdiscard;\r\n\t\t}\r\n\t#endif\r\n\r\n\t#if defined color_type_point_index\r\n\t\tgl_FragColor = vec4(color, pcIndex / 255.0);\r\n\t#else\r\n\t\tgl_FragColor = vec4(color, vOpacity);\r\n\t#endif\r\n\r\n\t#ifdef use_point_cloud_mixing\r\n\t\tbool discardFragment = false;\r\n\r\n\t\tif (pointCloudMixingMode == 1) {  // Checkboard\r\n\t\t\tfloat vPointCloudID = pointCloudID > 10. ? pointCloudID/10.: pointCloudID;\r\n\t\t\tdiscardFragment = mod(gl_FragCoord.x, vPointCloudID) > 0.5 && mod(gl_FragCoord.y, vPointCloudID) > 0.5;\r\n\t\t}\r\n\t\telse if (pointCloudMixingMode == 2) {  // Stripes\r\n\t\t\tfloat angle = pointCloudMixAngle * pointCloudID / 180.;\r\n\t\t\tfloat u = cos(angle) * gl_FragCoord.x + sin(angle) * gl_FragCoord.y;\r\n\t\t\tfloat v = -sin(angle) * gl_FragCoord.x + cos(angle) * gl_FragCoord.y;\r\n\r\n\t\t\tdiscardFragment = mod(u, stripeDistanceX) >= stripeDistanceX/stripeDivisorX && mod(v, stripeDistanceY) >= stripeDistanceY/stripeDivisorY;\r\n\t\t}\r\n\t\tif (discardFragment) {\r\n\t\t\tdiscard;\r\n\t\t}\r\n\t#endif\r\n\r\n\t#ifdef use_texture_blending\r\n\t\tvec2 vUv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\r\n\r\n\t\tvec4 tColor = texture2D(backgroundMap, vUv);\r\n\t\tgl_FragColor = vec4(vOpacity * color, 1.) + vec4((1. - vOpacity) * tColor.rgb, 0.);\r\n\t#endif\r\n\r\n\t#if defined(color_type_phong)\r\n\t\t#if MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0\r\n\t\t\tvec3 normal = normalize( vNormal );\r\n\t\t\tnormal.z = abs(normal.z);\r\n\r\n\t\t\tvec3 viewPosition = normalize( vViewPosition );\r\n\t\t#endif\r\n\r\n\t\t// code taken from three.js phong light fragment shader\r\n\r\n\t\t#if MAX_POINT_LIGHTS > 0\r\n\r\n\t\t\tvec3 pointDiffuse = vec3( 0.0 );\r\n\t\t\tvec3 pointSpecular = vec3( 0.0 );\r\n\r\n\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n\t\t\t\tfloat lDistance = 1.0;\r\n\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )\r\n\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\r\n\r\n\t\t\t\tlVector = normalize( lVector );\r\n\r\n\t\t\t\t\t\t// diffuse\r\n\r\n\t\t\t\tfloat dotProduct = dot( normal, lVector );\r\n\r\n\t\t\t\t#ifdef WRAP_AROUND\r\n\r\n\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\r\n\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\r\n\r\n\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\r\n\r\n\t\t\t\t#else\r\n\r\n\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\r\n\r\n\t\t\t\t// specular\r\n\r\n\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\r\n\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\r\n\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\r\n\r\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\r\n\r\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\r\n\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\r\n\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);\r\n\t\t\t}\r\n\r\n\t\t#endif\r\n\r\n\t\t#if MAX_DIR_LIGHTS > 0\r\n\r\n\t\t\tvec3 dirDiffuse = vec3( 0.0 );\r\n\t\t\tvec3 dirSpecular = vec3( 0.0 );\r\n\r\n\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\r\n\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );\r\n\r\n\t\t\t\t\t\t// diffuse\r\n\r\n\t\t\t\tfloat dotProduct = dot( normal, dirVector );\r\n\r\n\t\t\t\t#ifdef WRAP_AROUND\r\n\r\n\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\r\n\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\r\n\r\n\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\r\n\r\n\t\t\t\t#else\r\n\r\n\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\t\t\t\t#endif\r\n\r\n\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\r\n\r\n\t\t\t\t// specular\r\n\r\n\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\r\n\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\r\n\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\r\n\r\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\r\n\r\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\r\n\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\r\n\t\t\t}\r\n\r\n\t\t#endif\r\n\r\n\t\tvec3 totalDiffuse = vec3( 0.0 );\r\n\t\tvec3 totalSpecular = vec3( 0.0 );\r\n\r\n\t\t#if MAX_POINT_LIGHTS > 0\r\n\r\n\t\t\ttotalDiffuse += pointDiffuse;\r\n\t\t\ttotalSpecular += pointSpecular;\r\n\r\n\t\t#endif\r\n\r\n\t\t#if MAX_DIR_LIGHTS > 0\r\n\r\n\t\t\ttotalDiffuse += dirDiffuse;\r\n\t\t\ttotalSpecular += dirSpecular;\r\n\r\n\t\t#endif\r\n\r\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\r\n\r\n\t#endif\r\n\r\n\t#if defined weighted_splats\r\n\t    //float w = pow(1.0 - (u*u + v*v), blendHardness);\r\n\r\n\t\tfloat wx = 2.0 * length(2.0 * gl_PointCoord - 1.0);\r\n\t\tfloat w = exp(-wx * wx * 0.5);\r\n\r\n\t\t//float distance = length(2.0 * gl_PointCoord - 1.0);\r\n\t\t//float w = exp( -(distance * distance) / blendHardness);\r\n\r\n\t\tgl_FragColor.rgb = gl_FragColor.rgb * w;\r\n\t\tgl_FragColor.a = w;\r\n\t#endif\r\n\r\n\t#if defined paraboloid_point_shape\r\n\t\tfloat wi = 0.0 - ( u*u + v*v);\r\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\r\n\t\tpos.z += wi * vRadius;\r\n\t\tfloat linearDepth = -pos.z;\r\n\t\tpos = projectionMatrix * pos;\r\n\t\tpos = pos / pos.w;\r\n\t\tfloat expDepth = pos.z;\r\n\t\tdepth = (pos.z + 1.0) / 2.0;\r\n\t\tgl_FragDepthEXT = depth;\r\n\r\n\t\t#if defined(color_type_depth)\r\n\t\t\tgl_FragColor.r = linearDepth;\r\n\t\t\tgl_FragColor.g = expDepth;\r\n\t\t#endif\r\n\r\n\t\t#if defined(use_edl)\r\n\t\t\tgl_FragColor.a = log2(linearDepth);\r\n\t\t#endif\r\n\r\n\t#else\r\n\t\t#if defined(use_edl)\r\n\t\t\tgl_FragColor.a = vLogDepth;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef highlight_point\r\n\t\tif (vHighlight > 0.0) {\r\n\t\t\tgl_FragColor = highlightedPointColor;\r\n\t\t}\r\n\t#endif\r\n}\r\n"},function(ar,gt,Et){ar.exports=function(){return Et(7)('!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var r=n(1);onmessage=r.handleMessage},function(t,e,n){"use strict";var r;n.r(e),n.d(e,"handleMessage",(function(){return I})),function(t){t[t.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",t[t.COLOR_PACKED=1]="COLOR_PACKED",t[t.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",t[t.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",t[t.NORMAL_FLOATS=4]="NORMAL_FLOATS",t[t.FILLER=5]="FILLER",t[t.INTENSITY=6]="INTENSITY",t[t.CLASSIFICATION=7]="CLASSIFICATION",t[t.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",t[t.NORMAL_OCT16=9]="NORMAL_OCT16",t[t.NORMAL=10]="NORMAL"}(r||(r={}));const i={ordinal:1,size:4},o={ordinal:2,size:1},s={ordinal:3,size:1},u={ordinal:5,size:2};function a(t,e,n){return{name:t,type:e,numElements:n,byteSize:n*e.size}}const f=a(r.COLOR_PACKED,o,4),A={POSITION_CARTESIAN:a(r.POSITION_CARTESIAN,i,3),RGBA_PACKED:f,COLOR_PACKED:f,RGB_PACKED:a(r.COLOR_PACKED,o,3),NORMAL_FLOATS:a(r.NORMAL_FLOATS,i,3),FILLER_1B:a(r.FILLER,s,1),INTENSITY:a(r.INTENSITY,u,1),CLASSIFICATION:a(r.CLASSIFICATION,s,1),NORMAL_SPHEREMAPPED:a(r.NORMAL_SPHEREMAPPED,s,2),NORMAL_OCT16:a(r.NORMAL_OCT16,s,2),NORMAL:a(r.NORMAL,i,3)};class O{constructor(t){this.versionMinor=0,this.version=t;const e=-1===t.indexOf(".")?t.length:t.indexOf(".");this.versionMajor=parseInt(t.substr(0,e),10),this.versionMinor=parseInt(t.substr(e+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}newerThan(t){const e=new O(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>e.versionMinor}equalOrHigher(t){const e=new O(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>=e.versionMinor}upTo(t){return!this.newerThan(t)}}class c{constructor(t){this.tmp=new ArrayBuffer(4),this.tmpf=new Float32Array(this.tmp),this.tmpu8=new Uint8Array(this.tmp),this.u8=new Uint8Array(t)}getUint32(t){return this.u8[t+3]<<24|this.u8[t+2]<<16|this.u8[t+1]<<8|this.u8[t]}getUint16(t){return this.u8[t+1]<<8|this.u8[t]}getFloat32(t){const e=this.tmpu8,n=this.u8,r=this.tmpf;return e[0]=n[t+0],e[1]=n[t+1],e[2]=n[t+2],e[3]=n[t+3],r[0]}getUint8(t){return this.u8[t]}}const b=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1};function I(t){const e=t.data.buffer,n=t.data.pointAttributes,i={attributeBuffers:{},currentOffset:0,data:new c(e),mean:[0,0,0],nodeOffset:t.data.offset,numPoints:t.data.buffer.byteLength/n.byteSize,pointAttributes:n,scale:t.data.scale,tightBoxMax:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],tightBoxMin:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],transferables:[],version:new O(t.data.version)};for(const t of i.pointAttributes.attributes)M(t,i),i.currentOffset+=t.byteSize;const o=new ArrayBuffer(4*i.numPoints),s=new Uint32Array(o);for(let t=0;t<i.numPoints;t++)s[t]=t;i.attributeBuffers[r.CLASSIFICATION]||function(t){const e=new ArrayBuffer(4*t.numPoints),n=new Float32Array(e);for(let e=0;e<t.numPoints;e++)n[e]=0;t.attributeBuffers[r.CLASSIFICATION]={buffer:e,attribute:A.CLASSIFICATION}}(i);const u={buffer:e,mean:i.mean,attributeBuffers:i.attributeBuffers,tightBoundingBox:{min:i.tightBoxMin,max:i.tightBoxMax},indices:o};postMessage(u,i.transferables)}function M(t,e){const n=function(t,e){switch(t.name){case r.POSITION_CARTESIAN:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){let n,i,o;e.version.newerThan("1.3")?(n=e.data.getUint32(e.currentOffset+t*e.pointAttributes.byteSize+0)*e.scale,i=e.data.getUint32(e.currentOffset+t*e.pointAttributes.byteSize+4)*e.scale,o=e.data.getUint32(e.currentOffset+t*e.pointAttributes.byteSize+8)*e.scale):(n=e.data.getFloat32(t*e.pointAttributes.byteSize+0)+e.nodeOffset[0],i=e.data.getFloat32(t*e.pointAttributes.byteSize+4)+e.nodeOffset[1],o=e.data.getFloat32(t*e.pointAttributes.byteSize+8)+e.nodeOffset[2]),r[3*t+0]=n,r[3*t+1]=i,r[3*t+2]=o,e.mean[0]+=n/e.numPoints,e.mean[1]+=i/e.numPoints,e.mean[2]+=o/e.numPoints,e.tightBoxMin[0]=Math.min(e.tightBoxMin[0],n),e.tightBoxMin[1]=Math.min(e.tightBoxMin[1],i),e.tightBoxMin[2]=Math.min(e.tightBoxMin[2],o),e.tightBoxMax[0]=Math.max(e.tightBoxMax[0],n),e.tightBoxMax[1]=Math.max(e.tightBoxMax[1],i),e.tightBoxMax[2]=Math.max(e.tightBoxMax[2],o)}return{buffer:n,attribute:t}}(t,e);case r.COLOR_PACKED:return function(t,e){const n=new ArrayBuffer(3*e.numPoints),r=new Uint8Array(n);for(let t=0;t<e.numPoints;t++)r[3*t+0]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+0),r[3*t+1]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+1),r[3*t+2]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+2);return{buffer:n,attribute:t}}(t,e);case r.INTENSITY:return function(t,e){const n=new ArrayBuffer(4*e.numPoints),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++)r[t]=e.data.getUint16(e.currentOffset+t*e.pointAttributes.byteSize);return{buffer:n,attribute:t}}(t,e);case r.CLASSIFICATION:return function(t,e){const n=new ArrayBuffer(e.numPoints),r=new Uint8Array(n);for(let t=0;t<e.numPoints;t++)r[t]=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize);return{buffer:n,attribute:t}}(t,e);case r.NORMAL_SPHEREMAPPED:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){const n=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+0),i=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+1);let o=2*(n/255)-1,s=2*(i/255)-1,u=1;const a=o*-o+s*-s+u*- -1;u=a,o*=Math.sqrt(a),s*=Math.sqrt(a),o*=2,s*=2,u=2*u-1,r[3*t+0]=o,r[3*t+1]=s,r[3*t+2]=u}return{buffer:n,attribute:t}}(t,e);case r.NORMAL_OCT16:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){const n=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+0),i=e.data.getUint8(e.currentOffset+t*e.pointAttributes.byteSize+1),o=n/255*2-1,s=i/255*2-1;let u=1-Math.abs(o)-Math.abs(s),a=0,f=0;u>=0?(a=o,f=s):(a=-(s/b(s)-1)/b(o),f=-(o/b(o)-1)/b(s));const A=Math.sqrt(a*a+f*f+u*u);a/=A,f/=A,u/=A,r[3*t+0]=a,r[3*t+1]=f,r[3*t+2]=u}return{buffer:n,attribute:t}}(t,e);case r.NORMAL:return function(t,e){const n=new ArrayBuffer(4*e.numPoints*3),r=new Float32Array(n);for(let t=0;t<e.numPoints;t++){const n=e.data.getFloat32(e.currentOffset+t*e.pointAttributes.byteSize+0),i=e.data.getFloat32(e.currentOffset+t*e.pointAttributes.byteSize+4),o=e.data.getFloat32(e.currentOffset+t*e.pointAttributes.byteSize+8);r[3*t+0]=n,r[3*t+1]=i,r[3*t+2]=o}return{buffer:n,attribute:t}}(t,e);default:return}}(t,e);void 0!==n&&(e.attributeBuffers[n.attribute.name]=n,e.transferables.push(n.buffer))}}]);',null)}},function(ar,gt,Et){"use strict";var cn=window.URL||window.webkitURL;ar.exports=function(Qt,Dn){try{try{var ai;try{(ai=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(Qt),ai=ai.getBlob()}catch(ji){ai=new Blob([Qt])}return new Worker(cn.createObjectURL(ai))}catch(ji){return new Worker("data:application/javascript,"+encodeURIComponent(Qt))}}catch(ji){if(!Dn)throw Error("Inline worker is not supported");return new Worker(Dn)}}},function(ar,gt,Et){"use strict";Et.r(gt),Et.d(gt,"BlurMaterial",function(){return es}),Et.d(gt,"ClipMode",function(){return cn}),Et.d(gt,"PointSizeType",function(){return Qt}),Et.d(gt,"PointShape",function(){return Dn}),Et.d(gt,"TreeType",function(){return ai}),Et.d(gt,"PointOpacityType",function(){return ji}),Et.d(gt,"PointColorType",function(){return gi}),Et.d(gt,"NormalFilteringMode",function(){return Xs}),Et.d(gt,"PointCloudMixingMode",function(){return gr}),Et.d(gt,"PointCloudMaterial",function(){return kt}),Et.d(gt,"generateDataTexture",function(){return du}),Et.d(gt,"generateGradientTexture",function(){return Ph}),Et.d(gt,"generateClassificationTexture",function(){return bc}),Et.d(gt,"GRAYSCALE",function(){return hu}),Et.d(gt,"INFERNO",function(){return Em}),Et.d(gt,"PLASMA",function(){return Ba}),Et.d(gt,"RAINBOW",function(){return Sm}),Et.d(gt,"SPECTRAL",function(){return vc}),Et.d(gt,"VIRIDIS",function(){return xc}),Et.d(gt,"YELLOW_GREEN",function(){return xf}),Et.d(gt,"PointAttributeName",function(){return wn}),Et.d(gt,"POINT_ATTRIBUTE_TYPES",function(){return Fo}),Et.d(gt,"POINT_ATTRIBUTES",function(){return pu}),Et.d(gt,"PointAttributes",function(){return mu}),Et.d(gt,"PointCloudOctreeGeometryNode",function(){return Lh}),Et.d(gt,"PointCloudOctreeGeometry",function(){return Pm}),Et.d(gt,"PointCloudOctreeNode",function(){return Fh}),Et.d(gt,"PointCloudOctreePicker",function(){return Ii}),Et.d(gt,"PointCloudOctree",function(){return gu}),Et.d(gt,"PointCloudTree",function(){return Va}),Et.d(gt,"QueueItem",function(){return _u}),Et.d(gt,"Potree",function(){return ca}),Et.d(gt,"Version",function(){return Mc});var cn,Qt,Dn,ai,ji,gi,Xs,gr,se,ge=Et(0);class es extends ge.ShaderMaterial{constructor(){super(...arguments),this.vertexShader=Et(2),this.fragmentShader=Et(3),this.uniforms={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},map:{type:"t",value:null}}}}(se=cn||(cn={}))[se.DISABLED=0]="DISABLED",se[se.CLIP_OUTSIDE=1]="CLIP_OUTSIDE",se[se.HIGHLIGHT_INSIDE=2]="HIGHLIGHT_INSIDE",se[se.CLIP_HORIZONTALLY=3]="CLIP_HORIZONTALLY",se[se.CLIP_VERTICALLY=4]="CLIP_VERTICALLY",function(se){se[se.FIXED=0]="FIXED",se[se.ATTENUATED=1]="ATTENUATED",se[se.ADAPTIVE=2]="ADAPTIVE"}(Qt||(Qt={})),function(se){se[se.SQUARE=0]="SQUARE",se[se.CIRCLE=1]="CIRCLE",se[se.PARABOLOID=2]="PARABOLOID"}(Dn||(Dn={})),function(se){se[se.OCTREE=0]="OCTREE",se[se.KDTREE=1]="KDTREE"}(ai||(ai={})),function(se){se[se.FIXED=0]="FIXED",se[se.ATTENUATED=1]="ATTENUATED"}(ji||(ji={})),function(se){se[se.RGB=0]="RGB",se[se.COLOR=1]="COLOR",se[se.DEPTH=2]="DEPTH",se[se.HEIGHT=3]="HEIGHT",se[se.ELEVATION=3]="ELEVATION",se[se.INTENSITY=4]="INTENSITY",se[se.INTENSITY_GRADIENT=5]="INTENSITY_GRADIENT",se[se.LOD=6]="LOD",se[se.LEVEL_OF_DETAIL=6]="LEVEL_OF_DETAIL",se[se.POINT_INDEX=7]="POINT_INDEX",se[se.CLASSIFICATION=8]="CLASSIFICATION",se[se.RETURN_NUMBER=9]="RETURN_NUMBER",se[se.SOURCE=10]="SOURCE",se[se.NORMAL=11]="NORMAL",se[se.PHONG=12]="PHONG",se[se.RGB_HEIGHT=13]="RGB_HEIGHT",se[se.COMPOSITE=50]="COMPOSITE"}(gi||(gi={})),function(se){se[se.ABSOLUTE_NORMAL_FILTERING_MODE=1]="ABSOLUTE_NORMAL_FILTERING_MODE",se[se.LESS_EQUAL_NORMAL_FILTERING_MODE=2]="LESS_EQUAL_NORMAL_FILTERING_MODE",se[se.GREATER_NORMAL_FILTERING_MODE=3]="GREATER_NORMAL_FILTERING_MODE"}(Xs||(Xs={})),function(se){se[se.CHECKBOARD=1]="CHECKBOARD",se[se.STRIPES=2]="STRIPES"}(gr||(gr={}));const Oa=new ge.Color(0,0,0),_f=new ge.Vector4(1,0,0,1);function vf(se){return parseInt(se.charAt(se.length-1),10)}function jo(se,U){const W=se.name,ie=U.name;return W.length!==ie.length?W.length-ie.length:W<ie?-1:W>ie?1:0}function Ys(se){if(200!==se.status)throw Error("Response error");return se}function Nl(se){if(!se||0===se.byteLength)throw Error("Empty buffer");return se}const Rh={0:new ge.Vector4(.5,.5,.5,1),1:new ge.Vector4(.5,.5,.5,1),2:new ge.Vector4(.63,.32,.18,1),3:new ge.Vector4(0,1,0,1),4:new ge.Vector4(0,.8,0,1),5:new ge.Vector4(0,.6,0,1),6:new ge.Vector4(1,.66,0,1),7:new ge.Vector4(1,0,1,1),8:new ge.Vector4(1,0,0,1),9:new ge.Vector4(0,0,1,1),12:new ge.Vector4(1,1,0,1),DEFAULT:new ge.Vector4(.3,.6,.6,.5)},hu=[[0,new ge.Color(0,0,0)],[1,new ge.Color(1,1,1)]],Em=[[0,new ge.Color(.077,.042,.206)],[.1,new ge.Color(.225,.036,.388)],[.2,new ge.Color(.373,.074,.432)],[.3,new ge.Color(.522,.128,.42)],[.4,new ge.Color(.665,.182,.37)],[.5,new ge.Color(.797,.255,.287)],[.6,new ge.Color(.902,.364,.184)],[.7,new ge.Color(.969,.516,.063)],[.8,new ge.Color(.988,.683,.072)],[.9,new ge.Color(.961,.859,.298)],[1,new ge.Color(.988,.998,.645)]],Ba=[[0,new ge.Color(.241,.015,.61)],[.1,new ge.Color(.387,.001,.654)],[.2,new ge.Color(.524,.025,.653)],[.3,new ge.Color(.651,.125,.596)],[.4,new ge.Color(.752,.227,.513)],[.5,new ge.Color(.837,.329,.431)],[.6,new ge.Color(.907,.435,.353)],[.7,new ge.Color(.963,.554,.272)],[.8,new ge.Color(.992,.681,.195)],[.9,new ge.Color(.987,.822,.144)],[1,new ge.Color(.94,.975,.131)]],Sm=[[0,new ge.Color(.278,0,.714)],[1/6,new ge.Color(0,0,1)],[2/6,new ge.Color(0,1,1)],[.5,new ge.Color(0,1,0)],[4/6,new ge.Color(1,1,0)],[5/6,new ge.Color(1,.64,0)],[1,new ge.Color(1,0,0)]],vc=[[0,new ge.Color(.3686,.3098,.6353)],[.1,new ge.Color(.1961,.5333,.7412)],[.2,new ge.Color(.4,.7608,.6471)],[.3,new ge.Color(.6706,.8667,.6431)],[.4,new ge.Color(.902,.9608,.5961)],[.5,new ge.Color(1,1,.749)],[.6,new ge.Color(.9961,.8784,.5451)],[.7,new ge.Color(.9922,.6824,.3804)],[.8,new ge.Color(.9569,.4275,.2627)],[.9,new ge.Color(.8353,.2431,.3098)],[1,new ge.Color(.6196,.0039,.2588)]],xc=[[0,new ge.Color(.267,.005,.329)],[.1,new ge.Color(.283,.141,.458)],[.2,new ge.Color(.254,.265,.53)],[.3,new ge.Color(.207,.372,.553)],[.4,new ge.Color(.164,.471,.558)],[.5,new ge.Color(.128,.567,.551)],[.6,new ge.Color(.135,.659,.518)],[.7,new ge.Color(.267,.749,.441)],[.8,new ge.Color(.478,.821,.318)],[.9,new ge.Color(.741,.873,.15)],[1,new ge.Color(.993,.906,.144)]],xf=[[0,new ge.Color(.1647,.2824,.3451)],[.1,new ge.Color(.1338,.3555,.4227)],[.2,new ge.Color(.061,.4319,.4864)],[.3,new ge.Color(0,.5099,.5319)],[.4,new ge.Color(0,.5881,.5569)],[.5,new ge.Color(.137,.665,.5614)],[.6,new ge.Color(.2906,.7395,.5477)],[.7,new ge.Color(.4453,.8099,.5201)],[.8,new ge.Color(.6102,.8748,.485)],[.9,new ge.Color(.7883,.9323,.4514)],[1,new ge.Color(.9804,.9804,.4314)]];function du(se,U,W){const ie=se*U,de=new Uint8Array(4*ie),Ue=Math.floor(255*W.r),Ke=Math.floor(255*W.g),Wt=Math.floor(255*W.b);for(let Ct=0;Ct<ie;Ct++)de[3*Ct]=Ue,de[3*Ct+1]=Ke,de[3*Ct+2]=Wt;const dn=new ge.DataTexture(de,se,U,ge.RGBAFormat);return dn.needsUpdate=!0,dn.magFilter=ge.NearestFilter,dn}function Ph(se){const U=document.createElement("canvas");U.width=64,U.height=64;const W=U.getContext("2d");W.rect(0,0,64,64);const ie=W.createLinearGradient(0,0,64,64);for(let Ue=0;Ue<se.length;Ue++){const Ke=se[Ue];ie.addColorStop(Ke[0],"#"+Ke[1].getHexString())}W.fillStyle=ie,W.fill();const de=new ge.CanvasTexture(U);return de.needsUpdate=!0,de.minFilter=ge.LinearFilter,de}function bc(se){const U=new Uint8Array(262144);for(let ie=0;ie<256;ie++)for(let de=0;de<256;de++){const Ue=ie+256*de;let Ke;Ke=se[ie]?se[ie]:se[ie%32]?se[ie%32]:se.DEFAULT,U[4*Ue+0]=255*Ke.x,U[4*Ue+1]=255*Ke.y,U[4*Ue+2]=255*Ke.z,U[4*Ue+3]=255*Ke.w}const W=new ge.DataTexture(U,256,256,ge.RGBAFormat);return W.magFilter=ge.NearestFilter,W.needsUpdate=!0,W}var $t=function(se,U,W,ie){var de,Ue=arguments.length,Ke=Ue<3?U:null===ie?ie=Object.getOwnPropertyDescriptor(U,W):ie;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)Ke=Reflect.decorate(se,U,W,ie);else for(var Wt=se.length-1;Wt>=0;Wt--)(de=se[Wt])&&(Ke=(Ue<3?de(Ke):Ue>3?de(U,W,Ke):de(U,W))||Ke);return Ue>3&&Ke&&Object.defineProperty(U,W,Ke),Ke};const Cm={[ai.OCTREE]:"tree_type_octree",[ai.KDTREE]:"tree_type_kdtree"},Ih={[Qt.FIXED]:"fixed_point_size",[Qt.ATTENUATED]:"attenuated_point_size",[Qt.ADAPTIVE]:"adaptive_point_size"},Ar={[ji.ATTENUATED]:"attenuated_opacity",[ji.FIXED]:"fixed_opacity"},bf={[Dn.SQUARE]:"square_point_shape",[Dn.CIRCLE]:"circle_point_shape",[Dn.PARABOLOID]:"paraboloid_point_shape"},Tm={[gi.RGB]:"color_type_rgb",[gi.COLOR]:"color_type_color",[gi.DEPTH]:"color_type_depth",[gi.HEIGHT]:"color_type_height",[gi.INTENSITY]:"color_type_intensity",[gi.INTENSITY_GRADIENT]:"color_type_intensity_gradient",[gi.LOD]:"color_type_lod",[gi.POINT_INDEX]:"color_type_point_index",[gi.CLASSIFICATION]:"color_type_classification",[gi.RETURN_NUMBER]:"color_type_return_number",[gi.SOURCE]:"color_type_source",[gi.NORMAL]:"color_type_normal",[gi.PHONG]:"color_type_phong",[gi.RGB_HEIGHT]:"color_type_rgb_height",[gi.COMPOSITE]:"color_type_composite"},Am={[cn.DISABLED]:"clip_disabled",[cn.CLIP_OUTSIDE]:"clip_outside",[cn.HIGHLIGHT_INSIDE]:"clip_highlight_inside",[cn.CLIP_HORIZONTALLY]:"clip_horizontally",[cn.CLIP_VERTICALLY]:"clip_vertically"};class kt extends ge.RawShaderMaterial{constructor(U={}){super(),this.useDrawingBufferSize=!1,this.lights=!1,this.fog=!1,this.numClipBoxes=0,this.clipBoxes=[],this.visibleNodeTextureOffsets=new Map,this._gradient=vc,this.gradientTexture=Ph(this._gradient),this._classification=Rh,this.classificationTexture=bc(this._classification),this.uniforms={bbSize:Xt("fv",[0,0,0]),blendDepthSupplement:Xt("f",0),blendHardness:Xt("f",2),classificationLUT:Xt("t",this.classificationTexture||new ge.Texture),clipBoxCount:Xt("f",0),clipBoxes:Xt("Matrix4fv",[]),clipExtent:Xt("fv",[0,0,1,1]),depthMap:Xt("t",null),diffuse:Xt("fv",[1,1,1]),fov:Xt("f",1),gradient:Xt("t",this.gradientTexture||new ge.Texture),heightMax:Xt("f",1),heightMin:Xt("f",0),intensityBrightness:Xt("f",0),intensityContrast:Xt("f",0),intensityGamma:Xt("f",1),intensityRange:Xt("fv",[0,65e3]),isLeafNode:Xt("b",0),level:Xt("f",0),maxSize:Xt("f",50),minSize:Xt("f",2),octreeSize:Xt("f",0),opacity:Xt("f",1),pcIndex:Xt("f",0),rgbBrightness:Xt("f",0),rgbContrast:Xt("f",0),rgbGamma:Xt("f",1),screenHeight:Xt("f",1),screenWidth:Xt("f",1),size:Xt("f",1),spacing:Xt("f",1),toModel:Xt("Matrix4f",[]),transition:Xt("f",.5),uColor:Xt("c",new ge.Color(16777215)),visibleNodes:Xt("t",this.visibleNodesTexture||new ge.Texture),vnStart:Xt("f",0),wClassification:Xt("f",0),wElevation:Xt("f",0),wIntensity:Xt("f",0),wReturnNumber:Xt("f",0),wRGB:Xt("f",1),wSourceID:Xt("f",0),opacityAttenuation:Xt("f",1),filterByNormalThreshold:Xt("f",0),highlightedPointCoordinate:Xt("fv",new ge.Vector3),highlightedPointColor:Xt("fv",_f.clone()),enablePointHighlighting:Xt("b",!0),highlightedPointScale:Xt("f",2),backgroundMap:Xt("t",null),normalFilteringMode:Xt("i",Xs.ABSOLUTE_NORMAL_FILTERING_MODE),pointCloudID:Xt("f",2),pointCloudMixingMode:Xt("i",gr.CHECKBOARD),stripeDistanceX:Xt("f",5),stripeDistanceY:Xt("f",5),stripeDivisorX:Xt("f",2),stripeDivisorY:Xt("f",2),pointCloudMixAngle:Xt("f",31)},this.useClipBox=!1,this.weighted=!1,this.pointColorType=gi.RGB,this.pointSizeType=Qt.ADAPTIVE,this.clipMode=cn.DISABLED,this.useEDL=!1,this.shape=Dn.SQUARE,this.treeType=ai.OCTREE,this.pointOpacityType=ji.FIXED,this.useFilterByNormal=!1,this.useTextureBlending=!1,this.usePointCloudMixing=!1,this.highlightPoint=!1,this.attributes={position:{type:"fv",value:[]},color:{type:"fv",value:[]},normal:{type:"fv",value:[]},intensity:{type:"f",value:[]},classification:{type:"f",value:[]},returnNumber:{type:"f",value:[]},numberOfReturns:{type:"f",value:[]},pointSourceID:{type:"f",value:[]},indices:{type:"fv",value:[]}};const W=this.visibleNodesTexture=du(2048,1,new ge.Color(16777215));W.minFilter=ge.NearestFilter,W.magFilter=ge.NearestFilter,this.setUniform("visibleNodes",W),this.treeType=wc(U.treeType,ai.OCTREE),this.size=wc(U.size,1),this.minSize=wc(U.minSize,2),this.maxSize=wc(U.maxSize,50),this.classification=Rh,this.defaultAttributeValues.normal=[0,0,0],this.defaultAttributeValues.classification=[0,0,0],this.defaultAttributeValues.indices=[0,0,0,0],this.vertexColors=!0,this.updateShaderSource()}dispose(){super.dispose(),this.gradientTexture&&(this.gradientTexture.dispose(),this.gradientTexture=void 0),this.visibleNodesTexture&&(this.visibleNodesTexture.dispose(),this.visibleNodesTexture=void 0),this.clearVisibleNodeTextureOffsets(),this.classificationTexture&&(this.classificationTexture.dispose(),this.classificationTexture=void 0),this.depthMap&&(this.depthMap.dispose(),this.depthMap=void 0),this.backgroundMap&&(this.backgroundMap.dispose(),this.backgroundMap=void 0)}clearVisibleNodeTextureOffsets(){this.visibleNodeTextureOffsets.clear()}updateShaderSource(){this.vertexShader=this.applyDefines(Et(4).default),this.fragmentShader=this.applyDefines(Et(5).default),1===this.opacity?(this.blending=ge.NoBlending,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=ge.LessEqualDepth):this.opacity<1&&!this.useEDL&&(this.blending=ge.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0),this.weighted&&(this.blending=ge.AdditiveBlending,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.depthFunc=ge.LessEqualDepth),this.needsUpdate=!0}applyDefines(U){const W=[];function ie(de){de&&W.push("#define "+de)}return ie(Cm[this.treeType]),ie(Ih[this.pointSizeType]),ie(bf[this.shape]),ie(Tm[this.pointColorType]),ie(Am[this.clipMode]),ie(Ar[this.pointOpacityType]),1===this.rgbGamma&&0===this.rgbBrightness&&0===this.rgbContrast||ie("use_rgb_gamma_contrast_brightness"),this.useFilterByNormal&&ie("use_filter_by_normal"),this.useEDL&&ie("use_edl"),this.weighted&&ie("weighted_splats"),this.numClipBoxes>0&&ie("use_clip_box"),this.highlightPoint&&ie("highlight_point"),this.useTextureBlending&&ie("use_texture_blending"),this.usePointCloudMixing&&ie("use_point_cloud_mixing"),ie("MAX_POINT_LIGHTS 0"),ie("MAX_DIR_LIGHTS 0"),W.push(U),W.join("\n")}setPointCloudMixingMode(U){this.pointCloudMixingMode=U}getPointCloudMixingMode(){return this.pointCloudMixingMode===gr.STRIPES?gr.STRIPES:gr.CHECKBOARD}setClipBoxes(U){if(!U)return;this.clipBoxes=U;const W=this.numClipBoxes!==U.length&&(0===U.length||0===this.numClipBoxes);this.numClipBoxes=U.length,this.setUniform("clipBoxCount",this.numClipBoxes),W&&this.updateShaderSource();const ie=16*this.numClipBoxes,de=new Float32Array(ie);for(let Ue=0;Ue<this.numClipBoxes;Ue++)de.set(U[Ue].inverse.elements,16*Ue);for(let Ue=0;Ue<ie;Ue++)isNaN(de[Ue])&&(de[Ue]=1/0);this.setUniform("clipBoxes",de)}get gradient(){return this._gradient}set gradient(U){this._gradient!==U&&(this._gradient=U,this.gradientTexture=Ph(this._gradient),this.setUniform("gradient",this.gradientTexture))}get classification(){return this._classification}set classification(U){const W={};for(const de of Object.keys(U))W[de]=U[de].clone();let ie=!1;if(void 0===this._classification)ie=!1;else{ie=Object.keys(W).length===Object.keys(this._classification).length;for(const de of Object.keys(W))ie=ie&&void 0!==this._classification[de],ie=ie&&W[de].equals(this._classification[de])}ie||(this._classification=W,this.recomputeClassification())}recomputeClassification(){this.classificationTexture=bc(this._classification),this.setUniform("classificationLUT",this.classificationTexture)}get elevationRange(){return[this.heightMin,this.heightMax]}set elevationRange(U){this.heightMin=U[0],this.heightMax=U[1]}getUniform(U){return void 0===this.uniforms?void 0:this.uniforms[U].value}setUniform(U,W){if(void 0===this.uniforms)return;const ie=this.uniforms[U];"c"===ie.type?ie.value.copy(W):W!==ie.value&&(ie.value=W)}updateMaterial(U,W,ie,de){const Ue=de.getPixelRatio();this.fov="PerspectiveCamera"===ie.type?ie.fov*(Math.PI/180):Math.PI/2;const Ke=de.getRenderTarget();null!==Ke?(this.screenWidth=Ke.width,this.screenHeight=Ke.height):(this.screenWidth=de.domElement.clientWidth*Ue,this.screenHeight=de.domElement.clientHeight*Ue),this.useDrawingBufferSize&&(de.getDrawingBufferSize(kt.helperVec2),this.screenWidth=kt.helperVec2.width,this.screenHeight=kt.helperVec2.height);const Wt=Math.max(U.scale.x,U.scale.y,U.scale.z);this.spacing=U.pcoGeometry.spacing*Wt,this.octreeSize=U.pcoGeometry.boundingBox.getSize(kt.helperVec3).x,this.pointSizeType!==Qt.ADAPTIVE&&this.pointColorType!==gi.LOD||this.updateVisibilityTextureData(W)}updateVisibilityTextureData(U){U.sort(jo);const W=new Uint8Array(4*U.length),ie=new Array(U.length).fill(1/0);this.visibleNodeTextureOffsets.clear();for(let Ue=0;Ue<U.length;Ue++){const Ke=U[Ue];if(this.visibleNodeTextureOffsets.set(Ke.name,Ue),Ue>0){const Wt=Ke.name.slice(0,-1),dn=this.visibleNodeTextureOffsets.get(Wt);ie[dn]=Math.min(ie[dn],Ue-dn);const Yt=4*dn;W[Yt]=W[Yt]|1<<Ke.index,W[Yt+1]=ie[dn]>>8,W[Yt+2]=ie[dn]%256}W[4*Ue+3]=Ke.name.length}const de=this.visibleNodesTexture;de&&(de.image.data.set(W),de.needsUpdate=!0)}static makeOnBeforeRender(U,W,ie){return(de,Ue,Ke,Wt,dn)=>{const Ct=dn,Yt=Ct.uniforms;Yt.level.value=W.level,Yt.isLeafNode.value=W.isLeafNode;const yi=Ct.visibleNodeTextureOffsets.get(W.name);void 0!==yi&&(Yt.vnStart.value=yi),Yt.pcIndex.value=void 0!==ie?ie:U.visibleNodes.indexOf(W),dn.uniformsNeedUpdate=!0}}}function Xt(se,U){return{type:se,value:U}}function wc(se,U){return void 0===se?U:se}function Rn(se,U=!1){return(W,ie)=>{Object.defineProperty(W,ie,{get(){return this.getUniform(se)},set(de){de!==this.getUniform(se)&&(this.setUniform(se,de),U&&this.updateShaderSource())}})}}function Di(){return(se,U)=>{const W="_"+U.toString();Object.defineProperty(se,U,{get(){return this[W]},set(ie){ie!==this[W]&&(this[W]=ie,this.updateShaderSource())}})}}var wn;kt.helperVec3=new ge.Vector3,kt.helperVec2=new ge.Vector2,$t([Rn("bbSize")],kt.prototype,"bbSize",void 0),$t([Rn("clipExtent")],kt.prototype,"clipExtent",void 0),$t([Rn("depthMap")],kt.prototype,"depthMap",void 0),$t([Rn("fov")],kt.prototype,"fov",void 0),$t([Rn("heightMax")],kt.prototype,"heightMax",void 0),$t([Rn("heightMin")],kt.prototype,"heightMin",void 0),$t([Rn("intensityBrightness")],kt.prototype,"intensityBrightness",void 0),$t([Rn("intensityContrast")],kt.prototype,"intensityContrast",void 0),$t([Rn("intensityGamma")],kt.prototype,"intensityGamma",void 0),$t([Rn("intensityRange")],kt.prototype,"intensityRange",void 0),$t([Rn("maxSize")],kt.prototype,"maxSize",void 0),$t([Rn("minSize")],kt.prototype,"minSize",void 0),$t([Rn("octreeSize")],kt.prototype,"octreeSize",void 0),$t([Rn("opacity",!0)],kt.prototype,"opacity",void 0),$t([Rn("rgbBrightness",!0)],kt.prototype,"rgbBrightness",void 0),$t([Rn("rgbContrast",!0)],kt.prototype,"rgbContrast",void 0),$t([Rn("rgbGamma",!0)],kt.prototype,"rgbGamma",void 0),$t([Rn("screenHeight")],kt.prototype,"screenHeight",void 0),$t([Rn("screenWidth")],kt.prototype,"screenWidth",void 0),$t([Rn("size")],kt.prototype,"size",void 0),$t([Rn("spacing")],kt.prototype,"spacing",void 0),$t([Rn("transition")],kt.prototype,"transition",void 0),$t([Rn("uColor")],kt.prototype,"color",void 0),$t([Rn("wClassification")],kt.prototype,"weightClassification",void 0),$t([Rn("wElevation")],kt.prototype,"weightElevation",void 0),$t([Rn("wIntensity")],kt.prototype,"weightIntensity",void 0),$t([Rn("wReturnNumber")],kt.prototype,"weightReturnNumber",void 0),$t([Rn("wRGB")],kt.prototype,"weightRGB",void 0),$t([Rn("wSourceID")],kt.prototype,"weightSourceID",void 0),$t([Rn("opacityAttenuation")],kt.prototype,"opacityAttenuation",void 0),$t([Rn("filterByNormalThreshold")],kt.prototype,"filterByNormalThreshold",void 0),$t([Rn("highlightedPointCoordinate")],kt.prototype,"highlightedPointCoordinate",void 0),$t([Rn("highlightedPointColor")],kt.prototype,"highlightedPointColor",void 0),$t([Rn("enablePointHighlighting")],kt.prototype,"enablePointHighlighting",void 0),$t([Rn("highlightedPointScale")],kt.prototype,"highlightedPointScale",void 0),$t([Rn("normalFilteringMode")],kt.prototype,"normalFilteringMode",void 0),$t([Rn("backgroundMap")],kt.prototype,"backgroundMap",void 0),$t([Rn("pointCloudID")],kt.prototype,"pointCloudID",void 0),$t([Rn("pointCloudMixingMode")],kt.prototype,"pointCloudMixingMode",void 0),$t([Rn("stripeDistanceX")],kt.prototype,"stripeDistanceX",void 0),$t([Rn("stripeDistanceY")],kt.prototype,"stripeDistanceY",void 0),$t([Rn("stripeDivisorX")],kt.prototype,"stripeDivisorX",void 0),$t([Rn("stripeDivisorY")],kt.prototype,"stripeDivisorY",void 0),$t([Rn("pointCloudMixAngle")],kt.prototype,"pointCloudMixAngle",void 0),$t([Di()],kt.prototype,"useClipBox",void 0),$t([Di()],kt.prototype,"weighted",void 0),$t([Di()],kt.prototype,"pointColorType",void 0),$t([Di()],kt.prototype,"pointSizeType",void 0),$t([Di()],kt.prototype,"clipMode",void 0),$t([Di()],kt.prototype,"useEDL",void 0),$t([Di()],kt.prototype,"shape",void 0),$t([Di()],kt.prototype,"treeType",void 0),$t([Di()],kt.prototype,"pointOpacityType",void 0),$t([Di()],kt.prototype,"useFilterByNormal",void 0),$t([Di()],kt.prototype,"useTextureBlending",void 0),$t([Di()],kt.prototype,"usePointCloudMixing",void 0),$t([Di()],kt.prototype,"highlightPoint",void 0),function(se){se[se.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",se[se.COLOR_PACKED=1]="COLOR_PACKED",se[se.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",se[se.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",se[se.NORMAL_FLOATS=4]="NORMAL_FLOATS",se[se.FILLER=5]="FILLER",se[se.INTENSITY=6]="INTENSITY",se[se.CLASSIFICATION=7]="CLASSIFICATION",se[se.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",se[se.NORMAL_OCT16=9]="NORMAL_OCT16",se[se.NORMAL=10]="NORMAL"}(wn||(wn={}));const Fo={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};function yr(se,U,W){return{name:se,type:U,numElements:W,byteSize:W*U.size}}const fu=yr(wn.COLOR_PACKED,Fo.DATA_TYPE_INT8,4),pu={POSITION_CARTESIAN:yr(wn.POSITION_CARTESIAN,Fo.DATA_TYPE_FLOAT,3),RGBA_PACKED:fu,COLOR_PACKED:fu,RGB_PACKED:yr(wn.COLOR_PACKED,Fo.DATA_TYPE_INT8,3),NORMAL_FLOATS:yr(wn.NORMAL_FLOATS,Fo.DATA_TYPE_FLOAT,3),FILLER_1B:yr(wn.FILLER,Fo.DATA_TYPE_UINT8,1),INTENSITY:yr(wn.INTENSITY,Fo.DATA_TYPE_UINT16,1),CLASSIFICATION:yr(wn.CLASSIFICATION,Fo.DATA_TYPE_UINT8,1),NORMAL_SPHEREMAPPED:yr(wn.NORMAL_SPHEREMAPPED,Fo.DATA_TYPE_UINT8,2),NORMAL_OCT16:yr(wn.NORMAL_OCT16,Fo.DATA_TYPE_UINT8,2),NORMAL:yr(wn.NORMAL,Fo.DATA_TYPE_FLOAT,3)};class mu{constructor(U=[]){this.attributes=[],this.byteSize=0,this.size=0;for(let W=0;W<U.length;W++){const de=pu[U[W]];this.attributes.push(de),this.byteSize+=de.byteSize,this.size++}}add(U){this.attributes.push(U),this.byteSize+=U.byteSize,this.size++}hasColors(){return void 0!==this.attributes.find(t_)}hasNormals(){return void 0!==this.attributes.find(ka)}}function t_({name:se}){return se===wn.COLOR_PACKED}function ka({name:se}){return se===wn.NORMAL_SPHEREMAPPED||se===wn.NORMAL_FLOATS||se===wn.NORMAL||se===wn.NORMAL_OCT16}function Dm(se,U){return(new ge.Box3).setFromPoints([new ge.Vector3(se.min.x,se.min.y,se.min.z).applyMatrix4(U),new ge.Vector3(se.min.x,se.min.y,se.min.z).applyMatrix4(U),new ge.Vector3(se.max.x,se.min.y,se.min.z).applyMatrix4(U),new ge.Vector3(se.min.x,se.max.y,se.min.z).applyMatrix4(U),new ge.Vector3(se.min.x,se.min.y,se.max.z).applyMatrix4(U),new ge.Vector3(se.min.x,se.max.y,se.max.z).applyMatrix4(U),new ge.Vector3(se.max.x,se.max.y,se.min.z).applyMatrix4(U),new ge.Vector3(se.max.x,se.min.y,se.max.z).applyMatrix4(U),new ge.Vector3(se.max.x,se.max.y,se.max.z).applyMatrix4(U)])}function Rm(se,U){const W=se.min.clone(),ie=se.max.clone(),de=(new ge.Vector3).subVectors(ie,W);return(1&U)>0?W.z+=de.z/2:ie.z-=de.z/2,(2&U)>0?W.y+=de.y/2:ie.y-=de.y/2,(4&U)>0?W.x+=de.x/2:ie.x-=de.x/2,new ge.Box3(W,ie)}let Lh=(()=>{class se extends ge.EventDispatcher{constructor(W,ie,de){super(),this.id=se.idCount++,this.level=0,this.spacing=0,this.hasChildren=!1,this.children=[null,null,null,null,null,null,null,null],this.mean=new ge.Vector3,this.numPoints=0,this.loaded=!1,this.loading=!1,this.failed=!1,this.parent=null,this.oneTimeDisposeHandlers=[],this.isLeafNode=!0,this.isTreeNode=!1,this.isGeometryNode=!0,this.name=W,this.index=vf(W),this.pcoGeometry=ie,this.boundingBox=de,this.tightBoundingBox=de.clone(),this.boundingSphere=de.getBoundingSphere(new ge.Sphere)}dispose(){this.geometry&&this.parent&&(this.geometry.dispose(),this.geometry=void 0,this.loaded=!1,this.oneTimeDisposeHandlers.forEach(W=>W()),this.oneTimeDisposeHandlers=[])}getUrl(){const W=this.pcoGeometry,ie=W.loader.version,de=[W.octreeDir];return W.loader&&ie.equalOrHigher("1.5")?(de.push(this.getHierarchyBaseUrl()),de.push(this.name)):(ie.equalOrHigher("1.4")||ie.upTo("1.3"))&&de.push(this.name),de.join("/")}getHierarchyUrl(){return`${this.pcoGeometry.octreeDir}/${this.getHierarchyBaseUrl()}/${this.name}.hrc`}addChild(W){this.children[W.index]=W,this.isLeafNode=!1,W.parent=this}traverse(W,ie=!0){const de=ie?[this]:[];let Ue;for(;void 0!==(Ue=de.pop());){W(Ue);for(const Ke of Ue.children)null!==Ke&&de.push(Ke)}}load(){if(!this.canLoad())return Promise.resolve();let W;return this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.needsUpdate=!0,W=this.pcoGeometry.loader.version.equalOrHigher("1.5")&&this.level%this.pcoGeometry.hierarchyStepSize==0&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints(),W.catch(ie=>{throw this.loading=!1,this.failed=!0,this.pcoGeometry.numNodesLoading--,ie})}canLoad(){return!this.loading&&!this.loaded&&!this.pcoGeometry.disposed&&!this.pcoGeometry.loader.disposed&&this.pcoGeometry.numNodesLoading<this.pcoGeometry.maxNumNodesLoading}loadPoints(){return this.pcoGeometry.needsUpdate=!0,this.pcoGeometry.loader.load(this)}loadHierachyThenPoints(){return this.level%this.pcoGeometry.hierarchyStepSize!=0?Promise.resolve():Promise.resolve(this.pcoGeometry.loader.getUrl(this.getHierarchyUrl())).then(W=>this.pcoGeometry.xhrRequest(W,{mode:"cors"})).then(W=>Ys(W)).then(W=>W.arrayBuffer()).then(W=>Nl(W)).then(W=>this.loadHierarchy(this,W))}getHierarchyBaseUrl(){const W=this.pcoGeometry.hierarchyStepSize,ie=this.name.substr(1),de=Math.floor(ie.length/W);let Ue="r/";for(let Ke=0;Ke<de;Ke++)Ue+=ie.substr(Ke*W,W)+"/";return Ue.slice(0,-1)}loadHierarchy(W,ie){const de=new DataView(ie),Ue=this.getNodeData(W.name,0,de);W.numPoints=Ue.numPoints;const Ke=[Ue],Wt=[];let dn=5;for(;Ke.length>0;){const Yt=Ke.shift();let yi=1;for(let mn=0;mn<8&&dn+1<ie.byteLength;mn++){if(0!=(Yt.children&yi)){const lr=this.getNodeData(Yt.name+mn,dn,de);Wt.push(lr),Ke.push(lr),dn+=5}yi*=2}}W.pcoGeometry.needsUpdate=!0;const Ct=new Map;Ct.set(W.name,W),Wt.forEach(Yt=>this.addNode(Yt,W.pcoGeometry,Ct)),W.loadPoints()}getNodeData(W,ie,de){return{children:de.getUint8(ie),numPoints:de.getUint32(ie+1,!0),name:W}}addNode({name:W,numPoints:ie,children:de},Ue,Ke){const Wt=vf(W),dn=W.substring(0,W.length-1),Ct=Ke.get(dn),Yt=W.length-1,yi=Rm(Ct.boundingBox,Wt),mn=new se(W,Ue,yi);mn.level=Yt,mn.numPoints=ie,mn.hasChildren=de>0,mn.spacing=Ue.spacing/Math.pow(2,Yt),Ct.addChild(mn),Ke.set(W,mn)}}return se.idCount=0,se})();class Pm{constructor(U,W,ie,de,Ue){this.loader=U,this.boundingBox=W,this.tightBoundingBox=ie,this.offset=de,this.xhrRequest=Ue,this.disposed=!1,this.needsUpdate=!0,this.octreeDir="",this.hierarchyStepSize=-1,this.nodes={},this.numNodesLoading=0,this.maxNumNodesLoading=3,this.spacing=0,this.pointAttributes=new mu([]),this.projection=null,this.url=null}dispose(){this.loader.dispose(),this.root.traverse(U=>U.dispose()),this.disposed=!0}addNodeLoadedCallback(U){this.loader.callbacks.push(U)}clearNodeLoadedCallbacks(){this.loader.callbacks=[]}}class Fh extends ge.EventDispatcher{constructor(U,W){super(),this.pcIndex=void 0,this.boundingBoxNode=null,this.loaded=!0,this.isTreeNode=!0,this.isGeometryNode=!1,this.geometryNode=U,this.sceneNode=W,this.children=U.children.slice()}dispose(){this.geometryNode.dispose()}disposeSceneNode(){const U=this.sceneNode;if(U.geometry instanceof ge.BufferGeometry){const W=U.geometry.attributes;for(const ie in W)"position"===ie&&delete W[ie].array,delete W[ie];U.geometry.dispose(),U.geometry=void 0}}traverse(U,W){this.geometryNode.traverse(U,W)}get id(){return this.geometryNode.id}get name(){return this.geometryNode.name}get level(){return this.geometryNode.level}get isLeafNode(){return this.geometryNode.isLeafNode}get numPoints(){return this.geometryNode.numPoints}get index(){return this.geometryNode.index}get boundingSphere(){return this.geometryNode.boundingSphere}get boundingBox(){return this.geometryNode.boundingBox}get spacing(){return this.geometryNode.spacing}}function Nh(se,U,W){return Math.min(Math.max(U,se),W)}class Ii{dispose(){this.pickState&&(this.pickState.material.dispose(),this.pickState.renderTarget.dispose())}pick(U,W,ie,de,Ue={}){if(0===de.length)return null;const Ke=this.pickState?this.pickState:this.pickState=Ii.getPickState(),Wt=Ke.material,dn=U.getPixelRatio(),Ct=Math.ceil(U.domElement.clientWidth*dn),Yt=Math.ceil(U.domElement.clientHeight*dn);Ii.updatePickRenderTarget(this.pickState,Ct,Yt);const yi=Ii.helperVec3;Ue.pixelPosition?yi.copy(Ue.pixelPosition):(yi.addVectors(W.position,ie.direction).project(W),yi.x=(yi.x+1)*Ct*.5,yi.y=(yi.y+1)*Yt*.5);const mn=Math.floor((Ue.pickWindowSize||15)*dn),lr=(mn-1)/2,Es=Math.floor(Nh(yi.x-lr,0,Ct)),Qi=Math.floor(Nh(yi.y-lr,0,Yt));Ii.prepareRender(U,Es,Qi,mn,Wt,Ke);const $n=Ii.render(U,W,Wt,de,ie,Ke,Ue);Wt.clearVisibleNodeTextureOffsets();const ps=Ii.readPixels(U,Es,Qi,mn),_r=Ii.findHit(ps,mn);return Ii.getPickPoint(_r,$n)}static prepareRender(U,W,ie,de,Ue,Ke){U.setScissor(W,ie,de,de),U.setScissorTest(!0),U.state.buffers.depth.setTest(Ue.depthTest),U.state.buffers.depth.setMask(Ue.depthWrite),U.state.setBlending(ge.NoBlending),U.setRenderTarget(Ke.renderTarget),U.getClearColor(this.clearColor);const Wt=U.getClearAlpha();U.setClearColor(Oa,0),U.clear(!0,!0,!0),U.setClearColor(this.clearColor,Wt)}static render(U,W,ie,de,Ue,Ke,Wt){const dn=[];for(const Ct of de){const Yt=Ii.nodesOnRay(Ct,Ue);Yt.length&&(Ii.updatePickMaterial(ie,Ct.material,Wt),ie.updateMaterial(Ct,Yt,W,U),Wt.onBeforePickRender&&Wt.onBeforePickRender(ie,Ke.renderTarget),Ke.scene.children=Ii.createTempNodes(Ct,Yt,ie,dn.length),U.render(Ke.scene,W),Yt.forEach(yi=>dn.push({node:yi,octree:Ct})))}return dn}static nodesOnRay(U,W){const ie=[],de=W.clone();for(const Ue of U.visibleNodes){const Ke=Ii.helperSphere.copy(Ue.boundingSphere).applyMatrix4(U.matrixWorld);de.intersectsSphere(Ke)&&ie.push(Ue)}return ie}static readPixels(U,W,ie,de){const Ue=new Uint8Array(4*de*de);return U.readRenderTargetPixels(U.getRenderTarget(),W,ie,de,de,Ue),U.setScissorTest(!1),U.setRenderTarget(null),Ue}static createTempNodes(U,W,ie,de){const Ue=[];for(let Ke=0;Ke<W.length;Ke++){const Wt=W[Ke],dn=Wt.sceneNode,Ct=new ge.Points(dn.geometry,ie);Ct.matrix=dn.matrix,Ct.matrixWorld=dn.matrixWorld,Ct.matrixAutoUpdate=!1,Ct.frustumCulled=!1;const Yt=de+Ke+1;Yt>255&&console.error("More than 255 nodes for pick are not supported."),Ct.onBeforeRender=kt.makeOnBeforeRender(U,Wt,Yt),Ue.push(Ct)}return Ue}static updatePickMaterial(U,W,ie){U.pointSizeType=W.pointSizeType,U.shape=W.shape,U.size=W.size,U.minSize=W.minSize,U.maxSize=W.maxSize,U.classification=W.classification,U.useFilterByNormal=W.useFilterByNormal,U.filterByNormalThreshold=W.filterByNormalThreshold,ie.pickOutsideClipRegion?U.clipMode=cn.DISABLED:(U.clipMode=W.clipMode,U.setClipBoxes(W.clipMode===cn.CLIP_OUTSIDE?W.clipBoxes:[]))}static updatePickRenderTarget(U,W,ie){U.renderTarget.width===W&&U.renderTarget.height===ie||(U.renderTarget.dispose(),U.renderTarget=Ii.makePickRenderTarget(),U.renderTarget.setSize(W,ie))}static makePickRenderTarget(){return new ge.WebGLRenderTarget(1,1,{minFilter:ge.LinearFilter,magFilter:ge.NearestFilter,format:ge.RGBAFormat})}static findHit(U,W){const ie=new Uint32Array(U.buffer);let de=Number.MAX_VALUE,Ue=null;for(let Ke=0;Ke<W;Ke++)for(let Wt=0;Wt<W;Wt++){const dn=Ke+Wt*W,Ct=Math.pow(Ke-(W-1)/2,2)+Math.pow(Wt-(W-1)/2,2),Yt=U[4*dn+3];U[4*dn+3]=0;const yi=ie[dn];Yt>0&&Ct<de&&(Ue={pIndex:yi,pcIndex:Yt-1},de=Ct)}return Ue}static getPickPoint(U,W){if(!U)return null;const ie={},de=W[U.pcIndex]&&W[U.pcIndex].node.sceneNode;if(!de)return null;ie.pointCloud=W[U.pcIndex].octree;const Ue=de.geometry.attributes;for(const Ke in Ue){if(!Ue.hasOwnProperty(Ke))continue;const Wt=Ue[Ke];if("position"===Ke)Ii.addPositionToPickPoint(ie,U,Wt,de);else if("normal"===Ke)Ii.addNormalToPickPoint(ie,U,Wt,de);else if("indices"!==Ke)if(1===Wt.itemSize)ie[Ke]=Wt.array[U.pIndex];else{const dn=[];for(let Ct=0;Ct<Wt.itemSize;Ct++)dn.push(Wt.array[Wt.itemSize*U.pIndex+Ct]);ie[Ke]=dn}}return ie}static addPositionToPickPoint(U,W,ie,de){U.position=(new ge.Vector3).fromBufferAttribute(ie,W.pIndex).applyMatrix4(de.matrixWorld)}static addNormalToPickPoint(U,W,ie,de){const Ue=(new ge.Vector3).fromBufferAttribute(ie,W.pIndex),Ke=new ge.Vector4(Ue.x,Ue.y,Ue.z,0).applyMatrix4(de.matrixWorld);Ue.set(Ke.x,Ke.y,Ke.z),U.normal=Ue}static getPickState(){const U=new ge.Scene;U.autoUpdate=!1;const W=new kt;return W.pointColorType=gi.POINT_INDEX,{renderTarget:Ii.makePickRenderTarget(),material:W,scene:U}}}Ii.helperVec3=new ge.Vector3,Ii.helperSphere=new ge.Sphere,Ii.clearColor=new ge.Color;class Va extends ge.Object3D{constructor(){super(...arguments),this.root=null}initialized(){return null!==this.root}}class gu extends Va{constructor(U,W,ie){super(),this.disposed=!1,this.level=0,this.maxLevel=1/0,this.minNodePixelSize=50,this.root=null,this.boundingBoxNodes=[],this.visibleNodes=[],this.visibleGeometry=[],this.numVisiblePoints=0,this.showBoundingBox=!1,this.visibleBounds=new ge.Box3,this.name="",this.potree=U,this.root=W.root,this.pcoGeometry=W,this.boundingBox=W.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new ge.Sphere),this.position.copy(W.offset),this.updateMatrix(),this.material=ie||new kt,this.initMaterial(this.material)}initMaterial(U){this.updateMatrixWorld(!0);const{min:W,max:ie}=Dm(this.pcoGeometry.tightBoundingBox||this.getBoundingBoxWorld(),this.matrixWorld),de=ie.z-W.z;U.heightMin=W.z-.2*de,U.heightMax=ie.z+.2*de}dispose(){this.root&&this.root.dispose(),this.pcoGeometry.root.traverse(U=>this.potree.lru.remove(U)),this.pcoGeometry.dispose(),this.material.dispose(),this.visibleNodes=[],this.visibleGeometry=[],this.picker&&(this.picker.dispose(),this.picker=void 0),this.disposed=!0}get pointSizeType(){return this.material.pointSizeType}set pointSizeType(U){this.material.pointSizeType=U}toTreeNode(U,W){const ie=new ge.Points(U.geometry,this.material),de=new Fh(U,ie);return ie.name=U.name,ie.position.copy(U.boundingBox.min),ie.frustumCulled=!1,ie.onBeforeRender=kt.makeOnBeforeRender(this,de),W?(W.sceneNode.add(ie),W.children[U.index]=de,U.oneTimeDisposeHandlers.push(()=>{de.disposeSceneNode(),W.sceneNode.remove(de.sceneNode),W.children[U.index]=U})):(this.root=de,this.add(ie)),de}updateVisibleBounds(){const U=this.visibleBounds;U.min.set(1/0,1/0,1/0),U.max.set(-1/0,-1/0,-1/0);for(const W of this.visibleNodes)W.isLeafNode&&(U.expandByPoint(W.boundingBox.min),U.expandByPoint(W.boundingBox.max))}updateBoundingBoxes(){if(!this.showBoundingBox||!this.parent)return;let U=this.parent.getObjectByName("bbroot");U||(U=new ge.Object3D,U.name="bbroot",this.parent.add(U));const W=[];for(const ie of this.visibleNodes)void 0!==ie.boundingBoxNode&&ie.isLeafNode&&W.push(ie.boundingBoxNode);U.children=W}updateMatrixWorld(U){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==U||(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,U=!0)}hideDescendants(U){const W=[];for(ie(U);W.length>0;){const de=W.shift();de.visible=!1,ie(de)}function ie(de){for(const Ue of de.children)Ue.visible&&W.push(Ue)}}moveToOrigin(){this.position.set(0,0,0),this.position.set(0,0,0).sub(this.getBoundingBoxWorld().getCenter(new ge.Vector3))}moveToGroundPlane(){this.position.y+=-this.getBoundingBoxWorld().min.y}getBoundingBoxWorld(){return this.updateMatrixWorld(!0),Dm(this.boundingBox,this.matrixWorld)}getVisibleExtent(){return this.visibleBounds.applyMatrix4(this.matrixWorld)}pick(U,W,ie,de={}){return this.picker=this.picker||new Ii,this.picker.pick(U,W,ie,[this],de)}get progress(){return 0===this.visibleGeometry.length?0:this.visibleNodes.length/this.visibleGeometry.length}}const Dr=document.createElement("canvas").getContext("webgl"),yu={SHADER_INTERPOLATION:oo("EXT_frag_depth")&&fs(8),SHADER_SPLATS:oo("EXT_frag_depth")&&oo("OES_texture_float")&&fs(8),SHADER_EDL:oo("OES_texture_float")&&fs(8),precision:function(){if(null===Dr)return"";const se=Dr.getShaderPrecisionFormat(Dr.VERTEX_SHADER,Dr.HIGH_FLOAT),U=Dr.getShaderPrecisionFormat(Dr.VERTEX_SHADER,Dr.MEDIUM_FLOAT),W=Dr.getShaderPrecisionFormat(Dr.FRAGMENT_SHADER,Dr.HIGH_FLOAT),ie=Dr.getShaderPrecisionFormat(Dr.FRAGMENT_SHADER,Dr.MEDIUM_FLOAT);return se&&W&&se.precision>0&&W.precision>0?"highp":U&&ie&&U.precision>0&&ie.precision>0?"mediump":"lowp"}()};function oo(se){return null!==Dr&&Boolean(Dr.getExtension(se))}function fs(se){return null!==Dr&&Dr.getParameter(Dr.MAX_VARYING_VECTORS)>=se}class Oh{constructor(){this.resolvers=[],this.promises=[]}enqueue(U){this.resolvers.length||this.add(),this.resolvers.shift()(U)}dequeue(){return this.promises.length||this.add(),this.promises.shift()}add(){this.promises.push(new Promise(U=>{this.resolvers.push(U)}))}}class Br{constructor(U,W){this.wrappedWorker=U,this.maxIdle=W,this.timeoutId=void 0,this.terminated=!1}get worker(){return this.wrappedWorker}get isTerminated(){return this.terminated}markIdle(){this.timeoutId=window.setTimeout(()=>{this.terminated=!0,this.wrappedWorker.terminate()},this.maxIdle)}markInUse(){this.timeoutId&&window.clearTimeout(this.timeoutId)}}let wf=(()=>{class se{constructor(W,ie){this.maxWorkers=W,this.workerType=ie,this.pool=new Oh,this.poolSize=0}getWorker(){return this.poolSize<this.maxWorkers?(this.poolSize++,Promise.resolve(new Br(new this.workerType,se.POOL_MAX_IDLE))):this.pool.dequeue().then(W=>(W.markInUse(),W.isTerminated?(this.poolSize--,this.getWorker()):W))}releaseWorker(W){W.markIdle(),this.pool.enqueue(W)}}return se.POOL_MAX_IDLE=7e3,se})();class Mc{constructor(U){this.versionMinor=0,this.version=U;const W=-1===U.indexOf(".")?U.length:U.indexOf(".");this.versionMajor=parseInt(U.substr(0,W),10),this.versionMinor=parseInt(U.substr(W+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}newerThan(U){const W=new Mc(U);return this.versionMajor>W.versionMajor||this.versionMajor===W.versionMajor&&this.versionMinor>W.versionMinor}equalOrHigher(U){const W=new Mc(U);return this.versionMajor>W.versionMajor||this.versionMajor===W.versionMajor&&this.versionMinor>=W.versionMinor}upTo(U){return!this.newerThan(U)}}class la{constructor({getUrl:U=(Ke=>Promise.resolve(Ke)),version:W,boundingBox:ie,scale:de,xhrRequest:Ue}){this.disposed=!1,this.version="string"==typeof W?new Mc(W):W,this.xhrRequest=Ue,this.getUrl=U,this.boundingBox=ie,this.scale=de,this.callbacks=[]}dispose(){this.disposed=!0}load(U){return U.loaded||this.disposed?Promise.resolve():Promise.resolve(this.getUrl(this.getNodeUrl(U))).then(W=>this.xhrRequest(W,{mode:"cors"})).then(W=>Ys(W)).then(W=>W.arrayBuffer()).then(W=>Nl(W)).then(W=>new Promise(ie=>this.parse(U,W,ie)))}getNodeUrl(U){let W=U.getUrl();return this.version.equalOrHigher("1.4")&&(W+=".bin"),W}parse(U,W,ie){this.disposed?ie():la.WORKER_POOL.getWorker().then(de=>{const Ue=U.pcoGeometry.pointAttributes,Ke=W.byteLength/Ue.byteSize;this.version.upTo("1.5")&&(U.numPoints=Ke),de.worker.onmessage=dn=>{if(this.disposed)return ie(),void la.WORKER_POOL.releaseWorker(de);const Ct=dn.data,Yt=U.geometry=U.geometry||new ge.BufferGeometry;Yt.boundingBox=U.boundingBox,this.addBufferAttributes(Yt,Ct.attributeBuffers),this.addIndices(Yt,Ct.indices),this.addNormalAttribute(Yt,Ke),U.mean=(new ge.Vector3).fromArray(Ct.mean),U.tightBoundingBox=this.getTightBoundingBox(Ct.tightBoundingBox),U.loaded=!0,U.loading=!1,U.failed=!1,U.pcoGeometry.numNodesLoading--,U.pcoGeometry.needsUpdate=!0,this.callbacks.forEach(yi=>yi(U)),ie(),la.WORKER_POOL.releaseWorker(de)};const Wt={buffer:W,pointAttributes:Ue,version:this.version.version,min:U.boundingBox.min.toArray(),offset:U.pcoGeometry.offset.toArray(),scale:this.scale,spacing:U.spacing,hasChildren:U.hasChildren};de.worker.postMessage(Wt,[Wt.buffer])})}getTightBoundingBox({min:U,max:W}){const ie=new ge.Box3((new ge.Vector3).fromArray(U),(new ge.Vector3).fromArray(W));return ie.max.sub(ie.min),ie.min.set(0,0,0),ie}addBufferAttributes(U,W){Object.keys(W).forEach(ie=>{const de=W[ie].buffer;this.isAttribute(ie,wn.POSITION_CARTESIAN)?U.setAttribute("position",new ge.BufferAttribute(new Float32Array(de),3)):this.isAttribute(ie,wn.COLOR_PACKED)?U.setAttribute("color",new ge.BufferAttribute(new Uint8Array(de),3,!0)):this.isAttribute(ie,wn.INTENSITY)?U.setAttribute("intensity",new ge.BufferAttribute(new Float32Array(de),1)):this.isAttribute(ie,wn.CLASSIFICATION)?U.setAttribute("classification",new ge.BufferAttribute(new Uint8Array(de),1)):(this.isAttribute(ie,wn.NORMAL_SPHEREMAPPED)||this.isAttribute(ie,wn.NORMAL_OCT16)||this.isAttribute(ie,wn.NORMAL))&&U.setAttribute("normal",new ge.BufferAttribute(new Float32Array(de),3))})}addIndices(U,W){const ie=new ge.Uint8BufferAttribute(W,4);ie.normalized=!0,U.setAttribute("indices",ie)}addNormalAttribute(U,W){if(!U.getAttribute("normal")){const ie=new Float32Array(3*W);U.setAttribute("normal",new ge.BufferAttribute(new Float32Array(ie),3))}}isAttribute(U,W){return parseInt(U,10)===W}}function kr(se){return{index:vf(se),parentName:se.substring(0,se.length-1),level:se.length-1}}function Im(se){return null!=se&&se.isGeometryNode}function Lm(se){return null!=se&&se.isTreeNode}la.WORKER_POOL=new wf(32,Et(6));var Ua=Et(1);class Fm extends ge.LineSegments{constructor(U,W=new ge.Color(16776960)){const ie=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),de=new Float32Array([U.min.x,U.min.y,U.min.z,U.max.x,U.min.y,U.min.z,U.max.x,U.min.y,U.max.z,U.min.x,U.min.y,U.max.z,U.min.x,U.max.y,U.min.z,U.max.x,U.max.y,U.min.z,U.max.x,U.max.y,U.max.z,U.min.x,U.max.y,U.max.z]),Ue=new ge.BufferGeometry;Ue.setIndex(new ge.BufferAttribute(ie,1)),Ue.setAttribute("position",new ge.BufferAttribute(de,3)),super(Ue,new ge.LineBasicMaterial({color:W}))}}class za{constructor(U){this.node=U,this.next=null,this.previous=null}}class Mf{constructor(U=1e6){this.pointBudget=U,this.first=null,this.last=null,this.numPoints=0,this.items=new Map}get size(){return this.items.size}has(U){return this.items.has(U.id)}touch(U){if(!U.loaded)return;const W=this.items.get(U.id);W?this.touchExisting(W):this.addNew(U)}addNew(U){const W=new za(U);W.previous=this.last,this.last=W,W.previous&&(W.previous.next=W),this.first||(this.first=W),this.items.set(U.id,W),this.numPoints+=U.numPoints}touchExisting(U){U.previous?U.next&&(U.previous.next=U.next,U.next.previous=U.previous,U.previous=this.last,U.next=null,this.last=U,U.previous&&(U.previous.next=U)):U.next&&(this.first=U.next,this.first.previous=null,U.previous=this.last,U.next=null,this.last=U,U.previous&&(U.previous.next=U))}remove(U){const W=this.items.get(U.id);W&&(1===this.items.size?(this.first=null,this.last=null):(W.previous||(this.first=W.next,this.first.previous=null),W.next||(this.last=W.previous,this.last.next=null),W.previous&&W.next&&(W.previous.next=W.next,W.next.previous=W.previous)),this.items.delete(U.id),this.numPoints-=U.numPoints)}getLRUItem(){return this.first?this.first.node:void 0}freeMemory(){if(!(this.items.size<=1))for(;this.numPoints>2*this.pointBudget;){const U=this.getLRUItem();U&&this.disposeSubtree(U)}}disposeSubtree(U){const W=[U];U.traverse(ie=>{ie.loaded&&W.push(ie)});for(const ie of W)ie.dispose(),this.remove(ie)}}class _u{constructor(U,W,ie,de){this.pointCloudIndex=U,this.weight=W,this.node=ie,this.parent=de}}class ca{constructor(){this._pointBudget=1e6,this._rendererSize=new ge.Vector2,this.maxNumNodesLoading=4,this.features=yu,this.lru=new Mf(this._pointBudget),this.updateVisibilityStructures=(()=>{const U=new ge.Matrix4,W=new ge.Matrix4,ie=new ge.Matrix4;return(de,Ue)=>{const Ke=[],Wt=[],dn=new Ua.BinaryHeap(Ct=>1/Ct.weight);for(let Ct=0;Ct<de.length;Ct++){const Yt=de[Ct];if(!Yt.initialized())continue;Yt.numVisiblePoints=0,Yt.visibleNodes=[],Yt.visibleGeometry=[],Ue.updateMatrixWorld(!1);const yi=Ue.matrixWorldInverse,mn=Yt.matrixWorld;U.identity().multiply(Ue.projectionMatrix).multiply(yi).multiply(mn),Ke.push((new ge.Frustum).setFromProjectionMatrix(U)),W.copy(mn).invert(),ie.identity().multiply(W).multiply(Ue.matrixWorld),Wt.push((new ge.Vector3).setFromMatrixPosition(ie)),Yt.visible&&null!==Yt.root&&dn.push(new _u(Ct,Number.MAX_VALUE,Yt.root)),Lm(Yt.root)&&Yt.hideDescendants(Yt.root.sceneNode);for(const lr of Yt.boundingBoxNodes)lr.visible=!1}return{frustums:Ke,cameraPositions:Wt,priorityQueue:dn}}})()}loadPointCloud(U,W,ie=((de,Ue)=>fetch(de,Ue))){return function Ex(se,U,W){return Promise.resolve(U(se)).then(ie=>{return W(ie,{mode:"cors"}).then(de=>Ys(de)).then(de=>de.json()).then((de=ie,Ue=U,Ke=W,Wt=>{const{offset:dn,boundingBox:Ct,tightBoundingBox:Yt}=function(Qi){const $n=new ge.Vector3(Qi.boundingBox.lx,Qi.boundingBox.ly,Qi.boundingBox.lz),ps=new ge.Vector3(Qi.boundingBox.ux,Qi.boundingBox.uy,Qi.boundingBox.uz),_r=new ge.Box3($n,ps),br=_r.clone(),Ss=$n.clone();if(Qi.tightBoundingBox){const{lx:il,ly:Ol,lz:vu,ux:Bl,uy:Ec,uz:ua}=Qi.tightBoundingBox;br.min.set(il,Ol,vu),br.max.set(Bl,Ec,ua)}return _r.min.sub(Ss),_r.max.sub(Ss),br.min.sub(Ss),br.max.sub(Ss),{offset:Ss,boundingBox:_r,tightBoundingBox:br}}(Wt),yi=new la({getUrl:Ue,version:Wt.version,boundingBox:Ct,scale:Wt.scale,xhrRequest:Ke}),mn=new Pm(yi,Ct,Yt,dn,Ke);mn.url=de,mn.octreeDir=Wt.octreeDir,mn.needsUpdate=!0,mn.spacing=Wt.spacing,mn.hierarchyStepSize=Wt.hierarchyStepSize,mn.projection=Wt.projection,mn.offset=dn,mn.pointAttributes=new mu(Wt.pointAttributes);const lr={},Es=new Mc(Wt.version);return function(Qi,$n,ps,_r){const br=new Lh("r",Qi,Qi.boundingBox);return br.hasChildren=!0,br.spacing=Qi.spacing,br.numPoints=_r.upTo("1.5")?$n.hierarchy[0][1]:0,Qi.root=br,ps.r=br,Qi.root.load()}(mn,Wt,lr,Es).then(()=>(Es.upTo("1.4")&&function(Qi,$n,ps){for(let _r=1;_r<$n.hierarchy.length;_r++){const[br,Ss]=$n.hierarchy[_r],{index:il,parentName:Ol,level:vu}=kr(br),Bl=ps[Ol],Ec=Rm(Bl.boundingBox,il),ua=new Lh(br,Qi,Ec);ua.level=vu,ua.numPoints=Ss,ua.spacing=Qi.spacing/Math.pow(2,ua.level),ps[br]=ua,Bl.addChild(ua)}}(mn,Wt,lr),mn.nodes=lr,mn))}));var de,Ue,Ke})}(U,W,ie).then(de=>new gu(this,de))}updatePointClouds(U,W,ie){const de=this.updateVisibility(U,W,ie);for(let Ue=0;Ue<U.length;Ue++){const Ke=U[Ue];Ke.disposed||(Ke.material.updateMaterial(Ke,Ke.visibleNodes,W,ie),Ke.updateVisibleBounds(),Ke.updateBoundingBoxes())}return this.lru.freeMemory(),de}static pick(U,W,ie,de,Ue={}){return ca.picker=ca.picker||new Ii,ca.picker.pick(W,ie,de,U,Ue)}get pointBudget(){return this._pointBudget}set pointBudget(U){U!==this._pointBudget&&(this._pointBudget=U,this.lru.pointBudget=U,this.lru.freeMemory())}static set maxLoaderWorkers(U){la.WORKER_POOL.maxWorkers=U}static get maxLoaderWorkers(){return la.WORKER_POOL.maxWorkers}updateVisibility(U,W,ie){let de=0;const Ue=[],Ke=[],{frustums:Wt,cameraPositions:dn,priorityQueue:Ct}=this.updateVisibilityStructures(U,W);let Yt,yi=0,mn=!1,lr=!1;for(;void 0!==(Yt=Ct.pop());){let $n=Yt.node;if(de+$n.numPoints>this.pointBudget)break;const ps=Yt.pointCloudIndex,_r=U[ps];if($n.level>(void 0!==_r.maxLevel?_r.maxLevel:1/0)||!Wt[ps].intersectsBox($n.boundingBox)||this.shouldClip(_r,$n.boundingBox))continue;de+=$n.numPoints,_r.numVisiblePoints+=$n.numPoints;const Ss=Yt.parent;if(Im($n)&&(!Ss||Lm(Ss)))if($n.loaded&&yi<2)$n=_r.toTreeNode($n,Ss),yi++;else{if($n.failed){lr=!0;continue}$n.loaded&&yi>=2&&(mn=!0),Ke.push($n),_r.visibleGeometry.push($n)}Lm($n)&&(this.updateTreeNodeVisibility(_r,$n,Ue),_r.visibleGeometry.push($n.geometryNode));const il=.5*ie.getSize(this._rendererSize).height*ie.getPixelRatio();this.updateChildVisibility(Yt,Ct,_r,$n,dn[ps],W,il)}const Es=Math.min(this.maxNumNodesLoading,Ke.length),Qi=[];for(let $n=0;$n<Es;$n++)Qi.push(Ke[$n].load());return{visibleNodes:Ue,numVisiblePoints:de,exceededMaxLoadsToGPU:mn,nodeLoadFailed:lr,nodeLoadPromises:Qi}}updateTreeNodeVisibility(U,W,ie){this.lru.touch(W.geometryNode);const de=W.sceneNode;de.visible=!0,de.material=U.material,de.updateMatrix(),de.matrixWorld.multiplyMatrices(U.matrixWorld,de.matrix),ie.push(W),U.visibleNodes.push(W),this.updateBoundingBoxVisibility(U,W)}updateChildVisibility(U,W,ie,de,Ue,Ke,Wt){const dn=de.children;for(let Ct=0;Ct<dn.length;Ct++){const Yt=dn[Ct];if(null===Yt)continue;const yi=Yt.boundingSphere,mn=yi.center.distanceTo(Ue),lr=yi.radius;let Es=0;if("PerspectiveCamera"===Ke.type){const ps=Ke.fov*Math.PI/180;Es=Wt/(Math.tan(ps/2)*mn)}else Es=2*Wt/(Ke.top-Ke.bottom);const Qi=lr*Es;Qi<ie.minNodePixelSize||W.push(new _u(U.pointCloudIndex,mn<lr?Number.MAX_VALUE:Qi+1/mn,Yt,de))}}updateBoundingBoxVisibility(U,W){if(U.showBoundingBox&&!W.boundingBoxNode){const ie=new Fm(W.boundingBox);ie.matrixAutoUpdate=!1,U.boundingBoxNodes.push(ie),W.boundingBoxNode=ie,W.boundingBoxNode.matrix.copy(U.matrixWorld)}else U.showBoundingBox&&W.boundingBoxNode?(W.boundingBoxNode.visible=!0,W.boundingBoxNode.matrix.copy(U.matrixWorld)):!U.showBoundingBox&&W.boundingBoxNode&&(W.boundingBoxNode.visible=!1)}shouldClip(U,W){const ie=U.material;if(0===ie.numClipBoxes||ie.clipMode!==cn.CLIP_OUTSIDE)return!1;const de=W.clone();U.updateMatrixWorld(!0),de.applyMatrix4(U.matrixWorld);const Ue=ie.clipBoxes;for(let Ke=0;Ke<Ue.length;Ke++){const Wt=Ue[Ke].matrix,dn=new ge.Box3(new ge.Vector3(-.5,-.5,-.5),new ge.Vector3(.5,.5,.5)).applyMatrix4(Wt);if(de.intersectsBox(dn))return!1}return!0}}}]))},926:xo=>{function O(so,ar,gt,Et,cn,Qt,Dn){try{var ai=so[Qt](Dn),ji=ai.value}catch(gi){return void gt(gi)}ai.done?ar(ji):Promise.resolve(ji).then(Et,cn)}xo.exports=function ro(so){return function(){var ar=this,gt=arguments;return new Promise(function(Et,cn){var Qt=so.apply(ar,gt);function Dn(ji){O(Qt,Et,cn,Dn,ai,"next",ji)}function ai(ji){O(Qt,Et,cn,Dn,ai,"throw",ji)}Dn(void 0)})}},xo.exports.__esModule=!0,xo.exports.default=xo.exports},712:(xo,O,ro)=>{"use strict";var so=ro(926).default;Object.defineProperty(O,"__esModule",{value:!0});const Ii=301,Va=302,oo=1e3,fs=1001,Oh=1002,Br=1003,kr=1006,Ua=1008,za=1009,ca=1012,U=1014,W=1015,ie=1016,Ke=1020,Ct=1023,mn=1026,lr=1027,br=33776,Ss=33777,il=33778,Ol=33779,xu=2300,Mn=2301,bu=2400,kh=2401,km=2402,Cs=3e3,wr=3001,rl="srgb",Mu="srgb-linear",Uh=35044,En=35048,Rx="300 es";class Tc{addEventListener(r,a){void 0===this._listeners&&(this._listeners={});const c=this._listeners;void 0===c[r]&&(c[r]=[]),-1===c[r].indexOf(a)&&c[r].push(a)}hasEventListener(r,a){if(void 0===this._listeners)return!1;const c=this._listeners;return void 0!==c[r]&&-1!==c[r].indexOf(a)}removeEventListener(r,a){if(void 0===this._listeners)return;const h=this._listeners[r];if(void 0!==h){const p=h.indexOf(a);-1!==p&&h.splice(p,1)}}dispatchEvent(r){if(void 0===this._listeners)return;const c=this._listeners[r.type];if(void 0!==c){r.target=this;const h=c.slice(0);for(let p=0,g=h.length;p<g;p++)h[p].call(this,r);r.target=null}}}const Ks=[];for(let d=0;d<256;d++)Ks[d]=(d<16?"0":"")+d.toString(16);let Px=1234567;const zh=Math.PI/180,Bi=180/Math.PI;function ha(){const d=4294967295*Math.random()|0,r=4294967295*Math.random()|0,a=4294967295*Math.random()|0,c=4294967295*Math.random()|0;return(Ks[255&d]+Ks[d>>8&255]+Ks[d>>16&255]+Ks[d>>24&255]+"-"+Ks[255&r]+Ks[r>>8&255]+"-"+Ks[r>>16&15|64]+Ks[r>>24&255]+"-"+Ks[63&a|128]+Ks[a>>8&255]+"-"+Ks[a>>16&255]+Ks[a>>24&255]+Ks[255&c]+Ks[c>>8&255]+Ks[c>>16&255]+Ks[c>>24&255]).toLowerCase()}function ns(d,r,a){return Math.max(r,Math.min(a,d))}function Ac(d,r){return(d%r+r)%r}function Eu(d,r,a){return(1-a)*d+a*r}function $s(d){return 0==(d&d-1)&&0!==d}function Ox(d){return Math.pow(2,Math.ceil(Math.log(d)/Math.LN2))}function Df(d){return Math.pow(2,Math.floor(Math.log(d)/Math.LN2))}var Vl=Object.freeze({__proto__:null,DEG2RAD:zh,RAD2DEG:Bi,generateUUID:ha,clamp:ns,euclideanModulo:Ac,mapLinear:function cr(d,r,a,c,h){return c+(d-r)*(h-c)/(a-r)},inverseLerp:function Um(d,r,a){return d!==r?(a-d)/(r-d):0},lerp:Eu,damp:function f_(d,r,a,c){return Eu(d,r,1-Math.exp(-a*c))},pingpong:function Ix(d,r=1){return r-Math.abs(Ac(d,2*r)-r)},smoothstep:function kl(d,r,a){return d<=r?0:d>=a?1:(d=(d-r)/(a-r))*d*(3-2*d)},smootherstep:function Tf(d,r,a){return d<=r?0:d>=a?1:(d=(d-r)/(a-r))*d*d*(d*(6*d-15)+10)},randInt:function iC(d,r){return d+Math.floor(Math.random()*(r-d+1))},randFloat:function Ts(d,r){return d+Math.random()*(r-d)},randFloatSpread:function Af(d){return d*(.5-Math.random())},seededRandom:function Lx(d){void 0!==d&&(Px=d);let r=Px+=1831565813;return r=Math.imul(r^r>>>15,1|r),r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296},degToRad:function Fx(d){return d*zh},radToDeg:function Nx(d){return d*Bi},isPowerOfTwo:$s,ceilPowerOfTwo:Ox,floorPowerOfTwo:Df,setQuaternionFromProperEuler:function Pn(d,r,a,c,h){const p=Math.cos,g=Math.sin,_=p(a/2),w=g(a/2),M=p((r+c)/2),S=g((r+c)/2),T=p((r-c)/2),D=g((r-c)/2),R=p((c-r)/2),L=g((c-r)/2);switch(h){case"XYX":d.set(_*S,w*T,w*D,_*M);break;case"YZY":d.set(w*D,_*S,w*T,_*M);break;case"ZXZ":d.set(w*T,w*D,_*S,_*M);break;case"XZX":d.set(_*S,w*L,w*R,_*M);break;case"YXY":d.set(w*R,_*S,w*L,_*M);break;case"ZYZ":d.set(w*L,w*R,_*S,_*M);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+h)}},normalize:function lo(d,r){switch(r.constructor){case Float32Array:return d;case Uint16Array:return Math.round(65535*d);case Uint8Array:return Math.round(255*d);case Int16Array:return Math.round(32767*d);case Int8Array:return Math.round(127*d);default:throw new Error("Invalid component type.")}},denormalize:function wo(d,r){switch(r.constructor){case Float32Array:return d;case Uint16Array:return d/65535;case Uint8Array:return d/255;case Int16Array:return Math.max(d/32767,-1);case Int8Array:return Math.max(d/127,-1);default:throw new Error("Invalid component type.")}}});class Qe{constructor(r=0,a=0){this.x=r,this.y=a}get width(){return this.x}set width(r){this.x=r}get height(){return this.y}set height(r){this.y=r}set(r,a){return this.x=r,this.y=a,this}setScalar(r){return this.x=r,this.y=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setComponent(r,a){switch(r){case 0:this.x=a;break;case 1:this.y=a;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y)}copy(r){return this.x=r.x,this.y=r.y,this}add(r,a){return void 0!==a?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(r,a)):(this.x+=r.x,this.y+=r.y,this)}addScalar(r){return this.x+=r,this.y+=r,this}addVectors(r,a){return this.x=r.x+a.x,this.y=r.y+a.y,this}addScaledVector(r,a){return this.x+=r.x*a,this.y+=r.y*a,this}sub(r,a){return void 0!==a?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(r,a)):(this.x-=r.x,this.y-=r.y,this)}subScalar(r){return this.x-=r,this.y-=r,this}subVectors(r,a){return this.x=r.x-a.x,this.y=r.y-a.y,this}multiply(r){return this.x*=r.x,this.y*=r.y,this}multiplyScalar(r){return this.x*=r,this.y*=r,this}divide(r){return this.x/=r.x,this.y/=r.y,this}divideScalar(r){return this.multiplyScalar(1/r)}applyMatrix3(r){const a=this.x,c=this.y,h=r.elements;return this.x=h[0]*a+h[3]*c+h[6],this.y=h[1]*a+h[4]*c+h[7],this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this}clamp(r,a){return this.x=Math.max(r.x,Math.min(a.x,this.x)),this.y=Math.max(r.y,Math.min(a.y,this.y)),this}clampScalar(r,a){return this.x=Math.max(r,Math.min(a,this.x)),this.y=Math.max(r,Math.min(a,this.y)),this}clampLength(r,a){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(r,Math.min(a,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(r){return this.x*r.x+this.y*r.y}cross(r){return this.x*r.y-this.y*r.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const a=this.x-r.x,c=this.y-r.y;return a*a+c*c}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,a){return this.x+=(r.x-this.x)*a,this.y+=(r.y-this.y)*a,this}lerpVectors(r,a,c){return this.x=r.x+(a.x-r.x)*c,this.y=r.y+(a.y-r.y)*c,this}equals(r){return r.x===this.x&&r.y===this.y}fromArray(r,a=0){return this.x=r[a],this.y=r[a+1],this}toArray(r=[],a=0){return r[a]=this.x,r[a+1]=this.y,r}fromBufferAttribute(r,a,c){return void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=r.getX(a),this.y=r.getY(a),this}rotateAround(r,a){const c=Math.cos(a),h=Math.sin(a),p=this.x-r.x,g=this.y-r.y;return this.x=p*c-g*h+r.x,this.y=p*h+g*c+r.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Qe.prototype.isVector2=!0;class Yi{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(r,a,c,h,p,g,_,w,M){const S=this.elements;return S[0]=r,S[1]=h,S[2]=_,S[3]=a,S[4]=p,S[5]=w,S[6]=c,S[7]=g,S[8]=M,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const a=this.elements,c=r.elements;return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],this}extractBasis(r,a,c){return r.setFromMatrix3Column(this,0),a.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(r){const a=r.elements;return this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]),this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,a){const c=r.elements,h=a.elements,p=this.elements,g=c[0],_=c[3],w=c[6],M=c[1],S=c[4],T=c[7],D=c[2],R=c[5],L=c[8],P=h[0],I=h[3],z=h[6],B=h[1],j=h[4],H=h[7],K=h[2],ae=h[5],he=h[8];return p[0]=g*P+_*B+w*K,p[3]=g*I+_*j+w*ae,p[6]=g*z+_*H+w*he,p[1]=M*P+S*B+T*K,p[4]=M*I+S*j+T*ae,p[7]=M*z+S*H+T*he,p[2]=D*P+R*B+L*K,p[5]=D*I+R*j+L*ae,p[8]=D*z+R*H+L*he,this}multiplyScalar(r){const a=this.elements;return a[0]*=r,a[3]*=r,a[6]*=r,a[1]*=r,a[4]*=r,a[7]*=r,a[2]*=r,a[5]*=r,a[8]*=r,this}determinant(){const r=this.elements,a=r[0],c=r[1],h=r[2],p=r[3],g=r[4],_=r[5],w=r[6],M=r[7],S=r[8];return a*g*S-a*_*M-c*p*S+c*_*w+h*p*M-h*g*w}invert(){const r=this.elements,a=r[0],c=r[1],h=r[2],p=r[3],g=r[4],_=r[5],w=r[6],M=r[7],S=r[8],T=S*g-_*M,D=_*w-S*p,R=M*p-g*w,L=a*T+c*D+h*R;if(0===L)return this.set(0,0,0,0,0,0,0,0,0);const P=1/L;return r[0]=T*P,r[1]=(h*M-S*c)*P,r[2]=(_*c-h*g)*P,r[3]=D*P,r[4]=(S*a-h*w)*P,r[5]=(h*p-_*a)*P,r[6]=R*P,r[7]=(c*w-M*a)*P,r[8]=(g*a-c*p)*P,this}transpose(){let r;const a=this.elements;return r=a[1],a[1]=a[3],a[3]=r,r=a[2],a[2]=a[6],a[6]=r,r=a[5],a[5]=a[7],a[7]=r,this}getNormalMatrix(r){return this.setFromMatrix4(r).invert().transpose()}transposeIntoArray(r){const a=this.elements;return r[0]=a[0],r[1]=a[3],r[2]=a[6],r[3]=a[1],r[4]=a[4],r[5]=a[7],r[6]=a[2],r[7]=a[5],r[8]=a[8],this}setUvTransform(r,a,c,h,p,g,_){const w=Math.cos(p),M=Math.sin(p);return this.set(c*w,c*M,-c*(w*g+M*_)+g+r,-h*M,h*w,-h*(-M*g+w*_)+_+a,0,0,1),this}scale(r,a){const c=this.elements;return c[0]*=r,c[3]*=r,c[6]*=r,c[1]*=a,c[4]*=a,c[7]*=a,this}rotate(r){const a=Math.cos(r),c=Math.sin(r),h=this.elements,p=h[0],g=h[3],_=h[6],w=h[1],M=h[4],S=h[7];return h[0]=a*p+c*w,h[3]=a*g+c*M,h[6]=a*_+c*S,h[1]=-c*p+a*w,h[4]=-c*g+a*M,h[7]=-c*_+a*S,this}translate(r,a){const c=this.elements;return c[0]+=r*c[2],c[3]+=r*c[5],c[6]+=r*c[8],c[1]+=a*c[2],c[4]+=a*c[5],c[7]+=a*c[8],this}equals(r){const a=this.elements,c=r.elements;for(let h=0;h<9;h++)if(a[h]!==c[h])return!1;return!0}fromArray(r,a=0){for(let c=0;c<9;c++)this.elements[c]=r[c+a];return this}toArray(r=[],a=0){const c=this.elements;return r[a]=c[0],r[a+1]=c[1],r[a+2]=c[2],r[a+3]=c[3],r[a+4]=c[4],r[a+5]=c[5],r[a+6]=c[6],r[a+7]=c[7],r[a+8]=c[8],r}clone(){return(new this.constructor).fromArray(this.elements)}}function Rf(d){for(let r=d.length-1;r>=0;--r)if(d[r]>65535)return!0;return!1}Yi.prototype.isMatrix3=!0;const p_={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function sl(d,r){return new p_[d](r)}function Dc(d){return document.createElementNS("http://www.w3.org/1999/xhtml",d)}function Ko(d){return d<.04045?.0773993808*d:Math.pow(.9478672986*d+.0521327014,2.4)}function ms(d){return d<.0031308?12.92*d:1.055*Math.pow(d,.41666)-.055}const m_={[rl]:{[Mu]:Ko},[Mu]:{[rl]:ms}},Rr={legacyMode:!0,get workingColorSpace(){return Mu},set workingColorSpace(d){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(d,r,a){if(this.legacyMode||r===a||!r||!a)return d;if(m_[r]&&void 0!==m_[r][a]){const c=m_[r][a];return d.r=c(d.r),d.g=c(d.g),d.b=c(d.b),d}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(d,r){return this.convert(d,this.workingColorSpace,r)},toWorkingColorSpace:function(d,r){return this.convert(d,r,this.workingColorSpace)}},Ot={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fn={r:0,g:0,b:0},Ri={h:0,s:0,l:0},co={h:0,s:0,l:0};function Ul(d,r,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?d+6*(r-d)*a:a<.5?r:a<2/3?d+6*(r-d)*(2/3-a):d}function Xr(d,r){return r.r=d.r,r.g=d.g,r.b=d.b,r}let pr,Tt=(()=>{class d{constructor(a,c,h){return void 0===c&&void 0===h?this.set(a):this.setRGB(a,c,h)}set(a){return a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,c=rl){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,Rr.toWorkingColorSpace(this,c),this}setRGB(a,c,h,p=Mu){return this.r=a,this.g=c,this.b=h,Rr.toWorkingColorSpace(this,p),this}setHSL(a,c,h,p=Mu){if(a=Ac(a,1),c=ns(c,0,1),h=ns(h,0,1),0===c)this.r=this.g=this.b=h;else{const g=h<=.5?h*(1+c):h+c-h*c,_=2*h-g;this.r=Ul(_,g,a+1/3),this.g=Ul(_,g,a),this.b=Ul(_,g,a-1/3)}return Rr.toWorkingColorSpace(this,p),this}setStyle(a,c=rl){function h(g){void 0!==g&&parseFloat(g)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let p;if(p=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(a)){let g;const w=p[2];switch(p[1]){case"rgb":case"rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w))return this.r=Math.min(255,parseInt(g[1],10))/255,this.g=Math.min(255,parseInt(g[2],10))/255,this.b=Math.min(255,parseInt(g[3],10))/255,Rr.toWorkingColorSpace(this,c),h(g[4]),this;if(g=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w))return this.r=Math.min(100,parseInt(g[1],10))/100,this.g=Math.min(100,parseInt(g[2],10))/100,this.b=Math.min(100,parseInt(g[3],10))/100,Rr.toWorkingColorSpace(this,c),h(g[4]),this;break;case"hsl":case"hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(w)){const M=parseFloat(g[1])/360,S=parseInt(g[2],10)/100,T=parseInt(g[3],10)/100;return h(g[4]),this.setHSL(M,S,T,c)}}}else if(p=/^\#([A-Fa-f\d]+)$/.exec(a)){const g=p[1],_=g.length;if(3===_)return this.r=parseInt(g.charAt(0)+g.charAt(0),16)/255,this.g=parseInt(g.charAt(1)+g.charAt(1),16)/255,this.b=parseInt(g.charAt(2)+g.charAt(2),16)/255,Rr.toWorkingColorSpace(this,c),this;if(6===_)return this.r=parseInt(g.charAt(0)+g.charAt(1),16)/255,this.g=parseInt(g.charAt(2)+g.charAt(3),16)/255,this.b=parseInt(g.charAt(4)+g.charAt(5),16)/255,Rr.toWorkingColorSpace(this,c),this}return a&&a.length>0?this.setColorName(a,c):this}setColorName(a,c=rl){const h=Ot[a.toLowerCase()];return void 0!==h?this.setHex(h,c):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=Ko(a.r),this.g=Ko(a.g),this.b=Ko(a.b),this}copyLinearToSRGB(a){return this.r=ms(a.r),this.g=ms(a.g),this.b=ms(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=rl){return Rr.fromWorkingColorSpace(Xr(this,fn),a),ns(255*fn.r,0,255)<<16^ns(255*fn.g,0,255)<<8^ns(255*fn.b,0,255)<<0}getHexString(a=rl){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,c=Mu){Rr.fromWorkingColorSpace(Xr(this,fn),c);const h=fn.r,p=fn.g,g=fn.b,_=Math.max(h,p,g),w=Math.min(h,p,g);let M,S;const T=(w+_)/2;if(w===_)M=0,S=0;else{const D=_-w;switch(S=T<=.5?D/(_+w):D/(2-_-w),_){case h:M=(p-g)/D+(p<g?6:0);break;case p:M=(g-h)/D+2;break;case g:M=(h-p)/D+4}M/=6}return a.h=M,a.s=S,a.l=T,a}getRGB(a,c=Mu){return Rr.fromWorkingColorSpace(Xr(this,fn),c),a.r=fn.r,a.g=fn.g,a.b=fn.b,a}getStyle(a=rl){return Rr.fromWorkingColorSpace(Xr(this,fn),a),a!==rl?`color(${a} ${fn.r} ${fn.g} ${fn.b})`:`rgb(${255*fn.r|0},${255*fn.g|0},${255*fn.b|0})`}offsetHSL(a,c,h){return this.getHSL(Ri),Ri.h+=a,Ri.s+=c,Ri.l+=h,this.setHSL(Ri.h,Ri.s,Ri.l),this}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,c){return this.r=a.r+c.r,this.g=a.g+c.g,this.b=a.b+c.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,c){return this.r+=(a.r-this.r)*c,this.g+=(a.g-this.g)*c,this.b+=(a.b-this.b)*c,this}lerpColors(a,c,h){return this.r=a.r+(c.r-a.r)*h,this.g=a.g+(c.g-a.g)*h,this.b=a.b+(c.b-a.b)*h,this}lerpHSL(a,c){this.getHSL(Ri),a.getHSL(co);const h=Eu(Ri.h,co.h,c),p=Eu(Ri.s,co.s,c),g=Eu(Ri.l,co.l,c);return this.setHSL(h,p,g),this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,c=0){return this.r=a[c],this.g=a[c+1],this.b=a[c+2],this}toArray(a=[],c=0){return a[c]=this.r,a[c+1]=this.g,a[c+2]=this.b,a}fromBufferAttribute(a,c){return this.r=a.getX(c),this.g=a.getY(c),this.b=a.getZ(c),!0===a.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}return d.NAMES=Ot,d})();Tt.prototype.isColor=!0,Tt.prototype.r=1,Tt.prototype.g=1,Tt.prototype.b=1;class da{static getDataURL(r){if(/^data:/i.test(r.src)||"undefined"==typeof HTMLCanvasElement)return r.src;let a;if(r instanceof HTMLCanvasElement)a=r;else{void 0===pr&&(pr=Dc("canvas")),pr.width=r.width,pr.height=r.height;const c=pr.getContext("2d");r instanceof ImageData?c.putImageData(r,0,0):c.drawImage(r,0,0,r.width,r.height),a=pr}return a.width>2048||a.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),a.toDataURL("image/jpeg",.6)):a.toDataURL("image/png")}static sRGBToLinear(r){if("undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&r instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&r instanceof ImageBitmap){const a=Dc("canvas");a.width=r.width,a.height=r.height;const c=a.getContext("2d");c.drawImage(r,0,0,r.width,r.height);const h=c.getImageData(0,0,r.width,r.height),p=h.data;for(let g=0;g<p.length;g++)p[g]=255*Ko(p[g]/255);return c.putImageData(h,0,0),a}if(r.data){const a=r.data.slice(0);for(let c=0;c<a.length;c++)a[c]=a instanceof Uint8Array||a instanceof Uint8ClampedArray?Math.floor(255*Ko(a[c]/255)):Ko(a[c]);return{data:a,width:r.width,height:r.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}}class fa{constructor(r=null){this.uuid=ha(),this.data=r,this.version=0}set needsUpdate(r){!0===r&&this.version++}toJSON(r){const a=void 0===r||"string"==typeof r;if(!a&&void 0!==r.images[this.uuid])return r.images[this.uuid];const c={uuid:this.uuid,url:""},h=this.data;if(null!==h){let p;if(Array.isArray(h)){p=[];for(let g=0,_=h.length;g<_;g++)p.push(zn(h[g].isDataTexture?h[g].image:h[g]))}else p=zn(h);c.url=p}return a||(r.images[this.uuid]=c),c}}function zn(d){return"undefined"!=typeof HTMLImageElement&&d instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&d instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&d instanceof ImageBitmap?da.getDataURL(d):d.data?{data:Array.prototype.slice.call(d.data),width:d.width,height:d.height,type:d.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}fa.prototype.isSource=!0;let zm=0,is=(()=>{class d extends Tc{constructor(a=d.DEFAULT_IMAGE,c=d.DEFAULT_MAPPING,h=fs,p=fs,g=kr,_=Ua,w=Ct,M=za,S=1,T=Cs){super(),Object.defineProperty(this,"id",{value:zm++}),this.uuid=ha(),this.name="",this.source=new fa(a),this.mipmaps=[],this.mapping=c,this.wrapS=h,this.wrapT=p,this.magFilter=g,this.minFilter=_,this.anisotropy=S,this.format=w,this.internalFormat=null,this.type=M,this.offset=new Qe(0,0),this.repeat=new Qe(1,1),this.center=new Qe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Yi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=T,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(a){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.encoding=a.encoding,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const c=void 0===a||"string"==typeof a;if(!c&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];const h={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(h.userData=this.userData),c||(a.textures[this.uuid]=h),h}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(300!==this.mapping)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case oo:a.x=a.x-Math.floor(a.x);break;case fs:a.x=a.x<0?0:1;break;case Oh:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case oo:a.y=a.y-Math.floor(a.y);break;case fs:a.y=a.y<0?0:1;break;case Oh:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){!0===a&&(this.version++,this.source.needsUpdate=!0)}}return d.DEFAULT_IMAGE=null,d.DEFAULT_MAPPING=300,d})();is.prototype.isTexture=!0;class ki{constructor(r=0,a=0,c=0,h=1){this.x=r,this.y=a,this.z=c,this.w=h}get width(){return this.z}set width(r){this.z=r}get height(){return this.w}set height(r){this.w=r}set(r,a,c,h){return this.x=r,this.y=a,this.z=c,this.w=h,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this.w=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setW(r){return this.w=r,this}setComponent(r,a){switch(r){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=void 0!==r.w?r.w:1,this}add(r,a){return void 0!==a?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(r,a)):(this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this)}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this.w+=r,this}addVectors(r,a){return this.x=r.x+a.x,this.y=r.y+a.y,this.z=r.z+a.z,this.w=r.w+a.w,this}addScaledVector(r,a){return this.x+=r.x*a,this.y+=r.y*a,this.z+=r.z*a,this.w+=r.w*a,this}sub(r,a){return void 0!==a?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(r,a)):(this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this)}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this.w-=r,this}subVectors(r,a){return this.x=r.x-a.x,this.y=r.y-a.y,this.z=r.z-a.z,this.w=r.w-a.w,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this}applyMatrix4(r){const a=this.x,c=this.y,h=this.z,p=this.w,g=r.elements;return this.x=g[0]*a+g[4]*c+g[8]*h+g[12]*p,this.y=g[1]*a+g[5]*c+g[9]*h+g[13]*p,this.z=g[2]*a+g[6]*c+g[10]*h+g[14]*p,this.w=g[3]*a+g[7]*c+g[11]*h+g[15]*p,this}divideScalar(r){return this.multiplyScalar(1/r)}setAxisAngleFromQuaternion(r){this.w=2*Math.acos(r.w);const a=Math.sqrt(1-r.w*r.w);return a<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=r.x/a,this.y=r.y/a,this.z=r.z/a),this}setAxisAngleFromRotationMatrix(r){let a,c,h,p;const w=r.elements,M=w[0],S=w[4],T=w[8],D=w[1],R=w[5],L=w[9],P=w[2],I=w[6],z=w[10];if(Math.abs(S-D)<.01&&Math.abs(T-P)<.01&&Math.abs(L-I)<.01){if(Math.abs(S+D)<.1&&Math.abs(T+P)<.1&&Math.abs(L+I)<.1&&Math.abs(M+R+z-3)<.1)return this.set(1,0,0,0),this;a=Math.PI;const j=(M+1)/2,H=(R+1)/2,K=(z+1)/2,ae=(S+D)/4,he=(T+P)/4,me=(L+I)/4;return j>H&&j>K?j<.01?(c=0,h=.707106781,p=.707106781):(c=Math.sqrt(j),h=ae/c,p=he/c):H>K?H<.01?(c=.707106781,h=0,p=.707106781):(h=Math.sqrt(H),c=ae/h,p=me/h):K<.01?(c=.707106781,h=.707106781,p=0):(p=Math.sqrt(K),c=he/p,h=me/p),this.set(c,h,p,a),this}let B=Math.sqrt((I-L)*(I-L)+(T-P)*(T-P)+(D-S)*(D-S));return Math.abs(B)<.001&&(B=1),this.x=(I-L)/B,this.y=(T-P)/B,this.z=(D-S)/B,this.w=Math.acos((M+R+z-1)/2),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this.w=Math.min(this.w,r.w),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this}clamp(r,a){return this.x=Math.max(r.x,Math.min(a.x,this.x)),this.y=Math.max(r.y,Math.min(a.y,this.y)),this.z=Math.max(r.z,Math.min(a.z,this.z)),this.w=Math.max(r.w,Math.min(a.w,this.w)),this}clampScalar(r,a){return this.x=Math.max(r,Math.min(a,this.x)),this.y=Math.max(r,Math.min(a,this.y)),this.z=Math.max(r,Math.min(a,this.z)),this.w=Math.max(r,Math.min(a,this.w)),this}clampLength(r,a){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(r,Math.min(a,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,a){return this.x+=(r.x-this.x)*a,this.y+=(r.y-this.y)*a,this.z+=(r.z-this.z)*a,this.w+=(r.w-this.w)*a,this}lerpVectors(r,a,c){return this.x=r.x+(a.x-r.x)*c,this.y=r.y+(a.y-r.y)*c,this.z=r.z+(a.z-r.z)*c,this.w=r.w+(a.w-r.w)*c,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z&&r.w===this.w}fromArray(r,a=0){return this.x=r[a],this.y=r[a+1],this.z=r[a+2],this.w=r[a+3],this}toArray(r=[],a=0){return r[a]=this.x,r[a+1]=this.y,r[a+2]=this.z,r[a+3]=this.w,r}fromBufferAttribute(r,a,c){return void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=r.getX(a),this.y=r.getY(a),this.z=r.getZ(a),this.w=r.getW(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}ki.prototype.isVector4=!0;class rs extends Tc{constructor(r,a,c={}){super(),this.width=r,this.height=a,this.depth=1,this.scissor=new ki(0,0,r,a),this.scissorTest=!1,this.viewport=new ki(0,0,r,a),this.texture=new is({width:r,height:a,depth:1},c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==c.generateMipmaps&&c.generateMipmaps,this.texture.internalFormat=void 0!==c.internalFormat?c.internalFormat:null,this.texture.minFilter=void 0!==c.minFilter?c.minFilter:kr,this.depthBuffer=void 0===c.depthBuffer||c.depthBuffer,this.stencilBuffer=void 0!==c.stencilBuffer&&c.stencilBuffer,this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null,this.samples=void 0!==c.samples?c.samples:0}setSize(r,a,c=1){(this.width!==r||this.height!==a||this.depth!==c)&&(this.width=r,this.height=a,this.depth=c,this.texture.image.width=r,this.texture.image.height=a,this.texture.image.depth=c,this.dispose()),this.viewport.set(0,0,r,a),this.scissor.set(0,0,r,a)}clone(){return(new this.constructor).copy(this)}copy(r){return this.width=r.width,this.height=r.height,this.depth=r.depth,this.viewport.copy(r.viewport),this.texture=r.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},r.texture.image),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,null!==r.depthTexture&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}rs.prototype.isWebGLRenderTarget=!0;class gs extends is{constructor(r=null,a=1,c=1,h=1){super(null),this.image={data:r,width:a,height:c,depth:h},this.magFilter=Br,this.minFilter=Br,this.wrapR=fs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}gs.prototype.isDataArrayTexture=!0;class Hh extends rs{constructor(r,a,c){super(r,a),this.depth=c,this.texture=new gs(null,r,a,c),this.texture.isRenderTargetTexture=!0}}Hh.prototype.isWebGLArrayRenderTarget=!0;class ol extends is{constructor(r=null,a=1,c=1,h=1){super(null),this.image={data:r,width:a,height:c,depth:h},this.magFilter=Br,this.minFilter=Br,this.wrapR=fs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}ol.prototype.isData3DTexture=!0;class pa extends rs{constructor(r,a,c){super(r,a),this.depth=c,this.texture=new ol(null,r,a,c),this.texture.isRenderTargetTexture=!0}}pa.prototype.isWebGL3DRenderTarget=!0;class ur extends rs{constructor(r,a,c,h={}){super(r,a,h);const p=this.texture;this.texture=[];for(let g=0;g<c;g++)this.texture[g]=p.clone(),this.texture[g].isRenderTargetTexture=!0}setSize(r,a,c=1){if(this.width!==r||this.height!==a||this.depth!==c){this.width=r,this.height=a,this.depth=c;for(let h=0,p=this.texture.length;h<p;h++)this.texture[h].image.width=r,this.texture[h].image.height=a,this.texture[h].image.depth=c;this.dispose()}return this.viewport.set(0,0,r,a),this.scissor.set(0,0,r,a),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.texture.length=0;for(let a=0,c=r.texture.length;a<c;a++)this.texture[a]=r.texture[a].clone();return this}}ur.prototype.isWebGLMultipleRenderTargets=!0;class Zs{constructor(r=0,a=0,c=0,h=1){this._x=r,this._y=a,this._z=c,this._w=h}static slerp(r,a,c,h){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),c.slerpQuaternions(r,a,h)}static slerpFlat(r,a,c,h,p,g,_){let w=c[h+0],M=c[h+1],S=c[h+2],T=c[h+3];const D=p[g+0],R=p[g+1],L=p[g+2],P=p[g+3];if(0===_)return r[a+0]=w,r[a+1]=M,r[a+2]=S,void(r[a+3]=T);if(1===_)return r[a+0]=D,r[a+1]=R,r[a+2]=L,void(r[a+3]=P);if(T!==P||w!==D||M!==R||S!==L){let I=1-_;const z=w*D+M*R+S*L+T*P,B=z>=0?1:-1,j=1-z*z;if(j>Number.EPSILON){const K=Math.sqrt(j),ae=Math.atan2(K,z*B);I=Math.sin(I*ae)/K,_=Math.sin(_*ae)/K}const H=_*B;if(w=w*I+D*H,M=M*I+R*H,S=S*I+L*H,T=T*I+P*H,I===1-_){const K=1/Math.sqrt(w*w+M*M+S*S+T*T);w*=K,M*=K,S*=K,T*=K}}r[a]=w,r[a+1]=M,r[a+2]=S,r[a+3]=T}static multiplyQuaternionsFlat(r,a,c,h,p,g){const _=c[h],w=c[h+1],M=c[h+2],S=c[h+3],T=p[g],D=p[g+1],R=p[g+2],L=p[g+3];return r[a]=_*L+S*T+w*R-M*D,r[a+1]=w*L+S*D+M*T-_*R,r[a+2]=M*L+S*R+_*D-w*T,r[a+3]=S*L-_*T-w*D-M*R,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,a,c,h){return this._x=r,this._y=a,this._z=c,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,a){if(!r||!r.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const c=r._x,h=r._y,p=r._z,g=r._order,_=Math.cos,w=Math.sin,M=_(c/2),S=_(h/2),T=_(p/2),D=w(c/2),R=w(h/2),L=w(p/2);switch(g){case"XYZ":this._x=D*S*T+M*R*L,this._y=M*R*T-D*S*L,this._z=M*S*L+D*R*T,this._w=M*S*T-D*R*L;break;case"YXZ":this._x=D*S*T+M*R*L,this._y=M*R*T-D*S*L,this._z=M*S*L-D*R*T,this._w=M*S*T+D*R*L;break;case"ZXY":this._x=D*S*T-M*R*L,this._y=M*R*T+D*S*L,this._z=M*S*L+D*R*T,this._w=M*S*T-D*R*L;break;case"ZYX":this._x=D*S*T-M*R*L,this._y=M*R*T+D*S*L,this._z=M*S*L-D*R*T,this._w=M*S*T+D*R*L;break;case"YZX":this._x=D*S*T+M*R*L,this._y=M*R*T+D*S*L,this._z=M*S*L-D*R*T,this._w=M*S*T-D*R*L;break;case"XZY":this._x=D*S*T-M*R*L,this._y=M*R*T-D*S*L,this._z=M*S*L+D*R*T,this._w=M*S*T+D*R*L;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+g)}return!1!==a&&this._onChangeCallback(),this}setFromAxisAngle(r,a){const c=a/2,h=Math.sin(c);return this._x=r.x*h,this._y=r.y*h,this._z=r.z*h,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(r){const a=r.elements,c=a[0],h=a[4],p=a[8],g=a[1],_=a[5],w=a[9],M=a[2],S=a[6],T=a[10],D=c+_+T;if(D>0){const R=.5/Math.sqrt(D+1);this._w=.25/R,this._x=(S-w)*R,this._y=(p-M)*R,this._z=(g-h)*R}else if(c>_&&c>T){const R=2*Math.sqrt(1+c-_-T);this._w=(S-w)/R,this._x=.25*R,this._y=(h+g)/R,this._z=(p+M)/R}else if(_>T){const R=2*Math.sqrt(1+_-c-T);this._w=(p-M)/R,this._x=(h+g)/R,this._y=.25*R,this._z=(w+S)/R}else{const R=2*Math.sqrt(1+T-c-_);this._w=(g-h)/R,this._x=(p+M)/R,this._y=(w+S)/R,this._z=.25*R}return this._onChangeCallback(),this}setFromUnitVectors(r,a){let c=r.dot(a)+1;return c<Number.EPSILON?(c=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=c):(this._x=0,this._y=-r.z,this._z=r.y,this._w=c)):(this._x=r.y*a.z-r.z*a.y,this._y=r.z*a.x-r.x*a.z,this._z=r.x*a.y-r.y*a.x,this._w=c),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(ns(this.dot(r),-1,1)))}rotateTowards(r,a){const c=this.angleTo(r);if(0===c)return this;const h=Math.min(1,a/c);return this.slerp(r,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return 0===r?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r,a){return void 0!==a?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(r,a)):this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,a){const c=r._x,h=r._y,p=r._z,g=r._w,_=a._x,w=a._y,M=a._z,S=a._w;return this._x=c*S+g*_+h*M-p*w,this._y=h*S+g*w+p*_-c*M,this._z=p*S+g*M+c*w-h*_,this._w=g*S-c*_-h*w-p*M,this._onChangeCallback(),this}slerp(r,a){if(0===a)return this;if(1===a)return this.copy(r);const c=this._x,h=this._y,p=this._z,g=this._w;let _=g*r._w+c*r._x+h*r._y+p*r._z;if(_<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,_=-_):this.copy(r),_>=1)return this._w=g,this._x=c,this._y=h,this._z=p,this;const w=1-_*_;if(w<=Number.EPSILON){const R=1-a;return this._w=R*g+a*this._w,this._x=R*c+a*this._x,this._y=R*h+a*this._y,this._z=R*p+a*this._z,this.normalize(),this._onChangeCallback(),this}const M=Math.sqrt(w),S=Math.atan2(M,_),T=Math.sin((1-a)*S)/M,D=Math.sin(a*S)/M;return this._w=g*T+this._w*D,this._x=c*T+this._x*D,this._y=h*T+this._y*D,this._z=p*T+this._z*D,this._onChangeCallback(),this}slerpQuaternions(r,a,c){return this.copy(r).slerp(a,c)}random(){const r=Math.random(),a=Math.sqrt(1-r),c=Math.sqrt(r),h=2*Math.PI*Math.random(),p=2*Math.PI*Math.random();return this.set(a*Math.cos(h),c*Math.sin(p),c*Math.cos(p),a*Math.sin(h))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,a=0){return this._x=r[a],this._y=r[a+1],this._z=r[a+2],this._w=r[a+3],this._onChangeCallback(),this}toArray(r=[],a=0){return r[a]=this._x,r[a+1]=this._y,r[a+2]=this._z,r[a+3]=this._w,r}fromBufferAttribute(r,a){return this._x=r.getX(a),this._y=r.getY(a),this._z=r.getZ(a),this._w=r.getW(a),this}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}}Zs.prototype.isQuaternion=!0;class J{constructor(r=0,a=0,c=0){this.x=r,this.y=a,this.z=c}set(r,a,c){return void 0===c&&(c=this.z),this.x=r,this.y=a,this.z=c,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setComponent(r,a){switch(r){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r,a){return void 0!==a?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(r,a)):(this.x+=r.x,this.y+=r.y,this.z+=r.z,this)}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this}addVectors(r,a){return this.x=r.x+a.x,this.y=r.y+a.y,this.z=r.z+a.z,this}addScaledVector(r,a){return this.x+=r.x*a,this.y+=r.y*a,this.z+=r.z*a,this}sub(r,a){return void 0!==a?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(r,a)):(this.x-=r.x,this.y-=r.y,this.z-=r.z,this)}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this}subVectors(r,a){return this.x=r.x-a.x,this.y=r.y-a.y,this.z=r.z-a.z,this}multiply(r,a){return void 0!==a?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(r,a)):(this.x*=r.x,this.y*=r.y,this.z*=r.z,this)}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}multiplyVectors(r,a){return this.x=r.x*a.x,this.y=r.y*a.y,this.z=r.z*a.z,this}applyEuler(r){return r&&r.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ga.setFromEuler(r))}applyAxisAngle(r,a){return this.applyQuaternion(ga.setFromAxisAngle(r,a))}applyMatrix3(r){const a=this.x,c=this.y,h=this.z,p=r.elements;return this.x=p[0]*a+p[3]*c+p[6]*h,this.y=p[1]*a+p[4]*c+p[7]*h,this.z=p[2]*a+p[5]*c+p[8]*h,this}applyNormalMatrix(r){return this.applyMatrix3(r).normalize()}applyMatrix4(r){const a=this.x,c=this.y,h=this.z,p=r.elements,g=1/(p[3]*a+p[7]*c+p[11]*h+p[15]);return this.x=(p[0]*a+p[4]*c+p[8]*h+p[12])*g,this.y=(p[1]*a+p[5]*c+p[9]*h+p[13])*g,this.z=(p[2]*a+p[6]*c+p[10]*h+p[14])*g,this}applyQuaternion(r){const a=this.x,c=this.y,h=this.z,p=r.x,g=r.y,_=r.z,w=r.w,M=w*a+g*h-_*c,S=w*c+_*a-p*h,T=w*h+p*c-g*a,D=-p*a-g*c-_*h;return this.x=M*w+D*-p+S*-_-T*-g,this.y=S*w+D*-g+T*-p-M*-_,this.z=T*w+D*-_+M*-g-S*-p,this}project(r){return this.applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix)}unproject(r){return this.applyMatrix4(r.projectionMatrixInverse).applyMatrix4(r.matrixWorld)}transformDirection(r){const a=this.x,c=this.y,h=this.z,p=r.elements;return this.x=p[0]*a+p[4]*c+p[8]*h,this.y=p[1]*a+p[5]*c+p[9]*h,this.z=p[2]*a+p[6]*c+p[10]*h,this.normalize()}divide(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this}divideScalar(r){return this.multiplyScalar(1/r)}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}clamp(r,a){return this.x=Math.max(r.x,Math.min(a.x,this.x)),this.y=Math.max(r.y,Math.min(a.y,this.y)),this.z=Math.max(r.z,Math.min(a.z,this.z)),this}clampScalar(r,a){return this.x=Math.max(r,Math.min(a,this.x)),this.y=Math.max(r,Math.min(a,this.y)),this.z=Math.max(r,Math.min(a,this.z)),this}clampLength(r,a){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(r,Math.min(a,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,a){return this.x+=(r.x-this.x)*a,this.y+=(r.y-this.y)*a,this.z+=(r.z-this.z)*a,this}lerpVectors(r,a,c){return this.x=r.x+(a.x-r.x)*c,this.y=r.y+(a.y-r.y)*c,this.z=r.z+(a.z-r.z)*c,this}cross(r,a){return void 0!==a?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(r,a)):this.crossVectors(this,r)}crossVectors(r,a){const c=r.x,h=r.y,p=r.z,g=a.x,_=a.y,w=a.z;return this.x=h*w-p*_,this.y=p*g-c*w,this.z=c*_-h*g,this}projectOnVector(r){const a=r.lengthSq();if(0===a)return this.set(0,0,0);const c=r.dot(this)/a;return this.copy(r).multiplyScalar(c)}projectOnPlane(r){return ma.copy(this).projectOnVector(r),this.sub(ma)}reflect(r){return this.sub(ma.copy(r).multiplyScalar(2*this.dot(r)))}angleTo(r){const a=Math.sqrt(this.lengthSq()*r.lengthSq());if(0===a)return Math.PI/2;const c=this.dot(r)/a;return Math.acos(ns(c,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const a=this.x-r.x,c=this.y-r.y,h=this.z-r.z;return a*a+c*c+h*h}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)+Math.abs(this.z-r.z)}setFromSpherical(r){return this.setFromSphericalCoords(r.radius,r.phi,r.theta)}setFromSphericalCoords(r,a,c){const h=Math.sin(a)*r;return this.x=h*Math.sin(c),this.y=Math.cos(a)*r,this.z=h*Math.cos(c),this}setFromCylindrical(r){return this.setFromCylindricalCoords(r.radius,r.theta,r.y)}setFromCylindricalCoords(r,a,c){return this.x=r*Math.sin(a),this.y=c,this.z=r*Math.cos(a),this}setFromMatrixPosition(r){const a=r.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}setFromMatrixScale(r){const a=this.setFromMatrixColumn(r,0).length(),c=this.setFromMatrixColumn(r,1).length(),h=this.setFromMatrixColumn(r,2).length();return this.x=a,this.y=c,this.z=h,this}setFromMatrixColumn(r,a){return this.fromArray(r.elements,4*a)}setFromMatrix3Column(r,a){return this.fromArray(r.elements,3*a)}setFromEuler(r){return this.x=r._x,this.y=r._y,this.z=r._z,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z}fromArray(r,a=0){return this.x=r[a],this.y=r[a+1],this.z=r[a+2],this}toArray(r=[],a=0){return r[a]=this.x,r[a+1]=this.y,r[a+2]=this.z,r}fromBufferAttribute(r,a,c){return void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=r.getX(a),this.y=r.getY(a),this.z=r.getZ(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const r=2*(Math.random()-.5),a=Math.random()*Math.PI*2,c=Math.sqrt(1-r**2);return this.x=c*Math.cos(a),this.y=c*Math.sin(a),this.z=r,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}J.prototype.isVector3=!0;const ma=new J,ga=new Zs;class Mo{constructor(r=new J(1/0,1/0,1/0),a=new J(-1/0,-1/0,-1/0)){this.min=r,this.max=a}set(r,a){return this.min.copy(r),this.max.copy(a),this}setFromArray(r){let a=1/0,c=1/0,h=1/0,p=-1/0,g=-1/0,_=-1/0;for(let w=0,M=r.length;w<M;w+=3){const S=r[w],T=r[w+1],D=r[w+2];S<a&&(a=S),T<c&&(c=T),D<h&&(h=D),S>p&&(p=S),T>g&&(g=T),D>_&&(_=D)}return this.min.set(a,c,h),this.max.set(p,g,_),this}setFromBufferAttribute(r){let a=1/0,c=1/0,h=1/0,p=-1/0,g=-1/0,_=-1/0;for(let w=0,M=r.count;w<M;w++){const S=r.getX(w),T=r.getY(w),D=r.getZ(w);S<a&&(a=S),T<c&&(c=T),D<h&&(h=D),S>p&&(p=S),T>g&&(g=T),D>_&&(_=D)}return this.min.set(a,c,h),this.max.set(p,g,_),this}setFromPoints(r){this.makeEmpty();for(let a=0,c=r.length;a<c;a++)this.expandByPoint(r[a]);return this}setFromCenterAndSize(r,a){const c=al.copy(a).multiplyScalar(.5);return this.min.copy(r).sub(c),this.max.copy(r).add(c),this}setFromObject(r,a=!1){return this.makeEmpty(),this.expandByObject(r,a)}clone(){return(new this.constructor).copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,a=!1){r.updateWorldMatrix(!1,!1);const c=r.geometry;if(void 0!==c)if(a&&null!=c.attributes&&void 0!==c.attributes.position){const p=c.attributes.position;for(let g=0,_=p.count;g<_;g++)al.fromBufferAttribute(p,g).applyMatrix4(r.matrixWorld),this.expandByPoint(al)}else null===c.boundingBox&&c.computeBoundingBox(),$o.copy(c.boundingBox),$o.applyMatrix4(r.matrixWorld),this.union($o);const h=r.children;for(let p=0,g=h.length;p<g;p++)this.expandByObject(h[p],a);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,a){return a.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,al),al.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let a,c;return r.normal.x>0?(a=r.normal.x*this.min.x,c=r.normal.x*this.max.x):(a=r.normal.x*this.max.x,c=r.normal.x*this.min.x),r.normal.y>0?(a+=r.normal.y*this.min.y,c+=r.normal.y*this.max.y):(a+=r.normal.y*this.max.y,c+=r.normal.y*this.min.y),r.normal.z>0?(a+=r.normal.z*this.min.z,c+=r.normal.z*this.max.z):(a+=r.normal.z*this.max.z,c+=r.normal.z*this.min.z),a<=-r.constant&&c>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(Hm),g_.subVectors(this.max,Hm),Gh.subVectors(r.a,Hm),Pf.subVectors(r.b,Hm),Wh.subVectors(r.c,Hm),Rc.subVectors(Pf,Gh),Su.subVectors(Wh,Pf),qh.subVectors(Gh,Wh);let a=[0,-Rc.z,Rc.y,0,-Su.z,Su.y,0,-qh.z,qh.y,Rc.z,0,-Rc.x,Su.z,0,-Su.x,qh.z,0,-qh.x,-Rc.y,Rc.x,0,-Su.y,Su.x,0,-qh.y,qh.x,0];return!(!Bx(a,Gh,Pf,Wh,g_)||(a=[1,0,0,0,1,0,0,0,1],!Bx(a,Gh,Pf,Wh,g_)))&&(y_.crossVectors(Rc,Su),a=[y_.x,y_.y,y_.z],Bx(a,Gh,Pf,Wh,g_))}clampPoint(r,a){return a.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return al.copy(r).clamp(this.min,this.max).sub(r).length()}getBoundingSphere(r){return this.getCenter(r.center),r.radius=.5*this.getSize(al).length(),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()||(ya[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),ya[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),ya[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),ya[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),ya[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),ya[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),ya[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),ya[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(ya)),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}Mo.prototype.isBox3=!0;const ya=[new J,new J,new J,new J,new J,new J,new J,new J],al=new J,$o=new Mo,Gh=new J,Pf=new J,Wh=new J,Rc=new J,Su=new J,qh=new J,Hm=new J,g_=new J,y_=new J,jh=new J;function Bx(d,r,a,c,h){for(let p=0,g=d.length-3;p<=g;p+=3){jh.fromArray(d,p);const _=h.x*Math.abs(jh.x)+h.y*Math.abs(jh.y)+h.z*Math.abs(jh.z),w=r.dot(jh),M=a.dot(jh),S=c.dot(jh);if(Math.max(-Math.max(w,M,S),Math.min(w,M,S))>_)return!1}return!0}const pP=new Mo,rC=new J,__=new J,kx=new J;class Cu{constructor(r=new J,a=-1){this.center=r,this.radius=a}set(r,a){return this.center.copy(r),this.radius=a,this}setFromPoints(r,a){const c=this.center;void 0!==a?c.copy(a):pP.setFromPoints(r).getCenter(c);let h=0;for(let p=0,g=r.length;p<g;p++)h=Math.max(h,c.distanceToSquared(r[p]));return this.radius=Math.sqrt(h),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const a=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=a*a}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,a){const c=this.center.distanceToSquared(r);return a.copy(r),c>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){kx.subVectors(r,this.center);const a=kx.lengthSq();if(a>this.radius*this.radius){const c=Math.sqrt(a),h=.5*(c-this.radius);this.center.add(kx.multiplyScalar(h/c)),this.radius+=h}return this}union(r){return!0===this.center.equals(r.center)?__.set(0,0,1).multiplyScalar(r.radius):__.subVectors(r.center,this.center).normalize().multiplyScalar(r.radius),this.expandByPoint(rC.copy(r.center).add(__)),this.expandByPoint(rC.copy(r.center).sub(__)),this}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Pc=new J,Vx=new J,If=new J,ll=new J,Ux=new J,v_=new J,zx=new J;class No{constructor(r=new J,a=new J(0,0,-1)){this.origin=r,this.direction=a}set(r,a){return this.origin.copy(r),this.direction.copy(a),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,a){return a.copy(this.direction).multiplyScalar(r).add(this.origin)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,Pc)),this}closestPointToPoint(r,a){a.subVectors(r,this.origin);const c=a.dot(this.direction);return c<0?a.copy(this.origin):a.copy(this.direction).multiplyScalar(c).add(this.origin)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const a=Pc.subVectors(r,this.origin).dot(this.direction);return a<0?this.origin.distanceToSquared(r):(Pc.copy(this.direction).multiplyScalar(a).add(this.origin),Pc.distanceToSquared(r))}distanceSqToSegment(r,a,c,h){Vx.copy(r).add(a).multiplyScalar(.5),If.copy(a).sub(r).normalize(),ll.copy(this.origin).sub(Vx);const p=.5*r.distanceTo(a),g=-this.direction.dot(If),_=ll.dot(this.direction),w=-ll.dot(If),M=ll.lengthSq(),S=Math.abs(1-g*g);let T,D,R,L;if(S>0)if(T=g*w-_,D=g*_-w,L=p*S,T>=0)if(D>=-L)if(D<=L){const P=1/S;T*=P,D*=P,R=T*(T+g*D+2*_)+D*(g*T+D+2*w)+M}else D=p,T=Math.max(0,-(g*D+_)),R=-T*T+D*(D+2*w)+M;else D=-p,T=Math.max(0,-(g*D+_)),R=-T*T+D*(D+2*w)+M;else D<=-L?(T=Math.max(0,-(-g*p+_)),D=T>0?-p:Math.min(Math.max(-p,-w),p),R=-T*T+D*(D+2*w)+M):D<=L?(T=0,D=Math.min(Math.max(-p,-w),p),R=D*(D+2*w)+M):(T=Math.max(0,-(g*p+_)),D=T>0?p:Math.min(Math.max(-p,-w),p),R=-T*T+D*(D+2*w)+M);else D=g>0?-p:p,T=Math.max(0,-(g*D+_)),R=-T*T+D*(D+2*w)+M;return c&&c.copy(this.direction).multiplyScalar(T).add(this.origin),h&&h.copy(If).multiplyScalar(D).add(Vx),R}intersectSphere(r,a){Pc.subVectors(r.center,this.origin);const c=Pc.dot(this.direction),h=Pc.dot(Pc)-c*c,p=r.radius*r.radius;if(h>p)return null;const g=Math.sqrt(p-h),_=c-g,w=c+g;return _<0&&w<0?null:this.at(_<0?w:_,a)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const a=r.normal.dot(this.direction);if(0===a)return 0===r.distanceToPoint(this.origin)?0:null;const c=-(this.origin.dot(r.normal)+r.constant)/a;return c>=0?c:null}intersectPlane(r,a){const c=this.distanceToPlane(r);return null===c?null:this.at(c,a)}intersectsPlane(r){const a=r.distanceToPoint(this.origin);return 0===a||r.normal.dot(this.direction)*a<0}intersectBox(r,a){let c,h,p,g,_,w;const M=1/this.direction.x,S=1/this.direction.y,T=1/this.direction.z,D=this.origin;return M>=0?(c=(r.min.x-D.x)*M,h=(r.max.x-D.x)*M):(c=(r.max.x-D.x)*M,h=(r.min.x-D.x)*M),S>=0?(p=(r.min.y-D.y)*S,g=(r.max.y-D.y)*S):(p=(r.max.y-D.y)*S,g=(r.min.y-D.y)*S),c>g||p>h||((p>c||c!=c)&&(c=p),(g<h||h!=h)&&(h=g),T>=0?(_=(r.min.z-D.z)*T,w=(r.max.z-D.z)*T):(_=(r.max.z-D.z)*T,w=(r.min.z-D.z)*T),c>w||_>h)||((_>c||c!=c)&&(c=_),(w<h||h!=h)&&(h=w),h<0)?null:this.at(c>=0?c:h,a)}intersectsBox(r){return null!==this.intersectBox(r,Pc)}intersectTriangle(r,a,c,h,p){Ux.subVectors(a,r),v_.subVectors(c,r),zx.crossVectors(Ux,v_);let _,g=this.direction.dot(zx);if(g>0){if(h)return null;_=1}else{if(!(g<0))return null;_=-1,g=-g}ll.subVectors(this.origin,r);const w=_*this.direction.dot(v_.crossVectors(ll,v_));if(w<0)return null;const M=_*this.direction.dot(Ux.cross(ll));if(M<0||w+M>g)return null;const S=-_*ll.dot(zx);return S<0?null:this.at(S/g,p)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class on{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(r,a,c,h,p,g,_,w,M,S,T,D,R,L,P,I){const z=this.elements;return z[0]=r,z[4]=a,z[8]=c,z[12]=h,z[1]=p,z[5]=g,z[9]=_,z[13]=w,z[2]=M,z[6]=S,z[10]=T,z[14]=D,z[3]=R,z[7]=L,z[11]=P,z[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new on).fromArray(this.elements)}copy(r){const a=this.elements,c=r.elements;return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],this}copyPosition(r){const a=this.elements,c=r.elements;return a[12]=c[12],a[13]=c[13],a[14]=c[14],this}setFromMatrix3(r){const a=r.elements;return this.set(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1),this}extractBasis(r,a,c){return r.setFromMatrixColumn(this,0),a.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(r,a,c){return this.set(r.x,a.x,c.x,0,r.y,a.y,c.y,0,r.z,a.z,c.z,0,0,0,0,1),this}extractRotation(r){const a=this.elements,c=r.elements,h=1/uo.setFromMatrixColumn(r,0).length(),p=1/uo.setFromMatrixColumn(r,1).length(),g=1/uo.setFromMatrixColumn(r,2).length();return a[0]=c[0]*h,a[1]=c[1]*h,a[2]=c[2]*h,a[3]=0,a[4]=c[4]*p,a[5]=c[5]*p,a[6]=c[6]*p,a[7]=0,a[8]=c[8]*g,a[9]=c[9]*g,a[10]=c[10]*g,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromEuler(r){r&&r.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const a=this.elements,c=r.x,h=r.y,p=r.z,g=Math.cos(c),_=Math.sin(c),w=Math.cos(h),M=Math.sin(h),S=Math.cos(p),T=Math.sin(p);if("XYZ"===r.order){const D=g*S,R=g*T,L=_*S,P=_*T;a[0]=w*S,a[4]=-w*T,a[8]=M,a[1]=R+L*M,a[5]=D-P*M,a[9]=-_*w,a[2]=P-D*M,a[6]=L+R*M,a[10]=g*w}else if("YXZ"===r.order){const D=w*S,R=w*T,L=M*S,P=M*T;a[0]=D+P*_,a[4]=L*_-R,a[8]=g*M,a[1]=g*T,a[5]=g*S,a[9]=-_,a[2]=R*_-L,a[6]=P+D*_,a[10]=g*w}else if("ZXY"===r.order){const D=w*S,R=w*T,L=M*S,P=M*T;a[0]=D-P*_,a[4]=-g*T,a[8]=L+R*_,a[1]=R+L*_,a[5]=g*S,a[9]=P-D*_,a[2]=-g*M,a[6]=_,a[10]=g*w}else if("ZYX"===r.order){const D=g*S,R=g*T,L=_*S,P=_*T;a[0]=w*S,a[4]=L*M-R,a[8]=D*M+P,a[1]=w*T,a[5]=P*M+D,a[9]=R*M-L,a[2]=-M,a[6]=_*w,a[10]=g*w}else if("YZX"===r.order){const D=g*w,R=g*M,L=_*w,P=_*M;a[0]=w*S,a[4]=P-D*T,a[8]=L*T+R,a[1]=T,a[5]=g*S,a[9]=-_*S,a[2]=-M*S,a[6]=R*T+L,a[10]=D-P*T}else if("XZY"===r.order){const D=g*w,R=g*M,L=_*w,P=_*M;a[0]=w*S,a[4]=-T,a[8]=M*S,a[1]=D*T+P,a[5]=g*S,a[9]=R*T-L,a[2]=L*T-R,a[6]=_*S,a[10]=P*T+D}return a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(r){return this.compose(sC,r,oC)}lookAt(r,a,c){const h=this.elements;return Zo.subVectors(r,a),0===Zo.lengthSq()&&(Zo.z=1),Zo.normalize(),zl.crossVectors(c,Zo),0===zl.lengthSq()&&(1===Math.abs(c.z)?Zo.x+=1e-4:Zo.z+=1e-4,Zo.normalize(),zl.crossVectors(c,Zo)),zl.normalize(),Lf.crossVectors(Zo,zl),h[0]=zl.x,h[4]=Lf.x,h[8]=Zo.x,h[1]=zl.y,h[5]=Lf.y,h[9]=Zo.y,h[2]=zl.z,h[6]=Lf.z,h[10]=Zo.z,this}multiply(r,a){return void 0!==a?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(r,a)):this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,a){const c=r.elements,h=a.elements,p=this.elements,g=c[0],_=c[4],w=c[8],M=c[12],S=c[1],T=c[5],D=c[9],R=c[13],L=c[2],P=c[6],I=c[10],z=c[14],B=c[3],j=c[7],H=c[11],K=c[15],ae=h[0],he=h[4],me=h[8],ke=h[12],ve=h[1],X=h[5],ce=h[9],dt=h[13],Me=h[2],Oe=h[6],Re=h[10],Ge=h[14],xe=h[3],st=h[7],ut=h[11],xt=h[15];return p[0]=g*ae+_*ve+w*Me+M*xe,p[4]=g*he+_*X+w*Oe+M*st,p[8]=g*me+_*ce+w*Re+M*ut,p[12]=g*ke+_*dt+w*Ge+M*xt,p[1]=S*ae+T*ve+D*Me+R*xe,p[5]=S*he+T*X+D*Oe+R*st,p[9]=S*me+T*ce+D*Re+R*ut,p[13]=S*ke+T*dt+D*Ge+R*xt,p[2]=L*ae+P*ve+I*Me+z*xe,p[6]=L*he+P*X+I*Oe+z*st,p[10]=L*me+P*ce+I*Re+z*ut,p[14]=L*ke+P*dt+I*Ge+z*xt,p[3]=B*ae+j*ve+H*Me+K*xe,p[7]=B*he+j*X+H*Oe+K*st,p[11]=B*me+j*ce+H*Re+K*ut,p[15]=B*ke+j*dt+H*Ge+K*xt,this}multiplyScalar(r){const a=this.elements;return a[0]*=r,a[4]*=r,a[8]*=r,a[12]*=r,a[1]*=r,a[5]*=r,a[9]*=r,a[13]*=r,a[2]*=r,a[6]*=r,a[10]*=r,a[14]*=r,a[3]*=r,a[7]*=r,a[11]*=r,a[15]*=r,this}determinant(){const r=this.elements,a=r[0],c=r[4],h=r[8],p=r[12],g=r[1],_=r[5],w=r[9],M=r[13],S=r[2],T=r[6],D=r[10],R=r[14];return r[3]*(+p*w*T-h*M*T-p*_*D+c*M*D+h*_*R-c*w*R)+r[7]*(+a*w*R-a*M*D+p*g*D-h*g*R+h*M*S-p*w*S)+r[11]*(+a*M*T-a*_*R-p*g*T+c*g*R+p*_*S-c*M*S)+r[15]*(-h*_*S-a*w*T+a*_*D+h*g*T-c*g*D+c*w*S)}transpose(){const r=this.elements;let a;return a=r[1],r[1]=r[4],r[4]=a,a=r[2],r[2]=r[8],r[8]=a,a=r[6],r[6]=r[9],r[9]=a,a=r[3],r[3]=r[12],r[12]=a,a=r[7],r[7]=r[13],r[13]=a,a=r[11],r[11]=r[14],r[14]=a,this}setPosition(r,a,c){const h=this.elements;return r.isVector3?(h[12]=r.x,h[13]=r.y,h[14]=r.z):(h[12]=r,h[13]=a,h[14]=c),this}invert(){const r=this.elements,a=r[0],c=r[1],h=r[2],p=r[3],g=r[4],_=r[5],w=r[6],M=r[7],S=r[8],T=r[9],D=r[10],R=r[11],L=r[12],P=r[13],I=r[14],z=r[15],B=T*I*M-P*D*M+P*w*R-_*I*R-T*w*z+_*D*z,j=L*D*M-S*I*M-L*w*R+g*I*R+S*w*z-g*D*z,H=S*P*M-L*T*M+L*_*R-g*P*R-S*_*z+g*T*z,K=L*T*w-S*P*w-L*_*D+g*P*D+S*_*I-g*T*I,ae=a*B+c*j+h*H+p*K;if(0===ae)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const he=1/ae;return r[0]=B*he,r[1]=(P*D*p-T*I*p-P*h*R+c*I*R+T*h*z-c*D*z)*he,r[2]=(_*I*p-P*w*p+P*h*M-c*I*M-_*h*z+c*w*z)*he,r[3]=(T*w*p-_*D*p-T*h*M+c*D*M+_*h*R-c*w*R)*he,r[4]=j*he,r[5]=(S*I*p-L*D*p+L*h*R-a*I*R-S*h*z+a*D*z)*he,r[6]=(L*w*p-g*I*p-L*h*M+a*I*M+g*h*z-a*w*z)*he,r[7]=(g*D*p-S*w*p+S*h*M-a*D*M-g*h*R+a*w*R)*he,r[8]=H*he,r[9]=(L*T*p-S*P*p-L*c*R+a*P*R+S*c*z-a*T*z)*he,r[10]=(g*P*p-L*_*p+L*c*M-a*P*M-g*c*z+a*_*z)*he,r[11]=(S*_*p-g*T*p-S*c*M+a*T*M+g*c*R-a*_*R)*he,r[12]=K*he,r[13]=(S*P*h-L*T*h+L*c*D-a*P*D-S*c*I+a*T*I)*he,r[14]=(L*_*h-g*P*h-L*c*w+a*P*w+g*c*I-a*_*I)*he,r[15]=(g*T*h-S*_*h+S*c*w-a*T*w-g*c*D+a*_*D)*he,this}scale(r){const a=this.elements,c=r.x,h=r.y,p=r.z;return a[0]*=c,a[4]*=h,a[8]*=p,a[1]*=c,a[5]*=h,a[9]*=p,a[2]*=c,a[6]*=h,a[10]*=p,a[3]*=c,a[7]*=h,a[11]*=p,this}getMaxScaleOnAxis(){const r=this.elements;return Math.sqrt(Math.max(r[0]*r[0]+r[1]*r[1]+r[2]*r[2],r[4]*r[4]+r[5]*r[5]+r[6]*r[6],r[8]*r[8]+r[9]*r[9]+r[10]*r[10]))}makeTranslation(r,a,c){return this.set(1,0,0,r,0,1,0,a,0,0,1,c,0,0,0,1),this}makeRotationX(r){const a=Math.cos(r),c=Math.sin(r);return this.set(1,0,0,0,0,a,-c,0,0,c,a,0,0,0,0,1),this}makeRotationY(r){const a=Math.cos(r),c=Math.sin(r);return this.set(a,0,c,0,0,1,0,0,-c,0,a,0,0,0,0,1),this}makeRotationZ(r){const a=Math.cos(r),c=Math.sin(r);return this.set(a,-c,0,0,c,a,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(r,a){const c=Math.cos(a),h=Math.sin(a),p=1-c,g=r.x,_=r.y,w=r.z,M=p*g,S=p*_;return this.set(M*g+c,M*_-h*w,M*w+h*_,0,M*_+h*w,S*_+c,S*w-h*g,0,M*w-h*_,S*w+h*g,p*w*w+c,0,0,0,0,1),this}makeScale(r,a,c){return this.set(r,0,0,0,0,a,0,0,0,0,c,0,0,0,0,1),this}makeShear(r,a,c,h,p,g){return this.set(1,c,p,0,r,1,g,0,a,h,1,0,0,0,0,1),this}compose(r,a,c){const h=this.elements,p=a._x,g=a._y,_=a._z,w=a._w,M=p+p,S=g+g,T=_+_,D=p*M,R=p*S,L=p*T,P=g*S,I=g*T,z=_*T,B=w*M,j=w*S,H=w*T,K=c.x,ae=c.y,he=c.z;return h[0]=(1-(P+z))*K,h[1]=(R+H)*K,h[2]=(L-j)*K,h[3]=0,h[4]=(R-H)*ae,h[5]=(1-(D+z))*ae,h[6]=(I+B)*ae,h[7]=0,h[8]=(L+j)*he,h[9]=(I-B)*he,h[10]=(1-(D+P))*he,h[11]=0,h[12]=r.x,h[13]=r.y,h[14]=r.z,h[15]=1,this}decompose(r,a,c){const h=this.elements;let p=uo.set(h[0],h[1],h[2]).length();const g=uo.set(h[4],h[5],h[6]).length(),_=uo.set(h[8],h[9],h[10]).length();this.determinant()<0&&(p=-p),r.x=h[12],r.y=h[13],r.z=h[14],_a.copy(this);const M=1/p,S=1/g,T=1/_;return _a.elements[0]*=M,_a.elements[1]*=M,_a.elements[2]*=M,_a.elements[4]*=S,_a.elements[5]*=S,_a.elements[6]*=S,_a.elements[8]*=T,_a.elements[9]*=T,_a.elements[10]*=T,a.setFromRotationMatrix(_a),c.x=p,c.y=g,c.z=_,this}makePerspective(r,a,c,h,p,g){void 0===g&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const _=this.elements,M=2*p/(c-h),S=(a+r)/(a-r),T=(c+h)/(c-h),D=-(g+p)/(g-p),R=-2*g*p/(g-p);return _[0]=2*p/(a-r),_[4]=0,_[8]=S,_[12]=0,_[1]=0,_[5]=M,_[9]=T,_[13]=0,_[2]=0,_[6]=0,_[10]=D,_[14]=R,_[3]=0,_[7]=0,_[11]=-1,_[15]=0,this}makeOrthographic(r,a,c,h,p,g){const _=this.elements,w=1/(a-r),M=1/(c-h),S=1/(g-p),T=(a+r)*w,D=(c+h)*M,R=(g+p)*S;return _[0]=2*w,_[4]=0,_[8]=0,_[12]=-T,_[1]=0,_[5]=2*M,_[9]=0,_[13]=-D,_[2]=0,_[6]=0,_[10]=-2*S,_[14]=-R,_[3]=0,_[7]=0,_[11]=0,_[15]=1,this}equals(r){const a=this.elements,c=r.elements;for(let h=0;h<16;h++)if(a[h]!==c[h])return!1;return!0}fromArray(r,a=0){for(let c=0;c<16;c++)this.elements[c]=r[c+a];return this}toArray(r=[],a=0){const c=this.elements;return r[a]=c[0],r[a+1]=c[1],r[a+2]=c[2],r[a+3]=c[3],r[a+4]=c[4],r[a+5]=c[5],r[a+6]=c[6],r[a+7]=c[7],r[a+8]=c[8],r[a+9]=c[9],r[a+10]=c[10],r[a+11]=c[11],r[a+12]=c[12],r[a+13]=c[13],r[a+14]=c[14],r[a+15]=c[15],r}}on.prototype.isMatrix4=!0;const uo=new J,_a=new on,sC=new J(0,0,0),oC=new J(1,1,1),zl=new J,Lf=new J,Zo=new J,Gm=new on,Hx=new Zs;class ys{constructor(r=0,a=0,c=0,h=ys.DefaultOrder){this._x=r,this._y=a,this._z=c,this._order=h}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get order(){return this._order}set order(r){this._order=r,this._onChangeCallback()}set(r,a,c,h=this._order){return this._x=r,this._y=a,this._z=c,this._order=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(r){return this._x=r._x,this._y=r._y,this._z=r._z,this._order=r._order,this._onChangeCallback(),this}setFromRotationMatrix(r,a=this._order,c=!0){const h=r.elements,p=h[0],g=h[4],_=h[8],w=h[1],M=h[5],S=h[9],T=h[2],D=h[6],R=h[10];switch(a){case"XYZ":this._y=Math.asin(ns(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-S,R),this._z=Math.atan2(-g,p)):(this._x=Math.atan2(D,M),this._z=0);break;case"YXZ":this._x=Math.asin(-ns(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(_,R),this._z=Math.atan2(w,M)):(this._y=Math.atan2(-T,p),this._z=0);break;case"ZXY":this._x=Math.asin(ns(D,-1,1)),Math.abs(D)<.9999999?(this._y=Math.atan2(-T,R),this._z=Math.atan2(-g,M)):(this._y=0,this._z=Math.atan2(w,p));break;case"ZYX":this._y=Math.asin(-ns(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(D,R),this._z=Math.atan2(w,p)):(this._x=0,this._z=Math.atan2(-g,M));break;case"YZX":this._z=Math.asin(ns(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(-S,M),this._y=Math.atan2(-T,p)):(this._x=0,this._y=Math.atan2(_,R));break;case"XZY":this._z=Math.asin(-ns(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(D,M),this._y=Math.atan2(_,p)):(this._x=Math.atan2(-S,R),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+a)}return this._order=a,!0===c&&this._onChangeCallback(),this}setFromQuaternion(r,a,c){return Gm.makeRotationFromQuaternion(r),this.setFromRotationMatrix(Gm,a,c)}setFromVector3(r,a=this._order){return this.set(r.x,r.y,r.z,a)}reorder(r){return Hx.setFromEuler(this),this.setFromQuaternion(Hx,r)}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._order===this._order}fromArray(r){return this._x=r[0],this._y=r[1],this._z=r[2],void 0!==r[3]&&(this._order=r[3]),this._onChangeCallback(),this}toArray(r=[],a=0){return r[a]=this._x,r[a+1]=this._y,r[a+2]=this._z,r[a+3]=this._order,r}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}}ys.prototype.isEuler=!0,ys.DefaultOrder="XYZ",ys.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Xh{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return 0!=(this.mask&r.mask)}isEnabled(r){return 0!=(this.mask&(1<<r|0))}}let aC=0;const Wm=new J,Yh=new Zs,Hl=new on,Kh=new J,Ff=new J,x_=new J,mP=new Zs,Pr=new J(1,0,0),b_=new J(0,1,0),Gx=new J(0,0,1),ss={type:"added"},Wx={type:"removed"};class _i extends Tc{constructor(){super(),Object.defineProperty(this,"id",{value:aC++}),this.uuid=ha(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_i.DefaultUp.clone();const r=new J,a=new ys,c=new Zs,h=new J(1,1,1);a._onChange(function p(){c.setFromEuler(a,!1)}),c._onChange(function g(){a.setFromQuaternion(c,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new on},normalMatrix:{value:new Yi}}),this.matrix=new on,this.matrixWorld=new on,this.matrixAutoUpdate=_i.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Xh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(r){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(r),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(r){return this.quaternion.premultiply(r),this}setRotationFromAxisAngle(r,a){this.quaternion.setFromAxisAngle(r,a)}setRotationFromEuler(r){this.quaternion.setFromEuler(r,!0)}setRotationFromMatrix(r){this.quaternion.setFromRotationMatrix(r)}setRotationFromQuaternion(r){this.quaternion.copy(r)}rotateOnAxis(r,a){return Yh.setFromAxisAngle(r,a),this.quaternion.multiply(Yh),this}rotateOnWorldAxis(r,a){return Yh.setFromAxisAngle(r,a),this.quaternion.premultiply(Yh),this}rotateX(r){return this.rotateOnAxis(Pr,r)}rotateY(r){return this.rotateOnAxis(b_,r)}rotateZ(r){return this.rotateOnAxis(Gx,r)}translateOnAxis(r,a){return Wm.copy(r).applyQuaternion(this.quaternion),this.position.add(Wm.multiplyScalar(a)),this}translateX(r){return this.translateOnAxis(Pr,r)}translateY(r){return this.translateOnAxis(b_,r)}translateZ(r){return this.translateOnAxis(Gx,r)}localToWorld(r){return r.applyMatrix4(this.matrixWorld)}worldToLocal(r){return r.applyMatrix4(Hl.copy(this.matrixWorld).invert())}lookAt(r,a,c){r.isVector3?Kh.copy(r):Kh.set(r,a,c);const h=this.parent;this.updateWorldMatrix(!0,!1),Ff.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Hl.lookAt(Ff,Kh,this.up):Hl.lookAt(Kh,Ff,this.up),this.quaternion.setFromRotationMatrix(Hl),h&&(Hl.extractRotation(h.matrixWorld),Yh.setFromRotationMatrix(Hl),this.quaternion.premultiply(Yh.invert()))}add(r){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return r===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",r),this):(r&&r.isObject3D?(null!==r.parent&&r.parent.remove(r),r.parent=this,this.children.push(r),r.dispatchEvent(ss)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",r),this)}remove(r){if(arguments.length>1){for(let c=0;c<arguments.length;c++)this.remove(arguments[c]);return this}const a=this.children.indexOf(r);return-1!==a&&(r.parent=null,this.children.splice(a,1),r.dispatchEvent(Wx)),this}removeFromParent(){const r=this.parent;return null!==r&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++){const a=this.children[r];a.parent=null,a.dispatchEvent(Wx)}return this.children.length=0,this}attach(r){return this.updateWorldMatrix(!0,!1),Hl.copy(this.matrixWorld).invert(),null!==r.parent&&(r.parent.updateWorldMatrix(!0,!1),Hl.multiply(r.parent.matrixWorld)),r.applyMatrix4(Hl),this.add(r),r.updateWorldMatrix(!1,!0),this}getObjectById(r){return this.getObjectByProperty("id",r)}getObjectByName(r){return this.getObjectByProperty("name",r)}getObjectByProperty(r,a){if(this[r]===a)return this;for(let c=0,h=this.children.length;c<h;c++){const g=this.children[c].getObjectByProperty(r,a);if(void 0!==g)return g}}getWorldPosition(r){return this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ff,r,x_),r}getWorldScale(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ff,mP,r),r}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return r.set(a[8],a[9],a[10]).normalize()}raycast(){}traverse(r){r(this);const a=this.children;for(let c=0,h=a.length;c<h;c++)a[c].traverse(r)}traverseVisible(r){if(!1===this.visible)return;r(this);const a=this.children;for(let c=0,h=a.length;c<h;c++)a[c].traverseVisible(r)}traverseAncestors(r){const a=this.parent;null!==a&&(r(a),a.traverseAncestors(r))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,r=!0);const a=this.children;for(let c=0,h=a.length;c<h;c++)a[c].updateMatrixWorld(r)}updateWorldMatrix(r,a){const c=this.parent;if(!0===r&&null!==c&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===a){const h=this.children;for(let p=0,g=h.length;p<g;p++)h[p].updateWorldMatrix(!1,!0)}}toJSON(r){const a=void 0===r||"string"==typeof r,c={};a&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const h={};function p(_,w){return void 0===_[w.uuid]&&(_[w.uuid]=w.toJSON(r)),w.uuid}if(h.uuid=this.uuid,h.type=this.type,""!==this.name&&(h.name=this.name),!0===this.castShadow&&(h.castShadow=!0),!0===this.receiveShadow&&(h.receiveShadow=!0),!1===this.visible&&(h.visible=!1),!1===this.frustumCulled&&(h.frustumCulled=!1),0!==this.renderOrder&&(h.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(h.userData=this.userData),h.layers=this.layers.mask,h.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(h.matrixAutoUpdate=!1),this.isInstancedMesh&&(h.type="InstancedMesh",h.count=this.count,h.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(h.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?h.background=this.background.toJSON():this.background.isTexture&&(h.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&(h.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){h.geometry=p(r.geometries,this.geometry);const _=this.geometry.parameters;if(void 0!==_&&void 0!==_.shapes){const w=_.shapes;if(Array.isArray(w))for(let M=0,S=w.length;M<S;M++)p(r.shapes,w[M]);else p(r.shapes,w)}}if(this.isSkinnedMesh&&(h.bindMode=this.bindMode,h.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(p(r.skeletons,this.skeleton),h.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const _=[];for(let w=0,M=this.material.length;w<M;w++)_.push(p(r.materials,this.material[w]));h.material=_}else h.material=p(r.materials,this.material);if(this.children.length>0){h.children=[];for(let _=0;_<this.children.length;_++)h.children.push(this.children[_].toJSON(r).object)}if(this.animations.length>0){h.animations=[];for(let _=0;_<this.animations.length;_++)h.animations.push(p(r.animations,this.animations[_]))}if(a){const _=g(r.geometries),w=g(r.materials),M=g(r.textures),S=g(r.images),T=g(r.shapes),D=g(r.skeletons),R=g(r.animations),L=g(r.nodes);_.length>0&&(c.geometries=_),w.length>0&&(c.materials=w),M.length>0&&(c.textures=M),S.length>0&&(c.images=S),T.length>0&&(c.shapes=T),D.length>0&&(c.skeletons=D),R.length>0&&(c.animations=R),L.length>0&&(c.nodes=L)}return c.object=h,c;function g(_){const w=[];for(const M in _){const S=_[M];delete S.metadata,w.push(S)}return w}}clone(r){return(new this.constructor).copy(this,r)}copy(r,a=!0){if(this.name=r.name,this.up.copy(r.up),this.position.copy(r.position),this.rotation.order=r.rotation.order,this.quaternion.copy(r.quaternion),this.scale.copy(r.scale),this.matrix.copy(r.matrix),this.matrixWorld.copy(r.matrixWorld),this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrixWorldNeedsUpdate=r.matrixWorldNeedsUpdate,this.layers.mask=r.layers.mask,this.visible=r.visible,this.castShadow=r.castShadow,this.receiveShadow=r.receiveShadow,this.frustumCulled=r.frustumCulled,this.renderOrder=r.renderOrder,this.userData=JSON.parse(JSON.stringify(r.userData)),!0===a)for(let c=0;c<r.children.length;c++)this.add(r.children[c].clone());return this}}_i.DefaultUp=new J(0,1,0),_i.DefaultMatrixAutoUpdate=!0,_i.prototype.isObject3D=!0;const Oo=new J,os=new J,w_=new J,Ga=new J,Wa=new J,As=new J,M_=new J,Nf=new J,E_=new J,cl=new J;class Vr{constructor(r=new J,a=new J,c=new J){this.a=r,this.b=a,this.c=c}static getNormal(r,a,c,h){h.subVectors(c,a),Oo.subVectors(r,a),h.cross(Oo);const p=h.lengthSq();return p>0?h.multiplyScalar(1/Math.sqrt(p)):h.set(0,0,0)}static getBarycoord(r,a,c,h,p){Oo.subVectors(h,a),os.subVectors(c,a),w_.subVectors(r,a);const g=Oo.dot(Oo),_=Oo.dot(os),w=Oo.dot(w_),M=os.dot(os),S=os.dot(w_),T=g*M-_*_;if(0===T)return p.set(-2,-1,-1);const D=1/T,R=(M*w-_*S)*D,L=(g*S-_*w)*D;return p.set(1-R-L,L,R)}static containsPoint(r,a,c,h){return this.getBarycoord(r,a,c,h,Ga),Ga.x>=0&&Ga.y>=0&&Ga.x+Ga.y<=1}static getUV(r,a,c,h,p,g,_,w){return this.getBarycoord(r,a,c,h,Ga),w.set(0,0),w.addScaledVector(p,Ga.x),w.addScaledVector(g,Ga.y),w.addScaledVector(_,Ga.z),w}static isFrontFacing(r,a,c,h){return Oo.subVectors(c,a),os.subVectors(r,a),Oo.cross(os).dot(h)<0}set(r,a,c){return this.a.copy(r),this.b.copy(a),this.c.copy(c),this}setFromPointsAndIndices(r,a,c,h){return this.a.copy(r[a]),this.b.copy(r[c]),this.c.copy(r[h]),this}setFromAttributeAndIndices(r,a,c,h){return this.a.fromBufferAttribute(r,a),this.b.fromBufferAttribute(r,c),this.c.fromBufferAttribute(r,h),this}clone(){return(new this.constructor).copy(this)}copy(r){return this.a.copy(r.a),this.b.copy(r.b),this.c.copy(r.c),this}getArea(){return Oo.subVectors(this.c,this.b),os.subVectors(this.a,this.b),.5*Oo.cross(os).length()}getMidpoint(r){return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(r){return Vr.getNormal(this.a,this.b,this.c,r)}getPlane(r){return r.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(r,a){return Vr.getBarycoord(r,this.a,this.b,this.c,a)}getUV(r,a,c,h,p){return Vr.getUV(r,this.a,this.b,this.c,a,c,h,p)}containsPoint(r){return Vr.containsPoint(r,this.a,this.b,this.c)}isFrontFacing(r){return Vr.isFrontFacing(this.a,this.b,this.c,r)}intersectsBox(r){return r.intersectsTriangle(this)}closestPointToPoint(r,a){const c=this.a,h=this.b,p=this.c;let g,_;Wa.subVectors(h,c),As.subVectors(p,c),Nf.subVectors(r,c);const w=Wa.dot(Nf),M=As.dot(Nf);if(w<=0&&M<=0)return a.copy(c);E_.subVectors(r,h);const S=Wa.dot(E_),T=As.dot(E_);if(S>=0&&T<=S)return a.copy(h);const D=w*T-S*M;if(D<=0&&w>=0&&S<=0)return g=w/(w-S),a.copy(c).addScaledVector(Wa,g);cl.subVectors(r,p);const R=Wa.dot(cl),L=As.dot(cl);if(L>=0&&R<=L)return a.copy(p);const P=R*M-w*L;if(P<=0&&M>=0&&L<=0)return _=M/(M-L),a.copy(c).addScaledVector(As,_);const I=S*L-R*T;if(I<=0&&T-S>=0&&R-L>=0)return M_.subVectors(p,h),_=(T-S)/(T-S+(R-L)),a.copy(h).addScaledVector(M_,_);const z=1/(I+P+D);return g=P*z,_=D*z,a.copy(c).addScaledVector(Wa,g).addScaledVector(As,_)}equals(r){return r.a.equals(this.a)&&r.b.equals(this.b)&&r.c.equals(this.c)}}let S_=0;class Zt extends Tc{constructor(){super(),Object.defineProperty(this,"id",{value:S_++}),this.uuid=ha(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(void 0!==r)for(const a in r){const c=r[a];if(void 0===c){console.warn("THREE.Material: '"+a+"' parameter is undefined.");continue}if("shading"===a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===c;continue}const h=this[a];void 0!==h?h&&h.isColor?h.set(c):h&&h.isVector3&&c&&c.isVector3?h.copy(c):this[a]=c:console.warn("THREE."+this.type+": '"+a+"' is not a property of this material.")}}toJSON(r){const a=void 0===r||"string"==typeof r;a&&(r={textures:{},images:{}});const c={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function h(p){const g=[];for(const _ in p){const w=p[_];delete w.metadata,g.push(w)}return g}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),void 0!==this.roughness&&(c.roughness=this.roughness),void 0!==this.metalness&&(c.metalness=this.metalness),void 0!==this.sheen&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(c.shininess=this.shininess),void 0!==this.clearcoat&&(c.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(r).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(r).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(r).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(r).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(r).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(r).uuid,void 0!==this.combine&&(c.combine=this.combine)),void 0!==this.envMapIntensity&&(c.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(c.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(r).uuid),void 0!==this.transmission&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(r).uuid),void 0!==this.thickness&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(r).uuid),void 0!==this.attenuationDistance&&(c.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(c.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(c.size=this.size),null!==this.shadowSide&&(c.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(c.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(c.blending=this.blending),0!==this.side&&(c.side=this.side),this.vertexColors&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),!0===this.transparent&&(c.transparent=this.transparent),c.depthFunc=this.depthFunc,c.depthTest=this.depthTest,c.depthWrite=this.depthWrite,c.colorWrite=this.colorWrite,c.stencilWrite=this.stencilWrite,c.stencilWriteMask=this.stencilWriteMask,c.stencilFunc=this.stencilFunc,c.stencilRef=this.stencilRef,c.stencilFuncMask=this.stencilFuncMask,c.stencilFail=this.stencilFail,c.stencilZFail=this.stencilZFail,c.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(c.rotation=this.rotation),!0===this.polygonOffset&&(c.polygonOffset=!0),0!==this.polygonOffsetFactor&&(c.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(c.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(c.linewidth=this.linewidth),void 0!==this.dashSize&&(c.dashSize=this.dashSize),void 0!==this.gapSize&&(c.gapSize=this.gapSize),void 0!==this.scale&&(c.scale=this.scale),!0===this.dithering&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(c.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(c.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(c.wireframe=this.wireframe),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(c.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(c.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(c.flatShading=this.flatShading),!1===this.visible&&(c.visible=!1),!1===this.toneMapped&&(c.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(c.userData=this.userData),a){const p=h(r.textures),g=h(r.images);p.length>0&&(c.textures=p),g.length>0&&(c.images=g)}return c}clone(){return(new this.constructor).copy(this)}copy(r){this.name=r.name,this.fog=r.fog,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const a=r.clippingPlanes;let c=null;if(null!==a){const h=a.length;c=new Array(h);for(let p=0;p!==h;++p)c[p]=a[p].clone()}return this.clippingPlanes=c,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=JSON.parse(JSON.stringify(r.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){!0===r&&this.version++}}Zt.prototype.isMaterial=!0,Zt.fromType=function(){return null};class ul extends Zt{constructor(r){super(),this.type="MeshBasicMaterial",this.color=new Tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this}}ul.prototype.isMeshBasicMaterial=!0;const _s=new J,qm=new Qe;class Pi{constructor(r,a,c){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=r,this.itemSize=a,this.count=void 0!==r?r.length/a:0,this.normalized=!0===c,this.usage=Uh,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(r){!0===r&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this}copyAt(r,a,c){r*=this.itemSize,c*=a.itemSize;for(let h=0,p=this.itemSize;h<p;h++)this.array[r+h]=a.array[c+h];return this}copyArray(r){return this.array.set(r),this}copyColorsArray(r){const a=this.array;let c=0;for(let h=0,p=r.length;h<p;h++){let g=r[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",h),g=new Tt),a[c++]=g.r,a[c++]=g.g,a[c++]=g.b}return this}copyVector2sArray(r){const a=this.array;let c=0;for(let h=0,p=r.length;h<p;h++){let g=r[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",h),g=new Qe),a[c++]=g.x,a[c++]=g.y}return this}copyVector3sArray(r){const a=this.array;let c=0;for(let h=0,p=r.length;h<p;h++){let g=r[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",h),g=new J),a[c++]=g.x,a[c++]=g.y,a[c++]=g.z}return this}copyVector4sArray(r){const a=this.array;let c=0;for(let h=0,p=r.length;h<p;h++){let g=r[h];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",h),g=new ki),a[c++]=g.x,a[c++]=g.y,a[c++]=g.z,a[c++]=g.w}return this}applyMatrix3(r){if(2===this.itemSize)for(let a=0,c=this.count;a<c;a++)qm.fromBufferAttribute(this,a),qm.applyMatrix3(r),this.setXY(a,qm.x,qm.y);else if(3===this.itemSize)for(let a=0,c=this.count;a<c;a++)_s.fromBufferAttribute(this,a),_s.applyMatrix3(r),this.setXYZ(a,_s.x,_s.y,_s.z);return this}applyMatrix4(r){for(let a=0,c=this.count;a<c;a++)_s.fromBufferAttribute(this,a),_s.applyMatrix4(r),this.setXYZ(a,_s.x,_s.y,_s.z);return this}applyNormalMatrix(r){for(let a=0,c=this.count;a<c;a++)_s.fromBufferAttribute(this,a),_s.applyNormalMatrix(r),this.setXYZ(a,_s.x,_s.y,_s.z);return this}transformDirection(r){for(let a=0,c=this.count;a<c;a++)_s.fromBufferAttribute(this,a),_s.transformDirection(r),this.setXYZ(a,_s.x,_s.y,_s.z);return this}set(r,a=0){return this.array.set(r,a),this}getX(r){return this.array[r*this.itemSize]}setX(r,a){return this.array[r*this.itemSize]=a,this}getY(r){return this.array[r*this.itemSize+1]}setY(r,a){return this.array[r*this.itemSize+1]=a,this}getZ(r){return this.array[r*this.itemSize+2]}setZ(r,a){return this.array[r*this.itemSize+2]=a,this}getW(r){return this.array[r*this.itemSize+3]}setW(r,a){return this.array[r*this.itemSize+3]=a,this}setXY(r,a,c){return this.array[0+(r*=this.itemSize)]=a,this.array[r+1]=c,this}setXYZ(r,a,c,h){return this.array[0+(r*=this.itemSize)]=a,this.array[r+1]=c,this.array[r+2]=h,this}setXYZW(r,a,c,h,p){return this.array[0+(r*=this.itemSize)]=a,this.array[r+1]=c,this.array[r+2]=h,this.array[r+3]=p,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(r.name=this.name),this.usage!==Uh&&(r.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(r.updateRange=this.updateRange),r}}Pi.prototype.isBufferAttribute=!0;class qx extends Pi{constructor(r,a,c){super(new Int8Array(r),a,c)}}class C_ extends Pi{constructor(r,a,c){super(new Uint8Array(r),a,c)}}class jx extends Pi{constructor(r,a,c){super(new Uint8ClampedArray(r),a,c)}}class Xx extends Pi{constructor(r,a,c){super(new Int16Array(r),a,c)}}class rt extends Pi{constructor(r,a,c){super(new Uint16Array(r),a,c)}}class Mi extends Pi{constructor(r,a,c){super(new Int32Array(r),a,c)}}class _t extends Pi{constructor(r,a,c){super(new Uint32Array(r),a,c)}}class as extends Pi{constructor(r,a,c){super(new Uint16Array(r),a,c)}}as.prototype.isFloat16BufferAttribute=!0;class en extends Pi{constructor(r,a,c){super(new Float32Array(r),a,c)}}class $h extends Pi{constructor(r,a,c){super(new Float64Array(r),a,c)}}let hl=0;const Bo=new on,Of=new _i,Bf=new J,Jo=new Mo,jm=new Mo,Yr=new J;class Jt extends Tc{constructor(){super(),Object.defineProperty(this,"id",{value:hl++}),this.uuid=ha(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(r){return this.index=Array.isArray(r)?new(Rf(r)?_t:rt)(r,1):r,this}getAttribute(r){return this.attributes[r]}setAttribute(r,a){return this.attributes[r]=a,this}deleteAttribute(r){return delete this.attributes[r],this}hasAttribute(r){return void 0!==this.attributes[r]}addGroup(r,a,c=0){this.groups.push({start:r,count:a,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(r,a){this.drawRange.start=r,this.drawRange.count=a}applyMatrix4(r){const a=this.attributes.position;void 0!==a&&(a.applyMatrix4(r),a.needsUpdate=!0);const c=this.attributes.normal;if(void 0!==c){const p=(new Yi).getNormalMatrix(r);c.applyNormalMatrix(p),c.needsUpdate=!0}const h=this.attributes.tangent;return void 0!==h&&(h.transformDirection(r),h.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(r){return Bo.makeRotationFromQuaternion(r),this.applyMatrix4(Bo),this}rotateX(r){return Bo.makeRotationX(r),this.applyMatrix4(Bo),this}rotateY(r){return Bo.makeRotationY(r),this.applyMatrix4(Bo),this}rotateZ(r){return Bo.makeRotationZ(r),this.applyMatrix4(Bo),this}translate(r,a,c){return Bo.makeTranslation(r,a,c),this.applyMatrix4(Bo),this}scale(r,a,c){return Bo.makeScale(r,a,c),this.applyMatrix4(Bo),this}lookAt(r){return Of.lookAt(r),Of.updateMatrix(),this.applyMatrix4(Of.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Bf).negate(),this.translate(Bf.x,Bf.y,Bf.z),this}setFromPoints(r){const a=[];for(let c=0,h=r.length;c<h;c++){const p=r[c];a.push(p.x,p.y,p.z||0)}return this.setAttribute("position",new en(a,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Mo);const r=this.attributes.position,a=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new J(-1/0,-1/0,-1/0),new J(1/0,1/0,1/0));if(void 0!==r){if(this.boundingBox.setFromBufferAttribute(r),a)for(let c=0,h=a.length;c<h;c++)Jo.setFromBufferAttribute(a[c]),this.morphTargetsRelative?(Yr.addVectors(this.boundingBox.min,Jo.min),this.boundingBox.expandByPoint(Yr),Yr.addVectors(this.boundingBox.max,Jo.max),this.boundingBox.expandByPoint(Yr)):(this.boundingBox.expandByPoint(Jo.min),this.boundingBox.expandByPoint(Jo.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Cu);const r=this.attributes.position,a=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new J,1/0);if(r){const c=this.boundingSphere.center;if(Jo.setFromBufferAttribute(r),a)for(let p=0,g=a.length;p<g;p++)jm.setFromBufferAttribute(a[p]),this.morphTargetsRelative?(Yr.addVectors(Jo.min,jm.min),Jo.expandByPoint(Yr),Yr.addVectors(Jo.max,jm.max),Jo.expandByPoint(Yr)):(Jo.expandByPoint(jm.min),Jo.expandByPoint(jm.max));Jo.getCenter(c);let h=0;for(let p=0,g=r.count;p<g;p++)Yr.fromBufferAttribute(r,p),h=Math.max(h,c.distanceToSquared(Yr));if(a)for(let p=0,g=a.length;p<g;p++){const _=a[p],w=this.morphTargetsRelative;for(let M=0,S=_.count;M<S;M++)Yr.fromBufferAttribute(_,M),w&&(Bf.fromBufferAttribute(r,M),Yr.add(Bf)),h=Math.max(h,c.distanceToSquared(Yr))}this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const r=this.index,a=this.attributes;if(null===r||void 0===a.position||void 0===a.normal||void 0===a.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const c=r.array,h=a.position.array,p=a.normal.array,g=a.uv.array,_=h.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Pi(new Float32Array(4*_),4));const w=this.getAttribute("tangent").array,M=[],S=[];for(let ve=0;ve<_;ve++)M[ve]=new J,S[ve]=new J;const T=new J,D=new J,R=new J,L=new Qe,P=new Qe,I=new Qe,z=new J,B=new J;function j(ve,X,ce){T.fromArray(h,3*ve),D.fromArray(h,3*X),R.fromArray(h,3*ce),L.fromArray(g,2*ve),P.fromArray(g,2*X),I.fromArray(g,2*ce),D.sub(T),R.sub(T),P.sub(L),I.sub(L);const dt=1/(P.x*I.y-I.x*P.y);!isFinite(dt)||(z.copy(D).multiplyScalar(I.y).addScaledVector(R,-P.y).multiplyScalar(dt),B.copy(R).multiplyScalar(P.x).addScaledVector(D,-I.x).multiplyScalar(dt),M[ve].add(z),M[X].add(z),M[ce].add(z),S[ve].add(B),S[X].add(B),S[ce].add(B))}let H=this.groups;0===H.length&&(H=[{start:0,count:c.length}]);for(let ve=0,X=H.length;ve<X;++ve){const ce=H[ve],dt=ce.start;for(let Oe=dt,Re=dt+ce.count;Oe<Re;Oe+=3)j(c[Oe+0],c[Oe+1],c[Oe+2])}const K=new J,ae=new J,he=new J,me=new J;function ke(ve){he.fromArray(p,3*ve),me.copy(he);const X=M[ve];K.copy(X),K.sub(he.multiplyScalar(he.dot(X))).normalize(),ae.crossVectors(me,X);const dt=ae.dot(S[ve])<0?-1:1;w[4*ve]=K.x,w[4*ve+1]=K.y,w[4*ve+2]=K.z,w[4*ve+3]=dt}for(let ve=0,X=H.length;ve<X;++ve){const ce=H[ve],dt=ce.start;for(let Oe=dt,Re=dt+ce.count;Oe<Re;Oe+=3)ke(c[Oe+0]),ke(c[Oe+1]),ke(c[Oe+2])}}computeVertexNormals(){const r=this.index,a=this.getAttribute("position");if(void 0!==a){let c=this.getAttribute("normal");if(void 0===c)c=new Pi(new Float32Array(3*a.count),3),this.setAttribute("normal",c);else for(let D=0,R=c.count;D<R;D++)c.setXYZ(D,0,0,0);const h=new J,p=new J,g=new J,_=new J,w=new J,M=new J,S=new J,T=new J;if(r)for(let D=0,R=r.count;D<R;D+=3){const L=r.getX(D+0),P=r.getX(D+1),I=r.getX(D+2);h.fromBufferAttribute(a,L),p.fromBufferAttribute(a,P),g.fromBufferAttribute(a,I),S.subVectors(g,p),T.subVectors(h,p),S.cross(T),_.fromBufferAttribute(c,L),w.fromBufferAttribute(c,P),M.fromBufferAttribute(c,I),_.add(S),w.add(S),M.add(S),c.setXYZ(L,_.x,_.y,_.z),c.setXYZ(P,w.x,w.y,w.z),c.setXYZ(I,M.x,M.y,M.z)}else for(let D=0,R=a.count;D<R;D+=3)h.fromBufferAttribute(a,D+0),p.fromBufferAttribute(a,D+1),g.fromBufferAttribute(a,D+2),S.subVectors(g,p),T.subVectors(h,p),S.cross(T),c.setXYZ(D+0,S.x,S.y,S.z),c.setXYZ(D+1,S.x,S.y,S.z),c.setXYZ(D+2,S.x,S.y,S.z);this.normalizeNormals(),c.needsUpdate=!0}}merge(r,a){if(!r||!r.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",r);void 0===a&&(a=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const c=this.attributes;for(const h in c){if(void 0===r.attributes[h])continue;const g=c[h].array,_=r.attributes[h],w=_.array,M=_.itemSize*a,S=Math.min(w.length,g.length-M);for(let T=0,D=M;T<S;T++,D++)g[D]=w[T]}return this}normalizeNormals(){const r=this.attributes.normal;for(let a=0,c=r.count;a<c;a++)Yr.fromBufferAttribute(r,a),Yr.normalize(),r.setXYZ(a,Yr.x,Yr.y,Yr.z)}toNonIndexed(){function r(_,w){const M=_.array,S=_.itemSize,T=_.normalized,D=new M.constructor(w.length*S);let R=0,L=0;for(let P=0,I=w.length;P<I;P++){R=_.isInterleavedBufferAttribute?w[P]*_.data.stride+_.offset:w[P]*S;for(let z=0;z<S;z++)D[L++]=M[R++]}return new Pi(D,S,T)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const a=new Jt,c=this.index.array,h=this.attributes;for(const _ in h){const M=r(h[_],c);a.setAttribute(_,M)}const p=this.morphAttributes;for(const _ in p){const w=[],M=p[_];for(let S=0,T=M.length;S<T;S++){const R=r(M[S],c);w.push(R)}a.morphAttributes[_]=w}a.morphTargetsRelative=this.morphTargetsRelative;const g=this.groups;for(let _=0,w=g.length;_<w;_++){const M=g[_];a.addGroup(M.start,M.count,M.materialIndex)}return a}toJSON(){const r={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),Object.keys(this.userData).length>0&&(r.userData=this.userData),void 0!==this.parameters){const w=this.parameters;for(const M in w)void 0!==w[M]&&(r[M]=w[M]);return r}r.data={attributes:{}};const a=this.index;null!==a&&(r.data.index={type:a.array.constructor.name,array:Array.prototype.slice.call(a.array)});const c=this.attributes;for(const w in c)r.data.attributes[w]=c[w].toJSON(r.data);const h={};let p=!1;for(const w in this.morphAttributes){const M=this.morphAttributes[w],S=[];for(let T=0,D=M.length;T<D;T++)S.push(M[T].toJSON(r.data));S.length>0&&(h[w]=S,p=!0)}p&&(r.data.morphAttributes=h,r.data.morphTargetsRelative=this.morphTargetsRelative);const g=this.groups;g.length>0&&(r.data.groups=JSON.parse(JSON.stringify(g)));const _=this.boundingSphere;return null!==_&&(r.data.boundingSphere={center:_.center.toArray(),radius:_.radius}),r}clone(){return(new this.constructor).copy(this)}copy(r){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const a={};this.name=r.name;const c=r.index;null!==c&&this.setIndex(c.clone(a));const h=r.attributes;for(const M in h)this.setAttribute(M,h[M].clone(a));const p=r.morphAttributes;for(const M in p){const S=[],T=p[M];for(let D=0,R=T.length;D<R;D++)S.push(T[D].clone(a));this.morphAttributes[M]=S}this.morphTargetsRelative=r.morphTargetsRelative;const g=r.groups;for(let M=0,S=g.length;M<S;M++){const T=g[M];this.addGroup(T.start,T.count,T.materialIndex)}const _=r.boundingBox;null!==_&&(this.boundingBox=_.clone());const w=r.boundingSphere;return null!==w&&(this.boundingSphere=w.clone()),this.drawRange.start=r.drawRange.start,this.drawRange.count=r.drawRange.count,this.userData=r.userData,void 0!==r.parameters&&(this.parameters=Object.assign({},r.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Jt.prototype.isBufferGeometry=!0;const dl=new on,Tu=new No,Ic=new Cu,ho=new J,Lc=new J,Gl=new J,T_=new J,A_=new J,kf=new J,Zh=new J,Vf=new J,Jh=new J,Xm=new Qe,Uf=new Qe,Au=new Qe,Ym=new J,zf=new J;class Kr extends _i{constructor(r=new Jt,a=new ul){super(),this.type="Mesh",this.geometry=r,this.material=a,this.updateMorphTargets()}copy(r){return super.copy(r),void 0!==r.morphTargetInfluences&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),void 0!==r.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=r.material,this.geometry=r.geometry,this}updateMorphTargets(){const r=this.geometry;if(r.isBufferGeometry){const a=r.morphAttributes,c=Object.keys(a);if(c.length>0){const h=a[c[0]];if(void 0!==h){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let p=0,g=h.length;p<g;p++){const _=h[p].name||String(p);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=p}}}}else{const a=r.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(r,a){const c=this.geometry,h=this.material,p=this.matrixWorld;if(void 0===h||(null===c.boundingSphere&&c.computeBoundingSphere(),Ic.copy(c.boundingSphere),Ic.applyMatrix4(p),!1===r.ray.intersectsSphere(Ic))||(dl.copy(p).invert(),Tu.copy(r.ray).applyMatrix4(dl),null!==c.boundingBox&&!1===Tu.intersectsBox(c.boundingBox)))return;let g;if(c.isBufferGeometry){const _=c.index,w=c.attributes.position,M=c.morphAttributes.position,S=c.morphTargetsRelative,T=c.attributes.uv,D=c.attributes.uv2,R=c.groups,L=c.drawRange;if(null!==_)if(Array.isArray(h))for(let P=0,I=R.length;P<I;P++){const z=R[P],B=h[z.materialIndex];for(let K=Math.max(z.start,L.start),ae=Math.min(_.count,Math.min(z.start+z.count,L.start+L.count));K<ae;K+=3){const he=_.getX(K),me=_.getX(K+1),ke=_.getX(K+2);g=Du(this,B,r,Tu,w,M,S,T,D,he,me,ke),g&&(g.faceIndex=Math.floor(K/3),g.face.materialIndex=z.materialIndex,a.push(g))}}else for(let z=Math.max(0,L.start),B=Math.min(_.count,L.start+L.count);z<B;z+=3){const j=_.getX(z),H=_.getX(z+1),K=_.getX(z+2);g=Du(this,h,r,Tu,w,M,S,T,D,j,H,K),g&&(g.faceIndex=Math.floor(z/3),a.push(g))}else if(void 0!==w)if(Array.isArray(h))for(let P=0,I=R.length;P<I;P++){const z=R[P],B=h[z.materialIndex];for(let K=Math.max(z.start,L.start),ae=Math.min(w.count,Math.min(z.start+z.count,L.start+L.count));K<ae;K+=3)g=Du(this,B,r,Tu,w,M,S,T,D,K,K+1,K+2),g&&(g.faceIndex=Math.floor(K/3),g.face.materialIndex=z.materialIndex,a.push(g))}else for(let z=Math.max(0,L.start),B=Math.min(w.count,L.start+L.count);z<B;z+=3)g=Du(this,h,r,Tu,w,M,S,T,D,z,z+1,z+2),g&&(g.faceIndex=Math.floor(z/3),a.push(g))}else c.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Du(d,r,a,c,h,p,g,_,w,M,S,T){ho.fromBufferAttribute(h,M),Lc.fromBufferAttribute(h,S),Gl.fromBufferAttribute(h,T);const D=d.morphTargetInfluences;if(p&&D){Zh.set(0,0,0),Vf.set(0,0,0),Jh.set(0,0,0);for(let L=0,P=p.length;L<P;L++){const I=D[L],z=p[L];0!==I&&(T_.fromBufferAttribute(z,M),A_.fromBufferAttribute(z,S),kf.fromBufferAttribute(z,T),g?(Zh.addScaledVector(T_,I),Vf.addScaledVector(A_,I),Jh.addScaledVector(kf,I)):(Zh.addScaledVector(T_.sub(ho),I),Vf.addScaledVector(A_.sub(Lc),I),Jh.addScaledVector(kf.sub(Gl),I)))}ho.add(Zh),Lc.add(Vf),Gl.add(Jh)}d.isSkinnedMesh&&(d.boneTransform(M,ho),d.boneTransform(S,Lc),d.boneTransform(T,Gl));const R=function Yx(d,r,a,c,h,p,g,_){let w;if(w=1===r.side?c.intersectTriangle(g,p,h,!0,_):c.intersectTriangle(h,p,g,2!==r.side,_),null===w)return null;zf.copy(_),zf.applyMatrix4(d.matrixWorld);const M=a.ray.origin.distanceTo(zf);return M<a.near||M>a.far?null:{distance:M,point:zf.clone(),object:d}}(d,r,a,c,ho,Lc,Gl,Ym);if(R){_&&(Xm.fromBufferAttribute(_,M),Uf.fromBufferAttribute(_,S),Au.fromBufferAttribute(_,T),R.uv=Vr.getUV(Ym,ho,Lc,Gl,Xm,Uf,Au,new Qe)),w&&(Xm.fromBufferAttribute(w,M),Uf.fromBufferAttribute(w,S),Au.fromBufferAttribute(w,T),R.uv2=Vr.getUV(Ym,ho,Lc,Gl,Xm,Uf,Au,new Qe));const L={a:M,b:S,c:T,normal:new J,materialIndex:0};Vr.getNormal(ho,Lc,Gl,L.normal),R.face=L}return R}Kr.prototype.isMesh=!0;class Wl extends Jt{constructor(r=1,a=1,c=1,h=1,p=1,g=1){super(),this.type="BoxGeometry",this.parameters={width:r,height:a,depth:c,widthSegments:h,heightSegments:p,depthSegments:g};const _=this;h=Math.floor(h),p=Math.floor(p),g=Math.floor(g);const w=[],M=[],S=[],T=[];let D=0,R=0;function L(P,I,z,B,j,H,K,ae,he,me,ke){const ve=H/he,X=K/me,ce=H/2,dt=K/2,Me=ae/2,Oe=he+1,Re=me+1;let Ge=0,xe=0;const st=new J;for(let ut=0;ut<Re;ut++){const xt=ut*X-dt;for(let pt=0;pt<Oe;pt++)st[P]=(pt*ve-ce)*B,st[I]=xt*j,st[z]=Me,M.push(st.x,st.y,st.z),st[P]=0,st[I]=0,st[z]=ae>0?1:-1,S.push(st.x,st.y,st.z),T.push(pt/he),T.push(1-ut/me),Ge+=1}for(let ut=0;ut<me;ut++)for(let xt=0;xt<he;xt++){const gn=D+xt+Oe*(ut+1),li=D+(xt+1)+Oe*(ut+1),Vn=D+(xt+1)+Oe*ut;w.push(D+xt+Oe*ut,gn,Vn),w.push(gn,li,Vn),xe+=6}_.addGroup(R,xe,ke),R+=xe,D+=Ge}L("z","y","x",-1,-1,c,a,r,g,p,0),L("z","y","x",1,-1,c,a,-r,g,p,1),L("x","z","y",1,1,r,c,a,h,g,2),L("x","z","y",1,-1,r,c,-a,h,g,3),L("x","y","z",1,-1,r,a,c,h,p,4),L("x","y","z",-1,-1,r,a,-c,h,p,5),this.setIndex(w),this.setAttribute("position",new en(M,3)),this.setAttribute("normal",new en(S,3)),this.setAttribute("uv",new en(T,2))}static fromJSON(r){return new Wl(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments)}}function Qh(d){const r={};for(const a in d){r[a]={};for(const c in d[a]){const h=d[a][c];r[a][c]=h&&(h.isColor||h.isMatrix3||h.isMatrix4||h.isVector2||h.isVector3||h.isVector4||h.isTexture||h.isQuaternion)?h.clone():Array.isArray(h)?h.slice():h}}return r}function Ki(d){const r={};for(let a=0;a<d.length;a++){const c=Qh(d[a]);for(const h in c)r[h]=c[h]}return r}const ql={clone:Qh,merge:Ki};class va extends Zt{constructor(r){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==r&&(void 0!==r.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(r))}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=Qh(r.uniforms),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const a=super.toJSON(r);a.glslVersion=this.glslVersion,a.uniforms={};for(const h in this.uniforms){const g=this.uniforms[h].value;a.uniforms[h]=g&&g.isTexture?{type:"t",value:g.toJSON(r).uuid}:g&&g.isColor?{type:"c",value:g.getHex()}:g&&g.isVector2?{type:"v2",value:g.toArray()}:g&&g.isVector3?{type:"v3",value:g.toArray()}:g&&g.isVector4?{type:"v4",value:g.toArray()}:g&&g.isMatrix3?{type:"m3",value:g.toArray()}:g&&g.isMatrix4?{type:"m4",value:g.toArray()}:{value:g}}Object.keys(this.defines).length>0&&(a.defines=this.defines),a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader;const c={};for(const h in this.extensions)!0===this.extensions[h]&&(c[h]=!0);return Object.keys(c).length>0&&(a.extensions=c),a}}va.prototype.isShaderMaterial=!0;class Hf extends _i{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new on,this.projectionMatrix=new on,this.projectionMatrixInverse=new on}copy(r,a){return super.copy(r,a),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const a=this.matrixWorld.elements;return r.set(-a[8],-a[9],-a[10]).normalize()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,a){super.updateWorldMatrix(r,a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Hf.prototype.isCamera=!0;class Ds extends Hf{constructor(r=50,a=1,c=.1,h=2e3){super(),this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=c,this.far=h,this.focus=10,this.aspect=a,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,a){return super.copy(r,a),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=null===r.view?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const a=.5*this.getFilmHeight()/r;this.fov=2*Bi*Math.atan(a),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(.5*zh*this.fov);return.5*this.getFilmHeight()/r}getEffectiveFOV(){return 2*Bi*Math.atan(Math.tan(.5*zh*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(r,a,c,h,p,g){this.aspect=r/a,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=a,this.view.offsetX=c,this.view.offsetY=h,this.view.width=p,this.view.height=g,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let a=r*Math.tan(.5*zh*this.fov)/this.zoom,c=2*a,h=this.aspect*c,p=-.5*h;const g=this.view;if(null!==this.view&&this.view.enabled){const w=g.fullWidth,M=g.fullHeight;p+=g.offsetX*h/w,a-=g.offsetY*c/M,h*=g.width/w,c*=g.height/M}const _=this.filmOffset;0!==_&&(p+=r*_/this.getFilmWidth()),this.projectionMatrix.makePerspective(p,p+h,a,a-c,r,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const a=super.toJSON(r);return a.object.fov=this.fov,a.object.zoom=this.zoom,a.object.near=this.near,a.object.far=this.far,a.object.focus=this.focus,a.object.aspect=this.aspect,null!==this.view&&(a.object.view=Object.assign({},this.view)),a.object.filmGauge=this.filmGauge,a.object.filmOffset=this.filmOffset,a}}Ds.prototype.isPerspectiveCamera=!0;class Ru extends _i{constructor(r,a,c){if(super(),this.type="CubeCamera",!0!==c.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=c;const h=new Ds(90,1,r,a);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new J(1,0,0)),this.add(h);const p=new Ds(90,1,r,a);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new J(-1,0,0)),this.add(p);const g=new Ds(90,1,r,a);g.layers=this.layers,g.up.set(0,0,1),g.lookAt(new J(0,1,0)),this.add(g);const _=new Ds(90,1,r,a);_.layers=this.layers,_.up.set(0,0,-1),_.lookAt(new J(0,-1,0)),this.add(_);const w=new Ds(90,1,r,a);w.layers=this.layers,w.up.set(0,-1,0),w.lookAt(new J(0,0,1)),this.add(w);const M=new Ds(90,1,r,a);M.layers=this.layers,M.up.set(0,-1,0),M.lookAt(new J(0,0,-1)),this.add(M)}update(r,a){null===this.parent&&this.updateMatrixWorld();const c=this.renderTarget,[h,p,g,_,w,M]=this.children,S=r.getRenderTarget(),T=r.outputEncoding,D=r.toneMapping,R=r.xr.enabled;r.outputEncoding=Cs,r.toneMapping=0,r.xr.enabled=!1;const L=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,r.setRenderTarget(c,0),r.render(a,h),r.setRenderTarget(c,1),r.render(a,p),r.setRenderTarget(c,2),r.render(a,g),r.setRenderTarget(c,3),r.render(a,_),r.setRenderTarget(c,4),r.render(a,w),c.texture.generateMipmaps=L,r.setRenderTarget(c,5),r.render(a,M),r.setRenderTarget(S),r.outputEncoding=T,r.toneMapping=D,r.xr.enabled=R,c.texture.needsPMREMUpdate=!0}}class jl extends is{constructor(r,a,c,h,p,g,_,w,M,S){super(r=void 0!==r?r:[],a=void 0!==a?a:Ii,c,h,p,g,_,w,M,S),this.flipY=!1}get images(){return this.image}set images(r){this.image=r}}jl.prototype.isCubeTexture=!0;class Pu extends rs{constructor(r,a={}){super(r,r,a);const c={width:r,height:r,depth:1};this.texture=new jl([c,c,c,c,c,c],a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,this.texture.minFilter=void 0!==a.minFilter?a.minFilter:kr}fromEquirectangularTexture(r,a){this.texture.type=a.type,this.texture.encoding=a.encoding,this.texture.generateMipmaps=a.generateMipmaps,this.texture.minFilter=a.minFilter,this.texture.magFilter=a.magFilter;const c_uniforms={tEquirect:{value:null}},c_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",c_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",h=new Wl(5,5,5),p=new va({name:"CubemapFromEquirect",uniforms:Qh(c_uniforms),vertexShader:c_vertexShader,fragmentShader:c_fragmentShader,side:1,blending:0});p.uniforms.tEquirect.value=a;const g=new Kr(h,p),_=a.minFilter;return a.minFilter===Ua&&(a.minFilter=kr),new Ru(1,10,this).update(r,g),a.minFilter=_,g.geometry.dispose(),g.material.dispose(),this}clear(r,a,c,h){const p=r.getRenderTarget();for(let g=0;g<6;g++)r.setRenderTarget(this,g),r.clear(a,c,h);r.setRenderTarget(p)}}Pu.prototype.isWebGLCubeRenderTarget=!0;const Gf=new J,$x=new J,lC=new Yi;class Js{constructor(r=new J(1,0,0),a=0){this.normal=r,this.constant=a}set(r,a){return this.normal.copy(r),this.constant=a,this}setComponents(r,a,c,h){return this.normal.set(r,a,c),this.constant=h,this}setFromNormalAndCoplanarPoint(r,a){return this.normal.copy(r),this.constant=-a.dot(this.normal),this}setFromCoplanarPoints(r,a,c){const h=Gf.subVectors(c,a).cross($x.subVectors(r,a)).normalize();return this.setFromNormalAndCoplanarPoint(h,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,a){return a.copy(this.normal).multiplyScalar(-this.distanceToPoint(r)).add(r)}intersectLine(r,a){const c=r.delta(Gf),h=this.normal.dot(c);if(0===h)return 0===this.distanceToPoint(r.start)?a.copy(r.start):null;const p=-(r.start.dot(this.normal)+this.constant)/h;return p<0||p>1?null:a.copy(c).multiplyScalar(p).add(r.start)}intersectsLine(r){const a=this.distanceToPoint(r.start),c=this.distanceToPoint(r.end);return a<0&&c>0||c<0&&a>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,a){const c=a||lC.getNormalMatrix(r),h=this.coplanarPoint(Gf).applyMatrix4(r),p=this.normal.applyMatrix3(c).normalize();return this.constant=-h.dot(p),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Js.prototype.isPlane=!0;const fl=new Cu,Km=new J;class Wf{constructor(r=new Js,a=new Js,c=new Js,h=new Js,p=new Js,g=new Js){this.planes=[r,a,c,h,p,g]}set(r,a,c,h,p,g){const _=this.planes;return _[0].copy(r),_[1].copy(a),_[2].copy(c),_[3].copy(h),_[4].copy(p),_[5].copy(g),this}copy(r){const a=this.planes;for(let c=0;c<6;c++)a[c].copy(r.planes[c]);return this}setFromProjectionMatrix(r){const a=this.planes,c=r.elements,h=c[0],p=c[1],g=c[2],_=c[3],w=c[4],M=c[5],S=c[6],T=c[7],D=c[8],R=c[9],L=c[10],P=c[11],I=c[12],z=c[13],B=c[14],j=c[15];return a[0].setComponents(_-h,T-w,P-D,j-I).normalize(),a[1].setComponents(_+h,T+w,P+D,j+I).normalize(),a[2].setComponents(_+p,T+M,P+R,j+z).normalize(),a[3].setComponents(_-p,T-M,P-R,j-z).normalize(),a[4].setComponents(_-g,T-S,P-L,j-B).normalize(),a[5].setComponents(_+g,T+S,P+L,j+B).normalize(),this}intersectsObject(r){const a=r.geometry;return null===a.boundingSphere&&a.computeBoundingSphere(),fl.copy(a.boundingSphere).applyMatrix4(r.matrixWorld),this.intersectsSphere(fl)}intersectsSprite(r){return fl.center.set(0,0,0),fl.radius=.7071067811865476,fl.applyMatrix4(r.matrixWorld),this.intersectsSphere(fl)}intersectsSphere(r){const a=this.planes,c=r.center,h=-r.radius;for(let p=0;p<6;p++)if(a[p].distanceToPoint(c)<h)return!1;return!0}intersectsBox(r){const a=this.planes;for(let c=0;c<6;c++){const h=a[c];if(Km.x=h.normal.x>0?r.max.x:r.min.x,Km.y=h.normal.y>0?r.max.y:r.min.y,Km.z=h.normal.z>0?r.max.z:r.min.z,h.distanceToPoint(Km)<0)return!1}return!0}containsPoint(r){const a=this.planes;for(let c=0;c<6;c++)if(a[c].distanceToPoint(r)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function nd(){let d=null,r=!1,a=null,c=null;function h(p,g){a(p,g),c=d.requestAnimationFrame(h)}return{start:function(){!0!==r&&null!==a&&(c=d.requestAnimationFrame(h),r=!0)},stop:function(){d.cancelAnimationFrame(c),r=!1},setAnimationLoop:function(p){a=p},setContext:function(p){d=p}}}function D_(d,r){const a=r.isWebGL2,c=new WeakMap;return{get:function g(M){return M.isInterleavedBufferAttribute&&(M=M.data),c.get(M)},remove:function _(M){M.isInterleavedBufferAttribute&&(M=M.data);const S=c.get(M);S&&(d.deleteBuffer(S.buffer),c.delete(M))},update:function w(M,S){if(M.isGLBufferAttribute){const D=c.get(M);return void((!D||D.version<M.version)&&c.set(M,{buffer:M.buffer,type:M.type,bytesPerElement:M.elementSize,version:M.version}))}M.isInterleavedBufferAttribute&&(M=M.data);const T=c.get(M);void 0===T?c.set(M,function h(M,S){const T=M.array,D=M.usage,R=d.createBuffer();let L;if(d.bindBuffer(S,R),d.bufferData(S,T,D),M.onUploadCallback(),T instanceof Float32Array)L=d.FLOAT;else if(T instanceof Uint16Array)if(M.isFloat16BufferAttribute){if(!a)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");L=d.HALF_FLOAT}else L=d.UNSIGNED_SHORT;else if(T instanceof Int16Array)L=d.SHORT;else if(T instanceof Uint32Array)L=d.UNSIGNED_INT;else if(T instanceof Int32Array)L=d.INT;else if(T instanceof Int8Array)L=d.BYTE;else if(T instanceof Uint8Array)L=d.UNSIGNED_BYTE;else{if(!(T instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+T);L=d.UNSIGNED_BYTE}return{buffer:R,type:L,bytesPerElement:T.BYTES_PER_ELEMENT,version:M.version}}(M,S)):T.version<M.version&&(function p(M,S,T){const D=S.array,R=S.updateRange;d.bindBuffer(T,M),-1===R.count?d.bufferSubData(T,0,D):(a?d.bufferSubData(T,R.offset*D.BYTES_PER_ELEMENT,D,R.offset,R.count):d.bufferSubData(T,R.offset*D.BYTES_PER_ELEMENT,D.subarray(R.offset,R.offset+R.count)),R.count=-1)}(T.buffer,M,S),T.version=M.version)}}}class Iu extends Jt{constructor(r=1,a=1,c=1,h=1){super(),this.type="PlaneGeometry",this.parameters={width:r,height:a,widthSegments:c,heightSegments:h};const p=r/2,g=a/2,_=Math.floor(c),w=Math.floor(h),M=_+1,S=w+1,T=r/_,D=a/w,R=[],L=[],P=[],I=[];for(let z=0;z<S;z++){const B=z*D-g;for(let j=0;j<M;j++)L.push(j*T-p,-B,0),P.push(0,0,1),I.push(j/_),I.push(1-z/w)}for(let z=0;z<w;z++)for(let B=0;B<_;B++){const H=B+M*(z+1),K=B+1+M*(z+1),ae=B+1+M*z;R.push(B+M*z,H,ae),R.push(H,K,ae)}this.setIndex(R),this.setAttribute("position",new en(L,3)),this.setAttribute("normal",new en(P,3)),this.setAttribute("uv",new en(I,2))}static fromJSON(r){return new Iu(r.width,r.height,r.widthSegments,r.heightSegments)}}const Jn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},At={common:{diffuse:{value:new Tt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Yi},uv2Transform:{value:new Yi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Qe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Tt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Tt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Yi}},sprite:{diffuse:{value:new Tt(16777215)},opacity:{value:1},center:{value:new Qe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Yi}}},ba={basic:{uniforms:Ki([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.fog]),vertexShader:Jn.meshbasic_vert,fragmentShader:Jn.meshbasic_frag},lambert:{uniforms:Ki([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.fog,At.lights,{emissive:{value:new Tt(0)}}]),vertexShader:Jn.meshlambert_vert,fragmentShader:Jn.meshlambert_frag},phong:{uniforms:Ki([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.fog,At.lights,{emissive:{value:new Tt(0)},specular:{value:new Tt(1118481)},shininess:{value:30}}]),vertexShader:Jn.meshphong_vert,fragmentShader:Jn.meshphong_frag},standard:{uniforms:Ki([At.common,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.roughnessmap,At.metalnessmap,At.fog,At.lights,{emissive:{value:new Tt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Jn.meshphysical_vert,fragmentShader:Jn.meshphysical_frag},toon:{uniforms:Ki([At.common,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.gradientmap,At.fog,At.lights,{emissive:{value:new Tt(0)}}]),vertexShader:Jn.meshtoon_vert,fragmentShader:Jn.meshtoon_frag},matcap:{uniforms:Ki([At.common,At.bumpmap,At.normalmap,At.displacementmap,At.fog,{matcap:{value:null}}]),vertexShader:Jn.meshmatcap_vert,fragmentShader:Jn.meshmatcap_frag},points:{uniforms:Ki([At.points,At.fog]),vertexShader:Jn.points_vert,fragmentShader:Jn.points_frag},dashed:{uniforms:Ki([At.common,At.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Jn.linedashed_vert,fragmentShader:Jn.linedashed_frag},depth:{uniforms:Ki([At.common,At.displacementmap]),vertexShader:Jn.depth_vert,fragmentShader:Jn.depth_frag},normal:{uniforms:Ki([At.common,At.bumpmap,At.normalmap,At.displacementmap,{opacity:{value:1}}]),vertexShader:Jn.meshnormal_vert,fragmentShader:Jn.meshnormal_frag},sprite:{uniforms:Ki([At.sprite,At.fog]),vertexShader:Jn.sprite_vert,fragmentShader:Jn.sprite_frag},background:{uniforms:{uvTransform:{value:new Yi},t2D:{value:null}},vertexShader:Jn.background_vert,fragmentShader:Jn.background_frag},cube:{uniforms:Ki([At.envmap,{opacity:{value:1}}]),vertexShader:Jn.cube_vert,fragmentShader:Jn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Jn.equirect_vert,fragmentShader:Jn.equirect_frag},distanceRGBA:{uniforms:Ki([At.common,At.displacementmap,{referencePosition:{value:new J},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Jn.distanceRGBA_vert,fragmentShader:Jn.distanceRGBA_frag},shadow:{uniforms:Ki([At.lights,At.fog,{color:{value:new Tt(0)},opacity:{value:1}}]),vertexShader:Jn.shadow_vert,fragmentShader:Jn.shadow_frag}};function xb(d,r,a,c,h,p){const g=new Tt(0);let w,M,_=!0===h?0:1,S=null,T=0,D=null;function L(P,I){a.buffers.color.setClear(P.r,P.g,P.b,I,p)}return{getClearColor:function(){return g},setClearColor:function(P,I=1){g.set(P),_=I,L(g,_)},getClearAlpha:function(){return _},setClearAlpha:function(P){_=P,L(g,_)},render:function R(P,I){let z=!1,B=!0===I.isScene?I.background:null;B&&B.isTexture&&(B=r.get(B));const j=d.xr,H=j.getSession&&j.getSession();H&&"additive"===H.environmentBlendMode&&(B=null),null===B?L(g,_):B&&B.isColor&&(L(B,1),z=!0),(d.autoClear||z)&&d.clear(d.autoClearColor,d.autoClearDepth,d.autoClearStencil),B&&(B.isCubeTexture||306===B.mapping)?(void 0===M&&(M=new Kr(new Wl(1,1,1),new va({name:"BackgroundCubeMaterial",uniforms:Qh(ba.cube.uniforms),vertexShader:ba.cube.vertexShader,fragmentShader:ba.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),M.geometry.deleteAttribute("normal"),M.geometry.deleteAttribute("uv"),M.onBeforeRender=function(K,ae,he){this.matrixWorld.copyPosition(he.matrixWorld)},Object.defineProperty(M.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(M)),M.material.uniforms.envMap.value=B,M.material.uniforms.flipEnvMap.value=B.isCubeTexture&&!1===B.isRenderTargetTexture?-1:1,(S!==B||T!==B.version||D!==d.toneMapping)&&(M.material.needsUpdate=!0,S=B,T=B.version,D=d.toneMapping),P.unshift(M,M.geometry,M.material,0,0,null)):B&&B.isTexture&&(void 0===w&&(w=new Kr(new Iu(2,2),new va({name:"BackgroundMaterial",uniforms:Qh(ba.background.uniforms),vertexShader:ba.background.vertexShader,fragmentShader:ba.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),Object.defineProperty(w.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(w)),w.material.uniforms.t2D.value=B,!0===B.matrixAutoUpdate&&B.updateMatrix(),w.material.uniforms.uvTransform.value.copy(B.matrix),(S!==B||T!==B.version||D!==d.toneMapping)&&(w.material.needsUpdate=!0,S=B,T=B.version,D=d.toneMapping),P.unshift(w,w.geometry,w.material,0,0,null))}}}function bb(d,r,a,c){const h=d.getParameter(d.MAX_VERTEX_ATTRIBS),p=c.isWebGL2?null:r.get("OES_vertex_array_object"),g=c.isWebGL2||null!==p,_={},w=I(null);let M=w,S=!1;function R(Me){return c.isWebGL2?d.bindVertexArray(Me):p.bindVertexArrayOES(Me)}function L(Me){return c.isWebGL2?d.deleteVertexArray(Me):p.deleteVertexArrayOES(Me)}function I(Me){const Oe=[],Re=[],Ge=[];for(let xe=0;xe<h;xe++)Oe[xe]=0,Re[xe]=0,Ge[xe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Oe,enabledAttributes:Re,attributeDivisors:Ge,object:Me,attributes:{},index:null}}function j(){const Me=M.newAttributes;for(let Oe=0,Re=Me.length;Oe<Re;Oe++)Me[Oe]=0}function H(Me){K(Me,0)}function K(Me,Oe){const Ge=M.enabledAttributes,xe=M.attributeDivisors;M.newAttributes[Me]=1,0===Ge[Me]&&(d.enableVertexAttribArray(Me),Ge[Me]=1),xe[Me]!==Oe&&((c.isWebGL2?d:r.get("ANGLE_instanced_arrays"))[c.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Me,Oe),xe[Me]=Oe)}function ae(){const Me=M.newAttributes,Oe=M.enabledAttributes;for(let Re=0,Ge=Oe.length;Re<Ge;Re++)Oe[Re]!==Me[Re]&&(d.disableVertexAttribArray(Re),Oe[Re]=0)}function he(Me,Oe,Re,Ge,xe,st){!0!==c.isWebGL2||Re!==d.INT&&Re!==d.UNSIGNED_INT?d.vertexAttribPointer(Me,Oe,Re,Ge,xe,st):d.vertexAttribIPointer(Me,Oe,Re,xe,st)}function ce(){dt(),S=!0,M!==w&&(M=w,R(M.object))}function dt(){w.geometry=null,w.program=null,w.wireframe=!1}return{setup:function T(Me,Oe,Re,Ge,xe){let st=!1;if(g){const ut=function P(Me,Oe,Re){const Ge=!0===Re.wireframe;let xe=_[Me.id];void 0===xe&&(xe={},_[Me.id]=xe);let st=xe[Oe.id];void 0===st&&(st={},xe[Oe.id]=st);let ut=st[Ge];return void 0===ut&&(ut=I(function D(){return c.isWebGL2?d.createVertexArray():p.createVertexArrayOES()}()),st[Ge]=ut),ut}(Ge,Re,Oe);M!==ut&&(M=ut,R(M.object)),st=function z(Me,Oe){const Re=M.attributes,Ge=Me.attributes;let xe=0;for(const st in Ge){const ut=Re[st],xt=Ge[st];if(void 0===ut||ut.attribute!==xt||ut.data!==xt.data)return!0;xe++}return M.attributesNum!==xe||M.index!==Oe}(Ge,xe),st&&function B(Me,Oe){const Re={},Ge=Me.attributes;let xe=0;for(const st in Ge){const ut=Ge[st],xt={};xt.attribute=ut,ut.data&&(xt.data=ut.data),Re[st]=xt,xe++}M.attributes=Re,M.attributesNum=xe,M.index=Oe}(Ge,xe)}else{const ut=!0===Oe.wireframe;(M.geometry!==Ge.id||M.program!==Re.id||M.wireframe!==ut)&&(M.geometry=Ge.id,M.program=Re.id,M.wireframe=ut,st=!0)}!0===Me.isInstancedMesh&&(st=!0),null!==xe&&a.update(xe,d.ELEMENT_ARRAY_BUFFER),(st||S)&&(S=!1,function me(Me,Oe,Re,Ge){if(!1===c.isWebGL2&&(Me.isInstancedMesh||Ge.isInstancedBufferGeometry)&&null===r.get("ANGLE_instanced_arrays"))return;j();const xe=Ge.attributes,st=Re.getAttributes(),ut=Oe.defaultAttributeValues;for(const xt in st){const pt=st[xt];if(pt.location>=0){let gn=xe[xt];if(void 0===gn&&("instanceMatrix"===xt&&Me.instanceMatrix&&(gn=Me.instanceMatrix),"instanceColor"===xt&&Me.instanceColor&&(gn=Me.instanceColor)),void 0!==gn){const li=gn.normalized,Vn=gn.itemSize,we=a.get(gn);if(void 0===we)continue;const $i=we.buffer,Qn=we.type,ei=we.bytesPerElement;if(gn.isInterleavedBufferAttribute){const Dt=gn.data,ci=Dt.stride,$e=gn.offset;if(Dt.isInstancedInterleavedBuffer){for(let it=0;it<pt.locationSize;it++)K(pt.location+it,Dt.meshPerAttribute);!0!==Me.isInstancedMesh&&void 0===Ge._maxInstanceCount&&(Ge._maxInstanceCount=Dt.meshPerAttribute*Dt.count)}else for(let it=0;it<pt.locationSize;it++)H(pt.location+it);d.bindBuffer(d.ARRAY_BUFFER,$i);for(let it=0;it<pt.locationSize;it++)he(pt.location+it,Vn/pt.locationSize,Qn,li,ci*ei,($e+Vn/pt.locationSize*it)*ei)}else{if(gn.isInstancedBufferAttribute){for(let Dt=0;Dt<pt.locationSize;Dt++)K(pt.location+Dt,gn.meshPerAttribute);!0!==Me.isInstancedMesh&&void 0===Ge._maxInstanceCount&&(Ge._maxInstanceCount=gn.meshPerAttribute*gn.count)}else for(let Dt=0;Dt<pt.locationSize;Dt++)H(pt.location+Dt);d.bindBuffer(d.ARRAY_BUFFER,$i);for(let Dt=0;Dt<pt.locationSize;Dt++)he(pt.location+Dt,Vn/pt.locationSize,Qn,li,Vn*ei,Vn/pt.locationSize*Dt*ei)}}else if(void 0!==ut){const li=ut[xt];if(void 0!==li)switch(li.length){case 2:d.vertexAttrib2fv(pt.location,li);break;case 3:d.vertexAttrib3fv(pt.location,li);break;case 4:d.vertexAttrib4fv(pt.location,li);break;default:d.vertexAttrib1fv(pt.location,li)}}}}ae()}(Me,Oe,Re,Ge),null!==xe&&d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.get(xe).buffer))},reset:ce,resetDefaultState:dt,dispose:function ke(){ce();for(const Me in _){const Oe=_[Me];for(const Re in Oe){const Ge=Oe[Re];for(const xe in Ge)L(Ge[xe].object),delete Ge[xe];delete Oe[Re]}delete _[Me]}},releaseStatesOfGeometry:function ve(Me){if(void 0===_[Me.id])return;const Oe=_[Me.id];for(const Re in Oe){const Ge=Oe[Re];for(const xe in Ge)L(Ge[xe].object),delete Ge[xe];delete Oe[Re]}delete _[Me.id]},releaseStatesOfProgram:function X(Me){for(const Oe in _){const Re=_[Oe];if(void 0===Re[Me.id])continue;const Ge=Re[Me.id];for(const xe in Ge)L(Ge[xe].object),delete Ge[xe];delete Re[Me.id]}},initAttributes:j,enableAttribute:H,disableUnusedAttributes:ae}}function OC(d,r,a,c){const h=c.isWebGL2;let p;this.setMode=function g(M){p=M},this.render=function _(M,S){d.drawArrays(p,M,S),a.update(S,p,1)},this.renderInstances=function w(M,S,T){if(0===T)return;let D,R;if(h)D=d,R="drawArraysInstanced";else if(D=r.get("ANGLE_instanced_arrays"),R="drawArraysInstancedANGLE",null===D)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");D[R](p,M,S,T),a.update(S,p,T)}}function BC(d,r,a){let c;function p(he){if("highp"===he){if(d.getShaderPrecisionFormat(d.VERTEX_SHADER,d.HIGH_FLOAT).precision>0&&d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.HIGH_FLOAT).precision>0)return"highp";he="mediump"}return"mediump"===he&&d.getShaderPrecisionFormat(d.VERTEX_SHADER,d.MEDIUM_FLOAT).precision>0&&d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const g="undefined"!=typeof WebGL2RenderingContext&&d instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&d instanceof WebGL2ComputeRenderingContext;let _=void 0!==a.precision?a.precision:"highp";const w=p(_);w!==_&&(console.warn("THREE.WebGLRenderer:",_,"not supported, using",w,"instead."),_=w);const M=g||r.has("WEBGL_draw_buffers"),S=!0===a.logarithmicDepthBuffer,T=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS),D=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS),R=d.getParameter(d.MAX_TEXTURE_SIZE),L=d.getParameter(d.MAX_CUBE_MAP_TEXTURE_SIZE),P=d.getParameter(d.MAX_VERTEX_ATTRIBS),I=d.getParameter(d.MAX_VERTEX_UNIFORM_VECTORS),z=d.getParameter(d.MAX_VARYING_VECTORS),B=d.getParameter(d.MAX_FRAGMENT_UNIFORM_VECTORS),j=D>0,H=g||r.has("OES_texture_float");return{isWebGL2:g,drawBuffers:M,getMaxAnisotropy:function h(){if(void 0!==c)return c;if(!0===r.has("EXT_texture_filter_anisotropic")){const he=r.get("EXT_texture_filter_anisotropic");c=d.getParameter(he.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else c=0;return c},getMaxPrecision:p,precision:_,logarithmicDepthBuffer:S,maxTextures:T,maxVertexTextures:D,maxTextureSize:R,maxCubemapSize:L,maxAttributes:P,maxVertexUniforms:I,maxVaryings:z,maxFragmentUniforms:B,vertexTextures:j,floatFragmentTextures:H,floatVertexTextures:j&&H,maxSamples:g?d.getParameter(d.MAX_SAMPLES):0}}function kC(d){const r=this;let a=null,c=0,h=!1,p=!1;const g=new Js,_=new Yi,w={value:null,needsUpdate:!1};function M(){w.value!==a&&(w.value=a,w.needsUpdate=c>0),r.numPlanes=c,r.numIntersection=0}function S(T,D,R,L){const P=null!==T?T.length:0;let I=null;if(0!==P){if(I=w.value,!0!==L||null===I){const z=R+4*P,B=D.matrixWorldInverse;_.getNormalMatrix(B),(null===I||I.length<z)&&(I=new Float32Array(z));for(let j=0,H=R;j!==P;++j,H+=4)g.copy(T[j]).applyMatrix4(B,_),g.normal.toArray(I,H),I[H+3]=g.constant}w.value=I,w.needsUpdate=!0}return r.numPlanes=P,r.numIntersection=0,I}this.uniform=w,this.numPlanes=0,this.numIntersection=0,this.init=function(T,D,R){const L=0!==T.length||D||0!==c||h;return h=D,a=S(T,R,0),c=T.length,L},this.beginShadows=function(){p=!0,S(null)},this.endShadows=function(){p=!1,M()},this.setState=function(T,D,R){const L=T.clippingPlanes,P=T.clipIntersection,I=T.clipShadows,z=d.get(T);if(!h||null===L||0===L.length||p&&!I)p?S(null):M();else{const B=p?0:c,j=4*B;let H=z.clippingState||null;w.value=H,H=S(L,D,j,R);for(let K=0;K!==j;++K)H[K]=a[K];z.clippingState=H,this.numIntersection=P?this.numPlanes:0,this.numPlanes+=B}}}function VC(d){let r=new WeakMap;function a(g,_){return 303===_?g.mapping=Ii:304===_&&(g.mapping=Va),g}function h(g){const _=g.target;_.removeEventListener("dispose",h);const w=r.get(_);void 0!==w&&(r.delete(_),w.dispose())}return{get:function c(g){if(g&&g.isTexture&&!1===g.isRenderTargetTexture){const _=g.mapping;if(303===_||304===_){if(r.has(g))return a(r.get(g).texture,g.mapping);{const w=g.image;if(w&&w.height>0){const M=new Pu(w.height/2);return M.fromEquirectangularTexture(d,g),r.set(g,M),g.addEventListener("dispose",h),a(M.texture,g.mapping)}return null}}}return g},dispose:function p(){r=new WeakMap}}}ba.physical={uniforms:Ki([ba.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Qe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Tt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Qe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Tt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Tt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Jn.meshphysical_vert,fragmentShader:Jn.meshphysical_frag};class ep extends Hf{constructor(r=-1,a=1,c=1,h=-1,p=.1,g=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=a,this.top=c,this.bottom=h,this.near=p,this.far=g,this.updateProjectionMatrix()}copy(r,a){return super.copy(r,a),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=null===r.view?null:Object.assign({},r.view),this}setViewOffset(r,a,c,h,p,g){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=a,this.view.offsetX=c,this.view.offsetY=h,this.view.width=p,this.view.height=g,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),a=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,h=(this.top+this.bottom)/2;let p=c-r,g=c+r,_=h+a,w=h-a;if(null!==this.view&&this.view.enabled){const M=(this.right-this.left)/this.view.fullWidth/this.zoom,S=(this.top-this.bottom)/this.view.fullHeight/this.zoom;p+=M*this.view.offsetX,g=p+M*this.view.width,_-=S*this.view.offsetY,w=_-S*this.view.height}this.projectionMatrix.makeOrthographic(p,g,_,w,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const a=super.toJSON(r);return a.object.zoom=this.zoom,a.object.left=this.left,a.object.right=this.right,a.object.top=this.top,a.object.bottom=this.bottom,a.object.near=this.near,a.object.far=this.far,null!==this.view&&(a.object.view=Object.assign({},this.view)),a}}ep.prototype.isOrthographicCamera=!0;const hd=[.125,.215,.35,.446,.526,.582],wb=new ep,UC=new Tt;let Mb=null;const dd=(1+Math.sqrt(5))/2,tp=1/dd,X_=[new J(1,1,1),new J(-1,1,1),new J(1,1,-1),new J(-1,1,-1),new J(0,dd,tp),new J(0,dd,-tp),new J(tp,0,dd),new J(-tp,0,dd),new J(dd,tp,0),new J(-dd,tp,0)];class Y_{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,a=0,c=.1,h=100){Mb=this._renderer.getRenderTarget(),this._setSize(256);const p=this._allocateTargets();return p.depthBuffer=!0,this._sceneToCubeUV(r,c,h,p),a>0&&this._blur(p,0,0,a),this._applyPMREM(p),this._cleanup(p),p}fromEquirectangular(r,a=null){return this._fromTexture(r,a)}fromCubemap(r,a=null){return this._fromTexture(r,a)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=np(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Sb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(Mb),r.scissorTest=!1,ag(r,0,0,r.width,r.height)}_fromTexture(r,a){this._setSize(r.mapping===Ii||r.mapping===Va?0===r.image.length?16:r.image[0].width||r.image[0].image.width:r.image.width/4),Mb=this._renderer.getRenderTarget();const c=a||this._allocateTargets();return this._textureToCubeUV(r,c),this._applyPMREM(c),this._cleanup(c),c}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),a=4*this._cubeSize-32,c={magFilter:kr,minFilter:kr,generateMipmaps:!1,type:ie,format:Ct,encoding:Cs,depthBuffer:!1},h=Eb(r,a,c);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==r){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Eb(r,a,c);const{_lodMax:p}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function zC(d){const r=[],a=[],c=[];let h=d;const p=d-4+1+hd.length;for(let g=0;g<p;g++){const _=Math.pow(2,h);a.push(_);let w=1/_;g>d-4?w=hd[g-d+4-1]:0===g&&(w=0),c.push(w);const M=1/(_-1),S=-M/2,T=1+M/2,D=[S,S,T,S,T,T,S,S,T,T,S,T],R=6,L=6,P=3,I=2,z=1,B=new Float32Array(P*L*R),j=new Float32Array(I*L*R),H=new Float32Array(z*L*R);for(let ae=0;ae<R;ae++){const he=ae%3*2/3-1,me=ae>2?0:-1;B.set([he,me,0,he+2/3,me,0,he+2/3,me+1,0,he,me,0,he+2/3,me+1,0,he,me+1,0],P*L*ae),j.set(D,I*L*ae),H.set([ae,ae,ae,ae,ae,ae],z*L*ae)}const K=new Jt;K.setAttribute("position",new Pi(B,P)),K.setAttribute("uv",new Pi(j,I)),K.setAttribute("faceIndex",new Pi(H,z)),r.push(K),h>4&&h--}return{lodPlanes:r,sizeLods:a,sigmas:c}}(p)),this._blurMaterial=function jP(d,r,a){const c=new Float32Array(20),h=new J(0,1,0);return new va({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/r,CUBEUV_TEXEL_HEIGHT:1/a,CUBEUV_MAX_MIP:`${d}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:c},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:h}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(p,r,a)}return h}_compileMaterial(r){const a=new Kr(this._lodPlanes[0],r);this._renderer.compile(a,wb)}_sceneToCubeUV(r,a,c,h){const _=new Ds(90,1,a,c),w=[1,-1,1,1,1,1],M=[1,1,1,-1,-1,-1],S=this._renderer,T=S.autoClear,D=S.toneMapping;S.getClearColor(UC),S.toneMapping=0,S.autoClear=!1;const R=new ul({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),L=new Kr(new Wl,R);let P=!1;const I=r.background;I?I.isColor&&(R.color.copy(I),r.background=null,P=!0):(R.color.copy(UC),P=!0);for(let z=0;z<6;z++){const B=z%3;0===B?(_.up.set(0,w[z],0),_.lookAt(M[z],0,0)):1===B?(_.up.set(0,0,w[z]),_.lookAt(0,M[z],0)):(_.up.set(0,w[z],0),_.lookAt(0,0,M[z]));const j=this._cubeSize;ag(h,B*j,z>2?j:0,j,j),S.setRenderTarget(h),P&&S.render(L,_),S.render(r,_)}L.geometry.dispose(),L.material.dispose(),S.toneMapping=D,S.autoClear=T,r.background=I}_textureToCubeUV(r,a){const c=this._renderer,h=r.mapping===Ii||r.mapping===Va;h?(null===this._cubemapMaterial&&(this._cubemapMaterial=np()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===r.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Sb());const p=h?this._cubemapMaterial:this._equirectMaterial,g=new Kr(this._lodPlanes[0],p);p.uniforms.envMap.value=r;const w=this._cubeSize;ag(a,0,0,3*w,2*w),c.setRenderTarget(a),c.render(g,wb)}_applyPMREM(r){const a=this._renderer,c=a.autoClear;a.autoClear=!1;for(let h=1;h<this._lodPlanes.length;h++){const p=Math.sqrt(this._sigmas[h]*this._sigmas[h]-this._sigmas[h-1]*this._sigmas[h-1]);this._blur(r,h-1,h,p,X_[(h-1)%X_.length])}a.autoClear=c}_blur(r,a,c,h,p){const g=this._pingPongRenderTarget;this._halfBlur(r,g,a,c,h,"latitudinal",p),this._halfBlur(g,r,c,c,h,"longitudinal",p)}_halfBlur(r,a,c,h,p,g,_){const w=this._renderer,M=this._blurMaterial;"latitudinal"!==g&&"longitudinal"!==g&&console.error("blur direction must be either latitudinal or longitudinal!");const T=new Kr(this._lodPlanes[h],M),D=M.uniforms,R=this._sizeLods[c]-1,L=isFinite(p)?Math.PI/(2*R):2*Math.PI/39,P=p/L,I=isFinite(p)?1+Math.floor(3*P):20;I>20&&console.warn(`sigmaRadians, ${p}, is too large and will clip, as it requested ${I} samples when the maximum is set to 20`);const z=[];let B=0;for(let he=0;he<20;++he){const me=he/P,ke=Math.exp(-me*me/2);z.push(ke),0===he?B+=ke:he<I&&(B+=2*ke)}for(let he=0;he<z.length;he++)z[he]=z[he]/B;D.envMap.value=r.texture,D.samples.value=I,D.weights.value=z,D.latitudinal.value="latitudinal"===g,_&&(D.poleAxis.value=_);const{_lodMax:j}=this;D.dTheta.value=L,D.mipInt.value=j-c;const H=this._sizeLods[h];ag(a,3*H*(h>j-4?h-j+4:0),4*(this._cubeSize-H),3*H,2*H),w.setRenderTarget(a),w.render(T,wb)}}function Eb(d,r,a){const c=new rs(d,r,a);return c.texture.mapping=306,c.texture.name="PMREM.cubeUv",c.scissorTest=!0,c}function ag(d,r,a,c,h){d.viewport.set(r,a,c,h),d.scissor.set(r,a,c,h)}function Sb(){return new va({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function np(){return new va({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ml(d){let r=new WeakMap,a=null;function p(_){const w=_.target;w.removeEventListener("dispose",p);const M=r.get(w);void 0!==M&&(r.delete(w),M.dispose())}return{get:function c(_){if(_&&_.isTexture){const w=_.mapping,M=303===w||304===w,S=w===Ii||w===Va;if(M||S){if(_.isRenderTargetTexture&&!0===_.needsPMREMUpdate){_.needsPMREMUpdate=!1;let T=r.get(_);return null===a&&(a=new Y_(d)),T=M?a.fromEquirectangular(_,T):a.fromCubemap(_,T),r.set(_,T),T.texture}if(r.has(_))return r.get(_).texture;{const T=_.image;if(M&&T&&T.height>0||S&&T&&function h(_){let w=0;for(let S=0;S<6;S++)void 0!==_[S]&&w++;return 6===w}(T)){null===a&&(a=new Y_(d));const D=M?a.fromEquirectangular(_):a.fromCubemap(_);return r.set(_,D),_.addEventListener("dispose",p),D.texture}return null}}}return _},dispose:function g(){r=new WeakMap,null!==a&&(a.dispose(),a=null)}}}function ip(d){const r={};function a(c){if(void 0!==r[c])return r[c];let h;switch(c){case"WEBGL_depth_texture":h=d.getExtension("WEBGL_depth_texture")||d.getExtension("MOZ_WEBGL_depth_texture")||d.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":h=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":h=d.getExtension("WEBGL_compressed_texture_s3tc")||d.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||d.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":h=d.getExtension("WEBGL_compressed_texture_pvrtc")||d.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:h=d.getExtension(c)}return r[c]=h,h}return{has:function(c){return null!==a(c)},init:function(c){c.isWebGL2?a("EXT_color_buffer_float"):(a("WEBGL_depth_texture"),a("OES_texture_float"),a("OES_texture_half_float"),a("OES_texture_half_float_linear"),a("OES_standard_derivatives"),a("OES_element_index_uint"),a("OES_vertex_array_object"),a("ANGLE_instanced_arrays")),a("OES_texture_float_linear"),a("EXT_color_buffer_half_float"),a("WEBGL_multisampled_render_to_texture")},get:function(c){const h=a(c);return null===h&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported."),h}}}function Cb(d,r,a,c){const h={},p=new WeakMap;function g(T){const D=T.target;null!==D.index&&r.remove(D.index);for(const L in D.attributes)r.remove(D.attributes[L]);D.removeEventListener("dispose",g),delete h[D.id];const R=p.get(D);R&&(r.remove(R),p.delete(D)),c.releaseStatesOfGeometry(D),!0===D.isInstancedBufferGeometry&&delete D._maxInstanceCount,a.memory.geometries--}function M(T){const D=[],R=T.index,L=T.attributes.position;let P=0;if(null!==R){const B=R.array;P=R.version;for(let j=0,H=B.length;j<H;j+=3){const K=B[j+0],ae=B[j+1],he=B[j+2];D.push(K,ae,ae,he,he,K)}}else{P=L.version;for(let j=0,H=L.array.length/3-1;j<H;j+=3){const K=j+0,ae=j+1,he=j+2;D.push(K,ae,ae,he,he,K)}}const I=new(Rf(D)?_t:rt)(D,1);I.version=P;const z=p.get(T);z&&r.remove(z),p.set(T,I)}return{get:function _(T,D){return!0===h[D.id]||(D.addEventListener("dispose",g),h[D.id]=!0,a.memory.geometries++),D},update:function w(T){const D=T.attributes;for(const L in D)r.update(D[L],d.ARRAY_BUFFER);const R=T.morphAttributes;for(const L in R){const P=R[L];for(let I=0,z=P.length;I<z;I++)r.update(P[I],d.ARRAY_BUFFER)}},getWireframeAttribute:function S(T){const D=p.get(T);if(D){const R=T.index;null!==R&&D.version<R.version&&M(T)}else M(T);return p.get(T)}}}function Tb(d,r,a,c){const h=c.isWebGL2;let p,_,w;this.setMode=function g(D){p=D},this.setIndex=function M(D){_=D.type,w=D.bytesPerElement},this.render=function S(D,R){d.drawElements(p,R,_,D*w),a.update(R,p,1)},this.renderInstances=function T(D,R,L){if(0===L)return;let P,I;if(h)P=d,I="drawElementsInstanced";else if(P=r.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",null===P)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");P[I](p,R,_,D*w,L),a.update(R,p,L)}}function Ab(d){const a={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:a,programs:null,autoReset:!0,reset:function h(){a.frame++,a.calls=0,a.triangles=0,a.points=0,a.lines=0},update:function c(p,g,_){switch(a.calls++,g){case d.TRIANGLES:a.triangles+=_*(p/3);break;case d.LINES:a.lines+=_*(p/2);break;case d.LINE_STRIP:a.lines+=_*(p-1);break;case d.LINE_LOOP:a.lines+=_*p;break;case d.POINTS:a.points+=_*p;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",g)}}}}function XP(d,r){return d[0]-r[0]}function YP(d,r){return Math.abs(r[1])-Math.abs(d[1])}function Db(d,r){let a=1;const c=r.isInterleavedBufferAttribute?r.data.array:r.array;c instanceof Int8Array?a=127:c instanceof Int16Array?a=32767:c instanceof Int32Array?a=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",c),d.divideScalar(a)}function K_(d,r,a){const c={},h=new Float32Array(8),p=new WeakMap,g=new ki,_=[];for(let M=0;M<8;M++)_[M]=[M,0];return{update:function w(M,S,T,D){const R=M.morphTargetInfluences;if(!0===r.isWebGL2){const L=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,P=void 0!==L?L.length:0;let I=p.get(S);if(void 0===I||I.count!==P){let Oe=function(){dt.dispose(),p.delete(S),S.removeEventListener("dispose",Oe)};void 0!==I&&I.texture.dispose();const j=void 0!==S.morphAttributes.position,H=void 0!==S.morphAttributes.normal,K=void 0!==S.morphAttributes.color,ae=S.morphAttributes.position||[],he=S.morphAttributes.normal||[],me=S.morphAttributes.color||[];let ke=0;!0===j&&(ke=1),!0===H&&(ke=2),!0===K&&(ke=3);let ve=S.attributes.position.count*ke,X=1;ve>r.maxTextureSize&&(X=Math.ceil(ve/r.maxTextureSize),ve=r.maxTextureSize);const ce=new Float32Array(ve*X*4*P),dt=new gs(ce,ve,X,P);dt.type=W,dt.needsUpdate=!0;const Me=4*ke;for(let Re=0;Re<P;Re++){const Ge=ae[Re],xe=he[Re],st=me[Re],ut=ve*X*4*Re;for(let xt=0;xt<Ge.count;xt++){const pt=xt*Me;!0===j&&(g.fromBufferAttribute(Ge,xt),!0===Ge.normalized&&Db(g,Ge),ce[ut+pt+0]=g.x,ce[ut+pt+1]=g.y,ce[ut+pt+2]=g.z,ce[ut+pt+3]=0),!0===H&&(g.fromBufferAttribute(xe,xt),!0===xe.normalized&&Db(g,xe),ce[ut+pt+4]=g.x,ce[ut+pt+5]=g.y,ce[ut+pt+6]=g.z,ce[ut+pt+7]=0),!0===K&&(g.fromBufferAttribute(st,xt),!0===st.normalized&&Db(g,st),ce[ut+pt+8]=g.x,ce[ut+pt+9]=g.y,ce[ut+pt+10]=g.z,ce[ut+pt+11]=4===st.itemSize?g.w:1)}}I={count:P,texture:dt,size:new Qe(ve,X)},p.set(S,I),S.addEventListener("dispose",Oe)}let z=0;for(let j=0;j<R.length;j++)z+=R[j];const B=S.morphTargetsRelative?1:1-z;D.getUniforms().setValue(d,"morphTargetBaseInfluence",B),D.getUniforms().setValue(d,"morphTargetInfluences",R),D.getUniforms().setValue(d,"morphTargetsTexture",I.texture,a),D.getUniforms().setValue(d,"morphTargetsTextureSize",I.size)}else{const L=void 0===R?0:R.length;let P=c[S.id];if(void 0===P||P.length!==L){P=[];for(let H=0;H<L;H++)P[H]=[H,0];c[S.id]=P}for(let H=0;H<L;H++){const K=P[H];K[0]=H,K[1]=R[H]}P.sort(YP);for(let H=0;H<8;H++)H<L&&P[H][1]?(_[H][0]=P[H][0],_[H][1]=P[H][1]):(_[H][0]=Number.MAX_SAFE_INTEGER,_[H][1]=0);_.sort(XP);const I=S.morphAttributes.position,z=S.morphAttributes.normal;let B=0;for(let H=0;H<8;H++){const K=_[H],ae=K[0],he=K[1];ae!==Number.MAX_SAFE_INTEGER&&he?(I&&S.getAttribute("morphTarget"+H)!==I[ae]&&S.setAttribute("morphTarget"+H,I[ae]),z&&S.getAttribute("morphNormal"+H)!==z[ae]&&S.setAttribute("morphNormal"+H,z[ae]),h[H]=he,B+=he):(I&&!0===S.hasAttribute("morphTarget"+H)&&S.deleteAttribute("morphTarget"+H),z&&!0===S.hasAttribute("morphNormal"+H)&&S.deleteAttribute("morphNormal"+H),h[H]=0)}const j=S.morphTargetsRelative?1:1-B;D.getUniforms().setValue(d,"morphTargetBaseInfluence",j),D.getUniforms().setValue(d,"morphTargetInfluences",h)}}}}function $_(d,r,a,c){let h=new WeakMap;function _(w){const M=w.target;M.removeEventListener("dispose",_),a.remove(M.instanceMatrix),null!==M.instanceColor&&a.remove(M.instanceColor)}return{update:function p(w){const M=c.render.frame,T=r.get(w,w.geometry);return h.get(T)!==M&&(r.update(T),h.set(T,M)),w.isInstancedMesh&&(!1===w.hasEventListener("dispose",_)&&w.addEventListener("dispose",_),a.update(w.instanceMatrix,d.ARRAY_BUFFER),null!==w.instanceColor&&a.update(w.instanceColor,d.ARRAY_BUFFER)),T},dispose:function g(){h=new WeakMap}}}const cg=new is,HC=new gs,GC=new ol,Z_=new jl,Rb=[],Pb=[],Ib=new Float32Array(16),Lb=new Float32Array(9),J_=new Float32Array(4);function Xl(d,r,a){const c=d[0];if(c<=0||c>0)return d;const h=r*a;let p=Rb[h];if(void 0===p&&(p=new Float32Array(h),Rb[h]=p),0!==r){c.toArray(p,0);for(let g=1,_=0;g!==r;++g)_+=a,d[g].toArray(p,_)}return p}function Eo(d,r){if(d.length!==r.length)return!1;for(let a=0,c=d.length;a<c;a++)if(d[a]!==r[a])return!1;return!0}function Rs(d,r){for(let a=0,c=r.length;a<c;a++)d[a]=r[a]}function ug(d,r){let a=Pb[r];void 0===a&&(a=new Int32Array(r),Pb[r]=a);for(let c=0;c!==r;++c)a[c]=d.allocateTextureUnit();return a}function ls(d,r){const a=this.cache;a[0]!==r&&(d.uniform1f(this.addr,r),a[0]=r)}function WC(d,r){const a=this.cache;if(void 0!==r.x)(a[0]!==r.x||a[1]!==r.y)&&(d.uniform2f(this.addr,r.x,r.y),a[0]=r.x,a[1]=r.y);else{if(Eo(a,r))return;d.uniform2fv(this.addr,r),Rs(a,r)}}function qC(d,r){const a=this.cache;if(void 0!==r.x)(a[0]!==r.x||a[1]!==r.y||a[2]!==r.z)&&(d.uniform3f(this.addr,r.x,r.y,r.z),a[0]=r.x,a[1]=r.y,a[2]=r.z);else if(void 0!==r.r)(a[0]!==r.r||a[1]!==r.g||a[2]!==r.b)&&(d.uniform3f(this.addr,r.r,r.g,r.b),a[0]=r.r,a[1]=r.g,a[2]=r.b);else{if(Eo(a,r))return;d.uniform3fv(this.addr,r),Rs(a,r)}}function Fb(d,r){const a=this.cache;if(void 0!==r.x)(a[0]!==r.x||a[1]!==r.y||a[2]!==r.z||a[3]!==r.w)&&(d.uniform4f(this.addr,r.x,r.y,r.z,r.w),a[0]=r.x,a[1]=r.y,a[2]=r.z,a[3]=r.w);else{if(Eo(a,r))return;d.uniform4fv(this.addr,r),Rs(a,r)}}function Nb(d,r){const a=this.cache,c=r.elements;if(void 0===c){if(Eo(a,r))return;d.uniformMatrix2fv(this.addr,!1,r),Rs(a,r)}else{if(Eo(a,c))return;J_.set(c),d.uniformMatrix2fv(this.addr,!1,J_),Rs(a,c)}}function jC(d,r){const a=this.cache,c=r.elements;if(void 0===c){if(Eo(a,r))return;d.uniformMatrix3fv(this.addr,!1,r),Rs(a,r)}else{if(Eo(a,c))return;Lb.set(c),d.uniformMatrix3fv(this.addr,!1,Lb),Rs(a,c)}}function XC(d,r){const a=this.cache,c=r.elements;if(void 0===c){if(Eo(a,r))return;d.uniformMatrix4fv(this.addr,!1,r),Rs(a,r)}else{if(Eo(a,c))return;Ib.set(c),d.uniformMatrix4fv(this.addr,!1,Ib),Rs(a,c)}}function YC(d,r){const a=this.cache;a[0]!==r&&(d.uniform1i(this.addr,r),a[0]=r)}function KC(d,r){const a=this.cache;Eo(a,r)||(d.uniform2iv(this.addr,r),Rs(a,r))}function $C(d,r){const a=this.cache;Eo(a,r)||(d.uniform3iv(this.addr,r),Rs(a,r))}function KP(d,r){const a=this.cache;Eo(a,r)||(d.uniform4iv(this.addr,r),Rs(a,r))}function $P(d,r){const a=this.cache;a[0]!==r&&(d.uniform1ui(this.addr,r),a[0]=r)}function rp(d,r){const a=this.cache;Eo(a,r)||(d.uniform2uiv(this.addr,r),Rs(a,r))}function So(d,r){const a=this.cache;Eo(a,r)||(d.uniform3uiv(this.addr,r),Rs(a,r))}function Q_(d,r){const a=this.cache;Eo(a,r)||(d.uniform4uiv(this.addr,r),Rs(a,r))}function Ob(d,r,a){const c=this.cache,h=a.allocateTextureUnit();c[0]!==h&&(d.uniform1i(this.addr,h),c[0]=h),a.setTexture2D(r||cg,h)}function Bb(d,r,a){const c=this.cache,h=a.allocateTextureUnit();c[0]!==h&&(d.uniform1i(this.addr,h),c[0]=h),a.setTexture3D(r||GC,h)}function po(d,r,a){const c=this.cache,h=a.allocateTextureUnit();c[0]!==h&&(d.uniform1i(this.addr,h),c[0]=h),a.setTextureCube(r||Z_,h)}function sp(d,r,a){const c=this.cache,h=a.allocateTextureUnit();c[0]!==h&&(d.uniform1i(this.addr,h),c[0]=h),a.setTexture2DArray(r||HC,h)}function ZC(d,r){d.uniform1fv(this.addr,r)}function JC(d,r){const a=Xl(r,this.size,2);d.uniform2fv(this.addr,a)}function kb(d,r){const a=Xl(r,this.size,3);d.uniform3fv(this.addr,a)}function QC(d,r){const a=Xl(r,this.size,4);d.uniform4fv(this.addr,a)}function Vb(d,r){const a=Xl(r,this.size,4);d.uniformMatrix2fv(this.addr,!1,a)}function eT(d,r){const a=Xl(r,this.size,9);d.uniformMatrix3fv(this.addr,!1,a)}function Ub(d,r){const a=Xl(r,this.size,16);d.uniformMatrix4fv(this.addr,!1,a)}function tT(d,r){d.uniform1iv(this.addr,r)}function nT(d,r){d.uniform2iv(this.addr,r)}function tv(d,r){d.uniform3iv(this.addr,r)}function iT(d,r){d.uniform4iv(this.addr,r)}function rT(d,r){d.uniform1uiv(this.addr,r)}function nv(d,r){d.uniform2uiv(this.addr,r)}function sT(d,r){d.uniform3uiv(this.addr,r)}function oT(d,r){d.uniform4uiv(this.addr,r)}function op(d,r,a){const c=r.length,h=ug(a,c);d.uniform1iv(this.addr,h);for(let p=0;p!==c;++p)a.setTexture2D(r[p]||cg,h[p])}function aT(d,r,a){const c=r.length,h=ug(a,c);d.uniform1iv(this.addr,h);for(let p=0;p!==c;++p)a.setTexture3D(r[p]||GC,h[p])}function lT(d,r,a){const c=r.length,h=ug(a,c);d.uniform1iv(this.addr,h);for(let p=0;p!==c;++p)a.setTextureCube(r[p]||Z_,h[p])}function cT(d,r,a){const c=r.length,h=ug(a,c);d.uniform1iv(this.addr,h);for(let p=0;p!==c;++p)a.setTexture2DArray(r[p]||HC,h[p])}function hT(d,r,a){this.id=d,this.addr=a,this.cache=[],this.setValue=function ev(d){switch(d){case 5126:return ls;case 35664:return WC;case 35665:return qC;case 35666:return Fb;case 35674:return Nb;case 35675:return jC;case 35676:return XC;case 5124:case 35670:return YC;case 35667:case 35671:return KC;case 35668:case 35672:return $C;case 35669:case 35673:return KP;case 5125:return $P;case 36294:return rp;case 36295:return So;case 36296:return Q_;case 35678:case 36198:case 36298:case 36306:case 35682:return Ob;case 35679:case 36299:case 36307:return Bb;case 35680:case 36300:case 36308:case 36293:return po;case 36289:case 36303:case 36311:case 36292:return sp}}(r.type)}function iv(d,r,a){this.id=d,this.addr=a,this.cache=[],this.size=r.size,this.setValue=function uT(d){switch(d){case 5126:return ZC;case 35664:return JC;case 35665:return kb;case 35666:return QC;case 35674:return Vb;case 35675:return eT;case 35676:return Ub;case 5124:case 35670:return tT;case 35667:case 35671:return nT;case 35668:case 35672:return tv;case 35669:case 35673:return iT;case 5125:return rT;case 36294:return nv;case 36295:return sT;case 36296:return oT;case 35678:case 36198:case 36298:case 36306:case 35682:return op;case 35679:case 36299:case 36307:return aT;case 35680:case 36300:case 36308:case 36293:return lT;case 36289:case 36303:case 36311:case 36292:return cT}}(r.type)}function zb(d){this.id=d,this.seq=[],this.map={}}iv.prototype.updateCache=function(d){const r=this.cache;d instanceof Float32Array&&r.length!==d.length&&(this.cache=new Float32Array(d.length)),Rs(r,d)},zb.prototype.setValue=function(d,r,a){const c=this.seq;for(let h=0,p=c.length;h!==p;++h){const g=c[h];g.setValue(d,r[g.id],a)}};const rv=/(\w+)(\])?(\[|\.)?/g;function Hb(d,r){d.seq.push(r),d.map[r.id]=r}function dT(d,r,a){const c=d.name,h=c.length;for(rv.lastIndex=0;;){const p=rv.exec(c),g=rv.lastIndex;let _=p[1];const M=p[3];if("]"===p[2]&&(_|=0),void 0===M||"["===M&&g+2===h){Hb(a,void 0===M?new hT(_,d,r):new iv(_,d,r));break}{let T=a.map[_];void 0===T&&(T=new zb(_),Hb(a,T)),a=T}}}function Fc(d,r){this.seq=[],this.map={};const a=d.getProgramParameter(r,d.ACTIVE_UNIFORMS);for(let c=0;c<a;++c){const h=d.getActiveUniform(r,c);dT(h,d.getUniformLocation(r,h.name),this)}}function Gb(d,r,a){const c=d.createShader(r);return d.shaderSource(c,a),d.compileShader(c),c}Fc.prototype.setValue=function(d,r,a,c){const h=this.map[r];void 0!==h&&h.setValue(d,a,c)},Fc.prototype.setOptional=function(d,r,a){const c=r[a];void 0!==c&&this.setValue(d,a,c)},Fc.upload=function(d,r,a,c){for(let h=0,p=r.length;h!==p;++h){const g=r[h],_=a[g.id];!1!==_.needsUpdate&&g.setValue(d,_.value,c)}},Fc.seqWithValue=function(d,r){const a=[];for(let c=0,h=d.length;c!==h;++c){const p=d[c];p.id in r&&a.push(p)}return a};let sv=0;function qa(d,r,a){const c=d.getShaderParameter(r,d.COMPILE_STATUS),h=d.getShaderInfoLog(r).trim();if(c&&""===h)return"";const p=parseInt(/ERROR: 0:(\d+)/.exec(h)[1]);return a.toUpperCase()+"\n\n"+h+"\n\n"+function fT(d,r){const a=d.split("\n"),c=[],h=Math.max(r-6,0),p=Math.min(r+6,a.length);for(let g=h;g<p;g++)c.push(g+1+": "+a[g]);return c.join("\n")}(d.getShaderSource(r),p)}function ZP(d,r){const a=function fd(d){switch(d){case Cs:return["Linear","( value )"];case wr:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",d),["Linear","( value )"]}}(r);return"vec4 "+d+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function JP(d,r){let a;switch(r){case 1:a="Linear";break;case 2:a="Reinhard";break;case 3:a="OptimizedCineon";break;case 4:a="ACESFilmic";break;case 5:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),a="Linear"}return"vec3 "+d+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function Fu(d){return""!==d}function hg(d,r){return d.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function qb(d,r){return d.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}const jb=/^[ \t]*#include +<([\w\d./]+)>/gm;function Nu(d){return d.replace(jb,Xb)}function Xb(d,r){const a=Jn[r];if(void 0===a)throw new Error("Can not resolve #include <"+r+">");return Nu(a)}const Yb=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ov=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function dg(d){return d.replace(ov,pT).replace(Yb,Kb)}function Kb(d,r,a,c){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),pT(0,r,a,c)}function pT(d,r,a,c){let h="";for(let p=parseInt(r);p<parseInt(a);p++)h+=c.replace(/\[\s*i\s*\]/g,"[ "+p+" ]").replace(/UNROLLED_LOOP_INDEX/g,p);return h}function Ou(d){let r="precision "+d.precision+" float;\nprecision "+d.precision+" int;";return"highp"===d.precision?r+="\n#define HIGH_PRECISION":"mediump"===d.precision?r+="\n#define MEDIUM_PRECISION":"lowp"===d.precision&&(r+="\n#define LOW_PRECISION"),r}function yT(d,r,a,c){const h=d.getContext(),p=a.defines;let g=a.vertexShader,_=a.fragmentShader;const w=function av(d){let r="SHADOWMAP_TYPE_BASIC";return 1===d.shadowMapType?r="SHADOWMAP_TYPE_PCF":2===d.shadowMapType?r="SHADOWMAP_TYPE_PCF_SOFT":3===d.shadowMapType&&(r="SHADOWMAP_TYPE_VSM"),r}(a),M=function $b(d){let r="ENVMAP_TYPE_CUBE";if(d.envMap)switch(d.envMapMode){case Ii:case Va:r="ENVMAP_TYPE_CUBE";break;case 306:r="ENVMAP_TYPE_CUBE_UV"}return r}(a),S=function mT(d){let r="ENVMAP_MODE_REFLECTION";return d.envMap&&d.envMapMode===Va&&(r="ENVMAP_MODE_REFRACTION"),r}(a),T=function lv(d){let r="ENVMAP_BLENDING_NONE";if(d.envMap)switch(d.combine){case 0:r="ENVMAP_BLENDING_MULTIPLY";break;case 1:r="ENVMAP_BLENDING_MIX";break;case 2:r="ENVMAP_BLENDING_ADD"}return r}(a),D=function gT(d){const r=d.envMapCubeUVHeight;if(null===r)return null;const a=Math.log2(r/32+1)+3,c=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,a),112)),texelHeight:c,maxMip:a}}(a),R=a.isWebGL2?"":function Wb(d){return[d.extensionDerivatives||d.envMapCubeUVHeight||d.bumpMap||d.tangentSpaceNormalMap||d.clearcoatNormalMap||d.flatShading||"physical"===d.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(d.extensionFragDepth||d.logarithmicDepthBuffer)&&d.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",d.extensionDrawBuffers&&d.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(d.extensionShaderTextureLOD||d.envMap||d.transmission)&&d.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fu).join("\n")}(a),L=function QP(d){const r=[];for(const a in d){const c=d[a];!1!==c&&r.push("#define "+a+" "+c)}return r.join("\n")}(p),P=h.createProgram();let I,z,B=a.glslVersion?"#version "+a.glslVersion+"\n":"";a.isRawShaderMaterial?(I=[L].filter(Fu).join("\n"),I.length>0&&(I+="\n"),z=[R,L].filter(Fu).join("\n"),z.length>0&&(z+="\n")):(I=[Ou(a),"#define SHADER_NAME "+a.shaderName,L,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+S:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.morphColors&&a.isWebGL2?"#define USE_MORPHCOLORS":"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+a.morphTextureStride:"",a.morphTargetsCount>0&&a.isWebGL2?"#define MORPHTARGETS_COUNT "+a.morphTargetsCount:"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Fu).join("\n"),z=[R,Ou(a),"#define SHADER_NAME "+a.shaderName,L,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+M:"",a.envMap?"#define "+S:"",a.envMap?"#define "+T:"",D?"#define CUBEUV_TEXEL_WIDTH "+D.texelWidth:"",D?"#define CUBEUV_TEXEL_HEIGHT "+D.texelHeight:"",D?"#define CUBEUV_MAX_MIP "+D.maxMip+".0":"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoat?"#define USE_CLEARCOAT":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",a.specularColorMap?"#define USE_SPECULARCOLORMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.alphaTest?"#define USE_ALPHATEST":"",a.sheen?"#define USE_SHEEN":"",a.sheenColorMap?"#define USE_SHEENCOLORMAP":"",a.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",a.transmission?"#define USE_TRANSMISSION":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.thicknessMap?"#define USE_THICKNESSMAP":"",a.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexAlphas?"#define USE_COLOR_ALPHA":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?Jn.tonemapping_pars_fragment:"",0!==a.toneMapping?JP("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.opaque?"#define OPAQUE":"",Jn.encodings_pars_fragment,ZP("linearToOutputTexel",a.outputEncoding),a.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(Fu).join("\n")),g=Nu(g),g=hg(g,a),g=qb(g,a),_=Nu(_),_=hg(_,a),_=qb(_,a),g=dg(g),_=dg(_),a.isWebGL2&&!0!==a.isRawShaderMaterial&&(B="#version 300 es\n",I=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+I,z=["#define varying in",a.glslVersion===Rx?"":"layout(location = 0) out highp vec4 pc_fragColor;",a.glslVersion===Rx?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+z);const H=B+z+_,K=Gb(h,h.VERTEX_SHADER,B+I+g),ae=Gb(h,h.FRAGMENT_SHADER,H);if(h.attachShader(P,K),h.attachShader(P,ae),void 0!==a.index0AttributeName?h.bindAttribLocation(P,0,a.index0AttributeName):!0===a.morphTargets&&h.bindAttribLocation(P,0,"position"),h.linkProgram(P),d.debug.checkShaderErrors){const ke=h.getProgramInfoLog(P).trim(),ve=h.getShaderInfoLog(K).trim(),X=h.getShaderInfoLog(ae).trim();let ce=!0,dt=!0;if(!1===h.getProgramParameter(P,h.LINK_STATUS)){ce=!1;const Me=qa(h,K,"vertex"),Oe=qa(h,ae,"fragment");console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(P,h.VALIDATE_STATUS)+"\n\nProgram Info Log: "+ke+"\n"+Me+"\n"+Oe)}else""!==ke?console.warn("THREE.WebGLProgram: Program Info Log:",ke):(""===ve||""===X)&&(dt=!1);dt&&(this.diagnostics={runnable:ce,programLog:ke,vertexShader:{log:ve,prefix:I},fragmentShader:{log:X,prefix:z}})}let he,me;return h.deleteShader(K),h.deleteShader(ae),this.getUniforms=function(){return void 0===he&&(he=new Fc(h,P)),he},this.getAttributes=function(){return void 0===me&&(me=function ta(d,r){const a={},c=d.getProgramParameter(r,d.ACTIVE_ATTRIBUTES);for(let h=0;h<c;h++){const p=d.getActiveAttrib(r,h),g=p.name;let _=1;p.type===d.FLOAT_MAT2&&(_=2),p.type===d.FLOAT_MAT3&&(_=3),p.type===d.FLOAT_MAT4&&(_=4),a[g]={type:p.type,location:d.getAttribLocation(r,g),locationSize:_}}return a}(h,P)),me},this.destroy=function(){c.releaseStatesOfProgram(this),h.deleteProgram(P),this.program=void 0},this.name=a.shaderName,this.id=sv++,this.cacheKey=r,this.usedTimes=1,this.program=P,this.vertexShader=K,this.fragmentShader=ae,this}let _T=0;class vT{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(r){const c=r.fragmentShader,h=this._getShaderStage(r.vertexShader),p=this._getShaderStage(c),g=this._getShaderCacheForMaterial(r);return!1===g.has(h)&&(g.add(h),h.usedTimes++),!1===g.has(p)&&(g.add(p),p.usedTimes++),this}remove(r){const a=this.materialCache.get(r);for(const c of a)c.usedTimes--,0===c.usedTimes&&this.shaderCache.delete(c.code);return this.materialCache.delete(r),this}getVertexShaderID(r){return this._getShaderStage(r.vertexShader).id}getFragmentShaderID(r){return this._getShaderStage(r.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(r){const a=this.materialCache;return!1===a.has(r)&&a.set(r,new Set),a.get(r)}_getShaderStage(r){const a=this.shaderCache;if(!1===a.has(r)){const c=new xT(r);a.set(r,c)}return a.get(r)}}class xT{constructor(r){this.id=_T++,this.code=r,this.usedTimes=0}}function bT(d,r,a,c,h,p,g){const _=new Xh,w=new vT,M=[],S=h.isWebGL2,T=h.logarithmicDepthBuffer,D=h.floatVertexTextures,R=h.maxVertexUniforms,L=h.vertexTextures;let P=h.precision;const I={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function B(X,ce,dt,Me,Oe){const Re=Me.fog,Ge=Oe.geometry,st=(X.isMeshStandardMaterial?a:r).get(X.envMap||(X.isMeshStandardMaterial?Me.environment:null)),ut=st&&306===st.mapping?st.image.height:null,xt=I[X.type],pt=Oe.isSkinnedMesh?function z(X){const dt=X.skeleton.bones;if(D)return 1024;{const Oe=Math.floor((R-20)/4),Re=Math.min(Oe,dt.length);return Re<dt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+dt.length+" bones. This GPU supports "+Re+"."),0):Re}}(Oe):0;null!==X.precision&&(P=h.getMaxPrecision(X.precision),P!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",P,"instead."));const gn=Ge.morphAttributes.position||Ge.morphAttributes.normal||Ge.morphAttributes.color,li=void 0!==gn?gn.length:0;let we,$i,Qn,ei,Vn=0;if(void 0!==Ge.morphAttributes.position&&(Vn=1),void 0!==Ge.morphAttributes.normal&&(Vn=2),void 0!==Ge.morphAttributes.color&&(Vn=3),xt){const vt=ba[xt];we=vt.vertexShader,$i=vt.fragmentShader}else we=X.vertexShader,$i=X.fragmentShader,w.update(X),Qn=w.getVertexShaderID(X),ei=w.getFragmentShaderID(X);const Dt=d.getRenderTarget(),$e=X.clearcoat>0;return{isWebGL2:S,shaderID:xt,shaderName:X.type,vertexShader:we,fragmentShader:$i,defines:X.defines,customVertexShaderID:Qn,customFragmentShaderID:ei,isRawShaderMaterial:!0===X.isRawShaderMaterial,glslVersion:X.glslVersion,precision:P,instancing:!0===Oe.isInstancedMesh,instancingColor:!0===Oe.isInstancedMesh&&null!==Oe.instanceColor,supportsVertexTextures:L,outputEncoding:null===Dt?d.outputEncoding:!0===Dt.isXRRenderTarget?Dt.texture.encoding:Cs,map:!!X.map,matcap:!!X.matcap,envMap:!!st,envMapMode:st&&st.mapping,envMapCubeUVHeight:ut,lightMap:!!X.lightMap,aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:1===X.normalMapType,tangentSpaceNormalMap:0===X.normalMapType,decodeVideoTexture:!!X.map&&!0===X.map.isVideoTexture&&X.map.encoding===wr,clearcoat:$e,clearcoatMap:$e&&!!X.clearcoatMap,clearcoatRoughnessMap:$e&&!!X.clearcoatRoughnessMap,clearcoatNormalMap:$e&&!!X.clearcoatNormalMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,specularIntensityMap:!!X.specularIntensityMap,specularColorMap:!!X.specularColorMap,opaque:!1===X.transparent&&1===X.blending,alphaMap:!!X.alphaMap,alphaTest:X.alphaTest>0,gradientMap:!!X.gradientMap,sheen:X.sheen>0,sheenColorMap:!!X.sheenColorMap,sheenRoughnessMap:!!X.sheenRoughnessMap,transmission:X.transmission>0,transmissionMap:!!X.transmissionMap,thicknessMap:!!X.thicknessMap,combine:X.combine,vertexTangents:!!X.normalMap&&!!Ge.attributes.tangent,vertexColors:X.vertexColors,vertexAlphas:!0===X.vertexColors&&!!Ge.attributes.color&&4===Ge.attributes.color.itemSize,vertexUvs:!!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatMap||X.clearcoatRoughnessMap||X.clearcoatNormalMap||X.displacementMap||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheenColorMap||X.sheenRoughnessMap),uvsVertexOnly:!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatNormalMap||X.transmission>0||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheen>0||X.sheenColorMap||X.sheenRoughnessMap||!X.displacementMap),fog:!!Re,useFog:X.fog,fogExp2:Re&&Re.isFogExp2,flatShading:!!X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:T,skinning:!0===Oe.isSkinnedMesh&&pt>0,maxBones:pt,useVertexTexture:D,morphTargets:void 0!==Ge.morphAttributes.position,morphNormals:void 0!==Ge.morphAttributes.normal,morphColors:void 0!==Ge.morphAttributes.color,morphTargetsCount:li,morphTextureStride:Vn,numDirLights:ce.directional.length,numPointLights:ce.point.length,numSpotLights:ce.spot.length,numRectAreaLights:ce.rectArea.length,numHemiLights:ce.hemi.length,numDirLightShadows:ce.directionalShadowMap.length,numPointLightShadows:ce.pointShadowMap.length,numSpotLightShadows:ce.spotShadowMap.length,numClippingPlanes:g.numPlanes,numClipIntersection:g.numIntersection,dithering:X.dithering,shadowMapEnabled:d.shadowMap.enabled&&dt.length>0,shadowMapType:d.shadowMap.type,toneMapping:X.toneMapped?d.toneMapping:0,physicallyCorrectLights:d.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,doubleSided:2===X.side,flipSided:1===X.side,depthPacking:void 0!==X.depthPacking&&X.depthPacking,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:S||c.has("EXT_frag_depth"),rendererExtensionDrawBuffers:S||c.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:S||c.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}},getProgramCacheKey:function j(X){const ce=[];if(X.shaderID?ce.push(X.shaderID):(ce.push(X.customVertexShaderID),ce.push(X.customFragmentShaderID)),void 0!==X.defines)for(const dt in X.defines)ce.push(dt),ce.push(X.defines[dt]);return!1===X.isRawShaderMaterial&&(function H(X,ce){X.push(ce.precision),X.push(ce.outputEncoding),X.push(ce.envMapMode),X.push(ce.envMapCubeUVHeight),X.push(ce.combine),X.push(ce.vertexUvs),X.push(ce.fogExp2),X.push(ce.sizeAttenuation),X.push(ce.maxBones),X.push(ce.morphTargetsCount),X.push(ce.morphAttributeCount),X.push(ce.numDirLights),X.push(ce.numPointLights),X.push(ce.numSpotLights),X.push(ce.numHemiLights),X.push(ce.numRectAreaLights),X.push(ce.numDirLightShadows),X.push(ce.numPointLightShadows),X.push(ce.numSpotLightShadows),X.push(ce.shadowMapType),X.push(ce.toneMapping),X.push(ce.numClippingPlanes),X.push(ce.numClipIntersection)}(ce,X),function K(X,ce){_.disableAll(),ce.isWebGL2&&_.enable(0),ce.supportsVertexTextures&&_.enable(1),ce.instancing&&_.enable(2),ce.instancingColor&&_.enable(3),ce.map&&_.enable(4),ce.matcap&&_.enable(5),ce.envMap&&_.enable(6),ce.lightMap&&_.enable(7),ce.aoMap&&_.enable(8),ce.emissiveMap&&_.enable(9),ce.bumpMap&&_.enable(10),ce.normalMap&&_.enable(11),ce.objectSpaceNormalMap&&_.enable(12),ce.tangentSpaceNormalMap&&_.enable(13),ce.clearcoat&&_.enable(14),ce.clearcoatMap&&_.enable(15),ce.clearcoatRoughnessMap&&_.enable(16),ce.clearcoatNormalMap&&_.enable(17),ce.displacementMap&&_.enable(18),ce.specularMap&&_.enable(19),ce.roughnessMap&&_.enable(20),ce.metalnessMap&&_.enable(21),ce.gradientMap&&_.enable(22),ce.alphaMap&&_.enable(23),ce.alphaTest&&_.enable(24),ce.vertexColors&&_.enable(25),ce.vertexAlphas&&_.enable(26),ce.vertexUvs&&_.enable(27),ce.vertexTangents&&_.enable(28),ce.uvsVertexOnly&&_.enable(29),ce.fog&&_.enable(30),X.push(_.mask),_.disableAll(),ce.useFog&&_.enable(0),ce.flatShading&&_.enable(1),ce.logarithmicDepthBuffer&&_.enable(2),ce.skinning&&_.enable(3),ce.useVertexTexture&&_.enable(4),ce.morphTargets&&_.enable(5),ce.morphNormals&&_.enable(6),ce.morphColors&&_.enable(7),ce.premultipliedAlpha&&_.enable(8),ce.shadowMapEnabled&&_.enable(9),ce.physicallyCorrectLights&&_.enable(10),ce.doubleSided&&_.enable(11),ce.flipSided&&_.enable(12),ce.depthPacking&&_.enable(13),ce.dithering&&_.enable(14),ce.specularIntensityMap&&_.enable(15),ce.specularColorMap&&_.enable(16),ce.transmission&&_.enable(17),ce.transmissionMap&&_.enable(18),ce.thicknessMap&&_.enable(19),ce.sheen&&_.enable(20),ce.sheenColorMap&&_.enable(21),ce.sheenRoughnessMap&&_.enable(22),ce.decodeVideoTexture&&_.enable(23),ce.opaque&&_.enable(24),X.push(_.mask)}(ce,X),ce.push(d.outputEncoding)),ce.push(X.customProgramCacheKey),ce.join()},getUniforms:function ae(X){const ce=I[X.type];let dt;return dt=ce?ql.clone(ba[ce].uniforms):X.uniforms,dt},acquireProgram:function he(X,ce){let dt;for(let Me=0,Oe=M.length;Me<Oe;Me++){const Re=M[Me];if(Re.cacheKey===ce){dt=Re,++dt.usedTimes;break}}return void 0===dt&&(dt=new yT(d,ce,X,p),M.push(dt)),dt},releaseProgram:function me(X){if(0==--X.usedTimes){const ce=M.indexOf(X);M[ce]=M[M.length-1],M.pop(),X.destroy()}},releaseShaderCache:function ke(X){w.remove(X)},programs:M,dispose:function ve(){w.dispose()}}}function Zb(){let d=new WeakMap;return{get:function r(p){let g=d.get(p);return void 0===g&&(g={},d.set(p,g)),g},remove:function a(p){d.delete(p)},update:function c(p,g,_){d.get(p)[g]=_},dispose:function h(){d=new WeakMap}}}function cv(d,r){return d.groupOrder!==r.groupOrder?d.groupOrder-r.groupOrder:d.renderOrder!==r.renderOrder?d.renderOrder-r.renderOrder:d.material.id!==r.material.id?d.material.id-r.material.id:d.z!==r.z?d.z-r.z:d.id-r.id}function uv(d,r){return d.groupOrder!==r.groupOrder?d.groupOrder-r.groupOrder:d.renderOrder!==r.renderOrder?d.renderOrder-r.renderOrder:d.z!==r.z?r.z-d.z:d.id-r.id}function fg(){const d=[];let r=0;const a=[],c=[],h=[];function g(T,D,R,L,P,I){let z=d[r];return void 0===z?(z={id:T.id,object:T,geometry:D,material:R,groupOrder:L,renderOrder:T.renderOrder,z:P,group:I},d[r]=z):(z.id=T.id,z.object=T,z.geometry=D,z.material=R,z.groupOrder=L,z.renderOrder=T.renderOrder,z.z=P,z.group=I),r++,z}return{opaque:a,transmissive:c,transparent:h,init:function p(){r=0,a.length=0,c.length=0,h.length=0},push:function _(T,D,R,L,P,I){const z=g(T,D,R,L,P,I);R.transmission>0?c.push(z):!0===R.transparent?h.push(z):a.push(z)},unshift:function w(T,D,R,L,P,I){const z=g(T,D,R,L,P,I);R.transmission>0?c.unshift(z):!0===R.transparent?h.unshift(z):a.unshift(z)},finish:function S(){for(let T=r,D=d.length;T<D;T++){const R=d[T];if(null===R.id)break;R.id=null,R.object=null,R.geometry=null,R.material=null,R.group=null}},sort:function M(T,D){a.length>1&&a.sort(T||cv),c.length>1&&c.sort(D||uv),h.length>1&&h.sort(D||uv)}}}function wT(){let d=new WeakMap;return{get:function r(c,h){let p;return!1===d.has(c)?(p=new fg,d.set(c,[p])):h>=d.get(c).length?(p=new fg,d.get(c).push(p)):p=d.get(c)[h],p},dispose:function a(){d=new WeakMap}}}function MT(){const d={};return{get:function(r){if(void 0!==d[r.id])return d[r.id];let a;switch(r.type){case"DirectionalLight":a={direction:new J,color:new Tt};break;case"SpotLight":a={position:new J,direction:new J,color:new Tt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new J,color:new Tt,distance:0,decay:0};break;case"HemisphereLight":a={direction:new J,skyColor:new Tt,groundColor:new Tt};break;case"RectAreaLight":a={color:new Tt,position:new J,halfWidth:new J,halfHeight:new J}}return d[r.id]=a,a}}}let Qb=0;function Bu(d,r){return(r.castShadow?1:0)-(d.castShadow?1:0)}function ew(d,r){const a=new MT,c=function Jb(){const d={};return{get:function(r){if(void 0!==d[r.id])return d[r.id];let a;switch(r.type){case"DirectionalLight":case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe,shadowCameraNear:1,shadowCameraFar:1e3}}return d[r.id]=a,a}}}(),h={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let S=0;S<9;S++)h.probe.push(new J);const p=new J,g=new on,_=new on;return{setup:function w(S,T){let D=0,R=0,L=0;for(let ke=0;ke<9;ke++)h.probe[ke].set(0,0,0);let P=0,I=0,z=0,B=0,j=0,H=0,K=0,ae=0;S.sort(Bu);const he=!0!==T?Math.PI:1;for(let ke=0,ve=S.length;ke<ve;ke++){const X=S[ke],ce=X.color,dt=X.intensity,Me=X.distance,Oe=X.shadow&&X.shadow.map?X.shadow.map.texture:null;if(X.isAmbientLight)D+=ce.r*dt*he,R+=ce.g*dt*he,L+=ce.b*dt*he;else if(X.isLightProbe)for(let Re=0;Re<9;Re++)h.probe[Re].addScaledVector(X.sh.coefficients[Re],dt);else if(X.isDirectionalLight){const Re=a.get(X);if(Re.color.copy(X.color).multiplyScalar(X.intensity*he),X.castShadow){const Ge=X.shadow,xe=c.get(X);xe.shadowBias=Ge.bias,xe.shadowNormalBias=Ge.normalBias,xe.shadowRadius=Ge.radius,xe.shadowMapSize=Ge.mapSize,h.directionalShadow[P]=xe,h.directionalShadowMap[P]=Oe,h.directionalShadowMatrix[P]=X.shadow.matrix,H++}h.directional[P]=Re,P++}else if(X.isSpotLight){const Re=a.get(X);if(Re.position.setFromMatrixPosition(X.matrixWorld),Re.color.copy(ce).multiplyScalar(dt*he),Re.distance=Me,Re.coneCos=Math.cos(X.angle),Re.penumbraCos=Math.cos(X.angle*(1-X.penumbra)),Re.decay=X.decay,X.castShadow){const Ge=X.shadow,xe=c.get(X);xe.shadowBias=Ge.bias,xe.shadowNormalBias=Ge.normalBias,xe.shadowRadius=Ge.radius,xe.shadowMapSize=Ge.mapSize,h.spotShadow[z]=xe,h.spotShadowMap[z]=Oe,h.spotShadowMatrix[z]=X.shadow.matrix,ae++}h.spot[z]=Re,z++}else if(X.isRectAreaLight){const Re=a.get(X);Re.color.copy(ce).multiplyScalar(dt),Re.halfWidth.set(.5*X.width,0,0),Re.halfHeight.set(0,.5*X.height,0),h.rectArea[B]=Re,B++}else if(X.isPointLight){const Re=a.get(X);if(Re.color.copy(X.color).multiplyScalar(X.intensity*he),Re.distance=X.distance,Re.decay=X.decay,X.castShadow){const Ge=X.shadow,xe=c.get(X);xe.shadowBias=Ge.bias,xe.shadowNormalBias=Ge.normalBias,xe.shadowRadius=Ge.radius,xe.shadowMapSize=Ge.mapSize,xe.shadowCameraNear=Ge.camera.near,xe.shadowCameraFar=Ge.camera.far,h.pointShadow[I]=xe,h.pointShadowMap[I]=Oe,h.pointShadowMatrix[I]=X.shadow.matrix,K++}h.point[I]=Re,I++}else if(X.isHemisphereLight){const Re=a.get(X);Re.skyColor.copy(X.color).multiplyScalar(dt*he),Re.groundColor.copy(X.groundColor).multiplyScalar(dt*he),h.hemi[j]=Re,j++}}B>0&&(r.isWebGL2||!0===d.has("OES_texture_float_linear")?(h.rectAreaLTC1=At.LTC_FLOAT_1,h.rectAreaLTC2=At.LTC_FLOAT_2):!0===d.has("OES_texture_half_float_linear")?(h.rectAreaLTC1=At.LTC_HALF_1,h.rectAreaLTC2=At.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),h.ambient[0]=D,h.ambient[1]=R,h.ambient[2]=L;const me=h.hash;(me.directionalLength!==P||me.pointLength!==I||me.spotLength!==z||me.rectAreaLength!==B||me.hemiLength!==j||me.numDirectionalShadows!==H||me.numPointShadows!==K||me.numSpotShadows!==ae)&&(h.directional.length=P,h.spot.length=z,h.rectArea.length=B,h.point.length=I,h.hemi.length=j,h.directionalShadow.length=H,h.directionalShadowMap.length=H,h.pointShadow.length=K,h.pointShadowMap.length=K,h.spotShadow.length=ae,h.spotShadowMap.length=ae,h.directionalShadowMatrix.length=H,h.pointShadowMatrix.length=K,h.spotShadowMatrix.length=ae,me.directionalLength=P,me.pointLength=I,me.spotLength=z,me.rectAreaLength=B,me.hemiLength=j,me.numDirectionalShadows=H,me.numPointShadows=K,me.numSpotShadows=ae,h.version=Qb++)},setupView:function M(S,T){let D=0,R=0,L=0,P=0,I=0;const z=T.matrixWorldInverse;for(let B=0,j=S.length;B<j;B++){const H=S[B];if(H.isDirectionalLight){const K=h.directional[D];K.direction.setFromMatrixPosition(H.matrixWorld),p.setFromMatrixPosition(H.target.matrixWorld),K.direction.sub(p),K.direction.transformDirection(z),D++}else if(H.isSpotLight){const K=h.spot[L];K.position.setFromMatrixPosition(H.matrixWorld),K.position.applyMatrix4(z),K.direction.setFromMatrixPosition(H.matrixWorld),p.setFromMatrixPosition(H.target.matrixWorld),K.direction.sub(p),K.direction.transformDirection(z),L++}else if(H.isRectAreaLight){const K=h.rectArea[P];K.position.setFromMatrixPosition(H.matrixWorld),K.position.applyMatrix4(z),_.identity(),g.copy(H.matrixWorld),g.premultiply(z),_.extractRotation(g),K.halfWidth.set(.5*H.width,0,0),K.halfHeight.set(0,.5*H.height,0),K.halfWidth.applyMatrix4(_),K.halfHeight.applyMatrix4(_),P++}else if(H.isPointLight){const K=h.point[R];K.position.setFromMatrixPosition(H.matrixWorld),K.position.applyMatrix4(z),R++}else if(H.isHemisphereLight){const K=h.hemi[I];K.direction.setFromMatrixPosition(H.matrixWorld),K.direction.transformDirection(z),K.direction.normalize(),I++}}},state:h}}function hv(d,r){const a=new ew(d,r),c=[],h=[];return{init:function p(){c.length=0,h.length=0},state:{lightsArray:c,shadowsArray:h,lights:a},setupLights:function w(T){a.setup(c,T)},setupLightsView:function M(T){a.setupView(c,T)},pushLight:function g(T){c.push(T)},pushShadow:function _(T){h.push(T)}}}function ET(d,r){let a=new WeakMap;return{get:function c(p,g=0){let _;return!1===a.has(p)?(_=new hv(d,r),a.set(p,[_])):g>=a.get(p).length?(_=new hv(d,r),a.get(p).push(_)):_=a.get(p)[g],_},dispose:function h(){a=new WeakMap}}}class ku extends Zt{constructor(r){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(r)}copy(r){return super.copy(r),this.depthPacking=r.depthPacking,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this}}ku.prototype.isMeshDepthMaterial=!0;class pg extends Zt{constructor(r){super(),this.type="MeshDistanceMaterial",this.referencePosition=new J,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(r)}copy(r){return super.copy(r),this.referencePosition.copy(r.referencePosition),this.nearDistance=r.nearDistance,this.farDistance=r.farDistance,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this}}function dv(d,r,a){let c=new Wf;const h=new Qe,p=new Qe,g=new ki,_=new ku({depthPacking:3201}),w=new pg,M={},S=a.maxTextureSize,T={0:1,1:0,2:2},D=new va({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qe},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),R=D.clone();R.defines.HORIZONTAL_PASS=1;const L=new Jt;L.setAttribute("position",new Pi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const P=new Kr(L,D),I=this;function z(H,K){const ae=r.update(P);D.defines.VSM_SAMPLES!==H.blurSamples&&(D.defines.VSM_SAMPLES=H.blurSamples,R.defines.VSM_SAMPLES=H.blurSamples,D.needsUpdate=!0,R.needsUpdate=!0),D.uniforms.shadow_pass.value=H.map.texture,D.uniforms.resolution.value=H.mapSize,D.uniforms.radius.value=H.radius,d.setRenderTarget(H.mapPass),d.clear(),d.renderBufferDirect(K,null,ae,D,P,null),R.uniforms.shadow_pass.value=H.mapPass.texture,R.uniforms.resolution.value=H.mapSize,R.uniforms.radius.value=H.radius,d.setRenderTarget(H.map),d.clear(),d.renderBufferDirect(K,null,ae,R,P,null)}function B(H,K,ae,he,me,ke){let ve=null;const X=!0===ae.isPointLight?H.customDistanceMaterial:H.customDepthMaterial;if(ve=void 0!==X?X:!0===ae.isPointLight?w:_,d.localClippingEnabled&&!0===K.clipShadows&&0!==K.clippingPlanes.length||K.displacementMap&&0!==K.displacementScale||K.alphaMap&&K.alphaTest>0){const ce=ve.uuid,dt=K.uuid;let Me=M[ce];void 0===Me&&(Me={},M[ce]=Me);let Oe=Me[dt];void 0===Oe&&(Oe=ve.clone(),Me[dt]=Oe),ve=Oe}return ve.visible=K.visible,ve.wireframe=K.wireframe,ve.side=3===ke?null!==K.shadowSide?K.shadowSide:K.side:null!==K.shadowSide?K.shadowSide:T[K.side],ve.alphaMap=K.alphaMap,ve.alphaTest=K.alphaTest,ve.clipShadows=K.clipShadows,ve.clippingPlanes=K.clippingPlanes,ve.clipIntersection=K.clipIntersection,ve.displacementMap=K.displacementMap,ve.displacementScale=K.displacementScale,ve.displacementBias=K.displacementBias,ve.wireframeLinewidth=K.wireframeLinewidth,ve.linewidth=K.linewidth,!0===ae.isPointLight&&!0===ve.isMeshDistanceMaterial&&(ve.referencePosition.setFromMatrixPosition(ae.matrixWorld),ve.nearDistance=he,ve.farDistance=me),ve}function j(H,K,ae,he,me){if(!1===H.visible)return;if(H.layers.test(K.layers)&&(H.isMesh||H.isLine||H.isPoints)&&(H.castShadow||H.receiveShadow&&3===me)&&(!H.frustumCulled||c.intersectsObject(H))){H.modelViewMatrix.multiplyMatrices(ae.matrixWorldInverse,H.matrixWorld);const X=r.update(H),ce=H.material;if(Array.isArray(ce)){const dt=X.groups;for(let Me=0,Oe=dt.length;Me<Oe;Me++){const Re=dt[Me],Ge=ce[Re.materialIndex];if(Ge&&Ge.visible){const xe=B(H,Ge,he,ae.near,ae.far,me);d.renderBufferDirect(ae,null,X,xe,H,Re)}}}else if(ce.visible){const dt=B(H,ce,he,ae.near,ae.far,me);d.renderBufferDirect(ae,null,X,dt,H,null)}}const ve=H.children;for(let X=0,ce=ve.length;X<ce;X++)j(ve[X],K,ae,he,me)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(H,K,ae){if(!1===I.enabled||!1===I.autoUpdate&&!1===I.needsUpdate||0===H.length)return;const he=d.getRenderTarget(),me=d.getActiveCubeFace(),ke=d.getActiveMipmapLevel(),ve=d.state;ve.setBlending(0),ve.buffers.color.setClear(1,1,1,1),ve.buffers.depth.setTest(!0),ve.setScissorTest(!1);for(let X=0,ce=H.length;X<ce;X++){const dt=H[X],Me=dt.shadow;if(void 0===Me){console.warn("THREE.WebGLShadowMap:",dt,"has no shadow.");continue}if(!1===Me.autoUpdate&&!1===Me.needsUpdate)continue;h.copy(Me.mapSize);const Oe=Me.getFrameExtents();h.multiply(Oe),p.copy(Me.mapSize),(h.x>S||h.y>S)&&(h.x>S&&(p.x=Math.floor(S/Oe.x),h.x=p.x*Oe.x,Me.mapSize.x=p.x),h.y>S&&(p.y=Math.floor(S/Oe.y),h.y=p.y*Oe.y,Me.mapSize.y=p.y)),null===Me.map&&!Me.isPointLightShadow&&3===this.type&&(Me.map=new rs(h.x,h.y),Me.map.texture.name=dt.name+".shadowMap",Me.mapPass=new rs(h.x,h.y),Me.camera.updateProjectionMatrix()),null===Me.map&&(Me.map=new rs(h.x,h.y,{minFilter:Br,magFilter:Br,format:Ct}),Me.map.texture.name=dt.name+".shadowMap",Me.camera.updateProjectionMatrix()),d.setRenderTarget(Me.map),d.clear();const Re=Me.getViewportCount();for(let Ge=0;Ge<Re;Ge++){const xe=Me.getViewport(Ge);g.set(p.x*xe.x,p.y*xe.y,p.x*xe.z,p.y*xe.w),ve.viewport(g),Me.updateMatrices(dt,Ge),c=Me.getFrustum(),j(K,ae,Me.camera,dt,this.type)}!Me.isPointLightShadow&&3===this.type&&z(Me,ae),Me.needsUpdate=!1}I.needsUpdate=!1,d.setRenderTarget(he,me,ke)}}function fv(d,r,a){const c=a.isWebGL2,_=new function h(){let fe=!1;const Bt=new ki;let Pt=null;const Cn=new ki(0,0,0,0);return{setMask:function(sn){Pt!==sn&&!fe&&(d.colorMask(sn,sn,sn,sn),Pt=sn)},setLocked:function(sn){fe=sn},setClear:function(sn,Tn,Mt,tn,Er){!0===Er&&(sn*=tn,Tn*=tn,Mt*=tn),Bt.set(sn,Tn,Mt,tn),!1===Cn.equals(Bt)&&(d.clearColor(sn,Tn,Mt,tn),Cn.copy(Bt))},reset:function(){fe=!1,Pt=null,Cn.set(-1,0,0,0)}}},w=new function p(){let fe=!1,Bt=null,Pt=null,Cn=null;return{setTest:function(sn){sn?Vn(d.DEPTH_TEST):we(d.DEPTH_TEST)},setMask:function(sn){Bt!==sn&&!fe&&(d.depthMask(sn),Bt=sn)},setFunc:function(sn){if(Pt!==sn){if(sn)switch(sn){case 0:d.depthFunc(d.NEVER);break;case 1:d.depthFunc(d.ALWAYS);break;case 2:d.depthFunc(d.LESS);break;case 3:default:d.depthFunc(d.LEQUAL);break;case 4:d.depthFunc(d.EQUAL);break;case 5:d.depthFunc(d.GEQUAL);break;case 6:d.depthFunc(d.GREATER);break;case 7:d.depthFunc(d.NOTEQUAL)}else d.depthFunc(d.LEQUAL);Pt=sn}},setLocked:function(sn){fe=sn},setClear:function(sn){Cn!==sn&&(d.clearDepth(sn),Cn=sn)},reset:function(){fe=!1,Bt=null,Pt=null,Cn=null}}},M=new function g(){let fe=!1,Bt=null,Pt=null,Cn=null,sn=null,Tn=null,Mt=null,tn=null,Er=null;return{setTest:function(Si){fe||(Si?Vn(d.STENCIL_TEST):we(d.STENCIL_TEST))},setMask:function(Si){Bt!==Si&&!fe&&(d.stencilMask(Si),Bt=Si)},setFunc:function(Si,El,Sl){(Pt!==Si||Cn!==El||sn!==Sl)&&(d.stencilFunc(Si,El,Sl),Pt=Si,Cn=El,sn=Sl)},setOp:function(Si,El,Sl){(Tn!==Si||Mt!==El||tn!==Sl)&&(d.stencilOp(Si,El,Sl),Tn=Si,Mt=El,tn=Sl)},setLocked:function(Si){fe=Si},setClear:function(Si){Er!==Si&&(d.clearStencil(Si),Er=Si)},reset:function(){fe=!1,Bt=null,Pt=null,Cn=null,sn=null,Tn=null,Mt=null,tn=null,Er=null}}};let S={},T={},D=new WeakMap,R=[],L=null,P=!1,I=null,z=null,B=null,j=null,H=null,K=null,ae=null,he=!1,me=null,ke=null,ve=null,X=null,ce=null;const dt=d.getParameter(d.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Me=!1,Oe=0;const Re=d.getParameter(d.VERSION);-1!==Re.indexOf("WebGL")?(Oe=parseFloat(/^WebGL (\d)/.exec(Re)[1]),Me=Oe>=1):-1!==Re.indexOf("OpenGL ES")&&(Oe=parseFloat(/^OpenGL ES (\d)/.exec(Re)[1]),Me=Oe>=2);let Ge=null,xe={};const st=d.getParameter(d.SCISSOR_BOX),ut=d.getParameter(d.VIEWPORT),xt=(new ki).fromArray(st),pt=(new ki).fromArray(ut);function gn(fe,Bt,Pt){const Cn=new Uint8Array(4),sn=d.createTexture();d.bindTexture(fe,sn),d.texParameteri(fe,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(fe,d.TEXTURE_MAG_FILTER,d.NEAREST);for(let Tn=0;Tn<Pt;Tn++)d.texImage2D(Bt+Tn,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,Cn);return sn}const li={};function Vn(fe){!0!==S[fe]&&(d.enable(fe),S[fe]=!0)}function we(fe){!1!==S[fe]&&(d.disable(fe),S[fe]=!1)}li[d.TEXTURE_2D]=gn(d.TEXTURE_2D,d.TEXTURE_2D,1),li[d.TEXTURE_CUBE_MAP]=gn(d.TEXTURE_CUBE_MAP,d.TEXTURE_CUBE_MAP_POSITIVE_X,6),_.setClear(0,0,0,1),w.setClear(1),M.setClear(0),Vn(d.DEPTH_TEST),w.setFunc(3),vt(!1),an(1),Vn(d.CULL_FACE),$e(0);const Dt={100:d.FUNC_ADD,101:d.FUNC_SUBTRACT,102:d.FUNC_REVERSE_SUBTRACT};if(c)Dt[103]=d.MIN,Dt[104]=d.MAX;else{const fe=r.get("EXT_blend_minmax");null!==fe&&(Dt[103]=fe.MIN_EXT,Dt[104]=fe.MAX_EXT)}const ci={200:d.ZERO,201:d.ONE,202:d.SRC_COLOR,204:d.SRC_ALPHA,210:d.SRC_ALPHA_SATURATE,208:d.DST_COLOR,206:d.DST_ALPHA,203:d.ONE_MINUS_SRC_COLOR,205:d.ONE_MINUS_SRC_ALPHA,209:d.ONE_MINUS_DST_COLOR,207:d.ONE_MINUS_DST_ALPHA};function $e(fe,Bt,Pt,Cn,sn,Tn,Mt,tn){if(0!==fe){if(!1===P&&(Vn(d.BLEND),P=!0),5===fe)sn=sn||Bt,Tn=Tn||Pt,Mt=Mt||Cn,(Bt!==z||sn!==H)&&(d.blendEquationSeparate(Dt[Bt],Dt[sn]),z=Bt,H=sn),(Pt!==B||Cn!==j||Tn!==K||Mt!==ae)&&(d.blendFuncSeparate(ci[Pt],ci[Cn],ci[Tn],ci[Mt]),B=Pt,j=Cn,K=Tn,ae=Mt),I=fe,he=null;else if(fe!==I||tn!==he){if((100!==z||100!==H)&&(d.blendEquation(d.FUNC_ADD),z=100,H=100),tn)switch(fe){case 1:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case 2:d.blendFunc(d.ONE,d.ONE);break;case 3:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case 4:d.blendFuncSeparate(d.ZERO,d.SRC_COLOR,d.ZERO,d.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",fe)}else switch(fe){case 1:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case 2:d.blendFunc(d.SRC_ALPHA,d.ONE);break;case 3:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case 4:d.blendFunc(d.ZERO,d.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",fe)}B=null,j=null,K=null,ae=null,I=fe,he=tn}}else!0===P&&(we(d.BLEND),P=!1)}function vt(fe){me!==fe&&(d.frontFace(fe?d.CW:d.CCW),me=fe)}function an(fe){0!==fe?(Vn(d.CULL_FACE),fe!==ke&&d.cullFace(1===fe?d.BACK:2===fe?d.FRONT:d.FRONT_AND_BACK)):we(d.CULL_FACE),ke=fe}function jn(fe,Bt,Pt){fe?(Vn(d.POLYGON_OFFSET_FILL),(X!==Bt||ce!==Pt)&&(d.polygonOffset(Bt,Pt),X=Bt,ce=Pt)):we(d.POLYGON_OFFSET_FILL)}function vn(fe){void 0===fe&&(fe=d.TEXTURE0+dt-1),Ge!==fe&&(d.activeTexture(fe),Ge=fe)}return{buffers:{color:_,depth:w,stencil:M},enable:Vn,disable:we,bindFramebuffer:function $i(fe,Bt){return T[fe]!==Bt&&(d.bindFramebuffer(fe,Bt),T[fe]=Bt,c&&(fe===d.DRAW_FRAMEBUFFER&&(T[d.FRAMEBUFFER]=Bt),fe===d.FRAMEBUFFER&&(T[d.DRAW_FRAMEBUFFER]=Bt)),!0)},drawBuffers:function Qn(fe,Bt){let Pt=R,Cn=!1;if(fe)if(Pt=D.get(Bt),void 0===Pt&&(Pt=[],D.set(Bt,Pt)),fe.isWebGLMultipleRenderTargets){const sn=fe.texture;if(Pt.length!==sn.length||Pt[0]!==d.COLOR_ATTACHMENT0){for(let Tn=0,Mt=sn.length;Tn<Mt;Tn++)Pt[Tn]=d.COLOR_ATTACHMENT0+Tn;Pt.length=sn.length,Cn=!0}}else Pt[0]!==d.COLOR_ATTACHMENT0&&(Pt[0]=d.COLOR_ATTACHMENT0,Cn=!0);else Pt[0]!==d.BACK&&(Pt[0]=d.BACK,Cn=!0);Cn&&(a.isWebGL2?d.drawBuffers(Pt):r.get("WEBGL_draw_buffers").drawBuffersWEBGL(Pt))},useProgram:function ei(fe){return L!==fe&&(d.useProgram(fe),L=fe,!0)},setBlending:$e,setMaterial:function it(fe,Bt){2===fe.side?we(d.CULL_FACE):Vn(d.CULL_FACE);let Pt=1===fe.side;Bt&&(Pt=!Pt),vt(Pt),1===fe.blending&&!1===fe.transparent?$e(0):$e(fe.blending,fe.blendEquation,fe.blendSrc,fe.blendDst,fe.blendEquationAlpha,fe.blendSrcAlpha,fe.blendDstAlpha,fe.premultipliedAlpha),w.setFunc(fe.depthFunc),w.setTest(fe.depthTest),w.setMask(fe.depthWrite),_.setMask(fe.colorWrite);const Cn=fe.stencilWrite;M.setTest(Cn),Cn&&(M.setMask(fe.stencilWriteMask),M.setFunc(fe.stencilFunc,fe.stencilRef,fe.stencilFuncMask),M.setOp(fe.stencilFail,fe.stencilZFail,fe.stencilZPass)),jn(fe.polygonOffset,fe.polygonOffsetFactor,fe.polygonOffsetUnits),!0===fe.alphaToCoverage?Vn(d.SAMPLE_ALPHA_TO_COVERAGE):we(d.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:vt,setCullFace:an,setLineWidth:function Ht(fe){fe!==ve&&(Me&&d.lineWidth(fe),ve=fe)},setPolygonOffset:jn,setScissorTest:function Sn(fe){fe?Vn(d.SCISSOR_TEST):we(d.SCISSOR_TEST)},activeTexture:vn,bindTexture:function Mr(fe,Bt){null===Ge&&vn();let Pt=xe[Ge];void 0===Pt&&(Pt={type:void 0,texture:void 0},xe[Ge]=Pt),(Pt.type!==fe||Pt.texture!==Bt)&&(d.bindTexture(fe,Bt||li[fe]),Pt.type=fe,Pt.texture=Bt)},unbindTexture:function rr(){const fe=xe[Ge];void 0!==fe&&void 0!==fe.type&&(d.bindTexture(fe.type,null),fe.type=void 0,fe.texture=void 0)},compressedTexImage2D:function ne(){try{d.compressedTexImage2D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},texImage2D:function Ln(){try{d.texImage2D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},texImage3D:function je(){try{d.texImage3D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},texStorage2D:function Gt(){try{d.texStorage2D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},texStorage3D:function St(){try{d.texStorage3D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},texSubImage2D:function $(){try{d.texSubImage2D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},texSubImage3D:function ze(){try{d.texSubImage3D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},compressedTexSubImage2D:function ft(){try{d.compressedTexSubImage2D.apply(d,arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}},scissor:function Kn(fe){!1===xt.equals(fe)&&(d.scissor(fe.x,fe.y,fe.z,fe.w),xt.copy(fe))},viewport:function pi(fe){!1===pt.equals(fe)&&(d.viewport(fe.x,fe.y,fe.z,fe.w),pt.copy(fe))},reset:function Ne(){d.disable(d.BLEND),d.disable(d.CULL_FACE),d.disable(d.DEPTH_TEST),d.disable(d.POLYGON_OFFSET_FILL),d.disable(d.SCISSOR_TEST),d.disable(d.STENCIL_TEST),d.disable(d.SAMPLE_ALPHA_TO_COVERAGE),d.blendEquation(d.FUNC_ADD),d.blendFunc(d.ONE,d.ZERO),d.blendFuncSeparate(d.ONE,d.ZERO,d.ONE,d.ZERO),d.colorMask(!0,!0,!0,!0),d.clearColor(0,0,0,0),d.depthMask(!0),d.depthFunc(d.LESS),d.clearDepth(1),d.stencilMask(4294967295),d.stencilFunc(d.ALWAYS,0,4294967295),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),d.clearStencil(0),d.cullFace(d.BACK),d.frontFace(d.CCW),d.polygonOffset(0,0),d.activeTexture(d.TEXTURE0),d.bindFramebuffer(d.FRAMEBUFFER,null),!0===c&&(d.bindFramebuffer(d.DRAW_FRAMEBUFFER,null),d.bindFramebuffer(d.READ_FRAMEBUFFER,null)),d.useProgram(null),d.lineWidth(1),d.scissor(0,0,d.canvas.width,d.canvas.height),d.viewport(0,0,d.canvas.width,d.canvas.height),S={},Ge=null,xe={},T={},D=new WeakMap,R=[],L=null,P=!1,I=null,z=null,B=null,j=null,H=null,K=null,ae=null,he=!1,me=null,ke=null,ve=null,X=null,ce=null,xt.set(0,0,d.canvas.width,d.canvas.height),pt.set(0,0,d.canvas.width,d.canvas.height),_.reset(),w.reset(),M.reset()}}}function iw(d,r,a,c,h,p,g){const _=h.isWebGL2,w=h.maxTextures,M=h.maxCubemapSize,S=h.maxTextureSize,T=h.maxSamples,D=r.has("WEBGL_multisampled_render_to_texture")?r.get("WEBGL_multisampled_render_to_texture"):null,R=/OculusBrowser/g.test(navigator.userAgent),L=new WeakMap;let P;const I=new WeakMap;let z=!1;try{z="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(ne){}function B(ne,$){return z?new OffscreenCanvas(ne,$):Dc("canvas")}function j(ne,$,ze,ft){let Gt=1;if((ne.width>ft||ne.height>ft)&&(Gt=ft/Math.max(ne.width,ne.height)),Gt<1||!0===$){if("undefined"!=typeof HTMLImageElement&&ne instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&ne instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&ne instanceof ImageBitmap){const St=$?Df:Math.floor,Ln=St(Gt*ne.width),je=St(Gt*ne.height);void 0===P&&(P=B(Ln,je));const Kn=ze?B(Ln,je):P;return Kn.width=Ln,Kn.height=je,Kn.getContext("2d").drawImage(ne,0,0,Ln,je),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+Ln+"x"+je+")."),Kn}return"data"in ne&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),ne}return ne}function H(ne){return $s(ne.width)&&$s(ne.height)}function ae(ne,$){return ne.generateMipmaps&&$&&ne.minFilter!==Br&&ne.minFilter!==kr}function he(ne){d.generateMipmap(ne)}function me(ne,$,ze,ft,Gt=!1){if(!1===_)return $;if(null!==ne){if(void 0!==d[ne])return d[ne];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ne+"'")}let St=$;return $===d.RED&&(ze===d.FLOAT&&(St=d.R32F),ze===d.HALF_FLOAT&&(St=d.R16F),ze===d.UNSIGNED_BYTE&&(St=d.R8)),$===d.RG&&(ze===d.FLOAT&&(St=d.RG32F),ze===d.HALF_FLOAT&&(St=d.RG16F),ze===d.UNSIGNED_BYTE&&(St=d.RG8)),$===d.RGBA&&(ze===d.FLOAT&&(St=d.RGBA32F),ze===d.HALF_FLOAT&&(St=d.RGBA16F),ze===d.UNSIGNED_BYTE&&(St=ft===wr&&!1===Gt?d.SRGB8_ALPHA8:d.RGBA8),ze===d.UNSIGNED_SHORT_4_4_4_4&&(St=d.RGBA4),ze===d.UNSIGNED_SHORT_5_5_5_1&&(St=d.RGB5_A1)),(St===d.R16F||St===d.R32F||St===d.RG16F||St===d.RG32F||St===d.RGBA16F||St===d.RGBA32F)&&r.get("EXT_color_buffer_float"),St}function ke(ne,$,ze){return!0===ae(ne,ze)||ne.isFramebufferTexture&&ne.minFilter!==Br&&ne.minFilter!==kr?Math.log2(Math.max($.width,$.height))+1:void 0!==ne.mipmaps&&ne.mipmaps.length>0?ne.mipmaps.length:ne.isCompressedTexture&&Array.isArray(ne.image)?$.mipmaps.length:1}function ve(ne){return ne===Br||1004===ne||1005===ne?d.NEAREST:d.LINEAR}function X(ne){const $=ne.target;$.removeEventListener("dispose",X),function dt(ne){const $=c.get(ne);if(void 0===$.__webglInit)return;const ze=ne.source,ft=I.get(ze);if(ft){const Gt=ft[$.__cacheKey];Gt.usedTimes--,0===Gt.usedTimes&&Me(ne),0===Object.keys(ft).length&&I.delete(ze)}c.remove(ne)}($),$.isVideoTexture&&L.delete($)}function ce(ne){const $=ne.target;$.removeEventListener("dispose",ce),function Oe(ne){const $=ne.texture,ze=c.get(ne),ft=c.get($);if(void 0!==ft.__webglTexture&&(d.deleteTexture(ft.__webglTexture),g.memory.textures--),ne.depthTexture&&ne.depthTexture.dispose(),ne.isWebGLCubeRenderTarget)for(let Gt=0;Gt<6;Gt++)d.deleteFramebuffer(ze.__webglFramebuffer[Gt]),ze.__webglDepthbuffer&&d.deleteRenderbuffer(ze.__webglDepthbuffer[Gt]);else d.deleteFramebuffer(ze.__webglFramebuffer),ze.__webglDepthbuffer&&d.deleteRenderbuffer(ze.__webglDepthbuffer),ze.__webglMultisampledFramebuffer&&d.deleteFramebuffer(ze.__webglMultisampledFramebuffer),ze.__webglColorRenderbuffer&&d.deleteRenderbuffer(ze.__webglColorRenderbuffer),ze.__webglDepthRenderbuffer&&d.deleteRenderbuffer(ze.__webglDepthRenderbuffer);if(ne.isWebGLMultipleRenderTargets)for(let Gt=0,St=$.length;Gt<St;Gt++){const Ln=c.get($[Gt]);Ln.__webglTexture&&(d.deleteTexture(Ln.__webglTexture),g.memory.textures--),c.remove($[Gt])}c.remove($),c.remove(ne)}($)}function Me(ne){const $=c.get(ne);d.deleteTexture($.__webglTexture),delete I.get(ne.source)[$.__cacheKey],g.memory.textures--}let Re=0;function ut(ne,$){const ze=c.get(ne);if(ne.isVideoTexture&&function Mr(ne){const $=g.render.frame;L.get(ne)!==$&&(L.set(ne,$),ne.update())}(ne),!1===ne.isRenderTargetTexture&&ne.version>0&&ze.__version!==ne.version){const ft=ne.image;if(null===ft)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==ft.complete)return void Qn(ze,ne,$);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}a.activeTexture(d.TEXTURE0+$),a.bindTexture(d.TEXTURE_2D,ze.__webglTexture)}const li={[oo]:d.REPEAT,[fs]:d.CLAMP_TO_EDGE,[Oh]:d.MIRRORED_REPEAT},Vn={[Br]:d.NEAREST,1004:d.NEAREST_MIPMAP_NEAREST,1005:d.NEAREST_MIPMAP_LINEAR,[kr]:d.LINEAR,1007:d.LINEAR_MIPMAP_NEAREST,[Ua]:d.LINEAR_MIPMAP_LINEAR};function we(ne,$,ze){if(ze?(d.texParameteri(ne,d.TEXTURE_WRAP_S,li[$.wrapS]),d.texParameteri(ne,d.TEXTURE_WRAP_T,li[$.wrapT]),(ne===d.TEXTURE_3D||ne===d.TEXTURE_2D_ARRAY)&&d.texParameteri(ne,d.TEXTURE_WRAP_R,li[$.wrapR]),d.texParameteri(ne,d.TEXTURE_MAG_FILTER,Vn[$.magFilter]),d.texParameteri(ne,d.TEXTURE_MIN_FILTER,Vn[$.minFilter])):(d.texParameteri(ne,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(ne,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),(ne===d.TEXTURE_3D||ne===d.TEXTURE_2D_ARRAY)&&d.texParameteri(ne,d.TEXTURE_WRAP_R,d.CLAMP_TO_EDGE),($.wrapS!==fs||$.wrapT!==fs)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),d.texParameteri(ne,d.TEXTURE_MAG_FILTER,ve($.magFilter)),d.texParameteri(ne,d.TEXTURE_MIN_FILTER,ve($.minFilter)),$.minFilter!==Br&&$.minFilter!==kr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===r.has("EXT_texture_filter_anisotropic")){const ft=r.get("EXT_texture_filter_anisotropic");if($.type===W&&!1===r.has("OES_texture_float_linear")||!1===_&&$.type===ie&&!1===r.has("OES_texture_half_float_linear"))return;($.anisotropy>1||c.get($).__currentAnisotropy)&&(d.texParameterf(ne,ft.TEXTURE_MAX_ANISOTROPY_EXT,Math.min($.anisotropy,h.getMaxAnisotropy())),c.get($).__currentAnisotropy=$.anisotropy)}}function $i(ne,$){let ze=!1;void 0===ne.__webglInit&&(ne.__webglInit=!0,$.addEventListener("dispose",X));const ft=$.source;let Gt=I.get(ft);void 0===Gt&&(Gt={},I.set(ft,Gt));const St=function st(ne){const $=[];return $.push(ne.wrapS),$.push(ne.wrapT),$.push(ne.magFilter),$.push(ne.minFilter),$.push(ne.anisotropy),$.push(ne.internalFormat),$.push(ne.format),$.push(ne.type),$.push(ne.generateMipmaps),$.push(ne.premultiplyAlpha),$.push(ne.flipY),$.push(ne.unpackAlignment),$.push(ne.encoding),$.join()}($);if(St!==ne.__cacheKey){void 0===Gt[St]&&(Gt[St]={texture:d.createTexture(),usedTimes:0},g.memory.textures++,ze=!0),Gt[St].usedTimes++;const Ln=Gt[ne.__cacheKey];void 0!==Ln&&(Gt[ne.__cacheKey].usedTimes--,0===Ln.usedTimes&&Me($)),ne.__cacheKey=St,ne.__webglTexture=Gt[St].texture}return ze}function Qn(ne,$,ze){let ft=d.TEXTURE_2D;$.isDataArrayTexture&&(ft=d.TEXTURE_2D_ARRAY),$.isData3DTexture&&(ft=d.TEXTURE_3D);const Gt=$i(ne,$),St=$.source;if(a.activeTexture(d.TEXTURE0+ze),a.bindTexture(ft,ne.__webglTexture),St.version!==St.__currentVersion||!0===Gt){d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,$.flipY),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),d.pixelStorei(d.UNPACK_ALIGNMENT,$.unpackAlignment),d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE);const Ln=function K(ne){return!_&&(ne.wrapS!==fs||ne.wrapT!==fs||ne.minFilter!==Br&&ne.minFilter!==kr)}($)&&!1===H($.image);let je=j($.image,Ln,!1,S);je=rr($,je);const Kn=H(je)||_,pi=p.convert($.format,$.encoding);let Bt,Ne=p.convert($.type),fe=me($.internalFormat,pi,Ne,$.encoding,$.isVideoTexture);we(ft,$,Kn);const Pt=$.mipmaps,Cn=_&&!0!==$.isVideoTexture,sn=void 0===ne.__version,Tn=ke($,je,Kn);if($.isDepthTexture)fe=d.DEPTH_COMPONENT,_?fe=$.type===W?d.DEPTH_COMPONENT32F:$.type===U?d.DEPTH_COMPONENT24:$.type===Ke?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT16:$.type===W&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),$.format===mn&&fe===d.DEPTH_COMPONENT&&$.type!==ca&&$.type!==U&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),$.type=ca,Ne=p.convert($.type)),$.format===lr&&fe===d.DEPTH_COMPONENT&&(fe=d.DEPTH_STENCIL,$.type!==Ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),$.type=Ke,Ne=p.convert($.type))),Cn&&sn?a.texStorage2D(d.TEXTURE_2D,1,fe,je.width,je.height):a.texImage2D(d.TEXTURE_2D,0,fe,je.width,je.height,0,pi,Ne,null);else if($.isDataTexture)if(Pt.length>0&&Kn){Cn&&sn&&a.texStorage2D(d.TEXTURE_2D,Tn,fe,Pt[0].width,Pt[0].height);for(let Mt=0,tn=Pt.length;Mt<tn;Mt++)Bt=Pt[Mt],Cn?a.texSubImage2D(d.TEXTURE_2D,Mt,0,0,Bt.width,Bt.height,pi,Ne,Bt.data):a.texImage2D(d.TEXTURE_2D,Mt,fe,Bt.width,Bt.height,0,pi,Ne,Bt.data);$.generateMipmaps=!1}else Cn?(sn&&a.texStorage2D(d.TEXTURE_2D,Tn,fe,je.width,je.height),a.texSubImage2D(d.TEXTURE_2D,0,0,0,je.width,je.height,pi,Ne,je.data)):a.texImage2D(d.TEXTURE_2D,0,fe,je.width,je.height,0,pi,Ne,je.data);else if($.isCompressedTexture){Cn&&sn&&a.texStorage2D(d.TEXTURE_2D,Tn,fe,Pt[0].width,Pt[0].height);for(let Mt=0,tn=Pt.length;Mt<tn;Mt++)Bt=Pt[Mt],$.format!==Ct?null!==pi?Cn?a.compressedTexSubImage2D(d.TEXTURE_2D,Mt,0,0,Bt.width,Bt.height,pi,Bt.data):a.compressedTexImage2D(d.TEXTURE_2D,Mt,fe,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Cn?a.texSubImage2D(d.TEXTURE_2D,Mt,0,0,Bt.width,Bt.height,pi,Ne,Bt.data):a.texImage2D(d.TEXTURE_2D,Mt,fe,Bt.width,Bt.height,0,pi,Ne,Bt.data)}else if($.isDataArrayTexture)Cn?(sn&&a.texStorage3D(d.TEXTURE_2D_ARRAY,Tn,fe,je.width,je.height,je.depth),a.texSubImage3D(d.TEXTURE_2D_ARRAY,0,0,0,0,je.width,je.height,je.depth,pi,Ne,je.data)):a.texImage3D(d.TEXTURE_2D_ARRAY,0,fe,je.width,je.height,je.depth,0,pi,Ne,je.data);else if($.isData3DTexture)Cn?(sn&&a.texStorage3D(d.TEXTURE_3D,Tn,fe,je.width,je.height,je.depth),a.texSubImage3D(d.TEXTURE_3D,0,0,0,0,je.width,je.height,je.depth,pi,Ne,je.data)):a.texImage3D(d.TEXTURE_3D,0,fe,je.width,je.height,je.depth,0,pi,Ne,je.data);else if($.isFramebufferTexture)Cn&&sn?a.texStorage2D(d.TEXTURE_2D,Tn,fe,je.width,je.height):a.texImage2D(d.TEXTURE_2D,0,fe,je.width,je.height,0,pi,Ne,null);else if(Pt.length>0&&Kn){Cn&&sn&&a.texStorage2D(d.TEXTURE_2D,Tn,fe,Pt[0].width,Pt[0].height);for(let Mt=0,tn=Pt.length;Mt<tn;Mt++)Bt=Pt[Mt],Cn?a.texSubImage2D(d.TEXTURE_2D,Mt,0,0,pi,Ne,Bt):a.texImage2D(d.TEXTURE_2D,Mt,fe,pi,Ne,Bt);$.generateMipmaps=!1}else Cn?(sn&&a.texStorage2D(d.TEXTURE_2D,Tn,fe,je.width,je.height),a.texSubImage2D(d.TEXTURE_2D,0,0,0,pi,Ne,je)):a.texImage2D(d.TEXTURE_2D,0,fe,pi,Ne,je);ae($,Kn)&&he(ft),St.__currentVersion=St.version,$.onUpdate&&$.onUpdate($)}ne.__version=$.version}function Dt(ne,$,ze,ft,Gt){const St=p.convert(ze.format,ze.encoding),Ln=p.convert(ze.type),je=me(ze.internalFormat,St,Ln,ze.encoding);c.get($).__hasExternalTextures||(Gt===d.TEXTURE_3D||Gt===d.TEXTURE_2D_ARRAY?a.texImage3D(Gt,0,je,$.width,$.height,$.depth,0,St,Ln,null):a.texImage2D(Gt,0,je,$.width,$.height,0,St,Ln,null)),a.bindFramebuffer(d.FRAMEBUFFER,ne),vn($)?D.framebufferTexture2DMultisampleEXT(d.FRAMEBUFFER,ft,Gt,c.get(ze).__webglTexture,0,Sn($)):d.framebufferTexture2D(d.FRAMEBUFFER,ft,Gt,c.get(ze).__webglTexture,0),a.bindFramebuffer(d.FRAMEBUFFER,null)}function ci(ne,$,ze){if(d.bindRenderbuffer(d.RENDERBUFFER,ne),$.depthBuffer&&!$.stencilBuffer){let ft=d.DEPTH_COMPONENT16;if(ze||vn($)){const Gt=$.depthTexture;Gt&&Gt.isDepthTexture&&(Gt.type===W?ft=d.DEPTH_COMPONENT32F:Gt.type===U&&(ft=d.DEPTH_COMPONENT24));const St=Sn($);vn($)?D.renderbufferStorageMultisampleEXT(d.RENDERBUFFER,St,ft,$.width,$.height):d.renderbufferStorageMultisample(d.RENDERBUFFER,St,ft,$.width,$.height)}else d.renderbufferStorage(d.RENDERBUFFER,ft,$.width,$.height);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,ne)}else if($.depthBuffer&&$.stencilBuffer){const ft=Sn($);ze&&!1===vn($)?d.renderbufferStorageMultisample(d.RENDERBUFFER,ft,d.DEPTH24_STENCIL8,$.width,$.height):vn($)?D.renderbufferStorageMultisampleEXT(d.RENDERBUFFER,ft,d.DEPTH24_STENCIL8,$.width,$.height):d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,$.width,$.height),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,ne)}else{const ft=!0===$.isWebGLMultipleRenderTargets?$.texture[0]:$.texture,Gt=p.convert(ft.format,ft.encoding),St=p.convert(ft.type),Ln=me(ft.internalFormat,Gt,St,ft.encoding),je=Sn($);ze&&!1===vn($)?d.renderbufferStorageMultisample(d.RENDERBUFFER,je,Ln,$.width,$.height):vn($)?D.renderbufferStorageMultisampleEXT(d.RENDERBUFFER,je,Ln,$.width,$.height):d.renderbufferStorage(d.RENDERBUFFER,Ln,$.width,$.height)}d.bindRenderbuffer(d.RENDERBUFFER,null)}function it(ne){const $=c.get(ne),ze=!0===ne.isWebGLCubeRenderTarget;if(ne.depthTexture&&!$.__autoAllocateDepthBuffer){if(ze)throw new Error("target.depthTexture not supported in Cube render targets");!function $e(ne,$){if($&&$.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(a.bindFramebuffer(d.FRAMEBUFFER,ne),!$.depthTexture||!$.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!c.get($.depthTexture).__webglTexture||$.depthTexture.image.width!==$.width||$.depthTexture.image.height!==$.height)&&($.depthTexture.image.width=$.width,$.depthTexture.image.height=$.height,$.depthTexture.needsUpdate=!0),ut($.depthTexture,0);const ft=c.get($.depthTexture).__webglTexture,Gt=Sn($);if($.depthTexture.format===mn)vn($)?D.framebufferTexture2DMultisampleEXT(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.TEXTURE_2D,ft,0,Gt):d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.TEXTURE_2D,ft,0);else{if($.depthTexture.format!==lr)throw new Error("Unknown depthTexture format");vn($)?D.framebufferTexture2DMultisampleEXT(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,ft,0,Gt):d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,ft,0)}}($.__webglFramebuffer,ne)}else if(ze){$.__webglDepthbuffer=[];for(let ft=0;ft<6;ft++)a.bindFramebuffer(d.FRAMEBUFFER,$.__webglFramebuffer[ft]),$.__webglDepthbuffer[ft]=d.createRenderbuffer(),ci($.__webglDepthbuffer[ft],ne,!1)}else a.bindFramebuffer(d.FRAMEBUFFER,$.__webglFramebuffer),$.__webglDepthbuffer=d.createRenderbuffer(),ci($.__webglDepthbuffer,ne,!1);a.bindFramebuffer(d.FRAMEBUFFER,null)}function Sn(ne){return Math.min(T,ne.samples)}function vn(ne){const $=c.get(ne);return _&&ne.samples>0&&!0===r.has("WEBGL_multisampled_render_to_texture")&&!1!==$.__useRenderToTexture}function rr(ne,$){const ze=ne.encoding,ft=ne.format,Gt=ne.type;return!0===ne.isCompressedTexture||!0===ne.isVideoTexture||1035===ne.format||ze!==Cs&&(ze===wr?!1===_?!0===r.has("EXT_sRGB")&&ft===Ct?(ne.format=1035,ne.minFilter=kr,ne.generateMipmaps=!1):$=da.sRGBToLinear($):(ft!==Ct||Gt!==za)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ze)),$}this.allocateTextureUnit=function xe(){const ne=Re;return ne>=w&&console.warn("THREE.WebGLTextures: Trying to use "+ne+" texture units while this GPU supports only "+w),Re+=1,ne},this.resetTextureUnits=function Ge(){Re=0},this.setTexture2D=ut,this.setTexture2DArray=function xt(ne,$){const ze=c.get(ne);ne.version>0&&ze.__version!==ne.version?Qn(ze,ne,$):(a.activeTexture(d.TEXTURE0+$),a.bindTexture(d.TEXTURE_2D_ARRAY,ze.__webglTexture))},this.setTexture3D=function pt(ne,$){const ze=c.get(ne);ne.version>0&&ze.__version!==ne.version?Qn(ze,ne,$):(a.activeTexture(d.TEXTURE0+$),a.bindTexture(d.TEXTURE_3D,ze.__webglTexture))},this.setTextureCube=function gn(ne,$){const ze=c.get(ne);ne.version>0&&ze.__version!==ne.version?function ei(ne,$,ze){if(6!==$.image.length)return;const ft=$i(ne,$),Gt=$.source;if(a.activeTexture(d.TEXTURE0+ze),a.bindTexture(d.TEXTURE_CUBE_MAP,ne.__webglTexture),Gt.version!==Gt.__currentVersion||!0===ft){d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,$.flipY),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),d.pixelStorei(d.UNPACK_ALIGNMENT,$.unpackAlignment),d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE);const St=$.isCompressedTexture||$.image[0].isCompressedTexture,Ln=$.image[0]&&$.image[0].isDataTexture,je=[];for(let Mt=0;Mt<6;Mt++)je[Mt]=St||Ln?Ln?$.image[Mt].image:$.image[Mt]:j($.image[Mt],!1,!0,M),je[Mt]=rr($,je[Mt]);const Kn=je[0],pi=H(Kn)||_,Ne=p.convert($.format,$.encoding),fe=p.convert($.type),Bt=me($.internalFormat,Ne,fe,$.encoding),Pt=_&&!0!==$.isVideoTexture,Cn=void 0===ne.__version;let Tn,sn=ke($,Kn,pi);if(we(d.TEXTURE_CUBE_MAP,$,pi),St){Pt&&Cn&&a.texStorage2D(d.TEXTURE_CUBE_MAP,sn,Bt,Kn.width,Kn.height);for(let Mt=0;Mt<6;Mt++){Tn=je[Mt].mipmaps;for(let tn=0;tn<Tn.length;tn++){const Er=Tn[tn];$.format!==Ct?null!==Ne?Pt?a.compressedTexSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn,0,0,Er.width,Er.height,Ne,Er.data):a.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn,Bt,Er.width,Er.height,0,Er.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Pt?a.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn,0,0,Er.width,Er.height,Ne,fe,Er.data):a.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn,Bt,Er.width,Er.height,0,Ne,fe,Er.data)}}}else{Tn=$.mipmaps,Pt&&Cn&&(Tn.length>0&&sn++,a.texStorage2D(d.TEXTURE_CUBE_MAP,sn,Bt,je[0].width,je[0].height));for(let Mt=0;Mt<6;Mt++)if(Ln){Pt?a.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0,0,0,je[Mt].width,je[Mt].height,Ne,fe,je[Mt].data):a.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0,Bt,je[Mt].width,je[Mt].height,0,Ne,fe,je[Mt].data);for(let tn=0;tn<Tn.length;tn++){const Si=Tn[tn].image[Mt].image;Pt?a.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn+1,0,0,Si.width,Si.height,Ne,fe,Si.data):a.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn+1,Bt,Si.width,Si.height,0,Ne,fe,Si.data)}}else{Pt?a.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0,0,0,Ne,fe,je[Mt]):a.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0,Bt,Ne,fe,je[Mt]);for(let tn=0;tn<Tn.length;tn++){const Er=Tn[tn];Pt?a.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn+1,0,0,Ne,fe,Er.image[Mt]):a.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,tn+1,Bt,Ne,fe,Er.image[Mt])}}}ae($,pi)&&he(d.TEXTURE_CUBE_MAP),Gt.__currentVersion=Gt.version,$.onUpdate&&$.onUpdate($)}ne.__version=$.version}(ze,ne,$):(a.activeTexture(d.TEXTURE0+$),a.bindTexture(d.TEXTURE_CUBE_MAP,ze.__webglTexture))},this.rebindTextures=function vt(ne,$,ze){const ft=c.get(ne);void 0!==$&&Dt(ft.__webglFramebuffer,ne,ne.texture,d.COLOR_ATTACHMENT0,d.TEXTURE_2D),void 0!==ze&&it(ne)},this.setupRenderTarget=function an(ne){const $=ne.texture,ze=c.get(ne),ft=c.get($);ne.addEventListener("dispose",ce),!0!==ne.isWebGLMultipleRenderTargets&&(void 0===ft.__webglTexture&&(ft.__webglTexture=d.createTexture()),ft.__version=$.version,g.memory.textures++);const Gt=!0===ne.isWebGLCubeRenderTarget,St=!0===ne.isWebGLMultipleRenderTargets,Ln=H(ne)||_;if(Gt){ze.__webglFramebuffer=[];for(let je=0;je<6;je++)ze.__webglFramebuffer[je]=d.createFramebuffer()}else if(ze.__webglFramebuffer=d.createFramebuffer(),St)if(h.drawBuffers){const je=ne.texture;for(let Kn=0,pi=je.length;Kn<pi;Kn++){const Ne=c.get(je[Kn]);void 0===Ne.__webglTexture&&(Ne.__webglTexture=d.createTexture(),g.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(_&&ne.samples>0&&!1===vn(ne)){ze.__webglMultisampledFramebuffer=d.createFramebuffer(),ze.__webglColorRenderbuffer=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,ze.__webglColorRenderbuffer);const je=p.convert($.format,$.encoding),Kn=p.convert($.type),pi=me($.internalFormat,je,Kn,$.encoding),Ne=Sn(ne);d.renderbufferStorageMultisample(d.RENDERBUFFER,Ne,pi,ne.width,ne.height),a.bindFramebuffer(d.FRAMEBUFFER,ze.__webglMultisampledFramebuffer),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.RENDERBUFFER,ze.__webglColorRenderbuffer),d.bindRenderbuffer(d.RENDERBUFFER,null),ne.depthBuffer&&(ze.__webglDepthRenderbuffer=d.createRenderbuffer(),ci(ze.__webglDepthRenderbuffer,ne,!0)),a.bindFramebuffer(d.FRAMEBUFFER,null)}if(Gt){a.bindTexture(d.TEXTURE_CUBE_MAP,ft.__webglTexture),we(d.TEXTURE_CUBE_MAP,$,Ln);for(let je=0;je<6;je++)Dt(ze.__webglFramebuffer[je],ne,$,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+je);ae($,Ln)&&he(d.TEXTURE_CUBE_MAP),a.unbindTexture()}else if(St){const je=ne.texture;for(let Kn=0,pi=je.length;Kn<pi;Kn++){const Ne=je[Kn],fe=c.get(Ne);a.bindTexture(d.TEXTURE_2D,fe.__webglTexture),we(d.TEXTURE_2D,Ne,Ln),Dt(ze.__webglFramebuffer,ne,Ne,d.COLOR_ATTACHMENT0+Kn,d.TEXTURE_2D),ae(Ne,Ln)&&he(d.TEXTURE_2D)}a.unbindTexture()}else{let je=d.TEXTURE_2D;(ne.isWebGL3DRenderTarget||ne.isWebGLArrayRenderTarget)&&(_?je=ne.isWebGL3DRenderTarget?d.TEXTURE_3D:d.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),a.bindTexture(je,ft.__webglTexture),we(je,$,Ln),Dt(ze.__webglFramebuffer,ne,$,d.COLOR_ATTACHMENT0,je),ae($,Ln)&&he(je),a.unbindTexture()}ne.depthBuffer&&it(ne)},this.updateRenderTargetMipmap=function Ht(ne){const $=H(ne)||_,ze=!0===ne.isWebGLMultipleRenderTargets?ne.texture:[ne.texture];for(let ft=0,Gt=ze.length;ft<Gt;ft++){const St=ze[ft];if(ae(St,$)){const Ln=ne.isWebGLCubeRenderTarget?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D,je=c.get(St).__webglTexture;a.bindTexture(Ln,je),he(Ln),a.unbindTexture()}}},this.updateMultisampleRenderTarget=function jn(ne){if(_&&ne.samples>0&&!1===vn(ne)){const $=ne.width,ze=ne.height;let ft=d.COLOR_BUFFER_BIT;const Gt=[d.COLOR_ATTACHMENT0],St=ne.stencilBuffer?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;ne.depthBuffer&&Gt.push(St);const Ln=c.get(ne),je=void 0!==Ln.__ignoreDepthValues&&Ln.__ignoreDepthValues;!1===je&&(ne.depthBuffer&&(ft|=d.DEPTH_BUFFER_BIT),ne.stencilBuffer&&(ft|=d.STENCIL_BUFFER_BIT)),a.bindFramebuffer(d.READ_FRAMEBUFFER,Ln.__webglMultisampledFramebuffer),a.bindFramebuffer(d.DRAW_FRAMEBUFFER,Ln.__webglFramebuffer),!0===je&&(d.invalidateFramebuffer(d.READ_FRAMEBUFFER,[St]),d.invalidateFramebuffer(d.DRAW_FRAMEBUFFER,[St])),d.blitFramebuffer(0,0,$,ze,0,0,$,ze,ft,d.NEAREST),R&&d.invalidateFramebuffer(d.READ_FRAMEBUFFER,Gt),a.bindFramebuffer(d.READ_FRAMEBUFFER,null),a.bindFramebuffer(d.DRAW_FRAMEBUFFER,Ln.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=it,this.setupFrameBufferTexture=Dt,this.useMultisampledRTT=vn}function ap(d,r,a){const c=a.isWebGL2;return{convert:function h(p,g=null){let _;if(p===za)return d.UNSIGNED_BYTE;if(1017===p)return d.UNSIGNED_SHORT_4_4_4_4;if(1018===p)return d.UNSIGNED_SHORT_5_5_5_1;if(1010===p)return d.BYTE;if(1011===p)return d.SHORT;if(p===ca)return d.UNSIGNED_SHORT;if(1013===p)return d.INT;if(p===U)return d.UNSIGNED_INT;if(p===W)return d.FLOAT;if(p===ie)return c?d.HALF_FLOAT:(_=r.get("OES_texture_half_float"),null!==_?_.HALF_FLOAT_OES:null);if(1021===p)return d.ALPHA;if(p===Ct)return d.RGBA;if(1024===p)return d.LUMINANCE;if(1025===p)return d.LUMINANCE_ALPHA;if(p===mn)return d.DEPTH_COMPONENT;if(p===lr)return d.DEPTH_STENCIL;if(1028===p)return d.RED;if(1022===p)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),d.RGBA;if(1035===p)return _=r.get("EXT_sRGB"),null!==_?_.SRGB_ALPHA_EXT:null;if(1029===p)return d.RED_INTEGER;if(1030===p)return d.RG;if(1031===p)return d.RG_INTEGER;if(1033===p)return d.RGBA_INTEGER;if(p===br||p===Ss||p===il||p===Ol)if(g===wr){if(_=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===_)return null;if(p===br)return _.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(p===Ss)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(p===il)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(p===Ol)return _.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(_=r.get("WEBGL_compressed_texture_s3tc"),null===_)return null;if(p===br)return _.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===Ss)return _.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===il)return _.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===Ol)return _.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===p||35841===p||35842===p||35843===p){if(_=r.get("WEBGL_compressed_texture_pvrtc"),null===_)return null;if(35840===p)return _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===p)return _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===p)return _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===p)return _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===p)return _=r.get("WEBGL_compressed_texture_etc1"),null!==_?_.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===p||37496===p){if(_=r.get("WEBGL_compressed_texture_etc"),null===_)return null;if(37492===p)return g===wr?_.COMPRESSED_SRGB8_ETC2:_.COMPRESSED_RGB8_ETC2;if(37496===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:_.COMPRESSED_RGBA8_ETC2_EAC}if(37808===p||37809===p||37810===p||37811===p||37812===p||37813===p||37814===p||37815===p||37816===p||37817===p||37818===p||37819===p||37820===p||37821===p){if(_=r.get("WEBGL_compressed_texture_astc"),null===_)return null;if(37808===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:_.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:_.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:_.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:_.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:_.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:_.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:_.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:_.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:_.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:_.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:_.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:_.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:_.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===p)return g===wr?_.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:_.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===p){if(_=r.get("EXT_texture_compression_bptc"),null===_)return null;if(36492===p)return g===wr?_.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:_.COMPRESSED_RGBA_BPTC_UNORM_EXT}return p===Ke?c?d.UNSIGNED_INT_24_8:(_=r.get("WEBGL_depth_texture"),null!==_?_.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}pg.prototype.isMeshDistanceMaterial=!0;class pd extends Ds{constructor(r=[]){super(),this.cameras=r}}pd.prototype.isArrayCamera=!0;class Nc extends _i{constructor(){super(),this.type="Group"}}Nc.prototype.isGroup=!0;const pv={type:"move"};class mg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Nc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Nc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new J,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new J),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Nc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new J,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new J),this._grip}dispatchEvent(r){return null!==this._targetRay&&this._targetRay.dispatchEvent(r),null!==this._grip&&this._grip.dispatchEvent(r),null!==this._hand&&this._hand.dispatchEvent(r),this}disconnect(r){return this.dispatchEvent({type:"disconnected",data:r}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(r,a,c){let h=null,p=null,g=null;const _=this._targetRay,w=this._grip,M=this._hand;if(r&&"visible-blurred"!==a.session.visibilityState)if(null!==_&&(h=a.getPose(r.targetRaySpace,c),null!==h&&(_.matrix.fromArray(h.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),h.linearVelocity?(_.hasLinearVelocity=!0,_.linearVelocity.copy(h.linearVelocity)):_.hasLinearVelocity=!1,h.angularVelocity?(_.hasAngularVelocity=!0,_.angularVelocity.copy(h.angularVelocity)):_.hasAngularVelocity=!1,this.dispatchEvent(pv))),M&&r.hand){g=!0;for(const P of r.hand.values()){const I=a.getJointPose(P,c);if(void 0===M.joints[P.jointName]){const B=new Nc;B.matrixAutoUpdate=!1,B.visible=!1,M.joints[P.jointName]=B,M.add(B)}const z=M.joints[P.jointName];null!==I&&(z.matrix.fromArray(I.transform.matrix),z.matrix.decompose(z.position,z.rotation,z.scale),z.jointRadius=I.radius),z.visible=null!==I}const D=M.joints["index-finger-tip"].position.distanceTo(M.joints["thumb-tip"].position),R=.02,L=.005;M.inputState.pinching&&D>R+L?(M.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:r.handedness,target:this})):!M.inputState.pinching&&D<=R-L&&(M.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:r.handedness,target:this}))}else null!==w&&r.gripSpace&&(p=a.getPose(r.gripSpace,c),null!==p&&(w.matrix.fromArray(p.transform.matrix),w.matrix.decompose(w.position,w.rotation,w.scale),p.linearVelocity?(w.hasLinearVelocity=!0,w.linearVelocity.copy(p.linearVelocity)):w.hasLinearVelocity=!1,p.angularVelocity?(w.hasAngularVelocity=!0,w.angularVelocity.copy(p.angularVelocity)):w.hasAngularVelocity=!1));return null!==_&&(_.visible=null!==h),null!==w&&(w.visible=null!==p),null!==M&&(M.visible=null!==g),this}}class lp extends is{constructor(r,a,c,h,p,g,_,w,M,S){if((S=void 0!==S?S:mn)!==mn&&S!==lr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&S===mn&&(c=ca),void 0===c&&S===lr&&(c=Ke),super(null,h,p,g,_,w,S,c,M),this.image={width:r,height:a},this.magFilter=void 0!==_?_:Br,this.minFilter=void 0!==w?w:Br,this.flipY=!1,this.generateMipmaps=!1}}lp.prototype.isDepthTexture=!0;class cp extends Tc{constructor(r,a){super();const c=this;let h=null,p=1,g=null,_="local-floor",w=null,M=null,S=null,T=null,D=null;const R=a.getContextAttributes();let L=null,P=null;const I=[],z=new Map,B=new Ds;B.layers.enable(1),B.viewport=new ki;const j=new Ds;j.layers.enable(2),j.viewport=new ki;const H=[B,j],K=new pd;K.layers.enable(1),K.layers.enable(2);let ae=null,he=null;function me(xe){const st=z.get(xe.inputSource);st&&st.dispatchEvent({type:xe.type,data:xe.inputSource})}function ke(){z.forEach(function(xe,st){xe.disconnect(st)}),z.clear(),ae=null,he=null,r.setRenderTarget(L),T=null,S=null,M=null,h=null,P=null,Ge.stop(),c.isPresenting=!1,c.dispatchEvent({type:"sessionend"})}function ve(xe){const st=h.inputSources;for(let ut=0;ut<I.length;ut++)z.set(st[ut],I[ut]);for(let ut=0;ut<xe.removed.length;ut++){const xt=xe.removed[ut],pt=z.get(xt);pt&&(pt.dispatchEvent({type:"disconnected",data:xt}),z.delete(xt))}for(let ut=0;ut<xe.added.length;ut++){const xt=xe.added[ut],pt=z.get(xt);pt&&pt.dispatchEvent({type:"connected",data:xt})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(xe){let st=I[xe];return void 0===st&&(st=new mg,I[xe]=st),st.getTargetRaySpace()},this.getControllerGrip=function(xe){let st=I[xe];return void 0===st&&(st=new mg,I[xe]=st),st.getGripSpace()},this.getHand=function(xe){let st=I[xe];return void 0===st&&(st=new mg,I[xe]=st),st.getHandSpace()},this.setFramebufferScaleFactor=function(xe){p=xe,!0===c.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(xe){_=xe,!0===c.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return g},this.getBaseLayer=function(){return null!==S?S:T},this.getBinding=function(){return M},this.getFrame=function(){return D},this.getSession=function(){return h},this.setSession=function(){var xe=so(function*(st){if(h=st,null!==h){if(L=r.getRenderTarget(),h.addEventListener("select",me),h.addEventListener("selectstart",me),h.addEventListener("selectend",me),h.addEventListener("squeeze",me),h.addEventListener("squeezestart",me),h.addEventListener("squeezeend",me),h.addEventListener("end",ke),h.addEventListener("inputsourceschange",ve),!0!==R.xrCompatible&&(yield a.makeXRCompatible()),void 0===h.renderState.layers||!1===r.capabilities.isWebGL2)T=new XRWebGLLayer(h,a,{antialias:void 0!==h.renderState.layers||R.antialias,alpha:R.alpha,depth:R.depth,stencil:R.stencil,framebufferScaleFactor:p}),h.updateRenderState({baseLayer:T}),P=new rs(T.framebufferWidth,T.framebufferHeight,{format:Ct,type:za,encoding:r.outputEncoding});else{let ut=null,xt=null,pt=null;R.depth&&(pt=R.stencil?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT24,ut=R.stencil?lr:mn,xt=R.stencil?Ke:ca);const gn={colorFormat:r.outputEncoding===wr?a.SRGB8_ALPHA8:a.RGBA8,depthFormat:pt,scaleFactor:p};M=new XRWebGLBinding(h,a),S=M.createProjectionLayer(gn),h.updateRenderState({layers:[S]}),P=new rs(S.textureWidth,S.textureHeight,{format:Ct,type:za,depthTexture:new lp(S.textureWidth,S.textureHeight,xt,void 0,void 0,void 0,void 0,void 0,void 0,ut),stencilBuffer:R.stencil,encoding:r.outputEncoding,samples:R.antialias?4:0}),r.properties.get(P).__ignoreDepthValues=S.ignoreDepthValues}P.isXRRenderTarget=!0,this.setFoveation(1),g=yield h.requestReferenceSpace(_),Ge.setContext(h),Ge.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}});return function(st){return xe.apply(this,arguments)}}();const X=new J,ce=new J;function Me(xe,st){null===st?xe.matrixWorld.copy(xe.matrix):xe.matrixWorld.multiplyMatrices(st.matrixWorld,xe.matrix),xe.matrixWorldInverse.copy(xe.matrixWorld).invert()}this.updateCamera=function(xe){if(null===h)return;K.near=j.near=B.near=xe.near,K.far=j.far=B.far=xe.far,(ae!==K.near||he!==K.far)&&(h.updateRenderState({depthNear:K.near,depthFar:K.far}),ae=K.near,he=K.far);const st=xe.parent,ut=K.cameras;Me(K,st);for(let pt=0;pt<ut.length;pt++)Me(ut[pt],st);K.matrixWorld.decompose(K.position,K.quaternion,K.scale),xe.position.copy(K.position),xe.quaternion.copy(K.quaternion),xe.scale.copy(K.scale),xe.matrix.copy(K.matrix),xe.matrixWorld.copy(K.matrixWorld);const xt=xe.children;for(let pt=0,gn=xt.length;pt<gn;pt++)xt[pt].updateMatrixWorld(!0);2===ut.length?function dt(xe,st,ut){X.setFromMatrixPosition(st.matrixWorld),ce.setFromMatrixPosition(ut.matrixWorld);const xt=X.distanceTo(ce),pt=st.projectionMatrix.elements,gn=ut.projectionMatrix.elements,li=pt[14]/(pt[10]-1),Vn=pt[14]/(pt[10]+1),we=(pt[9]+1)/pt[5],$i=(pt[9]-1)/pt[5],Qn=(pt[8]-1)/pt[0],ei=(gn[8]+1)/gn[0],Dt=li*Qn,ci=li*ei,$e=xt/(-Qn+ei),it=$e*-Qn;st.matrixWorld.decompose(xe.position,xe.quaternion,xe.scale),xe.translateX(it),xe.translateZ($e),xe.matrixWorld.compose(xe.position,xe.quaternion,xe.scale),xe.matrixWorldInverse.copy(xe.matrixWorld).invert();const vt=li+$e,an=Vn+$e;xe.projectionMatrix.makePerspective(Dt-it,ci+(xt-it),we*Vn/an*vt,$i*Vn/an*vt,vt,an)}(K,B,j):K.projectionMatrix.copy(B.projectionMatrix)},this.getCamera=function(){return K},this.getFoveation=function(){return null!==S?S.fixedFoveation:null!==T?T.fixedFoveation:void 0},this.setFoveation=function(xe){null!==S&&(S.fixedFoveation=xe),null!==T&&void 0!==T.fixedFoveation&&(T.fixedFoveation=xe)};let Oe=null;const Ge=new nd;Ge.setAnimationLoop(function Re(xe,st){if(w=st.getViewerPose(g),D=st,null!==w){const xt=w.views;null!==T&&(r.setRenderTargetFramebuffer(P,T.framebuffer),r.setRenderTarget(P));let pt=!1;xt.length!==K.cameras.length&&(K.cameras.length=0,pt=!0);for(let gn=0;gn<xt.length;gn++){const li=xt[gn];let Vn=null;if(null!==T)Vn=T.getViewport(li);else{const $i=M.getViewSubImage(S,li);Vn=$i.viewport,0===gn&&(r.setRenderTargetTextures(P,$i.colorTexture,S.ignoreDepthValues?void 0:$i.depthStencilTexture),r.setRenderTarget(P))}const we=H[gn];we.matrix.fromArray(li.transform.matrix),we.projectionMatrix.fromArray(li.projectionMatrix),we.viewport.set(Vn.x,Vn.y,Vn.width,Vn.height),0===gn&&K.matrix.copy(we.matrix),!0===pt&&K.cameras.push(we)}}const ut=h.inputSources;for(let xt=0;xt<I.length;xt++)I[xt].update(ut[xt],st,g);Oe&&Oe(xe,st),D=null}),this.setAnimationLoop=function(xe){Oe=xe},this.dispose=function(){}}}function ST(d,r){function h(P,I){P.opacity.value=I.opacity,I.color&&P.diffuse.value.copy(I.color),I.emissive&&P.emissive.value.copy(I.emissive).multiplyScalar(I.emissiveIntensity),I.map&&(P.map.value=I.map),I.alphaMap&&(P.alphaMap.value=I.alphaMap),I.bumpMap&&(P.bumpMap.value=I.bumpMap,P.bumpScale.value=I.bumpScale,1===I.side&&(P.bumpScale.value*=-1)),I.displacementMap&&(P.displacementMap.value=I.displacementMap,P.displacementScale.value=I.displacementScale,P.displacementBias.value=I.displacementBias),I.emissiveMap&&(P.emissiveMap.value=I.emissiveMap),I.normalMap&&(P.normalMap.value=I.normalMap,P.normalScale.value.copy(I.normalScale),1===I.side&&P.normalScale.value.negate()),I.specularMap&&(P.specularMap.value=I.specularMap),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest);const z=r.get(I).envMap;if(z&&(P.envMap.value=z,P.flipEnvMap.value=z.isCubeTexture&&!1===z.isRenderTargetTexture?-1:1,P.reflectivity.value=I.reflectivity,P.ior.value=I.ior,P.refractionRatio.value=I.refractionRatio),I.lightMap){P.lightMap.value=I.lightMap;const H=!0!==d.physicallyCorrectLights?Math.PI:1;P.lightMapIntensity.value=I.lightMapIntensity*H}let B,j;I.aoMap&&(P.aoMap.value=I.aoMap,P.aoMapIntensity.value=I.aoMapIntensity),I.map?B=I.map:I.specularMap?B=I.specularMap:I.displacementMap?B=I.displacementMap:I.normalMap?B=I.normalMap:I.bumpMap?B=I.bumpMap:I.roughnessMap?B=I.roughnessMap:I.metalnessMap?B=I.metalnessMap:I.alphaMap?B=I.alphaMap:I.emissiveMap?B=I.emissiveMap:I.clearcoatMap?B=I.clearcoatMap:I.clearcoatNormalMap?B=I.clearcoatNormalMap:I.clearcoatRoughnessMap?B=I.clearcoatRoughnessMap:I.specularIntensityMap?B=I.specularIntensityMap:I.specularColorMap?B=I.specularColorMap:I.transmissionMap?B=I.transmissionMap:I.thicknessMap?B=I.thicknessMap:I.sheenColorMap?B=I.sheenColorMap:I.sheenRoughnessMap&&(B=I.sheenRoughnessMap),void 0!==B&&(B.isWebGLRenderTarget&&(B=B.texture),!0===B.matrixAutoUpdate&&B.updateMatrix(),P.uvTransform.value.copy(B.matrix)),I.aoMap?j=I.aoMap:I.lightMap&&(j=I.lightMap),void 0!==j&&(j.isWebGLRenderTarget&&(j=j.texture),!0===j.matrixAutoUpdate&&j.updateMatrix(),P.uv2Transform.value.copy(j.matrix))}return{refreshFogUniforms:function a(P,I){P.fogColor.value.copy(I.color),I.isFog?(P.fogNear.value=I.near,P.fogFar.value=I.far):I.isFogExp2&&(P.fogDensity.value=I.density)},refreshMaterialUniforms:function c(P,I,z,B,j){I.isMeshBasicMaterial||I.isMeshLambertMaterial?h(P,I):I.isMeshToonMaterial?(h(P,I),function S(P,I){I.gradientMap&&(P.gradientMap.value=I.gradientMap)}(P,I)):I.isMeshPhongMaterial?(h(P,I),function M(P,I){P.specular.value.copy(I.specular),P.shininess.value=Math.max(I.shininess,1e-4)}(P,I)):I.isMeshStandardMaterial?(h(P,I),function T(P,I){P.roughness.value=I.roughness,P.metalness.value=I.metalness,I.roughnessMap&&(P.roughnessMap.value=I.roughnessMap),I.metalnessMap&&(P.metalnessMap.value=I.metalnessMap),r.get(I).envMap&&(P.envMapIntensity.value=I.envMapIntensity)}(P,I),I.isMeshPhysicalMaterial&&function D(P,I,z){P.ior.value=I.ior,I.sheen>0&&(P.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),P.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(P.sheenColorMap.value=I.sheenColorMap),I.sheenRoughnessMap&&(P.sheenRoughnessMap.value=I.sheenRoughnessMap)),I.clearcoat>0&&(P.clearcoat.value=I.clearcoat,P.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(P.clearcoatMap.value=I.clearcoatMap),I.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap),I.clearcoatNormalMap&&(P.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),P.clearcoatNormalMap.value=I.clearcoatNormalMap,1===I.side&&P.clearcoatNormalScale.value.negate())),I.transmission>0&&(P.transmission.value=I.transmission,P.transmissionSamplerMap.value=z.texture,P.transmissionSamplerSize.value.set(z.width,z.height),I.transmissionMap&&(P.transmissionMap.value=I.transmissionMap),P.thickness.value=I.thickness,I.thicknessMap&&(P.thicknessMap.value=I.thicknessMap),P.attenuationDistance.value=I.attenuationDistance,P.attenuationColor.value.copy(I.attenuationColor)),P.specularIntensity.value=I.specularIntensity,P.specularColor.value.copy(I.specularColor),I.specularIntensityMap&&(P.specularIntensityMap.value=I.specularIntensityMap),I.specularColorMap&&(P.specularColorMap.value=I.specularColorMap)}(P,I,j)):I.isMeshMatcapMaterial?(h(P,I),function R(P,I){I.matcap&&(P.matcap.value=I.matcap)}(P,I)):I.isMeshDepthMaterial?h(P,I):I.isMeshDistanceMaterial?(h(P,I),function L(P,I){P.referencePosition.value.copy(I.referencePosition),P.nearDistance.value=I.nearDistance,P.farDistance.value=I.farDistance}(P,I)):I.isMeshNormalMaterial?h(P,I):I.isLineBasicMaterial?(function p(P,I){P.diffuse.value.copy(I.color),P.opacity.value=I.opacity}(P,I),I.isLineDashedMaterial&&function g(P,I){P.dashSize.value=I.dashSize,P.totalSize.value=I.dashSize+I.gapSize,P.scale.value=I.scale}(P,I)):I.isPointsMaterial?function _(P,I,z,B){let j;P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,P.size.value=I.size*z,P.scale.value=.5*B,I.map&&(P.map.value=I.map),I.alphaMap&&(P.alphaMap.value=I.alphaMap),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest),I.map?j=I.map:I.alphaMap&&(j=I.alphaMap),void 0!==j&&(!0===j.matrixAutoUpdate&&j.updateMatrix(),P.uvTransform.value.copy(j.matrix))}(P,I,z,B):I.isSpriteMaterial?function w(P,I){let z;P.diffuse.value.copy(I.color),P.opacity.value=I.opacity,P.rotation.value=I.rotation,I.map&&(P.map.value=I.map),I.alphaMap&&(P.alphaMap.value=I.alphaMap),I.alphaTest>0&&(P.alphaTest.value=I.alphaTest),I.map?z=I.map:I.alphaMap&&(z=I.alphaMap),void 0!==z&&(!0===z.matrixAutoUpdate&&z.updateMatrix(),P.uvTransform.value.copy(z.matrix))}(P,I):I.isShadowMaterial?(P.color.value.copy(I.color),P.opacity.value=I.opacity):I.isShaderMaterial&&(I.uniformsNeedUpdate=!1)}}}function tr(d={}){const r=void 0!==d.canvas?d.canvas:function rw(){const d=Dc("canvas");return d.style.display="block",d}(),a=void 0!==d.context?d.context:null,c=void 0===d.depth||d.depth,h=void 0===d.stencil||d.stencil,p=void 0!==d.antialias&&d.antialias,g=void 0===d.premultipliedAlpha||d.premultipliedAlpha,_=void 0!==d.preserveDrawingBuffer&&d.preserveDrawingBuffer,w=void 0!==d.powerPreference?d.powerPreference:"default",M=void 0!==d.failIfMajorPerformanceCaveat&&d.failIfMajorPerformanceCaveat;let S;S=void 0!==d.context?a.getContextAttributes().alpha:void 0!==d.alpha&&d.alpha;let T=null,D=null;const R=[],L=[];this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Cs,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const P=this;let I=!1,z=0,B=0,j=null,H=-1,K=null;const ae=new ki,he=new ki;let me=null,ke=r.width,ve=r.height,X=1,ce=null,dt=null;const Me=new ki(0,0,ke,ve),Oe=new ki(0,0,ke,ve);let Re=!1;const Ge=new Wf;let xe=!1,st=!1,ut=null;const xt=new on,pt=new Qe,gn=new J,li={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Vn(){return null===j?X:1}let Qn,ei,Dt,ci,$e,it,vt,an,Ht,jn,Sn,vn,Mr,rr,ne,$,ze,ft,Gt,St,Ln,je,Kn,we=a;function $i(Q,Ee){for(let Be=0;Be<Q.length;Be++){const tt=r.getContext(Q[Be],Ee);if(null!==tt)return tt}return null}try{const Q={alpha:!0,depth:c,stencil:h,antialias:p,premultipliedAlpha:g,preserveDrawingBuffer:_,powerPreference:w,failIfMajorPerformanceCaveat:M};if("setAttribute"in r&&r.setAttribute("data-engine","three.js r139"),r.addEventListener("webglcontextlost",fe,!1),r.addEventListener("webglcontextrestored",Bt,!1),null===we){const Ee=["webgl2","webgl","experimental-webgl"];if(!0===P.isWebGL1Renderer&&Ee.shift(),we=$i(Ee,Q),null===we)throw $i(Ee)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===we.getShaderPrecisionFormat&&(we.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Q){throw console.error("THREE.WebGLRenderer: "+Q.message),Q}function pi(){Qn=new ip(we),ei=new BC(we,Qn,d),Qn.init(ei),je=new ap(we,Qn,ei),Dt=new fv(we,Qn,ei),ci=new Ab(we),$e=new Zb,it=new iw(we,Qn,Dt,$e,ei,je,ci),vt=new VC(P),an=new ml(P),Ht=new D_(we,ei),Kn=new bb(we,Qn,Ht,ei),jn=new Cb(we,Ht,ci,Kn),Sn=new $_(we,jn,Ht,ci),Gt=new K_(we,ei,it),$=new kC($e),vn=new bT(P,vt,an,Qn,ei,Kn,$),Mr=new ST(P,$e),rr=new wT,ne=new ET(Qn,ei),ft=new xb(P,vt,Dt,Sn,S,g),ze=new dv(P,Sn,ei),St=new OC(we,Qn,ci,ei),Ln=new Tb(we,Qn,ci,ei),ci.programs=vn.programs,P.capabilities=ei,P.extensions=Qn,P.properties=$e,P.renderLists=rr,P.shadowMap=ze,P.state=Dt,P.info=ci}pi();const Ne=new cp(P,we);function fe(Q){Q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function Bt(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const Q=ci.autoReset,Ee=ze.enabled,Be=ze.autoUpdate,Ae=ze.needsUpdate,tt=ze.type;pi(),ci.autoReset=Q,ze.enabled=Ee,ze.autoUpdate=Be,ze.needsUpdate=Ae,ze.type=tt}function Pt(Q){const Ee=Q.target;Ee.removeEventListener("dispose",Pt),function Cn(Q){(function sn(Q){const Ee=$e.get(Q).programs;void 0!==Ee&&(Ee.forEach(function(Be){vn.releaseProgram(Be)}),Q.isShaderMaterial&&vn.releaseShaderCache(Q))})(Q),$e.remove(Q)}(Ee)}this.xr=Ne,this.getContext=function(){return we},this.getContextAttributes=function(){return we.getContextAttributes()},this.forceContextLoss=function(){const Q=Qn.get("WEBGL_lose_context");Q&&Q.loseContext()},this.forceContextRestore=function(){const Q=Qn.get("WEBGL_lose_context");Q&&Q.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(Q){void 0!==Q&&(X=Q,this.setSize(ke,ve,!1))},this.getSize=function(Q){return Q.set(ke,ve)},this.setSize=function(Q,Ee,Be){Ne.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ke=Q,ve=Ee,r.width=Math.floor(Q*X),r.height=Math.floor(Ee*X),!1!==Be&&(r.style.width=Q+"px",r.style.height=Ee+"px"),this.setViewport(0,0,Q,Ee))},this.getDrawingBufferSize=function(Q){return Q.set(ke*X,ve*X).floor()},this.setDrawingBufferSize=function(Q,Ee,Be){ke=Q,ve=Ee,X=Be,r.width=Math.floor(Q*Be),r.height=Math.floor(Ee*Be),this.setViewport(0,0,Q,Ee)},this.getCurrentViewport=function(Q){return Q.copy(ae)},this.getViewport=function(Q){return Q.copy(Me)},this.setViewport=function(Q,Ee,Be,Ae){Q.isVector4?Me.set(Q.x,Q.y,Q.z,Q.w):Me.set(Q,Ee,Be,Ae),Dt.viewport(ae.copy(Me).multiplyScalar(X).floor())},this.getScissor=function(Q){return Q.copy(Oe)},this.setScissor=function(Q,Ee,Be,Ae){Q.isVector4?Oe.set(Q.x,Q.y,Q.z,Q.w):Oe.set(Q,Ee,Be,Ae),Dt.scissor(he.copy(Oe).multiplyScalar(X).floor())},this.getScissorTest=function(){return Re},this.setScissorTest=function(Q){Dt.setScissorTest(Re=Q)},this.setOpaqueSort=function(Q){ce=Q},this.setTransparentSort=function(Q){dt=Q},this.getClearColor=function(Q){return Q.copy(ft.getClearColor())},this.setClearColor=function(){ft.setClearColor.apply(ft,arguments)},this.getClearAlpha=function(){return ft.getClearAlpha()},this.setClearAlpha=function(){ft.setClearAlpha.apply(ft,arguments)},this.clear=function(Q=!0,Ee=!0,Be=!0){let Ae=0;Q&&(Ae|=we.COLOR_BUFFER_BIT),Ee&&(Ae|=we.DEPTH_BUFFER_BIT),Be&&(Ae|=we.STENCIL_BUFFER_BIT),we.clear(Ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",fe,!1),r.removeEventListener("webglcontextrestored",Bt,!1),rr.dispose(),ne.dispose(),$e.dispose(),vt.dispose(),an.dispose(),Sn.dispose(),Kn.dispose(),vn.dispose(),Ne.dispose(),Ne.removeEventListener("sessionstart",tn),Ne.removeEventListener("sessionend",Er),ut&&(ut.dispose(),ut=null),Si.stop()},this.renderBufferDirect=function(Q,Ee,Be,Ae,tt,Nn){null===Ee&&(Ee=li);const Xn=tt.isMesh&&tt.matrixWorld.determinant()<0,ui=function S1(Q,Ee,Be,Ae,tt){!0!==Ee.isScene&&(Ee=li),it.resetTextureUnits();const Nn=Ee.fog,ui=null===j?P.outputEncoding:!0===j.isXRRenderTarget?j.texture.encoding:Cs,Hn=(Ae.isMeshStandardMaterial?an:vt).get(Ae.envMap||(Ae.isMeshStandardMaterial?Ee.environment:null)),Fi=!0===Ae.vertexColors&&!!Be.attributes.color&&4===Be.attributes.color.itemSize,Ni=!!Ae.normalMap&&!!Be.attributes.tangent,Vi=!!Be.morphAttributes.position,Gr=!!Be.morphAttributes.normal,jc=!!Be.morphAttributes.color,lh=Ae.toneMapped?P.toneMapping:0,ch=Be.morphAttributes.position||Be.morphAttributes.normal||Be.morphAttributes.color,Cl=void 0!==ch?ch.length:0,Gi=$e.get(Ae),kd=D.state.lights;!0!==xe||!0!==st&&Q===K||$.setState(Ae,Q,Q===K&&Ae.id===H);let us=!1;Ae.version===Gi.__version?(Gi.needsLights&&Gi.lightsStateVersion!==kd.state.version||Gi.outputEncoding!==ui||tt.isInstancedMesh&&!1===Gi.instancing||!tt.isInstancedMesh&&!0===Gi.instancing||tt.isSkinnedMesh&&!1===Gi.skinning||!tt.isSkinnedMesh&&!0===Gi.skinning||Gi.envMap!==Hn||Ae.fog&&Gi.fog!==Nn||void 0!==Gi.numClippingPlanes&&(Gi.numClippingPlanes!==$.numPlanes||Gi.numIntersection!==$.numIntersection)||Gi.vertexAlphas!==Fi||Gi.vertexTangents!==Ni||Gi.morphTargets!==Vi||Gi.morphNormals!==Gr||Gi.morphColors!==jc||Gi.toneMapping!==lh||!0===ei.isWebGL2&&Gi.morphTargetsCount!==Cl)&&(us=!0):(us=!0,Gi.__version=Ae.version);let sc=Gi.currentProgram;!0===us&&(sc=jg(Ae,Ee,tt));let uh=!1,Xg=!1,wM=!1;const eo=sc.getUniforms(),Xc=Gi.uniforms;if(Dt.useProgram(sc.program)&&(uh=!0,Xg=!0,wM=!0),Ae.id!==H&&(H=Ae.id,Xg=!0),uh||K!==Q){if(eo.setValue(we,"projectionMatrix",Q.projectionMatrix),ei.logarithmicDepthBuffer&&eo.setValue(we,"logDepthBufFC",2/(Math.log(Q.far+1)/Math.LN2)),K!==Q&&(K=Q,Xg=!0,wM=!0),Ae.isShaderMaterial||Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshStandardMaterial||Ae.envMap){const Ka=eo.map.cameraPosition;void 0!==Ka&&Ka.setValue(we,gn.setFromMatrixPosition(Q.matrixWorld))}(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&eo.setValue(we,"isOrthographic",!0===Q.isOrthographicCamera),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial||Ae.isShadowMaterial||tt.isSkinnedMesh)&&eo.setValue(we,"viewMatrix",Q.matrixWorldInverse)}if(tt.isSkinnedMesh){eo.setOptional(we,tt,"bindMatrix"),eo.setOptional(we,tt,"bindMatrixInverse");const Ka=tt.skeleton;Ka&&(ei.floatVertexTextures?(null===Ka.boneTexture&&Ka.computeBoneTexture(),eo.setValue(we,"boneTexture",Ka.boneTexture,it),eo.setValue(we,"boneTextureSize",Ka.boneTextureSize)):eo.setOptional(we,Ka,"boneMatrices"))}const h0=Be.morphAttributes;return(void 0!==h0.position||void 0!==h0.normal||void 0!==h0.color&&!0===ei.isWebGL2)&&Gt.update(tt,Be,Ae,sc),(Xg||Gi.receiveShadow!==tt.receiveShadow)&&(Gi.receiveShadow=tt.receiveShadow,eo.setValue(we,"receiveShadow",tt.receiveShadow)),Xg&&(eo.setValue(we,"toneMappingExposure",P.toneMappingExposure),Gi.needsLights&&function C1(Q,Ee){Q.ambientLightColor.needsUpdate=Ee,Q.lightProbe.needsUpdate=Ee,Q.directionalLights.needsUpdate=Ee,Q.directionalLightShadows.needsUpdate=Ee,Q.pointLights.needsUpdate=Ee,Q.pointLightShadows.needsUpdate=Ee,Q.spotLights.needsUpdate=Ee,Q.spotLightShadows.needsUpdate=Ee,Q.rectAreaLights.needsUpdate=Ee,Q.hemisphereLights.needsUpdate=Ee}(Xc,wM),Nn&&Ae.fog&&Mr.refreshFogUniforms(Xc,Nn),Mr.refreshMaterialUniforms(Xc,Ae,X,ve,ut),Fc.upload(we,Gi.uniformsList,Xc,it)),Ae.isShaderMaterial&&!0===Ae.uniformsNeedUpdate&&(Fc.upload(we,Gi.uniformsList,Xc,it),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&eo.setValue(we,"center",tt.center),eo.setValue(we,"modelViewMatrix",tt.modelViewMatrix),eo.setValue(we,"normalMatrix",tt.normalMatrix),eo.setValue(we,"modelMatrix",tt.matrixWorld),sc}(Q,Ee,Be,Ae,tt);Dt.setMaterial(Ae,Xn);let Hn=Be.index;const Fi=Be.attributes.position;if(null===Hn){if(void 0===Fi||0===Fi.count)return}else if(0===Hn.count)return;let Ni=1;!0===Ae.wireframe&&(Hn=jn.getWireframeAttribute(Be),Ni=2),Kn.setup(tt,Ae,ui,Be,Hn);let Vi,Gr=St;null!==Hn&&(Vi=Ht.get(Hn),Gr=Ln,Gr.setIndex(Vi));const jc=null!==Hn?Hn.count:Fi.count,lh=Be.drawRange.start*Ni,ch=Be.drawRange.count*Ni,Cl=null!==Nn?Nn.start*Ni:0,Gi=null!==Nn?Nn.count*Ni:1/0,kd=Math.max(lh,Cl),us=Math.min(jc,lh+ch,Cl+Gi)-1,sc=Math.max(0,us-kd+1);if(0!==sc){if(tt.isMesh)!0===Ae.wireframe?(Dt.setLineWidth(Ae.wireframeLinewidth*Vn()),Gr.setMode(we.LINES)):Gr.setMode(we.TRIANGLES);else if(tt.isLine){let uh=Ae.linewidth;void 0===uh&&(uh=1),Dt.setLineWidth(uh*Vn()),Gr.setMode(tt.isLineSegments?we.LINES:tt.isLineLoop?we.LINE_LOOP:we.LINE_STRIP)}else tt.isPoints?Gr.setMode(we.POINTS):tt.isSprite&&Gr.setMode(we.TRIANGLES);if(tt.isInstancedMesh)Gr.renderInstances(kd,sc,tt.count);else if(Be.isInstancedBufferGeometry){const uh=Math.min(Be.instanceCount,Be._maxInstanceCount);Gr.renderInstances(kd,sc,uh)}else Gr.render(kd,sc)}},this.compile=function(Q,Ee){D=ne.get(Q),D.init(),L.push(D),Q.traverseVisible(function(Be){Be.isLight&&Be.layers.test(Ee.layers)&&(D.pushLight(Be),Be.castShadow&&D.pushShadow(Be))}),D.setupLights(P.physicallyCorrectLights),Q.traverse(function(Be){const Ae=Be.material;if(Ae)if(Array.isArray(Ae))for(let tt=0;tt<Ae.length;tt++)jg(Ae[tt],Q,Be);else jg(Ae,Q,Be)}),L.pop(),D=null};let Tn=null;function tn(){Si.stop()}function Er(){Si.start()}const Si=new nd;function El(Q,Ee,Be,Ae){if(!1===Q.visible)return;if(Q.layers.test(Ee.layers))if(Q.isGroup)Be=Q.renderOrder;else if(Q.isLOD)!0===Q.autoUpdate&&Q.update(Ee);else if(Q.isLight)D.pushLight(Q),Q.castShadow&&D.pushShadow(Q);else if(Q.isSprite){if(!Q.frustumCulled||Ge.intersectsSprite(Q)){Ae&&gn.setFromMatrixPosition(Q.matrixWorld).applyMatrix4(xt);const Xn=Sn.update(Q),ui=Q.material;ui.visible&&T.push(Q,Xn,ui,Be,gn.z,null)}}else if((Q.isMesh||Q.isLine||Q.isPoints)&&(Q.isSkinnedMesh&&Q.skeleton.frame!==ci.render.frame&&(Q.skeleton.update(),Q.skeleton.frame=ci.render.frame),!Q.frustumCulled||Ge.intersectsObject(Q))){Ae&&gn.setFromMatrixPosition(Q.matrixWorld).applyMatrix4(xt);const Xn=Sn.update(Q),ui=Q.material;if(Array.isArray(ui)){const Hn=Xn.groups;for(let Fi=0,Ni=Hn.length;Fi<Ni;Fi++){const Vi=Hn[Fi],Gr=ui[Vi.materialIndex];Gr&&Gr.visible&&T.push(Q,Xn,Gr,Be,gn.z,Vi)}}else ui.visible&&T.push(Q,Xn,ui,Be,gn.z,null)}const Nn=Q.children;for(let Xn=0,ui=Nn.length;Xn<ui;Xn++)El(Nn[Xn],Ee,Be,Ae)}function Sl(Q,Ee,Be,Ae){const tt=Q.opaque,Nn=Q.transmissive,Xn=Q.transparent;D.setupLightsView(Be),Nn.length>0&&function vM(Q,Ee,Be){const Ae=ei.isWebGL2;null===ut&&(ut=new rs(1,1,{generateMipmaps:!0,type:null!==je.convert(ie)?ie:za,minFilter:Ua,samples:Ae&&!0===p?4:0})),P.getDrawingBufferSize(pt),Ae?ut.setSize(pt.x,pt.y):ut.setSize(Df(pt.x),Df(pt.y));const tt=P.getRenderTarget();P.setRenderTarget(ut),P.clear();const Nn=P.toneMapping;P.toneMapping=0,Gp(Q,Ee,Be),P.toneMapping=Nn,it.updateMultisampleRenderTarget(ut),it.updateRenderTargetMipmap(ut),P.setRenderTarget(tt)}(tt,Ee,Be),Ae&&Dt.viewport(ae.copy(Ae)),tt.length>0&&Gp(tt,Ee,Be),Nn.length>0&&Gp(Nn,Ee,Be),Xn.length>0&&Gp(Xn,Ee,Be),Dt.buffers.depth.setTest(!0),Dt.buffers.depth.setMask(!0),Dt.buffers.color.setMask(!0),Dt.setPolygonOffset(!1)}function Gp(Q,Ee,Be){const Ae=!0===Ee.isScene?Ee.overrideMaterial:null;for(let tt=0,Nn=Q.length;tt<Nn;tt++){const Xn=Q[tt],ui=Xn.object,Hn=Xn.geometry,Fi=null===Ae?Xn.material:Ae,Ni=Xn.group;ui.layers.test(Be.layers)&&xM(ui,Ee,Be,Hn,Fi,Ni)}}function xM(Q,Ee,Be,Ae,tt,Nn){Q.onBeforeRender(P,Ee,Be,Ae,tt,Nn),Q.modelViewMatrix.multiplyMatrices(Be.matrixWorldInverse,Q.matrixWorld),Q.normalMatrix.getNormalMatrix(Q.modelViewMatrix),tt.onBeforeRender(P,Ee,Be,Ae,Q,Nn),!0===tt.transparent&&2===tt.side?(tt.side=1,tt.needsUpdate=!0,P.renderBufferDirect(Be,Ee,Ae,tt,Q,Nn),tt.side=0,tt.needsUpdate=!0,P.renderBufferDirect(Be,Ee,Ae,tt,Q,Nn),tt.side=2):P.renderBufferDirect(Be,Ee,Ae,tt,Q,Nn),Q.onAfterRender(P,Ee,Be,Ae,tt,Nn)}function jg(Q,Ee,Be){!0!==Ee.isScene&&(Ee=li);const Ae=$e.get(Q),tt=D.state.lights,Xn=tt.state.version,ui=vn.getParameters(Q,tt.state,D.state.shadowsArray,Ee,Be),Hn=vn.getProgramCacheKey(ui);let Fi=Ae.programs;Ae.environment=Q.isMeshStandardMaterial?Ee.environment:null,Ae.fog=Ee.fog,Ae.envMap=(Q.isMeshStandardMaterial?an:vt).get(Q.envMap||Ae.environment),void 0===Fi&&(Q.addEventListener("dispose",Pt),Fi=new Map,Ae.programs=Fi);let Ni=Fi.get(Hn);if(void 0!==Ni){if(Ae.currentProgram===Ni&&Ae.lightsStateVersion===Xn)return bM(Q,ui),Ni}else ui.uniforms=vn.getUniforms(Q),Q.onBuild(Be,ui,P),Q.onBeforeCompile(ui,P),Ni=vn.acquireProgram(ui,Hn),Fi.set(Hn,Ni),Ae.uniforms=ui.uniforms;const Vi=Ae.uniforms;(!Q.isShaderMaterial&&!Q.isRawShaderMaterial||!0===Q.clipping)&&(Vi.clippingPlanes=$.uniform),bM(Q,ui),Ae.needsLights=function Wp(Q){return Q.isMeshLambertMaterial||Q.isMeshToonMaterial||Q.isMeshPhongMaterial||Q.isMeshStandardMaterial||Q.isShadowMaterial||Q.isShaderMaterial&&!0===Q.lights}(Q),Ae.lightsStateVersion=Xn,Ae.needsLights&&(Vi.ambientLightColor.value=tt.state.ambient,Vi.lightProbe.value=tt.state.probe,Vi.directionalLights.value=tt.state.directional,Vi.directionalLightShadows.value=tt.state.directionalShadow,Vi.spotLights.value=tt.state.spot,Vi.spotLightShadows.value=tt.state.spotShadow,Vi.rectAreaLights.value=tt.state.rectArea,Vi.ltc_1.value=tt.state.rectAreaLTC1,Vi.ltc_2.value=tt.state.rectAreaLTC2,Vi.pointLights.value=tt.state.point,Vi.pointLightShadows.value=tt.state.pointShadow,Vi.hemisphereLights.value=tt.state.hemi,Vi.directionalShadowMap.value=tt.state.directionalShadowMap,Vi.directionalShadowMatrix.value=tt.state.directionalShadowMatrix,Vi.spotShadowMap.value=tt.state.spotShadowMap,Vi.spotShadowMatrix.value=tt.state.spotShadowMatrix,Vi.pointShadowMap.value=tt.state.pointShadowMap,Vi.pointShadowMatrix.value=tt.state.pointShadowMatrix);const Gr=Ni.getUniforms(),jc=Fc.seqWithValue(Gr.seq,Vi);return Ae.currentProgram=Ni,Ae.uniformsList=jc,Ni}function bM(Q,Ee){const Be=$e.get(Q);Be.outputEncoding=Ee.outputEncoding,Be.instancing=Ee.instancing,Be.skinning=Ee.skinning,Be.morphTargets=Ee.morphTargets,Be.morphNormals=Ee.morphNormals,Be.morphColors=Ee.morphColors,Be.morphTargetsCount=Ee.morphTargetsCount,Be.numClippingPlanes=Ee.numClippingPlanes,Be.numIntersection=Ee.numClipIntersection,Be.vertexAlphas=Ee.vertexAlphas,Be.vertexTangents=Ee.vertexTangents,Be.toneMapping=Ee.toneMapping}Si.setAnimationLoop(function Mt(Q){Tn&&Tn(Q)}),"undefined"!=typeof self&&Si.setContext(self),this.setAnimationLoop=function(Q){Tn=Q,Ne.setAnimationLoop(Q),null===Q?Si.stop():Si.start()},Ne.addEventListener("sessionstart",tn),Ne.addEventListener("sessionend",Er),this.render=function(Q,Ee){if(void 0===Ee||!0===Ee.isCamera){if(!0!==I){if(!0===Q.autoUpdate&&Q.updateMatrixWorld(),null===Ee.parent&&Ee.updateMatrixWorld(),!0===Ne.enabled&&!0===Ne.isPresenting&&(!0===Ne.cameraAutoUpdate&&Ne.updateCamera(Ee),Ee=Ne.getCamera()),!0===Q.isScene&&Q.onBeforeRender(P,Q,Ee,j),D=ne.get(Q,L.length),D.init(),L.push(D),xt.multiplyMatrices(Ee.projectionMatrix,Ee.matrixWorldInverse),Ge.setFromProjectionMatrix(xt),st=this.localClippingEnabled,xe=$.init(this.clippingPlanes,st,Ee),T=rr.get(Q,R.length),T.init(),R.push(T),El(Q,Ee,0,P.sortObjects),T.finish(),!0===P.sortObjects&&T.sort(ce,dt),!0===xe&&$.beginShadows(),ze.render(D.state.shadowsArray,Q,Ee),!0===xe&&$.endShadows(),!0===this.info.autoReset&&this.info.reset(),ft.render(T,Q),D.setupLights(P.physicallyCorrectLights),Ee.isArrayCamera){const Ae=Ee.cameras;for(let tt=0,Nn=Ae.length;tt<Nn;tt++){const Xn=Ae[tt];Sl(T,Q,Xn,Xn.viewport)}}else Sl(T,Q,Ee);null!==j&&(it.updateMultisampleRenderTarget(j),it.updateRenderTargetMipmap(j)),!0===Q.isScene&&Q.onAfterRender(P,Q,Ee),Kn.resetDefaultState(),H=-1,K=null,L.pop(),D=L.length>0?L[L.length-1]:null,R.pop(),T=R.length>0?R[R.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return z},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return j},this.setRenderTargetTextures=function(Q,Ee,Be){$e.get(Q.texture).__webglTexture=Ee,$e.get(Q.depthTexture).__webglTexture=Be;const Ae=$e.get(Q);Ae.__hasExternalTextures=!0,Ae.__hasExternalTextures&&(Ae.__autoAllocateDepthBuffer=void 0===Be,Ae.__autoAllocateDepthBuffer||!0===Qn.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ae.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Q,Ee){const Be=$e.get(Q);Be.__webglFramebuffer=Ee,Be.__useDefaultFramebuffer=void 0===Ee},this.setRenderTarget=function(Q,Ee=0,Be=0){j=Q,z=Ee,B=Be;let Ae=!0;if(Q){const Hn=$e.get(Q);void 0!==Hn.__useDefaultFramebuffer?(Dt.bindFramebuffer(we.FRAMEBUFFER,null),Ae=!1):void 0===Hn.__webglFramebuffer?it.setupRenderTarget(Q):Hn.__hasExternalTextures&&it.rebindTextures(Q,$e.get(Q.texture).__webglTexture,$e.get(Q.depthTexture).__webglTexture)}let tt=null,Nn=!1,Xn=!1;if(Q){const Hn=Q.texture;(Hn.isData3DTexture||Hn.isDataArrayTexture)&&(Xn=!0);const Fi=$e.get(Q).__webglFramebuffer;Q.isWebGLCubeRenderTarget?(tt=Fi[Ee],Nn=!0):tt=ei.isWebGL2&&Q.samples>0&&!1===it.useMultisampledRTT(Q)?$e.get(Q).__webglMultisampledFramebuffer:Fi,ae.copy(Q.viewport),he.copy(Q.scissor),me=Q.scissorTest}else ae.copy(Me).multiplyScalar(X).floor(),he.copy(Oe).multiplyScalar(X).floor(),me=Re;if(Dt.bindFramebuffer(we.FRAMEBUFFER,tt)&&ei.drawBuffers&&Ae&&Dt.drawBuffers(Q,tt),Dt.viewport(ae),Dt.scissor(he),Dt.setScissorTest(me),Nn){const Hn=$e.get(Q.texture);we.framebufferTexture2D(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Hn.__webglTexture,Be)}else if(Xn){const Hn=$e.get(Q.texture);we.framebufferTextureLayer(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,Hn.__webglTexture,Be||0,Ee||0)}H=-1},this.readRenderTargetPixels=function(Q,Ee,Be,Ae,tt,Nn,Xn){if(!Q||!Q.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ui=$e.get(Q).__webglFramebuffer;if(Q.isWebGLCubeRenderTarget&&void 0!==Xn&&(ui=ui[Xn]),ui){Dt.bindFramebuffer(we.FRAMEBUFFER,ui);try{const Hn=Q.texture,Fi=Hn.format,Ni=Hn.type;if(Fi!==Ct&&je.convert(Fi)!==we.getParameter(we.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Vi=Ni===ie&&(Qn.has("EXT_color_buffer_half_float")||ei.isWebGL2&&Qn.has("EXT_color_buffer_float"));if(!(Ni===za||je.convert(Ni)===we.getParameter(we.IMPLEMENTATION_COLOR_READ_TYPE)||Ni===W&&(ei.isWebGL2||Qn.has("OES_texture_float")||Qn.has("WEBGL_color_buffer_float"))||Vi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ee>=0&&Ee<=Q.width-Ae&&Be>=0&&Be<=Q.height-tt&&we.readPixels(Ee,Be,Ae,tt,je.convert(Fi),je.convert(Ni),Nn)}finally{const Hn=null!==j?$e.get(j).__webglFramebuffer:null;Dt.bindFramebuffer(we.FRAMEBUFFER,Hn)}}},this.copyFramebufferToTexture=function(Q,Ee,Be=0){if(!0!==Ee.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Ae=Math.pow(2,-Be),tt=Math.floor(Ee.image.width*Ae),Nn=Math.floor(Ee.image.height*Ae);it.setTexture2D(Ee,0),we.copyTexSubImage2D(we.TEXTURE_2D,Be,0,0,Q.x,Q.y,tt,Nn),Dt.unbindTexture()},this.copyTextureToTexture=function(Q,Ee,Be,Ae=0){const tt=Ee.image.width,Nn=Ee.image.height,Xn=je.convert(Be.format),ui=je.convert(Be.type);it.setTexture2D(Be,0),we.pixelStorei(we.UNPACK_FLIP_Y_WEBGL,Be.flipY),we.pixelStorei(we.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Be.premultiplyAlpha),we.pixelStorei(we.UNPACK_ALIGNMENT,Be.unpackAlignment),Ee.isDataTexture?we.texSubImage2D(we.TEXTURE_2D,Ae,Q.x,Q.y,tt,Nn,Xn,ui,Ee.image.data):Ee.isCompressedTexture?we.compressedTexSubImage2D(we.TEXTURE_2D,Ae,Q.x,Q.y,Ee.mipmaps[0].width,Ee.mipmaps[0].height,Xn,Ee.mipmaps[0].data):we.texSubImage2D(we.TEXTURE_2D,Ae,Q.x,Q.y,Xn,ui,Ee.image),0===Ae&&Be.generateMipmaps&&we.generateMipmap(we.TEXTURE_2D),Dt.unbindTexture()},this.copyTextureToTexture3D=function(Q,Ee,Be,Ae,tt=0){if(P.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Nn=Q.max.x-Q.min.x+1,Xn=Q.max.y-Q.min.y+1,ui=Q.max.z-Q.min.z+1,Hn=je.convert(Ae.format),Fi=je.convert(Ae.type);let Ni;if(Ae.isData3DTexture)it.setTexture3D(Ae,0),Ni=we.TEXTURE_3D;else{if(!Ae.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");it.setTexture2DArray(Ae,0),Ni=we.TEXTURE_2D_ARRAY}we.pixelStorei(we.UNPACK_FLIP_Y_WEBGL,Ae.flipY),we.pixelStorei(we.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ae.premultiplyAlpha),we.pixelStorei(we.UNPACK_ALIGNMENT,Ae.unpackAlignment);const Vi=we.getParameter(we.UNPACK_ROW_LENGTH),Gr=we.getParameter(we.UNPACK_IMAGE_HEIGHT),jc=we.getParameter(we.UNPACK_SKIP_PIXELS),lh=we.getParameter(we.UNPACK_SKIP_ROWS),ch=we.getParameter(we.UNPACK_SKIP_IMAGES),Cl=Be.isCompressedTexture?Be.mipmaps[0]:Be.image;we.pixelStorei(we.UNPACK_ROW_LENGTH,Cl.width),we.pixelStorei(we.UNPACK_IMAGE_HEIGHT,Cl.height),we.pixelStorei(we.UNPACK_SKIP_PIXELS,Q.min.x),we.pixelStorei(we.UNPACK_SKIP_ROWS,Q.min.y),we.pixelStorei(we.UNPACK_SKIP_IMAGES,Q.min.z),Be.isDataTexture||Be.isData3DTexture?we.texSubImage3D(Ni,tt,Ee.x,Ee.y,Ee.z,Nn,Xn,ui,Hn,Fi,Cl.data):Be.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),we.compressedTexSubImage3D(Ni,tt,Ee.x,Ee.y,Ee.z,Nn,Xn,ui,Hn,Cl.data)):we.texSubImage3D(Ni,tt,Ee.x,Ee.y,Ee.z,Nn,Xn,ui,Hn,Fi,Cl),we.pixelStorei(we.UNPACK_ROW_LENGTH,Vi),we.pixelStorei(we.UNPACK_IMAGE_HEIGHT,Gr),we.pixelStorei(we.UNPACK_SKIP_PIXELS,jc),we.pixelStorei(we.UNPACK_SKIP_ROWS,lh),we.pixelStorei(we.UNPACK_SKIP_IMAGES,ch),0===tt&&Ae.generateMipmaps&&we.generateMipmap(Ni),Dt.unbindTexture()},this.initTexture=function(Q){it.setTexture2D(Q,0),Dt.unbindTexture()},this.resetState=function(){z=0,B=0,j=null,Dt.reset(),Kn.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}tr.prototype.isWebGLRenderer=!0;class sw extends tr{}sw.prototype.isWebGL1Renderer=!0;class md{constructor(r,a=25e-5){this.name="",this.color=new Tt(r),this.density=a}clone(){return new md(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}md.prototype.isFogExp2=!0;class Vu{constructor(r,a=1,c=1e3){this.name="",this.color=new Tt(r),this.near=a,this.far=c}clone(){return new Vu(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Vu.prototype.isFog=!0;class up extends _i{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,a){return super.copy(r,a),null!==r.background&&(this.background=r.background.clone()),null!==r.environment&&(this.environment=r.environment.clone()),null!==r.fog&&(this.fog=r.fog.clone()),null!==r.overrideMaterial&&(this.overrideMaterial=r.overrideMaterial.clone()),this.autoUpdate=r.autoUpdate,this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const a=super.toJSON(r);return null!==this.fog&&(a.object.fog=this.fog.toJSON()),a}}up.prototype.isScene=!0;class gd{constructor(r,a){this.array=r,this.stride=a,this.count=void 0!==r?r.length/a:0,this.usage=Uh,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ha()}onUploadCallback(){}set needsUpdate(r){!0===r&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,a,c){r*=this.stride,c*=a.stride;for(let h=0,p=this.stride;h<p;h++)this.array[r+h]=a.array[c+h];return this}set(r,a=0){return this.array.set(r,a),this}clone(r){void 0===r.arrayBuffers&&(r.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ha()),void 0===r.arrayBuffers[this.array.buffer._uuid]&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const a=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),c=new this.constructor(a,this.stride);return c.setUsage(this.usage),c}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return void 0===r.arrayBuffers&&(r.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ha()),void 0===r.arrayBuffers[this.array.buffer._uuid]&&(r.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}gd.prototype.isInterleavedBuffer=!0;const mo=new J;class Oc{constructor(r,a,c,h=!1){this.name="",this.data=r,this.itemSize=a,this.offset=c,this.normalized=!0===h}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(r){this.data.needsUpdate=r}applyMatrix4(r){for(let a=0,c=this.data.count;a<c;a++)mo.fromBufferAttribute(this,a),mo.applyMatrix4(r),this.setXYZ(a,mo.x,mo.y,mo.z);return this}applyNormalMatrix(r){for(let a=0,c=this.count;a<c;a++)mo.fromBufferAttribute(this,a),mo.applyNormalMatrix(r),this.setXYZ(a,mo.x,mo.y,mo.z);return this}transformDirection(r){for(let a=0,c=this.count;a<c;a++)mo.fromBufferAttribute(this,a),mo.transformDirection(r),this.setXYZ(a,mo.x,mo.y,mo.z);return this}setX(r,a){return this.data.array[r*this.data.stride+this.offset]=a,this}setY(r,a){return this.data.array[r*this.data.stride+this.offset+1]=a,this}setZ(r,a){return this.data.array[r*this.data.stride+this.offset+2]=a,this}setW(r,a){return this.data.array[r*this.data.stride+this.offset+3]=a,this}getX(r){return this.data.array[r*this.data.stride+this.offset]}getY(r){return this.data.array[r*this.data.stride+this.offset+1]}getZ(r){return this.data.array[r*this.data.stride+this.offset+2]}getW(r){return this.data.array[r*this.data.stride+this.offset+3]}setXY(r,a,c){return this.data.array[(r=r*this.data.stride+this.offset)+0]=a,this.data.array[r+1]=c,this}setXYZ(r,a,c,h){return this.data.array[(r=r*this.data.stride+this.offset)+0]=a,this.data.array[r+1]=c,this.data.array[r+2]=h,this}setXYZW(r,a,c,h,p){return this.data.array[(r=r*this.data.stride+this.offset)+0]=a,this.data.array[r+1]=c,this.data.array[r+2]=h,this.data.array[r+3]=p,this}clone(r){if(void 0===r){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const a=[];for(let c=0;c<this.count;c++){const h=c*this.data.stride+this.offset;for(let p=0;p<this.itemSize;p++)a.push(this.data.array[h+p])}return new Pi(new this.array.constructor(a),this.itemSize,this.normalized)}return void 0===r.interleavedBuffers&&(r.interleavedBuffers={}),void 0===r.interleavedBuffers[this.data.uuid]&&(r.interleavedBuffers[this.data.uuid]=this.data.clone(r)),new Oc(r.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(r){if(void 0===r){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const a=[];for(let c=0;c<this.count;c++){const h=c*this.data.stride+this.offset;for(let p=0;p<this.itemSize;p++)a.push(this.data.array[h+p])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}return void 0===r.interleavedBuffers&&(r.interleavedBuffers={}),void 0===r.interleavedBuffers[this.data.uuid]&&(r.interleavedBuffers[this.data.uuid]=this.data.toJSON(r)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Oc.prototype.isInterleavedBufferAttribute=!0;class hp extends Zt{constructor(r){super(),this.type="SpriteMaterial",this.color=new Tt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this}}let yd;hp.prototype.isSpriteMaterial=!0;const dp=new J,go=new J,_d=new J,Uu=new Qe,fp=new Qe,ow=new on,gg=new J,pp=new J,mp=new J,aw=new Qe,mv=new Qe,lw=new Qe;class In extends _i{constructor(r){if(super(),this.type="Sprite",void 0===yd){yd=new Jt;const a=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),c=new gd(a,5);yd.setIndex([0,1,2,0,2,3]),yd.setAttribute("position",new Oc(c,3,0,!1)),yd.setAttribute("uv",new Oc(c,2,3,!1))}this.geometry=yd,this.material=void 0!==r?r:new hp,this.center=new Qe(.5,.5)}raycast(r,a){null===r.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),go.setFromMatrixScale(this.matrixWorld),ow.copy(r.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(r.camera.matrixWorldInverse,this.matrixWorld),_d.setFromMatrixPosition(this.modelViewMatrix),r.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&go.multiplyScalar(-_d.z);const c=this.material.rotation;let h,p;0!==c&&(p=Math.cos(c),h=Math.sin(c));const g=this.center;Je(gg.set(-.5,-.5,0),_d,g,go,h,p),Je(pp.set(.5,-.5,0),_d,g,go,h,p),Je(mp.set(.5,.5,0),_d,g,go,h,p),aw.set(0,0),mv.set(1,0),lw.set(1,1);let _=r.ray.intersectTriangle(gg,pp,mp,!1,dp);if(null===_&&(Je(pp.set(-.5,.5,0),_d,g,go,h,p),mv.set(0,1),_=r.ray.intersectTriangle(gg,mp,pp,!1,dp),null===_))return;const w=r.ray.origin.distanceTo(dp);w<r.near||w>r.far||a.push({distance:w,point:dp.clone(),uv:Vr.getUV(dp,gg,pp,mp,aw,mv,lw,new Qe),face:null,object:this})}copy(r){return super.copy(r),void 0!==r.center&&this.center.copy(r.center),this.material=r.material,this}}function Je(d,r,a,c,h,p){Uu.subVectors(d,a).addScalar(.5).multiply(c),void 0!==h?(fp.x=p*Uu.x-h*Uu.y,fp.y=h*Uu.x+p*Uu.y):fp.copy(Uu),d.copy(r),d.x+=fp.x,d.y+=fp.y,d.applyMatrix4(ow)}In.prototype.isSprite=!0;const gp=new J,gv=new J;class yp extends _i{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(r){super.copy(r,!1);const a=r.levels;for(let c=0,h=a.length;c<h;c++){const p=a[c];this.addLevel(p.object.clone(),p.distance)}return this.autoUpdate=r.autoUpdate,this}addLevel(r,a=0){a=Math.abs(a);const c=this.levels;let h;for(h=0;h<c.length&&!(a<c[h].distance);h++);return c.splice(h,0,{distance:a,object:r}),this.add(r),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){const a=this.levels;if(a.length>0){let c,h;for(c=1,h=a.length;c<h&&!(r<a[c].distance);c++);return a[c-1].object}return null}raycast(r,a){if(this.levels.length>0){gp.setFromMatrixPosition(this.matrixWorld);const h=r.ray.origin.distanceTo(gp);this.getObjectForDistance(h).raycast(r,a)}}update(r){const a=this.levels;if(a.length>1){gp.setFromMatrixPosition(r.matrixWorld),gv.setFromMatrixPosition(this.matrixWorld);const c=gp.distanceTo(gv)/r.zoom;let h,p;for(a[0].object.visible=!0,h=1,p=a.length;h<p&&c>=a[h].distance;h++)a[h-1].object.visible=!1,a[h].object.visible=!0;for(this._currentLevel=h-1;h<p;h++)a[h].object.visible=!1}}toJSON(r){const a=super.toJSON(r);!1===this.autoUpdate&&(a.object.autoUpdate=!1),a.object.levels=[];const c=this.levels;for(let h=0,p=c.length;h<p;h++){const g=c[h];a.object.levels.push({object:g.object.uuid,distance:g.distance})}return a}}const wa=new J,yv=new ki,cw=new ki,_v=new J,gl=new on;class vd extends Kr{constructor(r,a){super(r,a),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new on,this.bindMatrixInverse=new on}copy(r){return super.copy(r),this.bindMode=r.bindMode,this.bindMatrix.copy(r.bindMatrix),this.bindMatrixInverse.copy(r.bindMatrixInverse),this.skeleton=r.skeleton,this}bind(r,a){this.skeleton=r,void 0===a&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),a=this.matrixWorld),this.bindMatrix.copy(a),this.bindMatrixInverse.copy(a).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const r=new ki,a=this.geometry.attributes.skinWeight;for(let c=0,h=a.count;c<h;c++){r.fromBufferAttribute(a,c);const p=1/r.manhattanLength();p!==1/0?r.multiplyScalar(p):r.set(1,0,0,0),a.setXYZW(c,r.x,r.y,r.z,r.w)}}updateMatrixWorld(r){super.updateMatrixWorld(r),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(r,a){const c=this.skeleton,h=this.geometry;yv.fromBufferAttribute(h.attributes.skinIndex,r),cw.fromBufferAttribute(h.attributes.skinWeight,r),wa.copy(a).applyMatrix4(this.bindMatrix),a.set(0,0,0);for(let p=0;p<4;p++){const g=cw.getComponent(p);if(0!==g){const _=yv.getComponent(p);gl.multiplyMatrices(c.bones[_].matrixWorld,c.boneInverses[_]),a.addScaledVector(_v.copy(wa).applyMatrix4(gl),g)}}return a.applyMatrix4(this.bindMatrixInverse)}}vd.prototype.isSkinnedMesh=!0;class _p extends _i{constructor(){super(),this.type="Bone"}}_p.prototype.isBone=!0;class Yl extends is{constructor(r=null,a=1,c=1,h,p,g,_,w,M=Br,S=Br,T,D){super(null,g,_,w,M,S,h,p,T,D),this.image={data:r,width:a,height:c},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Yl.prototype.isDataTexture=!0;const CT=new on,uw=new on;class vv{constructor(r=[],a=[]){this.uuid=ha(),this.bones=r.slice(0),this.boneInverses=a,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const r=this.bones,a=this.boneInverses;if(this.boneMatrices=new Float32Array(16*r.length),0===a.length)this.calculateInverses();else if(r.length!==a.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let c=0,h=this.bones.length;c<h;c++)this.boneInverses.push(new on)}}calculateInverses(){this.boneInverses.length=0;for(let r=0,a=this.bones.length;r<a;r++){const c=new on;this.bones[r]&&c.copy(this.bones[r].matrixWorld).invert(),this.boneInverses.push(c)}}pose(){for(let r=0,a=this.bones.length;r<a;r++){const c=this.bones[r];c&&c.matrixWorld.copy(this.boneInverses[r]).invert()}for(let r=0,a=this.bones.length;r<a;r++){const c=this.bones[r];c&&(c.parent&&c.parent.isBone?(c.matrix.copy(c.parent.matrixWorld).invert(),c.matrix.multiply(c.matrixWorld)):c.matrix.copy(c.matrixWorld),c.matrix.decompose(c.position,c.quaternion,c.scale))}}update(){const r=this.bones,a=this.boneInverses,c=this.boneMatrices,h=this.boneTexture;for(let p=0,g=r.length;p<g;p++)CT.multiplyMatrices(r[p]?r[p].matrixWorld:uw,a[p]),CT.toArray(c,16*p);null!==h&&(h.needsUpdate=!0)}clone(){return new vv(this.bones,this.boneInverses)}computeBoneTexture(){let r=Math.sqrt(4*this.bones.length);r=Ox(r),r=Math.max(r,4);const a=new Float32Array(r*r*4);a.set(this.boneMatrices);const c=new Yl(a,r,r,Ct,W);return c.needsUpdate=!0,this.boneMatrices=a,this.boneTexture=c,this.boneTextureSize=r,this}getBoneByName(r){for(let a=0,c=this.bones.length;a<c;a++){const h=this.bones[a];if(h.name===r)return h}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,a){this.uuid=r.uuid;for(let c=0,h=r.bones.length;c<h;c++){const p=r.bones[c];let g=a[p];void 0===g&&(console.warn("THREE.Skeleton: No bone found with UUID:",p),g=new _p),this.bones.push(g),this.boneInverses.push((new on).fromArray(r.boneInverses[c]))}return this.init(),this}toJSON(){const r={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;const a=this.bones,c=this.boneInverses;for(let h=0,p=a.length;h<p;h++)r.bones.push(a[h].uuid),r.boneInverses.push(c[h].toArray());return r}}class yl extends Pi{constructor(r,a,c,h=1){"number"==typeof c&&(h=c,c=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(r,a,c),this.meshPerAttribute=h}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}toJSON(){const r=super.toJSON();return r.meshPerAttribute=this.meshPerAttribute,r.isInstancedBufferAttribute=!0,r}}yl.prototype.isInstancedBufferAttribute=!0;const vp=new on,yg=new on,xd=[],zu=new Kr;class hw extends Kr{constructor(r,a,c){super(r,a),this.instanceMatrix=new yl(new Float32Array(16*c),16),this.instanceColor=null,this.count=c,this.frustumCulled=!1}copy(r){return super.copy(r),this.instanceMatrix.copy(r.instanceMatrix),null!==r.instanceColor&&(this.instanceColor=r.instanceColor.clone()),this.count=r.count,this}getColorAt(r,a){a.fromArray(this.instanceColor.array,3*r)}getMatrixAt(r,a){a.fromArray(this.instanceMatrix.array,16*r)}raycast(r,a){const c=this.matrixWorld,h=this.count;if(zu.geometry=this.geometry,zu.material=this.material,void 0!==zu.material)for(let p=0;p<h;p++){this.getMatrixAt(p,vp),yg.multiplyMatrices(c,vp),zu.matrixWorld=yg,zu.raycast(r,xd);for(let g=0,_=xd.length;g<_;g++){const w=xd[g];w.instanceId=p,w.object=this,a.push(w)}xd.length=0}}setColorAt(r,a){null===this.instanceColor&&(this.instanceColor=new yl(new Float32Array(3*this.instanceMatrix.count),3)),a.toArray(this.instanceColor.array,3*r)}setMatrixAt(r,a){a.toArray(this.instanceMatrix.array,16*r)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}hw.prototype.isInstancedMesh=!0;class Ps extends Zt{constructor(r){super(),this.type="LineBasicMaterial",this.color=new Tt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this}}Ps.prototype.isLineBasicMaterial=!0;const dw=new J,fw=new J,pw=new on,_g=new No,xv=new Cu;class Kl extends _i{constructor(r=new Jt,a=new Ps){super(),this.type="Line",this.geometry=r,this.material=a,this.updateMorphTargets()}copy(r){return super.copy(r),this.material=r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.isBufferGeometry)if(null===r.index){const a=r.attributes.position,c=[0];for(let h=1,p=a.count;h<p;h++)dw.fromBufferAttribute(a,h-1),fw.fromBufferAttribute(a,h),c[h]=c[h-1],c[h]+=dw.distanceTo(fw);r.setAttribute("lineDistance",new en(c,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else r.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(r,a){const c=this.geometry,h=this.matrixWorld,p=r.params.Line.threshold,g=c.drawRange;if(null===c.boundingSphere&&c.computeBoundingSphere(),xv.copy(c.boundingSphere),xv.applyMatrix4(h),xv.radius+=p,!1===r.ray.intersectsSphere(xv))return;pw.copy(h).invert(),_g.copy(r.ray).applyMatrix4(pw);const _=p/((this.scale.x+this.scale.y+this.scale.z)/3),w=_*_,M=new J,S=new J,T=new J,D=new J,R=this.isLineSegments?2:1;if(c.isBufferGeometry){const L=c.index,I=c.attributes.position;if(null!==L)for(let j=Math.max(0,g.start),H=Math.min(L.count,g.start+g.count)-1;j<H;j+=R){const K=L.getX(j),ae=L.getX(j+1);if(M.fromBufferAttribute(I,K),S.fromBufferAttribute(I,ae),_g.distanceSqToSegment(M,S,D,T)>w)continue;D.applyMatrix4(this.matrixWorld);const me=r.ray.origin.distanceTo(D);me<r.near||me>r.far||a.push({distance:me,point:T.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this})}else for(let j=Math.max(0,g.start),H=Math.min(I.count,g.start+g.count)-1;j<H;j+=R){if(M.fromBufferAttribute(I,j),S.fromBufferAttribute(I,j+1),_g.distanceSqToSegment(M,S,D,T)>w)continue;D.applyMatrix4(this.matrixWorld);const ae=r.ray.origin.distanceTo(D);ae<r.near||ae>r.far||a.push({distance:ae,point:T.clone().applyMatrix4(this.matrixWorld),index:j,face:null,faceIndex:null,object:this})}}else c.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const r=this.geometry;if(r.isBufferGeometry){const a=r.morphAttributes,c=Object.keys(a);if(c.length>0){const h=a[c[0]];if(void 0!==h){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let p=0,g=h.length;p<g;p++){const _=h[p].name||String(p);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=p}}}}else{const a=r.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Kl.prototype.isLine=!0;const TT=new J,bv=new J;class Co extends Kl{constructor(r,a){super(r,a),this.type="LineSegments"}computeLineDistances(){const r=this.geometry;if(r.isBufferGeometry)if(null===r.index){const a=r.attributes.position,c=[];for(let h=0,p=a.count;h<p;h+=2)TT.fromBufferAttribute(a,h),bv.fromBufferAttribute(a,h+1),c[h]=0===h?0:c[h-1],c[h+1]=c[h]+TT.distanceTo(bv);r.setAttribute("lineDistance",new en(c,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else r.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Co.prototype.isLineSegments=!0;class wv extends Kl{constructor(r,a){super(r,a),this.type="LineLoop"}}wv.prototype.isLineLoop=!0;class $l extends Zt{constructor(r){super(),this.type="PointsMaterial",this.color=new Tt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.size=r.size,this.sizeAttenuation=r.sizeAttenuation,this}}$l.prototype.isPointsMaterial=!0;const AT=new on,mw=new No,Mv=new Cu,Ev=new J;class vg extends _i{constructor(r=new Jt,a=new $l){super(),this.type="Points",this.geometry=r,this.material=a,this.updateMorphTargets()}copy(r){return super.copy(r),this.material=r.material,this.geometry=r.geometry,this}raycast(r,a){const c=this.geometry,h=this.matrixWorld,p=r.params.Points.threshold,g=c.drawRange;if(null===c.boundingSphere&&c.computeBoundingSphere(),Mv.copy(c.boundingSphere),Mv.applyMatrix4(h),Mv.radius+=p,!1===r.ray.intersectsSphere(Mv))return;AT.copy(h).invert(),mw.copy(r.ray).applyMatrix4(AT);const _=p/((this.scale.x+this.scale.y+this.scale.z)/3),w=_*_;if(c.isBufferGeometry){const M=c.index,T=c.attributes.position;if(null!==M)for(let L=Math.max(0,g.start),P=Math.min(M.count,g.start+g.count);L<P;L++){const I=M.getX(L);Ev.fromBufferAttribute(T,I),DT(Ev,I,w,h,r,a,this)}else for(let L=Math.max(0,g.start),P=Math.min(T.count,g.start+g.count);L<P;L++)Ev.fromBufferAttribute(T,L),DT(Ev,L,w,h,r,a,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const r=this.geometry;if(r.isBufferGeometry){const a=r.morphAttributes,c=Object.keys(a);if(c.length>0){const h=a[c[0]];if(void 0!==h){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let p=0,g=h.length;p<g;p++){const _=h[p].name||String(p);this.morphTargetInfluences.push(0),this.morphTargetDictionary[_]=p}}}}else{const a=r.morphTargets;void 0!==a&&a.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function DT(d,r,a,c,h,p,g){const _=mw.distanceSqToPoint(d);if(_<a){const w=new J;mw.closestPointToPoint(d,w),w.applyMatrix4(c);const M=h.ray.origin.distanceTo(w);if(M<h.near||M>h.far)return;p.push({distance:M,distanceToRay:Math.sqrt(_),point:w,index:r,face:null,object:g})}}vg.prototype.isPoints=!0;class RT extends is{constructor(r,a,c,h,p,g,_,w,M){super(r,a,c,h,p,g,_,w,M),this.minFilter=void 0!==g?g:kr,this.magFilter=void 0!==p?p:kr,this.generateMipmaps=!1;const S=this;"requestVideoFrameCallback"in r&&r.requestVideoFrameCallback(function T(){S.needsUpdate=!0,r.requestVideoFrameCallback(T)})}clone(){return new this.constructor(this.image).copy(this)}update(){const r=this.image;"requestVideoFrameCallback"in r==0&&r.readyState>=r.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}RT.prototype.isVideoTexture=!0;class PT extends is{constructor(r,a,c){super({width:r,height:a}),this.format=c,this.magFilter=Br,this.minFilter=Br,this.generateMipmaps=!1,this.needsUpdate=!0}}PT.prototype.isFramebufferTexture=!0;class gw extends is{constructor(r,a,c,h,p,g,_,w,M,S,T,D){super(null,g,_,w,M,S,h,p,T,D),this.image={width:a,height:c},this.mipmaps=r,this.flipY=!1,this.generateMipmaps=!1}}gw.prototype.isCompressedTexture=!0;class IT extends is{constructor(r,a,c,h,p,g,_,w,M){super(r,a,c,h,p,g,_,w,M),this.needsUpdate=!0}}IT.prototype.isCanvasTexture=!0;class cs{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,a){const c=this.getUtoTmapping(r);return this.getPoint(c,a)}getPoints(r=5){const a=[];for(let c=0;c<=r;c++)a.push(this.getPoint(c/r));return a}getSpacedPoints(r=5){const a=[];for(let c=0;c<=r;c++)a.push(this.getPointAt(c/r));return a}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const a=[];let c,h=this.getPoint(0),p=0;a.push(0);for(let g=1;g<=r;g++)c=this.getPoint(g/r),p+=c.distanceTo(h),a.push(p),h=c;return this.cacheArcLengths=a,a}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,a){const c=this.getLengths();let h=0;const p=c.length;let g;g=a||r*c[p-1];let M,_=0,w=p-1;for(;_<=w;)if(h=Math.floor(_+(w-_)/2),M=c[h]-g,M<0)_=h+1;else{if(!(M>0)){w=h;break}w=h-1}if(h=w,c[h]===g)return h/(p-1);const S=c[h];return(h+(g-S)/(c[h+1]-S))/(p-1)}getTangent(r,a){let h=r-1e-4,p=r+1e-4;h<0&&(h=0),p>1&&(p=1);const g=this.getPoint(h),_=this.getPoint(p),w=a||(g.isVector2?new Qe:new J);return w.copy(_).sub(g).normalize(),w}getTangentAt(r,a){const c=this.getUtoTmapping(r);return this.getTangent(c,a)}computeFrenetFrames(r,a){const c=new J,h=[],p=[],g=[],_=new J,w=new on;for(let R=0;R<=r;R++)h[R]=this.getTangentAt(R/r,new J);p[0]=new J,g[0]=new J;let M=Number.MAX_VALUE;const S=Math.abs(h[0].x),T=Math.abs(h[0].y),D=Math.abs(h[0].z);S<=M&&(M=S,c.set(1,0,0)),T<=M&&(M=T,c.set(0,1,0)),D<=M&&c.set(0,0,1),_.crossVectors(h[0],c).normalize(),p[0].crossVectors(h[0],_),g[0].crossVectors(h[0],p[0]);for(let R=1;R<=r;R++){if(p[R]=p[R-1].clone(),g[R]=g[R-1].clone(),_.crossVectors(h[R-1],h[R]),_.length()>Number.EPSILON){_.normalize();const L=Math.acos(ns(h[R-1].dot(h[R]),-1,1));p[R].applyMatrix4(w.makeRotationAxis(_,L))}g[R].crossVectors(h[R],p[R])}if(!0===a){let R=Math.acos(ns(p[0].dot(p[r]),-1,1));R/=r,h[0].dot(_.crossVectors(p[0],p[r]))>0&&(R=-R);for(let L=1;L<=r;L++)p[L].applyMatrix4(w.makeRotationAxis(h[L],R*L)),g[L].crossVectors(h[L],p[L])}return{tangents:h,normals:p,binormals:g}}clone(){return(new this.constructor).copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}}class Hu extends cs{constructor(r=0,a=0,c=1,h=1,p=0,g=2*Math.PI,_=!1,w=0){super(),this.type="EllipseCurve",this.aX=r,this.aY=a,this.xRadius=c,this.yRadius=h,this.aStartAngle=p,this.aEndAngle=g,this.aClockwise=_,this.aRotation=w}getPoint(r,a){const c=a||new Qe,h=2*Math.PI;let p=this.aEndAngle-this.aStartAngle;const g=Math.abs(p)<Number.EPSILON;for(;p<0;)p+=h;for(;p>h;)p-=h;p<Number.EPSILON&&(p=g?0:h),!0===this.aClockwise&&!g&&(p===h?p=-h:p-=h);const _=this.aStartAngle+r*p;let w=this.aX+this.xRadius*Math.cos(_),M=this.aY+this.yRadius*Math.sin(_);if(0!==this.aRotation){const S=Math.cos(this.aRotation),T=Math.sin(this.aRotation),D=w-this.aX,R=M-this.aY;w=D*S-R*T+this.aX,M=D*T+R*S+this.aY}return c.set(w,M)}copy(r){return super.copy(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}toJSON(){const r=super.toJSON();return r.aX=this.aX,r.aY=this.aY,r.xRadius=this.xRadius,r.yRadius=this.yRadius,r.aStartAngle=this.aStartAngle,r.aEndAngle=this.aEndAngle,r.aClockwise=this.aClockwise,r.aRotation=this.aRotation,r}fromJSON(r){return super.fromJSON(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}}Hu.prototype.isEllipseCurve=!0;class Sv extends Hu{constructor(r,a,c,h,p,g){super(r,a,c,c,h,p,g),this.type="ArcCurve"}}function xg(){let d=0,r=0,a=0,c=0;function h(p,g,_,w){d=p,r=_,a=-3*p+3*g-2*_-w,c=2*p-2*g+_+w}return{initCatmullRom:function(p,g,_,w,M){h(g,_,M*(_-p),M*(w-g))},initNonuniformCatmullRom:function(p,g,_,w,M,S,T){let D=(g-p)/M-(_-p)/(M+S)+(_-g)/S,R=(_-g)/S-(w-g)/(S+T)+(w-_)/T;D*=S,R*=S,h(g,_,D,R)},calc:function(p){const g=p*p;return d+r*p+a*g+c*(g*p)}}}Sv.prototype.isArcCurve=!0;const bd=new J,bg=new xg,xp=new xg,Cv=new xg;class _l extends cs{constructor(r=[],a=!1,c="centripetal",h=.5){super(),this.type="CatmullRomCurve3",this.points=r,this.closed=a,this.curveType=c,this.tension=h}getPoint(r,a=new J){const c=a,h=this.points,p=h.length,g=(p-(this.closed?0:1))*r;let M,S,_=Math.floor(g),w=g-_;this.closed?_+=_>0?0:(Math.floor(Math.abs(_)/p)+1)*p:0===w&&_===p-1&&(_=p-2,w=1),this.closed||_>0?M=h[(_-1)%p]:(bd.subVectors(h[0],h[1]).add(h[0]),M=bd);const T=h[_%p],D=h[(_+1)%p];if(this.closed||_+2<p?S=h[(_+2)%p]:(bd.subVectors(h[p-1],h[p-2]).add(h[p-1]),S=bd),"centripetal"===this.curveType||"chordal"===this.curveType){const R="chordal"===this.curveType?.5:.25;let L=Math.pow(M.distanceToSquared(T),R),P=Math.pow(T.distanceToSquared(D),R),I=Math.pow(D.distanceToSquared(S),R);P<1e-4&&(P=1),L<1e-4&&(L=P),I<1e-4&&(I=P),bg.initNonuniformCatmullRom(M.x,T.x,D.x,S.x,L,P,I),xp.initNonuniformCatmullRom(M.y,T.y,D.y,S.y,L,P,I),Cv.initNonuniformCatmullRom(M.z,T.z,D.z,S.z,L,P,I)}else"catmullrom"===this.curveType&&(bg.initCatmullRom(M.x,T.x,D.x,S.x,this.tension),xp.initCatmullRom(M.y,T.y,D.y,S.y,this.tension),Cv.initCatmullRom(M.z,T.z,D.z,S.z,this.tension));return c.set(bg.calc(w),xp.calc(w),Cv.calc(w)),c}copy(r){super.copy(r),this.points=[];for(let a=0,c=r.points.length;a<c;a++)this.points.push(r.points[a].clone());return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){const r=super.toJSON();r.points=[];for(let a=0,c=this.points.length;a<c;a++)r.points.push(this.points[a].toArray());return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let a=0,c=r.points.length;a<c;a++){const h=r.points[a];this.points.push((new J).fromArray(h))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function Tv(d,r,a,c,h){const p=.5*(c-r),g=.5*(h-a),_=d*d;return(2*a-2*c+p+g)*(d*_)+(-3*a+3*c-2*p-g)*_+p*d+a}function wd(d,r,a,c){return function LT(d,r){const a=1-d;return a*a*r}(d,r)+function Av(d,r){return 2*(1-d)*d*r}(d,a)+function FT(d,r){return d*d*r}(d,c)}function Gu(d,r,a,c,h){return function NT(d,r){const a=1-d;return a*a*a*r}(d,r)+function OT(d,r){const a=1-d;return 3*a*a*d*r}(d,a)+function bp(d,r){return 3*(1-d)*d*d*r}(d,c)+function Md(d,r){return d*d*d*r}(d,h)}_l.prototype.isCatmullRomCurve3=!0;class Zl extends cs{constructor(r=new Qe,a=new Qe,c=new Qe,h=new Qe){super(),this.type="CubicBezierCurve",this.v0=r,this.v1=a,this.v2=c,this.v3=h}getPoint(r,a=new Qe){const c=a,h=this.v0,p=this.v1,g=this.v2,_=this.v3;return c.set(Gu(r,h.x,p.x,g.x,_.x),Gu(r,h.y,p.y,g.y,_.y)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}Zl.prototype.isCubicBezierCurve=!0;class Wu extends cs{constructor(r=new J,a=new J,c=new J,h=new J){super(),this.type="CubicBezierCurve3",this.v0=r,this.v1=a,this.v2=c,this.v3=h}getPoint(r,a=new J){const c=a,h=this.v0,p=this.v1,g=this.v2,_=this.v3;return c.set(Gu(r,h.x,p.x,g.x,_.x),Gu(r,h.y,p.y,g.y,_.y),Gu(r,h.z,p.z,g.z,_.z)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}Wu.prototype.isCubicBezierCurve3=!0;class vl extends cs{constructor(r=new Qe,a=new Qe){super(),this.type="LineCurve",this.v1=r,this.v2=a}getPoint(r,a=new Qe){const c=a;return 1===r?c.copy(this.v2):(c.copy(this.v2).sub(this.v1),c.multiplyScalar(r).add(this.v1)),c}getPointAt(r,a){return this.getPoint(r,a)}getTangent(r,a){const c=a||new Qe;return c.copy(this.v2).sub(this.v1).normalize(),c}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}vl.prototype.isLineCurve=!0;class yw extends cs{constructor(r=new J,a=new J){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=r,this.v2=a}getPoint(r,a=new J){const c=a;return 1===r?c.copy(this.v2):(c.copy(this.v2).sub(this.v1),c.multiplyScalar(r).add(this.v1)),c}getPointAt(r,a){return this.getPoint(r,a)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class wp extends cs{constructor(r=new Qe,a=new Qe,c=new Qe){super(),this.type="QuadraticBezierCurve",this.v0=r,this.v1=a,this.v2=c}getPoint(r,a=new Qe){const c=a,h=this.v0,p=this.v1,g=this.v2;return c.set(wd(r,h.x,p.x,g.x),wd(r,h.y,p.y,g.y)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}wp.prototype.isQuadraticBezierCurve=!0;class Mp extends cs{constructor(r=new J,a=new J,c=new J){super(),this.type="QuadraticBezierCurve3",this.v0=r,this.v1=a,this.v2=c}getPoint(r,a=new J){const c=a,h=this.v0,p=this.v1,g=this.v2;return c.set(wd(r,h.x,p.x,g.x),wd(r,h.y,p.y,g.y),wd(r,h.z,p.z,g.z)),c}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}Mp.prototype.isQuadraticBezierCurve3=!0;class Ed extends cs{constructor(r=[]){super(),this.type="SplineCurve",this.points=r}getPoint(r,a=new Qe){const c=a,h=this.points,p=(h.length-1)*r,g=Math.floor(p),_=p-g,w=h[0===g?g:g-1],M=h[g],S=h[g>h.length-2?h.length-1:g+1],T=h[g>h.length-3?h.length-1:g+2];return c.set(Tv(_,w.x,M.x,S.x,T.x),Tv(_,w.y,M.y,S.y,T.y)),c}copy(r){super.copy(r),this.points=[];for(let a=0,c=r.points.length;a<c;a++)this.points.push(r.points[a].clone());return this}toJSON(){const r=super.toJSON();r.points=[];for(let a=0,c=this.points.length;a<c;a++)r.points.push(this.points[a].toArray());return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let a=0,c=r.points.length;a<c;a++){const h=r.points[a];this.points.push((new Qe).fromArray(h))}return this}}Ed.prototype.isSplineCurve=!0;var Ep=Object.freeze({__proto__:null,ArcCurve:Sv,CatmullRomCurve3:_l,CubicBezierCurve:Zl,CubicBezierCurve3:Wu,EllipseCurve:Hu,LineCurve:vl,LineCurve3:yw,QuadraticBezierCurve:wp,QuadraticBezierCurve3:Mp,SplineCurve:Ed});class Dv extends cs{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(r){this.curves.push(r)}closePath(){const r=this.curves[0].getPoint(0),a=this.curves[this.curves.length-1].getPoint(1);r.equals(a)||this.curves.push(new vl(a,r))}getPoint(r,a){const c=r*this.getLength(),h=this.getCurveLengths();let p=0;for(;p<h.length;){if(h[p]>=c){const g=h[p]-c,_=this.curves[p],w=_.getLength();return _.getPointAt(0===w?0:1-g/w,a)}p++}return null}getLength(){const r=this.getCurveLengths();return r[r.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const r=[];let a=0;for(let c=0,h=this.curves.length;c<h;c++)a+=this.curves[c].getLength(),r.push(a);return this.cacheLengths=r,r}getSpacedPoints(r=40){const a=[];for(let c=0;c<=r;c++)a.push(this.getPoint(c/r));return this.autoClose&&a.push(a[0]),a}getPoints(r=12){const a=[];let c;for(let h=0,p=this.curves;h<p.length;h++){const g=p[h],w=g.getPoints(g.isEllipseCurve?2*r:g.isLineCurve||g.isLineCurve3?1:g.isSplineCurve?r*g.points.length:r);for(let M=0;M<w.length;M++){const S=w[M];c&&c.equals(S)||(a.push(S),c=S)}}return this.autoClose&&a.length>1&&!a[a.length-1].equals(a[0])&&a.push(a[0]),a}copy(r){super.copy(r),this.curves=[];for(let a=0,c=r.curves.length;a<c;a++)this.curves.push(r.curves[a].clone());return this.autoClose=r.autoClose,this}toJSON(){const r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let a=0,c=this.curves.length;a<c;a++)r.curves.push(this.curves[a].toJSON());return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let a=0,c=r.curves.length;a<c;a++){const h=r.curves[a];this.curves.push((new Ep[h.type]).fromJSON(h))}return this}}class Jl extends Dv{constructor(r){super(),this.type="Path",this.currentPoint=new Qe,r&&this.setFromPoints(r)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let a=1,c=r.length;a<c;a++)this.lineTo(r[a].x,r[a].y);return this}moveTo(r,a){return this.currentPoint.set(r,a),this}lineTo(r,a){const c=new vl(this.currentPoint.clone(),new Qe(r,a));return this.curves.push(c),this.currentPoint.set(r,a),this}quadraticCurveTo(r,a,c,h){const p=new wp(this.currentPoint.clone(),new Qe(r,a),new Qe(c,h));return this.curves.push(p),this.currentPoint.set(c,h),this}bezierCurveTo(r,a,c,h,p,g){const _=new Zl(this.currentPoint.clone(),new Qe(r,a),new Qe(c,h),new Qe(p,g));return this.curves.push(_),this.currentPoint.set(p,g),this}splineThru(r){const a=[this.currentPoint.clone()].concat(r),c=new Ed(a);return this.curves.push(c),this.currentPoint.copy(r[r.length-1]),this}arc(r,a,c,h,p,g){return this.absarc(r+this.currentPoint.x,a+this.currentPoint.y,c,h,p,g),this}absarc(r,a,c,h,p,g){return this.absellipse(r,a,c,c,h,p,g),this}ellipse(r,a,c,h,p,g,_,w){return this.absellipse(r+this.currentPoint.x,a+this.currentPoint.y,c,h,p,g,_,w),this}absellipse(r,a,c,h,p,g,_,w){const M=new Hu(r,a,c,h,p,g,_,w);if(this.curves.length>0){const T=M.getPoint(0);T.equals(this.currentPoint)||this.lineTo(T.x,T.y)}this.curves.push(M);const S=M.getPoint(1);return this.currentPoint.copy(S),this}copy(r){return super.copy(r),this.currentPoint.copy(r.currentPoint),this}toJSON(){const r=super.toJSON();return r.currentPoint=this.currentPoint.toArray(),r}fromJSON(r){return super.fromJSON(r),this.currentPoint.fromArray(r.currentPoint),this}}class qu extends Jt{constructor(r=[new Qe(0,.5),new Qe(.5,0),new Qe(0,-.5)],a=12,c=0,h=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:a,phiStart:c,phiLength:h},a=Math.floor(a),h=ns(h,0,2*Math.PI);const p=[],g=[],_=[],w=[],M=[],S=1/a,T=new J,D=new Qe,R=new J,L=new J,P=new J;let I=0,z=0;for(let B=0;B<=r.length-1;B++)switch(B){case 0:I=r[B+1].x-r[B].x,z=r[B+1].y-r[B].y,R.x=1*z,R.y=-I,R.z=0*z,P.copy(R),R.normalize(),w.push(R.x,R.y,R.z);break;case r.length-1:w.push(P.x,P.y,P.z);break;default:I=r[B+1].x-r[B].x,z=r[B+1].y-r[B].y,R.x=1*z,R.y=-I,R.z=0*z,L.copy(R),R.x+=P.x,R.y+=P.y,R.z+=P.z,R.normalize(),w.push(R.x,R.y,R.z),P.copy(L)}for(let B=0;B<=a;B++){const j=c+B*S*h,H=Math.sin(j),K=Math.cos(j);for(let ae=0;ae<=r.length-1;ae++)T.x=r[ae].x*H,T.y=r[ae].y,T.z=r[ae].x*K,g.push(T.x,T.y,T.z),D.x=B/a,D.y=ae/(r.length-1),_.push(D.x,D.y),M.push(w[3*ae+0]*H,w[3*ae+1],w[3*ae+0]*K)}for(let B=0;B<a;B++)for(let j=0;j<r.length-1;j++){const H=j+B*r.length,ae=H+r.length,he=H+r.length+1,me=H+1;p.push(H,ae,me),p.push(he,me,ae)}this.setIndex(p),this.setAttribute("position",new en(g,3)),this.setAttribute("uv",new en(_,2)),this.setAttribute("normal",new en(M,3))}static fromJSON(r){return new qu(r.points,r.segments,r.phiStart,r.phiLength)}}class ju extends qu{constructor(r=1,a=1,c=4,h=8){const p=new Jl;p.absarc(0,-a/2,r,1.5*Math.PI,0),p.absarc(0,a/2,r,0,.5*Math.PI),super(p.getPoints(c),h),this.type="CapsuleGeometry",this.parameters={radius:r,height:a,capSegments:c,radialSegments:h}}static fromJSON(r){return new ju(r.radius,r.length,r.capSegments,r.radialSegments)}}class Sp extends Jt{constructor(r=1,a=8,c=0,h=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:a,thetaStart:c,thetaLength:h},a=Math.max(3,a);const p=[],g=[],_=[],w=[],M=new J,S=new Qe;g.push(0,0,0),_.push(0,0,1),w.push(.5,.5);for(let T=0,D=3;T<=a;T++,D+=3){const R=c+T/a*h;M.x=r*Math.cos(R),M.y=r*Math.sin(R),g.push(M.x,M.y,M.z),_.push(0,0,1),S.x=(g[D]/r+1)/2,S.y=(g[D+1]/r+1)/2,w.push(S.x,S.y)}for(let T=1;T<=a;T++)p.push(T,T+1,0);this.setIndex(p),this.setAttribute("position",new en(g,3)),this.setAttribute("normal",new en(_,3)),this.setAttribute("uv",new en(w,2))}static fromJSON(r){return new Sp(r.radius,r.segments,r.thetaStart,r.thetaLength)}}class Ql extends Jt{constructor(r=1,a=1,c=1,h=8,p=1,g=!1,_=0,w=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:r,radiusBottom:a,height:c,radialSegments:h,heightSegments:p,openEnded:g,thetaStart:_,thetaLength:w};const M=this;h=Math.floor(h),p=Math.floor(p);const S=[],T=[],D=[],R=[];let L=0;const P=[],I=c/2;let z=0;function j(H){const K=L,ae=new Qe,he=new J;let me=0;const ke=!0===H?r:a,ve=!0===H?1:-1;for(let ce=1;ce<=h;ce++)T.push(0,I*ve,0),D.push(0,ve,0),R.push(.5,.5),L++;const X=L;for(let ce=0;ce<=h;ce++){const Me=ce/h*w+_,Oe=Math.cos(Me),Re=Math.sin(Me);he.x=ke*Re,he.y=I*ve,he.z=ke*Oe,T.push(he.x,he.y,he.z),D.push(0,ve,0),ae.x=.5*Oe+.5,ae.y=.5*Re*ve+.5,R.push(ae.x,ae.y),L++}for(let ce=0;ce<h;ce++){const dt=K+ce,Me=X+ce;!0===H?S.push(Me,Me+1,dt):S.push(Me+1,Me,dt),me+=3}M.addGroup(z,me,!0===H?1:2),z+=me}(function B(){const H=new J,K=new J;let ae=0;const he=(a-r)/c;for(let me=0;me<=p;me++){const ke=[],ve=me/p,X=ve*(a-r)+r;for(let ce=0;ce<=h;ce++){const dt=ce/h,Me=dt*w+_,Oe=Math.sin(Me),Re=Math.cos(Me);K.x=X*Oe,K.y=-ve*c+I,K.z=X*Re,T.push(K.x,K.y,K.z),H.set(Oe,he,Re).normalize(),D.push(H.x,H.y,H.z),R.push(dt,1-ve),ke.push(L++)}P.push(ke)}for(let me=0;me<h;me++)for(let ke=0;ke<p;ke++){const X=P[ke+1][me],ce=P[ke+1][me+1],dt=P[ke][me+1];S.push(P[ke][me],X,dt),S.push(X,ce,dt),ae+=6}M.addGroup(z,ae,0),z+=ae})(),!1===g&&(r>0&&j(!0),a>0&&j(!1)),this.setIndex(S),this.setAttribute("position",new en(T,3)),this.setAttribute("normal",new en(D,3)),this.setAttribute("uv",new en(R,2))}static fromJSON(r){return new Ql(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Xu extends Ql{constructor(r=1,a=1,c=8,h=1,p=!1,g=0,_=2*Math.PI){super(0,r,a,c,h,p,g,_),this.type="ConeGeometry",this.parameters={radius:r,height:a,radialSegments:c,heightSegments:h,openEnded:p,thetaStart:g,thetaLength:_}}static fromJSON(r){return new Xu(r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class xl extends Jt{constructor(r=[],a=[],c=1,h=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:a,radius:c,detail:h};const p=[],g=[];function w(B,j,H,K){const ae=K+1,he=[];for(let me=0;me<=ae;me++){he[me]=[];const ke=B.clone().lerp(H,me/ae),ve=j.clone().lerp(H,me/ae),X=ae-me;for(let ce=0;ce<=X;ce++)he[me][ce]=0===ce&&me===ae?ke:ke.clone().lerp(ve,ce/X)}for(let me=0;me<ae;me++)for(let ke=0;ke<2*(ae-me)-1;ke++){const ve=Math.floor(ke/2);ke%2==0?(D(he[me][ve+1]),D(he[me+1][ve]),D(he[me][ve])):(D(he[me][ve+1]),D(he[me+1][ve+1]),D(he[me+1][ve]))}}function D(B){p.push(B.x,B.y,B.z)}function R(B,j){const H=3*B;j.x=r[H+0],j.y=r[H+1],j.z=r[H+2]}function P(B,j,H,K){K<0&&1===B.x&&(g[j]=B.x-1),0===H.x&&0===H.z&&(g[j]=K/2/Math.PI+.5)}function I(B){return Math.atan2(B.z,-B.x)}function z(B){return Math.atan2(-B.y,Math.sqrt(B.x*B.x+B.z*B.z))}(function _(B){const j=new J,H=new J,K=new J;for(let ae=0;ae<a.length;ae+=3)R(a[ae+0],j),R(a[ae+1],H),R(a[ae+2],K),w(j,H,K,B)})(h),function M(B){const j=new J;for(let H=0;H<p.length;H+=3)j.x=p[H+0],j.y=p[H+1],j.z=p[H+2],j.normalize().multiplyScalar(B),p[H+0]=j.x,p[H+1]=j.y,p[H+2]=j.z}(c),function S(){const B=new J;for(let j=0;j<p.length;j+=3){B.x=p[j+0],B.y=p[j+1],B.z=p[j+2];const H=I(B)/2/Math.PI+.5,K=z(B)/Math.PI+.5;g.push(H,1-K)}(function L(){const B=new J,j=new J,H=new J,K=new J,ae=new Qe,he=new Qe,me=new Qe;for(let ke=0,ve=0;ke<p.length;ke+=9,ve+=6){B.set(p[ke+0],p[ke+1],p[ke+2]),j.set(p[ke+3],p[ke+4],p[ke+5]),H.set(p[ke+6],p[ke+7],p[ke+8]),ae.set(g[ve+0],g[ve+1]),he.set(g[ve+2],g[ve+3]),me.set(g[ve+4],g[ve+5]),K.copy(B).add(j).add(H).divideScalar(3);const X=I(K);P(ae,ve+0,B,X),P(he,ve+2,j,X),P(me,ve+4,H,X)}})(),function T(){for(let B=0;B<g.length;B+=6){const j=g[B+0],H=g[B+2],K=g[B+4],ae=Math.max(j,H,K),he=Math.min(j,H,K);ae>.9&&he<.1&&(j<.2&&(g[B+0]+=1),H<.2&&(g[B+2]+=1),K<.2&&(g[B+4]+=1))}}()}(),this.setAttribute("position",new en(p,3)),this.setAttribute("normal",new en(p.slice(),3)),this.setAttribute("uv",new en(g,2)),0===h?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(r){return new xl(r.vertices,r.indices,r.radius,r.details)}}class Yu extends xl{constructor(r=1,a=0){const c=(1+Math.sqrt(5))/2,h=1/c;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-h,-c,0,-h,c,0,h,-c,0,h,c,-h,-c,0,-h,c,0,h,-c,0,h,c,0,-c,0,-h,c,0,-h,-c,0,h,c,0,h],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],r,a),this.type="DodecahedronGeometry",this.parameters={radius:r,detail:a}}static fromJSON(r){return new Yu(r.radius,r.detail)}}const wg=new J,Mg=new J,To=new J,Eg=new Vr;class Rv extends Jt{constructor(r=null,a=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:r,thresholdAngle:a},null!==r){const h=Math.pow(10,4),p=Math.cos(zh*a),g=r.getIndex(),_=r.getAttribute("position"),w=g?g.count:_.count,M=[0,0,0],S=["a","b","c"],T=new Array(3),D={},R=[];for(let L=0;L<w;L+=3){g?(M[0]=g.getX(L),M[1]=g.getX(L+1),M[2]=g.getX(L+2)):(M[0]=L,M[1]=L+1,M[2]=L+2);const{a:P,b:I,c:z}=Eg;if(P.fromBufferAttribute(_,M[0]),I.fromBufferAttribute(_,M[1]),z.fromBufferAttribute(_,M[2]),Eg.getNormal(To),T[0]=`${Math.round(P.x*h)},${Math.round(P.y*h)},${Math.round(P.z*h)}`,T[1]=`${Math.round(I.x*h)},${Math.round(I.y*h)},${Math.round(I.z*h)}`,T[2]=`${Math.round(z.x*h)},${Math.round(z.y*h)},${Math.round(z.z*h)}`,T[0]!==T[1]&&T[1]!==T[2]&&T[2]!==T[0])for(let B=0;B<3;B++){const j=(B+1)%3,H=T[B],K=T[j],ae=Eg[S[B]],he=Eg[S[j]],me=`${H}_${K}`,ke=`${K}_${H}`;ke in D&&D[ke]?(To.dot(D[ke].normal)<=p&&(R.push(ae.x,ae.y,ae.z),R.push(he.x,he.y,he.z)),D[ke]=null):me in D||(D[me]={index0:M[B],index1:M[j],normal:To.clone()})}}for(const L in D)if(D[L]){const{index0:P,index1:I}=D[L];wg.fromBufferAttribute(_,P),Mg.fromBufferAttribute(_,I),R.push(wg.x,wg.y,wg.z),R.push(Mg.x,Mg.y,Mg.z)}this.setAttribute("position",new en(R,3))}}}class ec extends Jl{constructor(r){super(r),this.uuid=ha(),this.type="Shape",this.holes=[]}getPointsHoles(r){const a=[];for(let c=0,h=this.holes.length;c<h;c++)a[c]=this.holes[c].getPoints(r);return a}extractPoints(r){return{shape:this.getPoints(r),holes:this.getPointsHoles(r)}}copy(r){super.copy(r),this.holes=[];for(let a=0,c=r.holes.length;a<c;a++)this.holes.push(r.holes[a].clone());return this}toJSON(){const r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let a=0,c=this.holes.length;a<c;a++)r.holes.push(this.holes[a].toJSON());return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let a=0,c=r.holes.length;a<c;a++){const h=r.holes[a];this.holes.push((new Jl).fromJSON(h))}return this}}function Pv(d,r,a,c,h){let p,g;if(h===function jT(d,r,a,c){let h=0;for(let p=r,g=a-c;p<a;p+=c)h+=(d[g]-d[p])*(d[p+1]+d[g+1]),g=p;return h}(d,r,a,c)>0)for(p=r;p<a;p+=c)g=Mw(p,d[p],d[p+1],g);else for(p=a-c;p>=r;p-=c)g=Mw(p,d[p],d[p+1],g);return g&&Cg(g,g.next)&&(Bc(g),g=g.next),g}function Ku(d,r){if(!d)return d;r||(r=d);let c,a=d;do{if(c=!1,a.steiner||!Cg(a,a.next)&&0!==Ir(a.prev,a,a.next))a=a.next;else{if(Bc(a),a=r=a.prev,a===a.next)break;c=!0}}while(c||a!==r);return r}function Cp(d,r,a,c,h,p,g){if(!d)return;!g&&p&&function HT(d,r,a,c){let h=d;do{null===h.z&&(h.z=Sg(h.x,h.y,r,a,c)),h.prevZ=h.prev,h.nextZ=h.next,h=h.next}while(h!==d);h.prevZ.nextZ=null,h.prevZ=null,function bw(d){let r,a,c,h,p,g,_,w,M=1;do{for(a=d,d=null,p=null,g=0;a;){for(g++,c=a,_=0,r=0;r<M&&(_++,c=c.nextZ,c);r++);for(w=M;_>0||w>0&&c;)0!==_&&(0===w||!c||a.z<=c.z)?(h=a,a=a.nextZ,_--):(h=c,c=c.nextZ,w--),p?p.nextZ=h:d=h,h.prevZ=p,p=h;a=c}p.nextZ=null,M*=2}while(g>1)}(h)}(d,c,h,p);let w,M,_=d;for(;d.prev!==d.next;)if(w=d.prev,M=d.next,p?_w(d,c,h,p):Iv(d))r.push(w.i/a),r.push(d.i/a),r.push(M.i/a),Bc(d),d=M.next,_=M.next;else if((d=M)===_){g?1===g?Cp(d=BT(Ku(d),r,a),r,a,c,h,p,2):2===g&&kT(d,r,a,c,h,p):Cp(Ku(d),r,a,c,h,p,1);break}}function Iv(d){const r=d.prev,a=d,c=d.next;if(Ir(r,a,c)>=0)return!1;let h=d.next.next;for(;h!==d.prev;){if(Ao(r.x,r.y,a.x,a.y,c.x,c.y,h.x,h.y)&&Ir(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function _w(d,r,a,c){const h=d.prev,p=d,g=d.next;if(Ir(h,p,g)>=0)return!1;const M=h.x>p.x?h.x>g.x?h.x:g.x:p.x>g.x?p.x:g.x,S=h.y>p.y?h.y>g.y?h.y:g.y:p.y>g.y?p.y:g.y,T=Sg(h.x<p.x?h.x<g.x?h.x:g.x:p.x<g.x?p.x:g.x,h.y<p.y?h.y<g.y?h.y:g.y:p.y<g.y?p.y:g.y,r,a,c),D=Sg(M,S,r,a,c);let R=d.prevZ,L=d.nextZ;for(;R&&R.z>=T&&L&&L.z<=D;){if(R!==d.prev&&R!==d.next&&Ao(h.x,h.y,p.x,p.y,g.x,g.y,R.x,R.y)&&Ir(R.prev,R,R.next)>=0||(R=R.prevZ,L!==d.prev&&L!==d.next&&Ao(h.x,h.y,p.x,p.y,g.x,g.y,L.x,L.y)&&Ir(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;R&&R.z>=T;){if(R!==d.prev&&R!==d.next&&Ao(h.x,h.y,p.x,p.y,g.x,g.y,R.x,R.y)&&Ir(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;L&&L.z<=D;){if(L!==d.prev&&L!==d.next&&Ao(h.x,h.y,p.x,p.y,g.x,g.y,L.x,L.y)&&Ir(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function BT(d,r,a){let c=d;do{const h=c.prev,p=c.next.next;!Cg(h,p)&&WT(h,c,c.next,p)&&Ap(h,p)&&Ap(p,h)&&(r.push(h.i/a),r.push(c.i/a),r.push(p.i/a),Bc(c),Bc(c.next),c=d=p),c=c.next}while(c!==d);return Ku(c)}function kT(d,r,a,c,h,p){let g=d;do{let _=g.next.next;for(;_!==g.prev;){if(g.i!==_.i&&Lv(g,_)){let w=ww(g,_);return g=Ku(g,g.next),w=Ku(w,w.next),Cp(g,r,a,c,h,p),void Cp(w,r,a,c,h,p)}_=_.next}g=g.next}while(g!==d)}function vw(d,r){return d.x-r.x}function UT(d,r){if(r=function xw(d,r){let a=r;const c=d.x,h=d.y;let g,p=-1/0;do{if(h<=a.y&&h>=a.next.y&&a.next.y!==a.y){const D=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(D<=c&&D>p){if(p=D,D===c){if(h===a.y)return a;if(h===a.next.y)return a.next}g=a.x<a.next.x?a:a.next}}a=a.next}while(a!==r);if(!g)return null;if(c===p)return g;const _=g,w=g.x,M=g.y;let T,S=1/0;a=g;do{c>=a.x&&a.x>=w&&c!==a.x&&Ao(h<M?c:p,h,w,M,h<M?p:c,h,a.x,a.y)&&(T=Math.abs(h-a.y)/(c-a.x),Ap(a,d)&&(T<S||T===S&&(a.x>g.x||a.x===g.x&&zT(g,a)))&&(g=a,S=T)),a=a.next}while(a!==_);return g}(d,r),r){const a=ww(r,d);Ku(r,r.next),Ku(a,a.next)}}function zT(d,r){return Ir(d.prev,d,r.prev)<0&&Ir(r.next,d,d.next)<0}function Sg(d,r,a,c,h){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d=32767*(d-a)*h)|d<<8))|d<<4))|d<<2))|d<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function GT(d){let r=d,a=d;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==d);return a}function Ao(d,r,a,c,h,p,g,_){return(h-g)*(r-_)-(d-g)*(p-_)>=0&&(d-g)*(c-_)-(a-g)*(r-_)>=0&&(a-g)*(p-_)-(h-g)*(c-_)>=0}function Lv(d,r){return d.next.i!==r.i&&d.prev.i!==r.i&&!function qT(d,r){let a=d;do{if(a.i!==d.i&&a.next.i!==d.i&&a.i!==r.i&&a.next.i!==r.i&&WT(a,a.next,d,r))return!0;a=a.next}while(a!==d);return!1}(d,r)&&(Ap(d,r)&&Ap(r,d)&&function Fv(d,r){let a=d,c=!1;const h=(d.x+r.x)/2,p=(d.y+r.y)/2;do{a.y>p!=a.next.y>p&&a.next.y!==a.y&&h<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next}while(a!==d);return c}(d,r)&&(Ir(d.prev,d,r.prev)||Ir(d,r.prev,r))||Cg(d,r)&&Ir(d.prev,d,d.next)>0&&Ir(r.prev,r,r.next)>0)}function Ir(d,r,a){return(r.y-d.y)*(a.x-r.x)-(r.x-d.x)*(a.y-r.y)}function Cg(d,r){return d.x===r.x&&d.y===r.y}function WT(d,r,a,c){const h=Tg(Ir(d,r,a)),p=Tg(Ir(d,r,c)),g=Tg(Ir(a,c,d)),_=Tg(Ir(a,c,r));return!!(h!==p&&g!==_||0===h&&Tp(d,a,r)||0===p&&Tp(d,c,r)||0===g&&Tp(a,d,c)||0===_&&Tp(a,r,c))}function Tp(d,r,a){return r.x<=Math.max(d.x,a.x)&&r.x>=Math.min(d.x,a.x)&&r.y<=Math.max(d.y,a.y)&&r.y>=Math.min(d.y,a.y)}function Tg(d){return d>0?1:d<0?-1:0}function Ap(d,r){return Ir(d.prev,d,d.next)<0?Ir(d,r,d.next)>=0&&Ir(d,d.prev,r)>=0:Ir(d,r,d.prev)<0||Ir(d,d.next,r)<0}function ww(d,r){const a=new Dp(d.i,d.x,d.y),c=new Dp(r.i,r.x,r.y),h=d.next,p=r.prev;return d.next=r,r.prev=d,a.next=h,h.prev=a,c.next=a,a.prev=c,p.next=c,c.prev=p,c}function Mw(d,r,a,c){const h=new Dp(d,r,a);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function Bc(d){d.next.prev=d.prev,d.prev.next=d.next,d.prevZ&&(d.prevZ.nextZ=d.nextZ),d.nextZ&&(d.nextZ.prevZ=d.prevZ)}function Dp(d,r,a){this.i=d,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ma{static area(r){const a=r.length;let c=0;for(let h=a-1,p=0;p<a;h=p++)c+=r[h].x*r[p].y-r[p].x*r[h].y;return.5*c}static isClockWise(r){return Ma.area(r)<0}static triangulateShape(r,a){const c=[],h=[],p=[];Ag(r),Nv(c,r);let g=r.length;a.forEach(Ag);for(let w=0;w<a.length;w++)h.push(g),g+=a[w].length,Nv(c,a[w]);const _=function(d,r,a=2){const c=r&&r.length,h=c?r[0]*a:d.length;let p=Pv(d,0,h,a,!0);const g=[];if(!p||p.next===p.prev)return g;let _,w,M,S,T,D,R;if(c&&(p=function VT(d,r,a,c){const h=[];let p,g,_,w,M;for(p=0,g=r.length;p<g;p++)_=r[p]*c,w=p<g-1?r[p+1]*c:d.length,M=Pv(d,_,w,c,!1),M===M.next&&(M.steiner=!0),h.push(GT(M));for(h.sort(vw),p=0;p<h.length;p++)UT(h[p],a),a=Ku(a,a.next);return a}(d,r,p,a)),d.length>80*a){_=M=d[0],w=S=d[1];for(let L=a;L<h;L+=a)T=d[L],D=d[L+1],T<_&&(_=T),D<w&&(w=D),T>M&&(M=T),D>S&&(S=D);R=Math.max(M-_,S-w),R=0!==R?1/R:0}return Cp(p,g,a,_,w,R),g}(c,h);for(let w=0;w<_.length;w+=3)p.push(_.slice(w,w+3));return p}}function Ag(d){const r=d.length;r>2&&d[r-1].equals(d[0])&&d.pop()}function Nv(d,r){for(let a=0;a<r.length;a++)d.push(r[a].x),d.push(r[a].y)}class tc extends Jt{constructor(r=new ec([new Qe(.5,.5),new Qe(-.5,.5),new Qe(-.5,-.5),new Qe(.5,-.5)]),a={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:a},r=Array.isArray(r)?r:[r];const c=this,h=[],p=[];for(let _=0,w=r.length;_<w;_++)g(r[_]);function g(_){const w=[],M=void 0!==a.curveSegments?a.curveSegments:12,S=void 0!==a.steps?a.steps:1;let T=void 0!==a.depth?a.depth:1,D=void 0===a.bevelEnabled||a.bevelEnabled,R=void 0!==a.bevelThickness?a.bevelThickness:.2,L=void 0!==a.bevelSize?a.bevelSize:R-.1,P=void 0!==a.bevelOffset?a.bevelOffset:0,I=void 0!==a.bevelSegments?a.bevelSegments:3;const z=a.extrudePath,B=void 0!==a.UVGenerator?a.UVGenerator:tI;void 0!==a.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),T=a.amount);let j,K,ae,he,me,H=!1;z&&(j=z.getSpacedPoints(S),H=!0,D=!1,K=z.computeFrenetFrames(S,!1),ae=new J,he=new J,me=new J),D||(I=0,R=0,L=0,P=0);const ke=_.extractPoints(M);let ve=ke.shape;const X=ke.holes;if(!Ma.isClockWise(ve)){ve=ve.reverse();for(let $e=0,it=X.length;$e<it;$e++){const vt=X[$e];Ma.isClockWise(vt)&&(X[$e]=vt.reverse())}}const dt=Ma.triangulateShape(ve,X),Me=ve;for(let $e=0,it=X.length;$e<it;$e++)ve=ve.concat(X[$e]);function Oe($e,it,vt){return it||console.error("THREE.ExtrudeGeometry: vec does not exist"),it.clone().multiplyScalar(vt).add($e)}const Re=ve.length,Ge=dt.length;function xe($e,it,vt){let an,Ht,jn;const Sn=$e.x-it.x,vn=$e.y-it.y,Mr=vt.x-$e.x,rr=vt.y-$e.y,ne=Sn*Sn+vn*vn;if(Math.abs(Sn*rr-vn*Mr)>Number.EPSILON){const ze=Math.sqrt(ne),ft=Math.sqrt(Mr*Mr+rr*rr),Gt=it.x-vn/ze,St=it.y+Sn/ze,Kn=((vt.x-rr/ft-Gt)*rr-(vt.y+Mr/ft-St)*Mr)/(Sn*rr-vn*Mr);an=Gt+Sn*Kn-$e.x,Ht=St+vn*Kn-$e.y;const pi=an*an+Ht*Ht;if(pi<=2)return new Qe(an,Ht);jn=Math.sqrt(pi/2)}else{let ze=!1;Sn>Number.EPSILON?Mr>Number.EPSILON&&(ze=!0):Sn<-Number.EPSILON?Mr<-Number.EPSILON&&(ze=!0):Math.sign(vn)===Math.sign(rr)&&(ze=!0),ze?(an=-vn,Ht=Sn,jn=Math.sqrt(ne)):(an=Sn,Ht=vn,jn=Math.sqrt(ne/2))}return new Qe(an/jn,Ht/jn)}const st=[];for(let $e=0,it=Me.length,vt=it-1,an=$e+1;$e<it;$e++,vt++,an++)vt===it&&(vt=0),an===it&&(an=0),st[$e]=xe(Me[$e],Me[vt],Me[an]);const ut=[];let xt,pt=st.concat();for(let $e=0,it=X.length;$e<it;$e++){const vt=X[$e];xt=[];for(let an=0,Ht=vt.length,jn=Ht-1,Sn=an+1;an<Ht;an++,jn++,Sn++)jn===Ht&&(jn=0),Sn===Ht&&(Sn=0),xt[an]=xe(vt[an],vt[jn],vt[Sn]);ut.push(xt),pt=pt.concat(xt)}for(let $e=0;$e<I;$e++){const it=$e/I,vt=R*Math.cos(it*Math.PI/2),an=L*Math.sin(it*Math.PI/2)+P;for(let Ht=0,jn=Me.length;Ht<jn;Ht++){const Sn=Oe(Me[Ht],st[Ht],an);$i(Sn.x,Sn.y,-vt)}for(let Ht=0,jn=X.length;Ht<jn;Ht++){const Sn=X[Ht];xt=ut[Ht];for(let vn=0,Mr=Sn.length;vn<Mr;vn++){const rr=Oe(Sn[vn],xt[vn],an);$i(rr.x,rr.y,-vt)}}}const gn=L+P;for(let $e=0;$e<Re;$e++){const it=D?Oe(ve[$e],pt[$e],gn):ve[$e];H?(he.copy(K.normals[0]).multiplyScalar(it.x),ae.copy(K.binormals[0]).multiplyScalar(it.y),me.copy(j[0]).add(he).add(ae),$i(me.x,me.y,me.z)):$i(it.x,it.y,0)}for(let $e=1;$e<=S;$e++)for(let it=0;it<Re;it++){const vt=D?Oe(ve[it],pt[it],gn):ve[it];H?(he.copy(K.normals[$e]).multiplyScalar(vt.x),ae.copy(K.binormals[$e]).multiplyScalar(vt.y),me.copy(j[$e]).add(he).add(ae),$i(me.x,me.y,me.z)):$i(vt.x,vt.y,T/S*$e)}for(let $e=I-1;$e>=0;$e--){const it=$e/I,vt=R*Math.cos(it*Math.PI/2),an=L*Math.sin(it*Math.PI/2)+P;for(let Ht=0,jn=Me.length;Ht<jn;Ht++){const Sn=Oe(Me[Ht],st[Ht],an);$i(Sn.x,Sn.y,T+vt)}for(let Ht=0,jn=X.length;Ht<jn;Ht++){const Sn=X[Ht];xt=ut[Ht];for(let vn=0,Mr=Sn.length;vn<Mr;vn++){const rr=Oe(Sn[vn],xt[vn],an);H?$i(rr.x,rr.y+j[S-1].y,j[S-1].x+vt):$i(rr.x,rr.y,T+vt)}}}function we($e,it){let vt=$e.length;for(;--vt>=0;){const an=vt;let Ht=vt-1;Ht<0&&(Ht=$e.length-1);for(let jn=0,Sn=S+2*I;jn<Sn;jn++){const vn=Re*jn,Mr=Re*(jn+1);ei(it+an+vn,it+Ht+vn,it+Ht+Mr,it+an+Mr)}}}function $i($e,it,vt){w.push($e),w.push(it),w.push(vt)}function Qn($e,it,vt){Dt($e),Dt(it),Dt(vt);const an=h.length/3,Ht=B.generateTopUV(c,h,an-3,an-2,an-1);ci(Ht[0]),ci(Ht[1]),ci(Ht[2])}function ei($e,it,vt,an){Dt($e),Dt(it),Dt(an),Dt(it),Dt(vt),Dt(an);const Ht=h.length/3,jn=B.generateSideWallUV(c,h,Ht-6,Ht-3,Ht-2,Ht-1);ci(jn[0]),ci(jn[1]),ci(jn[3]),ci(jn[1]),ci(jn[2]),ci(jn[3])}function Dt($e){h.push(w[3*$e+0]),h.push(w[3*$e+1]),h.push(w[3*$e+2])}function ci($e){p.push($e.x),p.push($e.y)}(function li(){const $e=h.length/3;if(D){let it=0,vt=Re*it;for(let an=0;an<Ge;an++){const Ht=dt[an];Qn(Ht[2]+vt,Ht[1]+vt,Ht[0]+vt)}it=S+2*I,vt=Re*it;for(let an=0;an<Ge;an++){const Ht=dt[an];Qn(Ht[0]+vt,Ht[1]+vt,Ht[2]+vt)}}else{for(let it=0;it<Ge;it++){const vt=dt[it];Qn(vt[2],vt[1],vt[0])}for(let it=0;it<Ge;it++){const vt=dt[it];Qn(vt[0]+Re*S,vt[1]+Re*S,vt[2]+Re*S)}}c.addGroup($e,h.length/3-$e,0)})(),function Vn(){const $e=h.length/3;let it=0;we(Me,it),it+=Me.length;for(let vt=0,an=X.length;vt<an;vt++){const Ht=X[vt];we(Ht,it),it+=Ht.length}c.addGroup($e,h.length/3-$e,1)}()}this.setAttribute("position",new en(h,3)),this.setAttribute("uv",new en(p,2)),this.computeVertexNormals()}toJSON(){const r=super.toJSON();return function Ov(d,r,a){if(a.shapes=[],Array.isArray(d))for(let c=0,h=d.length;c<h;c++)a.shapes.push(d[c].uuid);else a.shapes.push(d.uuid);return void 0!==r.extrudePath&&(a.options.extrudePath=r.extrudePath.toJSON()),a}(this.parameters.shapes,this.parameters.options,r)}static fromJSON(r,a){const c=[];for(let p=0,g=r.shapes.length;p<g;p++)c.push(a[r.shapes[p]]);const h=r.options.extrudePath;return void 0!==h&&(r.options.extrudePath=(new Ep[h.type]).fromJSON(h)),new tc(c,r.options)}}const tI={generateTopUV:function(d,r,a,c,h){const _=r[3*c],w=r[3*c+1],M=r[3*h],S=r[3*h+1];return[new Qe(r[3*a],r[3*a+1]),new Qe(_,w),new Qe(M,S)]},generateSideWallUV:function(d,r,a,c,h,p){const g=r[3*a],_=r[3*a+1],w=r[3*a+2],M=r[3*c],S=r[3*c+1],T=r[3*c+2],D=r[3*h],R=r[3*h+1],L=r[3*h+2],P=r[3*p],I=r[3*p+1],z=r[3*p+2];return Math.abs(_-S)<Math.abs(g-M)?[new Qe(g,1-w),new Qe(M,1-T),new Qe(D,1-L),new Qe(P,1-z)]:[new Qe(_,1-w),new Qe(S,1-T),new Qe(R,1-L),new Qe(I,1-z)]}};class Rp extends xl{constructor(r=1,a=0){const c=(1+Math.sqrt(5))/2;super([-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,a),this.type="IcosahedronGeometry",this.parameters={radius:r,detail:a}}static fromJSON(r){return new Rp(r.radius,r.detail)}}class $u extends xl{constructor(r=1,a=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,a),this.type="OctahedronGeometry",this.parameters={radius:r,detail:a}}static fromJSON(r){return new $u(r.radius,r.detail)}}class Zu extends Jt{constructor(r=.5,a=1,c=8,h=1,p=0,g=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:r,outerRadius:a,thetaSegments:c,phiSegments:h,thetaStart:p,thetaLength:g},c=Math.max(3,c);const _=[],w=[],M=[],S=[];let T=r;const D=(a-r)/(h=Math.max(1,h)),R=new J,L=new Qe;for(let P=0;P<=h;P++){for(let I=0;I<=c;I++){const z=p+I/c*g;R.x=T*Math.cos(z),R.y=T*Math.sin(z),w.push(R.x,R.y,R.z),M.push(0,0,1),L.x=(R.x/a+1)/2,L.y=(R.y/a+1)/2,S.push(L.x,L.y)}T+=D}for(let P=0;P<h;P++){const I=P*(c+1);for(let z=0;z<c;z++){const B=z+I,H=B+c+1,K=B+c+2,ae=B+1;_.push(B,H,ae),_.push(H,K,ae)}}this.setIndex(_),this.setAttribute("position",new en(w,3)),this.setAttribute("normal",new en(M,3)),this.setAttribute("uv",new en(S,2))}static fromJSON(r){return new Zu(r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength)}}class kc extends Jt{constructor(r=new ec([new Qe(0,.5),new Qe(-.5,-.5),new Qe(.5,-.5)]),a=12){super(),this.type="ShapeGeometry",this.parameters={shapes:r,curveSegments:a};const c=[],h=[],p=[],g=[];let _=0,w=0;if(!1===Array.isArray(r))M(r);else for(let S=0;S<r.length;S++)M(r[S]),this.addGroup(_,w,S),_+=w,w=0;function M(S){const T=h.length/3,D=S.extractPoints(a);let R=D.shape;const L=D.holes;!1===Ma.isClockWise(R)&&(R=R.reverse());for(let I=0,z=L.length;I<z;I++){const B=L[I];!0===Ma.isClockWise(B)&&(L[I]=B.reverse())}const P=Ma.triangulateShape(R,L);for(let I=0,z=L.length;I<z;I++)R=R.concat(L[I]);for(let I=0,z=R.length;I<z;I++){const B=R[I];h.push(B.x,B.y,0),p.push(0,0,1),g.push(B.x,B.y)}for(let I=0,z=P.length;I<z;I++){const B=P[I];c.push(B[0]+T,B[1]+T,B[2]+T),w+=3}}this.setIndex(c),this.setAttribute("position",new en(h,3)),this.setAttribute("normal",new en(p,3)),this.setAttribute("uv",new en(g,2))}toJSON(){const r=super.toJSON();return function Ew(d,r){if(r.shapes=[],Array.isArray(d))for(let a=0,c=d.length;a<c;a++)r.shapes.push(d[a].uuid);else r.shapes.push(d.uuid);return r}(this.parameters.shapes,r)}static fromJSON(r,a){const c=[];for(let h=0,p=r.shapes.length;h<p;h++)c.push(a[r.shapes[h]]);return new kc(c,r.curveSegments)}}class Vc extends Jt{constructor(r=1,a=32,c=16,h=0,p=2*Math.PI,g=0,_=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:a,heightSegments:c,phiStart:h,phiLength:p,thetaStart:g,thetaLength:_},a=Math.max(3,Math.floor(a)),c=Math.max(2,Math.floor(c));const w=Math.min(g+_,Math.PI);let M=0;const S=[],T=new J,D=new J,R=[],L=[],P=[],I=[];for(let z=0;z<=c;z++){const B=[],j=z/c;let H=0;0==z&&0==g?H=.5/a:z==c&&w==Math.PI&&(H=-.5/a);for(let K=0;K<=a;K++){const ae=K/a;T.x=-r*Math.cos(h+ae*p)*Math.sin(g+j*_),T.y=r*Math.cos(g+j*_),T.z=r*Math.sin(h+ae*p)*Math.sin(g+j*_),L.push(T.x,T.y,T.z),D.copy(T).normalize(),P.push(D.x,D.y,D.z),I.push(ae+H,1-j),B.push(M++)}S.push(B)}for(let z=0;z<c;z++)for(let B=0;B<a;B++){const j=S[z][B+1],H=S[z][B],K=S[z+1][B],ae=S[z+1][B+1];(0!==z||g>0)&&R.push(j,H,ae),(z!==c-1||w<Math.PI)&&R.push(H,K,ae)}this.setIndex(R),this.setAttribute("position",new en(L,3)),this.setAttribute("normal",new en(P,3)),this.setAttribute("uv",new en(I,2))}static fromJSON(r){return new Vc(r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength)}}class Ju extends xl{constructor(r=1,a=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,a),this.type="TetrahedronGeometry",this.parameters={radius:r,detail:a}}static fromJSON(r){return new Ju(r.radius,r.detail)}}class ko extends Jt{constructor(r=1,a=.4,c=8,h=6,p=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:a,radialSegments:c,tubularSegments:h,arc:p},c=Math.floor(c),h=Math.floor(h);const g=[],_=[],w=[],M=[],S=new J,T=new J,D=new J;for(let R=0;R<=c;R++)for(let L=0;L<=h;L++){const P=L/h*p,I=R/c*Math.PI*2;T.x=(r+a*Math.cos(I))*Math.cos(P),T.y=(r+a*Math.cos(I))*Math.sin(P),T.z=a*Math.sin(I),_.push(T.x,T.y,T.z),S.x=r*Math.cos(P),S.y=r*Math.sin(P),D.subVectors(T,S).normalize(),w.push(D.x,D.y,D.z),M.push(L/h),M.push(R/c)}for(let R=1;R<=c;R++)for(let L=1;L<=h;L++){const I=(h+1)*(R-1)+L-1,z=(h+1)*(R-1)+L,B=(h+1)*R+L;g.push((h+1)*R+L-1,I,B),g.push(I,z,B)}this.setIndex(g),this.setAttribute("position",new en(_,3)),this.setAttribute("normal",new en(w,3)),this.setAttribute("uv",new en(M,2))}static fromJSON(r){return new ko(r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc)}}class nc extends Jt{constructor(r=1,a=.4,c=64,h=8,p=2,g=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:r,tube:a,tubularSegments:c,radialSegments:h,p,q:g},c=Math.floor(c),h=Math.floor(h);const _=[],w=[],M=[],S=[],T=new J,D=new J,R=new J,L=new J,P=new J,I=new J,z=new J;for(let j=0;j<=c;++j){const H=j/c*p*Math.PI*2;B(H,p,g,r,R),B(H+.01,p,g,r,L),I.subVectors(L,R),z.addVectors(L,R),P.crossVectors(I,z),z.crossVectors(P,I),P.normalize(),z.normalize();for(let K=0;K<=h;++K){const ae=K/h*Math.PI*2,he=-a*Math.cos(ae),me=a*Math.sin(ae);T.x=R.x+(he*z.x+me*P.x),T.y=R.y+(he*z.y+me*P.y),T.z=R.z+(he*z.z+me*P.z),w.push(T.x,T.y,T.z),D.subVectors(T,R).normalize(),M.push(D.x,D.y,D.z),S.push(j/c),S.push(K/h)}}for(let j=1;j<=c;j++)for(let H=1;H<=h;H++){const ae=(h+1)*j+(H-1),he=(h+1)*j+H,me=(h+1)*(j-1)+H;_.push((h+1)*(j-1)+(H-1),ae,me),_.push(ae,he,me)}function B(j,H,K,ae,he){const me=Math.cos(j),ke=Math.sin(j),ve=K/H*j,X=Math.cos(ve);he.x=ae*(2+X)*.5*me,he.y=ae*(2+X)*ke*.5,he.z=ae*Math.sin(ve)*.5}this.setIndex(_),this.setAttribute("position",new en(w,3)),this.setAttribute("normal",new en(M,3)),this.setAttribute("uv",new en(S,2))}static fromJSON(r){return new nc(r.radius,r.tube,r.tubularSegments,r.radialSegments,r.p,r.q)}}class Sd extends Jt{constructor(r=new Mp(new J(-1,-1,0),new J(-1,1,0),new J(1,1,0)),a=64,c=1,h=8,p=!1){super(),this.type="TubeGeometry",this.parameters={path:r,tubularSegments:a,radius:c,radialSegments:h,closed:p};const g=r.computeFrenetFrames(a,p);this.tangents=g.tangents,this.normals=g.normals,this.binormals=g.binormals;const _=new J,w=new J,M=new Qe;let S=new J;const T=[],D=[],R=[],L=[];function I(j){S=r.getPointAt(j/a,S);const H=g.normals[j],K=g.binormals[j];for(let ae=0;ae<=h;ae++){const he=ae/h*Math.PI*2,me=Math.sin(he),ke=-Math.cos(he);w.x=ke*H.x+me*K.x,w.y=ke*H.y+me*K.y,w.z=ke*H.z+me*K.z,w.normalize(),D.push(w.x,w.y,w.z),_.x=S.x+c*w.x,_.y=S.y+c*w.y,_.z=S.z+c*w.z,T.push(_.x,_.y,_.z)}}(function P(){for(let j=0;j<a;j++)I(j);I(!1===p?a:0),function B(){for(let j=0;j<=a;j++)for(let H=0;H<=h;H++)M.x=j/a,M.y=H/h,R.push(M.x,M.y)}(),function z(){for(let j=1;j<=a;j++)for(let H=1;H<=h;H++){const ae=(h+1)*j+(H-1),he=(h+1)*j+H,me=(h+1)*(j-1)+H;L.push((h+1)*(j-1)+(H-1),ae,me),L.push(ae,he,me)}}()})(),this.setIndex(L),this.setAttribute("position",new en(T,3)),this.setAttribute("normal",new en(D,3)),this.setAttribute("uv",new en(R,2))}toJSON(){const r=super.toJSON();return r.path=this.parameters.path.toJSON(),r}static fromJSON(r){return new Sd((new Ep[r.path.type]).fromJSON(r.path),r.tubularSegments,r.radius,r.radialSegments,r.closed)}}class Bv extends Jt{constructor(r=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:r},null!==r){const a=[],c=new Set,h=new J,p=new J;if(null!==r.index){const g=r.attributes.position,_=r.index;let w=r.groups;0===w.length&&(w=[{start:0,count:_.count,materialIndex:0}]);for(let M=0,S=w.length;M<S;++M){const T=w[M],D=T.start;for(let L=D,P=D+T.count;L<P;L+=3)for(let I=0;I<3;I++){const z=_.getX(L+I),B=_.getX(L+(I+1)%3);h.fromBufferAttribute(g,z),p.fromBufferAttribute(g,B),!0===XT(h,p,c)&&(a.push(h.x,h.y,h.z),a.push(p.x,p.y,p.z))}}}else{const g=r.attributes.position;for(let _=0,w=g.count/3;_<w;_++)for(let M=0;M<3;M++){const T=3*_+(M+1)%3;h.fromBufferAttribute(g,3*_+M),p.fromBufferAttribute(g,T),!0===XT(h,p,c)&&(a.push(h.x,h.y,h.z),a.push(p.x,p.y,p.z))}}this.setAttribute("position",new en(a,3))}}}function XT(d,r,a){const c=`${d.x},${d.y},${d.z}-${r.x},${r.y},${r.z}`,h=`${r.x},${r.y},${r.z}-${d.x},${d.y},${d.z}`;return!0!==a.has(c)&&!0!==a.has(h)&&(a.add(c),a.add(h),!0)}var Dg=Object.freeze({__proto__:null,BoxGeometry:Wl,BoxBufferGeometry:Wl,CapsuleGeometry:ju,CapsuleBufferGeometry:ju,CircleGeometry:Sp,CircleBufferGeometry:Sp,ConeGeometry:Xu,ConeBufferGeometry:Xu,CylinderGeometry:Ql,CylinderBufferGeometry:Ql,DodecahedronGeometry:Yu,DodecahedronBufferGeometry:Yu,EdgesGeometry:Rv,ExtrudeGeometry:tc,ExtrudeBufferGeometry:tc,IcosahedronGeometry:Rp,IcosahedronBufferGeometry:Rp,LatheGeometry:qu,LatheBufferGeometry:qu,OctahedronGeometry:$u,OctahedronBufferGeometry:$u,PlaneGeometry:Iu,PlaneBufferGeometry:Iu,PolyhedronGeometry:xl,PolyhedronBufferGeometry:xl,RingGeometry:Zu,RingBufferGeometry:Zu,ShapeGeometry:kc,ShapeBufferGeometry:kc,SphereGeometry:Vc,SphereBufferGeometry:Vc,TetrahedronGeometry:Ju,TetrahedronBufferGeometry:Ju,TorusGeometry:ko,TorusBufferGeometry:ko,TorusKnotGeometry:nc,TorusKnotBufferGeometry:nc,TubeGeometry:Sd,TubeBufferGeometry:Sd,WireframeGeometry:Bv});class Rg extends Zt{constructor(r){super(),this.type="ShadowMaterial",this.color=new Tt(0),this.transparent=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this}}Rg.prototype.isShadowMaterial=!0;class Pp extends va{constructor(r){super(r),this.type="RawShaderMaterial"}}Pp.prototype.isRawShaderMaterial=!0;class Uc extends Zt{constructor(r){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Tt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.defines={STANDARD:""},this.color.copy(r.color),this.roughness=r.roughness,this.metalness=r.metalness,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.roughnessMap=r.roughnessMap,this.metalnessMap=r.metalnessMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapIntensity=r.envMapIntensity,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this}}Uc.prototype.isMeshStandardMaterial=!0;class kv extends Uc{constructor(r){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ns(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(a){this.ior=(1+.4*a)/(1-.4*a)}}),this.sheenColor=new Tt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Tt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Tt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(r)}get sheen(){return this._sheen}set sheen(r){this._sheen>0!=r>0&&this.version++,this._sheen=r}get clearcoat(){return this._clearcoat}set clearcoat(r){this._clearcoat>0!=r>0&&this.version++,this._clearcoat=r}get transmission(){return this._transmission}set transmission(r){this._transmission>0!=r>0&&this.version++,this._transmission=r}copy(r){return super.copy(r),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=r.clearcoat,this.clearcoatMap=r.clearcoatMap,this.clearcoatRoughness=r.clearcoatRoughness,this.clearcoatRoughnessMap=r.clearcoatRoughnessMap,this.clearcoatNormalMap=r.clearcoatNormalMap,this.clearcoatNormalScale.copy(r.clearcoatNormalScale),this.ior=r.ior,this.sheen=r.sheen,this.sheenColor.copy(r.sheenColor),this.sheenColorMap=r.sheenColorMap,this.sheenRoughness=r.sheenRoughness,this.sheenRoughnessMap=r.sheenRoughnessMap,this.transmission=r.transmission,this.transmissionMap=r.transmissionMap,this.thickness=r.thickness,this.thicknessMap=r.thicknessMap,this.attenuationDistance=r.attenuationDistance,this.attenuationColor.copy(r.attenuationColor),this.specularIntensity=r.specularIntensity,this.specularIntensityMap=r.specularIntensityMap,this.specularColor.copy(r.specularColor),this.specularColorMap=r.specularColorMap,this}}kv.prototype.isMeshPhysicalMaterial=!0;class Ip extends Zt{constructor(r){super(),this.type="MeshPhongMaterial",this.color=new Tt(16777215),this.specular=new Tt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this}}Ip.prototype.isMeshPhongMaterial=!0;class Pg extends Zt{constructor(r){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Tt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.gradientMap=r.gradientMap,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this}}Pg.prototype.isMeshToonMaterial=!0;class Ig extends Zt{constructor(r){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.flatShading=r.flatShading,this}}Ig.prototype.isMeshNormalMaterial=!0;class Lg extends Zt{constructor(r){super(),this.type="MeshLambertMaterial",this.color=new Tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this}}Lg.prototype.isMeshLambertMaterial=!0;class Vv extends Zt{constructor(r){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Tt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.defines={MATCAP:""},this.color.copy(r.color),this.matcap=r.matcap,this.map=r.map,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.flatShading=r.flatShading,this}}Vv.prototype.isMeshMatcapMaterial=!0;class Lp extends Ps{constructor(r){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(r)}copy(r){return super.copy(r),this.scale=r.scale,this.dashSize=r.dashSize,this.gapSize=r.gapSize,this}}Lp.prototype.isLineDashedMaterial=!0;const YT={ShadowMaterial:Rg,SpriteMaterial:hp,RawShaderMaterial:Pp,ShaderMaterial:va,PointsMaterial:$l,MeshPhysicalMaterial:kv,MeshStandardMaterial:Uc,MeshPhongMaterial:Ip,MeshToonMaterial:Pg,MeshNormalMaterial:Ig,MeshLambertMaterial:Lg,MeshDepthMaterial:ku,MeshDistanceMaterial:pg,MeshBasicMaterial:ul,MeshMatcapMaterial:Vv,LineDashedMaterial:Lp,LineBasicMaterial:Ps,Material:Zt};Zt.fromType=function(d){return new YT[d]};const vr={arraySlice:function(d,r,a){return vr.isTypedArray(d)?new d.constructor(d.subarray(r,void 0!==a?a:d.length)):d.slice(r,a)},convertArray:function(d,r,a){return!d||!a&&d.constructor===r?d:"number"==typeof r.BYTES_PER_ELEMENT?new r(d):Array.prototype.slice.call(d)},isTypedArray:function(d){return ArrayBuffer.isView(d)&&!(d instanceof DataView)},getKeyframeOrder:function(d){const a=d.length,c=new Array(a);for(let h=0;h!==a;++h)c[h]=h;return c.sort(function r(h,p){return d[h]-d[p]}),c},sortedArray:function(d,r,a){const c=d.length,h=new d.constructor(c);for(let p=0,g=0;g!==c;++p){const _=a[p]*r;for(let w=0;w!==r;++w)h[g++]=d[_+w]}return h},flattenJSON:function(d,r,a,c){let h=1,p=d[0];for(;void 0!==p&&void 0===p[c];)p=d[h++];if(void 0===p)return;let g=p[c];if(void 0!==g)if(Array.isArray(g))do{g=p[c],void 0!==g&&(r.push(p.time),a.push.apply(a,g)),p=d[h++]}while(void 0!==p);else if(void 0!==g.toArray)do{g=p[c],void 0!==g&&(r.push(p.time),g.toArray(a,a.length)),p=d[h++]}while(void 0!==p);else do{g=p[c],void 0!==g&&(r.push(p.time),a.push(g)),p=d[h++]}while(void 0!==p)},subclip:function(d,r,a,c,h=30){const p=d.clone();p.name=r;const g=[];for(let w=0;w<p.tracks.length;++w){const M=p.tracks[w],S=M.getValueSize(),T=[],D=[];for(let R=0;R<M.times.length;++R){const L=M.times[R]*h;if(!(L<a||L>=c)){T.push(M.times[R]);for(let P=0;P<S;++P)D.push(M.values[R*S+P])}}0!==T.length&&(M.times=vr.convertArray(T,M.times.constructor),M.values=vr.convertArray(D,M.values.constructor),g.push(M))}p.tracks=g;let _=1/0;for(let w=0;w<p.tracks.length;++w)_>p.tracks[w].times[0]&&(_=p.tracks[w].times[0]);for(let w=0;w<p.tracks.length;++w)p.tracks[w].shift(-1*_);return p.resetDuration(),p},makeClipAdditive:function(d,r=0,a=d,c=30){c<=0&&(c=30);const h=a.tracks.length,p=r/c;for(let g=0;g<h;++g){const _=a.tracks[g],w=_.ValueTypeName;if("bool"===w||"string"===w)continue;const M=d.tracks.find(function(z){return z.name===_.name&&z.ValueTypeName===w});if(void 0===M)continue;let S=0;const T=_.getValueSize();_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(S=T/3);let D=0;const R=M.getValueSize();M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(D=R/3);const L=_.times.length-1;let P;if(p<=_.times[0])P=vr.arraySlice(_.values,S,T-S);else if(p>=_.times[L]){const z=L*T+S;P=vr.arraySlice(_.values,z,z+T-S)}else{const z=_.createInterpolant(),B=S,j=T-S;z.evaluate(p),P=vr.arraySlice(z.resultBuffer,B,j)}"quaternion"===w&&(new Zs).fromArray(P).normalize().conjugate().toArray(P);const I=M.times.length;for(let z=0;z<I;++z){const B=z*R+D;if("quaternion"===w)Zs.multiplyQuaternionsFlat(M.values,B,P,0,M.values,B);else{const j=R-2*D;for(let H=0;H<j;++H)M.values[B+H]-=P[H]}}}return d.blendMode=2501,d}};class bl{constructor(r,a,c,h){this.parameterPositions=r,this._cachedIndex=0,this.resultBuffer=void 0!==h?h:new a.constructor(c),this.sampleValues=a,this.valueSize=c,this.settings=null,this.DefaultSettings_={}}evaluate(r){const a=this.parameterPositions;let c=this._cachedIndex,h=a[c],p=a[c-1];e:{t:{let g;n:{i:if(!(r<h)){for(let _=c+2;;){if(void 0===h){if(r<p)break i;return c=a.length,this._cachedIndex=c,this.afterEnd_(c-1,r,p)}if(c===_)break;if(p=h,h=a[++c],r<h)break t}g=a.length;break n}if(r>=p)break e;{const _=a[1];r<_&&(c=2,p=_);for(let w=c-2;;){if(void 0===p)return this._cachedIndex=0,this.beforeStart_(0,r,h);if(c===w)break;if(h=p,p=a[--c-1],r>=p)break t}g=c,c=0}}for(;c<g;){const _=c+g>>>1;r<a[_]?g=_:c=_+1}if(h=a[c],p=a[c-1],void 0===p)return this._cachedIndex=0,this.beforeStart_(0,r,h);if(void 0===h)return c=a.length,this._cachedIndex=c,this.afterEnd_(c-1,p,r)}this._cachedIndex=c,this.intervalChanged_(c,p,h)}return this.interpolate_(c,p,r,h)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(r){const a=this.resultBuffer,c=this.sampleValues,h=this.valueSize,p=r*h;for(let g=0;g!==h;++g)a[g]=c[p+g];return a}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}bl.prototype.beforeStart_=bl.prototype.copySampleValue_,bl.prototype.afterEnd_=bl.prototype.copySampleValue_;class Qu extends bl{constructor(r,a,c,h){super(r,a,c,h),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:bu,endingEnd:bu}}intervalChanged_(r,a,c){const h=this.parameterPositions;let p=r-2,g=r+1,_=h[p],w=h[g];if(void 0===_)switch(this.getSettings_().endingStart){case kh:p=r,_=2*a-c;break;case km:p=h.length-2,_=a+h[p]-h[p+1];break;default:p=r,_=c}if(void 0===w)switch(this.getSettings_().endingEnd){case kh:g=r,w=2*c-a;break;case km:g=1,w=c+h[1]-h[0];break;default:g=r-1,w=a}const M=.5*(c-a),S=this.valueSize;this._weightPrev=M/(a-_),this._weightNext=M/(w-c),this._offsetPrev=p*S,this._offsetNext=g*S}interpolate_(r,a,c,h){const p=this.resultBuffer,g=this.sampleValues,_=this.valueSize,w=r*_,M=w-_,S=this._offsetPrev,T=this._offsetNext,D=this._weightPrev,R=this._weightNext,L=(c-a)/(h-a),P=L*L,I=P*L,z=-D*I+2*D*P-D*L,B=(1+D)*I+(-1.5-2*D)*P+(-.5+D)*L+1,j=(-1-R)*I+(1.5+R)*P+.5*L,H=R*I-R*P;for(let K=0;K!==_;++K)p[K]=z*g[S+K]+B*g[M+K]+j*g[w+K]+H*g[T+K];return p}}class Fg extends bl{constructor(r,a,c,h){super(r,a,c,h)}interpolate_(r,a,c,h){const p=this.resultBuffer,g=this.sampleValues,_=this.valueSize,w=r*_,M=w-_,S=(c-a)/(h-a),T=1-S;for(let D=0;D!==_;++D)p[D]=g[M+D]*T+g[w+D]*S;return p}}class Sw extends bl{constructor(r,a,c,h){super(r,a,c,h)}interpolate_(r){return this.copySampleValue_(r-1)}}class ja{constructor(r,a,c,h){if(void 0===r)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===a||0===a.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+r);this.name=r,this.times=vr.convertArray(a,this.TimeBufferType),this.values=vr.convertArray(c,this.ValueBufferType),this.setInterpolation(h||this.DefaultInterpolation)}static toJSON(r){const a=r.constructor;let c;if(a.toJSON!==this.toJSON)c=a.toJSON(r);else{c={name:r.name,times:vr.convertArray(r.times,Array),values:vr.convertArray(r.values,Array)};const h=r.getInterpolation();h!==r.DefaultInterpolation&&(c.interpolation=h)}return c.type=r.ValueTypeName,c}InterpolantFactoryMethodDiscrete(r){return new Sw(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodLinear(r){return new Fg(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodSmooth(r){return new Qu(this.times,this.values,this.getValueSize(),r)}setInterpolation(r){let a;switch(r){case xu:a=this.InterpolantFactoryMethodDiscrete;break;case Mn:a=this.InterpolantFactoryMethodLinear;break;case 2302:a=this.InterpolantFactoryMethodSmooth}if(void 0===a){const c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(r===this.DefaultInterpolation)throw new Error(c);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",c),this}return this.createInterpolant=a,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return xu;case this.InterpolantFactoryMethodLinear:return Mn;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(r){if(0!==r){const a=this.times;for(let c=0,h=a.length;c!==h;++c)a[c]+=r}return this}scale(r){if(1!==r){const a=this.times;for(let c=0,h=a.length;c!==h;++c)a[c]*=r}return this}trim(r,a){const c=this.times,h=c.length;let p=0,g=h-1;for(;p!==h&&c[p]<r;)++p;for(;-1!==g&&c[g]>a;)--g;if(++g,0!==p||g!==h){p>=g&&(g=Math.max(g,1),p=g-1);const _=this.getValueSize();this.times=vr.arraySlice(c,p,g),this.values=vr.arraySlice(this.values,p*_,g*_)}return this}validate(){let r=!0;const a=this.getValueSize();a-Math.floor(a)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);const c=this.times,h=this.values,p=c.length;0===p&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let g=null;for(let _=0;_!==p;_++){const w=c[_];if("number"==typeof w&&isNaN(w)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,_,w),r=!1;break}if(null!==g&&g>w){console.error("THREE.KeyframeTrack: Out of order keys.",this,_,w,g),r=!1;break}g=w}if(void 0!==h&&vr.isTypedArray(h))for(let _=0,w=h.length;_!==w;++_){const M=h[_];if(isNaN(M)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,_,M),r=!1;break}}return r}optimize(){const r=vr.arraySlice(this.times),a=vr.arraySlice(this.values),c=this.getValueSize(),h=2302===this.getInterpolation(),p=r.length-1;let g=1;for(let _=1;_<p;++_){let w=!1;const M=r[_];if(M!==r[_+1]&&(1!==_||M!==r[0]))if(h)w=!0;else{const T=_*c,D=T-c,R=T+c;for(let L=0;L!==c;++L){const P=a[T+L];if(P!==a[D+L]||P!==a[R+L]){w=!0;break}}}if(w){if(_!==g){r[g]=r[_];const T=_*c,D=g*c;for(let R=0;R!==c;++R)a[D+R]=a[T+R]}++g}}if(p>0){r[g]=r[p];for(let _=p*c,w=g*c,M=0;M!==c;++M)a[w+M]=a[_+M];++g}return g!==r.length?(this.times=vr.arraySlice(r,0,g),this.values=vr.arraySlice(a,0,g*c)):(this.times=r,this.values=a),this}clone(){const r=vr.arraySlice(this.times,0),a=vr.arraySlice(this.values,0),h=new(0,this.constructor)(this.name,r,a);return h.createInterpolant=this.createInterpolant,h}}ja.prototype.TimeBufferType=Float32Array,ja.prototype.ValueBufferType=Float32Array,ja.prototype.DefaultInterpolation=Mn;class Ea extends ja{}Ea.prototype.ValueTypeName="bool",Ea.prototype.ValueBufferType=Array,Ea.prototype.DefaultInterpolation=xu,Ea.prototype.InterpolantFactoryMethodLinear=void 0,Ea.prototype.InterpolantFactoryMethodSmooth=void 0;class Uv extends ja{}Uv.prototype.ValueTypeName="color";class Fp extends ja{}Fp.prototype.ValueTypeName="number";class Cw extends bl{constructor(r,a,c,h){super(r,a,c,h)}interpolate_(r,a,c,h){const p=this.resultBuffer,g=this.sampleValues,_=this.valueSize,w=(c-a)/(h-a);let M=r*_;for(let S=M+_;M!==S;M+=4)Zs.slerpFlat(p,0,g,M-_,g,M,w);return p}}class Cd extends ja{InterpolantFactoryMethodLinear(r){return new Cw(this.times,this.values,this.getValueSize(),r)}}Cd.prototype.ValueTypeName="quaternion",Cd.prototype.DefaultInterpolation=Mn,Cd.prototype.InterpolantFactoryMethodSmooth=void 0;class zr extends ja{}zr.prototype.ValueTypeName="string",zr.prototype.ValueBufferType=Array,zr.prototype.DefaultInterpolation=xu,zr.prototype.InterpolantFactoryMethodLinear=void 0,zr.prototype.InterpolantFactoryMethodSmooth=void 0;class eh extends ja{}eh.prototype.ValueTypeName="vector";class Td{constructor(r,a=-1,c,h=2500){this.name=r,this.tracks=c,this.duration=a,this.blendMode=h,this.uuid=ha(),this.duration<0&&this.resetDuration()}static parse(r){const a=[],c=r.tracks,h=1/(r.fps||1);for(let g=0,_=c.length;g!==_;++g)a.push(Aw(c[g]).scale(h));const p=new this(r.name,r.duration,a,r.blendMode);return p.uuid=r.uuid,p}static toJSON(r){const a=[],c=r.tracks,h={name:r.name,duration:r.duration,tracks:a,uuid:r.uuid,blendMode:r.blendMode};for(let p=0,g=c.length;p!==g;++p)a.push(ja.toJSON(c[p]));return h}static CreateFromMorphTargetSequence(r,a,c,h){const p=a.length,g=[];for(let _=0;_<p;_++){let w=[],M=[];w.push((_+p-1)%p,_,(_+1)%p),M.push(0,1,0);const S=vr.getKeyframeOrder(w);w=vr.sortedArray(w,1,S),M=vr.sortedArray(M,1,S),!h&&0===w[0]&&(w.push(p),M.push(M[0])),g.push(new Fp(".morphTargetInfluences["+a[_].name+"]",w,M).scale(1/c))}return new this(r,-1,g)}static findByName(r,a){let c=r;if(!Array.isArray(r)){const h=r;c=h.geometry&&h.geometry.animations||h.animations}for(let h=0;h<c.length;h++)if(c[h].name===a)return c[h];return null}static CreateClipsFromMorphTargetSequences(r,a,c){const h={},p=/^([\w-]*?)([\d]+)$/;for(let _=0,w=r.length;_<w;_++){const M=r[_],S=M.name.match(p);if(S&&S.length>1){const T=S[1];let D=h[T];D||(h[T]=D=[]),D.push(M)}}const g=[];for(const _ in h)g.push(this.CreateFromMorphTargetSequence(_,h[_],a,c));return g}static parseAnimation(r,a){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const c=function(T,D,R,L,P){if(0!==R.length){const I=[],z=[];vr.flattenJSON(R,I,z,L),0!==I.length&&P.push(new T(D,I,z))}},h=[],p=r.name||"default",g=r.fps||30,_=r.blendMode;let w=r.length||-1;const M=r.hierarchy||[];for(let T=0;T<M.length;T++){const D=M[T].keys;if(D&&0!==D.length)if(D[0].morphTargets){const R={};let L;for(L=0;L<D.length;L++)if(D[L].morphTargets)for(let P=0;P<D[L].morphTargets.length;P++)R[D[L].morphTargets[P]]=-1;for(const P in R){const I=[],z=[];for(let B=0;B!==D[L].morphTargets.length;++B){const j=D[L];I.push(j.time),z.push(j.morphTarget===P?1:0)}h.push(new Fp(".morphTargetInfluence["+P+"]",I,z))}w=R.length*g}else{const R=".bones["+a[T].name+"]";c(eh,R+".position",D,"pos",h),c(Cd,R+".quaternion",D,"rot",h),c(eh,R+".scale",D,"scl",h)}}return 0===h.length?null:new this(p,w,h,_)}resetDuration(){let a=0;for(let c=0,h=this.tracks.length;c!==h;++c){const p=this.tracks[c];a=Math.max(a,p.times[p.times.length-1])}return this.duration=a,this}trim(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this}validate(){let r=!0;for(let a=0;a<this.tracks.length;a++)r=r&&this.tracks[a].validate();return r}optimize(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this}clone(){const r=[];for(let a=0;a<this.tracks.length;a++)r.push(this.tracks[a].clone());return new this.constructor(this.name,this.duration,r,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Aw(d){if(void 0===d.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const r=function Tw(d){switch(d.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Fp;case"vector":case"vector2":case"vector3":case"vector4":return eh;case"color":return Uv;case"quaternion":return Cd;case"bool":case"boolean":return Ea;case"string":return zr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+d)}(d.type);if(void 0===d.times){const a=[],c=[];vr.flattenJSON(d.keys,a,c,"value"),d.times=a,d.values=c}return void 0!==r.parse?r.parse(d):new r(d.name,d.times,d.values,d.interpolation)}const zc={enabled:!1,files:{},add:function(d,r){!1!==this.enabled&&(this.files[d]=r)},get:function(d){if(!1!==this.enabled)return this.files[d]},remove:function(d){delete this.files[d]},clear:function(){this.files={}}};class zv{constructor(r,a,c){const h=this;let w,p=!1,g=0,_=0;const M=[];this.onStart=void 0,this.onLoad=r,this.onProgress=a,this.onError=c,this.itemStart=function(S){_++,!1===p&&void 0!==h.onStart&&h.onStart(S,g,_),p=!0},this.itemEnd=function(S){g++,void 0!==h.onProgress&&h.onProgress(S,g,_),g===_&&(p=!1,void 0!==h.onLoad&&h.onLoad())},this.itemError=function(S){void 0!==h.onError&&h.onError(S)},this.resolveURL=function(S){return w?w(S):S},this.setURLModifier=function(S){return w=S,this},this.addHandler=function(S,T){return M.push(S,T),this},this.removeHandler=function(S){const T=M.indexOf(S);return-1!==T&&M.splice(T,2),this},this.getHandler=function(S){for(let T=0,D=M.length;T<D;T+=2){const R=M[T],L=M[T+1];if(R.global&&(R.lastIndex=0),R.test(S))return L}return null}}}const Dw=new zv;class Do{constructor(r){this.manager=void 0!==r?r:Dw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,a){const c=this;return new Promise(function(h,p){c.load(r,h,a,p)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}}const ic={};class Xa extends Do{constructor(r){super(r)}load(r,a,c,h){void 0===r&&(r=""),void 0!==this.path&&(r=this.path+r),r=this.manager.resolveURL(r);const p=zc.get(r);if(void 0!==p)return this.manager.itemStart(r),setTimeout(()=>{a&&a(p),this.manager.itemEnd(r)},0),p;if(void 0!==ic[r])return void ic[r].push({onLoad:a,onProgress:c,onError:h});ic[r]=[],ic[r].push({onLoad:a,onProgress:c,onError:h});const g=new Request(r,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),_=this.mimeType,w=this.responseType;fetch(g).then(M=>{if(200===M.status||0===M.status){if(0===M.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===M.body||void 0===M.body.getReader)return M;const S=ic[r],T=M.body.getReader(),D=M.headers.get("Content-Length"),R=D?parseInt(D):0,L=0!==R;let P=0;const I=new ReadableStream({start(z){!function B(){T.read().then(({done:j,value:H})=>{if(j)z.close();else{P+=H.byteLength;const K=new ProgressEvent("progress",{lengthComputable:L,loaded:P,total:R});for(let ae=0,he=S.length;ae<he;ae++){const me=S[ae];me.onProgress&&me.onProgress(K)}z.enqueue(H),B()}})}()}});return new Response(I)}throw Error(`fetch for "${M.url}" responded with ${M.status}: ${M.statusText}`)}).then(M=>{switch(w){case"arraybuffer":return M.arrayBuffer();case"blob":return M.blob();case"document":return M.text().then(S=>(new DOMParser).parseFromString(S,_));case"json":return M.json();default:if(void 0===_)return M.text();{const T=/charset="?([^;"\s]*)"?/i.exec(_),D=T&&T[1]?T[1].toLowerCase():void 0,R=new TextDecoder(D);return M.arrayBuffer().then(L=>R.decode(L))}}}).then(M=>{zc.add(r,M);const S=ic[r];delete ic[r];for(let T=0,D=S.length;T<D;T++){const R=S[T];R.onLoad&&R.onLoad(M)}}).catch(M=>{const S=ic[r];if(void 0===S)throw this.manager.itemError(r),M;delete ic[r];for(let T=0,D=S.length;T<D;T++){const R=S[T];R.onError&&R.onError(M)}this.manager.itemError(r)}).finally(()=>{this.manager.itemEnd(r)}),this.manager.itemStart(r)}setResponseType(r){return this.responseType=r,this}setMimeType(r){return this.mimeType=r,this}}class Np extends Do{constructor(r){super(r)}load(r,a,c,h){void 0!==this.path&&(r=this.path+r),r=this.manager.resolveURL(r);const p=this,g=zc.get(r);if(void 0!==g)return p.manager.itemStart(r),setTimeout(function(){a&&a(g),p.manager.itemEnd(r)},0),g;const _=Dc("img");function w(){S(),zc.add(r,this),a&&a(this),p.manager.itemEnd(r)}function M(T){S(),h&&h(T),p.manager.itemError(r),p.manager.itemEnd(r)}function S(){_.removeEventListener("load",w,!1),_.removeEventListener("error",M,!1)}return _.addEventListener("load",w,!1),_.addEventListener("error",M,!1),"data:"!==r.slice(0,5)&&void 0!==this.crossOrigin&&(_.crossOrigin=this.crossOrigin),p.manager.itemStart(r),_.src=r,_}}class Pw extends Do{constructor(r){super(r)}load(r,a,c,h){const p=new jl,g=new Np(this.manager);g.setCrossOrigin(this.crossOrigin),g.setPath(this.path);let _=0;function w(M){g.load(r[M],function(S){p.images[M]=S,_++,6===_&&(p.needsUpdate=!0,a&&a(p))},void 0,h)}for(let M=0;M<r.length;++M)w(M);return p}}class KT extends Do{constructor(r){super(r)}load(r,a,c,h){const p=this,g=new Yl,_=new Xa(this.manager);return _.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(p.withCredentials),_.load(r,function(w){const M=p.parse(w);!M||(void 0!==M.image?g.image=M.image:void 0!==M.data&&(g.image.width=M.width,g.image.height=M.height,g.image.data=M.data),g.wrapS=void 0!==M.wrapS?M.wrapS:fs,g.wrapT=void 0!==M.wrapT?M.wrapT:fs,g.magFilter=void 0!==M.magFilter?M.magFilter:kr,g.minFilter=void 0!==M.minFilter?M.minFilter:kr,g.anisotropy=void 0!==M.anisotropy?M.anisotropy:1,void 0!==M.encoding&&(g.encoding=M.encoding),void 0!==M.flipY&&(g.flipY=M.flipY),void 0!==M.format&&(g.format=M.format),void 0!==M.type&&(g.type=M.type),void 0!==M.mipmaps&&(g.mipmaps=M.mipmaps,g.minFilter=Ua),1===M.mipmapCount&&(g.minFilter=kr),void 0!==M.generateMipmaps&&(g.generateMipmaps=M.generateMipmaps),g.needsUpdate=!0,a&&a(g,M))},c,h),g}}class $T extends Do{constructor(r){super(r)}load(r,a,c,h){const p=new is,g=new Np(this.manager);return g.setCrossOrigin(this.crossOrigin),g.setPath(this.path),g.load(r,function(_){p.image=_,p.needsUpdate=!0,void 0!==a&&a(p)},c,h),p}}class na extends _i{constructor(r,a=1){super(),this.type="Light",this.color=new Tt(r),this.intensity=a}dispose(){}copy(r){return super.copy(r),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const a=super.toJSON(r);return a.object.color=this.color.getHex(),a.object.intensity=this.intensity,void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(a.object.distance=this.distance),void 0!==this.angle&&(a.object.angle=this.angle),void 0!==this.decay&&(a.object.decay=this.decay),void 0!==this.penumbra&&(a.object.penumbra=this.penumbra),void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON()),a}}na.prototype.isLight=!0;class Hv extends na{constructor(r,a,c){super(r,c),this.type="HemisphereLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.groundColor=new Tt(a)}copy(r){return na.prototype.copy.call(this,r),this.groundColor.copy(r.groundColor),this}}Hv.prototype.isHemisphereLight=!0;const Gv=new on,Wv=new J,ZT=new J;class ia{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Qe(512,512),this.map=null,this.mapPass=null,this.matrix=new on,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Wf,this._frameExtents=new Qe(1,1),this._viewportCount=1,this._viewports=[new ki(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const a=this.camera,c=this.matrix;Wv.setFromMatrixPosition(r.matrixWorld),a.position.copy(Wv),ZT.setFromMatrixPosition(r.target.matrixWorld),a.lookAt(ZT),a.updateMatrixWorld(),Gv.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Gv),c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(a.projectionMatrix),c.multiply(a.matrixWorldInverse)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const r={};return 0!==this.bias&&(r.bias=this.bias),0!==this.normalBias&&(r.normalBias=this.normalBias),1!==this.radius&&(r.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}}class JT extends ia{constructor(){super(new Ds(50,1,.5,500)),this.focus=1}updateMatrices(r){const a=this.camera,c=2*Bi*r.angle*this.focus,h=this.mapSize.width/this.mapSize.height,p=r.distance||a.far;(c!==a.fov||h!==a.aspect||p!==a.far)&&(a.fov=c,a.aspect=h,a.far=p,a.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}}JT.prototype.isSpotLightShadow=!0;class Iw extends na{constructor(r,a,c=0,h=Math.PI/3,p=0,g=1){super(r,a),this.type="SpotLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.target=new _i,this.distance=c,this.angle=h,this.penumbra=p,this.decay=g,this.shadow=new JT}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}Iw.prototype.isSpotLight=!0;const qv=new on,Ad=new J,Ng=new J;class Lw extends ia{constructor(){super(new Ds(90,1,.5,500)),this._frameExtents=new Qe(4,2),this._viewportCount=6,this._viewports=[new ki(2,1,1,1),new ki(0,1,1,1),new ki(3,1,1,1),new ki(1,1,1,1),new ki(3,0,1,1),new ki(1,0,1,1)],this._cubeDirections=[new J(1,0,0),new J(-1,0,0),new J(0,0,1),new J(0,0,-1),new J(0,1,0),new J(0,-1,0)],this._cubeUps=[new J(0,1,0),new J(0,1,0),new J(0,1,0),new J(0,1,0),new J(0,0,1),new J(0,0,-1)]}updateMatrices(r,a=0){const c=this.camera,h=this.matrix,p=r.distance||c.far;p!==c.far&&(c.far=p,c.updateProjectionMatrix()),Ad.setFromMatrixPosition(r.matrixWorld),c.position.copy(Ad),Ng.copy(c.position),Ng.add(this._cubeDirections[a]),c.up.copy(this._cubeUps[a]),c.lookAt(Ng),c.updateMatrixWorld(),h.makeTranslation(-Ad.x,-Ad.y,-Ad.z),qv.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qv)}}Lw.prototype.isPointLightShadow=!0;class Fw extends na{constructor(r,a,c=0,h=1){super(r,a),this.type="PointLight",this.distance=c,this.decay=h,this.shadow=new Lw}get power(){return 4*this.intensity*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}}Fw.prototype.isPointLight=!0;class jv extends ia{constructor(){super(new ep(-5,5,5,-5,.5,500))}}jv.prototype.isDirectionalLightShadow=!0;class Li extends na{constructor(r,a){super(r,a),this.type="DirectionalLight",this.position.copy(_i.DefaultUp),this.updateMatrix(),this.target=new _i,this.shadow=new jv}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}Li.prototype.isDirectionalLight=!0;class Xv extends na{constructor(r,a){super(r,a),this.type="AmbientLight"}}Xv.prototype.isAmbientLight=!0;class Op extends na{constructor(r,a,c=10,h=10){super(r,a),this.type="RectAreaLight",this.width=c,this.height=h}get power(){return this.intensity*this.width*this.height*Math.PI}set power(r){this.intensity=r/(this.width*this.height*Math.PI)}copy(r){return super.copy(r),this.width=r.width,this.height=r.height,this}toJSON(r){const a=super.toJSON(r);return a.object.width=this.width,a.object.height=this.height,a}}Op.prototype.isRectAreaLight=!0;class Yv{constructor(){this.coefficients=[];for(let r=0;r<9;r++)this.coefficients.push(new J)}set(r){for(let a=0;a<9;a++)this.coefficients[a].copy(r[a]);return this}zero(){for(let r=0;r<9;r++)this.coefficients[r].set(0,0,0);return this}getAt(r,a){const c=r.x,h=r.y,p=r.z,g=this.coefficients;return a.copy(g[0]).multiplyScalar(.282095),a.addScaledVector(g[1],.488603*h),a.addScaledVector(g[2],.488603*p),a.addScaledVector(g[3],.488603*c),a.addScaledVector(g[4],c*h*1.092548),a.addScaledVector(g[5],h*p*1.092548),a.addScaledVector(g[6],.315392*(3*p*p-1)),a.addScaledVector(g[7],c*p*1.092548),a.addScaledVector(g[8],.546274*(c*c-h*h)),a}getIrradianceAt(r,a){const c=r.x,h=r.y,p=r.z,g=this.coefficients;return a.copy(g[0]).multiplyScalar(.886227),a.addScaledVector(g[1],1.023328*h),a.addScaledVector(g[2],1.023328*p),a.addScaledVector(g[3],1.023328*c),a.addScaledVector(g[4],.858086*c*h),a.addScaledVector(g[5],.858086*h*p),a.addScaledVector(g[6],.743125*p*p-.247708),a.addScaledVector(g[7],.858086*c*p),a.addScaledVector(g[8],.429043*(c*c-h*h)),a}add(r){for(let a=0;a<9;a++)this.coefficients[a].add(r.coefficients[a]);return this}addScaledSH(r,a){for(let c=0;c<9;c++)this.coefficients[c].addScaledVector(r.coefficients[c],a);return this}scale(r){for(let a=0;a<9;a++)this.coefficients[a].multiplyScalar(r);return this}lerp(r,a){for(let c=0;c<9;c++)this.coefficients[c].lerp(r.coefficients[c],a);return this}equals(r){for(let a=0;a<9;a++)if(!this.coefficients[a].equals(r.coefficients[a]))return!1;return!0}copy(r){return this.set(r.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(r,a=0){const c=this.coefficients;for(let h=0;h<9;h++)c[h].fromArray(r,a+3*h);return this}toArray(r=[],a=0){const c=this.coefficients;for(let h=0;h<9;h++)c[h].toArray(r,a+3*h);return r}static getBasisAt(r,a){const c=r.x,h=r.y,p=r.z;a[0]=.282095,a[1]=.488603*h,a[2]=.488603*p,a[3]=.488603*c,a[4]=1.092548*c*h,a[5]=1.092548*h*p,a[6]=.315392*(3*p*p-1),a[7]=1.092548*c*p,a[8]=.546274*(c*c-h*h)}}Yv.prototype.isSphericalHarmonics3=!0;class Bp extends na{constructor(r=new Yv,a=1){super(void 0,a),this.sh=r}copy(r){return super.copy(r),this.sh.copy(r.sh),this}fromJSON(r){return this.intensity=r.intensity,this.sh.fromArray(r.sh),this}toJSON(r){const a=super.toJSON(r);return a.object.sh=this.sh.toArray(),a}}Bp.prototype.isLightProbe=!0;class Nw extends Do{constructor(r){super(r),this.textures={}}load(r,a,c,h){const p=this,g=new Xa(p.manager);g.setPath(p.path),g.setRequestHeader(p.requestHeader),g.setWithCredentials(p.withCredentials),g.load(r,function(_){try{a(p.parse(JSON.parse(_)))}catch(w){h?h(w):console.error(w),p.manager.itemError(r)}},c,h)}parse(r){const a=this.textures;function c(p){return void 0===a[p]&&console.warn("THREE.MaterialLoader: Undefined texture",p),a[p]}const h=Zt.fromType(r.type);if(void 0!==r.uuid&&(h.uuid=r.uuid),void 0!==r.name&&(h.name=r.name),void 0!==r.color&&void 0!==h.color&&h.color.setHex(r.color),void 0!==r.roughness&&(h.roughness=r.roughness),void 0!==r.metalness&&(h.metalness=r.metalness),void 0!==r.sheen&&(h.sheen=r.sheen),void 0!==r.sheenColor&&(h.sheenColor=(new Tt).setHex(r.sheenColor)),void 0!==r.sheenRoughness&&(h.sheenRoughness=r.sheenRoughness),void 0!==r.emissive&&void 0!==h.emissive&&h.emissive.setHex(r.emissive),void 0!==r.specular&&void 0!==h.specular&&h.specular.setHex(r.specular),void 0!==r.specularIntensity&&(h.specularIntensity=r.specularIntensity),void 0!==r.specularColor&&void 0!==h.specularColor&&h.specularColor.setHex(r.specularColor),void 0!==r.shininess&&(h.shininess=r.shininess),void 0!==r.clearcoat&&(h.clearcoat=r.clearcoat),void 0!==r.clearcoatRoughness&&(h.clearcoatRoughness=r.clearcoatRoughness),void 0!==r.transmission&&(h.transmission=r.transmission),void 0!==r.thickness&&(h.thickness=r.thickness),void 0!==r.attenuationDistance&&(h.attenuationDistance=r.attenuationDistance),void 0!==r.attenuationColor&&void 0!==h.attenuationColor&&h.attenuationColor.setHex(r.attenuationColor),void 0!==r.fog&&(h.fog=r.fog),void 0!==r.flatShading&&(h.flatShading=r.flatShading),void 0!==r.blending&&(h.blending=r.blending),void 0!==r.combine&&(h.combine=r.combine),void 0!==r.side&&(h.side=r.side),void 0!==r.shadowSide&&(h.shadowSide=r.shadowSide),void 0!==r.opacity&&(h.opacity=r.opacity),void 0!==r.transparent&&(h.transparent=r.transparent),void 0!==r.alphaTest&&(h.alphaTest=r.alphaTest),void 0!==r.depthTest&&(h.depthTest=r.depthTest),void 0!==r.depthWrite&&(h.depthWrite=r.depthWrite),void 0!==r.colorWrite&&(h.colorWrite=r.colorWrite),void 0!==r.stencilWrite&&(h.stencilWrite=r.stencilWrite),void 0!==r.stencilWriteMask&&(h.stencilWriteMask=r.stencilWriteMask),void 0!==r.stencilFunc&&(h.stencilFunc=r.stencilFunc),void 0!==r.stencilRef&&(h.stencilRef=r.stencilRef),void 0!==r.stencilFuncMask&&(h.stencilFuncMask=r.stencilFuncMask),void 0!==r.stencilFail&&(h.stencilFail=r.stencilFail),void 0!==r.stencilZFail&&(h.stencilZFail=r.stencilZFail),void 0!==r.stencilZPass&&(h.stencilZPass=r.stencilZPass),void 0!==r.wireframe&&(h.wireframe=r.wireframe),void 0!==r.wireframeLinewidth&&(h.wireframeLinewidth=r.wireframeLinewidth),void 0!==r.wireframeLinecap&&(h.wireframeLinecap=r.wireframeLinecap),void 0!==r.wireframeLinejoin&&(h.wireframeLinejoin=r.wireframeLinejoin),void 0!==r.rotation&&(h.rotation=r.rotation),1!==r.linewidth&&(h.linewidth=r.linewidth),void 0!==r.dashSize&&(h.dashSize=r.dashSize),void 0!==r.gapSize&&(h.gapSize=r.gapSize),void 0!==r.scale&&(h.scale=r.scale),void 0!==r.polygonOffset&&(h.polygonOffset=r.polygonOffset),void 0!==r.polygonOffsetFactor&&(h.polygonOffsetFactor=r.polygonOffsetFactor),void 0!==r.polygonOffsetUnits&&(h.polygonOffsetUnits=r.polygonOffsetUnits),void 0!==r.dithering&&(h.dithering=r.dithering),void 0!==r.alphaToCoverage&&(h.alphaToCoverage=r.alphaToCoverage),void 0!==r.premultipliedAlpha&&(h.premultipliedAlpha=r.premultipliedAlpha),void 0!==r.visible&&(h.visible=r.visible),void 0!==r.toneMapped&&(h.toneMapped=r.toneMapped),void 0!==r.userData&&(h.userData=r.userData),void 0!==r.vertexColors&&(h.vertexColors="number"==typeof r.vertexColors?r.vertexColors>0:r.vertexColors),void 0!==r.uniforms)for(const p in r.uniforms){const g=r.uniforms[p];switch(h.uniforms[p]={},g.type){case"t":h.uniforms[p].value=c(g.value);break;case"c":h.uniforms[p].value=(new Tt).setHex(g.value);break;case"v2":h.uniforms[p].value=(new Qe).fromArray(g.value);break;case"v3":h.uniforms[p].value=(new J).fromArray(g.value);break;case"v4":h.uniforms[p].value=(new ki).fromArray(g.value);break;case"m3":h.uniforms[p].value=(new Yi).fromArray(g.value);break;case"m4":h.uniforms[p].value=(new on).fromArray(g.value);break;default:h.uniforms[p].value=g.value}}if(void 0!==r.defines&&(h.defines=r.defines),void 0!==r.vertexShader&&(h.vertexShader=r.vertexShader),void 0!==r.fragmentShader&&(h.fragmentShader=r.fragmentShader),void 0!==r.extensions)for(const p in r.extensions)h.extensions[p]=r.extensions[p];if(void 0!==r.shading&&(h.flatShading=1===r.shading),void 0!==r.size&&(h.size=r.size),void 0!==r.sizeAttenuation&&(h.sizeAttenuation=r.sizeAttenuation),void 0!==r.map&&(h.map=c(r.map)),void 0!==r.matcap&&(h.matcap=c(r.matcap)),void 0!==r.alphaMap&&(h.alphaMap=c(r.alphaMap)),void 0!==r.bumpMap&&(h.bumpMap=c(r.bumpMap)),void 0!==r.bumpScale&&(h.bumpScale=r.bumpScale),void 0!==r.normalMap&&(h.normalMap=c(r.normalMap)),void 0!==r.normalMapType&&(h.normalMapType=r.normalMapType),void 0!==r.normalScale){let p=r.normalScale;!1===Array.isArray(p)&&(p=[p,p]),h.normalScale=(new Qe).fromArray(p)}return void 0!==r.displacementMap&&(h.displacementMap=c(r.displacementMap)),void 0!==r.displacementScale&&(h.displacementScale=r.displacementScale),void 0!==r.displacementBias&&(h.displacementBias=r.displacementBias),void 0!==r.roughnessMap&&(h.roughnessMap=c(r.roughnessMap)),void 0!==r.metalnessMap&&(h.metalnessMap=c(r.metalnessMap)),void 0!==r.emissiveMap&&(h.emissiveMap=c(r.emissiveMap)),void 0!==r.emissiveIntensity&&(h.emissiveIntensity=r.emissiveIntensity),void 0!==r.specularMap&&(h.specularMap=c(r.specularMap)),void 0!==r.specularIntensityMap&&(h.specularIntensityMap=c(r.specularIntensityMap)),void 0!==r.specularColorMap&&(h.specularColorMap=c(r.specularColorMap)),void 0!==r.envMap&&(h.envMap=c(r.envMap)),void 0!==r.envMapIntensity&&(h.envMapIntensity=r.envMapIntensity),void 0!==r.reflectivity&&(h.reflectivity=r.reflectivity),void 0!==r.refractionRatio&&(h.refractionRatio=r.refractionRatio),void 0!==r.lightMap&&(h.lightMap=c(r.lightMap)),void 0!==r.lightMapIntensity&&(h.lightMapIntensity=r.lightMapIntensity),void 0!==r.aoMap&&(h.aoMap=c(r.aoMap)),void 0!==r.aoMapIntensity&&(h.aoMapIntensity=r.aoMapIntensity),void 0!==r.gradientMap&&(h.gradientMap=c(r.gradientMap)),void 0!==r.clearcoatMap&&(h.clearcoatMap=c(r.clearcoatMap)),void 0!==r.clearcoatRoughnessMap&&(h.clearcoatRoughnessMap=c(r.clearcoatRoughnessMap)),void 0!==r.clearcoatNormalMap&&(h.clearcoatNormalMap=c(r.clearcoatNormalMap)),void 0!==r.clearcoatNormalScale&&(h.clearcoatNormalScale=(new Qe).fromArray(r.clearcoatNormalScale)),void 0!==r.transmissionMap&&(h.transmissionMap=c(r.transmissionMap)),void 0!==r.thicknessMap&&(h.thicknessMap=c(r.thicknessMap)),void 0!==r.sheenColorMap&&(h.sheenColorMap=c(r.sheenColorMap)),void 0!==r.sheenRoughnessMap&&(h.sheenRoughnessMap=c(r.sheenRoughnessMap)),h}setTextures(r){return this.textures=r,this}}class Og{static decodeText(r){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(r);let a="";for(let c=0,h=r.length;c<h;c++)a+=String.fromCharCode(r[c]);try{return decodeURIComponent(escape(a))}catch(c){return a}}static extractUrlBase(r){const a=r.lastIndexOf("/");return-1===a?"./":r.slice(0,a+1)}static resolveURL(r,a){return"string"!=typeof r||""===r?"":(/^https?:\/\//i.test(a)&&/^\//.test(r)&&(a=a.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:a+r)}}class Kv extends Jt{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(r){return super.copy(r),this.instanceCount=r.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const r=super.toJSON(this);return r.instanceCount=this.instanceCount,r.isInstancedBufferGeometry=!0,r}}Kv.prototype.isInstancedBufferGeometry=!0;class Ow extends Do{constructor(r){super(r)}load(r,a,c,h){const p=this,g=new Xa(p.manager);g.setPath(p.path),g.setRequestHeader(p.requestHeader),g.setWithCredentials(p.withCredentials),g.load(r,function(_){try{a(p.parse(JSON.parse(_)))}catch(w){h?h(w):console.error(w),p.manager.itemError(r)}},c,h)}parse(r){const a={},c={};function h(R,L){if(void 0!==a[L])return a[L];const I=R.interleavedBuffers[L],z=function p(R,L){if(void 0!==c[L])return c[L];const z=new Uint32Array(R.arrayBuffers[L]).buffer;return c[L]=z,z}(R,I.buffer),B=sl(I.type,z),j=new gd(B,I.stride);return j.uuid=I.uuid,a[L]=j,j}const g=r.isInstancedBufferGeometry?new Kv:new Jt,_=r.data.index;if(void 0!==_){const R=sl(_.type,_.array);g.setIndex(new Pi(R,1))}const w=r.data.attributes;for(const R in w){const L=w[R];let P;if(L.isInterleavedBufferAttribute){const I=h(r.data,L.data);P=new Oc(I,L.itemSize,L.offset,L.normalized)}else{const I=sl(L.type,L.array);P=new(L.isInstancedBufferAttribute?yl:Pi)(I,L.itemSize,L.normalized)}void 0!==L.name&&(P.name=L.name),void 0!==L.usage&&P.setUsage(L.usage),void 0!==L.updateRange&&(P.updateRange.offset=L.updateRange.offset,P.updateRange.count=L.updateRange.count),g.setAttribute(R,P)}const M=r.data.morphAttributes;if(M)for(const R in M){const L=M[R],P=[];for(let I=0,z=L.length;I<z;I++){const B=L[I];let j;if(B.isInterleavedBufferAttribute){const H=h(r.data,B.data);j=new Oc(H,B.itemSize,B.offset,B.normalized)}else{const H=sl(B.type,B.array);j=new Pi(H,B.itemSize,B.normalized)}void 0!==B.name&&(j.name=B.name),P.push(j)}g.morphAttributes[R]=P}r.data.morphTargetsRelative&&(g.morphTargetsRelative=!0);const T=r.data.groups||r.data.drawcalls||r.data.offsets;if(void 0!==T)for(let R=0,L=T.length;R!==L;++R){const P=T[R];g.addGroup(P.start,P.count,P.materialIndex)}const D=r.data.boundingSphere;if(void 0!==D){const R=new J;void 0!==D.center&&R.fromArray(D.center),g.boundingSphere=new Cu(R,D.radius)}return r.name&&(g.name=r.name),r.userData&&(g.userData=r.userData),g}}const Dd={UVMapping:300,CubeReflectionMapping:Ii,CubeRefractionMapping:Va,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306},Bw={RepeatWrapping:oo,ClampToEdgeWrapping:fs,MirroredRepeatWrapping:Oh},Rd={NearestFilter:Br,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:kr,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:Ua};class kw extends Do{constructor(r){super(r),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(r){return this.options=r,this}load(r,a,c,h){void 0===r&&(r=""),void 0!==this.path&&(r=this.path+r),r=this.manager.resolveURL(r);const p=this,g=zc.get(r);if(void 0!==g)return p.manager.itemStart(r),setTimeout(function(){a&&a(g),p.manager.itemEnd(r)},0),g;const _={};_.credentials="anonymous"===this.crossOrigin?"same-origin":"include",_.headers=this.requestHeader,fetch(r,_).then(function(w){return w.blob()}).then(function(w){return createImageBitmap(w,Object.assign(p.options,{colorSpaceConversion:"none"}))}).then(function(w){zc.add(r,w),a&&a(w),p.manager.itemEnd(r)}).catch(function(w){h&&h(w),p.manager.itemError(r),p.manager.itemEnd(r)}),p.manager.itemStart(r)}}let kg;kw.prototype.isImageBitmapLoader=!0;const kp={getContext:function(){return void 0===kg&&(kg=new(window.AudioContext||window.webkitAudioContext)),kg},setContext:function(d){kg=d}};class Ya extends Do{constructor(r){super(r)}load(r,a,c,h){const p=this,g=new Xa(this.manager);g.setResponseType("arraybuffer"),g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(r,function(_){try{const w=_.slice(0);kp.getContext().decodeAudioData(w,function(S){a(S)})}catch(w){h?h(w):console.error(w),p.manager.itemError(r)}},c,h)}}class Pd extends Bp{constructor(r,a,c=1){super(void 0,c);const h=(new Tt).set(r),p=(new Tt).set(a),g=new J(h.r,h.g,h.b),_=new J(p.r,p.g,p.b),w=Math.sqrt(Math.PI),M=w*Math.sqrt(.75);this.sh.coefficients[0].copy(g).add(_).multiplyScalar(w),this.sh.coefficients[1].copy(g).sub(_).multiplyScalar(M)}}Pd.prototype.isHemisphereLightProbe=!0;class Qs extends Bp{constructor(r,a=1){super(void 0,a);const c=(new Tt).set(r);this.sh.coefficients[0].set(c.r,c.g,c.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Qs.prototype.isAmbientLightProbe=!0;const Hc=new on,Vp=new on,Is=new on;class th{constructor(r=!0){this.autoStart=r,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const a=nh();r=(a-this.oldTime)/1e3,this.oldTime=a,this.elapsedTime+=r}return r}}function nh(){return("undefined"==typeof performance?Date:performance).now()}const Sa=new J,ih=new Zs,Id=new J,Ca=new J;class Gc extends _i{constructor(r){super(),this.type="Audio",this.listener=r,this.context=r.context,this.gain=this.context.createGain(),this.gain.connect(r.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(r){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=r,this.connect(),this}setMediaElementSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(r),this.connect(),this}setMediaStreamSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(r),this.connect(),this}setBuffer(r){return this.buffer=r,this.sourceType="buffer",this.autoplay&&this.play(),this}play(r=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+r;const a=this.context.createBufferSource();return a.buffer=this.buffer,a.loop=this.loop,a.loopStart=this.loopStart,a.loopEnd=this.loopEnd,a.onended=this.onEnded.bind(this),a.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=a,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let r=1,a=this.filters.length;r<a;r++)this.filters[r-1].connect(this.filters[r]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let r=1,a=this.filters.length;r<a;r++)this.filters[r-1].disconnect(this.filters[r]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(r){return r||(r=[]),!0===this._connected?(this.disconnect(),this.filters=r.slice(),this.connect()):this.filters=r.slice(),this}setDetune(r){if(this.detune=r,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(r){return this.setFilters(r?[r]:[])}setPlaybackRate(r){if(!1!==this.hasPlaybackControl)return this.playbackRate=r,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(r){if(!1!==this.hasPlaybackControl)return this.loop=r,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(r){return this.loopStart=r,this}setLoopEnd(r){return this.loopEnd=r,this}getVolume(){return this.gain.gain.value}setVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}}const Ta=new J,$v=new Zs,Vw=new J,Wc=new J;class Zv{constructor(r,a=2048){this.analyser=r.context.createAnalyser(),this.analyser.fftSize=a,this.data=new Uint8Array(this.analyser.frequencyBinCount),r.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let r=0;const a=this.getFrequencyData();for(let c=0;c<a.length;c++)r+=a[c];return r/a.length}}class Jv{constructor(r,a,c){let h,p,g;switch(this.binding=r,this.valueSize=c,a){case"quaternion":h=this._slerp,p=this._slerpAdditive,g=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*c),this._workIndex=5;break;case"string":case"bool":h=this._select,p=this._select,g=this._setAdditiveIdentityOther,this.buffer=new Array(5*c);break;default:h=this._lerp,p=this._lerpAdditive,g=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*c)}this._mixBufferRegion=h,this._mixBufferRegionAdditive=p,this._setIdentity=g,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(r,a){const c=this.buffer,h=this.valueSize,p=r*h+h;let g=this.cumulativeWeight;if(0===g){for(let _=0;_!==h;++_)c[p+_]=c[_];g=a}else g+=a,this._mixBufferRegion(c,p,0,a/g,h);this.cumulativeWeight=g}accumulateAdditive(r){const a=this.buffer,c=this.valueSize,h=c*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(a,h,0,r,c),this.cumulativeWeightAdditive+=r}apply(r){const a=this.valueSize,c=this.buffer,h=r*a+a,p=this.cumulativeWeight,g=this.cumulativeWeightAdditive,_=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,p<1&&this._mixBufferRegion(c,h,a*this._origIndex,1-p,a),g>0&&this._mixBufferRegionAdditive(c,h,this._addIndex*a,1,a);for(let w=a,M=a+a;w!==M;++w)if(c[w]!==c[w+a]){_.setValue(c,h);break}}saveOriginalState(){const a=this.buffer,c=this.valueSize,h=c*this._origIndex;this.binding.getValue(a,h);for(let p=c,g=h;p!==g;++p)a[p]=a[h+p%c];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const r=this._addIndex*this.valueSize,a=r+this.valueSize;for(let c=r;c<a;c++)this.buffer[c]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const r=this._origIndex*this.valueSize,a=this._addIndex*this.valueSize;for(let c=0;c<this.valueSize;c++)this.buffer[a+c]=this.buffer[r+c]}_select(r,a,c,h,p){if(h>=.5)for(let g=0;g!==p;++g)r[a+g]=r[c+g]}_slerp(r,a,c,h){Zs.slerpFlat(r,a,r,a,r,c,h)}_slerpAdditive(r,a,c,h,p){const g=this._workIndex*p;Zs.multiplyQuaternionsFlat(r,g,r,a,r,c),Zs.slerpFlat(r,a,r,a,r,g,h)}_lerp(r,a,c,h,p){const g=1-h;for(let _=0;_!==p;++_){const w=a+_;r[w]=r[w]*g+r[c+_]*h}}_lerpAdditive(r,a,c,h,p){for(let g=0;g!==p;++g){const _=a+g;r[_]=r[_]+r[c+g]*h}}}const Vg="\\[\\]\\.:\\/",zw=new RegExp("["+Vg+"]","g"),Ug="[^"+Vg+"]",QT="[^"+Vg.replace("\\.","")+"]",pn=/((?:WC+[\/:])*)/.source.replace("WC",Ug),e1=/(WCOD+)?/.source.replace("WCOD",QT),t1=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ug),Hw=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ug),n1=new RegExp("^"+pn+e1+t1+Hw+"$"),r1=["material","materials","bones"];class Gw{constructor(r,a,c){const h=c||mr.parseTrackName(a);this._targetGroup=r,this._bindings=r.subscribe_(a,h)}getValue(r,a){this.bind();const h=this._bindings[this._targetGroup.nCachedObjects_];void 0!==h&&h.getValue(r,a)}setValue(r,a){const c=this._bindings;for(let h=this._targetGroup.nCachedObjects_,p=c.length;h!==p;++h)c[h].setValue(r,a)}bind(){const r=this._bindings;for(let a=this._targetGroup.nCachedObjects_,c=r.length;a!==c;++a)r[a].bind()}unbind(){const r=this._bindings;for(let a=this._targetGroup.nCachedObjects_,c=r.length;a!==c;++a)r[a].unbind()}}let mr=(()=>{class d{constructor(a,c,h){this.path=c,this.parsedPath=h||d.parseTrackName(c),this.node=d.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,c,h){return a&&a.isAnimationObjectGroup?new d.Composite(a,c,h):new d(a,c,h)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(zw,"")}static parseTrackName(a){const c=n1.exec(a);if(null===c)throw new Error("PropertyBinding: Cannot parse trackName: "+a);const h={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]},p=h.nodeName&&h.nodeName.lastIndexOf(".");if(void 0!==p&&-1!==p){const g=h.nodeName.substring(p+1);-1!==r1.indexOf(g)&&(h.nodeName=h.nodeName.substring(0,p),h.objectName=g)}if(null===h.propertyName||0===h.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+a);return h}static findNode(a,c){if(void 0===c||""===c||"."===c||-1===c||c===a.name||c===a.uuid)return a;if(a.skeleton){const h=a.skeleton.getBoneByName(c);if(void 0!==h)return h}if(a.children){const h=function(g){for(let _=0;_<g.length;_++){const w=g[_];if(w.name===c||w.uuid===c)return w;const M=h(w.children);if(M)return M}return null},p=h(a.children);if(p)return p}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,c){a[c]=this.targetObject[this.propertyName]}_getValue_array(a,c){const h=this.resolvedProperty;for(let p=0,g=h.length;p!==g;++p)a[c++]=h[p]}_getValue_arrayElement(a,c){a[c]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,c){this.resolvedProperty.toArray(a,c)}_setValue_direct(a,c){this.targetObject[this.propertyName]=a[c]}_setValue_direct_setNeedsUpdate(a,c){this.targetObject[this.propertyName]=a[c],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,c){this.targetObject[this.propertyName]=a[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,c){const h=this.resolvedProperty;for(let p=0,g=h.length;p!==g;++p)h[p]=a[c++]}_setValue_array_setNeedsUpdate(a,c){const h=this.resolvedProperty;for(let p=0,g=h.length;p!==g;++p)h[p]=a[c++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,c){const h=this.resolvedProperty;for(let p=0,g=h.length;p!==g;++p)h[p]=a[c++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,c){this.resolvedProperty[this.propertyIndex]=a[c]}_setValue_arrayElement_setNeedsUpdate(a,c){this.resolvedProperty[this.propertyIndex]=a[c],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,c){this.resolvedProperty[this.propertyIndex]=a[c],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,c){this.resolvedProperty.fromArray(a,c)}_setValue_fromArray_setNeedsUpdate(a,c){this.resolvedProperty.fromArray(a,c),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,c){this.resolvedProperty.fromArray(a,c),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,c){this.bind(),this.getValue(a,c)}_setValue_unbound(a,c){this.bind(),this.setValue(a,c)}bind(){let a=this.node;const c=this.parsedPath,h=c.objectName,p=c.propertyName;let g=c.propertyIndex;if(a||(a=d.findNode(this.rootNode,c.nodeName)||this.rootNode,this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(h){let S=c.objectIndex;switch(h){case"materials":if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);a=a.skeleton.bones;for(let T=0;T<a.length;T++)if(a[T].name===S){S=T;break}break;default:if(void 0===a[h])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);a=a[h]}if(void 0!==S){if(void 0===a[S])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);a=a[S]}}const _=a[p];if(void 0===_)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+c.nodeName+"."+p+" but it wasn't found.",a);let w=this.Versioning.None;this.targetObject=a,void 0!==a.needsUpdate?w=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(w=this.Versioning.MatrixWorldNeedsUpdate);let M=this.BindingType.Direct;if(void 0!==g){if("morphTargetInfluences"===p){if(!a.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!a.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!a.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==a.morphTargetDictionary[g]&&(g=a.morphTargetDictionary[g])}M=this.BindingType.ArrayElement,this.resolvedProperty=_,this.propertyIndex=g}else void 0!==_.fromArray&&void 0!==_.toArray?(M=this.BindingType.HasFromToArray,this.resolvedProperty=_):Array.isArray(_)?(M=this.BindingType.EntireArray,this.resolvedProperty=_):this.propertyName=p;this.getValue=this.GetterByBindingType[M],this.setValue=this.SetterByBindingTypeAndVersioning[M][w]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return d.Composite=Gw,d})();mr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},mr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},mr.prototype.GetterByBindingType=[mr.prototype._getValue_direct,mr.prototype._getValue_array,mr.prototype._getValue_arrayElement,mr.prototype._getValue_toArray],mr.prototype.SetterByBindingTypeAndVersioning=[[mr.prototype._setValue_direct,mr.prototype._setValue_direct_setNeedsUpdate,mr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mr.prototype._setValue_array,mr.prototype._setValue_array_setNeedsUpdate,mr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mr.prototype._setValue_arrayElement,mr.prototype._setValue_arrayElement_setNeedsUpdate,mr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mr.prototype._setValue_fromArray,mr.prototype._setValue_fromArray_setNeedsUpdate,mr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Qv{constructor(){this.uuid=ha(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const r={};this._indicesByUUID=r;for(let c=0,h=arguments.length;c!==h;++c)r[arguments[c].uuid]=c;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}add(){const r=this._objects,a=this._indicesByUUID,c=this._paths,h=this._parsedPaths,p=this._bindings,g=p.length;let _,w=r.length,M=this.nCachedObjects_;for(let S=0,T=arguments.length;S!==T;++S){const D=arguments[S],R=D.uuid;let L=a[R];if(void 0===L){L=w++,a[R]=L,r.push(D);for(let P=0,I=g;P!==I;++P)p[P].push(new mr(D,c[P],h[P]))}else if(L<M){_=r[L];const P=--M,I=r[P];a[I.uuid]=L,r[L]=I,a[R]=P,r[P]=D;for(let z=0,B=g;z!==B;++z){const j=p[z];let K=j[L];j[L]=j[P],void 0===K&&(K=new mr(D,c[z],h[z])),j[P]=K}}else r[L]!==_&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=M}remove(){const r=this._objects,a=this._indicesByUUID,c=this._bindings,h=c.length;let p=this.nCachedObjects_;for(let g=0,_=arguments.length;g!==_;++g){const w=arguments[g],M=w.uuid,S=a[M];if(void 0!==S&&S>=p){const T=p++,D=r[T];a[D.uuid]=S,r[S]=D,a[M]=T,r[T]=w;for(let R=0,L=h;R!==L;++R){const P=c[R],z=P[S];P[S]=P[T],P[T]=z}}}this.nCachedObjects_=p}uncache(){const r=this._objects,a=this._indicesByUUID,c=this._bindings,h=c.length;let p=this.nCachedObjects_,g=r.length;for(let _=0,w=arguments.length;_!==w;++_){const S=arguments[_].uuid,T=a[S];if(void 0!==T)if(delete a[S],T<p){const D=--p,R=r[D],L=--g,P=r[L];a[R.uuid]=T,r[T]=R,a[P.uuid]=D,r[D]=P,r.pop();for(let I=0,z=h;I!==z;++I){const B=c[I],H=B[L];B[T]=B[D],B[D]=H,B.pop()}}else{const D=--g,R=r[D];D>0&&(a[R.uuid]=T),r[T]=R,r.pop();for(let L=0,P=h;L!==P;++L){const I=c[L];I[T]=I[D],I.pop()}}}this.nCachedObjects_=p}subscribe_(r,a){const c=this._bindingsIndicesByPath;let h=c[r];const p=this._bindings;if(void 0!==h)return p[h];const g=this._paths,_=this._parsedPaths,w=this._objects,S=this.nCachedObjects_,T=new Array(w.length);h=p.length,c[r]=h,g.push(r),_.push(a),p.push(T);for(let D=S,R=w.length;D!==R;++D)T[D]=new mr(w[D],r,a);return T}unsubscribe_(r){const a=this._bindingsIndicesByPath,c=a[r];if(void 0!==c){const h=this._paths,p=this._parsedPaths,g=this._bindings,_=g.length-1,w=g[_];a[r[_]]=c,g[c]=w,g.pop(),p[c]=p[_],p.pop(),h[c]=h[_],h.pop()}}}Qv.prototype.isAnimationObjectGroup=!0;class s1{constructor(r,a,c=null,h=a.blendMode){this._mixer=r,this._clip=a,this._localRoot=c,this.blendMode=h;const p=a.tracks,g=p.length,_=new Array(g),w={endingStart:bu,endingEnd:bu};for(let M=0;M!==g;++M){const S=p[M].createInterpolant(null);_[M]=S,S.settings=w}this._interpolantSettings=w,this._interpolants=_,this._propertyBindings=new Array(g),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(r){return this._startTime=r,this}setLoop(r,a){return this.loop=r,this.repetitions=a,this}setEffectiveWeight(r){return this.weight=r,this._effectiveWeight=this.enabled?r:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(r){return this._scheduleFading(r,0,1)}fadeOut(r){return this._scheduleFading(r,1,0)}crossFadeFrom(r,a,c){if(r.fadeOut(a),this.fadeIn(a),c){const h=this._clip.duration,p=r._clip.duration,_=h/p;r.warp(1,p/h,a),this.warp(_,1,a)}return this}crossFadeTo(r,a,c){return r.crossFadeFrom(this,a,c)}stopFading(){const r=this._weightInterpolant;return null!==r&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}setEffectiveTimeScale(r){return this.timeScale=r,this._effectiveTimeScale=this.paused?0:r,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(r){return this.timeScale=this._clip.duration/r,this.stopWarping()}syncWith(r){return this.time=r.time,this.timeScale=r.timeScale,this.stopWarping()}halt(r){return this.warp(this._effectiveTimeScale,0,r)}warp(r,a,c){const h=this._mixer,p=h.time,g=this.timeScale;let _=this._timeScaleInterpolant;null===_&&(_=h._lendControlInterpolant(),this._timeScaleInterpolant=_);const w=_.parameterPositions,M=_.sampleValues;return w[0]=p,w[1]=p+c,M[0]=r/g,M[1]=a/g,this}stopWarping(){const r=this._timeScaleInterpolant;return null!==r&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(r,a,c,h){if(!this.enabled)return void this._updateWeight(r);const p=this._startTime;if(null!==p){const w=(r-p)*c;if(w<0||0===c)return;this._startTime=null,a=c*w}a*=this._updateTimeScale(r);const g=this._updateTime(a),_=this._updateWeight(r);if(_>0){const w=this._interpolants,M=this._propertyBindings;if(2501===this.blendMode)for(let S=0,T=w.length;S!==T;++S)w[S].evaluate(g),M[S].accumulateAdditive(_);else for(let S=0,T=w.length;S!==T;++S)w[S].evaluate(g),M[S].accumulate(h,_)}}_updateWeight(r){let a=0;if(this.enabled){a=this.weight;const c=this._weightInterpolant;if(null!==c){const h=c.evaluate(r)[0];a*=h,r>c.parameterPositions[1]&&(this.stopFading(),0===h&&(this.enabled=!1))}}return this._effectiveWeight=a,a}_updateTimeScale(r){let a=0;if(!this.paused){a=this.timeScale;const c=this._timeScaleInterpolant;null!==c&&(a*=c.evaluate(r)[0],r>c.parameterPositions[1]&&(this.stopWarping(),0===a?this.paused=!0:this.timeScale=a))}return this._effectiveTimeScale=a,a}_updateTime(r){const a=this._clip.duration,c=this.loop;let h=this.time+r,p=this._loopCount;const g=2202===c;if(0===r)return-1===p?h:g&&1==(1&p)?a-h:h;if(2200===c){-1===p&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(h>=a)h=a;else{if(!(h<0)){this.time=h;break e}h=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:r<0?-1:1})}}else{if(-1===p&&(r>=0?(p=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g)),h>=a||h<0){const _=Math.floor(h/a);h-=a*_,p+=Math.abs(_);const w=this.repetitions-p;if(w<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,h=r>0?a:0,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:r>0?1:-1});else{if(1===w){const M=r<0;this._setEndings(M,!M,g)}else this._setEndings(!1,!1,g);this._loopCount=p,this.time=h,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:_})}}else this.time=h;if(g&&1==(1&p))return a-h}return h}_setEndings(r,a,c){const h=this._interpolantSettings;c?(h.endingStart=kh,h.endingEnd=kh):(h.endingStart=r?this.zeroSlopeAtStart?kh:bu:km,h.endingEnd=a?this.zeroSlopeAtEnd?kh:bu:km)}_scheduleFading(r,a,c){const h=this._mixer,p=h.time;let g=this._weightInterpolant;null===g&&(g=h._lendControlInterpolant(),this._weightInterpolant=g);const _=g.parameterPositions,w=g.sampleValues;return _[0]=p,w[0]=a,_[1]=p+r,w[1]=c,this}}class Ww extends Tc{constructor(r){super(),this._root=r,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(r,a){const c=r._localRoot||this._root,h=r._clip.tracks,p=h.length,g=r._propertyBindings,_=r._interpolants,w=c.uuid,M=this._bindingsByRootAndName;let S=M[w];void 0===S&&(S={},M[w]=S);for(let T=0;T!==p;++T){const D=h[T],R=D.name;let L=S[R];if(void 0!==L)++L.referenceCount,g[T]=L;else{if(L=g[T],void 0!==L){null===L._cacheIndex&&(++L.referenceCount,this._addInactiveBinding(L,w,R));continue}L=new Jv(mr.create(c,R,a&&a._propertyBindings[T].binding.parsedPath),D.ValueTypeName,D.getValueSize()),++L.referenceCount,this._addInactiveBinding(L,w,R),g[T]=L}_[T].resultBuffer=L.buffer}}_activateAction(r){if(!this._isActiveAction(r)){if(null===r._cacheIndex){const c=(r._localRoot||this._root).uuid,h=r._clip.uuid,p=this._actionsByClip[h];this._bindAction(r,p&&p.knownActions[0]),this._addInactiveAction(r,h,c)}const a=r._propertyBindings;for(let c=0,h=a.length;c!==h;++c){const p=a[c];0==p.useCount++&&(this._lendBinding(p),p.saveOriginalState())}this._lendAction(r)}}_deactivateAction(r){if(this._isActiveAction(r)){const a=r._propertyBindings;for(let c=0,h=a.length;c!==h;++c){const p=a[c];0==--p.useCount&&(p.restoreOriginalState(),this._takeBackBinding(p))}this._takeBackAction(r)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const r=this;this.stats={actions:{get total(){return r._actions.length},get inUse(){return r._nActiveActions}},bindings:{get total(){return r._bindings.length},get inUse(){return r._nActiveBindings}},controlInterpolants:{get total(){return r._controlInterpolants.length},get inUse(){return r._nActiveControlInterpolants}}}}_isActiveAction(r){const a=r._cacheIndex;return null!==a&&a<this._nActiveActions}_addInactiveAction(r,a,c){const h=this._actions,p=this._actionsByClip;let g=p[a];if(void 0===g)g={knownActions:[r],actionByRoot:{}},r._byClipCacheIndex=0,p[a]=g;else{const _=g.knownActions;r._byClipCacheIndex=_.length,_.push(r)}r._cacheIndex=h.length,h.push(r),g.actionByRoot[c]=r}_removeInactiveAction(r){const a=this._actions,c=a[a.length-1],h=r._cacheIndex;c._cacheIndex=h,a[h]=c,a.pop(),r._cacheIndex=null;const p=r._clip.uuid,g=this._actionsByClip,_=g[p],w=_.knownActions,M=w[w.length-1],S=r._byClipCacheIndex;M._byClipCacheIndex=S,w[S]=M,w.pop(),r._byClipCacheIndex=null,delete _.actionByRoot[(r._localRoot||this._root).uuid],0===w.length&&delete g[p],this._removeInactiveBindingsForAction(r)}_removeInactiveBindingsForAction(r){const a=r._propertyBindings;for(let c=0,h=a.length;c!==h;++c){const p=a[c];0==--p.referenceCount&&this._removeInactiveBinding(p)}}_lendAction(r){const a=this._actions,c=r._cacheIndex,h=this._nActiveActions++,p=a[h];r._cacheIndex=h,a[h]=r,p._cacheIndex=c,a[c]=p}_takeBackAction(r){const a=this._actions,c=r._cacheIndex,h=--this._nActiveActions,p=a[h];r._cacheIndex=h,a[h]=r,p._cacheIndex=c,a[c]=p}_addInactiveBinding(r,a,c){const h=this._bindingsByRootAndName,p=this._bindings;let g=h[a];void 0===g&&(g={},h[a]=g),g[c]=r,r._cacheIndex=p.length,p.push(r)}_removeInactiveBinding(r){const a=this._bindings,c=r.binding,h=c.rootNode.uuid,p=c.path,g=this._bindingsByRootAndName,_=g[h],w=a[a.length-1],M=r._cacheIndex;w._cacheIndex=M,a[M]=w,a.pop(),delete _[p],0===Object.keys(_).length&&delete g[h]}_lendBinding(r){const a=this._bindings,c=r._cacheIndex,h=this._nActiveBindings++,p=a[h];r._cacheIndex=h,a[h]=r,p._cacheIndex=c,a[c]=p}_takeBackBinding(r){const a=this._bindings,c=r._cacheIndex,h=--this._nActiveBindings,p=a[h];r._cacheIndex=h,a[h]=r,p._cacheIndex=c,a[c]=p}_lendControlInterpolant(){const r=this._controlInterpolants,a=this._nActiveControlInterpolants++;let c=r[a];return void 0===c&&(c=new Fg(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=a,r[a]=c),c}_takeBackControlInterpolant(r){const a=this._controlInterpolants,c=r.__cacheIndex,h=--this._nActiveControlInterpolants,p=a[h];r.__cacheIndex=h,a[h]=r,p.__cacheIndex=c,a[c]=p}clipAction(r,a,c){const h=a||this._root,p=h.uuid;let g="string"==typeof r?Td.findByName(h,r):r;const _=null!==g?g.uuid:r,w=this._actionsByClip[_];let M=null;if(void 0===c&&(c=null!==g?g.blendMode:2500),void 0!==w){const T=w.actionByRoot[p];if(void 0!==T&&T.blendMode===c)return T;M=w.knownActions[0],null===g&&(g=M._clip)}if(null===g)return null;const S=new s1(this,g,a,c);return this._bindAction(S,M),this._addInactiveAction(S,_,p),S}existingAction(r,a){const c=a||this._root,h=c.uuid,p="string"==typeof r?Td.findByName(c,r):r,_=this._actionsByClip[p?p.uuid:r];return void 0!==_&&_.actionByRoot[h]||null}stopAllAction(){const r=this._actions;for(let c=this._nActiveActions-1;c>=0;--c)r[c].stop();return this}update(r){const a=this._actions,c=this._nActiveActions,h=this.time+=r*=this.timeScale,p=Math.sign(r),g=this._accuIndex^=1;for(let M=0;M!==c;++M)a[M]._update(h,r,p,g);const _=this._bindings,w=this._nActiveBindings;for(let M=0;M!==w;++M)_[M].apply(g);return this}setTime(r){this.time=0;for(let a=0;a<this._actions.length;a++)this._actions[a].time=0;return this.update(r)}getRoot(){return this._root}uncacheClip(r){const a=this._actions,c=r.uuid,h=this._actionsByClip,p=h[c];if(void 0!==p){const g=p.knownActions;for(let _=0,w=g.length;_!==w;++_){const M=g[_];this._deactivateAction(M);const S=M._cacheIndex,T=a[a.length-1];M._cacheIndex=null,M._byClipCacheIndex=null,T._cacheIndex=S,a[S]=T,a.pop(),this._removeInactiveBindingsForAction(M)}delete h[c]}}uncacheRoot(r){const a=r.uuid,c=this._actionsByClip;for(const g in c){const w=c[g].actionByRoot[a];void 0!==w&&(this._deactivateAction(w),this._removeInactiveAction(w))}const p=this._bindingsByRootAndName[a];if(void 0!==p)for(const g in p){const _=p[g];_.restoreOriginalState(),this._removeInactiveBinding(_)}}uncacheAction(r,a){const c=this.existingAction(r,a);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}}Ww.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class e0{constructor(r){"string"==typeof r&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),r=arguments[1]),this.value=r}clone(){return new e0(void 0===this.value.clone?this.value:this.value.clone())}}class qw extends gd{constructor(r,a,c=1){super(r,a),this.meshPerAttribute=c}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}clone(r){const a=super.clone(r);return a.meshPerAttribute=this.meshPerAttribute,a}toJSON(r){const a=super.toJSON(r);return a.isInstancedInterleavedBuffer=!0,a.meshPerAttribute=this.meshPerAttribute,a}}qw.prototype.isInstancedInterleavedBuffer=!0;class zg{constructor(r,a,c,h,p){this.buffer=r,this.type=a,this.itemSize=c,this.elementSize=h,this.count=p,this.version=0}set needsUpdate(r){!0===r&&this.version++}setBuffer(r){return this.buffer=r,this}setType(r,a){return this.type=r,this.elementSize=a,this}setItemSize(r){return this.itemSize=r,this}setCount(r){return this.count=r,this}}function jw(d,r){return d.distance-r.distance}function Xw(d,r,a,c){if(d.layers.test(r.layers)&&d.raycast(r,a),!0===c){const h=d.children;for(let p=0,g=h.length;p<g;p++)Xw(h[p],r,a,!0)}}zg.prototype.isGLBufferAttribute=!0;const Yw=new Qe;class rh{constructor(r=new Qe(1/0,1/0),a=new Qe(-1/0,-1/0)){this.min=r,this.max=a}set(r,a){return this.min.copy(r),this.max.copy(a),this}setFromPoints(r){this.makeEmpty();for(let a=0,c=r.length;a<c;a++)this.expandByPoint(r[a]);return this}setFromCenterAndSize(r,a){const c=Yw.copy(a).multiplyScalar(.5);return this.min.copy(r).sub(c),this.max.copy(r).add(c),this}clone(){return(new this.constructor).copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(r){return this.isEmpty()?r.set(0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y}getParameter(r,a){return a.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y)}clampPoint(r,a){return a.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return Yw.copy(r).clamp(this.min,this.max).sub(r).length()}intersect(r){return this.min.max(r.min),this.max.min(r.max),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}rh.prototype.isBox2=!0;const o1=new J,Hg=new J;class sh{constructor(r=new J,a=new J){this.start=r,this.end=a}set(r,a){return this.start.copy(r),this.end.copy(a),this}copy(r){return this.start.copy(r.start),this.end.copy(r.end),this}getCenter(r){return r.addVectors(this.start,this.end).multiplyScalar(.5)}delta(r){return r.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(r,a){return this.delta(a).multiplyScalar(r).add(this.start)}closestPointToPointParameter(r,a){o1.subVectors(r,this.start),Hg.subVectors(this.end,this.start);const c=Hg.dot(Hg);let p=Hg.dot(o1)/c;return a&&(p=ns(p,0,1)),p}closestPointToPoint(r,a,c){const h=this.closestPointToPointParameter(r,a);return this.delta(c).multiplyScalar(h).add(this.start)}applyMatrix4(r){return this.start.applyMatrix4(r),this.end.applyMatrix4(r),this}equals(r){return r.start.equals(this.start)&&r.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Kw=new J,qc=new J,Up=new on,Fd=new on;class Zw extends Co{constructor(r){const a=n0(r),c=new Jt,h=[],p=[],g=new Tt(0,0,1),_=new Tt(0,1,0);for(let M=0;M<a.length;M++){const S=a[M];S.parent&&S.parent.isBone&&(h.push(0,0,0),h.push(0,0,0),p.push(g.r,g.g,g.b),p.push(_.r,_.g,_.b))}c.setAttribute("position",new en(h,3)),c.setAttribute("color",new en(p,3)),super(c,new Ps({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=r,this.bones=a,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(r){const a=this.bones,c=this.geometry,h=c.getAttribute("position");Fd.copy(this.root.matrixWorld).invert();for(let p=0,g=0;p<a.length;p++){const _=a[p];_.parent&&_.parent.isBone&&(Up.multiplyMatrices(Fd,_.matrixWorld),qc.setFromMatrixPosition(Up),h.setXYZ(g,qc.x,qc.y,qc.z),Up.multiplyMatrices(Fd,_.parent.matrixWorld),qc.setFromMatrixPosition(Up),h.setXYZ(g+1,qc.x,qc.y,qc.z),g+=2)}c.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(r)}}function n0(d){const r=[];!0===d.isBone&&r.push(d);for(let a=0;a<d.children.length;a++)r.push.apply(r,n0(d.children[a]));return r}const l1=new J,Jw=new Tt,Qw=new Tt;class r0 extends Co{constructor(r=10,a=10,c=4473924,h=8947848){c=new Tt(c),h=new Tt(h);const p=a/2,g=r/a,_=r/2,w=[],M=[];for(let D=0,R=0,L=-_;D<=a;D++,L+=g){w.push(-_,0,L,_,0,L),w.push(L,0,-_,L,0,_);const P=D===p?c:h;P.toArray(M,R),R+=3,P.toArray(M,R),R+=3,P.toArray(M,R),R+=3,P.toArray(M,R),R+=3}const S=new Jt;S.setAttribute("position",new en(w,3)),S.setAttribute("color",new en(M,3)),super(S,new Ps({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const s0=new J,zp=new J,Gg=new J,Nd=new J,Hr=new Hf;function He(d,r,a,c,h,p,g){Nd.set(h,p,g).unproject(c);const _=r[d];if(void 0!==_){const w=a.getAttribute("position");for(let M=0,S=_.length;M<S;M++)w.setXYZ(_[M],Nd.x,Nd.y,Nd.z)}}const Wg=new Mo;class Xe extends Co{constructor(r,a=16776960){const c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),h=new Float32Array(24),p=new Jt;p.setIndex(new Pi(c,1)),p.setAttribute("position",new Pi(h,3)),super(p,new Ps({color:a,toneMapped:!1})),this.object=r,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(r){if(void 0!==r&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Wg.setFromObject(this.object),Wg.isEmpty())return;const a=Wg.min,c=Wg.max,h=this.geometry.attributes.position,p=h.array;p[0]=c.x,p[1]=c.y,p[2]=c.z,p[3]=a.x,p[4]=c.y,p[5]=c.z,p[6]=a.x,p[7]=a.y,p[8]=c.z,p[9]=c.x,p[10]=a.y,p[11]=c.z,p[12]=c.x,p[13]=c.y,p[14]=a.z,p[15]=a.x,p[16]=c.y,p[17]=a.z,p[18]=a.x,p[19]=a.y,p[20]=a.z,p[21]=c.x,p[22]=a.y,p[23]=a.z,h.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(r){return this.object=r,this.update(),this}copy(r){return Co.prototype.copy.call(this,r),this.object=r.object,this}}const De=new J;let Se,Ei;class eM extends Co{constructor(r=1){const a=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],h=new Jt;h.setAttribute("position",new en(a,3)),h.setAttribute("color",new en([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(h,new Ps({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(r,a,c){const h=new Tt,p=this.geometry.attributes.color.array;return h.set(r),h.toArray(p,0),h.toArray(p,3),h.set(a),h.toArray(p,6),h.toArray(p,9),h.set(c),h.toArray(p,12),h.toArray(p,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const qg=new ArrayBuffer(4),ir=new Float32Array(qg),Hp=new Uint32Array(qg),Aa=new Uint32Array(512),Da=new Uint32Array(512);for(let d=0;d<256;++d){const r=d-127;r<-27?(Aa[d]=0,Aa[256|d]=32768,Da[d]=24,Da[256|d]=24):r<-14?(Aa[d]=1024>>-r-14,Aa[256|d]=1024>>-r-14|32768,Da[d]=-r-1,Da[256|d]=-r-1):r<=15?(Aa[d]=r+15<<10,Aa[256|d]=r+15<<10|32768,Da[d]=13,Da[256|d]=13):r<128?(Aa[d]=31744,Aa[256|d]=64512,Da[d]=24,Da[256|d]=24):(Aa[d]=31744,Aa[256|d]=64512,Da[d]=13,Da[256|d]=13)}const Vt=new Uint32Array(2048),oh=new Uint32Array(64),tM=new Uint32Array(64);for(let d=1;d<1024;++d){let r=d<<13,a=0;for(;0==(8388608&r);)r<<=1,a-=8388608;r&=-8388609,a+=947912704,Vt[d]=r|a}for(let d=1024;d<2048;++d)Vt[d]=939524096+(d-1024<<13);for(let d=1;d<31;++d)oh[d]=d<<23;oh[31]=1199570944,oh[32]=2147483648;for(let d=33;d<63;++d)oh[d]=2147483648+(d-32<<23);oh[63]=3347054592;for(let d=1;d<64;++d)32!==d&&(tM[d]=1024);cs.create=function(d,r){return console.log("THREE.Curve.create() has been deprecated"),d.prototype=Object.create(cs.prototype),d.prototype.constructor=d,d.prototype.getPoint=r,d},Jl.prototype.fromPoints=function(d){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(d)},r0.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Zw.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Do.prototype.extractUrlBase=function(d){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Og.extractUrlBase(d)},Do.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},rh.prototype.center=function(d){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(d)},rh.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},rh.prototype.isIntersectionBox=function(d){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(d)},rh.prototype.size=function(d){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(d)},Mo.prototype.center=function(d){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(d)},Mo.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Mo.prototype.isIntersectionBox=function(d){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(d)},Mo.prototype.isIntersectionSphere=function(d){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(d)},Mo.prototype.size=function(d){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(d)},ys.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Cu.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Wf.prototype.setFromMatrix=function(d){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(d)},sh.prototype.center=function(d){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(d)},Yi.prototype.flattenToArrayOffset=function(d,r){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(d,r)},Yi.prototype.multiplyVector3=function(d){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),d.applyMatrix3(this)},Yi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Yi.prototype.applyToBufferAttribute=function(d){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),d.applyMatrix3(this)},Yi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Yi.prototype.getInverse=function(d){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(d).invert()},on.prototype.extractPosition=function(d){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(d)},on.prototype.flattenToArrayOffset=function(d,r){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(d,r)},on.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new J).setFromMatrixColumn(this,3)},on.prototype.setRotationFromQuaternion=function(d){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(d)},on.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},on.prototype.multiplyVector3=function(d){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),d.applyMatrix4(this)},on.prototype.multiplyVector4=function(d){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),d.applyMatrix4(this)},on.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},on.prototype.rotateAxis=function(d){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),d.transformDirection(this)},on.prototype.crossVector=function(d){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),d.applyMatrix4(this)},on.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},on.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},on.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},on.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},on.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},on.prototype.applyToBufferAttribute=function(d){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),d.applyMatrix4(this)},on.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},on.prototype.makeFrustum=function(d,r,a,c,h,p){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(d,r,c,a,h,p)},on.prototype.getInverse=function(d){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(d).invert()},Js.prototype.isIntersectionLine=function(d){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(d)},Zs.prototype.multiplyVector3=function(d){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),d.applyQuaternion(this)},Zs.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},No.prototype.isIntersectionBox=function(d){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(d)},No.prototype.isIntersectionPlane=function(d){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(d)},No.prototype.isIntersectionSphere=function(d){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(d)},Vr.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Vr.prototype.barycoordFromPoint=function(d,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(d,r)},Vr.prototype.midpoint=function(d){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(d)},Vr.prototypenormal=function(d){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(d)},Vr.prototype.plane=function(d){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(d)},Vr.barycoordFromPoint=function(d,r,a,c,h){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Vr.getBarycoord(d,r,a,c,h)},Vr.normal=function(d,r,a,c){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Vr.getNormal(d,r,a,c)},ec.prototype.extractAllPoints=function(d){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(d)},ec.prototype.extrude=function(d){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new tc(this,d)},ec.prototype.makeGeometry=function(d){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new kc(this,d)},Qe.prototype.fromAttribute=function(d,r,a){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(d,r,a)},Qe.prototype.distanceToManhattan=function(d){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(d)},Qe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},J.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},J.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},J.prototype.getPositionFromMatrix=function(d){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(d)},J.prototype.getScaleFromMatrix=function(d){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(d)},J.prototype.getColumnFromMatrix=function(d,r){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(r,d)},J.prototype.applyProjection=function(d){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(d)},J.prototype.fromAttribute=function(d,r,a){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(d,r,a)},J.prototype.distanceToManhattan=function(d){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(d)},J.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ki.prototype.fromAttribute=function(d,r,a){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(d,r,a)},ki.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},_i.prototype.getChildByName=function(d){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(d)},_i.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},_i.prototype.translate=function(d,r){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(r,d)},_i.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},_i.prototype.applyMatrix=function(d){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(d)},Object.defineProperties(_i.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(d){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=d}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Kr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Kr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),vd.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ds.prototype.setLens=function(d,r){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==r&&(this.filmGauge=r),this.setFocalLength(d)},Object.defineProperties(na.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(d){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=d}},shadowCameraLeft:{set:function(d){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=d}},shadowCameraRight:{set:function(d){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=d}},shadowCameraTop:{set:function(d){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=d}},shadowCameraBottom:{set:function(d){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=d}},shadowCameraNear:{set:function(d){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=d}},shadowCameraFar:{set:function(d){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=d}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(d){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=d}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(d){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=d}},shadowMapHeight:{set:function(d){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=d}}}),Object.defineProperties(Pi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===En},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(En)}}}),Pi.prototype.setDynamic=function(d){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===d?En:Uh),this},Pi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Pi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Jt.prototype.addIndex=function(d){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(d)},Jt.prototype.addAttribute=function(d,r){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),r&&r.isBufferAttribute||r&&r.isInterleavedBufferAttribute?"index"===d?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(r),this):this.setAttribute(d,r):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(d,new Pi(arguments[1],arguments[2])))},Jt.prototype.addDrawCall=function(d,r,a){void 0!==a&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(d,r)},Jt.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Jt.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Jt.prototype.removeAttribute=function(d){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(d)},Jt.prototype.applyMatrix=function(d){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(d)},Object.defineProperties(Jt.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),gd.prototype.setDynamic=function(d){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===d?En:Uh),this},gd.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},tc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},tc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},tc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},up.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},e0.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Zt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Tt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(d){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===d}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(d){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=d}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(va.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(d){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=d}}}),tr.prototype.clearTarget=function(d,r,a,c){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(d),this.clear(r,a,c)},tr.prototype.animate=function(d){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(d)},tr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},tr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},tr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},tr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},tr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},tr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},tr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},tr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},tr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},tr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},tr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},tr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},tr.prototype.enableScissorTest=function(d){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(d)},tr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},tr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},tr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},tr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},tr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},tr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},tr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},tr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},tr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},tr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(tr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(d){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=d}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(d){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=d}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(d){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===d?wr:Cs}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(dv.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(rs.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(d){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=d}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(d){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=d}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(d){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=d}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(d){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=d}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(d){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=d}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(d){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=d}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(d){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=d}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(d){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=d}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(d){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=d}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(d){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=d}}}),Gc.prototype.load=function(d){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const r=this;return(new Ya).load(d,function(c){r.setBuffer(c)}),this},Zv.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ru.prototype.updateCubeMap=function(d,r){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(d,r)},Ru.prototype.clear=function(d,r,a,c){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(d,r,a,c)},da.crossOrigin=void 0,da.loadTexture=function(d,r,a,c){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const h=new $T;h.setCrossOrigin(this.crossOrigin);const p=h.load(d,a,void 0,c);return r&&(p.mapping=r),p},da.loadTextureCube=function(d,r,a,c){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const h=new Pw;h.setCrossOrigin(this.crossOrigin);const p=h.load(d,a,void 0,c);return r&&(p.mapping=r),p},da.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},da.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const yM={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"139"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="139"),O.ACESFilmicToneMapping=4,O.AddEquation=100,O.AddOperation=2,O.AdditiveAnimationBlendMode=2501,O.AdditiveBlending=2,O.AlphaFormat=1021,O.AlwaysDepth=1,O.AlwaysStencilFunc=519,O.AmbientLight=Xv,O.AmbientLightProbe=Qs,O.AnimationClip=Td,O.AnimationLoader=class nI extends Do{constructor(r){super(r)}load(r,a,c,h){const p=this,g=new Xa(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(r,function(_){try{a(p.parse(JSON.parse(_)))}catch(w){h?h(w):console.error(w),p.manager.itemError(r)}},c,h)}parse(r){const a=[];for(let c=0;c<r.length;c++){const h=Td.parse(r[c]);a.push(h)}return a}},O.AnimationMixer=Ww,O.AnimationObjectGroup=Qv,O.AnimationUtils=vr,O.ArcCurve=Sv,O.ArrayCamera=pd,O.ArrowHelper=class aI extends _i{constructor(r=new J(0,0,1),a=new J(0,0,0),c=1,h=16776960,p=.2*c,g=.2*p){super(),this.type="ArrowHelper",void 0===Se&&(Se=new Jt,Se.setAttribute("position",new en([0,0,0,0,1,0],3)),Ei=new Ql(0,.5,1,5,1),Ei.translate(0,-.5,0)),this.position.copy(a),this.line=new Kl(Se,new Ps({color:h,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Kr(Ei,new ul({color:h,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(c,p,g)}setDirection(r){if(r.y>.99999)this.quaternion.set(0,0,0,1);else if(r.y<-.99999)this.quaternion.set(1,0,0,0);else{De.set(r.z,0,-r.x).normalize();const a=Math.acos(r.y);this.quaternion.setFromAxisAngle(De,a)}}setLength(r,a=.2*r,c=.2*a){this.line.scale.set(1,Math.max(1e-4,r-a),1),this.line.updateMatrix(),this.cone.scale.set(c,a,c),this.cone.position.y=r,this.cone.updateMatrix()}setColor(r){this.line.material.color.set(r),this.cone.material.color.set(r)}copy(r){return super.copy(r,!1),this.line.copy(r.line),this.cone.copy(r.cone),this}},O.Audio=Gc,O.AudioAnalyser=Zv,O.AudioContext=kp,O.AudioListener=class Ld extends _i{constructor(){super(),this.type="AudioListener",this.context=kp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new th}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(r){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=r,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}updateMatrixWorld(r){super.updateMatrixWorld(r);const a=this.context.listener,c=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Sa,ih,Id),Ca.set(0,0,-1).applyQuaternion(ih),a.positionX){const h=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(Sa.x,h),a.positionY.linearRampToValueAtTime(Sa.y,h),a.positionZ.linearRampToValueAtTime(Sa.z,h),a.forwardX.linearRampToValueAtTime(Ca.x,h),a.forwardY.linearRampToValueAtTime(Ca.y,h),a.forwardZ.linearRampToValueAtTime(Ca.z,h),a.upX.linearRampToValueAtTime(c.x,h),a.upY.linearRampToValueAtTime(c.y,h),a.upZ.linearRampToValueAtTime(c.z,h)}else a.setPosition(Sa.x,Sa.y,Sa.z),a.setOrientation(Ca.x,Ca.y,Ca.z,c.x,c.y,c.z)}},O.AudioLoader=Ya,O.AxesHelper=eM,O.AxisHelper=class _1 extends eM{constructor(r){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),super(r)}},O.BackSide=1,O.BasicDepthPacking=3200,O.BasicShadowMap=0,O.BinaryTextureLoader=class gM extends KT{constructor(r){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),super(r)}},O.Bone=_p,O.BooleanKeyframeTrack=Ea,O.BoundingBoxHelper=class v1 extends Xe{constructor(r,a){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),super(r,a)}},O.Box2=rh,O.Box3=Mo,O.Box3Helper=class o0 extends Co{constructor(r,a=16776960){const c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),p=new Jt;p.setIndex(new Pi(c,1)),p.setAttribute("position",new en([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(p,new Ps({color:a,toneMapped:!1})),this.box=r,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(r){const a=this.box;a.isEmpty()||(a.getCenter(this.position),a.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(r))}},O.BoxBufferGeometry=Wl,O.BoxGeometry=Wl,O.BoxHelper=Xe,O.BufferAttribute=Pi,O.BufferGeometry=Jt,O.BufferGeometryLoader=Ow,O.ByteType=1010,O.Cache=zc,O.Camera=Hf,O.CameraHelper=class oI extends Co{constructor(r){const a=new Jt,c=new Ps({color:16777215,vertexColors:!0,toneMapped:!1}),h=[],p=[],g={},_=new Tt(16755200),w=new Tt(16711680),M=new Tt(43775),S=new Tt(16777215),T=new Tt(3355443);function D(L,P,I){R(L,I),R(P,I)}function R(L,P){h.push(0,0,0),p.push(P.r,P.g,P.b),void 0===g[L]&&(g[L]=[]),g[L].push(h.length/3-1)}D("n1","n2",_),D("n2","n4",_),D("n4","n3",_),D("n3","n1",_),D("f1","f2",_),D("f2","f4",_),D("f4","f3",_),D("f3","f1",_),D("n1","f1",_),D("n2","f2",_),D("n3","f3",_),D("n4","f4",_),D("p","n1",w),D("p","n2",w),D("p","n3",w),D("p","n4",w),D("u1","u2",M),D("u2","u3",M),D("u3","u1",M),D("c","t",S),D("p","c",T),D("cn1","cn2",T),D("cn3","cn4",T),D("cf1","cf2",T),D("cf3","cf4",T),a.setAttribute("position",new en(h,3)),a.setAttribute("color",new en(p,3)),super(a,c),this.type="CameraHelper",this.camera=r,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=g,this.update()}update(){const r=this.geometry,a=this.pointMap;Hr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),He("c",a,r,Hr,0,0,-1),He("t",a,r,Hr,0,0,1),He("n1",a,r,Hr,-1,-1,-1),He("n2",a,r,Hr,1,-1,-1),He("n3",a,r,Hr,-1,1,-1),He("n4",a,r,Hr,1,1,-1),He("f1",a,r,Hr,-1,-1,1),He("f2",a,r,Hr,1,-1,1),He("f3",a,r,Hr,-1,1,1),He("f4",a,r,Hr,1,1,1),He("u1",a,r,Hr,.7,1.1,-1),He("u2",a,r,Hr,-.7,1.1,-1),He("u3",a,r,Hr,0,2,-1),He("cf1",a,r,Hr,-1,0,1),He("cf2",a,r,Hr,1,0,1),He("cf3",a,r,Hr,0,-1,1),He("cf4",a,r,Hr,0,1,1),He("cn1",a,r,Hr,-1,0,-1),He("cn2",a,r,Hr,1,0,-1),He("cn3",a,r,Hr,0,-1,-1),He("cn4",a,r,Hr,0,1,-1),r.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},O.CanvasRenderer=function b1(){console.error("THREE.CanvasRenderer has been removed")},O.CanvasTexture=IT,O.CapsuleBufferGeometry=ju,O.CapsuleGeometry=ju,O.CatmullRomCurve3=_l,O.CineonToneMapping=3,O.CircleBufferGeometry=Sp,O.CircleGeometry=Sp,O.ClampToEdgeWrapping=fs,O.Clock=th,O.Color=Tt,O.ColorKeyframeTrack=Uv,O.ColorManagement=Rr,O.CompressedTexture=gw,O.CompressedTextureLoader=class Rw extends Do{constructor(r){super(r)}load(r,a,c,h){const p=this,g=[],_=new gw,w=new Xa(this.manager);w.setPath(this.path),w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setWithCredentials(p.withCredentials);let M=0;function S(T){w.load(r[T],function(D){const R=p.parse(D,!0);g[T]={width:R.width,height:R.height,format:R.format,mipmaps:R.mipmaps},M+=1,6===M&&(1===R.mipmapCount&&(_.minFilter=kr),_.image=g,_.format=R.format,_.needsUpdate=!0,a&&a(_))},c,h)}if(Array.isArray(r))for(let T=0,D=r.length;T<D;++T)S(T);else w.load(r,function(T){const D=p.parse(T,!0);if(D.isCubemap){const R=D.mipmaps.length/D.mipmapCount;for(let L=0;L<R;L++){g[L]={mipmaps:[]};for(let P=0;P<D.mipmapCount;P++)g[L].mipmaps.push(D.mipmaps[L*D.mipmapCount+P]),g[L].format=D.format,g[L].width=D.width,g[L].height=D.height}_.image=g}else _.image.width=D.width,_.image.height=D.height,_.mipmaps=D.mipmaps;1===D.mipmapCount&&(_.minFilter=kr),_.format=D.format,_.needsUpdate=!0,a&&a(_)},c,h);return _}},O.ConeBufferGeometry=Xu,O.ConeGeometry=Xu,O.CubeCamera=Ru,O.CubeReflectionMapping=Ii,O.CubeRefractionMapping=Va,O.CubeTexture=jl,O.CubeTextureLoader=Pw,O.CubeUVReflectionMapping=306,O.CubicBezierCurve=Zl,O.CubicBezierCurve3=Wu,O.CubicInterpolant=Qu,O.CullFaceBack=1,O.CullFaceFront=2,O.CullFaceFrontBack=3,O.CullFaceNone=0,O.Curve=cs,O.CurvePath=Dv,O.CustomBlending=5,O.CustomToneMapping=5,O.CylinderBufferGeometry=Ql,O.CylinderGeometry=Ql,O.Cylindrical=class rI{constructor(r=1,a=0,c=0){return this.radius=r,this.theta=a,this.y=c,this}set(r,a,c){return this.radius=r,this.theta=a,this.y=c,this}copy(r){return this.radius=r.radius,this.theta=r.theta,this.y=r.y,this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,a,c){return this.radius=Math.sqrt(r*r+c*c),this.theta=Math.atan2(r,c),this.y=a,this}clone(){return(new this.constructor).copy(this)}},O.Data3DTexture=ol,O.DataArrayTexture=gs,O.DataTexture=Yl,O.DataTexture2DArray=class ah extends gs{constructor(r,a,c,h){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(r,a,c,h)}},O.DataTexture3D=class Ml extends ol{constructor(r,a,c,h){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(r,a,c,h)}},O.DataTextureLoader=KT,O.DataUtils=class l0{static toHalfFloat(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=ns(r,-65504,65504),ir[0]=r;const a=Hp[0],c=a>>23&511;return Aa[c]+((8388607&a)>>Da[c])}static fromHalfFloat(r){const a=r>>10;return Hp[0]=Vt[tM[a]+(1023&r)]+oh[a],ir[0]}},O.DecrementStencilOp=7683,O.DecrementWrapStencilOp=34056,O.DefaultLoadingManager=Dw,O.DepthFormat=mn,O.DepthStencilFormat=lr,O.DepthTexture=lp,O.DirectionalLight=Li,O.DirectionalLightHelper=class sI extends _i{constructor(r,a,c){super(),this.light=r,this.light.updateMatrixWorld(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=c,void 0===a&&(a=1);let h=new Jt;h.setAttribute("position",new en([-a,a,0,a,a,0,a,-a,0,-a,-a,0,-a,a,0],3));const p=new Ps({fog:!1,toneMapped:!1});this.lightPlane=new Kl(h,p),this.add(this.lightPlane),h=new Jt,h.setAttribute("position",new en([0,0,0,0,0,1],3)),this.targetLine=new Kl(h,p),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){s0.setFromMatrixPosition(this.light.matrixWorld),zp.setFromMatrixPosition(this.light.target.matrixWorld),Gg.subVectors(zp,s0),this.lightPlane.lookAt(zp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zp),this.targetLine.scale.z=Gg.length()}},O.DiscreteInterpolant=Sw,O.DodecahedronBufferGeometry=Yu,O.DodecahedronGeometry=Yu,O.DoubleSide=2,O.DstAlphaFactor=206,O.DstColorFactor=208,O.DynamicBufferAttribute=class cM extends Pi{constructor(r,a){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),super(r,a),this.setUsage(En)}},O.DynamicCopyUsage=35050,O.DynamicDrawUsage=En,O.DynamicReadUsage=35049,O.EdgesGeometry=Rv,O.EdgesHelper=class pM extends Co{constructor(r,a){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),super(new Rv(r.geometry),new Ps({color:void 0!==a?a:16777215}))}},O.EllipseCurve=Hu,O.EqualDepth=4,O.EqualStencilFunc=514,O.EquirectangularReflectionMapping=303,O.EquirectangularRefractionMapping=304,O.Euler=ys,O.EventDispatcher=Tc,O.ExtrudeBufferGeometry=tc,O.ExtrudeGeometry=tc,O.FaceColors=1,O.FileLoader=Xa,O.FlatShading=1,O.Float16BufferAttribute=as,O.Float32Attribute=class xs extends en{constructor(r,a){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),super(r,a)}},O.Float32BufferAttribute=en,O.Float64Attribute=class fM extends $h{constructor(r,a){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),super(r,a)}},O.Float64BufferAttribute=$h,O.FloatType=W,O.Fog=Vu,O.FogExp2=md,O.Font=function Bd(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},O.FontLoader=function Lr(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},O.FramebufferTexture=PT,O.FrontSide=0,O.Frustum=Wf,O.GLBufferAttribute=zg,O.GLSL1="100",O.GLSL3=Rx,O.GreaterDepth=6,O.GreaterEqualDepth=5,O.GreaterEqualStencilFunc=518,O.GreaterStencilFunc=516,O.GridHelper=r0,O.Group=Nc,O.HalfFloatType=ie,O.HemisphereLight=Hv,O.HemisphereLightHelper=class c1 extends _i{constructor(r,a,c){super(),this.light=r,this.light.updateMatrixWorld(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=c;const h=new $u(a);h.rotateY(.5*Math.PI),this.material=new ul({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const p=h.getAttribute("position"),g=new Float32Array(3*p.count);h.setAttribute("color",new Pi(g,3)),this.add(new Kr(h,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const a=r.geometry.getAttribute("color");Jw.copy(this.light.color),Qw.copy(this.light.groundColor);for(let c=0,h=a.count;c<h;c++){const p=c<h/2?Jw:Qw;a.setXYZ(c,p.r,p.g,p.b)}a.needsUpdate=!0}r.lookAt(l1.setFromMatrixPosition(this.light.matrixWorld).negate())}},O.HemisphereLightProbe=Pd,O.IcosahedronBufferGeometry=Rp,O.IcosahedronGeometry=Rp,O.ImageBitmapLoader=kw,O.ImageLoader=Np,O.ImageUtils=da,O.ImmediateRenderObject=function wl(){console.error("THREE.ImmediateRenderObject has been removed.")},O.IncrementStencilOp=7682,O.IncrementWrapStencilOp=34055,O.InstancedBufferAttribute=yl,O.InstancedBufferGeometry=Kv,O.InstancedInterleavedBuffer=qw,O.InstancedMesh=hw,O.Int16Attribute=class m1 extends Xx{constructor(r,a){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),super(r,a)}},O.Int16BufferAttribute=Xx,O.Int32Attribute=class dM extends Mi{constructor(r,a){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),super(r,a)}},O.Int32BufferAttribute=Mi,O.Int8Attribute=class uM extends qx{constructor(r,a){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),super(r,a)}},O.Int8BufferAttribute=qx,O.IntType=1013,O.InterleavedBuffer=gd,O.InterleavedBufferAttribute=Oc,O.Interpolant=bl,O.InterpolateDiscrete=xu,O.InterpolateLinear=Mn,O.InterpolateSmooth=2302,O.InvertStencilOp=5386,O.JSONLoader=function w1(){console.error("THREE.JSONLoader has been removed.")},O.KeepStencilOp=7680,O.KeyframeTrack=ja,O.LOD=yp,O.LatheBufferGeometry=qu,O.LatheGeometry=qu,O.Layers=Xh,O.LensFlare=function M1(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},O.LessDepth=2,O.LessEqualDepth=3,O.LessEqualStencilFunc=515,O.LessStencilFunc=513,O.Light=na,O.LightProbe=Bp,O.Line=Kl,O.Line3=sh,O.LineBasicMaterial=Ps,O.LineCurve=vl,O.LineCurve3=yw,O.LineDashedMaterial=Lp,O.LineLoop=wv,O.LinePieces=1,O.LineSegments=Co,O.LineStrip=0,O.LinearEncoding=Cs,O.LinearFilter=kr,O.LinearInterpolant=Fg,O.LinearMipMapLinearFilter=1008,O.LinearMipMapNearestFilter=1007,O.LinearMipmapLinearFilter=Ua,O.LinearMipmapNearestFilter=1007,O.LinearSRGBColorSpace=Mu,O.LinearToneMapping=1,O.Loader=Do,O.LoaderUtils=Og,O.LoadingManager=zv,O.LoopOnce=2200,O.LoopPingPong=2202,O.LoopRepeat=2201,O.LuminanceAlphaFormat=1025,O.LuminanceFormat=1024,O.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},O.Material=Zt,O.MaterialLoader=Nw,O.Math=Vl,O.MathUtils=Vl,O.Matrix3=Yi,O.Matrix4=on,O.MaxEquation=104,O.Mesh=Kr,O.MeshBasicMaterial=ul,O.MeshDepthMaterial=ku,O.MeshDistanceMaterial=pg,O.MeshFaceMaterial=function f1(d){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),d},O.MeshLambertMaterial=Lg,O.MeshMatcapMaterial=Vv,O.MeshNormalMaterial=Ig,O.MeshPhongMaterial=Ip,O.MeshPhysicalMaterial=kv,O.MeshStandardMaterial=Uc,O.MeshToonMaterial=Pg,O.MinEquation=103,O.MirroredRepeatWrapping=Oh,O.MixOperation=1,O.MultiMaterial=function p1(d=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),d.isMultiMaterial=!0,d.materials=d,d.clone=function(){return d.slice()},d},O.MultiplyBlending=4,O.MultiplyOperation=0,O.NearestFilter=Br,O.NearestMipMapLinearFilter=1005,O.NearestMipMapNearestFilter=1004,O.NearestMipmapLinearFilter=1005,O.NearestMipmapNearestFilter=1004,O.NeverDepth=0,O.NeverStencilFunc=512,O.NoBlending=0,O.NoColorSpace="",O.NoColors=0,O.NoToneMapping=0,O.NormalAnimationBlendMode=2500,O.NormalBlending=1,O.NotEqualDepth=7,O.NotEqualStencilFunc=517,O.NumberKeyframeTrack=Fp,O.Object3D=_i,O.ObjectLoader=class Bg extends Do{constructor(r){super(r)}load(r,a,c,h){const p=this,g=""===this.path?Og.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||g;const _=new Xa(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(r,function(w){let M=null;try{M=JSON.parse(w)}catch(T){return void 0!==h&&h(T),void console.error("THREE:ObjectLoader: Can't parse "+r+".",T.message)}const S=M.metadata;void 0!==S&&void 0!==S.type&&"geometry"!==S.type.toLowerCase()?p.parse(M,a):console.error("THREE.ObjectLoader: Can't load "+r)},c,h)}loadAsync(r,a){var c=this;return so(function*(){const h=c,p=""===c.path?Og.extractUrlBase(r):c.path;c.resourcePath=c.resourcePath||p;const g=new Xa(c.manager);g.setPath(c.path),g.setRequestHeader(c.requestHeader),g.setWithCredentials(c.withCredentials);const _=yield g.loadAsync(r,a),w=JSON.parse(_),M=w.metadata;if(void 0===M||void 0===M.type||"geometry"===M.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+r);return yield h.parseAsync(w)})()}parse(r,a){const c=this.parseAnimations(r.animations),h=this.parseShapes(r.shapes),p=this.parseGeometries(r.geometries,h),g=this.parseImages(r.images,function(){void 0!==a&&a(M)}),_=this.parseTextures(r.textures,g),w=this.parseMaterials(r.materials,_),M=this.parseObject(r.object,p,w,_,c),S=this.parseSkeletons(r.skeletons,M);if(this.bindSkeletons(M,S),void 0!==a){let T=!1;for(const D in g)if(g[D]instanceof HTMLImageElement){T=!0;break}!1===T&&a(M)}return M}parseAsync(r){var a=this;return so(function*(){const c=a.parseAnimations(r.animations),h=a.parseShapes(r.shapes),p=a.parseGeometries(r.geometries,h),g=yield a.parseImagesAsync(r.images),_=a.parseTextures(r.textures,g),w=a.parseMaterials(r.materials,_),M=a.parseObject(r.object,p,w,_,c),S=a.parseSkeletons(r.skeletons,M);return a.bindSkeletons(M,S),M})()}parseShapes(r){const a={};if(void 0!==r)for(let c=0,h=r.length;c<h;c++){const p=(new ec).fromJSON(r[c]);a[p.uuid]=p}return a}parseSkeletons(r,a){const c={},h={};if(a.traverse(function(p){p.isBone&&(h[p.uuid]=p)}),void 0!==r)for(let p=0,g=r.length;p<g;p++){const _=(new vv).fromJSON(r[p],h);c[_.uuid]=_}return c}parseGeometries(r,a){const c={};if(void 0!==r){const h=new Ow;for(let p=0,g=r.length;p<g;p++){let _;const w=r[p];switch(w.type){case"BufferGeometry":case"InstancedBufferGeometry":_=h.parse(w);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:w.type in Dg?_=Dg[w.type].fromJSON(w,a):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${w.type}"`)}_.uuid=w.uuid,void 0!==w.name&&(_.name=w.name),!0===_.isBufferGeometry&&void 0!==w.userData&&(_.userData=w.userData),c[w.uuid]=_}}return c}parseMaterials(r,a){const c={},h={};if(void 0!==r){const p=new Nw;p.setTextures(a);for(let g=0,_=r.length;g<_;g++){const w=r[g];if("MultiMaterial"===w.type){const M=[];for(let S=0;S<w.materials.length;S++){const T=w.materials[S];void 0===c[T.uuid]&&(c[T.uuid]=p.parse(T)),M.push(c[T.uuid])}h[w.uuid]=M}else void 0===c[w.uuid]&&(c[w.uuid]=p.parse(w)),h[w.uuid]=c[w.uuid]}}return h}parseAnimations(r){const a={};if(void 0!==r)for(let c=0;c<r.length;c++){const p=Td.parse(r[c]);a[p.uuid]=p}return a}parseImages(r,a){const c=this,h={};let p;function _(w){if("string"==typeof w){const M=w;return function g(w){return c.manager.itemStart(w),p.load(w,function(){c.manager.itemEnd(w)},void 0,function(){c.manager.itemError(w),c.manager.itemEnd(w)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(M)?M:c.resourcePath+M)}return w.data?{data:sl(w.type,w.data),width:w.width,height:w.height}:null}if(void 0!==r&&r.length>0){const w=new zv(a);p=new Np(w),p.setCrossOrigin(this.crossOrigin);for(let M=0,S=r.length;M<S;M++){const T=r[M],D=T.url;if(Array.isArray(D)){const R=[];for(let L=0,P=D.length;L<P;L++){const z=_(D[L]);null!==z&&(z instanceof HTMLImageElement?R.push(z):R.push(new Yl(z.data,z.width,z.height)))}h[T.uuid]=new fa(R)}else{const R=_(T.url);h[T.uuid]=new fa(R)}}}return h}parseImagesAsync(r){var a=this;return so(function*(){const c=a,h={};let p;function g(w){return _.apply(this,arguments)}function _(){return(_=so(function*(w){if("string"==typeof w){const M=w,S=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(M)?M:c.resourcePath+M;return yield p.loadAsync(S)}return w.data?{data:sl(w.type,w.data),width:w.width,height:w.height}:null})).apply(this,arguments)}if(void 0!==r&&r.length>0){p=new Np(a.manager),p.setCrossOrigin(a.crossOrigin);for(let w=0,M=r.length;w<M;w++){const S=r[w],T=S.url;if(Array.isArray(T)){const D=[];for(let R=0,L=T.length;R<L;R++){const P=T[R],I=yield g(P);null!==I&&(I instanceof HTMLImageElement?D.push(I):D.push(new Yl(I.data,I.width,I.height)))}h[S.uuid]=new fa(D)}else{const D=yield g(S.url);h[S.uuid]=new fa(D)}}}return h})()}parseTextures(r,a){function c(p,g){return"number"==typeof p?p:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",p),g[p])}const h={};if(void 0!==r)for(let p=0,g=r.length;p<g;p++){const _=r[p];void 0===_.image&&console.warn('THREE.ObjectLoader: No "image" specified for',_.uuid),void 0===a[_.image]&&console.warn("THREE.ObjectLoader: Undefined image",_.image);const w=a[_.image],M=w.data;let S;Array.isArray(M)?(S=new jl,6===M.length&&(S.needsUpdate=!0)):(S=M&&M.data?new Yl:new is,M&&(S.needsUpdate=!0)),S.source=w,S.uuid=_.uuid,void 0!==_.name&&(S.name=_.name),void 0!==_.mapping&&(S.mapping=c(_.mapping,Dd)),void 0!==_.offset&&S.offset.fromArray(_.offset),void 0!==_.repeat&&S.repeat.fromArray(_.repeat),void 0!==_.center&&S.center.fromArray(_.center),void 0!==_.rotation&&(S.rotation=_.rotation),void 0!==_.wrap&&(S.wrapS=c(_.wrap[0],Bw),S.wrapT=c(_.wrap[1],Bw)),void 0!==_.format&&(S.format=_.format),void 0!==_.type&&(S.type=_.type),void 0!==_.encoding&&(S.encoding=_.encoding),void 0!==_.minFilter&&(S.minFilter=c(_.minFilter,Rd)),void 0!==_.magFilter&&(S.magFilter=c(_.magFilter,Rd)),void 0!==_.anisotropy&&(S.anisotropy=_.anisotropy),void 0!==_.flipY&&(S.flipY=_.flipY),void 0!==_.premultiplyAlpha&&(S.premultiplyAlpha=_.premultiplyAlpha),void 0!==_.unpackAlignment&&(S.unpackAlignment=_.unpackAlignment),void 0!==_.userData&&(S.userData=_.userData),h[_.uuid]=S}return h}parseObject(r,a,c,h,p){let g,S,T;function _(D){return void 0===a[D]&&console.warn("THREE.ObjectLoader: Undefined geometry",D),a[D]}function w(D){if(void 0!==D){if(Array.isArray(D)){const R=[];for(let L=0,P=D.length;L<P;L++){const I=D[L];void 0===c[I]&&console.warn("THREE.ObjectLoader: Undefined material",I),R.push(c[I])}return R}return void 0===c[D]&&console.warn("THREE.ObjectLoader: Undefined material",D),c[D]}}function M(D){return void 0===h[D]&&console.warn("THREE.ObjectLoader: Undefined texture",D),h[D]}switch(r.type){case"Scene":g=new up,void 0!==r.background&&(g.background=Number.isInteger(r.background)?new Tt(r.background):M(r.background)),void 0!==r.environment&&(g.environment=M(r.environment)),void 0!==r.fog&&("Fog"===r.fog.type?g.fog=new Vu(r.fog.color,r.fog.near,r.fog.far):"FogExp2"===r.fog.type&&(g.fog=new md(r.fog.color,r.fog.density)));break;case"PerspectiveCamera":g=new Ds(r.fov,r.aspect,r.near,r.far),void 0!==r.focus&&(g.focus=r.focus),void 0!==r.zoom&&(g.zoom=r.zoom),void 0!==r.filmGauge&&(g.filmGauge=r.filmGauge),void 0!==r.filmOffset&&(g.filmOffset=r.filmOffset),void 0!==r.view&&(g.view=Object.assign({},r.view));break;case"OrthographicCamera":g=new ep(r.left,r.right,r.top,r.bottom,r.near,r.far),void 0!==r.zoom&&(g.zoom=r.zoom),void 0!==r.view&&(g.view=Object.assign({},r.view));break;case"AmbientLight":g=new Xv(r.color,r.intensity);break;case"DirectionalLight":g=new Li(r.color,r.intensity);break;case"PointLight":g=new Fw(r.color,r.intensity,r.distance,r.decay);break;case"RectAreaLight":g=new Op(r.color,r.intensity,r.width,r.height);break;case"SpotLight":g=new Iw(r.color,r.intensity,r.distance,r.angle,r.penumbra,r.decay);break;case"HemisphereLight":g=new Hv(r.color,r.groundColor,r.intensity);break;case"LightProbe":g=(new Bp).fromJSON(r);break;case"SkinnedMesh":S=_(r.geometry),T=w(r.material),g=new vd(S,T),void 0!==r.bindMode&&(g.bindMode=r.bindMode),void 0!==r.bindMatrix&&g.bindMatrix.fromArray(r.bindMatrix),void 0!==r.skeleton&&(g.skeleton=r.skeleton);break;case"Mesh":S=_(r.geometry),T=w(r.material),g=new Kr(S,T);break;case"InstancedMesh":S=_(r.geometry),T=w(r.material);const R=r.instanceMatrix,L=r.instanceColor;g=new hw(S,T,r.count),g.instanceMatrix=new yl(new Float32Array(R.array),16),void 0!==L&&(g.instanceColor=new yl(new Float32Array(L.array),L.itemSize));break;case"LOD":g=new yp;break;case"Line":g=new Kl(_(r.geometry),w(r.material));break;case"LineLoop":g=new wv(_(r.geometry),w(r.material));break;case"LineSegments":g=new Co(_(r.geometry),w(r.material));break;case"PointCloud":case"Points":g=new vg(_(r.geometry),w(r.material));break;case"Sprite":g=new In(w(r.material));break;case"Group":g=new Nc;break;case"Bone":g=new _p;break;default:g=new _i}if(g.uuid=r.uuid,void 0!==r.name&&(g.name=r.name),void 0!==r.matrix?(g.matrix.fromArray(r.matrix),void 0!==r.matrixAutoUpdate&&(g.matrixAutoUpdate=r.matrixAutoUpdate),g.matrixAutoUpdate&&g.matrix.decompose(g.position,g.quaternion,g.scale)):(void 0!==r.position&&g.position.fromArray(r.position),void 0!==r.rotation&&g.rotation.fromArray(r.rotation),void 0!==r.quaternion&&g.quaternion.fromArray(r.quaternion),void 0!==r.scale&&g.scale.fromArray(r.scale)),void 0!==r.castShadow&&(g.castShadow=r.castShadow),void 0!==r.receiveShadow&&(g.receiveShadow=r.receiveShadow),r.shadow&&(void 0!==r.shadow.bias&&(g.shadow.bias=r.shadow.bias),void 0!==r.shadow.normalBias&&(g.shadow.normalBias=r.shadow.normalBias),void 0!==r.shadow.radius&&(g.shadow.radius=r.shadow.radius),void 0!==r.shadow.mapSize&&g.shadow.mapSize.fromArray(r.shadow.mapSize),void 0!==r.shadow.camera&&(g.shadow.camera=this.parseObject(r.shadow.camera))),void 0!==r.visible&&(g.visible=r.visible),void 0!==r.frustumCulled&&(g.frustumCulled=r.frustumCulled),void 0!==r.renderOrder&&(g.renderOrder=r.renderOrder),void 0!==r.userData&&(g.userData=r.userData),void 0!==r.layers&&(g.layers.mask=r.layers),void 0!==r.children){const D=r.children;for(let R=0;R<D.length;R++)g.add(this.parseObject(D[R],a,c,h,p))}if(void 0!==r.animations){const D=r.animations;for(let R=0;R<D.length;R++)g.animations.push(p[D[R]])}if("LOD"===r.type){void 0!==r.autoUpdate&&(g.autoUpdate=r.autoUpdate);const D=r.levels;for(let R=0;R<D.length;R++){const L=D[R],P=g.getObjectByProperty("uuid",L.object);void 0!==P&&g.addLevel(P,L.distance)}}return g}bindSkeletons(r,a){0!==Object.keys(a).length&&r.traverse(function(c){if(!0===c.isSkinnedMesh&&void 0!==c.skeleton){const h=a[c.skeleton];void 0===h?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",c.skeleton):c.bind(h,c.bindMatrix)}})}setTexturePath(r){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(r)}},O.ObjectSpaceNormalMap=1,O.OctahedronBufferGeometry=$u,O.OctahedronGeometry=$u,O.OneFactor=201,O.OneMinusDstAlphaFactor=207,O.OneMinusDstColorFactor=209,O.OneMinusSrcAlphaFactor=205,O.OneMinusSrcColorFactor=203,O.OrthographicCamera=ep,O.PCFShadowMap=1,O.PCFSoftShadowMap=2,O.PMREMGenerator=Y_,O.ParametricGeometry=class _M extends Jt{constructor(){console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),super()}},O.Particle=class u0 extends In{constructor(r){console.warn("THREE.Particle has been renamed to THREE.Sprite."),super(r)}},O.ParticleBasicMaterial=class oM extends $l{constructor(r){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),super(r)}},O.ParticleSystem=class rM extends vg{constructor(r,a){console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),super(r,a)}},O.ParticleSystemMaterial=class aM extends $l{constructor(r){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),super(r)}},O.Path=Jl,O.PerspectiveCamera=Ds,O.Plane=Js,O.PlaneBufferGeometry=Iu,O.PlaneGeometry=Iu,O.PlaneHelper=class h1 extends Kl{constructor(r,a=1,c=16776960){const h=c,g=new Jt;g.setAttribute("position",new en([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),g.computeBoundingSphere(),super(g,new Ps({color:h,toneMapped:!1})),this.type="PlaneHelper",this.plane=r,this.size=a;const w=new Jt;w.setAttribute("position",new en([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),w.computeBoundingSphere(),this.add(new Kr(w,new ul({color:h,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(r){let a=-this.plane.constant;Math.abs(a)<1e-8&&(a=1e-8),this.scale.set(.5*this.size,.5*this.size,a),this.children[0].material.side=a<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(r)}},O.PointCloud=class Ls extends vg{constructor(r,a){console.warn("THREE.PointCloud has been renamed to THREE.Points."),super(r,a)}},O.PointCloudMaterial=class sM extends $l{constructor(r){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),super(r)}},O.PointLight=Fw,O.PointLightHelper=class a1 extends Kr{constructor(r,a,c){super(new Vc(a,4,2),new ul({wireframe:!0,fog:!1,toneMapped:!1})),this.light=r,this.light.updateMatrixWorld(),this.color=c,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},O.Points=vg,O.PointsMaterial=$l,O.PolarGridHelper=class u1 extends Co{constructor(r=10,a=16,c=8,h=64,p=4473924,g=8947848){p=new Tt(p),g=new Tt(g);const _=[],w=[];for(let T=0;T<=a;T++){const D=T/a*(2*Math.PI),R=Math.sin(D)*r,L=Math.cos(D)*r;_.push(0,0,0),_.push(R,0,L);const P=1&T?p:g;w.push(P.r,P.g,P.b),w.push(P.r,P.g,P.b)}for(let T=0;T<=c;T++){const D=1&T?p:g,R=r-r/c*T;for(let L=0;L<h;L++){let P=L/h*(2*Math.PI),I=Math.sin(P)*R,z=Math.cos(P)*R;_.push(I,0,z),w.push(D.r,D.g,D.b),P=(L+1)/h*(2*Math.PI),I=Math.sin(P)*R,z=Math.cos(P)*R,_.push(I,0,z),w.push(D.r,D.g,D.b)}}const M=new Jt;M.setAttribute("position",new en(_,3)),M.setAttribute("color",new en(w,3)),super(M,new Ps({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},O.PolyhedronBufferGeometry=xl,O.PolyhedronGeometry=xl,O.PositionalAudio=class Uw extends Gc{constructor(r){super(r),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(r){return this.panner.refDistance=r,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(r){return this.panner.rolloffFactor=r,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(r){return this.panner.distanceModel=r,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(r){return this.panner.maxDistance=r,this}setDirectionalCone(r,a,c){return this.panner.coneInnerAngle=r,this.panner.coneOuterAngle=a,this.panner.coneOuterGain=c,this}updateMatrixWorld(r){if(super.updateMatrixWorld(r),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ta,$v,Vw),Wc.set(0,0,1).applyQuaternion($v);const a=this.panner;if(a.positionX){const c=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(Ta.x,c),a.positionY.linearRampToValueAtTime(Ta.y,c),a.positionZ.linearRampToValueAtTime(Ta.z,c),a.orientationX.linearRampToValueAtTime(Wc.x,c),a.orientationY.linearRampToValueAtTime(Wc.y,c),a.orientationZ.linearRampToValueAtTime(Wc.z,c)}else a.setPosition(Ta.x,Ta.y,Ta.z),a.setOrientation(Wc.x,Wc.y,Wc.z)}},O.PropertyBinding=mr,O.PropertyMixer=Jv,O.QuadraticBezierCurve=wp,O.QuadraticBezierCurve3=Mp,O.Quaternion=Zs,O.QuaternionKeyframeTrack=Cd,O.QuaternionLinearInterpolant=Cw,O.REVISION="139",O.RGBADepthPacking=3201,O.RGBAFormat=Ct,O.RGBAIntegerFormat=1033,O.RGBA_ASTC_10x10_Format=37819,O.RGBA_ASTC_10x5_Format=37816,O.RGBA_ASTC_10x6_Format=37817,O.RGBA_ASTC_10x8_Format=37818,O.RGBA_ASTC_12x10_Format=37820,O.RGBA_ASTC_12x12_Format=37821,O.RGBA_ASTC_4x4_Format=37808,O.RGBA_ASTC_5x4_Format=37809,O.RGBA_ASTC_5x5_Format=37810,O.RGBA_ASTC_6x5_Format=37811,O.RGBA_ASTC_6x6_Format=37812,O.RGBA_ASTC_8x5_Format=37813,O.RGBA_ASTC_8x6_Format=37814,O.RGBA_ASTC_8x8_Format=37815,O.RGBA_BPTC_Format=36492,O.RGBA_ETC2_EAC_Format=37496,O.RGBA_PVRTC_2BPPV1_Format=35843,O.RGBA_PVRTC_4BPPV1_Format=35842,O.RGBA_S3TC_DXT1_Format=Ss,O.RGBA_S3TC_DXT3_Format=il,O.RGBA_S3TC_DXT5_Format=Ol,O.RGBFormat=1022,O.RGB_ETC1_Format=36196,O.RGB_ETC2_Format=37492,O.RGB_PVRTC_2BPPV1_Format=35841,O.RGB_PVRTC_4BPPV1_Format=35840,O.RGB_S3TC_DXT1_Format=br,O.RGFormat=1030,O.RGIntegerFormat=1031,O.RawShaderMaterial=Pp,O.Ray=No,O.Raycaster=class t0{constructor(r,a,c=0,h=1/0){this.ray=new No(r,a),this.near=c,this.far=h,this.camera=null,this.layers=new Xh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(r,a){this.ray.set(r,a)}setFromCamera(r,a){a.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(a.matrixWorld),this.ray.direction.set(r.x,r.y,.5).unproject(a).sub(this.ray.origin).normalize(),this.camera=a):a.isOrthographicCamera?(this.ray.origin.set(r.x,r.y,(a.near+a.far)/(a.near-a.far)).unproject(a),this.ray.direction.set(0,0,-1).transformDirection(a.matrixWorld),this.camera=a):console.error("THREE.Raycaster: Unsupported camera type: "+a.type)}intersectObject(r,a=!0,c=[]){return Xw(r,this,c,a),c.sort(jw),c}intersectObjects(r,a=!0,c=[]){for(let h=0,p=r.length;h<p;h++)Xw(r[h],this,c,a);return c.sort(jw),c}},O.RectAreaLight=Op,O.RedFormat=1028,O.RedIntegerFormat=1029,O.ReinhardToneMapping=2,O.RepeatWrapping=oo,O.ReplaceStencilOp=7681,O.ReverseSubtractEquation=102,O.RingBufferGeometry=Zu,O.RingGeometry=Zu,O.SRGBColorSpace=rl,O.Scene=up,O.SceneUtils=yM,O.ShaderChunk=Jn,O.ShaderLib=ba,O.ShaderMaterial=va,O.ShadowMaterial=Rg,O.Shape=ec,O.ShapeBufferGeometry=kc,O.ShapeGeometry=kc,O.ShapePath=class a0{constructor(){this.type="ShapePath",this.color=new Tt,this.subPaths=[],this.currentPath=null}moveTo(r,a){return this.currentPath=new Jl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(r,a),this}lineTo(r,a){return this.currentPath.lineTo(r,a),this}quadraticCurveTo(r,a,c,h){return this.currentPath.quadraticCurveTo(r,a,c,h),this}bezierCurveTo(r,a,c,h,p,g){return this.currentPath.bezierCurveTo(r,a,c,h,p,g),this}splineThru(r){return this.currentPath.splineThru(r),this}toShapes(r,a){function c(B){const j=[];for(let H=0,K=B.length;H<K;H++){const ae=B[H],he=new ec;he.curves=ae.curves,j.push(he)}return j}function h(B,j){const H=j.length;let K=!1;for(let ae=H-1,he=0;he<H;ae=he++){let me=j[ae],ke=j[he],ve=ke.x-me.x,X=ke.y-me.y;if(Math.abs(X)>Number.EPSILON){if(X<0&&(me=j[he],ve=-ve,ke=j[ae],X=-X),B.y<me.y||B.y>ke.y)continue;if(B.y===me.y){if(B.x===me.x)return!0}else{const ce=X*(B.x-me.x)-ve*(B.y-me.y);if(0===ce)return!0;if(ce<0)continue;K=!K}}else{if(B.y!==me.y)continue;if(ke.x<=B.x&&B.x<=me.x||me.x<=B.x&&B.x<=ke.x)return!0}}return K}const p=Ma.isClockWise,g=this.subPaths;if(0===g.length)return[];if(!0===a)return c(g);let _,w,M;const S=[];if(1===g.length)return w=g[0],M=new ec,M.curves=w.curves,S.push(M),S;let T=!p(g[0].getPoints());T=r?!T:T;const D=[],R=[];let I,z,L=[],P=0;R[P]=void 0,L[P]=[];for(let B=0,j=g.length;B<j;B++)w=g[B],I=w.getPoints(),_=p(I),_=r?!_:_,_?(!T&&R[P]&&P++,R[P]={s:new ec,p:I},R[P].s.curves=w.curves,T&&P++,L[P]=[]):L[P].push({h:w,p:I[0]});if(!R[0])return c(g);if(R.length>1){let B=!1,j=0;for(let H=0,K=R.length;H<K;H++)D[H]=[];for(let H=0,K=R.length;H<K;H++){const ae=L[H];for(let he=0;he<ae.length;he++){const me=ae[he];let ke=!0;for(let ve=0;ve<R.length;ve++)h(me.p,R[ve].p)&&(H!==ve&&j++,ke?(ke=!1,D[ve].push(me)):B=!0);ke&&D[H].push(me)}}j>0&&!1===B&&(L=D)}for(let B=0,j=R.length;B<j;B++){M=R[B].s,S.push(M),z=L[B];for(let H=0,K=z.length;H<K;H++)M.holes.push(z[H].h)}return S}},O.ShapeUtils=Ma,O.ShortType=1011,O.Skeleton=vv,O.SkeletonHelper=Zw,O.SkinnedMesh=vd,O.SmoothShading=2,O.Source=fa,O.Sphere=Cu,O.SphereBufferGeometry=Vc,O.SphereGeometry=Vc,O.Spherical=class iI{constructor(r=1,a=0,c=0){return this.radius=r,this.phi=a,this.theta=c,this}set(r,a,c){return this.radius=r,this.phi=a,this.theta=c,this}copy(r){return this.radius=r.radius,this.phi=r.phi,this.theta=r.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,a,c){return this.radius=Math.sqrt(r*r+a*a+c*c),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r,c),this.phi=Math.acos(ns(a/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},O.SphericalHarmonics3=Yv,O.SplineCurve=Ed,O.SpotLight=Iw,O.SpotLightHelper=class $w extends _i{constructor(r,a){super(),this.light=r,this.light.updateMatrixWorld(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=a;const c=new Jt,h=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let g=0,_=1,w=32;g<w;g++,_++){const M=g/w*Math.PI*2,S=_/w*Math.PI*2;h.push(Math.cos(M),Math.sin(M),1,Math.cos(S),Math.sin(S),1)}c.setAttribute("position",new en(h,3));const p=new Ps({fog:!1,toneMapped:!1});this.cone=new Co(c,p),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const r=this.light.distance?this.light.distance:1e3,a=r*Math.tan(this.light.angle);this.cone.scale.set(a,a,r),Kw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Kw),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},O.Sprite=In,O.SpriteMaterial=hp,O.SrcAlphaFactor=204,O.SrcAlphaSaturateFactor=210,O.SrcColorFactor=202,O.StaticCopyUsage=35046,O.StaticDrawUsage=Uh,O.StaticReadUsage=35045,O.StereoCamera=class rc{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ds,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ds,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(r){const a=this._cache;if(a.focus!==r.focus||a.fov!==r.fov||a.aspect!==r.aspect*this.aspect||a.near!==r.near||a.far!==r.far||a.zoom!==r.zoom||a.eyeSep!==this.eyeSep){a.focus=r.focus,a.fov=r.fov,a.aspect=r.aspect*this.aspect,a.near=r.near,a.far=r.far,a.zoom=r.zoom,a.eyeSep=this.eyeSep,Is.copy(r.projectionMatrix);const h=a.eyeSep/2,p=h*a.near/a.focus,g=a.near*Math.tan(zh*a.fov*.5)/a.zoom;let _,w;Vp.elements[12]=-h,Hc.elements[12]=h,_=-g*a.aspect+p,w=g*a.aspect+p,Is.elements[0]=2*a.near/(w-_),Is.elements[8]=(w+_)/(w-_),this.cameraL.projectionMatrix.copy(Is),_=-g*a.aspect-p,w=g*a.aspect-p,Is.elements[0]=2*a.near/(w-_),Is.elements[8]=(w+_)/(w-_),this.cameraR.projectionMatrix.copy(Is)}this.cameraL.matrixWorld.copy(r.matrixWorld).multiply(Vp),this.cameraR.matrixWorld.copy(r.matrixWorld).multiply(Hc)}},O.StreamCopyUsage=35042,O.StreamDrawUsage=35040,O.StreamReadUsage=35041,O.StringKeyframeTrack=zr,O.SubtractEquation=101,O.SubtractiveBlending=3,O.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},O.TangentSpaceNormalMap=0,O.TetrahedronBufferGeometry=Ju,O.TetrahedronGeometry=Ju,O.TextGeometry=class cI extends Jt{constructor(){console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),super()}},O.Texture=is,O.TextureLoader=$T,O.TorusBufferGeometry=ko,O.TorusGeometry=ko,O.TorusKnotBufferGeometry=nc,O.TorusKnotGeometry=nc,O.Triangle=Vr,O.TriangleFanDrawMode=2,O.TriangleStripDrawMode=1,O.TrianglesDrawMode=0,O.TubeBufferGeometry=Sd,O.TubeGeometry=Sd,O.UVMapping=300,O.Uint16Attribute=class g1 extends rt{constructor(r,a){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),super(r,a)}},O.Uint16BufferAttribute=rt,O.Uint32Attribute=class y1 extends _t{constructor(r,a){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),super(r,a)}},O.Uint32BufferAttribute=_t,O.Uint8Attribute=class hM extends C_{constructor(r,a){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),super(r,a)}},O.Uint8BufferAttribute=C_,O.Uint8ClampedAttribute=class lI extends jx{constructor(r,a){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),super(r,a)}},O.Uint8ClampedBufferAttribute=jx,O.Uniform=e0,O.UniformsLib=At,O.UniformsUtils=ql,O.UnsignedByteType=za,O.UnsignedInt248Type=Ke,O.UnsignedIntType=U,O.UnsignedShort4444Type=1017,O.UnsignedShort5551Type=1018,O.UnsignedShortType=ca,O.VSMShadowMap=3,O.Vector2=Qe,O.Vector3=J,O.Vector4=ki,O.VectorKeyframeTrack=eh,O.Vertex=class lM extends J{constructor(r,a,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),super(r,a,c)}},O.VertexColors=2,O.VideoTexture=RT,O.WebGL1Renderer=sw,O.WebGL3DRenderTarget=pa,O.WebGLArrayRenderTarget=Hh,O.WebGLCubeRenderTarget=Pu,O.WebGLMultipleRenderTargets=ur,O.WebGLMultisampleRenderTarget=class E1 extends rs{constructor(r,a,c){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(r,a,c),this.samples=4}},O.WebGLRenderTarget=rs,O.WebGLRenderTargetCube=class Od extends Pu{constructor(r,a,c){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),super(r,c)}},O.WebGLRenderer=tr,O.WebGLUtils=ap,O.WireframeGeometry=Bv,O.WireframeHelper=class x1 extends Co{constructor(r,a){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),super(new Bv(r.geometry),new Ps({color:void 0!==a?a:16777215}))}},O.WrapAroundEnding=km,O.XHRLoader=class mM extends Xa{constructor(r){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),super(r)}},O.ZeroCurvatureEnding=bu,O.ZeroFactor=200,O.ZeroSlopeEnding=kh,O.ZeroStencilOp=0,O._SRGBAFormat=1035,O.sRGBEncoding=wr}},xo=>{xo(xo.s=316)}]);